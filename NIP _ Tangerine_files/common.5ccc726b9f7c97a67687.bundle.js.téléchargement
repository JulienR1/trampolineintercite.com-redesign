/*! For license information please see common.5ccc726b9f7c97a67687.bundle.js.LICENSE */
(window.webpackJsonp=window.webpackJsonp||[]).push([["common","accountAggregationBundle","insights","peopleLikeYou"],Array(536).concat([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=h(n(1923)),a=h(n(1927)),s=h(n(1931)),r=h(n(1935)),o=h(n(1939)),c=h(n(1943)),l=h(n(1947)),u=h(n(1951)),d=h(n(1955));function h(t){return t&&t.__esModule?t:{default:t}}var f=angular.module("tangerine.app.core.components.transactionsList",[]).component("tngTransactionsList",i.default).component("tngTransactionDateColumn",a.default).component("tngTransactionAmountColumn",s.default).component("tngUncategorizedTransactionsList",c.default).component("tngInvestmentPendingTransactionsList",l.default).component("tngInvestmentSettledTransactionsList",u.default).component("tngTransactionsListHeader",r.default).component("tngTransactionsCategorySelector",o.default).service("TransactionsListService",d.default);e.default=f,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(1960)),a=d(n(1964)),s=d(n(1968)),r=d(n(1972)),o=d(n(1976)),c=d(n(1980)),l=d(n(1981)),u=d(n(1982));function d(t){return t&&t.__esModule?t:{default:t}}var h=angular.module("accountAggregation",[]).component("tngAccountAggregation",i.default).component("tngPlaidLogin",a.default).component("tngAggregatedAccounts",s.default).component("tngRemoveBankModal",r.default).component("tngConsentBankModal",o.default).service("AccountAggregationService",c.default).service("AccountAggregationFeedbackService",l.default).constant("AccountAggregationConstants",u.default);e.default=h,t.exports=e.default},,,,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=p(n(2218)),a=p(n(2222)),s=p(n(2234)),r=p(n(2240)),o=p(n(2246)),c=p(n(2250)),l=p(n(2251)),u=p(n(2252)),d=p(n(1959)),h=p(n(1987)),f=p(n(371));function p(t){return t&&t.__esModule?t:{default:t}}var g=angular.module("tangerine.billPay.module",[a.default.name,s.default.name,r.default.name]).component("billPay",i.default).component("tngPayeeList",o.default).service("PayeeListService",c.default).service("EditPayeeService",l.default).service("PayBillService",u.default).service("BillPayAccountsService",d.default).service("BillHistoryService",h.default).service("DateService",f.default);e.default=g,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(2253)),a=o(n(2257)),s=o(n(1959)),r=o(n(2258));function o(t){return t&&t.__esModule?t:{default:t}}var c=angular.module("single-bill-pay",[]).component("singleBillPayModal",i.default).component("singleBillConfirmedState",r.default).service("SingleBillPayFlowService",a.default).service("BillPayAccountsService",s.default);e.default=c,t.exports=e.default},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(1796),n(1956),n(1957),n(1958);var i=r(n(2265)),a=r(n(2266)),s=r(n(2270));function r(t){return t&&t.__esModule?t:{default:t}}var o=angular.module("tangerine.peopleLikeYou.module",["nvd3"]).service("PeopleLikeYouService",i.default).component("tngPeopleLikeYouChart",a.default).component("tngPeopleLikeYou",s.default);e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(2274),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("tangerine.insights.modules",[s.default.name]);e.default=r,t.exports=e.default},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";n(1862),n(1863),n(4510),n(4511),n(4512)},,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(1865),n(1866);var i=s(n(550)),a=s(n(551));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("tangerine");r.requires.push("rzModule"),window.WL&&(r.config(i.default),(0,a.default)(r)),e.default=r,t.exports=e.default},,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=S(n(4513)),a=S(n(4514)),s=S(n(4515)),r=S(n(4516)),o=S(n(4517)),c=S(n(4518)),l=S(n(4519)),u=S(n(4520)),d=S(n(2262)),h=S(n(4521)),f=S(n(4522)),p=S(n(4523)),g=S(n(4524)),m=S(n(4525)),_=S(n(2280)),v=S(n(4526));function S(t){return t&&t.__esModule?t:{default:t}}var T=angular.module("tangerine.app.core.services",[]).service("AccountDetailsService",u.default).service("AccountDocumentsService",d.default).service("AccountService",h.default).service("CardsService",i.default).service("CurrencyExchangeService",a.default).service("TransactionsService",s.default).service("MessageTemplatesService",r.default).service("BeneficiariesService",f.default).service("FileUploadService",o.default).service("DocumentUploadService",c.default).service("FileUploadHelperService",l.default).service("DropOffService",p.default).service("PendingTransactionsTitleFormatter",m.default).service("PDFRequestService",g.default).service("RewardsModalFlowService",_.default).factory("displayErrorFactory",v.default);e.default=T,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=Rt(n(4527)),a=Rt(n(4533)),s=Rt(n(4540)),r=Rt(n(4552)),o=Rt(n(4557)),c=Rt(n(4584)),l=Rt(n(4589)),u=Rt(n(4602)),d=Rt(n(4607)),h=Rt(n(4612)),f=Rt(n(4617)),p=Rt(n(4622)),g=Rt(n(4649)),m=Rt(n(4654)),_=Rt(n(4658)),v=Rt(n(4664)),S=Rt(n(4676)),T=Rt(n(4681)),y=Rt(n(4688)),E=Rt(n(4694)),A=Rt(n(536)),b=Rt(n(4708)),C=Rt(n(4716)),$=Rt(n(4727)),N=Rt(n(4732)),O=Rt(n(4736)),I=Rt(n(4741)),w=Rt(n(4762)),P=Rt(n(4769)),M=Rt(n(4794)),R=Rt(n(4798)),D=Rt(n(4806)),L=Rt(n(4826)),k=Rt(n(4833)),B=Rt(n(4839)),U=Rt(n(4844)),F=Rt(n(4849)),x=Rt(n(1805)),Y=Rt(n(1806)),G=Rt(n(4854)),V=Rt(n(4861)),q=Rt(n(1903)),H=Rt(n(4874)),W=Rt(n(537)),j=Rt(n(4878)),K=Rt(n(4885)),z=Rt(n(2175)),Q=Rt(n(4896)),X=Rt(n(4900)),J=Rt(n(4903)),Z=Rt(n(4907)),tt=Rt(n(4910)),et=Rt(n(4913)),nt=Rt(n(4917)),it=Rt(n(4921)),at=Rt(n(4925)),st=Rt(n(4928)),rt=Rt(n(4932)),ot=Rt(n(4936)),ct=Rt(n(4940)),lt=Rt(n(4943)),ut=Rt(n(4946)),dt=Rt(n(4949)),ht=Rt(n(4953)),ft=Rt(n(4957)),pt=Rt(n(4961)),gt=Rt(n(4965)),mt=Rt(n(4969)),_t=Rt(n(4972)),vt=Rt(n(4976)),St=Rt(n(4983)),Tt=Rt(n(4992)),yt=Rt(n(4999)),Et=Rt(n(5003)),At=Rt(n(5007)),bt=Rt(n(5011)),Ct=Rt(n(5025)),$t=Rt(n(5029)),Nt=Rt(n(5033)),Ot=Rt(n(5037)),It=Rt(n(5041)),wt=Rt(n(5045)),Pt=Rt(n(5049)),Mt=Rt(n(5050));function Rt(t){return t&&t.__esModule?t:{default:t}}var Dt=angular.module("tangerine.app.core.components.deferred",[r.default.name,_.default.name,c.default.name,l.default.name,v.default.name,d.default.name,h.default.name,f.default.name,a.default.name,s.default.name,o.default.name,u.default.name,p.default.name,g.default.name,i.default.name,S.default.name,E.default.name,A.default.name,T.default.name,y.default.name,b.default.name,C.default.name,$.default.name,N.default.name,P.default.name,O.default.name,I.default.name,w.default.name,R.default.name,D.default.name,L.default.name,k.default.name,B.default.name,F.default.name,U.default.name,vt.default.name,St.default.name,Tt.default.name,x.default.name,Y.default.name,G.default.name,V.default.name,W.default.name,bt.default.name,j.default.name,K.default.name,z.default.name]).component("tngBasicInfoForm",Q.default).component("tngCategoryIcon",X.default).component("tngDoubleSafeConfirmModal",m.default).component("tngLeverageSection",J.default).component("tngAccountName",tt.default).component("tngAccountSelect",st.default).component("tngOtherCommunicationsModal",rt.default).component("tpiFormComponent",q.default).component("tngIntendedUse",H.default).component("tngGlobalModals",Z.default).component("tngConditionPicker",ot.default).component("tngSmallCard",ct.default).component("tngAccordion",lt.default).component("tngEmploymentSelect",M.default).component("tngBrowseCategoriesWidget",it.default).component("tngPrintHeader",at.default).component("tngFoldableCategoryList",nt.default).component("tngPrintButton",et.default).component("tngUserCheckModal",ut.default).component("tngSinInput",dt.default).component("tngLtsMessage",ht.default).component("tngLtsFixItDialog",ft.default).component("tngLtsMoveMoneyDialog",pt.default).directive("tngEmptyStateSplashScreen",mt.default).component("tngDateInput",_t.default).component("tngRadioButtonPicker",gt.default).component("tngActionButtonsMobile",yt.default).component("tngDropDownTile",Et.default).component("tngKycRoadblockModal",At.default).component("tngMortgageApplicationMamTile",Ct.default).component("tngQuickAccessTile",$t.default).component("tngConditionChecklist",Nt.default).component("tngTpiItem",Ot.default).component("tngReviewItem",It.default).component("tngIuItem",wt.default).directive("tngFileData",Pt.default).component("tngInfoSummaryAccordion",Mt.default);e.default=Dt,t.exports=e.default},,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(5054)),a=l(n(5055)),s=l(n(5058)),r=l(n(5061)),o=l(n(5064)),c=l(n(5068));function l(t){return t&&t.__esModule?t:{default:t}}var u=angular.module("tangerine.forms.module",[c.default.name]).constant("formsConstants",i.default).component("forms",a.default).component("tngBanking",s.default).component("tngInvestment",r.default).component("tngDirectDepositForm",o.default);e.default=u,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(5099)),a=c(n(5123)),s=c(n(5162)),r=c(n(5166)),o=c(n(5170));function c(t){return t&&t.__esModule?t:{default:t}}var l=angular.module("tangerine.payBills.module",[i.default.name,a.default.name]).component("tngBiller",s.default).component("tngBillerMobile",r.default).component("tngBillerDetailsMobile",o.default);e.default=l,t.exports=e.default},,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(5174)),a=c(n(5178)),s=c(n(5179)),r=c(n(5180)),o=c(n(5181));function c(t){return t&&t.__esModule?t:{default:t}}var l=angular.module("tangerine.aps.module",[]).component("tngAsp",i.default).component("borrowAspMoneyState",o.default).service("AspFlowService",a.default).service("AspAccountsService",s.default).constant("aspConstants",r.default);e.default=l,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=O(n(1907)),a=O(n(5185)),s=O(n(5189)),r=O(n(5193)),o=O(n(5197)),c=O(n(5201)),l=O(n(5205)),u=O(n(5209)),d=O(n(5213)),h=O(n(5217)),f=O(n(5221)),p=O(n(5225)),g=O(n(5229)),m=O(n(5233)),_=O(n(5236)),v=O(n(5240)),S=O(n(5244)),T=O(n(5248)),y=O(n(5252)),E=O(n(5253)),A=O(n(557)),b=O(n(5254)),C=O(n(5255)),$=O(n(564)),N=O(n(1900));function O(t){return t&&t.__esModule?t:{default:t}}var I=angular.module("tangerine.accountSummary.module",[]).component("accountSummary",a.default).component("drawerItem",r.default).component("whatICard",s.default).component("accountCard",d.default).component("accountSection",o.default).component("tngAccountSummaryList",c.default).component("tngProgressSummaryList",l.default).component("tngCategoryTabs",u.default).component("goalCard",h.default).component("accountAggregationCard",f.default).component("accountCardsLoading",p.default).component("quickAccess",g.default).component("tngServiceInterruption",m.default).component("preApproved",_.default).component("preApprovedCreditCardModal",v.default).component("ltsWidget",S.default).component("tngManualReviewTlocModal",T.default).service("AccountSummaryService",y.default).service("AccountTabListService",E.default).service("UserCapabilitiesService",A.default).service("RspLoanService",b.default).constant("RspLoanConstants",C.default).constant("tpiFormConstants",i.default).constant("userConstants",$.default).constant("ExistingClientOnboardingConstants",N.default);e.default=I,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=h(n(179)),a=h(n(5256)),s=h(n(5293)),r=h(n(5300)),o=h(n(5307)),c=h(n(5314)),l=h(n(5319)),u=h(n(5320)),d=h(n(5321));function h(t){return t&&t.__esModule?t:{default:t}}var f=angular.module("tangerine.emt.module",[a.default.name,s.default.name,r.default.name,o.default.name,c.default.name]).service("EmtService",l.default).service("ETransferService",u.default).constant("stateConstants",i.default).component("emtTermsAndConditionsAccordion",d.default);e.default=f,t.exports=e.default},,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=S(n(5325)),a=S(n(5326)),s=S(n(5330)),r=S(n(5331)),o=S(n(5332)),c=S(n(5335)),l=S(n(5338)),u=S(n(5341)),d=S(n(5344)),h=S(n(5347)),f=S(n(5350)),p=S(n(5353)),g=S(n(5356)),m=S(n(5359)),_=S(n(5362)),v=S(n(5365));function S(t){return t&&t.__esModule?t:{default:t}}var T=angular.module("tangerine.app.core.components.magicSwitch",[]).service("MagicSwitchService",s.default).service("MagicSwitchFlowService",r.default).component("tngMagicSwitch",a.default).component("tngPendingTransfers",o.default).component("tngPendingTransferDetails",c.default).component("tngTransferIntro",l.default).component("tngTransferPersonalInfo",u.default).component("tngTransferExternalInfo",d.default).component("tngTransferAmount",h.default).component("tngTransferReview",f.default).component("tngTransferEsign",p.default).component("tngTransferDone",g.default).component("tngTransferDoneEsign",m.default).component("tngTransferDoneInk",_.default).component("tngTransferDoneSaved",v.default).constant("magicSwitchConstants",i.default);e.default=T,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=h(n(5368)),a=h(n(5372)),s=h(n(5373)),r=h(n(561)),o=h(n(5374)),c=h(n(5378)),l=h(n(5382)),u=h(n(5383)),d=n(5384);function h(t){return t&&t.__esModule?t:{default:t}}var f=angular.module("KycModule",[]).constant("kycConstants",a.default).service("KYCFlowService",s.default).service("KYCPendingService",r.default).component("tngKyc",i.default).service("BarcodeService",l.default).service("KVAAltConfirmService",u.default).component("kvaAlt",o.default).component("kvaAltConfirm",c.default).directive("tngHideKycPending",d.HideIfKycPendingDirective).directive("tngShowKycPending",d.ShowIfKycPendingDirective).directive("tngDisabledKycPending",d.DisableIfKycPendingDirective).directive("tngWarnOnClickKycPending",d.WarnOnClickIfKycPendingDirective);e.default=f,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5385)),a=s(n(5389));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("KycEnrollModule",[]).component("tngKycEnroll",i.default).service("KYCEnrollFlowService",a.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(5390),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("KycPageModule",[]).component("kycPage",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(5394)),a=u(n(5398)),s=u(n(5403)),r=u(n(5408)),o=u(n(5413)),c=u(n(5414)),l=u(n(5415));function u(t){return t&&t.__esModule?t:{default:t}}var d=angular.module("tangerine.mortgageTracker",[a.default.name,r.default.name,s.default.name]).service("mortgageTrackerService",o.default).factory("mortgageTrackerApplicationModelFactory",c.default).factory("mortgageTrackerUserConditionModelFactory",l.default).component("mortgageTracker",i.default);e.default=d,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(5416)),a=d(n(5420)),s=d(n(5423)),r=d(n(5426)),o=d(n(5430)),c=d(n(5434)),l=d(n(5438)),u=d(n(5439));function d(t){return t&&t.__esModule?t:{default:t}}var h=angular.module("tangerine.app.core.components.personalInsights",[]).component("tngPersonalInsightsToggle",i.default).component("tngPersonalInsightsWidget",a.default).component("tngEnhWidgetStory",s.default).component("personalInsightStory",r.default).component("personalInsightsMbox",o.default).component("tngCarouselProgressBar",c.default).service("PersonalInsightsService",l.default).constant("PersonalInsightsConstants",u.default);e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(5440)),a=d(n(5444)),s=d(n(5445)),r=d(n(5446)),o=d(n(5450)),c=d(n(5454)),l=d(n(5457)),u=d(n(5461));function d(t){return t&&t.__esModule?t:{default:t}}var h=angular.module("tangerine.app.core.components.moveMoney",[]).service("MoveMoneyFlowService",a.default).service("MoveMoneyWithdrawalHelperService",s.default).component("tngMoveMoney",i.default).component("tngMoveMoneyDateState",r.default).component("tngMoveMoneyMfOngoingWithdrawalState",c.default).component("whenState",o.default).component("confirmedState",l.default).component("borrowedMoneyState",u.default);e.default=h,t.exports=e.default},,,,,,,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.tpiFormConstants=e}return(0,a.default)(t,[{key:"getThirdPartyInfo",value:function(t){if(!t.third_party_info)return null;var e=angular.copy(t.third_party_info);return e.address&&!e.address.address_line2&&delete e.address.address_line2,e.type===this.tpiFormConstants.TYPES.BUSINESS?delete e.person_info:e.type===this.tpiFormConstants.TYPES.INDIVIDUAL&&(delete e.corporate_info,e.person_info.birth_date&&(e.person_info.birth_date=moment(e.person_info.birth_date).format("YYYY-MM-DD"))),e}}]),t}();e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(528)),a=o(n(0)),s=o(n(2)),r=o(n(367));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,s,r,o,c,l,u,d,h,f){(0,a.default)(this,t),this.$log=e,this.$filter=n,this.customerConstants=i,this.userSettingsConstants=o,this.customersService=s,this.editModalFlowService=r,this.dateService=c,this.localeService=l,this.localeConstants=u,this.ErrorService=d,this.errorConstants=h,this.serviceConstants=f,this.showEditModal=!1,this.displayedInfo=[],this.originalData={},this.resetRequestMonitor()}return(0,s.default)(t,[{key:"$onInit",value:function(){this.editModalFlowService&&this.editModalFlowService.activate()}},{key:"$onDestroy",value:function(){this.editModalFlowService&&this.editModalFlowService.deactivate()}},{key:"$onChanges",value:function(t){this.displayedInfo=[],this.updateInfo(t)}},{key:"isReadyForEdit",value:function(t){return this.displayedInfo.length>=t}},{key:"updateInfo",value:function(t){return this.$log.debug("Updating Component Info..."),this.$log.debug("Binding Changes",t),angular.equals(t.userData.previousValue,t.userData.currentValue)?(this.$log.debug("Component Data has not changed, not updating..."),!1):(this.originalData=angular.copy(this.userData),!0)}},{key:"resetRequestMonitor",value:function(){this.requestMonitor={numPending:0,errors:[]}}},{key:"prepareRequest",value:function(){this.requestMonitor.numPending+=1}},{key:"requestError",value:function(t){var e=this;return this.ErrorService.processError(t,this.errorConstants.AVAILABLE_EVENTS.REQUEST_ERROR).then((function(n){n.code===e.customerConstants.API.RESPONSE_CODES.PININVALID?(e.$log.error("PIN Invalid - response:",n),e.requestMonitor.errors.push("global.errorCodes.PININVALID")):n.code===e.customerConstants.API.RESPONSE_CODES.PROFANITY?(e.$log.error("PROFANITY - response:",n),e.requestMonitor.errors.push("global.errorCodes.MESSAGE_39205")):n.code===e.customerConstants.API.RESPONSE_CODES.INVALID_NICKNAME?(e.$log.error("Invalid Nickname - response:",n),e.requestMonitor.errors.push("global.errorCodes.401")):n.code===e.serviceConstants.STATUS_CODES.MISSING_REQUIRED_FIELD||n.code===e.serviceConstants.STATUS_CODES.INVALID?"details"in t.response_status&&Array.isArray(t.response_status.details)&&(e.$log.error("Missing required field - response:",n),t.response_status.details.forEach((function(t){var n={profanity:new i.default([["legal_instructions.third_party_info.person_info.first_name","global.errorCodes.12008"],["legal_instructions.third_party_info.person_info.last_name","global.errorCodes.12013"],["legal_instructions.third_party_info.relationship_other","global.errorCodes.12004"],["legal_instructions.other_intended_use","global.errorCodes.41107"]])};if(t&&t.field_name&&0===t.field_name.indexOf("customer.restriction"))e.requestMonitor.errors.push(e.$translate.instant("global.errorCodes.RESTRICTED_CIF"));else{var a=n[t.description||t.technical_description];if(a){var s=a.get(t.field_name);e.requestMonitor.errors.push(e.$translate.instant(s))}else{var o=r.default.getEmployerErrorCode(t);o&&e.requestMonitor.errors.push(e.$translate.instant(o))}}}))):n.code===e.serviceConstants.STATUS_CODES.INVALID&&"details"in t.response_status&&Array.isArray(t.response_status.details)&&(e.$log.error("Invalid - response:",n),t.response_status.details.forEach((function(t){if(t.field_name&&0===t.field_name.indexOf("username")){var n=t.technical_description.split(" ")[0],i=Math.floor(9e3*Math.random())+1e3,a=Math.floor(9e3*Math.random())+1e3;e.requestMonitor.errors.push(e.$translate.instant("global.errorCodes.USERNAME_EXISTS_WITH_SUGGESTIONS",{prefix:i+n,suffix:n+a}))}}))),0===e.requestMonitor.errors.length&&e.requestMonitor.errors.push(n.message)}))}},{key:"finishRequest",value:function(){this.requestMonitor.numPending-=1,this.requestMonitor.numPending<=0&&(this.editModalFlowService.gotoNextState(),this.requestMonitor.errors&&this.requestMonitor.errors.length>0&&this.editModalFlowService.showDoneButton())}},{key:"_getControllerName",value:function(){if(this.pageId)return this.pageId.replace(/([A-Z])/g,"_$1").toLowerCase();var t=this.constructor.name.toString(),e=/^([\w]+)controller$/gi.exec(t);return e&&e.length>1?e[1].toLowerCase():this.constructor.name.toLowerCase()}},{key:"showEditModal",get:function(){return this._showEditModal},set:function(t){t?this.editModalFlowService.setBasePath(this._getControllerName()):this.editModalFlowService.clearBasePath(),this._showEditModal=t}}]),t}();c.$inject=["$log","$filter","customerConstants","CustomersService","EditModalFlowService","UserSettingsConstants","DateService","LocaleService","localeConstants","ErrorService","errorConstants","serviceConstants"],e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={BANK_ACCOUNT:"BANK",RRSP:"RRSP",REAL_ESTATE:"REST",INTERNAL_REAL_ESTATE:"IREST",VEHICLE:"VEHS",INVESTMENT:"INVS",OTHER_ASSET:"OTHS",TNG_BANK_ACCOUNT:"IBANK",TNG_RRSP:"IRRSP",TNG_INVESTMENT:"IINVS"},a={LOANS_LEASES:"LOAN",CREDIT_CARDS_LOC:"REVC",MORTGAGE_RENT:"HOUS",ALIMONY_CHILD_SUPPORT:"CHLD",OTHER_LIABILITY:"OTHR",TNG_LOANS:"IRSPL",TNG_CREDIT_ACCOUNT:"ICRDT",TNG_MORTGAGE:"IMRTG",TNG_HELOC:"IHLOC"},s={BANK_ACCOUNTS:{localizationCode:"rspLoan.review.assetCategory.bankAccounts",codes:[i.BANK_ACCOUNT,i.TNG_BANK_ACCOUNT]},PROPERTIES:{localizationCode:"rspLoan.review.assetCategory.properties",codes:[i.REAL_ESTATE]},RRSP:{localizationCode:"rspLoan.review.assetCategory.RRSP",codes:[i.RRSP,i.TNG_RRSP]},VEHICLES:{localizationCode:"rspLoan.review.assetCategory.vehicles",codes:[i.VEHICLE]},INVESTMENTS:{localizationCode:"rspLoan.review.assetCategory.investments",codes:[i.INVESTMENT,i.TNG_INVESTMENT]},OTHER_ASSETS:{localizationCode:"rspLoan.review.assetCategory.otherAssets",codes:[i.OTHER_ASSET]}},r={LOANS_LEASES:{localizationCode:"rspLoan.review.liabilityCategory.loansLeases",codes:[a.LOANS_LEASES,a.TNG_LOANS,a.TNG_HELOC]},CREDIT_CARDS_LOCS:{localizationCode:"rspLoan.review.liabilityCategory.creditCardsLOCs",codes:[a.CREDIT_CARDS_LOC,a.TNG_CREDIT_ACCOUNT]},MORTGAGE_RENT:{localizationCode:"rspLoan.review.liabilityCategory.mortgageRent",codes:[a.MORTGAGE_RENT,a.TNG_MORTGAGE]},ALIMONY_CHILD_SUPPORTS:{localizationCode:"rspLoan.review.liabilityCategory.alimonyChildSupports",codes:[a.ALIMONY_CHILD_SUPPORT]},OTHER_LIABILITIES:{localizationCode:"rspLoan.review.liabilityCategory.otherLiabilities",codes:[a.OTHER_LIABILITY]}};e.default={ASSET_CODES:i,LIABILITY_CODES:a,ASSET_CATEGORIES:s,LIABILITY_CATEGORIES:r},t.exports=e.default},,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={LIVING_DURATION_TYPES:{button:"button",yearAndMonth:"yearAndMonth"},STATES:{INIT_LOADING:{_name:"INIT_LOADING"},CHOOSE_ACCOUNTS:{hideFlowFooterPrimaryTemplate:!0,titleKey:"clientOnboarding.steps.chooseAccounts",parentStateKey:"CHOOSE_ACCOUNTS"},CONFIRM_INFO:{titleKey:"clientOnboarding.steps.confirmIdentity",parentStateKey:"CONFIRM_INFO"},SETUP_ACCOUNT_PREVIEW:{skipInReverse:!0,subFlow:{parentState:"CONFIRM_INFO"}},SETUP_ACCOUNT_FORM:{titleKey:"clientOnboarding.steps.setupAccounts",parentStateKey:"SETUP_ACCOUNT_FORM"},FUND_ACCOUNT:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},SETUP_ACCOUNT_JOINT_ACCOUNT_FORM:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},SETUP_ACCOUNT_TPI_FORM:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},CC_INCOME_DETAILS:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},CC_TERMS_CONDITIONS:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},CC_INCOME_VERIFICATION:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},CC_KBA:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},CC_LIMIT_FORM:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},CC_DECLINED:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},CC_SETUP_REWARDS:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},CC_SETUP_REWARDS_ACCOUNT:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},CC_COLLECT_SIN:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},CC_NEW_SAVINGS_ACCOUNT:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},CC_NEW_SAVINGS_ACCOUNT_TPI:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},CONFIRMATION:{subFlow:{parentState:"SETUP_ACCOUNT_FORM"}},WRAP_UP:{titleKey:"clientOnboarding.steps.wrapUp",parentStateKey:"WRAP_UP"}},ADDRESS_STATUS_CODES:{RENT:"R",OWN:"H",LIVE_WITH_PARENTS:"P"},EMPLOYER_INCOME:{SALARY:"SLRY",BONUS:"BONUS",RETIREMENT:"PENS"},CONTACT_TYPE:{EMAIL:"EMAIL",FAX:"FAX"},ADDRESS_LINE1_PATTERN:/(\S+)\s+(.+)/,CANADA_CTRY_CODE:"CA",ADDRESS_TYPES:{CURRENT:"HOME",PREVIOUS:"PREVIOUS"},ADDITIONAL_INCOMES_LINK_TO_EMPLOYER:{SELF_EMPLOYED:"SELF",PART_TIME:"PTIME"},INCOME_TYPE_SALARY_SERVERCODE:"SLRY"},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s){var r=s.createFn,o=s.updateFn,c=s.isCreatedFn,l=s.errorProcessingFn;(0,i.default)(this,t),this.$log=e,this.$q=n,this.$interval=a,this._createFn=r,this._updateFn=o,this._isCreatedFn=c,this._errorProcessingFn=l,this._callQueue=[],this._currentServiceCall=null}return(0,a.default)(t,[{key:"notifyWhenQueueCleared",value:function(){return this._waitForTurn()}},{key:"saveApplication",value:function(t){var e=this;return this._waitForTurn().then((function(){var n=e._isCreatedFn(),i=n?"UPDATE":"CREATE";e.$log.info("ServiceOrchestrator: _saveApplication: "+i+" call starting");var a=(n?e._updateFn(t):e._createFn(t)).then((function(t){return e.$log.info("ServiceOrchestrator: _saveApplication: "+i+" call SUCCEEDED",t),t})).catch((function(t){throw e.$log.error("ServiceOrchestrator: _saveApplication: "+i+" FAILED",t),e._errorProcessingFn(t),t})).finally((function(){e.$log.info("ServiceOrchestrator: _saveApplication: "+i+" call FINISHED"),e._currentServiceCall=null}));return e._currentServiceCall=a,a}))}},{key:"_waitForTurn",value:function(){var t=this,e=this.$q.defer(),n=this.$interval((function(){t._currentServiceCall||t._callQueue[0]!==n?t.$log.info("ServiceOrchestrator: _waitForTurn: RED"):(t.$log.info("ServiceOrchestrator: _waitForTurn: GREEN"),t._callQueue.splice(0,1),t.$interval.cancel(n),e.resolve())}),100);return this._callQueue.push(n),e.promise}},{key:"dispose",value:function(){var t=this;this.$log.info("ServiceOrchestrator: dispose(): called"),this._callQueue.forEach((function(e){t.$log.info("ServiceOrchestrator: dispose(): canceling an interval promise"),t.$interval.cancel(e)})),this._callQueue=[],this._currentServiceCall=null}},{key:"hasPendingRequests",get:function(){return this._callQueue.length>0||!!this._currentServiceCall}}]),t}();e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(177)),a=d(n(0)),s=d(n(2)),r=d(n(264)),o=d(n(266)),c=d(n(265)),l=d(n(267)),u=n(364);function d(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(t,n,s,o,c,l,u,d,h){(0,a.default)(this,e);var f=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,d,l,h));return f.$window=c,f.$translate=u,f.$log=t,f.STATES={ADD_ACCOUNT:{titleKey:"userSettings.externalAccounts.addExternalAccountContactModal.header.addContact"},REVIEW:{titleKey:"userSettings.externalAccounts.addExternalAccountContactModal.header.review",titleKeyChildOrBISA:"userSettings.externalAccounts.addExternalAccountContactModal.header.reviewCSAorBISA"},CANCEL:{titleKey:"userSettings.externalAccounts.addExternalAccountContactModal.header.cancel"},DELETE:{titleKey:"userSettings.externalAccounts.addExternalAccountContactModal.header.delete"},DELETED:{titleKey:"userSettings.externalAccounts.addExternalAccountContactModal.header.deleted"},VERIFY:{titleKey:"userSettings.externalAccounts.addExternalAccountContactModal.header.verify"},VERIFIED:{titleKey:"userSettings.externalAccounts.addExternalAccountContactModal.header.verified"},VERIFY_FAILED:{titleKey:"userSettings.externalAccounts.failed"},ADDED:{titleKey:"userSettings.externalAccounts.addExternalAccountContactModal.header.completeLink"},ADDED_PRIV:{titleKey:"userSettings.externalAccounts.addExternalAccountContactModal.header.completeLink"},COMPLETE_LINK:{titleKey:"userSettings.externalAccounts.addExternalAccountContactModal.header.completeLink"},SEND_BUS_CHECK:{titleKey:"userSettings.externalAccounts.addExternalAccountContactModal.header.sendBusCheck"},SEND_DIRECT_DEPOSIT:{titleKey:"userSettings.externalAccounts.addExternalAccountContactModal.header.sendDirectDeposit"},INTERSTITIAL_PROCESSING:{titleKey:""},INTERSTITIAL_PROCESSING_DELETE:{titleKey:""}},f.nextStepsIds={busCheck:"busCheck",directDeposit:"directDeposit"},f._initialState=f.STATES.ADD_ACCOUNT,f}return(0,c.default)(e,t),(0,s.default)(e,[{key:"getNextStepsLinks",value:function(){return[{header:"userSettings.externalAccounts.addExternalAccountContactModal.step1Btn.header",subHeader:"userSettings.externalAccounts.addExternalAccountContactModal.step1Btn.desc",id:this.nextStepsIds.busCheck},{header:"userSettings.externalAccounts.addExternalAccountContactModal.step2Btn.header",subHeader:"userSettings.externalAccounts.addExternalAccountContactModal.step2Btn.desc",id:this.nextStepsIds.directDeposit}]}},{key:"onNextStepsLinksClick",value:function(t){var e=this.getNextStepsLinks();e[t].id===this.nextStepsIds.busCheck?this.moveTo(this.STATES.SEND_BUS_CHECK):e[t].id===this.nextStepsIds.directDeposit&&this.moveTo(this.STATES.SEND_DIRECT_DEPOSIT)}},{key:"getASPLink",value:function(){return[{header:"userSettings.externalAccounts.addExternalAccountContactModal.completeLink.msg3header",subHeader:"userSettings.externalAccounts.addExternalAccountContactModal.completeLink.msg3"}]}},{key:"returnToStart",value:function(){this._resetState()}},{key:"_resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.isRecurring=!1,this.BUTTONS={BTN_GRY:new u.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new u.ModalFooterButton(this.BUTTON_TYPES.NEXT,!0,!0),BTN_RED:new u.ModalFooterButton(this.BUTTON_TYPES.DELETE,!1,!0)}}},{key:"_updateUI",value:function(){var t=this.currentState,e=this.BUTTON_TYPES,n=this.BUTTONS,i=this.STATES;switch(n.BTN_GRY.show=!0,n.BTN_GRY.disable=!1,n.BTN_ORG.show=!0,n.BTN_ORG.disable=!1,n.BTN_RED.show=!1,n.BTN_RED.disable=!0,t){case i.ADD_ACCOUNT:n.BTN_GRY.type=e.CANCEL,n.BTN_ORG.type=e.NEXT,n.BTN_ORG.disable=!0,n.BTN_RED.show=!1;break;case i.REVIEW:n.BTN_ORG.type=e.SUBMIT,n.BTN_ORG.show=!0,n.BTN_RED.show=!1,n.BTN_GRY.show=!1;break;case i.INTERSTITIAL_PROCESSING:case i.INTERSTITIAL_PROCESSING_DELETE:n.BTN_ORG.show=!1,n.BTN_RED.show=!1,n.BTN_GRY.show=!1;break;case i.CANCEL:n.BTN_GRY.type=e.CANCEL,n.BTN_ORG.type=e.DELETE;break;case i.DELETE:n.BTN_ORG.show=!1,n.BTN_GRY.show=!0,n.BTN_GRY.disable=!1,n.BTN_GRY.type=e.CANCEL,n.BTN_RED.show=!0,n.BTN_RED.disable=!0,n.BTN_RED.type=e.DELETE;break;case i.VERIFY:n.BTN_GRY.show=!0,n.BTN_GRY.disable=!1,n.BTN_GRY.type=e.CANCEL,n.BTN_ORG.type=e.VERIFY,n.BTN_ORG.disable=!0,n.BTN_RED.show=!1;break;case i.VERIFIED:n.BTN_GRY.show=!1,n.BTN_ORG.type=e.DONE,n.BTN_ORG.disable=!1,n.BTN_RED.show=!1;break;case i.ADDED:case i.ADDED_PRIV:case i.DELETED:case i.VERIFY_FAILED:n.BTN_GRY.show=!1,n.BTN_ORG.type=e.DONE,n.BTN_ORG.disable=!1,n.BTN_RED.show=!1;break;case i.SEND_BUS_CHECK:case i.SEND_DIRECT_DEPOSIT:n.BTN_GRY.type=e.BACK,n.BTN_ORG.type=e.DONE,n.BTN_ORG.disable=!1,n.BTN_RED.show=!1;break;case i.COMPLETE_LINK:n.BTN_GRY.show=!1,n.BTN_ORG.type=e.DONE,n.BTN_ORG.disable=!1,n.BTN_RED.show=!1}}},{key:"goToVerifyFailed",value:function(){this.moveTo(this.STATES.VERIFY_FAILED)}},{key:"gotoNextState",value:function(){var t=this.currentState,e=this.STATES;switch(t){case e.ADD_ACCOUNT:this.moveTo(e.REVIEW);break;case e.REVIEW:this.moveTo(e.INTERSTITIAL_PROCESSING);break;case e.INTERSTITIAL_PROCESSING:this.moveTo(e.ADDED);break;case e.VERIFY:this.moveTo(e.VERIFIED);break;case e.VERIFIED:this.moveTo(e.ADDED);break;case e.CANCEL:this.moveTo(e.DELETED);break;case e.DELETE:this.moveTo(e.INTERSTITIAL_PROCESSING_DELETE);break;case e.DELETED:break;case e.INTERSTITIAL_PROCESSING_DELETE:this.moveTo(e.DELETED);break;case e.ADDED:break;default:this.$log.debug("Unknown or unrecognized state:",t)}}},{key:"_getAnalyticsID",value:function(){return"externalaccount/add"}}]),e}(l.default);h.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","$translate","$rootScope","AnalyticsService"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1904)),a=s(n(1905));function s(t){return t&&t.__esModule?t:{default:t}}n(1906);var r={template:i.default,controller:a.default,bindings:{customer:"<",account:"<",useGenericFormValidation:"<?",flowService:"<?",onUpdateNextButton:"&?",showHaveThirdParty:"<?",onEnableNext:"&",hideHeader:"<?",ngModel:"<?",repeatIndex:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="container"> <section class="c-tpi medium-width-section"> <ng-form name="$ctrl.form" class="c-tpi__form narrow-width-section" novalidate> <div ng-if="!$ctrl.showHaveThirdParty"> <h1 ng-if="!$ctrl.hideHeader">{{ ::\'clientOnboarding.tpiForm.heading\' | translate}}</h1> <p ng-if="!$ctrl.hideHeader" class="medium">{{ ::\'clientOnboarding.setupAccountForm.antiMoneyLaundering\' | translate}}</p> </div> <div class="field__group--inline top-margin-medium" ng-if="$ctrl.showHaveThirdParty"> <div class="field"> <tng-yes-no-toggle-input input-id="{{ ::$ctrl.repeatIndex }}_thirdParty" tng-model="$ctrl.account.third_party" tng-required="true" tng-change="$ctrl.showTPIform()"></tng-yes-no-toggle-input> </div> </div> <div ng-show="$ctrl.showTpiFormElements"> <div class="field" ng-if="$ctrl.showTpiFormElements"> <label actionable-id="tpiForm_type_label" class="heading--sub3 top-margin-large">{{ ::\'clientOnboarding.tpiForm.labels.individualOrBusiness\' | translate }}</label> </div> <div class="c-basic-info-form__primary-phone-select-wrapper field__group--wrap" ng-if="$ctrl.showTpiFormElements"> <div class="field"> <input actionable-id="{{ ::$ctrl.repeatIndex }}_tpiForm_type_individual" type="radio" required validation-order="1" class="input input--tangerine-radio" ng-change="$ctrl.onTpiTypeSelected()" ng-model="$ctrl.account.third_party_info.type" ng-value="$ctrl.TYPES.INDIVIDUAL"/> <label for="{{ ::$ctrl.repeatIndex }}_tpiForm_type_individual"> {{ ::\'clientOnboarding.tpiForm.labels.individual\' | translate }} </label> </div> <div class="field"> <input actionable-id="{{ ::$ctrl.repeatIndex }}_tpiForm_type_business" type="radio" class="input field input--tangerine-radio" ng-change="$ctrl.onTpiTypeSelected()" ng-model="$ctrl.account.third_party_info.type" ng-value="$ctrl.TYPES.BUSINESS"/> <label for="{{ ::$ctrl.repeatIndex }}_tpiForm_type_business"> {{ ::\'clientOnboarding.tpiForm.labels.business\' | translate }} </label> </div> </div> <div ng-messages="$ctrl.form[$ctrl.repeatIndex + \'_tpiForm_type_individual\'].$error" ng-show="$ctrl.form[$ctrl.repeatIndex + \'_tpiForm_type_individual\'].$touched" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> </div> <div ng-show="$ctrl.form.tpiForm_type.$error.required && $ctrl.form.tpiForm_type.$touched" class="field__error"> {{ ::\'clientOnboarding.tpiForm.errors.required\' | translate }} </div> <section class="x-narrow-width-section top-margin-large"> <div class="field" ng-if="$ctrl.account.third_party_info.type === $ctrl.TYPES.INDIVIDUAL || $ctrl.account.third_party_info.type === $ctrl.TYPES.BUSINESS "> <label actionable-id="{{ ::$ctrl.pageId }}_relationship_label" class="top-margin-large">{{ ::\'clientOnboarding.tpiForm.labels.relationship\' | translate}}</label> <div class="top-margin-small"> <tng-select-autocomplete input-id="{{ ::$ctrl.pageId }}_relationship" ng-model="$ctrl.account.third_party_info.relationship" ng-required="true" validation-order="2" options="$ctrl.relationships[$ctrl.account.third_party_info.type]" option-label-key="name" option-value-key="code" is-static="true" placeholder="clientOnboarding.tpiForm.placeholders.select"></tng-select-autocomplete> </div> </div> </section> <div class="field" ng-if="$ctrl.account.third_party_info.relationship === \'OTHER\'"> <label actionable-id="{{ ::$ctrl.pageId }}_specifyRelationship_label" class="top-margin-small">{{ ::\'clientOnboarding.tpiForm.labels.specifyRelationship\' | translate}}</label> <input actionable-id="{{ ::$ctrl.pageId }}_specifyRelationship" class="input" type="text" validation-order="3" ng-minlength="2" ng-required="true" maxlength="60" ng-change="$ctrl.validateName($ctrl.form.tpiForm_specifyRelationship)" ng-model-options="{ updateOn: \'blur\' }" ng-model="$ctrl.account.third_party_info.relationship_other"/> <div class="field__error" ng-messages="$ctrl.form.tpiForm_specifyRelationship.$error" ng-show="$ctrl.form.tpiForm_specifyRelationship.$invalid"> <p ng-message="required" ng-show="$ctrl.form.tpiForm_specifyRelationship.$touched" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.required\' | translate"> </p> <p ng-message="minlength" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.minlength\' | translate"> </p> <p ng-message="validateIfInvalidChars" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.invalidCharsInRelationship\' | translate"> </p> <p ng-message="consecutiveSpecialChars" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.consecutiveSpecialCharsInRelationship\' | translate"> </p> </div> </div> <div class="top-margin-large" ng-if="$ctrl.account.third_party_info.type === $ctrl.TYPES.INDIVIDUAL"> <div class="field"> <label actionable-id="tpiForm_personInfo_salutation_label">{{ ::\'clientOnboarding.basicInfoForm.name\' | translate}}</label> <p class="small">{{ ::\'clientOnboarding.tpiForm.pleaseUseLegalName\' | translate }}</p> <div class="x-narrow-width-section top-margin-medium"> <tng-salutation-select is-required="true" on-update="$ctrl.updateSalutation(salutation)" input-name="tpiForm_personInfo_salutation" init-value="$ctrl.account.third_party_info.person_info.title" validation-order="4"> </tng-salutation-select> <div ng-show="$ctrl.form.tpiForm_personInfo_salutation.$error.required && $ctrl.form.tpiForm_personInfo_salutation.$touched" class="field__error">{{ ::\'clientOnboarding.tpiForm.errors.required\' | translate }}</div> </div> </div> <section class="narrow-width-section"> <div class="field" actionable-id="{{ ::$ctrl.pageId }}_personInfo_firstName_label"> <input actionable-id="{{ ::$ctrl.pageId }}_personInfo_firstName" validation-order="5" class="input top-margin-small" type="text" ng-minlength="2" ng-required="true" maxlength="32" ng-change="$ctrl.validateName($ctrl.form.tpiForm_personInfo_firstName, true)" ng-model-options="{ updateOn: \'blur\' }" ng-model="$ctrl.account.third_party_info.person_info.first_name" placeholder="{{ ::\'clientOnboarding.basicInfoForm.placeholders.firstName\' | translate }}"/> <div class="field__error" ng-messages="$ctrl.form.tpiForm_personInfo_firstName.$error" ng-show="$ctrl.form.tpiForm_personInfo_firstName.$invalid"> <p ng-message="required" ng-show="$ctrl.form.tpiForm_personInfo_firstName.$touched" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.required\' | translate"> </p> <p ng-message="minlength" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.minlength\' | translate"> </p> <p ng-message="validateIfNumber" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.numbersInFirstName\' | translate"> </p> <p ng-message="validateIfInvalidChars" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.invalidCharsInFirstName\' | translate"> </p> <p ng-message="consecutiveSpecialChars" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.consecutiveSpecialCharsInFirstName\' | translate"> </p> </div> </div> </section> <section class="narrow-width-section"> <div class="field" actionable-id="{{ ::$ctrl.pageId }}_personInfo_lastName_label"> <input actionable-id="{{ ::$ctrl.pageId }}_personInfo_lastName" validation-order="6" class="input top-margin-small" type="text" ng-minlength="2" ng-required="true" maxlength="32" ng-change="$ctrl.validateName($ctrl.form.tpiForm_personInfo_lastName, true)" ng-model-options="{ updateOn: \'blur\' }" ng-model="$ctrl.account.third_party_info.person_info.last_name" placeholder="{{ ::\'clientOnboarding.basicInfoForm.placeholders.lastName\' | translate }}"/> <div class="field__error" ng-messages="$ctrl.form.tpiForm_personInfo_lastName.$error" ng-show="$ctrl.form.tpiForm_personInfo_lastName.$invalid"> <p ng-message="required" ng-show="$ctrl.form.tpiForm_personInfo_lastName.$touched" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.required\' | translate"> this is showing why </p> <p ng-message="minlength" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.minlength\' | translate"> </p> <p ng-message="validateIfNumber" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.numbersInLastName\' | translate"> </p> <p ng-message="validateIfInvalidChars" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.invalidCharsInLastName\' | translate"> </p> <p ng-message="consecutiveSpecialChars" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.consecutiveSpecialCharsInLastName\' | translate"> </p> </div> </div> </section> <section class="narrow-width-section top-margin-large"> <div class="field"> <label actionable-id="{{$ctrl.pageId}}_birthDate_label" ng-bind-html="::\'clientOnboarding.basicInfoForm.dateOfBirth\' | translate"></label> <tng-date-input validation-order="7" date-model="$ctrl.account.third_party_info.person_info.birth_date" input-id="{{$ctrl.pageId}}_birthDate" is-date-of-birth="true" is-required="true" max-date="$ctrl.MAX_BIRTH_DATE" person-descriptor="::\'clientOnboarding.tpiForm.labels.individual\' | translate"></tng-date-input> </div> </section> </div> <div class="top-margin-large" ng-if="$ctrl.account.third_party_info.type === $ctrl.TYPES.BUSINESS"> <div class="field"> <label>{{ ::\'clientOnboarding.tpiForm.labels.businessName\' | translate }}</label> <p class="small" ng-show="false">{{ ::\'clientOnboarding.tpiForm.pleaseUseLegalBusinessName\' | translate }}</p> <section class="narrow-width-section"> <input actionable-id="{{ ::$ctrl.pageId }}_corporateInfo_name" class="input top-margin-small" type="text" ng-minlength="2" ng-required="true" validation-order="8" maxlength="40" ng-change="$ctrl.validateName($ctrl.form.tpiForm_corporateInfo_name)" ng-model-options="{ updateOn: \'blur\' }" ng-model="$ctrl.account.third_party_info.corporate_info.name" placeholder="{{ ::\'clientOnboarding.tpiForm.placeholders.businessName\' | translate }}"/> </section> <div class="field__error" ng-messages="$ctrl.form.tpiForm_corporateInfo_name.$error" ng-show="$ctrl.form.tpiForm_corporateInfo_name.$invalid"> <p ng-message="required" ng-show="$ctrl.form.tpiForm_corporateInfo_name.$touched" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.required\' | translate"> </p> <p ng-message="minlength" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.minlength\' | translate"> </p> <p ng-message="validateIfInvalidChars" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.invalidCharsInBusinessName\' | translate"> </p> <p ng-message="consecutiveSpecialChars" ng-bind-html=" ::\'clientOnboarding.tpiForm.errors.consecutiveSpecialCharsInBusinessName\' | translate"> </p> </div> <div class="narrow-width-section top-margin-small"> <tng-select-autocomplete input-id="{{ ::$ctrl.pageId }}_corporateInfo_industry" ng-model="$ctrl.account.third_party_info.corporate_info.industry" ng-required="true" validation-order="9" options="$ctrl.businessIndustries" option-label-key="name" option-value-key="code" is-static="true" placeholder="clientOnboarding.tpiForm.labels.businessIndustry"></tng-select-autocomplete> </div> <div class="narrow-width-section top-margin-small" ng-show="$ctrl.account.third_party_info.corporate_info.industry"> <tng-select-autocomplete input-id="{{ ::$ctrl.pageId }}_corporateInfo_natureOfBusiness" ng-model="$ctrl.account.third_party_info.corporate_info.nature_of_business" ng-required="true" validation-order="10" options="$ctrl.businessIndustriesByCode[$ctrl.account.third_party_info.corporate_info.industry].data" option-label-key="name" option-value-key="code" is-static="true" placeholder="clientOnboarding.tpiForm.labels.natureOfBusiness"></tng-select-autocomplete> </div> <div class="narrow-width-section top-margin-small"> <tng-select-autocomplete input-id="{{ ::$ctrl.pageId }}_corporateInfo_type" ng-model="$ctrl.account.third_party_info.corporate_info.type" ng-required="true" validation-order="11" options="$ctrl.corporationTypes" option-label-key="name" option-value-key="code" is-static="true" placeholder="clientOnboarding.tpiForm.labels.businessType"></tng-select-autocomplete> </div> </div> <div class="narrow-width-section field" ng-if="$ctrl.account.third_party_info.corporate_info.type === $ctrl.TYPES.CORPORATION"> <label class="top-margin-large">{{ ::\'clientOnboarding.tpiForm.labels.corporationNumber\' | translate}}</label> <input actionable-id="{{ ::$ctrl.pageId }}_corporateInfo_incorporationNumber" class="input top-margin-small" type="text" ng-required="true" validation-order="12" maxlength="25" ng-model-options="{ updateOn: \'blur\' }" ng-model="$ctrl.account.third_party_info.corporate_info.incorporation_number" placeholder="{{ ::\'clientOnboarding.tpiForm.placeholders.corporationNumber\' | translate }}"/> <div ng-show="$ctrl.form.tpiForm_corporateInfo_incorporationNumber.$error.required && $ctrl.form.tpiForm_corporateInfo_incorporationNumber.$touched " class="field__error">{{ ::\'clientOnboarding.tpiForm.errors.required\' | translate }}</div> </div> <div class="narrow-width-section field" ng-if="$ctrl.account.third_party_info.corporate_info.type === $ctrl.TYPES.CORPORATION"> <label class="top-margin-large">{{ ::\'clientOnboarding.tpiForm.labels.incorporationPlace\' | translate}}</label> <div class="top-margin-medium"> <tng-select-autocomplete input-id="{{ ::$ctrl.pageId }}_corporateInfo_incorporationPlace" ng-model="$ctrl.account.third_party_info.corporate_info.incorporation_place" ng-required="true" validation-order="13" options="$ctrl.incorporationPlaces" option-label-key="name" option-value-key="code" is-static="true" placeholder="clientOnboarding.tpiForm.placeholders.select"></tng-select-autocomplete> </div> </div> <div class="narrow-width-section field" ng-if="$ctrl.account.third_party_info.corporate_info.type === $ctrl.TYPES.CORPORATION\n                && $ctrl.account.third_party_info.corporate_info.incorporation_place === \'OTHER\'"> <label>{{ ::\'clientOnboarding.tpiForm.labels.corporationCountry\' | translate}}</label> <tng-select-autocomplete alternate-light="false" ng-if="$ctrl.countries" ng-model="$ctrl.account.third_party_info.corporate_info.incorporation_place_other" ng-required="true" validation-order="14" options="$ctrl.countries" option-label-key="name" placeholder="{{::\'global.addressFormFields.placeholders.country\' | translate }}" input-id="{{ ::$ctrl.pageId }}_corporateInfo_incorporationCountry" select-type="$ctrl.selectConstants.SELECT_TYPE.SIMPLE_FILTERED" sort-alphabetically="true"> </tng-select-autocomplete> </div> </div> <div class="narrow-width-section field" ng-if="$ctrl.account.third_party_info.type"> <label class="top-margin-large">{{ ::\'clientOnboarding.basicInfoForm.address\' | translate }}</label> <tng-address-form-fields page-id="tpiForm" is-required="true" validation-order="15" suite-max-length="8" errors="$ctrl.account.errors.legal_instructions.third_party_info.address" address-object="$ctrl.account.third_party_info.address" use-tpi-address-pattern="$ctrl.useTpiAddressPattern" hide-address-line2="true" show-street-number="true" province-or-state-placeholder-code="global.addressFormFields.placeholders.provinceOrState" postal-code-placeholder-code="global.addressFormFields.placeholders.zipOrPostalCode"></tng-address-form-fields> </div> <div ng-if="$ctrl.loadedReferenceData && $ctrl.account.third_party_info.type === $ctrl.TYPES.INDIVIDUAL"> <div class="narrow-width-section field top-margin-large"> <label>{{ ::\'clientOnboarding.tpiForm.labels.industryAndOccupation\' | translate }}</label> <p class="small" ng-show="false">{{ ::\'clientOnboarding.tpiForm.labels.industryAndOccupationSubHeader\' | translate }}</p> <div class="top-margin-small"> <tng-select-autocomplete input-id="{{ ::$ctrl.pageId }}_personInfo_industry" ng-model="$ctrl.selectedIndividualIndustry" ng-model-set-raw-object="true" ng-required="true" validation-order="16" options="$ctrl.individualIndustries" option-label-key="name" on-select="$ctrl.onIndividualIndustrySelected()" is-static="true" placeholder="clientOnboarding.tpiForm.labels.industry"></tng-select-autocomplete> </div> <div class="top-margin-small"> <tng-select-autocomplete input-id="{{ ::$ctrl.pageId }}_personInfo_occupation" ng-model="$ctrl.account.third_party_info.person_info.occupation" ng-required="true" validation-order="17" options="$ctrl.selectedIndividualIndustry.data" option-label-key="name" option-value-key="code" is-static="true" placeholder="clientOnboarding.tpiForm.labels.occupation"></tng-select-autocomplete> </div> </div> </div> </div> </ng-form> </section> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=n(67);function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,r,o,c,l){(0,i.default)(this,t),this.$scope=e,this.$log=n,this.anchorService=a,this.personNameValidation=s.personNameValidation,this.businessNameValidation=s.businessNameValidation,this.otherRelationShipValidation=s.otherRelationShipValidation,this.havingNumbersPattern=s.havingNumbersPattern,this.normalAndAMLCharsPattern=s.normalAndAMLCharsPattern,this.normalAndAMLCharsAndNumbersPattern=s.normalAndAMLCharsAndNumbersPattern,this.twoOrMoreConsecutiveAMLCharsPattern=s.twoOrMoreConsecutiveAMLCharsPattern,this.ReferenceDataService=r,this.dateConstants=o,this.TYPES=c.TYPES,this.selectConstants=l}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;if(this.form={},this.countries=[],this.MAX_BIRTH_DATE=this.dateConstants.DEFAULT_MAX_DATE_OF_BIRTH_TWELVE,this.useTpiAddressPattern=!0,this.pageId="tpiForm",this.showHaveThirdParty=void 0!==this.showHaveThirdParty&&this.showHaveThirdParty,this.showTpiFormElements=!(void 0!==this.showHaveThirdParty&&this.showHaveThirdParty),this.repeatIndex=void 0!==this.repeatIndex?this.repeatIndex:0,this.$log.debug("AD || TpiForm.COMPONENT || this.form:: ",this.form),this.account.third_party_info||(this.account.third_party_info={}),this.account.third_party_info.address||(this.account.third_party_info.address={}),this.account.third_party_info.person_info||(this.account.third_party_info.person_info={birth_date:null}),this.account.third_party_info.corporate_info||(this.account.third_party_info.corporate_info={}),this.account.third_party&&(this.showTpiFormElements=!0),this._getReferenceData(),this.useGenericFormValidation){this.onEnableNext({enable:!0}),this.flowService.currentStateValidator=function(){return(0,s.genericFormValidator)({form:t.form,anchorService:t.anchorService})}}this.nextEnabled(),this.$scope.$watch("$ctrl.form.$valid",(function(){t.nextEnabled()})),(this.account.isCsa||this.account.isGic)&&this.onUpdateNextButton&&this.onUpdateNextButton({isSubmit:!1})}},{key:"showTPIform",value:function(){this.showTpiFormElements=this.account.third_party,this.nextEnabled()}},{key:"updateSalutation",value:function(t){this.account.third_party_info.person_info.title=t}},{key:"onTpiTypeSelected",value:function(){this.account.third_party_info.type===this.TYPES.BUSINESS?this.account.third_party_info.address.address_type=this.TYPES.BUSINESS:this.account.third_party_info.address.address_type=this.TYPES.HOME}},{key:"_loadIndividualIndustry",value:function(){var t=this;this.account.third_party_info.person_info.industry&&(this.selectedIndividualIndustry=this.individualIndustries.find((function(e){return e.code===t.account.third_party_info.person_info.industry})))}},{key:"onIndividualIndustrySelected",value:function(){this.selectedIndividualIndustry?this.account.third_party_info.person_info.industry=this.selectedIndividualIndustry.code:this.account.third_party_info.person_info.industry=null,this.account.third_party_info.person_info.occupation=null}},{key:"_getReferenceData",value:function(){var t=this;this.loadedReferenceData=!1;var e=this.ReferenceDataService.TYPES;return this.relationships={},this.ReferenceDataService.getDataByType([e.TPI_INDIVIDUAL_RELATIONSHIPS,e.TPI_BUSINESS_RELATIONSHIPS,e.TPI_INDIVIDUAL_INDUSTRIES,e.TPI_BUSINESS_INDUSTRIES,e.TPI_BUSINESS_TYPES,e.TPI_INCORPORATION_PLACES,e.COUNTRIES]).then((function(n){t.relationships.INDIVIDUAL=n[e.TPI_INDIVIDUAL_RELATIONSHIPS],t.relationships.BUSINESS=n[e.TPI_BUSINESS_RELATIONSHIPS],t.individualIndustries=n[e.TPI_INDIVIDUAL_INDUSTRIES],t.businessIndustries=n[e.TPI_BUSINESS_INDUSTRIES],t.corporationTypes=n[e.TPI_BUSINESS_TYPES],t.incorporationPlaces=n[e.TPI_INCORPORATION_PLACES],t.countries=n[t.ReferenceDataService.TYPES.COUNTRIES],t.countries=t.countries.sort((function(t,e){var n=t.name.toLowerCase(),i=e.name.toLowerCase();return n.localeCompare(i)})),t._aliasBusinessIndustries(),t._loadIndividualIndustry(),t.loadedReferenceData=!0}))}},{key:"_aliasBusinessIndustries",value:function(){var t=this;this.businessIndustriesByCode={},this.businessIndustries.forEach((function(e){t.businessIndustriesByCode[e.code]=e}))}},{key:"nextEnabled",value:function(){if(this.form){var t=this.form.$valid;void 0===this.account.third_party||this.account.third_party?t&&this.isIndividual()?(this.validateName(this.form.tpiForm_personInfo_firstName,!0),this.validateName(this.form.tpiForm_personInfo_lastName,!0),this.validateName(this.form.tpiForm_specifyRelationship),this.$log.debug("isIndividual- this.onEnableNext({ enable: --\x3e})",this.form.$valid),this.onEnableNext({enable:this.form.$valid}),this.$log.debug("Tpi invoking Parent this.onEnableNext({ enable }) with "+t)):t&&this.isBusiness()?(this.validateName(this.form.tpiForm_corporateInfo_name),this.validateName(this.form.tpiForm_specifyRelationship),this.onEnableNext({enable:this.form.$valid}),this.$log.debug("isBusiness- this.onEnableNext({ enable: --\x3e})",this.form.$valid)):this.onEnableNext({enable:!1}):(this.onEnableNext({enable:!0}),this.$log.debug("third_party NO - so Tpi invoking Parent this.onEnableNext({ enable: true })")),this.useGenericFormValidation&&this.onEnableNext({enable:!0})}}},{key:"validateName",value:function(t,e){if(t){var n=t.$viewValue;n&&(e&&t.$setValidity("validateIfNumber",!this.havingNumbersPattern.test(n)),t.$setValidity("validateIfInvalidChars",!this.normalAndAMLCharsPattern.test(n)),t.$setValidity("validateIfInvalidChars",!this.twoOrMoreConsecutiveAMLCharsPattern.test(n)))}}},{key:"isBusiness",value:function(){return this.account.third_party_info.type&&this.account.third_party_info.type===this.TYPES.BUSINESS}},{key:"isIndividual",value:function(){return this.account.third_party_info.type&&this.account.third_party_info.type===this.TYPES.INDIVIDUAL}}]),t}();o.$inject=["$scope","$log","AnchorService","ReferenceDataService","tngDateSelectorConstants","tpiFormConstants","tngSelectAutocompleteConstants"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={TYPES:{INDIVIDUAL:"INDIVIDUAL",BUSINESS:"BUSINESS",CORPORATION:"CORPORATION",HOME:"HOME"},INCORPORATION_PLACE:{CANADA:"CANADA",PROVINCE:"PROVINCE",OTHER:"OTHER"}},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={accountChartData:{210:[{name:"mutualFund.recommend.canadianBonds",key:"canadianBonds",amount:"70",color:"#26CD88"},{name:"mutualFund.recommend.canadianStocks",key:"canadianStocks",amount:"10",color:"#C666E7"},{name:"mutualFund.recommend.usStocks",key:"usStocks",amount:"10",color:"#1EABEF"},{name:"mutualFund.recommend.internationalStocks",key:"internationalStocks",amount:"10",color:"#96C818"}],220:[{name:"mutualFund.recommend.canadianBonds",key:"canadianBonds",amount:"40",color:"#26CD88"},{name:"mutualFund.recommend.canadianStocks",key:"canadianStocks",amount:"20",color:"#C666E7"},{name:"mutualFund.recommend.usStocks",key:"usStocks",amount:"20",color:"#1EABEF"},{name:"mutualFund.recommend.internationalStocks",key:"internationalStocks",amount:"20",color:"#96C818"}],230:[{name:"mutualFund.recommend.canadianBonds",key:"canadianBonds",amount:"25",color:"#26CD88"},{name:"mutualFund.recommend.canadianStocks",key:"canadianStocks",amount:"25",color:"#C666E7"},{name:"mutualFund.recommend.usStocks",key:"usStocks",amount:"25",color:"#1EABEF"},{name:"mutualFund.recommend.internationalStocks",key:"internationalStocks",amount:"25",color:"#96C818"}],235:[{name:"mutualFund.recommend.canadianDividendEquity",key:"canadianDividendEquity",amount:"50",color:"#26CD88"},{name:"mutualFund.recommend.usDividendEquity",key:"usDividendEquity",amount:"25",color:"#C666E7"},{name:"mutualFund.recommend.internationalDividendEquity",key:"internationalDividendEquity",amount:"25",color:"#1EABEF"}],240:[{name:"mutualFund.recommend.canadianStocks",key:"canadianStocks",amount:"33.3",color:"#26CD88"},{name:"mutualFund.recommend.usStocks",key:"usStocks",amount:"33.3",color:"#C666E7"},{name:"mutualFund.recommend.internationalStocks",key:"internationalStocks",amount:"33.3",color:"#1EABEF"}]},applicationStatus:{INC:"INC",SUB:"SUB",WAIT:"WAIT"},booleanValues:{Y:"Y",N:"N"},borrowedMoneyFrom:{LINE_OF_CREDIT:"LOC",CREDIT_CARD:"CC",MORTGAGE_TERM_LOAN:"MORTGAGE_TERM",RRSP_LOAN:"RRSP",BORROWED_FROM_FAMILY_FRIENDS:"BORROWED_FROM_FAMILY_FRIENDS"},defaultValues:{objective:"GROWTH",risk:"HIGH",knowledge:"EXTENSIVE"},incomeOptions:[{label:"mutualFund.profile.incomeOptions.0",value:0},{label:"mutualFund.profile.incomeOptions.1",value:25e3},{label:"mutualFund.profile.incomeOptions.2",value:5e4},{label:"mutualFund.profile.incomeOptions.3",value:75e3},{label:"mutualFund.profile.incomeOptions.4",value:1e5},{label:"mutualFund.profile.incomeOptions.5",value:15e4},{label:"mutualFund.profile.incomeOptions.6",value:2e5}],knowledge:{TYPES:{LIMITED:"LIMITED",MODERATE:"MODERATE",EXTENSIVE:"EXTENSIVE"}},networthOptions:[{label:"mutualFund.profile.networthOptions.0",value:0},{label:"mutualFund.profile.networthOptions.1",value:25e3},{label:"mutualFund.profile.networthOptions.2",value:5e4},{label:"mutualFund.profile.networthOptions.3",value:1e5},{label:"mutualFund.profile.networthOptions.4",value:25e4}],objective:{TYPES:{GROWTH:"GROWTH",BALANCED:"BALANCED",SAFETY:"SAFETY",INCOME:"INCOME"}},risk:{TYPES:{LOW:"LOW",MEDIUMLOW:"LOW TO MEDIUM",MEDIUM:"MEDIUM",MEDIUMHIGH:"MEDIUM TO HIGH",HIGH:"HIGH"}},sortedIntendedUses:["INCGE","LIQIN","LONIN","OTHER","SHOIN"],states:{INCOMPLETE_APP_CONFIRM_INFO:{_name:"incomplete_app_confirm_info",subFlow:{parentState:"CONFIRM_INFO"}},INTRO:{_name:"intro"},PROFILE:{_name:"profile"},KNOWLEDGE:{_name:"knowledge"},OBJECTIVE:{_name:"objective"},RISK:{_name:"risk"},RECOMMENDATION:{_name:"recommendation"},SETUP_PORTFOLIO:{_name:"setup_portfolio"},TPI:{_name:"third_party_info"},EMPLOYMENT:{_name:"employment"},JOINT_ACCOUNT_HOLDER:{_name:"joint_account_holder"},SPOUSAL_RSP:{_name:"spousal_rsp"},FUNDFROM:{_name:"fund_from"},AMOUNT:{_name:"amount"},BORROWED_MONEY:{_name:"borrowed_money"},REVIEW:{_name:"review"}},timeHorizonOptions:[{label:"mutualFund.profile.timeHorizonOptions.0",value:0},{label:"mutualFund.profile.timeHorizonOptions.1",value:1},{label:"mutualFund.profile.timeHorizonOptions.2",value:4},{label:"mutualFund.profile.timeHorizonOptions.3",value:6},{label:"mutualFund.profile.timeHorizonOptions.4",value:10}]};e.default=i,t.exports=e.default},,,,,,,,,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1924));n(1925);var a=s(n(1926));function s(t){return t&&t.__esModule?t:{default:t}}var r={template:i.default,controller:a.default,bindings:{transactions:"<",displayCategoryIcon:"<?",displayCategoryDescription:"<?",transactionToRecategorize:"<?",displayQuickRecategorizationPopup:"<?",onBubbleLinkClick:"&",onBubbleDeny:"&",onBubbleConfirm:"&",onTransactionView:"&",onCategoriesEdit:"&",onTransactionIconClick:"&",type:"<",isPendingTransactionsList:"<",selectAttribute:"<",showAll:"<",iconColor:"<",accountDetails:"<",selectedCsaType:"<",customHeaderType:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div> <div tng-list-with-focusable-elements class="{{:: \'c-transactions-list c-transactions-list--\' + $ctrl.type + ($ctrl.isListHoverable() ? \' c-transactions-list--hoverable\' : \'\') }}" ng-if="$ctrl.shouldDisplayDefaultTransactionList() && !$ctrl.isPendingTransactionsList"> <tng-transactions-list-header type="::$ctrl.type" ng-show="$ctrl.transactions.length > 0" is-cc="::($ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.CREDIT_CARD)\n      || $ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.CREDIT_CARD_GOAL))" header="::$ctrl.header" selected-csa-type="$ctrl.selectedCsaType"> </tng-transactions-list-header> <div class="c-transactions-list__list"> <div class="c-transactions-list__tile" ng-repeat="transaction in $ctrl.transactions" ng-if="::(!transaction.is_split_child || transaction.hasIncompleteCategoryList || $ctrl.showAll)" ng-click="$ctrl.onTransactionView({transaction: transaction});" ng-class="{\'c-transactions-list__tile--focused-tile\': $ctrl.listService.shouldDisplayRecategorizationPopup($ctrl.displayQuickRecategorizationPopup, $ctrl.transactionToRecategorize, transaction)}" id="c-transactions-list__tile_{{transaction.id}}"> <div class="c-transactions-list__tile-grid"> <tng-transaction-date-column class="c-transactions-list__date" should-display-on-mobile="::$ctrl.listService.shouldDisplayDateBlock($index, $ctrl.transactions, $ctrl.dateFieldLabel)" transaction="::transaction"> </tng-transaction-date-column> <div class="{{::\'c-transactions-list__transaction\' + ($ctrl.shouldDisplayShrinkedTransactionColumn() ? \' c-transactions-list__transaction--shrinked\' : \'\') }}"> <div class="c-transactions-list__category" ng-if="::(transaction.category_id && $ctrl.displayCategoryIcon)" ng-click="$event.stopPropagation();"> <a actionable-id="transaction-list-transaction_click" href="" ng-click="$ctrl.onTransactionIconClick({transaction: transaction});"> <tng-category-icon icon="{{:: $ctrl.listService.getTransactionIcon(transaction) }}" discount="{{::$ctrl.calculateDiscount(transaction)}}" discount-size="18" color="{{$ctrl.listService.getCategoryIconColor($ctrl.iconColor, transaction)}}" size="32"> </tng-category-icon> </a> <tng-recategorization-popup z-index="100" tng-click-outside="$ctrl.onBubbleDeny()" ng-if="$ctrl.listService.shouldDisplayRecategorizationPopup($ctrl.displayQuickRecategorizationPopup, $ctrl.transactionToRecategorize, transaction)" transaction="::transaction" on-bubble-deny="$ctrl.onBubbleDeny()" on-categories-edit="$ctrl.onCategoriesEdit({transaction: transaction})" on-bubble-confirm="$ctrl.onBubbleConfirm({category: category, transaction: transaction, options: options })" on-bubble-link-click="$ctrl.onBubbleLinkClick({transactionsToRecategorize: transactionsToRecategorize, category: category})"> </tng-recategorization-popup> </div> <div class="c-transactions-list__transaction-title-section"> <h5 class="c-transactions-list__title" title="{{::transaction.description}}"> <span ng-if="transaction.extra_history_detail !== undefined">{{:: \'transactions.nsfDescription\' | translate}}</span> <span ng-if="transaction.extra_history_detail === undefined" ng-bind-html="transaction.description | translate"></span> </h5> <tng-foldable-category-list ng-if="$ctrl.displayCategoryDescription" type="$ctrl.type" transaction="::transaction" class="print-hide"></tng-foldable-category-list> </div> </div> <div class="c-transactions-list__card" ng-if="::($ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.CREDIT_CARD)\n              || $ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.REWARDS)\n              || $ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.CREDIT_CARD_GOAL))"> {{ ::( $ctrl.getTransactionCardName(transaction) | maskNumber ) }} </div> <div class="c-transactions-list__account" ng-if="::($ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.ALL) || $ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.RETIREMENT_GOAL))"> <strong><tng-account-name max-len="10" ng-if="transaction.account" account="::transaction.account" product-change-details="$ctrl.sortedProductChangeDetails" transaction-date="::( $ctrl.getTransactionDate(transaction))"></tng-account-name></strong><br/> {{ ::transaction.account.display_name | maskNumber }} </div> <tng-transaction-amount-column class="c-transactions-list__amount" type="::$ctrl.type" transaction="::transaction" parent-account-number="::$ctrl.accountDetails.account_summary.account_number"> </tng-transaction-amount-column> <div class="c-transactions-list__balance" ng-if="::($ctrl.shouldDisplayBalanceColumn())"> <strong>{{ ::transaction.balance_after | tngCurrency:(transaction.account.currency || transaction.account.currency_type) }} </strong> </div> </div> </div> </div> </div> <div class="c-transactions-list {{:: ($ctrl.isListHoverable() ? \' c-transactions-list--hoverable\' : \'\') }}" tng-list-with-focusable-elements ng-if="$ctrl.shouldDisplayDefaultTransactionList() && $ctrl.isPendingTransactionsList"> <tng-transactions-list-header type="::$ctrl.type" ng-show="$ctrl.transactions.length > 0" is-cc="::($ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.CREDIT_CARD)\n    || $ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.CREDIT_CARD_GOAL))" is-pending-transactions-list="::true" custom-header-type="$ctrl.customHeader" header="::$ctrl.header"> </tng-transactions-list-header> <div class="c-transactions-list__list"> <div class="c-transactions-list__tile" ng-repeat="transaction in $ctrl.transactions" ng-if="::(!transaction.is_split_child || transaction.hasIncompleteCategoryList)" ng-click="$ctrl.onTransactionView({transaction: transaction});"> <div class="c-transactions-list__tile-grid"> <tng-transaction-date-column class="c-transactions-list__date" should-display-on-mobile="::$ctrl.listService.shouldDisplayDateBlock($index, $ctrl.transactions, $ctrl.dateFieldLabel)" transaction="::transaction"> </tng-transaction-date-column> <div class="{{::\'c-transactions-list__transaction\' + ($ctrl.shouldDisplayShrinkedTransactionColumn() ? \' c-transactions-list__transaction--shrinked\' : \'\') }}"> <div class="c-transactions-list__category"> <tng-category-icon icon="{{::$ctrl.listService.getTransactionIcon(transaction, {isPendingTransactionsList: true})}}" color="{{::$ctrl.listService.getCategoryIconColor($ctrl.iconColor, transaction)}}" size="32"> </tng-category-icon> </div> <div class=""> <h5 class="c-transactions-list__title" title="{{::transaction.description}}" id="pending-transaction-title-{{$index}}" ng-bind-html="$ctrl.getPendingTransactionTitle(transaction)"> </h5> <span ng-if="::transaction.category_id" class="c-transactions-list__subtitle"> <tng-foldable-category-list transaction="::transaction"></tng-foldable-category-list> </span> <span ng-if="::!transaction.category_id &&\n                  $ctrl.shouldDisplayFromSubTitle(transaction)" class="c-transactions-list__subtitle"> {{ \'transactions.pendingTransactionsList.from\' | translate }} <span> <span ng-if="transaction.from_account.fi_name"> {{ ::transaction.from_account.fi_name }} </span> <span ng-if="!transaction.from_account.fi_name && transaction.from_account.nickname"> {{ ::transaction.from_account.nickname }} </span> <span ng-if="!transaction.from_account.fi_name && !transaction.from_account.nickname"> {{:: transaction.from_account.type ? (\'global.accountType.\' + transaction.from_account.type | translate) : transaction.from_account.display_name }} </span> <span ng-if="::transaction.from_account.display_name"> - {{ ::transaction.from_account.display_name | maskNumber }} </span> </span> </span> </div> </div> <div class="c-transactions-list__card" ng-if="::($ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.CREDIT_CARD)\n            || $ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.CREDIT_CARD_GOAL))"> {{ ::( $ctrl.getTransactionCardName(transaction) | maskNumber ) }} </div> <div class="c-transactions-list__account" ng-if="::($ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.ALL) || $ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.GOALS) || $ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.RETIREMENT_GOAL))"> <strong><tng-account-name max-len="10" ng-if="transaction.account" account="::transaction.account"></tng-account-name></strong><br/> {{ ::transaction.account.display_name | maskNumber }} </div> <tng-transaction-amount-column class="c-transactions-list__amount" type="::$ctrl.type" is-pending-transactions-list="::$ctrl.isPendingTransactionsList" transaction="::transaction" parent-account-number="::$ctrl.accountDetails.account_summary.account_number"> </tng-transaction-amount-column> </div> </div> </div> </div> <div class="{{ :: \'c-transactions-list \' + ($ctrl.isListHoverable() ? \' c-transactions-list--hoverable\' : \'\')}}" tng-list-with-focusable-elements ng-if="$ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.BILL_HISTORY) && $ctrl.isPendingTransactionsList"> <tng-transactions-list-header type="::$ctrl.type" is-pending-transactions-list="::$ctrl.isPendingTransactionsList" custom-header-type="$ctrl.customHeader" header="$ctrl.header"> </tng-transactions-list-header> <div class="c-transactions-list__list"> <div class="c-transactions-list__tile" ng-repeat="transaction in $ctrl.transactions" ng-if="::(!transaction.is_split_child || transaction.hasIncompleteCategoryList)" ng-click="$ctrl.onTransactionView({transaction: transaction});"> <div class="c-transactions-list__tile-grid"> <tng-transaction-date-column class="c-transactions-list__date" should-display-on-mobile="::$ctrl.listService.shouldDisplayDateBlock($index, $ctrl.transactions, $ctrl.dateFieldLabel)" transaction="::transaction"> </tng-transaction-date-column> <div class="c-transactions-list__transaction"> <div> <h5 class="c-transactions-list__title" title="{{::transaction.description}}"> <a actionable-id="transaction-list-transaction_view" href="" ng-click="$ctrl.onTransactionView({transaction: transaction});"> {{ ($ctrl.DATE_FREQUENCY[transaction.frequency] ? \'transactions.recurringPayment\' : \'transactions.scheduledPayment\') | translate }} </a></h5> <span class="c-transactions-list__subtitle"> {{ transaction.from_account.type ? (\'global.accountType.\' + transaction.from_account.type | translate) : \'\' }} - {{ ::transaction.from_account.display_name | maskNumber }}</span> </div> </div> <tng-transaction-amount-column class="c-transactions-list__amount" is-pending-transactions-list="$ctrl.isPendingTransactionsList" transaction="transaction" parent-account-number="::$ctrl.accountDetails.account_summary.account_number"> </tng-transaction-amount-column> </div> </div> </div> </div> <div class="{{ :: \'c-transactions-list \' + ($ctrl.isListHoverable() ? \' c-transactions-list--hoverable\' : \'\')}}" tng-list-with-focusable-elements ng-if="$ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.BILL_HISTORY) && !$ctrl.isPendingTransactionsList"> <tng-transactions-list-header type="::$ctrl.type" custom-header-type="$ctrl.customHeader" header="$ctrl.header"> </tng-transactions-list-header> <div class="c-transactions-list__list"> <div ng-repeat="transaction in $ctrl.transactions" class="c-transactions-list__tile" ng-click="$ctrl.onTransactionView({transaction: transaction});"> <div class="c-transactions-list__tile-grid"> <tng-transaction-date-column class="c-transactions-list__date" should-display-on-mobile="::$ctrl.listService.shouldDisplayDateBlock($index, $ctrl.transactions, $ctrl.dateFieldLabel)" transaction="::transaction"> </tng-transaction-date-column> <div class="c-transactions-list__transaction"> <h5 class="c-transactions-list__title" title="{{ \'transactions.billPayment\' | translate }}">{{ \'transactions.billPayment\' | translate }}</h5> <span class="c-transactions-list__subtitle"> {{ transaction.account.type ? (\'global.accountType.\' + transaction.account.type | translate) : \'\' }} - {{ ::transaction.account.display_name | maskNumber }} </span> </div> <tng-transaction-amount-column class="c-transactions-list__amount" is-pending-transactions-list="$ctrl.isPendingTransactionsList" transaction="transaction" parent-account-number="::$ctrl.accountDetails.account_summary.account_number"> </tng-transaction-amount-column> </div> </div> </div> </div> <tng-uncategorized-transactions-list header="$ctrl.header" date-field-label="$ctrl.dateFieldLabel" transactions="$ctrl.transactions" on-bubble-confirm="$ctrl.onBubbleConfirm({category: category, transaction: transaction})" type="::$ctrl.type" ng-if="::($ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.UNCATEGORIZED_TRANSACTIONS)\n        || $ctrl.isType($ctrl.transactionConstants.TRANSACTION_VIEWS.UNCONFIRMED_TRANSACTIONS))"> </tng-uncategorized-transactions-list> <tng-investment-pending-transactions-list tng-list-with-focusable-elements ng-if="$ctrl.isInvestment() && $ctrl.isPendingTransactionsList" header="$ctrl.header" transactions="$ctrl.transactions" on-transaction-view="$ctrl.onTransactionView({transaction: transaction})" ng-hide="$ctrl.selectedCsaType.indexOf(\'CSA\')>=0"></tng-investment-pending-transactions-list> <tng-investment-settled-transactions-list tng-list-with-focusable-elements ng-if="$ctrl.isInvestment() && !$ctrl.isPendingTransactionsList" header="$ctrl.header" transactions="$ctrl.transactions" on-bubble-deny="$ctrl.onBubbleDeny()" on-bubble-confirm="$ctrl.onBubbleConfirm({category: category, transaction: transaction})" display-quick-recategorization-popup="$ctrl.displayQuickRecategorizationPopup" on-categories-edit="$ctrl.onCategoriesEdit({transaction: transaction})" on-bubble-link-click="$ctrl.onBubbleLinkClick({transactionsToRecategorize: transactionsToRecategorize, category: category })" transaction-to-recategorize="$ctrl.transactionToRecategorize" on-transaction-icon-click="$ctrl.onTransactionIconClick({transaction: transaction})" on-transaction-view="$ctrl.onTransactionView({transaction: transaction})" display-category-icon="$ctrl.displayCategoryIcon" display-category-description="$ctrl.displayCategoryDescription" selected-csa-type="$ctrl.selectedCsaType"></tng-investment-settled-transactions-list> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(15)),a=c(n(0)),s=c(n(2)),r=c(n(368)),o=c(n(116));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,i,s,r,o,c,l,u,d,h){(0,a.default)(this,t),this.listService=e,this.TRANSACTION_TYPE_CODE_MAP=n.TRANSACTION_TYPE_CODE_MAP,this.ID_TO_CATEGORY=i.ID_TO_CATEGORY,this.categoryConstants=i,this.DATE_FREQUENCY=n.TRANSACTION_FREQUENCY,this.ACCOUNT_TYPES=s.ACCOUNT_TYPES,this.CURRENCY_TYPES=s.CURRENCY_TYPES,this.transactionConstants=n,this.EventBusService=r,this.$window=o,this.TransactionsChartService=c,this.PendingTransactionsTitleFormatter=l,this.EnvironmentService=u,this.investmentConstants=d,this.$timeout=h}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;this.sortedProductChangeDetails=(0,o.default)(this.accountDetails,"account_summary.credit_card.cc_account_details.card_details.product_change_details");var e="transaction_date",n="effective_date";this.dateFieldLabel=this.isPendingTransactionsList?n:e,this.$timeout((function(){t.header=t.isPendingTransactionsList?t.transactionConstants.TRANSACTION_TABLE_HEADER[t.type].pendingTransactionsHeader:t.transactionConstants.TRANSACTION_TABLE_HEADER[t.type].postedTransactionsHeader,t.customHeader="custom".concat((0,i.default)(t.header).length)})),this.resizeListener=(0,r.default)((function(){t.EventBusService.publish(t.transactionConstants.TRANSACTION_LIST_EVENTS.RELAYOUT)}),1e3),this.boundResizeListener=this.resizeListener.bind(this),this.$window.addEventListener("resize",this.boundResizeListener)}},{key:"$onDestroy",value:function(){this.$window.removeEventListener("resize",this.boundResizeListener)}},{key:"$onChanges",value:function(t){var e=t.selectedCsaType;if(this.header&&e&&e.currentValue&&e.currentValue.indexOf("CSA")>=0){var n=angular.copy(this.header);["units","unitPrice"].forEach((function(t){return delete n[t]})),this.header=n}else this.header&&e&&e.currentValue&&e.currentValue.indexOf("TNG")>=0&&(this.header=this.isPendingTransactionsList?this.transactionConstants.TRANSACTION_TABLE_HEADER[this.type].pendingTransactionsHeader:this.transactionConstants.TRANSACTION_TABLE_HEADER[this.type].postedTransactionsHeader)}},{key:"shouldDisplayRecategorizationPopup",value:function(t){return!!(this.displayQuickRecategorizationPopup&&this.transactionToRecategorize&&this.transactionToRecategorize.id&&this.transactionToRecategorize.id===t.id)}},{key:"isType",value:function(t){return this.type===t}},{key:"calculateDiscount",value:function(t){if(t.hasIncompleteCategoryList)return null;if(this.isType(this.transactionConstants.TRANSACTION_VIEWS.REWARDS))return this.TransactionsChartService.calculateDisplayedReward(t.reward,t.amount,t)+"%";if(this.isType(this.transactionConstants.TRANSACTION_VIEWS.CREDIT_CARD)||this.isType(this.transactionConstants.TRANSACTION_VIEWS.ALL)){var e=this.listService.calculateReward(t);return e?e+"%":null}return null}},{key:"getTransactionIcon",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{isPendingTransactionsList:!1};return e.isPendingTransactionsList&&!t.category_id?null:t.categoriesFromSplit&&t.categoriesFromSplit.length>1?"icon-split":this.ID_TO_CATEGORY[t.category_id]?this.ID_TO_CATEGORY[t.category_id].icon:"icon-question2"}},{key:"getTransactionCardName",value:function(t){var e=this.ACCOUNT_TYPES;return t.from_account&&t.from_account.type===e.CREDIT_CARD?t.from_account.display_name:t.account?t.account.display_name:t.account_id?t.account_id:t.to_account&&t.to_account.type===e.CREDIT_CARD?t.to_account.display_name:void 0}},{key:"shouldDisplayDefaultTransactionList",value:function(){return!(-1!==[this.transactionConstants.TRANSACTION_VIEWS.BILL_HISTORY,this.transactionConstants.TRANSACTION_VIEWS.UNCATEGORIZED_TRANSACTIONS,this.transactionConstants.TRANSACTION_VIEWS.UNCONFIRMED_TRANSACTIONS,this.transactionConstants.TRANSACTION_VIEWS.MUTUAL_FUND].indexOf(this.type))}},{key:"shouldDisplayShrinkedTransactionColumn",value:function(){return-1!==[this.transactionConstants.TRANSACTION_VIEWS.CREDIT_CARD,this.transactionConstants.TRANSACTION_VIEWS.ALL,this.transactionConstants.TRANSACTION_VIEWS.REWARDS,this.transactionConstants.TRANSACTION_VIEWS.GOALS,this.transactionConstants.TRANSACTION_VIEWS.CREDIT_CARD_GOAL,this.transactionConstants.TRANSACTION_VIEWS.RETIREMENT_GOAL].indexOf(this.type)}},{key:"isInvestment",value:function(){return this.isType(this.transactionConstants.TRANSACTION_VIEWS.MUTUAL_FUND)}},{key:"getPendingTransactionTitle",value:function(t){return this.PendingTransactionsTitleFormatter.format(t)}},{key:"isListHoverable",value:function(){return!this.EnvironmentService.isTouchDevice()}},{key:"shouldDisplayBalanceColumn",value:function(){return-1!==[this.transactionConstants.TRANSACTION_VIEWS.SAVINGS,this.transactionConstants.TRANSACTION_VIEWS.CHEQUING,this.transactionConstants.TRANSACTION_VIEWS.LOAN,this.transactionConstants.TRANSACTION_VIEWS.GOALS].indexOf(this.type)}},{key:"shouldDisplayFromSubTitle",value:function(t){return t.trade_type===this.investmentConstants.TRANSACTION_TYPE.BUY?t.transaction_type!==this.investmentConstants.TRANSACTION_TYPE.PURCHASE:t.trade_type!==this.investmentConstants.TRANSACTION_TYPE.SELL}},{key:"getTransactionDate",value:function(t){return t.transaction_date||t.effective_date}}]),t}();l.$inject=["TransactionsListService","transactionConstants","categoryConstants","accountConstants","EventBusService","$window","TransactionsChartService","PendingTransactionsTitleFormatter","EnvironmentService","investmentConstants","$timeout"],e.default=l,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1928)),a=s(n(1929));function s(t){return t&&t.__esModule?t:{default:t}}n(1930);var r={template:i.default,controller:a.default,bindings:{transaction:"<",shouldDisplayOnMobile:"<",type:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="{{:: $ctrl.shouldDisplayOnMobile ? \'c-transactions-list__date-column c-transactions-list__date-column--grey-block\' : \'c-transactions-list__date-column\'}}"> <div ng-if="::(!$ctrl.isToday($ctrl.getTransactionDate()))" class="print-none"> <span>{{:: $ctrl.getTransactionDate() | date:$ctrl.dateFormat }}</span> <span ng-if="::(!$ctrl.isCurrentYear($ctrl.getTransactionDate()))" class="c-transactions-list__today"> {{:: $ctrl.getTransactionDate() | date:\'yyyy\' }} </span> </div> <div ng-if="::($ctrl.isToday($ctrl.getTransactionDate()))" class="print-none"> <span ng-if="::!$ctrl.transaction.mutual_fund"> <span class="c-transaction-date-column__mobile-today-date" ng-if=":: $ctrl.shouldDisplayOnMobile"> {{:: $ctrl.getTransactionDate() | date: $ctrl.dateFormat }} </span> <span class="c-transaction-date-column__transaction-time"> {{:: $ctrl.getTransactionDate() | date: $ctrl.timeFormat }} </span> </span> <span class="c-transactions-list__today"> {{:: \'transactions.today\' | translate }} </span> </div> <div class="print-only-block"> <span>{{:: $ctrl.getTransactionDate() | date:$ctrl.longDateFormat }}</span> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s){(0,i.default)(this,t),this.DateService=e,this.LocaleService=n,this.localeConstants=s,this.transactionConstants=a,this.MUTUAL_FUND_TRANSACTION_TYPES={PENDING:"pending",SETTLEMENT:"settlement"}}return(0,a.default)(t,[{key:"$onInit",value:function(){this.dateFormat=this.getDateFormat(),this.longDateFormat=this.getLongDateFormat(),this.timeFormat=this.getTimeFormat(),this.type||(this.type=this.transaction.transaction_date?this.MUTUAL_FUND_TRANSACTION_TYPES.SETTLEMENT:this.MUTUAL_FUND_TRANSACTION_TYPES.PENDING)}},{key:"isToday",value:function(t){return this.DateService.isToday(t)}},{key:"isCurrentYear",value:function(t){return this.DateService.isCurrentYear(t)}},{key:"getTransactionDate",value:function(){if(this.transaction.mutual_fund){var t=void 0;switch(this.type){case this.MUTUAL_FUND_TRANSACTION_TYPES.SETTLEMENT:t=this.transaction.mutual_fund.settlement_date;break;case this.MUTUAL_FUND_TRANSACTION_TYPES.PENDING:t=this.transaction.mutual_fund.trade_date;break;default:t=this.transaction.mutual_fund.effective_date}return t||(t=this.transaction.mutual_fund.effective_date),t}return this.transaction.transaction_date||this.transaction.effective_date}},{key:"getDateFormat",value:function(){return this.LocaleService.locale===this.localeConstants.LOCALES.EN_CA?"MMMM d":"d MMMM"}},{key:"getTimeFormat",value:function(){return this.LocaleService.locale===this.localeConstants.LOCALES.EN_CA?"h:mm a":"H' h 'mm"}},{key:"getLongDateFormat",value:function(){return this.LocaleService.locale===this.localeConstants.LOCALES.EN_CA?"MMM d, yyyy":"d MMM yyyy"}}]),t}();r.$inject=["DateService","LocaleService","transactionConstants","localeConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1932)),a=s(n(1933));function s(t){return t&&t.__esModule?t:{default:t}}n(1934);var r={template:i.default,controller:a.default,bindings:{transaction:"<",isPendingTransactionsList:"<",type:"<",parentAccountNumber:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div ng-class="{\'c-transactions-list__amount-column--positive\' : $ctrl.isPositiveAmount($ctrl.transaction)}" class="c-transactions-list__amount-column" ng-if="::$ctrl.type !== $ctrl.transactionConstants.TRANSACTION_VIEWS.REWARDS"> <span translate-cloak> <span ng-if="::$ctrl.isPendingTransactionsList"> <span ng-if="::$ctrl.TransactionsService.isFullBalanceTransaction($ctrl.transaction)">{{::\'transactions.pendingTransactionsList.fullBalance\' | translate}}</span> <span ng-if="::$ctrl.TransactionsService.isMinimumPaymentTransaction($ctrl.transaction)">{{::\'transactions.pendingTransactionsList.minimumPayment\' | translate}}</span> <span ng-if="::(!$ctrl.TransactionsService.isMinimumPaymentTransaction($ctrl.transaction) && !$ctrl.TransactionsService.isFullBalanceTransaction($ctrl.transaction))">{{::$ctrl.getDisplayAmount($ctrl.transaction) | tngCurrency:($ctrl.transaction.account.currency || $ctrl.transaction.account.currency_type)}}</span> </span> <span ng-if="::!$ctrl.isPendingTransactionsList"> {{::$ctrl.getDisplayAmount($ctrl.transaction) | tngCurrency:($ctrl.transaction.account.currency || $ctrl.transaction.account.currency_type)}} </span> </span> <span class="{{::\'c-transactions-list__reward c-transactions-list__reward\' + (($ctrl.listService.calculateReward($ctrl.transaction) >= 2) ? \'--orange\' : \'\') }}" ng-if="::($ctrl.transaction.creditcard_rewards && !!+$ctrl.transaction.creditcard_rewards.rewards_earned)"> {{ :: $ctrl.transaction.creditcard_rewards.rewards_earned | tngCurrency:($ctrl.transaction.account.currency || $ctrl.transaction.account.currency_type)}} </span> <span ng-if="::($ctrl.isPendingTransactionsList && $ctrl.transaction.frequency)" class="c-transactions-list__frequency" translate-cloak> {{ $ctrl.listService.DATE_FREQUENCY[$ctrl.transaction.frequency] | translate}} </span> <span ng-if="::($ctrl.isPendingTransactionsList && !$ctrl.transaction.frequency && $ctrl.transaction.mutual_fund.frequency)" class="c-transactions-list__frequency" translate-cloak> {{ $ctrl.transaction.mutual_fund.frequency }} </span> <span ng-if="::$ctrl.isShowBalanceInMobile" class="c-transactions-list__balance-mobile"> {{:: $ctrl.transaction.balance_after | tngCurrency:($ctrl.transaction.account.currency || $ctrl.transaction.account.currency_type)}} </span> </div> <div ng-if="::$ctrl.type === $ctrl.transactionConstants.TRANSACTION_VIEWS.REWARDS"> <span ng-class="{\'body--callout\' : $ctrl.calculateDiscount($ctrl.transaction) === \'2%\' || $ctrl.calculateDiscount($ctrl.transaction) === \'4%\'}"> {{::$ctrl.transaction.reward | tngCurrency:($ctrl.transaction.account.currency || $ctrl.transaction.account.currency_type)}} </span> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=r(n(271));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.listService=e,this.transactionConstants=n,this.TransactionsService=a,this.CURRENCY_TYPES=s.CURRENCY_TYPES,this.ACCOUNT_TYPES=s.ACCOUNT_TYPES,this.investmentConstants=r}return(0,a.default)(t,[{key:"getDisplayAmount",value:function(t){var e=this.TransactionsService.getActualTransactionAmount(t);return e>0?e:-e}},{key:"calculateDiscount",value:function(t){return Math.abs(t.reward/(.01*t.amount)).toFixed()+"%"}},{key:"isPositiveAmount",value:function(t){var e=(0,s.default)(t.to_account)?t.account:t.to_account,n=!1;return this.isPendingTransactionsList&&this.type!==this.transactionConstants.TRANSACTION_VIEWS.RETIREMENT_GOAL?n=this.parentAccountNumber?t.from_account&&this.parentAccountNumber!==t.from_account.number:t.trade_type!==this.investmentConstants.TRANSACTION_TYPE.SELL&&(!t.emt&&(e&&e.type&&!(-1!==[this.ACCOUNT_TYPES.EXT,this.ACCOUNT_TYPES.CREDIT_CARD].indexOf(e.type)))):(t.amount>0||t.originalAmount>0)&&(n=!0),n}},{key:"isShowBalanceInMobile",get:function(){return!this.isPendingTransactionsList&&-1!==[this.transactionConstants.TRANSACTION_VIEWS.LOAN,this.transactionConstants.TRANSACTION_VIEWS.SAVINGS,this.transactionConstants.TRANSACTION_VIEWS.CHEQUING].indexOf(this.type)}}]),t}();o.$inject=["TransactionsListService","transactionConstants","TransactionsService","accountConstants","investmentConstants"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1936)),a=s(n(1937));function s(t){return t&&t.__esModule?t:{default:t}}n(1938);var r={template:i.default,controller:a.default,bindings:{isPendingTransactionsList:"<",isCc:"<",header:"<",type:"<",selectedCsaType:"<",customHeaderType:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-transactions-list__header"> <div ng-class="$ctrl.customHeader(key, $ctrl.selectedCsaType, $ctrl.customHeaderType)" ng-repeat="(key, item) in $ctrl.header track by key"> <tng-help-bubble class="c-transactions-list__tooltip" ng-if="::(($ctrl.isCc || $ctrl.type === $ctrl.transactionConstants.TRANSACTION_VIEWS.ALL) && $ctrl.isPendingTransactionsList && key ===\'amount\')"> <span class="body--4" translate-cloak> {{ \'transactions.pendingTransactionsList.tooltip\' | translate}} </span> </tng-help-bubble> <span translate-cloak class="c-transactions-list__header-element--helpAmount" ng-if="::(($ctrl.isCc || $ctrl.type === $ctrl.transactionConstants.TRANSACTION_VIEWS.ALL) && $ctrl.isPendingTransactionsList && key === \'amount\')"> {{ \'transactions.transactionTableHeader.\' + item | translate}}</span> <span translate-cloak ng-if="::!(($ctrl.isCc || $ctrl.type === $ctrl.transactionConstants.TRANSACTION_VIEWS.ALL) && $ctrl.isPendingTransactionsList && key === \'amount\')"> {{ \'transactions.transactionTableHeader.\' + item | translate}}</span> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(8)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e){(0,a.default)(this,t),(0,i.default)(this,{transactionConstants:e})}return(0,s.default)(t,[{key:"customHeader",value:function(t,e,n){if(e&&e.indexOf("CSA")>=0)return"c-transactions-list__header-element c-transactions-list__header-element--"+t+" "+t+"--CSA";switch(n){case"custom3":return"c-transactions-list__header-element c-transactions-list__header-element--"+t+"-custom3";case"custom4":return"c-transactions-list__header-element c-transactions-list__header-element--"+t+"-custom4";default:return"c-transactions-list__header-element c-transactions-list__header-element--"+t}}}]),t}();o.$inject=["transactionConstants"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1940)),a=s(n(1941));function s(t){return t&&t.__esModule?t:{default:t}}n(1942);var r={template:i.default,controller:a.default,bindings:{transaction:"<",type:"<",onCategoryConfirm:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-transactions-category-selector"> <div ng-if="$ctrl.currentState === $ctrl.STATES.SUGGESTED"> <div class="c-edit-transaction-modal__suggested-categories-list" ng-if="$ctrl.suggestedCategories.length"> <h3 translate-cloak>{{ \'transactions.editTransactionModal.suggestedCategories\' | translate }}</h3> <a actionable-id="transactions-category-category_select" href="" ng-click="$ctrl.onCategorySelect(c)" ng-repeat="c in $ctrl.suggestedCategories"> <tng-category-icon ng-class="\'c-edit-transaction-modal__suggested-category-item \' + ($ctrl.isCategorySelected(c) ? \'c-edit-transaction-modal__suggested-category-item--selected\' : \'\')" title="{{\'global.transactionsCategories.\' + c.key | translate }}" icon="{{c.icon}}" translate-cloak> </tng-category-icon> </a> <a actionable-id="transactions-category-change_state" href="" ng-click="$ctrl.currentState = $ctrl.STATES.ALL"> <tng-category-icon class="c-edit-transaction-modal__suggested-category-item" title="{{ \'transactions.other\' | translate }}" icon="icon-other" translate-cloak> </tng-category-icon> </a> </div> </div> <div ng-if="$ctrl.currentState === $ctrl.STATES.ALL"> <tng-browse-categories-widget on-category-select="$ctrl.onCategorySelect(c)"> </tng-browse-categories-widget> </div> <div ng-if="$ctrl.currentState === $ctrl.STATES.CONFIRM"> <div class="c-transactions-category-selector__confirm-category"> <tng-category-icon size="32" color="{{$ctrl.type === $ctrl.transactionConstants.TRANSACTION_VIEWS.UNCONFIRMED_TRANSACTIONS ? \'#7b7b7b\' : \'\'}}" icon="{{$ctrl.selectedCategory.icon}}"> </tng-category-icon> <h5 class="body--4 c-transactions-category-selector__confirm-category-name"> {{$ctrl.selectedCategory.name}} </h5> </div> <div class="c-transactions-category-selector__confirm-controls"> <a actionable-id="transactions-category-category_deny" href="" class="c-transactions-category-selector__confirm-control c-transactions-category-selector__confirm-control--grey" ng-click="$ctrl.onCategoryDenyClick()"> <tng-category-icon size="32" icon="icon-x"> </tng-category-icon> </a> <a actionable-id="transactions-category-category_confirm" href="" class="c-transactions-category-selector__confirm-control" ng-click="$ctrl.onCategoryConfirmClick()"> <tng-category-icon size="32" icon="icon-check1"> </tng-category-icon> </a> </div> </div> <div ng-if="$ctrl.currentState === $ctrl.STATES.LOADING"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div ng-if="$ctrl.currentState === $ctrl.STATES.SUCCESS"> <tng-category-icon size="32" icon="icon-check1"> </tng-category-icon> </div> <div ng-if="$ctrl.currentState === $ctrl.STATES.ERROR"> <div class="c-error-message panel margin__tb--fix2"> <span ng-bind-html="\'global.errorCodes.generic\' | translate" translate-cloak></span> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(8)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s,r){(0,a.default)(this,t),this.categoryConstants=e,this.ID_TO_CATEGORY=this.categoryConstants.ID_TO_CATEGORY,this.LOW_LEVEL_ID_TO_CATEGORY=this.categoryConstants.LOW_LEVEL_ID_TO_CATEGORY,this.$translate=i,this.transactionConstants=n,this.TransactionsTabService=s,this.$log=r}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;this.STATES={SUGGESTED:"SUGGESTED",ALL:"ALL",CONFIRM:"CONFIRM",LOADING:"LOADING",SUCCESS:"SUCCESS",ERROR:"ERROR"},this.suggestedCategories=this.transaction.detected_categories?this.transaction.detected_categories.map((function(e){return t.ID_TO_CATEGORY[e.categoryId]})):[],this.selectedCategory=null,this._setInitialState()}},{key:"_setInitialState",value:function(){if(this.type===this.transactionConstants.TRANSACTION_VIEWS.UNCONFIRMED_TRANSACTIONS){var t=this.suggestedCategories.length>0&&this.suggestedCategories[0].id?this.suggestedCategories[0].id:this.transaction.category_id,e=this.ID_TO_CATEGORY[t];return this.selectedCategory=(0,i.default)(e,{name:this.$translate.instant("global.transactionsCategories."+e.key)}),void(this.currentState=this.STATES.CONFIRM)}this._goToInitialStep()}},{key:"_goToInitialStep",value:function(){this.currentState=this.suggestedCategories.length>=1?this.STATES.SUGGESTED:this.STATES.ALL}},{key:"onCategorySelect",value:function(t){this.selectedCategory=t,this.onCategoryConfirmClick()}},{key:"onCategoryDenyClick",value:function(){this.selectedCategory=null,this._goToInitialStep()}},{key:"onCategoryConfirmClick",value:function(){var t=this;this.currentState=this.STATES.LOADING,this.TransactionsTabService.updateTransaction(this.transaction.id,{categoryId:this.selectedCategory.id,isRead:!0,hasUncertainCategorization:!1}).then((function(){t.currentState=t.STATES.SUCCESS,t.onCategoryConfirm({transaction:t.transaction,category:t.selectedCategory})}),(function(e){t.currentState=t.STATES.ERROR,t.$log.error("error on transactions category update",e)}))}}]),t}();o.$inject=["categoryConstants","transactionConstants","$translate","TransactionsTabService","$log"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1944)),a=s(n(1945));function s(t){return t&&t.__esModule?t:{default:t}}n(1946);var r={template:i.default,controller:a.default,bindings:{transactions:"<",dateFieldLabel:"<",header:"<",type:"<",onBubbleConfirm:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports=' <div class="{{:: \'c-transactions-list c-transactions-list--\' + $ctrl.type }}"> <tng-transactions-list-header header="::$ctrl.header"> </tng-transactions-list-header> <div class="c-transactions-list__list"> <div class="c-transactions-list__tile" ng-repeat="transaction in $ctrl.transactions" ng-if="!transaction.is_split_child"> <div class="c-transactions-list__tile-grid" ng-click="$ctrl.toggleCategorySelector($index)"> <tng-transaction-date-column class="c-transactions-list__date" should-display-on-mobile="::$ctrl.listService.shouldDisplayDateBlock($index, $ctrl.transactions, $ctrl.dateFieldLabel)" transaction="::transaction"> </tng-transaction-date-column> <div class="c-transactions-list__transaction"> <div class="c-transactions-list__category" ng-if="$ctrl.shouldDisplayCategoryIcon(transaction)"> <a actionable-id="uncategorized-transactions-list-get_category" href=""> <tng-category-icon icon="{{ $ctrl.getCategoryIcon(transaction) }}" color="{{ $ctrl.getCategoryIconColor(transaction) }}" size="32"> </tng-category-icon> </a> </div> <div class=""> <h5 class="c-transactions-list__title" title="{{::transaction.description}}"> <a actionable-id="uncategorized-transactions-list-transaction_view" href="" ng-click="$ctrl.onTransactionView({transaction: transaction});">{{::transaction.description}}</a></h5> <span class="c-transactions-list__subtitle" ng-if="$ctrl.shouldDisplayCategoryIcon(transaction)" translate-cloak> {{$ctrl.getDescriptionTranslationKey(transaction) | translate}} </span> </div> </div> <div class="c-transactions-list__account"> <strong><tng-account-name account="transaction.account"></tng-account-name></strong> {{ ::transaction.account.display_name | maskNumber }} </div> <tng-transaction-amount-column class="c-transactions-list__amount" is-pending-transactions-list="$ctrl.isPendingTransactionsList" transaction="transaction"> </tng-transaction-amount-column> </div> <tng-transactions-category-selector ng-click="$event.stopPropagation();" on-category-confirm="$ctrl.onCategoryConfirm(transaction, category)" transaction="transaction" type="$ctrl.type" class="c-transactions-list__category-selector" ng-if="$ctrl.shouldDisplayCategorySelector($index, transaction)"> </tng-transactions-category-selector> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.listService=e,this.transactionConstants=n,this.categoryConstants=a,this.ID_TO_CATEGORY=a.ID_TO_CATEGORY}return(0,a.default)(t,[{key:"$onInit",value:function(){this._init()}},{key:"$onChanges",value:function(t){var e=t.transactions;e&&e.currentValue&&this._init()}},{key:"onCategoryConfirm",value:function(t,e){var n=this.transactions.find((function(e){return e.id===t.id}));n&&(n.addedCategory=e),this.toggleCategorySelector(this.transactionWithOpenedCategorySelector),this.onBubbleConfirm({category:e,transaction:t})}},{key:"toggleCategorySelector",value:function(t){this.type!==this.transactionConstants.TRANSACTION_VIEWS.UNCONFIRMED_TRANSACTIONS&&(this.transactionWithOpenedCategorySelector=this.transactionWithOpenedCategorySelector===+t?null:+t)}},{key:"shouldDisplayCategorySelector",value:function(t,e){return this.type===this.transactionConstants.TRANSACTION_VIEWS.UNCONFIRMED_TRANSACTIONS&&!e.addedCategory||this.transactionWithOpenedCategorySelector===+t}},{key:"_init",value:function(){this.transactionWithOpenedCategorySelector=null}},{key:"getCategoryIcon",value:function(t){return t.addedCategory&&t.addedCategory.id?this.ID_TO_CATEGORY[t.addedCategory.id].icon:this.ID_TO_CATEGORY[this.categoryConstants.UNCATEGORIZED_CATEGORY_ID].icon}},{key:"getCategoryIconColor",value:function(t){return(this.type!==this.transactionConstants.TRANSACTION_VIEWS.UNCATEGORIZED_TRANSACTIONS||t.addedCategory)&&this.ID_TO_CATEGORY[t.addedCategory.id]?null:this.categoryConstants.UNCATEGORIZED_TRANSACTION_COLOR}},{key:"shouldDisplayCategoryIcon",value:function(t){return this.type===this.transactionConstants.TRANSACTION_VIEWS.UNCATEGORIZED_TRANSACTIONS||!!t.addedCategory}},{key:"getDescriptionTranslationKey",value:function(t){var e="global.transactionsCategories.";return t.addedCategory&&t.addedCategory.id?e+this.ID_TO_CATEGORY[t.addedCategory.id].key:this.type===this.transactionConstants.TRANSACTION_VIEWS.UNCATEGORIZED_TRANSACTIONS?e+this.ID_TO_CATEGORY[this.categoryConstants.UNCATEGORIZED_CATEGORY_ID].key:null}}]),t}();r.$inject=["TransactionsListService","transactionConstants","categoryConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1948)),a=s(n(1949));function s(t){return t&&t.__esModule?t:{default:t}}n(1950);var r={template:i.default,controller:a.default,bindings:{transactions:"<",header:"<",onTransactionView:"&",selectedCsaType:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-transactions-list c-investment-pending-transactions-list"> <tng-transactions-list-header header="$ctrl.header" custom-header-type="\'custom3\'"></tng-transactions-list-header> <div class="c-transactions-list__list"> <div ng-repeat="transaction in $ctrl.transactions" class="c-transactions-list__tile" ng-click="$ctrl.onTransactionView({transaction: transaction});"> <div class="c-transactions-list__tile-grid"> <tng-transaction-date-column class="c-transactions-list__date" should-display-on-mobile="::$ctrl.TransactionsListService.shouldDisplayDateBlock($index, $ctrl.transactions)" transaction="::transaction" type="\'pending\'"></tng-transaction-date-column> <div class="c-transactions-list__transaction"> <div class="c-transactions-list__category"> <tng-category-icon icon="{{:: $ctrl.listService.getTransactionIcon(transaction) }}" discount="{{::$ctrl.calculateDiscount(transaction)}}" discount-size="18" color="{{::$ctrl.categoryConstants.UNCATEGORIZED_TRANSACTION_COLOR}}" size="32"> </tng-category-icon> </div> <div class="c-transactions-list__transaction-title-section"> <h5 class="c-transactions-list__title" title="{{::transaction.description}}">{{::$ctrl.getPendingTransactionTitle(transaction)}}</h5> </div> </div> <div class="c-transactions-list__amount"> <div class="c-transactions-list__amount-column"> <span ng-class="{\'c-transactions-list__amount--positive\': $ctrl.TransactionsListService.showPositiveAmount(transaction) }">{{ ::$ctrl.TransactionsListService.getDisplayAmount(transaction.mutual_fund) | currency }} </span> <span class="c-transactions-list__frequency" translate-cloak ng-if="transaction.mutual_fund.frequency"> {{ $ctrl.DATE_FREQUENCY[transaction.mutual_fund.frequency.toUpperCase()] | translate}} </span> </div> </div> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.TransactionsListService=n,this.transactionConstants=a,this.DATE_FREQUENCY=a.TRANSACTION_FREQUENCY,this.investmentConstants=s,this.categoryConstants=r,this.PendingTransactionsTitleFormatter=o}return(0,a.default)(t,[{key:"$onInit",value:function(){this.type=this.transactionConstants.TRANSACTION_VIEWS.MUTUAL_FUND}},{key:"getTransactionTypeTransKey",value:function(t){switch(t.mutual_fund.trade_type){case this.investmentConstants.TRANSACTION_TYPE.BUY:return"transactions.investment.typeTitle.buy";case this.investmentConstants.TRANSACTION_TYPE.SELL:return t.mutual_fund.transaction_type===this.investmentConstants.TRANSACTION_TYPE.REDEMPTION?"transactions.investment.typeTitle.redemption":"transactions.investment.typeTitle.sell";default:return""}}},{key:"getPendingTransactionTitle",value:function(t){return this.PendingTransactionsTitleFormatter.format(t)}}]),t}();r.$inject=["$log","TransactionsListService","transactionConstants","investmentConstants","categoryConstants","PendingTransactionsTitleFormatter"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1952)),a=s(n(1953));function s(t){return t&&t.__esModule?t:{default:t}}n(1954);var r={template:i.default,controller:a.default,bindings:{transactions:"<",header:"<",transactionToRecategorize:"<?",displayQuickRecategorizationPopup:"<",onBubbleLinkClick:"&",onBubbleDeny:"&",onBubbleConfirm:"&",onTransactionView:"&",onCategoriesEdit:"&",onTransactionIconClick:"&",displayCategoryIcon:"<?",displayCategoryDescription:"<?",selectedCsaType:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-transactions-list c-investment-settled-transactions-list"> <div ng-if="$ctrl.selectedCsaType.indexOf(\'CSA\')>=0" class="ccaDescriptionText">{{::\'transactions.filters.ccaText.CCAAccountText\' | translate}}</div> <tng-transactions-list-header header="$ctrl.header" ng-if="$ctrl.transactions && $ctrl.transactions.length > 0" selected-csa-type="$ctrl.selectedCsaType"></tng-transactions-list-header> <div class="c-transactions-list__list"> <div ng-repeat="transaction in $ctrl.transactions" ng-if="::!transaction.is_split_child" class="c-transactions-list__tile" ng-class="{\'c-transactions-list__tile--focused-tile\': $ctrl.TransactionsListService.shouldDisplayRecategorizationPopup($ctrl.displayQuickRecategorizationPopup, $ctrl.transactionToRecategorize, transaction)}" ng-click="$ctrl.onTransactionView({transaction: transaction});"> <div class="c-transactions-list__tile-grid" ng-if="$ctrl.selectedCsaType.indexOf(\'CSA\')>=0"> <tng-transaction-date-column class="c-transactions-list__date" should-display-on-mobile="::$ctrl.TransactionsListService.shouldDisplayDateBlock($index, $ctrl.transactions, $ctrl.dateFieldLabel)" transaction="::transaction" type="\'settlement\'"> </tng-transaction-date-column> <div class="c-transactions-list__transactionInvestment transactionCca"> <div class="c-transactions-list__category" ng-if="::($ctrl.displayCategoryIcon) && (transaction.category_id)"> <a actionable-id="investment-settled-transactions-transaction_click" href="" ng-click="$ctrl.onTransactionIconClick({transaction: transaction}); $event.stopPropagation();"> <tng-category-icon icon="{{ ::$ctrl.TransactionsListService.getTransactionIcon(transaction) }}" color="{{:: $ctrl.TransactionsListService.ID_TO_CATEGORY[transaction.category_id] ? null : \'#7b7b7b\'}}" size="32"></tng-category-icon> </a> <tng-recategorization-popup tng-click-outside="$ctrl.onBubbleDeny()" ng-if="$ctrl.TransactionsListService.shouldDisplayRecategorizationPopup($ctrl.displayQuickRecategorizationPopup, $ctrl.transactionToRecategorize, transaction)" transaction="::transaction" on-bubble-deny="$ctrl.onBubbleDeny()" on-categories-edit="$ctrl.onCategoriesEdit({transaction: transaction})" on-bubble-confirm="$ctrl.onBubbleConfirm({category: category, transaction: transaction, options: options })" on-bubble-link-click="$ctrl.onBubbleLinkClick({transactionsToRecategorize: transactionsToRecategorize, category: category})"> </tng-recategorization-popup> </div> <div class="" ng-if="::(!$ctrl.isPendingTransactionsList)"> <h5 class="c-transactions-list__title" title="{{::transaction.description}}"> {{ ::transaction.description }} </h5> <span class="c-transactions-list__subtitle" ng-if="::($ctrl.displayCategoryDescription)"> {{::$ctrl.ID_TO_CATEGORY[transaction.category_id] ? (\'global.transactionsCategories.\' + $ctrl.ID_TO_CATEGORY[transaction.category_id].key | translate) : \'\'}} </span> </div> </div> <div class="c-transactions-list__amount c-transactions-list__amountSettled"> <span class="c-transactions-list__amountSettled-label"> {{ ::\'transactions.transactionTableHeader.amount\' | translate}} </span> <span ng-class="{\'c-transactions-list__amount--positive\': $ctrl.TransactionsListService.showPositiveAmount(transaction) }">{{ ::$ctrl.TransactionsListService.getDisplayAmount(transaction) | currency }}</span> </div> </div> <div class="c-transactions-list__tile-grid" ng-if="$ctrl.selectedCsaType.indexOf(\'TNG\')>=0"> <tng-transaction-date-column class="c-transactions-list__date" should-display-on-mobile="::$ctrl.TransactionsListService.shouldDisplayDateBlock($index, $ctrl.transactions, $ctrl.dateFieldLabel)" transaction="::transaction" type="\'settlement\'"> </tng-transaction-date-column> <div class="c-transactions-list__transactionInvestment"> <div class="c-transactions-list__category" ng-if="::($ctrl.displayCategoryIcon) && (transaction.category_id)"> <a actionable-id="investment-settled-transactions-transaction_click" href="" ng-click="$ctrl.onTransactionIconClick({transaction: transaction}); $event.stopPropagation();"> <tng-category-icon icon="{{ ::$ctrl.TransactionsListService.getTransactionIcon(transaction) }}" color="{{:: $ctrl.TransactionsListService.ID_TO_CATEGORY[transaction.category_id] ? null : \'#7b7b7b\'}}" size="32"></tng-category-icon> </a> <tng-recategorization-popup tng-click-outside="$ctrl.onBubbleDeny()" ng-if="$ctrl.TransactionsListService.shouldDisplayRecategorizationPopup($ctrl.displayQuickRecategorizationPopup, $ctrl.transactionToRecategorize, transaction)" transaction="::transaction" on-bubble-deny="$ctrl.onBubbleDeny()" on-categories-edit="$ctrl.onCategoriesEdit({transaction: transaction})" on-bubble-confirm="$ctrl.onBubbleConfirm({category: category, transaction: transaction, options: options })" on-bubble-link-click="$ctrl.onBubbleLinkClick({transactionsToRecategorize: transactionsToRecategorize, category: category})"> </tng-recategorization-popup> </div> <div class="" ng-if="::(!$ctrl.isPendingTransactionsList)"> <h5 class="c-transactions-list__title" title="{{::transaction.description}}"> {{ ::transaction.description }} </h5> <span class="c-transactions-list__subtitle" ng-if="::($ctrl.displayCategoryDescription)"> <tng-foldable-category-list transaction="::transaction"></tng-foldable-category-list> </span> </div> </div> <div class="c-transactions-list__units body--3"> {{ ::transaction.mutual_fund.units }} </div> <div class="c-transactions-list__unitPrice body--3"> {{ ::transaction.mutual_fund.unit_price | currency:undefined:4 }} </div> <div class="c-transactions-list__amount c-transactions-list__amountSettled"> <span class="c-transactions-list__amountSettled-label"> {{ ::\'transactions.transactionTableHeader.amount\' | translate}} </span> <span ng-class="{\'c-transactions-list__amount--positive\': $ctrl.TransactionsListService.showPositiveAmount(transaction) }">{{ ::$ctrl.TransactionsListService.getDisplayAmount(transaction) | currency }}</span> </div> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(0),s=(i=a)&&i.__esModule?i:{default:i};var r=function t(e,n,i,a){(0,s.default)(this,t),this.$log=e,this.TransactionsListService=n,this.transactionConstants=i,this.ID_TO_CATEGORY=a.ID_TO_CATEGORY,this.type=i.TRANSACTION_VIEWS.MUTUAL_FUND,this.dateFieldLabel="transaction_date"};r.$inject=["$log","TransactionsListService","transactionConstants","categoryConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(8)),a=o(n(0)),s=o(n(2)),r=o(n(45));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,s,r){(0,a.default)(this,t),this.transactionConstants=e,this.categoryConstants=n,this.TransactionsTabService=i,this.investmentConstants=r,this.ID_TO_CATEGORY=n.ID_TO_CATEGORY,this.DATE_FREQUENCY=e.TRANSACTION_FREQUENCY,this.TransactionsService=s}return(0,s.default)(t,[{key:"calculateReward",value:function(t){return this.TransactionsTabService.calculateReward(t)}},{key:"shouldDisplayDateBlock",value:function(t,e,n){var i=(0,r.default)(e[t][n],"YYYY-MM-DD");return 0===t||i.isBefore(e[t-1][n],"day")||i.isAfter(e[t-1][n],"day")}},{key:"getCategoryIconColor",value:function(t,e){return t||(!e.has_uncertain_categorization||e.is_read?this.categoryConstants.ID_TO_CATEGORY[e.category_id]&&e.category_id!==this.categoryConstants.UNCATEGORIZED_CATEGORY_ID?null:this.categoryConstants.UNCATEGORIZED_TRANSACTION_COLOR:e.detected_categories.some((function(t){return t.score>=1}))?null:this.categoryConstants.UNCATEGORIZED_TRANSACTION_COLOR)}},{key:"getTransactionIcon",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{isPendingTransactionsList:!1};return e.isPendingTransactionsList&&!t.category_id?null:e.isPendingTransactionsList&&t.category_id===this.categoryConstants.UNCATEGORIZED_CATEGORY_ID?"icon-question":t.categoriesFromSplit&&t.categoriesFromSplit.length>1?"icon-split":this.ID_TO_CATEGORY[t.category_id]?this.ID_TO_CATEGORY[t.category_id].icon:"icon-question2"}},{key:"shouldDisplayRecategorizationPopup",value:function(t,e,n){return!!(t&&e&&e.id&&e.id===n.id)}},{key:"getDisplayAmount",value:function(t){var e=this.TransactionsService.getActualTransactionAmount(t);return e>0?e:-e}},{key:"showPositiveAmount",value:function(t){return this._showPositiveMFAmount(t)}},{key:"_showPositiveMFAmount",value:function(t){var e=!1,n=0;if(angular.isDefined(t.mutual_fund)){var a=(0,i.default)({},t.mutual_fund);if((e=!a.trade_type||a.trade_type===this.investmentConstants.TRANSACTION_TYPE.BUY)&&!a.amount&&a.units&&a.unit_price){var s=parseFloat(a.units),r=parseFloat(a.unit_price);a.amount=s*r}n=this.getDisplayAmount(a)}else angular.isDefined(t.account.mutual_fund)&&(n=this.getDisplayAmount(t),e=t.amount>0);return angular.isDefined(t.amount)?e&&n>0&&t.amount>0:e&&n>0}}]),t}();c.$inject=["transactionConstants","categoryConstants","TransactionsTabService","TransactionsService","investmentConstants"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";var i,a=c(n(1804)),s=c(n(49)),r=c(n(533)),o=c(n(39));function c(t){return t&&t.__esModule?t:{default:t}}(i={dev:!1}).tooltip=i.tooltip||{},i.utils=i.utils||{},i.models=i.models||{},i.charts={},i.logs={},i.dom={},"undefined"==typeof d3&&(d3=n(1796)),i.dispatch=d3.dispatch("render_start","render_end"),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,i=function(){},a=function(){return n.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,a.prototype=new i,a}),i.dev&&(i.dispatch.on("render_start",(function(t){i.logs.startTime=+new Date})),i.dispatch.on("render_end",(function(t){i.logs.endTime=+new Date,i.logs.totalTime=i.logs.endTime-i.logs.startTime,i.log("total",i.logs.totalTime)}))),i.log=function(){if(i.dev&&window.console&&console.log&&console.log.apply)console.log.apply(console,arguments);else if(i.dev&&window.console&&"function"==typeof console.log&&Function.prototype.bind){var t=Function.prototype.bind.call(console.log,console);t.apply(console,arguments)}return arguments[arguments.length-1]},i.deprecated=function(t,e){console&&console.warn&&console.warn("nvd3 warning: `"+t+"` has been deprecated. ",e||"")},i.render=function(t){t=t||1,i.render.active=!0,i.dispatch.render_start(),setTimeout((function e(){for(var n,a,s=0;s<t&&(a=i.render.queue[s]);s++)n=a.generate(),(0,o.default)(a.callback)==("undefined"==typeof Function?"undefined":(0,o.default)(Function))&&a.callback(n);i.render.queue.splice(0,s),i.render.queue.length?setTimeout(e):(i.dispatch.render_end(),i.render.active=!1)}))},i.render.active=!1,i.render.queue=[],i.addGraph=function(t){(0,o.default)(arguments[0])===("undefined"==typeof Function?"undefined":(0,o.default)(Function))&&(t={generate:arguments[0],callback:arguments[1]}),i.render.queue.push(t),i.render.active||i.render()},t.exports=i,"undefined"!=typeof window&&(window.nv=i),i.dom.write=function(t){return void 0!==window.fastdom?fastdom.mutate(t):t()},i.dom.read=function(t){return void 0!==window.fastdom?fastdom.measure(t):t()},i.interactiveGuideline=function(){var t={left:0,top:0},e=null,n=null,a=d3.scale.linear(),s=d3.dispatch("elementMousemove","elementMouseout","elementClick","elementDblclick","elementMouseDown","elementMouseUp"),r=!0,o=null,c=i.models.tooltip(),l=window.ActiveXObject;function u(d){d.each((function(d){var h=d3.select(this),f=e||960,p=n||400,g=h.selectAll("g.nv-wrap.nv-interactiveLineLayer").data([d]);function m(){var e=d3.event.clientX-this.getBoundingClientRect().left,n=d3.event.clientY-this.getBoundingClientRect().top,i=!0,r=!1;if(l&&(e=d3.event.offsetX,n=d3.event.offsetY,"svg"!==d3.event.target.tagName&&(i=!1),d3.event.target.className.baseVal.match("nv-legend")&&(r=!0)),i&&(e-=t.left,n-=t.top),"mouseout"===d3.event.type||e<0||n<0||e>f||n>p||d3.event.relatedTarget&&void 0===d3.event.relatedTarget.ownerSVGElement||r){if(l&&d3.event.relatedTarget&&void 0===d3.event.relatedTarget.ownerSVGElement&&(void 0===d3.event.relatedTarget.className||d3.event.relatedTarget.className.match(c.nvPointerEventsClass)))return;return s.elementMouseout({mouseX:e,mouseY:n}),u.renderGuideLine(null),void c.hidden(!0)}c.hidden(!1);var o=void 0;if("function"==typeof a.rangeBands){var d=d3.bisect(a.range(),e)-1;if(!(a.range()[d]+a.rangeBand()>=e))return s.elementMouseout({mouseX:e,mouseY:n}),u.renderGuideLine(null),void c.hidden(!0);o=a.domain()[d3.bisect(a.range(),e)-1]}else o=a.invert(e);s.elementMousemove({mouseX:e,mouseY:n,pointXValue:o}),"dblclick"===d3.event.type&&s.elementDblclick({mouseX:e,mouseY:n,pointXValue:o}),"click"===d3.event.type&&s.elementClick({mouseX:e,mouseY:n,pointXValue:o}),"mousedown"===d3.event.type&&s.elementMouseDown({mouseX:e,mouseY:n,pointXValue:o}),"mouseup"===d3.event.type&&s.elementMouseUp({mouseX:e,mouseY:n,pointXValue:o})}g.enter().append("g").attr("class"," nv-wrap nv-interactiveLineLayer").append("g").attr("class","nv-interactiveGuideLine"),o&&(o.on("touchmove",m).on("mousemove",m,!0).on("mouseout",m,!0).on("mousedown",m,!0).on("mouseup",m,!0).on("dblclick",m).on("click",m),u.guideLine=null,u.renderGuideLine=function(t){r&&(u.guideLine&&u.guideLine.attr("x1")===t||i.dom.write((function(){var e=g.select(".nv-interactiveGuideLine").selectAll("line").data(null!=t?[i.utils.NaNtoZero(t)]:[],String);e.enter().append("line").attr("class","nv-guideline").attr("x1",(function(t){return t})).attr("x2",(function(t){return t})).attr("y1",p).attr("y2",0),e.exit().remove()})))})}))}return c.duration(0).hideDelay(0).hidden(!1),u.dispatch=s,u.tooltip=c,u.margin=function(e){return arguments.length?(t.top=void 0!==e.top?e.top:t.top,t.left=void 0!==e.left?e.left:t.left,u):t},u.width=function(t){return arguments.length?(e=t,u):e},u.height=function(t){return arguments.length?(n=t,u):n},u.xScale=function(t){return arguments.length?(a=t,u):a},u.showGuideLine=function(t){return arguments.length?(r=t,u):r},u.svgContainer=function(t){return arguments.length?(o=t,u):o},u},i.interactiveBisect=function(t,e,n){if(!(t instanceof Array))return null;var i;i="function"!=typeof n?function(t){return t.x}:n;var a=d3.bisector((function(t,e){return i(t)-e})).left,s=d3.max([0,a(t,e)-1]),r=i(t[s]);if(void 0===r&&(r=s),r===e)return s;var o=d3.min([s+1,t.length-1]),c=i(t[o]);return void 0===c&&(c=o),Math.abs(c-e)>=Math.abs(r-e)?s:o},i.nearestValueIndex=function(t,e,n){var i=1/0,a=null;return t.forEach((function(t,s){var r=Math.abs(e-t);null!=t&&r<=i&&r<n&&(i=r,a=s)})),a},i.models.tooltip=function(){var t="nvtooltip-"+Math.floor(1e5*Math.random()),e=null,n="w",a=25,s=0,o=null,c=!0,l=200,u=null,d={left:null,top:null},h=!0,f=100,p=!0,g="nv-pointer-events-none",m=function(t,e,n){return t},_=function(t){return t},v=function(t,e){return t},S=function(t,e){if(null===t)return"";var n=d3.select(document.createElement("table"));p&&n.selectAll("thead").data([t]).enter().append("thead").append("tr").append("td").attr("colspan",3).append("strong").classed("x-value",!0).html(_(t.value));var i=n.selectAll("tbody").data([t]).enter().append("tbody").selectAll("tr").data((function(t){return t.series})).enter().append("tr").classed("highlight",(function(t){return t.highlight}));i.append("td").classed("legend-color-guide",!0).append("div").style("background-color",(function(t){return t.color})),i.append("td").classed("key",!0).classed("total",(function(t){return!!t.total})).html((function(t,e){return v(t.key,e)})),i.append("td").classed("value",!0).html((function(t,e){return m(t.value,e,t)})),i.filter((function(t,e){return void 0!==t.percent})).append("td").classed("percent",!0).html((function(t,e){return"("+d3.format("%")(t.percent)+")"})),i.selectAll("td").each((function(t){if(t.highlight){var e=d3.scale.linear().domain([0,1]).range(["#fff",t.color]);d3.select(this).style("border-bottom-color",e(.6)).style("border-top-color",e(.6))}}));var a=n.node().outerHTML;return void 0!==t.footer&&(a+="<div class='footer'>"+t.footer+"</div>"),a},T=function(){var t={left:null!==d3.event?d3.event.clientX:0,top:null!==d3.event?d3.event.clientY:0};if("none"!=getComputedStyle(document.body).transform){var e=document.body.getBoundingClientRect();t.left-=e.left,t.top-=e.top}return t},y=function(t){if(t&&t.series){if(i.utils.isArray(t.series))return!0;if(i.utils.isObject(t.series))return t.series=[t.series],!0}return!1},E=function(){i.dom.read((function(){var t=T(),e=function(t){var e,i,s,r=u.node().offsetHeight,o=u.node().offsetWidth,c=document.documentElement.clientWidth,l=document.documentElement.clientHeight;switch(n){case"e":e=-o-a,i=-r/2,t.left+e<0&&(e=a),(s=t.top+i)<0&&(i-=s),(s=t.top+i+r)>l&&(i-=s-l);break;case"w":e=a,i=-r/2,t.left+e+o>c&&(e=-o-a),(s=t.top+i)<0&&(i-=s),(s=t.top+i+r)>l&&(i-=s-l);break;case"n":e=-o/2-5,i=a,t.top+i+r>l&&(i=-r-a),(s=t.left+e)<0&&(e-=s),(s=t.left+e+o)>c&&(e-=s-c);break;case"s":e=-o/2,i=-r-a,t.top+i<0&&(i=a),(s=t.left+e)<0&&(e-=s),(s=t.left+e+o)>c&&(e-=s-c);break;case"center":e=-o/2,i=-r/2;break;default:e=0,i=0}return{left:e,top:i}}(t),i=t.left+e.left,s=t.top+e.top;if(c)u.interrupt().transition().delay(l).duration(0).style("opacity",0);else{var r="translate("+d.left+"px, "+d.top+"px)",o="translate("+Math.round(i)+"px, "+Math.round(s)+"px)",h=d3.interpolateString(r,o),p=u.style("opacity")<.1;u.interrupt().transition().duration(p?0:f).styleTween("transform",(function(t){return h}),"important").styleTween("-webkit-transform",(function(t){return h})).style("-ms-transform",o).style("opacity",1)}d.left=i,d.top=s}))};function A(){if(h&&y(e))return i.dom.write((function(){u&&u.node()||((u=d3.select(document.body).select("#"+t).data([1])).enter().append("div").attr("class","nvtooltip "+(o||"xy-tooltip")).attr("id",t).style("top",0).style("left",0).style("opacity",0).style("position","fixed").selectAll("div, table, td, tr").classed(g,!0).classed(g,!0),u.exit().remove());var n=S(e,u.node());n&&(u.node().innerHTML=n),E()})),A}return A.nvPointerEventsClass=g,A.options=i.utils.optionsFunc.bind(A),A._options=(0,r.default)({},{duration:{get:function(){return f},set:function(t){f=t}},gravity:{get:function(){return n},set:function(t){n=t}},distance:{get:function(){return a},set:function(t){a=t}},snapDistance:{get:function(){return s},set:function(t){s=t}},classes:{get:function(){return o},set:function(t){o=t}},enabled:{get:function(){return h},set:function(t){h=t}},hideDelay:{get:function(){return l},set:function(t){l=t}},contentGenerator:{get:function(){return S},set:function(t){S=t}},valueFormatter:{get:function(){return m},set:function(t){m=t}},headerFormatter:{get:function(){return _},set:function(t){_=t}},keyFormatter:{get:function(){return v},set:function(t){v=t}},headerEnabled:{get:function(){return p},set:function(t){p=t}},position:{get:function(){return T},set:function(t){T=t}},chartContainer:{get:function(){return document.body},set:function(t){i.deprecated("chartContainer","feature removed after 1.8.3")}},fixedTop:{get:function(){return null},set:function(t){i.deprecated("fixedTop","feature removed after 1.8.1")}},offset:{get:function(){return{left:0,top:0}},set:function(t){i.deprecated("offset","use chart.tooltip.distance() instead")}},hidden:{get:function(){return c},set:function(t){c!=t&&(c=!!t,A())}},data:{get:function(){return e},set:function(t){t.point&&(t.value=t.point.x,t.series=t.series||{},t.series.value=t.point.y,t.series.color=t.point.color||t.series.color),e=t}},node:{get:function(){return u.node()},set:function(t){}},id:{get:function(){return t},set:function(t){}}}),i.utils.initOptions(A),A},i.utils.windowSize=function(){var t={width:640,height:480};return window.innerWidth&&window.innerHeight?(t.width=window.innerWidth,t.height=window.innerHeight,t):"CSS1Compat"==document.compatMode&&document.documentElement&&document.documentElement.offsetWidth?(t.width=document.documentElement.offsetWidth,t.height=document.documentElement.offsetHeight,t):document.body&&document.body.offsetWidth?(t.width=document.body.offsetWidth,t.height=document.body.offsetHeight,t):t},i.utils.isArray=Array.isArray,i.utils.isObject=function(t){return null!==t&&"object"===(void 0===t?"undefined":(0,o.default)(t))},i.utils.isFunction=function(t){return"function"==typeof t},i.utils.isDate=function(t){return"[object Date]"===toString.call(t)},i.utils.isNumber=function(t){return!isNaN(t)&&"number"==typeof t},i.utils.windowResize=function(t){return window.addEventListener?window.addEventListener("resize",t):i.log("ERROR: Failed to bind to window.resize with: ",t),{callback:t,clear:function(){window.removeEventListener("resize",t)}}},i.utils.getColor=function(t){if(void 0===t)return i.utils.defaultColor();if(i.utils.isArray(t)){var e=d3.scale.ordinal().range(t);return function(t,n){var i=void 0===n?t:n;return t.color||e(i)}}return t},i.utils.defaultColor=function(){return i.utils.getColor(d3.scale.category20().range())},i.utils.customTheme=function(t,e,n){e=e||function(t){return t.key};var a=(n=n||d3.scale.category20().range()).length;return function(s,r){var o=e(s);return i.utils.isFunction(t[o])?t[o]():void 0!==t[o]?t[o]:(a||(a=n.length),n[a-=1])}},i.utils.pjax=function(t,e){var n=function(n){d3.html(n,(function(n){var a=d3.select(e).node();a.parentNode.replaceChild(d3.select(n).select(e).node(),a),i.utils.pjax(t,e)}))};d3.selectAll(t).on("click",(function(){history.pushState(this.href,this.textContent,this.href),n(this.href),d3.event.preventDefault()})),d3.select(window).on("popstate",(function(){d3.event.state&&n(d3.event.state)}))},i.utils.calcApproxTextWidth=function(t){if(i.utils.isFunction(t.style)&&i.utils.isFunction(t.text)){var e=parseInt(t.style("font-size").replace("px",""),10),n=t.text().length;return i.utils.NaNtoZero(n*e*.5)}return 0},i.utils.NaNtoZero=function(t){return!i.utils.isNumber(t)||isNaN(t)||null===t||t===1/0||t===-1/0?0:t},d3.selection.prototype.watchTransition=function(t){var e=[this].concat([].slice.call(arguments,1));return t.transition.apply(t,e)},i.utils.renderWatch=function(t,e){if(!(this instanceof i.utils.renderWatch))return new i.utils.renderWatch(t,e);var n=void 0!==e?e:250,a=[],s=this;this.models=function(t){return(t=[].slice.call(arguments,0)).forEach((function(t){var e;t.__rendered=!1,(e=t).dispatch.on("renderEnd",(function(t){e.__rendered=!0,s.renderEnd("model")})),a.indexOf(t)<0&&a.push(t)})),this},this.reset=function(t){void 0!==t&&(n=t),a=[]},this.transition=function(t,e,i){if(i=(e=arguments.length>1?[].slice.call(arguments,1):[]).length>1?e.pop():void 0!==n?n:250,t.__rendered=!1,a.indexOf(t)<0&&a.push(t),0===i)return t.__rendered=!0,t.delay=function(){return this},t.duration=function(){return this},t;0===t.length?t.__rendered=!0:t.every((function(t){return!t.length}))?t.__rendered=!0:t.__rendered=!1;var r=0;return t.transition().duration(i).each((function(){++r})).each("end",(function(n,i){0==--r&&(t.__rendered=!0,s.renderEnd.apply(this,e))}))},this.renderEnd=function(){a.every((function(t){return t.__rendered}))&&(a.forEach((function(t){t.__rendered=!1})),t.renderEnd.apply(this,arguments))}},i.utils.deepExtend=function(t){var e=arguments.length>1?[].slice.call(arguments,1):[];e.forEach((function(e){for(var n in e){var a=i.utils.isArray(t[n]),s=i.utils.isObject(t[n]),r=i.utils.isObject(e[n]);s&&!a&&r?i.utils.deepExtend(t[n],e[n]):t[n]=e[n]}}))},i.utils.state=function(){if(!(this instanceof i.utils.state))return new i.utils.state;var t={},e=function(){},n=function(){return{}},a=null;this.dispatch=d3.dispatch("change","set"),this.dispatch.on("set",(function(t){e(t,!0)})),this.getter=function(t){return n=t,this},this.setter=function(t,n){return n||(n=function(){}),e=function(e,i){t(e),i&&n()},this},this.init=function(t){a=a||{},i.utils.deepExtend(a,t)};var r=function(){var e=n();if((0,s.default)(e)===(0,s.default)(t))return!1;for(var i in e)void 0===t[i]&&(t[i]={}),t[i]=e[i];return!0};this.update=function(){a&&(e(a,!1),a=null),r.call(this)&&this.dispatch.change(t)}},i.utils.optionsFunc=function(t){return t&&d3.map(t).forEach(function(t,e){i.utils.isFunction(this[t])&&this[t](e)}.bind(this)),this},i.utils.calcTicksX=function(t,e){for(var n=1,a=0;a<e.length;a+=1){var s=e[a]&&e[a].values?e[a].values.length:0;n=s>n?s:n}return i.log("Requested number of ticks: ",t),i.log("Calculated max values to be: ",n),t=(t=t>n?t=n-1:t)<1?1:t,t=Math.floor(t),i.log("Calculating tick count as: ",t),t},i.utils.calcTicksY=function(t,e){return i.utils.calcTicksX(t,e)},i.utils.initOption=function(t,e){t._calls&&t._calls[e]?t[e]=t._calls[e]:(t[e]=function(n){return arguments.length?(t._overrides[e]=!0,t._options[e]=n,t):t._options[e]},t["_"+e]=function(n){return arguments.length?(t._overrides[e]||(t._options[e]=n),t):t._options[e]})},i.utils.initOptions=function(t){t._overrides=t._overrides||{};var e=(0,a.default)(t._options||{}),n=(0,a.default)(t._calls||{});for(var s in e=e.concat(n))i.utils.initOption(t,e[s])},i.utils.inheritOptionsD3=function(t,e,n){t._d3options=n.concat(t._d3options||[]),t._d3options=(t._d3options||[]).filter((function(t,e,n){return n.indexOf(t)===e})),n.unshift(e),n.unshift(t),d3.rebind.apply(this,n)},i.utils.arrayUnique=function(t){return t.sort().filter((function(e,n){return!n||e!=t[n-1]}))},i.utils.symbolMap=d3.map(),i.utils.symbol=function(){var t,e=64;function n(n,a){var s=t.call(this,n,a),r=e.call(this,n,a);return-1!==d3.svg.symbolTypes.indexOf(s)?d3.svg.symbol().type(s).size(r)():i.utils.symbolMap.get(s)(r)}return n.type=function(e){return arguments.length?(t=d3.functor(e),n):t},n.size=function(t){return arguments.length?(e=d3.functor(t),n):e},n},i.utils.inheritOptions=function(t,e){var n=(0,a.default)(e._options||{}),s=(0,a.default)(e._calls||{}),r=e._inherited||[],o=e._d3options||[],c=n.concat(s).concat(r).concat(o);c.unshift(e),c.unshift(t),d3.rebind.apply(this,c),t._inherited=i.utils.arrayUnique(n.concat(s).concat(r).concat(n).concat(t._inherited||[])),t._d3options=i.utils.arrayUnique(o.concat(t._d3options||[]))},i.utils.initSVG=function(t){t.classed({"nvd3-svg":!0})},i.utils.sanitizeHeight=function(t,e){return t||parseInt(e.style("height"),10)||400},i.utils.sanitizeWidth=function(t,e){return t||parseInt(e.style("width"),10)||960},i.utils.availableHeight=function(t,e,n){return Math.max(0,i.utils.sanitizeHeight(t,e)-n.top-n.bottom)},i.utils.availableWidth=function(t,e,n){return Math.max(0,i.utils.sanitizeWidth(t,e)-n.left-n.right)},i.utils.noData=function(t,e){var n=t.options(),a=n.margin(),s=n.noData(),r=null==s?["No Data Available."]:[s],o=i.utils.availableHeight(null,e,a),c=i.utils.availableWidth(null,e,a),l=a.left+c/2,u=a.top+o/2;e.selectAll("g").remove();var d=e.selectAll(".nv-noData").data(r);d.enter().append("text").attr("class","nvd3 nv-noData").attr("dy","-.7em").style("text-anchor","middle"),d.attr("x",l).attr("y",u).text((function(t){return t}))},i.utils.wrapTicks=function(t,e){t.each((function(){for(var t,n=d3.select(this),i=n.text().split(/\s+/).reverse(),a=[],s=0,r=n.attr("y"),o=parseFloat(n.attr("dy")),c=n.text(null).append("tspan").attr("x",0).attr("y",r).attr("dy",o+"em");t=i.pop();)a.push(t),c.text(a.join(" ")),c.node().getComputedTextLength()>e&&(a.pop(),c.text(a.join(" ")),a=[t],c=n.append("tspan").attr("x",0).attr("y",r).attr("dy",1.1*++s+o+"em").text(t))}))},i.utils.arrayEquals=function(t,e){if(t===e)return!0;if(!t||!e)return!1;if(t.length!=e.length)return!1;for(var n=0,a=t.length;n<a;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!i.arrayEquals(t[n],e[n]))return!1}else if(t[n]!=e[n])return!1;return!0},i.utils.pointIsInArc=function(t,e,n){var i=n.innerRadius()(e),a=n.outerRadius()(e),s=n.startAngle()(e),r=n.endAngle()(e),o=t.x*t.x+t.y*t.y,c=Math.atan2(t.x,-t.y);return c=c<0?c+2*Math.PI:c,i*i<=o&&o<=a*a&&s<=c&&c<=r},i.models.axis=function(){var t,e,n=d3.svg.axis(),a=d3.scale.linear(),s={top:0,right:0,bottom:0,left:0},o=75,c=60,l=null,u=!0,d=0,h=!0,f=!1,p=!1,g=null,m=0,_=void 0,v=250,S=d3.dispatch("renderEnd");n.scale(a).orient("bottom").tickFormat((function(t){return t}));var T=i.utils.renderWatch(S,v);function y(r){return T.reset(),r.each((function(r){var c=d3.select(this);i.utils.initSVG(c);var v=c.selectAll("g.nv-wrap.nv-axis").data([r]),S=(v.enter().append("g").attr("class","nvd3 nv-wrap nv-axis").append("g"),v.select("g"));null!==g?n.ticks(g):"top"!=n.orient()&&"bottom"!=n.orient()||n.ticks(Math.abs(a.range()[1]-a.range()[0])/100),S.watchTransition(T,"axis").call(n),e=e||n.scale();var y=n.tickFormat();null==y&&(y=e.tickFormat());var E,A,b,C=S.selectAll("text.nv-axislabel").data([l||null]);switch(C.exit().remove(),void 0!==_&&S.selectAll("g").select("text").style("font-size",_),n.orient()){case"top":C.enter().append("text").attr("class","nv-axislabel"),b=0,1===a.range().length?b=p?2*a.range()[0]+a.rangeBand():0:2===a.range().length?b=p?a.range()[0]+a.range()[1]+a.rangeBand():a.range()[1]:a.range().length>2&&(b=a.range()[a.range().length-1]+(a.range()[1]-a.range()[0])),C.attr("text-anchor","middle").attr("y",0).attr("x",b/2),u&&((A=v.selectAll("g.nv-axisMaxMin").data(a.domain())).enter().append("g").attr("class",(function(t,e){return["nv-axisMaxMin","nv-axisMaxMin-x",0==e?"nv-axisMin-x":"nv-axisMax-x"].join(" ")})).append("text"),A.exit().remove(),A.attr("transform",(function(t,e){return"translate("+i.utils.NaNtoZero(a(t))+",0)"})).select("text").attr("dy","-0.5em").attr("y",-n.tickPadding()).attr("text-anchor","middle").text((function(e,n){var i=(t||y)(e);return(""+i).match("NaN")?"":i})),A.watchTransition(T,"min-max top").attr("transform",(function(t,e){return"translate("+i.utils.NaNtoZero(a.range()[e])+",0)"})));break;case"bottom":E=m+36;var $=30,N=0,O=S.selectAll("g").select("text"),I="";if(d%360){O.attr("transform",""),O.each((function(t,e){var n=this.getBoundingClientRect(),i=n.width;N=n.height,i>$&&($=i)})),I="rotate("+d+" 0,"+(N/2+n.tickPadding())+")";var w=Math.abs(Math.sin(d*Math.PI/180));E=(w?w*$:$)+30,O.attr("transform",I).style("text-anchor",d%360>0?"start":"end")}else f?O.attr("transform",(function(t,e){return"translate(0,"+(e%2==0?"0":"12")+")"})):O.attr("transform","translate(0,0)");C.enter().append("text").attr("class","nv-axislabel"),b=0,1===a.range().length?b=p?2*a.range()[0]+a.rangeBand():0:2===a.range().length?b=p?a.range()[0]+a.range()[1]+a.rangeBand():a.range()[1]:a.range().length>2&&(b=a.range()[a.range().length-1]+(a.range()[1]-a.range()[0])),C.attr("text-anchor","middle").attr("y",E).attr("x",b/2),u&&((A=v.selectAll("g.nv-axisMaxMin").data([a.domain()[0],a.domain()[a.domain().length-1]])).enter().append("g").attr("class",(function(t,e){return["nv-axisMaxMin","nv-axisMaxMin-x",0==e?"nv-axisMin-x":"nv-axisMax-x"].join(" ")})).append("text"),A.exit().remove(),A.attr("transform",(function(t,e){return"translate("+i.utils.NaNtoZero(a(t)+(p?a.rangeBand()/2:0))+",0)"})).select("text").attr("dy",".71em").attr("y",n.tickPadding()).attr("transform",I).style("text-anchor",d?d%360>0?"start":"end":"middle").text((function(e,n){var i=(t||y)(e);return(""+i).match("NaN")?"":i})),A.watchTransition(T,"min-max bottom").attr("transform",(function(t,e){return"translate("+i.utils.NaNtoZero(a(t)+(p?a.rangeBand()/2:0))+",0)"})));break;case"right":C.enter().append("text").attr("class","nv-axislabel"),C.style("text-anchor",h?"middle":"begin").attr("transform",h?"rotate(90)":"").attr("y",h?12-Math.max(s.right,o)-(m||0):-10).attr("x",h?d3.max(a.range())/2:n.tickPadding()),u&&((A=v.selectAll("g.nv-axisMaxMin").data(a.domain())).enter().append("g").attr("class",(function(t,e){return["nv-axisMaxMin","nv-axisMaxMin-y",0==e?"nv-axisMin-y":"nv-axisMax-y"].join(" ")})).append("text").style("opacity",0),A.exit().remove(),A.attr("transform",(function(t,e){return"translate(0,"+i.utils.NaNtoZero(a(t))+")"})).select("text").attr("dy",".32em").attr("y",0).attr("x",n.tickPadding()).style("text-anchor","start").text((function(e,n){var i=(t||y)(e);return(""+i).match("NaN")?"":i})),A.watchTransition(T,"min-max right").attr("transform",(function(t,e){return"translate(0,"+i.utils.NaNtoZero(a.range()[e])+")"})).select("text").style("opacity",1));break;case"left":C.enter().append("text").attr("class","nv-axislabel"),C.style("text-anchor",h?"middle":"end").attr("transform",h?"rotate(-90)":"").attr("y",h?25-Math.max(s.left,o)-(m||0):-10).attr("x",h?-d3.max(a.range())/2:-n.tickPadding()),u&&((A=v.selectAll("g.nv-axisMaxMin").data(a.domain())).enter().append("g").attr("class",(function(t,e){return["nv-axisMaxMin","nv-axisMaxMin-y",0==e?"nv-axisMin-y":"nv-axisMax-y"].join(" ")})).append("text").style("opacity",0),A.exit().remove(),A.attr("transform",(function(t,n){return"translate(0,"+i.utils.NaNtoZero(e(t))+")"})).select("text").attr("dy",".32em").attr("y",0).attr("x",-n.tickPadding()).attr("text-anchor","end").text((function(e,n){var i=(t||y)(e);return(""+i).match("NaN")?"":i})),A.watchTransition(T,"min-max right").attr("transform",(function(t,e){return"translate(0,"+i.utils.NaNtoZero(a.range()[e])+")"})).select("text").style("opacity",1))}if(C.text((function(t){return t})),!u||"left"!==n.orient()&&"right"!==n.orient()||(S.selectAll("g").each((function(t,e){d3.select(this).select("text").attr("opacity",1),(a(t)<a.range()[1]+10||a(t)>a.range()[0]-10)&&((t>1e-10||t<-1e-10)&&d3.select(this).attr("opacity",0),d3.select(this).select("text").attr("opacity",0))})),a.domain()[0]==a.domain()[1]&&0==a.domain()[0]&&v.selectAll("g.nv-axisMaxMin").style("opacity",(function(t,e){return e?0:1}))),u&&("top"===n.orient()||"bottom"===n.orient())){var P=[];v.selectAll("g.nv-axisMaxMin").each((function(t,e){try{e?P.push(a(t)-this.getBoundingClientRect().width-4):P.push(a(t)+this.getBoundingClientRect().width+4)}catch(n){e?P.push(a(t)-4):P.push(a(t)+4)}})),S.selectAll("g").each((function(t,e){(a(t)<P[0]||a(t)>P[1])&&(t>1e-10||t<-1e-10?d3.select(this).remove():d3.select(this).select("text").remove())}))}S.selectAll(".tick").filter((function(t){return!parseFloat(Math.round(1e5*t)/1e6)&&void 0!==t})).classed("zero",!0),e=a.copy()})),T.renderEnd("axis immediate"),y}return y.axis=n,y.dispatch=S,y.options=i.utils.optionsFunc.bind(y),y._options=(0,r.default)({},{axisLabelDistance:{get:function(){return m},set:function(t){m=t}},staggerLabels:{get:function(){return f},set:function(t){f=t}},rotateLabels:{get:function(){return d},set:function(t){d=t}},rotateYLabel:{get:function(){return h},set:function(t){h=t}},showMaxMin:{get:function(){return u},set:function(t){u=t}},axisLabel:{get:function(){return l},set:function(t){l=t}},height:{get:function(){return c},set:function(t){c=t}},ticks:{get:function(){return g},set:function(t){g=t}},width:{get:function(){return o},set:function(t){o=t}},fontSize:{get:function(){return _},set:function(t){_=t}},tickFormatMaxMin:{get:function(){return t},set:function(e){t=e}},margin:{get:function(){return s},set:function(t){s.top=void 0!==t.top?t.top:s.top,s.right=void 0!==t.right?t.right:s.right,s.bottom=void 0!==t.bottom?t.bottom:s.bottom,s.left=void 0!==t.left?t.left:s.left}},duration:{get:function(){return v},set:function(t){v=t,T.reset(v)}},scale:{get:function(){return a},set:function(t){a=t,n.scale(a),p="function"==typeof a.rangeBands,i.utils.inheritOptionsD3(y,a,["domain","range","rangeBand","rangeBands"])}}}),i.utils.initOptions(y),i.utils.inheritOptionsD3(y,n,["orient","tickValues","tickSubdivide","tickSize","tickPadding","tickFormat"]),i.utils.inheritOptionsD3(y,a,["domain","range","rangeBand","rangeBands"]),y},i.models.boxPlot=function(){var t,e,n,a,s,o,c={top:0,right:0,bottom:0,left:0},l=960,u=500,d=Math.floor(1e4*Math.random()),h=d3.scale.ordinal(),f=d3.scale.linear(),p=function(t){return t.label},g=function(t){return t.values.Q1},m=function(t){return t.values.Q2},_=function(t){return t.values.Q3},v=function(t){return t.values.whisker_low},S=function(t){return t.values.whisker_high},T=function(t){return t.color},y=function(t){return t.values.outliers},E=function(t,e,n){return t},A=function(t,e,n){return t},b=function(t,e,n){},C=i.utils.defaultColor(),$=null,N=d3.dispatch("elementMouseover","elementMouseout","elementMousemove","renderEnd"),O=250,I=null,w=i.utils.renderWatch(N,O);function P(r){return w.reset(),r.each((function(r){var d=l-c.left-c.right,P=u-c.top-c.bottom;$=d3.select(this),i.utils.initSVG($),h.domain(t||r.map((function(t,e){return p(t,e)}))).rangeBands(e||[0,d],.1);var M=[];if(!n){var R=[];r.forEach((function(t,e){var n=g(t),i=_(t),a=v(t),s=S(t),r=y(t);r&&r.forEach((function(t,e){R.push(E(t,e,void 0))})),a&&R.push(a),n&&R.push(n),i&&R.push(i),s&&R.push(s)})),M=[d3.min(R),d3.max(R)]}f.domain(n||M),f.range(a||[P,0]),s=s||h,o=o||f.copy().range([f(0),f(0)]);var D=$.selectAll("g.nv-wrap").data([r]);D.enter().append("g").attr("class","nvd3 nv-wrap"),D.attr("transform","translate("+c.left+","+c.top+")");var L=D.selectAll(".nv-boxplot").data((function(t){return t})),k=L.enter().append("g").style("stroke-opacity",1e-6).style("fill-opacity",1e-6);L.attr("class","nv-boxplot").attr("transform",(function(t,e,n){return"translate("+(h(p(t,e))+.05*h.rangeBand())+", 0)"})).classed("hover",(function(t){return t.hover})),L.watchTransition(w,"nv-boxplot: boxplots").style("stroke-opacity",1).style("fill-opacity",.75).delay((function(t,e){return e*O/r.length})).attr("transform",(function(t,e){return"translate("+(h(p(t,e))+.05*h.rangeBand())+", 0)"})),L.exit().remove(),k.each((function(t,e){var n=d3.select(this);[v,S].forEach((function(i){if(void 0!==i(t)&&null!==i(t)){var a=i===v?"low":"high";n.append("line").style("stroke",T(t)||C(t,e)).attr("class","nv-boxplot-whisker nv-boxplot-"+a),n.append("line").style("stroke",T(t)||C(t,e)).attr("class","nv-boxplot-tick nv-boxplot-"+a)}}))}));var B=function(){return null===I?.9*h.rangeBand():Math.min(75,.9*h.rangeBand())},U=function(){return.45*h.rangeBand()-B()/2},F=function(){return.45*h.rangeBand()+B()/2};[v,S].forEach((function(t){var e=t===v?"low":"high",n=t===v?g:_;L.select("line.nv-boxplot-whisker.nv-boxplot-"+e).watchTransition(w,"nv-boxplot: boxplots").attr("x1",.45*h.rangeBand()).attr("y1",(function(e,n){return f(t(e))})).attr("x2",.45*h.rangeBand()).attr("y2",(function(t,e){return f(n(t))})),L.select("line.nv-boxplot-tick.nv-boxplot-"+e).watchTransition(w,"nv-boxplot: boxplots").attr("x1",U).attr("y1",(function(e,n){return f(t(e))})).attr("x2",F).attr("y2",(function(e,n){return f(t(e))}))})),[v,S].forEach((function(t){var e=t===v?"low":"high";k.selectAll(".nv-boxplot-"+e).on("mouseover",(function(e,n,i){d3.select(this).classed("hover",!0),N.elementMouseover({series:{key:t(e),color:T(e)||C(e,i)},e:d3.event})})).on("mouseout",(function(e,n,i){d3.select(this).classed("hover",!1),N.elementMouseout({series:{key:t(e),color:T(e)||C(e,i)},e:d3.event})})).on("mousemove",(function(t,e){N.elementMousemove({e:d3.event})}))})),k.append("rect").attr("class","nv-boxplot-box").on("mouseover",(function(t,e){d3.select(this).classed("hover",!0),N.elementMouseover({key:p(t),value:p(t),series:[{key:"Q3",value:_(t),color:T(t)||C(t,e)},{key:"Q2",value:m(t),color:T(t)||C(t,e)},{key:"Q1",value:g(t),color:T(t)||C(t,e)}],data:t,index:e,e:d3.event})})).on("mouseout",(function(t,e){d3.select(this).classed("hover",!1),N.elementMouseout({key:p(t),value:p(t),series:[{key:"Q3",value:_(t),color:T(t)||C(t,e)},{key:"Q2",value:m(t),color:T(t)||C(t,e)},{key:"Q1",value:g(t),color:T(t)||C(t,e)}],data:t,index:e,e:d3.event})})).on("mousemove",(function(t,e){N.elementMousemove({e:d3.event})})),L.select("rect.nv-boxplot-box").watchTransition(w,"nv-boxplot: boxes").attr("y",(function(t,e){return f(_(t))})).attr("width",B).attr("x",U).attr("height",(function(t,e){return Math.abs(f(_(t))-f(g(t)))||1})).style("fill",(function(t,e){return T(t)||C(t,e)})).style("stroke",(function(t,e){return T(t)||C(t,e)})),k.append("line").attr("class","nv-boxplot-median"),L.select("line.nv-boxplot-median").watchTransition(w,"nv-boxplot: boxplots line").attr("x1",U).attr("y1",(function(t,e){return f(m(t))})).attr("x2",F).attr("y2",(function(t,e){return f(m(t))}));var x=L.selectAll(".nv-boxplot-outlier").data((function(t){return y(t)||[]}));x.enter().append("circle").style("fill",(function(t,e,n){return b(t,e,n)||C(t,n)})).style("stroke",(function(t,e,n){return b(t,e,n)||C(t,n)})).style("z-index",9e3).on("mouseover",(function(t,e,n){d3.select(this).classed("hover",!0),N.elementMouseover({series:{key:A(t,e,n),color:b(t,e,n)||C(t,n)},e:d3.event})})).on("mouseout",(function(t,e,n){d3.select(this).classed("hover",!1),N.elementMouseout({series:{key:A(t,e,n),color:b(t,e,n)||C(t,n)},e:d3.event})})).on("mousemove",(function(t,e){N.elementMousemove({e:d3.event})})),x.attr("class","nv-boxplot-outlier"),x.watchTransition(w,"nv-boxplot: nv-boxplot-outlier").attr("cx",.45*h.rangeBand()).attr("cy",(function(t,e,n){return f(E(t,e,n))})).attr("r","3"),x.exit().remove(),s=h.copy(),o=f.copy()})),w.renderEnd("nv-boxplot immediate"),P}return P.dispatch=N,P.options=i.utils.optionsFunc.bind(P),P._options=(0,r.default)({},{width:{get:function(){return l},set:function(t){l=t}},height:{get:function(){return u},set:function(t){u=t}},maxBoxWidth:{get:function(){return I},set:function(t){I=t}},x:{get:function(){return p},set:function(t){p=t}},q1:{get:function(){return g},set:function(t){g=t}},q2:{get:function(){return m},set:function(t){m=t}},q3:{get:function(){return _},set:function(t){_=t}},wl:{get:function(){return v},set:function(t){v=t}},wh:{get:function(){return S},set:function(t){S=t}},itemColor:{get:function(){return T},set:function(t){T=t}},outliers:{get:function(){return y},set:function(t){y=t}},outlierValue:{get:function(){return E},set:function(t){E=t}},outlierLabel:{get:function(){return A},set:function(t){A=t}},outlierColor:{get:function(){return b},set:function(t){b=t}},xScale:{get:function(){return h},set:function(t){h=t}},yScale:{get:function(){return f},set:function(t){f=t}},xDomain:{get:function(){return t},set:function(e){t=e}},yDomain:{get:function(){return n},set:function(t){n=t}},xRange:{get:function(){return e},set:function(t){e=t}},yRange:{get:function(){return a},set:function(t){a=t}},id:{get:function(){return d},set:function(t){d=t}},y:{get:function(){return console.warn("BoxPlot 'y' chart option is deprecated. Please use model overrides instead."),{}},set:function(t){console.warn("BoxPlot 'y' chart option is deprecated. Please use model overrides instead.")}},margin:{get:function(){return c},set:function(t){c.top=void 0!==t.top?t.top:c.top,c.right=void 0!==t.right?t.right:c.right,c.bottom=void 0!==t.bottom?t.bottom:c.bottom,c.left=void 0!==t.left?t.left:c.left}},color:{get:function(){return C},set:function(t){C=i.utils.getColor(t)}},duration:{get:function(){return O},set:function(t){O=t,w.reset(O)}}}),i.utils.initOptions(P),P},i.models.bullet=function(){var t={top:0,right:0,bottom:0,left:0},e="left",n=!1,a=function(t){return t.ranges},s=function(t){return t.markers?t.markers:[]},o=function(t){return t.markerLines?t.markerLines:[0]},c=function(t){return t.measures},l=function(t){return t.rangeLabels?t.rangeLabels:[]},u=function(t){return t.markerLabels?t.markerLabels:[]},d=function(t){return t.markerLineLabels?t.markerLineLabels:[]},h=function(t){return t.measureLabels?t.measureLabels:[]},f=[0],p=380,g=30,m=null,_=null,v=i.utils.getColor(["#1f77b4"]),S=d3.dispatch("elementMouseover","elementMouseout","elementMousemove"),T=["Maximum","Mean","Minimum"],y=["Max","Avg","Min"],E=1e3;function A(t,e){var n=t.slice();t.sort((function(t,i){var a=n.indexOf(t),s=n.indexOf(i);return d3.descending(e[a],e[s])}))}function b(e){return e.each((function(e,r){var _=p-t.left-t.right,b=g-t.top-t.bottom;m=d3.select(this),i.utils.initSVG(m);var C=a.call(this,e,r).slice(),$=s.call(this,e,r).slice(),N=o.call(this,e,r).slice(),O=c.call(this,e,r).slice(),I=l.call(this,e,r).slice(),w=u.call(this,e,r).slice(),P=d.call(this,e,r).slice(),M=h.call(this,e,r).slice();A(I,C),A(w,$),A(P,N),A(M,O),C.sort(d3.descending),$.sort(d3.descending),N.sort(d3.descending),O.sort(d3.descending);var R=d3.scale.linear().domain(d3.extent(d3.merge([f,C]))).range(n?[_,0]:[0,_]);this.__chart__||d3.scale.linear().domain([0,1/0]).range(R.range()),this.__chart__=R,d3.min(C),d3.max(C),C[1];for(var D=m.selectAll("g.nv-wrap.nv-bullet").data([e]),L=D.enter().append("g").attr("class","nvd3 nv-wrap nv-bullet").append("g"),k=D.select("g"),B=(r=0,C.length);r<B;r++){var U="nv-range nv-range"+r;r<=2&&(U=U+" nv-range"+y[r]),L.append("rect").attr("class",U)}L.append("rect").attr("class","nv-measure"),D.attr("transform","translate("+t.left+","+t.top+")");var F=function(t){return Math.abs(R(t)-R(0))},x=function(t){return R(t<0?t:0)};for(r=0,B=C.length;r<B;r++){var Y=C[r];k.select("rect.nv-range"+r).datum(Y).attr("height",b).transition().duration(E).attr("width",F(Y)).attr("x",x(Y))}k.select("rect.nv-measure").style("fill",v).attr("height",b/3).attr("y",b/3).on("mouseover",(function(){S.elementMouseover({value:O[0],label:M[0]||"Current",color:d3.select(this).style("fill")})})).on("mousemove",(function(){S.elementMousemove({value:O[0],label:M[0]||"Current",color:d3.select(this).style("fill")})})).on("mouseout",(function(){S.elementMouseout({value:O[0],label:M[0]||"Current",color:d3.select(this).style("fill")})})).transition().duration(E).attr("width",O<0?R(0)-R(O[0]):R(O[0])-R(0)).attr("x",x(O));var G=b/6,V=$.map((function(t,e){return{value:t,label:w[e]}}));L.selectAll("path.nv-markerTriangle").data(V).enter().append("path").attr("class","nv-markerTriangle").attr("d","M0,"+G+"L"+G+","+-G+" "+-G+","+-G+"Z").on("mouseover",(function(t){S.elementMouseover({value:t.value,label:t.label||"Previous",color:d3.select(this).style("fill"),pos:[R(t.value),b/2]})})).on("mousemove",(function(t){S.elementMousemove({value:t.value,label:t.label||"Previous",color:d3.select(this).style("fill")})})).on("mouseout",(function(t,e){S.elementMouseout({value:t.value,label:t.label||"Previous",color:d3.select(this).style("fill")})})),k.selectAll("path.nv-markerTriangle").data(V).transition().duration(E).attr("transform",(function(t){return"translate("+R(t.value)+","+b/2+")"}));var q=N.map((function(t,e){return{value:t,label:P[e]}}));L.selectAll("line.nv-markerLine").data(q).enter().append("line").attr("cursor","").attr("class","nv-markerLine").attr("x1",(function(t){return R(t.value)})).attr("y1","2").attr("x2",(function(t){return R(t.value)})).attr("y2",b-2).on("mouseover",(function(t){S.elementMouseover({value:t.value,label:t.label||"Previous",color:d3.select(this).style("fill"),pos:[R(t.value),b/2]})})).on("mousemove",(function(t){S.elementMousemove({value:t.value,label:t.label||"Previous",color:d3.select(this).style("fill")})})).on("mouseout",(function(t,e){S.elementMouseout({value:t.value,label:t.label||"Previous",color:d3.select(this).style("fill")})})),k.selectAll("line.nv-markerLine").data(q).transition().duration(E).attr("x1",(function(t){return R(t.value)})).attr("x2",(function(t){return R(t.value)})),D.selectAll(".nv-range").on("mouseover",(function(t,e){var n=I[e]||T[e];S.elementMouseover({value:t,label:n,color:d3.select(this).style("fill")})})).on("mousemove",(function(){S.elementMousemove({value:O[0],label:M[0]||"Previous",color:d3.select(this).style("fill")})})).on("mouseout",(function(t,e){var n=I[e]||T[e];S.elementMouseout({value:t,label:n,color:d3.select(this).style("fill")})}))})),b}return b.dispatch=S,b.options=i.utils.optionsFunc.bind(b),b._options=(0,r.default)({},{ranges:{get:function(){return a},set:function(t){a=t}},markers:{get:function(){return s},set:function(t){s=t}},measures:{get:function(){return c},set:function(t){c=t}},forceX:{get:function(){return f},set:function(t){f=t}},width:{get:function(){return p},set:function(t){p=t}},height:{get:function(){return g},set:function(t){g=t}},tickFormat:{get:function(){return _},set:function(t){_=t}},duration:{get:function(){return E},set:function(t){E=t}},margin:{get:function(){return t},set:function(e){t.top=void 0!==e.top?e.top:t.top,t.right=void 0!==e.right?e.right:t.right,t.bottom=void 0!==e.bottom?e.bottom:t.bottom,t.left=void 0!==e.left?e.left:t.left}},orient:{get:function(){return e},set:function(t){n="right"==(e=t)||"bottom"==e}},color:{get:function(){return v},set:function(t){v=i.utils.getColor(t)}}}),i.utils.initOptions(b),b},i.models.candlestickBar=function(){var t,e,n,a,s,o={top:0,right:0,bottom:0,left:0},c=null,l=null,u=Math.floor(1e4*Math.random()),d=d3.scale.linear(),h=d3.scale.linear(),f=function(t){return t.x},p=function(t){return t.y},g=function(t){return t.open},m=function(t){return t.close},_=function(t){return t.high},v=function(t){return t.low},S=[],T=[],y=!1,E=!0,A=i.utils.defaultColor(),b=!1,C=d3.dispatch("stateChange","changeState","renderEnd","chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove");function $(r){return r.each((function(r){t=d3.select(this);var A=i.utils.availableWidth(c,t,o),b=i.utils.availableHeight(l,t,o);i.utils.initSVG(t);var $=A/r[0].values.length*.45;d.domain(e||d3.extent(r[0].values.map(f).concat(S))),y?d.range(a||[.5*A/r[0].values.length,A*(r[0].values.length-.5)/r[0].values.length]):d.range(a||[5+$/2,A-$/2-5]),h.domain(n||[d3.min(r[0].values.map(v).concat(T)),d3.max(r[0].values.map(_).concat(T))]).range(s||[b,0]),d.domain()[0]===d.domain()[1]&&(d.domain()[0]?d.domain([d.domain()[0]-.01*d.domain()[0],d.domain()[1]+.01*d.domain()[1]]):d.domain([-1,1])),h.domain()[0]===h.domain()[1]&&(h.domain()[0]?h.domain([h.domain()[0]+.01*h.domain()[0],h.domain()[1]-.01*h.domain()[1]]):h.domain([-1,1]));var N=d3.select(this).selectAll("g.nv-wrap.nv-candlestickBar").data([r[0].values]),O=N.enter().append("g").attr("class","nvd3 nv-wrap nv-candlestickBar"),I=O.append("defs"),w=O.append("g"),P=N.select("g");w.append("g").attr("class","nv-ticks"),N.attr("transform","translate("+o.left+","+o.top+")"),t.on("click",(function(t,e){C.chartClick({data:t,index:e,pos:d3.event,id:u})})),I.append("clipPath").attr("id","nv-chart-clip-path-"+u).append("rect"),N.select("#nv-chart-clip-path-"+u+" rect").attr("width",A).attr("height",b),P.attr("clip-path",E?"url(#nv-chart-clip-path-"+u+")":"");var M=N.select(".nv-ticks").selectAll(".nv-tick").data((function(t){return t}));M.exit().remove();var R=M.enter().append("g");M.attr("class",(function(t,e,n){return(g(t,e)>m(t,e)?"nv-tick negative":"nv-tick positive")+" nv-tick-"+n+"-"+e})),R.append("line").attr("class","nv-candlestick-lines").attr("transform",(function(t,e){return"translate("+d(f(t,e))+",0)"})).attr("x1",0).attr("y1",(function(t,e){return h(_(t,e))})).attr("x2",0).attr("y2",(function(t,e){return h(v(t,e))})),R.append("rect").attr("class","nv-candlestick-rects nv-bars").attr("transform",(function(t,e){return"translate("+(d(f(t,e))-$/2)+","+(h(p(t,e))-(g(t,e)>m(t,e)?h(m(t,e))-h(g(t,e)):0))+")"})).attr("x",0).attr("y",0).attr("width",$).attr("height",(function(t,e){var n=g(t,e),i=m(t,e);return n>i?h(i)-h(n):h(n)-h(i)})),M.select(".nv-candlestick-lines").transition().attr("transform",(function(t,e){return"translate("+d(f(t,e))+",0)"})).attr("x1",0).attr("y1",(function(t,e){return h(_(t,e))})).attr("x2",0).attr("y2",(function(t,e){return h(v(t,e))})),M.select(".nv-candlestick-rects").transition().attr("transform",(function(t,e){return"translate("+(d(f(t,e))-$/2)+","+(h(p(t,e))-(g(t,e)>m(t,e)?h(m(t,e))-h(g(t,e)):0))+")"})).attr("x",0).attr("y",0).attr("width",$).attr("height",(function(t,e){var n=g(t,e),i=m(t,e);return n>i?h(i)-h(n):h(n)-h(i)}))})),$}return $.highlightPoint=function(e,n){$.clearHighlights(),t.select(".nv-candlestickBar .nv-tick-0-"+e).classed("hover",n)},$.clearHighlights=function(){t.select(".nv-candlestickBar .nv-tick.hover").classed("hover",!1)},$.dispatch=C,$.options=i.utils.optionsFunc.bind($),$._options=(0,r.default)({},{width:{get:function(){return c},set:function(t){c=t}},height:{get:function(){return l},set:function(t){l=t}},xScale:{get:function(){return d},set:function(t){d=t}},yScale:{get:function(){return h},set:function(t){h=t}},xDomain:{get:function(){return e},set:function(t){e=t}},yDomain:{get:function(){return n},set:function(t){n=t}},xRange:{get:function(){return a},set:function(t){a=t}},yRange:{get:function(){return s},set:function(t){s=t}},forceX:{get:function(){return S},set:function(t){S=t}},forceY:{get:function(){return T},set:function(t){T=t}},padData:{get:function(){return y},set:function(t){y=t}},clipEdge:{get:function(){return E},set:function(t){E=t}},id:{get:function(){return u},set:function(t){u=t}},interactive:{get:function(){return b},set:function(t){b=t}},x:{get:function(){return f},set:function(t){f=t}},y:{get:function(){return p},set:function(t){p=t}},open:{get:function(){return g()},set:function(t){g=t}},close:{get:function(){return m()},set:function(t){m=t}},high:{get:function(){return _},set:function(t){_=t}},low:{get:function(){return v},set:function(t){v=t}},margin:{get:function(){return o},set:function(t){o.top=null!=t.top?t.top:o.top,o.right=null!=t.right?t.right:o.right,o.bottom=null!=t.bottom?t.bottom:o.bottom,o.left=null!=t.left?t.left:o.left}},color:{get:function(){return A},set:function(t){A=i.utils.getColor(t)}}}),i.utils.initOptions($),$},i.models.discreteBar=function(){var t,e,n,a,s,o,c,l={top:0,right:0,bottom:0,left:0},u=960,d=500,h=Math.floor(1e4*Math.random()),f=d3.scale.ordinal(),p=d3.scale.linear(),g=function(t){return t.x},m=function(t){return t.y},_=[0],v=i.utils.defaultColor(),S=!1,T=d3.format(",.2f"),y=d3.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove","renderEnd"),E="discreteBar",A=250,b=i.utils.renderWatch(y,A);function C(r){return b.reset(),r.each((function(r){var h=u-l.left-l.right,A=d-l.top-l.bottom;t=d3.select(this),i.utils.initSVG(t),r.forEach((function(t,e){t.values.forEach((function(t){t.series=e}))}));var C=e&&n?[]:r.map((function(t){return t.values.map((function(t,e){return{x:g(t,e),y:m(t,e),y0:t.y0}}))}));f.domain(e||d3.merge(C).map((function(t){return t.x}))).rangeBands(a||[0,h],.1),p.domain(n||d3.extent(d3.merge(C).map((function(t){return t.y})).concat(_))),S?p.range(s||[A-(p.domain()[0]<0?12:0),p.domain()[1]>0?12:0]):p.range(s||[A,0]),o=o||f,c=c||p.copy().range([p(0),p(0)]);var $=t.selectAll("g.nv-wrap.nv-discretebar").data([r]),N=$.enter().append("g").attr("class","nvd3 nv-wrap nv-discretebar").append("g");$.select("g"),N.append("g").attr("class","nv-groups"),$.attr("transform","translate("+l.left+","+l.top+")");var O=$.select(".nv-groups").selectAll(".nv-group").data((function(t){return t}),(function(t){return t.key}));O.enter().append("g").style("stroke-opacity",1e-6).style("fill-opacity",1e-6),O.exit().watchTransition(b,"discreteBar: exit groups").style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove(),O.attr("class",(function(t,e){return"nv-group nv-series-"+e})).classed("hover",(function(t){return t.hover})),O.watchTransition(b,"discreteBar: groups").style("stroke-opacity",1).style("fill-opacity",.75);var I=O.selectAll("g.nv-bar").data((function(t){return t.values}));I.exit().remove();var w=I.enter().append("g").attr("transform",(function(t,e,n){return"translate("+(f(g(t,e))+.05*f.rangeBand())+", "+p(0)+")"})).on("mouseover",(function(t,e){d3.select(this).classed("hover",!0),y.elementMouseover({data:t,index:e,color:d3.select(this).style("fill")})})).on("mouseout",(function(t,e){d3.select(this).classed("hover",!1),y.elementMouseout({data:t,index:e,color:d3.select(this).style("fill")})})).on("mousemove",(function(t,e){y.elementMousemove({data:t,index:e,color:d3.select(this).style("fill")})})).on("click",(function(t,e){y.elementClick({data:t,index:e,color:d3.select(this).style("fill"),event:d3.event,element:this}),d3.event.stopPropagation()})).on("dblclick",(function(t,e){y.elementDblClick({data:t,index:e,color:d3.select(this).style("fill")}),d3.event.stopPropagation()}));w.append("rect").attr("height",0).attr("width",.9*f.rangeBand()/r.length),S?(w.append("text").attr("text-anchor","middle"),I.select("text").text((function(t,e){return T(m(t,e))})).watchTransition(b,"discreteBar: bars text").attr("x",.9*f.rangeBand()/2).attr("y",(function(t,e){return m(t,e)<0?p(m(t,e))-p(0)+12:-4}))):I.selectAll("text").remove(),I.attr("class",(function(t,e){return m(t,e)<0?"nv-bar negative":"nv-bar positive"})).style("fill",(function(t,e){return t.color||v(t,e)})).style("stroke",(function(t,e){return t.color||v(t,e)})).select("rect").attr("class",E).watchTransition(b,"discreteBar: bars rect").attr("width",.9*f.rangeBand()/r.length),I.watchTransition(b,"discreteBar: bars").attr("transform",(function(t,e){return"translate("+(f(g(t,e))+.05*f.rangeBand())+", "+(m(t,e)<0?p(0):p(0)-p(m(t,e))<1?p(0)-1:p(m(t,e)))+")"})).select("rect").attr("height",(function(t,e){return Math.max(Math.abs(p(m(t,e))-p(0)),1)})),o=f.copy(),c=p.copy()})),b.renderEnd("discreteBar immediate"),C}return C.dispatch=y,C.options=i.utils.optionsFunc.bind(C),C._options=(0,r.default)({},{width:{get:function(){return u},set:function(t){u=t}},height:{get:function(){return d},set:function(t){d=t}},forceY:{get:function(){return _},set:function(t){_=t}},showValues:{get:function(){return S},set:function(t){S=t}},x:{get:function(){return g},set:function(t){g=t}},y:{get:function(){return m},set:function(t){m=t}},xScale:{get:function(){return f},set:function(t){f=t}},yScale:{get:function(){return p},set:function(t){p=t}},xDomain:{get:function(){return e},set:function(t){e=t}},yDomain:{get:function(){return n},set:function(t){n=t}},xRange:{get:function(){return a},set:function(t){a=t}},yRange:{get:function(){return s},set:function(t){s=t}},valueFormat:{get:function(){return T},set:function(t){T=t}},id:{get:function(){return h},set:function(t){h=t}},rectClass:{get:function(){return E},set:function(t){E=t}},margin:{get:function(){return l},set:function(t){l.top=void 0!==t.top?t.top:l.top,l.right=void 0!==t.right?t.right:l.right,l.bottom=void 0!==t.bottom?t.bottom:l.bottom,l.left=void 0!==t.left?t.left:l.left}},color:{get:function(){return v},set:function(t){v=i.utils.getColor(t)}},duration:{get:function(){return A},set:function(t){A=t,b.reset(A)}}}),i.utils.initOptions(C),C},i.models.discreteBarChart=function(){var t,e,n=i.models.discreteBar(),a=i.models.axis(),s=i.models.axis(),o=i.models.legend(),c=i.models.tooltip(),l={top:15,right:10,bottom:50,left:60},u=null,d=null,h=null,f=i.utils.getColor(),p=!1,g=!0,m=!0,_=!1,v=!1,S=!1,T=0,y=null,E=d3.dispatch("beforeUpdate","renderEnd"),A=250;a.orient("bottom").showMaxMin(!1).tickFormat((function(t){return t})),s.orient(_?"right":"left").tickFormat(d3.format(",.1f")),c.duration(0).headerEnabled(!1).valueFormatter((function(t,e){return s.tickFormat()(t,e)})).keyFormatter((function(t,e){return a.tickFormat()(t,e)}));var b=i.utils.renderWatch(E,A);function C(r){return b.reset(),b.models(n),g&&b.models(a),m&&b.models(s),r.each((function(r){var c=d3.select(this);i.utils.initSVG(c);var f=i.utils.availableWidth(d,c,l),y=i.utils.availableHeight(h,c,l);if(C.update=function(){E.beforeUpdate(),c.transition().duration(A).call(C)},C.container=this,!(r&&r.length&&r.filter((function(t){return t.values.length})).length))return i.utils.noData(C,c),C;c.selectAll(".nv-noData").remove(),t=n.xScale(),e=n.yScale().clamp(!0);var b=c.selectAll("g.nv-wrap.nv-discreteBarWithAxes").data([r]),$=b.enter().append("g").attr("class","nvd3 nv-wrap nv-discreteBarWithAxes").append("g"),N=$.append("defs"),O=b.select("g");if($.append("g").attr("class","nv-x nv-axis"),$.append("g").attr("class","nv-y nv-axis").append("g").attr("class","nv-zeroLine").append("line"),$.append("g").attr("class","nv-barsWrap"),$.append("g").attr("class","nv-legendWrap"),O.attr("transform","translate("+l.left+","+l.top+")"),p?(o.width(f),O.select(".nv-legendWrap").datum(r).call(o),u||o.height()===l.top||(l.top=o.height(),y=i.utils.availableHeight(h,c,l)),b.select(".nv-legendWrap").attr("transform","translate(0,"+-l.top+")")):O.select(".nv-legendWrap").selectAll("*").remove(),_&&O.select(".nv-y.nv-axis").attr("transform","translate("+f+",0)"),n.width(f).height(y),O.select(".nv-barsWrap").datum(r.filter((function(t){return!t.disabled}))).transition().call(n),N.append("clipPath").attr("id","nv-x-label-clip-"+n.id()).append("rect"),O.select("#nv-x-label-clip-"+n.id()+" rect").attr("width",t.rangeBand()*(v?2:1)).attr("height",16).attr("x",-t.rangeBand()/(v?1:2)),g){a.scale(t)._ticks(i.utils.calcTicksX(f/100,r)).tickSize(-y,0),O.select(".nv-x.nv-axis").attr("transform","translate(0,"+(e.range()[0]+(n.showValues()&&e.domain()[0]<0?16:0))+")"),O.select(".nv-x.nv-axis").call(a);var I=O.select(".nv-x.nv-axis").selectAll("g");v&&I.selectAll("text").attr("transform",(function(t,e,n){return"translate(0,"+(n%2==0?"5":"17")+")"})),T&&I.selectAll(".tick text").attr("transform","rotate("+T+" 0,0)").style("text-anchor",T>0?"start":"end"),S&&O.selectAll(".tick text").call(i.utils.wrapTicks,C.xAxis.rangeBand())}m&&(s.scale(e)._ticks(i.utils.calcTicksY(y/36,r)).tickSize(-f,0),O.select(".nv-y.nv-axis").call(s)),O.select(".nv-zeroLine line").attr("x1",0).attr("x2",_?-f:f).attr("y1",e(0)).attr("y2",e(0))})),b.renderEnd("discreteBar chart immediate"),C}return n.dispatch.on("elementMouseover.tooltip",(function(t){t.series={key:C.x()(t.data),value:C.y()(t.data),color:t.color},c.data(t).hidden(!1)})),n.dispatch.on("elementMouseout.tooltip",(function(t){c.hidden(!0)})),n.dispatch.on("elementMousemove.tooltip",(function(t){c()})),C.dispatch=E,C.discretebar=n,C.legend=o,C.xAxis=a,C.yAxis=s,C.tooltip=c,C.options=i.utils.optionsFunc.bind(C),C._options=(0,r.default)({},{width:{get:function(){return d},set:function(t){d=t}},height:{get:function(){return h},set:function(t){h=t}},showLegend:{get:function(){return p},set:function(t){p=t}},staggerLabels:{get:function(){return v},set:function(t){v=t}},rotateLabels:{get:function(){return T},set:function(t){T=t}},wrapLabels:{get:function(){return S},set:function(t){S=!!t}},showXAxis:{get:function(){return g},set:function(t){g=t}},showYAxis:{get:function(){return m},set:function(t){m=t}},noData:{get:function(){return y},set:function(t){y=t}},margin:{get:function(){return l},set:function(t){void 0!==t.top&&(l.top=t.top,u=t.top),l.right=void 0!==t.right?t.right:l.right,l.bottom=void 0!==t.bottom?t.bottom:l.bottom,l.left=void 0!==t.left?t.left:l.left}},duration:{get:function(){return A},set:function(t){A=t,b.reset(A),n.duration(A),a.duration(A),s.duration(A)}},color:{get:function(){return f},set:function(t){f=i.utils.getColor(t),n.color(f),o.color(f)}},rightAlignYAxis:{get:function(){return _},set:function(t){_=t,s.orient(t?"right":"left")}}}),i.utils.inheritOptions(C,n),i.utils.initOptions(C),C},i.models.distribution=function(){var t,e={top:0,right:0,bottom:0,left:0},n=400,a=8,s="x",r=function(t){return t[s]},o=i.utils.defaultColor(),c=d3.scale.linear(),l=250,u=d3.dispatch("renderEnd"),d=i.utils.renderWatch(u,l);function h(n){return d.reset(),n.each((function(n){"x"===s?(e.left,e.right):(e.top,e.bottom);var l="x"==s?"y":"x",u=d3.select(this);i.utils.initSVG(u),t=t||c;var h=u.selectAll("g.nv-distribution").data([n]),f=(h.enter().append("g").attr("class","nvd3 nv-distribution").append("g"),h.select("g"));h.attr("transform","translate("+e.left+","+e.top+")");var p=f.selectAll("g.nv-dist").data((function(t){return t}),(function(t){return t.key}));p.enter().append("g"),p.attr("class",(function(t,e){return"nv-dist nv-series-"+e})).style("stroke",(function(t,e){return o(t,e)}));var g=p.selectAll("line.nv-dist"+s).data((function(t){return t.values}));g.enter().append("line").attr(s+"1",(function(e,n){return t(r(e,n))})).attr(s+"2",(function(e,n){return t(r(e,n))})),d.transition(p.exit().selectAll("line.nv-dist"+s),"dist exit").attr(s+"1",(function(t,e){return c(r(t,e))})).attr(s+"2",(function(t,e){return c(r(t,e))})).style("stroke-opacity",0).remove(),g.attr("class",(function(t,e){return"nv-dist"+s+" nv-dist"+s+"-"+e})).attr(l+"1",0).attr(l+"2",a),d.transition(g,"dist").attr(s+"1",(function(t,e){return c(r(t,e))})).attr(s+"2",(function(t,e){return c(r(t,e))})),t=c.copy()})),d.renderEnd("distribution immediate"),h}return h.options=i.utils.optionsFunc.bind(h),h.dispatch=u,h.margin=function(t){return arguments.length?(e.top=void 0!==t.top?t.top:e.top,e.right=void 0!==t.right?t.right:e.right,e.bottom=void 0!==t.bottom?t.bottom:e.bottom,e.left=void 0!==t.left?t.left:e.left,h):e},h.width=function(t){return arguments.length?(n=t,h):n},h.axis=function(t){return arguments.length?(s=t,h):s},h.size=function(t){return arguments.length?(a=t,h):a},h.getData=function(t){return arguments.length?(r=d3.functor(t),h):r},h.scale=function(t){return arguments.length?(c=t,h):c},h.color=function(t){return arguments.length?(o=i.utils.getColor(t),h):o},h.duration=function(t){return arguments.length?(l=t,d.reset(l),h):l},h},i.models.focus=function(t){t=t||i.models.line();var e,n,a=i.models.axis(),s=i.models.axis(),o=d3.svg.brush(),c={top:10,right:0,bottom:30,left:0},l=i.utils.defaultColor(),u=null,d=70,h=!0,f=!1,p=!1,g=null,m=250,_=d3.dispatch("brush","onBrush","renderEnd"),v=!0;t.interactive(!1),t.pointActive((function(t){return!1}));var S=i.utils.renderWatch(_,m);function T(r){return S.reset(),S.models(t),h&&S.models(a),f&&S.models(s),r.each((function(r){var S=d3.select(this);i.utils.initSVG(S);var y=i.utils.availableWidth(u,S,c),E=d-c.top-c.bottom;T.update=function(){0===m?S.call(T):S.transition().duration(m).call(T)},T.container=this,e=t.xScale(),n=t.yScale();var A=S.selectAll("g.nv-focus").data([r]),b=A.enter().append("g").attr("class","nvd3 nv-focus").append("g"),C=A.select("g");A.attr("transform","translate("+c.left+","+c.top+")"),b.append("g").attr("class","nv-background").append("rect"),b.append("g").attr("class","nv-x nv-axis"),b.append("g").attr("class","nv-y nv-axis"),b.append("g").attr("class","nv-contentWrap"),b.append("g").attr("class","nv-brushBackground"),b.append("g").attr("class","nv-x nv-brush"),p&&C.select(".nv-y.nv-axis").attr("transform","translate("+y+",0)"),C.select(".nv-background rect").attr("width",y).attr("height",E),t.width(y).height(E).color(r.map((function(t,e){return t.color||l(t,e)})).filter((function(t,e){return!r[e].disabled})));var $=C.select(".nv-contentWrap").datum(r.filter((function(t){return!t.disabled})));d3.transition($).call(t),o.x(e).on("brush",(function(){w(v)})),o.on("brushend",(function(){v||_.onBrush(o.empty()?e.domain():o.extent())})),g&&o.extent(g);var N=C.select(".nv-brushBackground").selectAll("g").data([g||o.extent()]),O=N.enter().append("g");O.append("rect").attr("class","left").attr("x",0).attr("y",0).attr("height",E),O.append("rect").attr("class","right").attr("x",0).attr("y",0).attr("height",E);var I=C.select(".nv-x.nv-brush").call(o);function w(t){g=o.empty()?null:o.extent();var n=o.empty()?e.domain():o.extent();_.brush({extent:n,brush:o}),o.empty()||o.extent(g),N.data([o.empty()?e.domain():g]).each((function(t,n){var i=e(t[0])-e.range()[0],a=y-e(t[1]);d3.select(this).select(".left").attr("width",i<0?0:i),d3.select(this).select(".right").attr("x",e(t[1])).attr("width",a<0?0:a)})),t&&_.onBrush(n)}I.selectAll("rect").attr("height",E),I.selectAll(".resize").append("path").attr("d",(function(t){var e=+("e"==t),n=e?1:-1,i=E/3;return"M"+.5*n+","+i+"A6,6 0 0 "+e+" "+6.5*n+","+(i+6)+"V"+(2*i-6)+"A6,6 0 0 "+e+" "+.5*n+","+2*i+"ZM"+2.5*n+","+(i+8)+"V"+(2*i-8)+"M"+4.5*n+","+(i+8)+"V"+(2*i-8)})),w(!0),C.select(".nv-background rect").attr("width",y).attr("height",E),h&&(a.scale(e)._ticks(i.utils.calcTicksX(y/100,r)).tickSize(-E,0),C.select(".nv-x.nv-axis").attr("transform","translate(0,"+n.range()[0]+")"),d3.transition(C.select(".nv-x.nv-axis")).call(a)),f&&(s.scale(n)._ticks(i.utils.calcTicksY(E/36,r)).tickSize(-y,0),d3.transition(C.select(".nv-y.nv-axis")).call(s)),C.select(".nv-x.nv-axis").attr("transform","translate(0,"+n.range()[0]+")")})),S.renderEnd("focus immediate"),T}return T.dispatch=_,T.content=t,T.brush=o,T.xAxis=a,T.yAxis=s,T.options=i.utils.optionsFunc.bind(T),T._options=(0,r.default)({},{width:{get:function(){return u},set:function(t){u=t}},height:{get:function(){return d},set:function(t){d=t}},showXAxis:{get:function(){return h},set:function(t){h=t}},showYAxis:{get:function(){return f},set:function(t){f=t}},brushExtent:{get:function(){return g},set:function(t){g=t}},syncBrushing:{get:function(){return v},set:function(t){v=t}},margin:{get:function(){return c},set:function(t){c.top=void 0!==t.top?t.top:c.top,c.right=void 0!==t.right?t.right:c.right,c.bottom=void 0!==t.bottom?t.bottom:c.bottom,c.left=void 0!==t.left?t.left:c.left}},duration:{get:function(){return m},set:function(e){m=e,S.reset(m),t.duration(m),a.duration(m),s.duration(m)}},color:{get:function(){return l},set:function(e){l=i.utils.getColor(e),t.color(l)}},interpolate:{get:function(){return t.interpolate()},set:function(e){t.interpolate(e)}},xTickFormat:{get:function(){return a.tickFormat()},set:function(t){a.tickFormat(t)}},yTickFormat:{get:function(){return s.tickFormat()},set:function(t){s.tickFormat(t)}},x:{get:function(){return t.x()},set:function(e){t.x(e)}},y:{get:function(){return t.y()},set:function(e){t.y(e)}},rightAlignYAxis:{get:function(){return p},set:function(t){p=t,s.orient(p?"right":"left")}}}),i.utils.inheritOptions(T,t),i.utils.initOptions(T),T},i.models.furiousLegend=function(){var t={top:5,right:0,bottom:5,left:0},e=400,n=20,a=function(t){return t.key},s=function(t){return t},o=i.utils.getColor(),c=20,l=!0,u=28,d=!0,h=!0,f=!1,p=!1,g=d3.dispatch("legendClick","legendDblclick","legendMouseover","legendMouseout","stateChange"),m="classic";function _(r){function v(t,e){return"furious"!=m?"#000":p?t.disengaged?o(t,e):"#fff":p?void 0:t.disabled?o(t,e):"#fff"}function S(t,e){return p&&"furious"==m?t.disengaged?"#fff":o(t,e):t.disabled?"#fff":o(t,e)}return r.each((function(r){var _=e-t.left-t.right,T=d3.select(this);i.utils.initSVG(T);var y=T.selectAll("g.nv-legend").data([r]),E=(y.enter().append("g").attr("class","nvd3 nv-legend").append("g"),y.select("g"));y.attr("transform","translate("+t.left+","+t.top+")");var A,b=E.selectAll(".nv-series").data((function(t){return"furious"!=m?t:t.filter((function(t){return!!p||!t.disengaged}))})),C=b.enter().append("g").attr("class","nv-series");"classic"==m?(C.append("circle").style("stroke-width",2).attr("class","nv-legend-symbol").attr("r",5),A=b.select("circle")):"furious"==m&&(C.append("rect").style("stroke-width",2).attr("class","nv-legend-symbol").attr("rx",3).attr("ry",3),A=b.select("rect"),C.append("g").attr("class","nv-check-box").property("innerHTML",'<path d="M0.5,5 L22.5,5 L22.5,26.5 L0.5,26.5 L0.5,5 Z" class="nv-box"></path><path d="M5.5,12.8618467 L11.9185089,19.2803556 L31,0.198864511" class="nv-check"></path>').attr("transform","translate(-10,-8)scale(0.5)"),b.select(".nv-check-box").each((function(t,e){d3.select(this).selectAll("path").attr("stroke",v(t,e))}))),C.append("text").attr("text-anchor","start").attr("class","nv-legend-text").attr("dy",".32em").attr("dx","8");var $,N=b.select("text.nv-legend-text");switch(b.on("mouseover",(function(t,e){g.legendMouseover(t,e)})).on("mouseout",(function(t,e){g.legendMouseout(t,e)})).on("click",(function(t,e){g.legendClick(t,e);var n=b.data();h&&("classic"==m?f?(n.forEach((function(t){t.disabled=!0})),t.disabled=!1):(t.disabled=!t.disabled,n.every((function(t){return t.disabled}))&&n.forEach((function(t){t.disabled=!1}))):"furious"==m&&(p?(t.disengaged=!t.disengaged,t.userDisabled=null==t.userDisabled?!!t.disabled:t.userDisabled,t.disabled=t.disengaged||t.userDisabled):p||(t.disabled=!t.disabled,t.userDisabled=t.disabled,n.filter((function(t){return!t.disengaged})).every((function(t){return t.userDisabled}))&&n.forEach((function(t){t.disabled=t.userDisabled=!1})))),g.stateChange({disabled:n.map((function(t){return!!t.disabled})),disengaged:n.map((function(t){return!!t.disengaged}))}))})).on("dblclick",(function(t,e){if(("furious"!=m||!p)&&(g.legendDblclick(t,e),h)){var n=b.data();n.forEach((function(t){t.disabled=!0,"furious"==m&&(t.userDisabled=t.disabled)})),t.disabled=!1,"furious"==m&&(t.userDisabled=t.disabled),g.stateChange({disabled:n.map((function(t){return!!t.disabled}))})}})),b.classed("nv-disabled",(function(t){return t.userDisabled})),b.exit().remove(),N.attr("fill",v).text((function(t){return s(a(t))})),m){case"furious":$=23;break;case"classic":$=20}if(l){var O=[];b.each((function(t,e){var n,r;if(s(a(t))&&s(a(t)).length>c){var o=s(a(t)).substring(0,c);n=d3.select(this).select("text").text(o+"..."),d3.select(this).append("svg:title").text(s(a(t)))}else n=d3.select(this).select("text");try{if((r=n.node().getComputedTextLength())<=0)throw Error()}catch(t){r=i.utils.calcApproxTextWidth(n)}O.push(r+u)}));for(var I=0,w=0,P=[];w<_&&I<O.length;)P[I]=O[I],w+=O[I++];for(0===I&&(I=1);w>_&&I>1;){P=[],I--;for(var M=0;M<O.length;M++)O[M]>(P[M%I]||0)&&(P[M%I]=O[M]);w=P.reduce((function(t,e,n,i){return t+e}))}for(var R=[],D=0,L=0;D<I;D++)R[D]=L,L+=P[D];b.attr("transform",(function(t,e){return"translate("+R[e%I]+","+(5+Math.floor(e/I)*$)+")"})),d?E.attr("transform","translate("+(e-t.right-w)+","+t.top+")"):E.attr("transform","translate(0,"+t.top+")"),n=t.top+t.bottom+Math.ceil(O.length/I)*$}else{var k,B=5,U=5,F=0;b.attr("transform",(function(n,i){var a=d3.select(this).select("text").node().getComputedTextLength()+u;return k=U,e<t.left+t.right+k+a&&(U=k=5,B+=$),(U+=a)>F&&(F=U),"translate("+k+","+B+")"})),E.attr("transform","translate("+(e-t.right-F)+","+t.top+")"),n=t.top+t.bottom+B+15}"furious"==m&&A.attr("width",(function(t,e){return N[0][e].getComputedTextLength()+27})).attr("height",18).attr("y",-9).attr("x",-15),A.style("fill",S).style("stroke",(function(t,e){return t.color||o(t,e)}))})),_}return _.dispatch=g,_.options=i.utils.optionsFunc.bind(_),_._options=(0,r.default)({},{width:{get:function(){return e},set:function(t){e=t}},height:{get:function(){return n},set:function(t){n=t}},key:{get:function(){return a},set:function(t){a=t}},keyFormatter:{get:function(){return s},set:function(t){s=t}},align:{get:function(){return l},set:function(t){l=t}},rightAlign:{get:function(){return d},set:function(t){d=t}},maxKeyLength:{get:function(){return c},set:function(t){c=t}},padding:{get:function(){return u},set:function(t){u=t}},updateState:{get:function(){return h},set:function(t){h=t}},radioButtonMode:{get:function(){return f},set:function(t){f=t}},expanded:{get:function(){return p},set:function(t){p=t}},vers:{get:function(){return m},set:function(t){m=t}},margin:{get:function(){return t},set:function(e){t.top=void 0!==e.top?e.top:t.top,t.right=void 0!==e.right?e.right:t.right,t.bottom=void 0!==e.bottom?e.bottom:t.bottom,t.left=void 0!==e.left?e.left:t.left}},color:{get:function(){return o},set:function(t){o=i.utils.getColor(t)}}}),i.utils.initOptions(_),_},i.models.legend=function(){var t={top:5,right:0,bottom:5,left:0},e=400,n=20,a=function(t){return t.key},s=function(t){return t},o=i.utils.getColor(),c=20,l=!0,u=32,d=!0,h=!0,f=!0,p=!1,g=!1,m=d3.dispatch("legendClick","legendDblclick","legendMouseover","legendMouseout","stateChange"),_="classic";function v(r){function S(t,e){return"furious"!=_?"#000":g?t.disengaged?"#000":"#fff":g?void 0:(t.color||(t.color=o(t,e)),t.disabled?t.color:"#fff")}function T(t,e){return g&&"furious"==_&&t.disengaged?"#eee":t.color||o(t,e)}function y(t,e){return g&&"furious"==_?1:t.disabled?0:1}return r.each((function(r){var o=e-t.left-t.right,v=d3.select(this);i.utils.initSVG(v);var E=v.selectAll("g.nv-legend").data([r]),A=E.enter().append("g").attr("class","nvd3 nv-legend").append("g"),b=E.select("g");d?E.attr("transform","translate("+-t.right+","+t.top+")"):E.attr("transform","translate("+t.left+","+t.top+")");var C,$,N=b.selectAll(".nv-series").data((function(t){return"furious"!=_?t:t.filter((function(t){return!!g||!t.disengaged}))})),O=N.enter().append("g").attr("class","nv-series");switch(_){case"furious":$=23;break;case"classic":$=20}"classic"==_?(O.append("circle").style("stroke-width",2).attr("class","nv-legend-symbol").attr("r",5),C=N.select(".nv-legend-symbol")):"furious"==_&&(O.append("rect").style("stroke-width",2).attr("class","nv-legend-symbol").attr("rx",3).attr("ry",3),C=N.select(".nv-legend-symbol"),O.append("g").attr("class","nv-check-box").property("innerHTML",'<path d="M0.5,5 L22.5,5 L22.5,26.5 L0.5,26.5 L0.5,5 Z" class="nv-box"></path><path d="M5.5,12.8618467 L11.9185089,19.2803556 L31,0.198864511" class="nv-check"></path>').attr("transform","translate(-10,-8)scale(0.5)"),N.select(".nv-check-box").each((function(t,e){d3.select(this).selectAll("path").attr("stroke",S(t,e))}))),O.append("text").attr("text-anchor","start").attr("class","nv-legend-text").attr("dy",".32em").attr("dx","8");var I=N.select("text.nv-legend-text");N.on("mouseover",(function(t,e){m.legendMouseover(t,e)})).on("mouseout",(function(t,e){m.legendMouseout(t,e)})).on("click",(function(t,e){m.legendClick(t,e);var n=N.data();h&&("classic"==_?p?(n.forEach((function(t){t.disabled=!0})),t.disabled=!1):(t.disabled=!t.disabled,n.every((function(t){return t.disabled}))&&n.forEach((function(t){t.disabled=!1}))):"furious"==_&&(g?(t.disengaged=!t.disengaged,t.userDisabled=null==t.userDisabled?!!t.disabled:t.userDisabled,t.disabled=t.disengaged||t.userDisabled):g||(t.disabled=!t.disabled,t.userDisabled=t.disabled,n.filter((function(t){return!t.disengaged})).every((function(t){return t.userDisabled}))&&n.forEach((function(t){t.disabled=t.userDisabled=!1})))),m.stateChange({disabled:n.map((function(t){return!!t.disabled})),disengaged:n.map((function(t){return!!t.disengaged}))}))})).on("dblclick",(function(t,e){if(f){if("furious"==_&&g)return;if(m.legendDblclick(t,e),h){var n=N.data();n.forEach((function(t){t.disabled=!0,"furious"==_&&(t.userDisabled=t.disabled)})),t.disabled=!1,"furious"==_&&(t.userDisabled=t.disabled),m.stateChange({disabled:n.map((function(t){return!!t.disabled}))})}}})),N.classed("nv-disabled",(function(t){return t.userDisabled})),N.exit().remove(),I.attr("fill",S).text((function(t){return s(a(t))}));var w=0;if(l){var P=[];N.each((function(t,e){var n,r;if(s(a(t))&&s(a(t)).length>c){var o=s(a(t)).substring(0,c);n=d3.select(this).select("text").text(o+"..."),d3.select(this).append("svg:title").text(s(a(t)))}else n=d3.select(this).select("text");try{if((r=n.node().getComputedTextLength())<=0)throw Error()}catch(t){r=i.utils.calcApproxTextWidth(n)}P.push(r+u)}));var M=0,R=[];for(w=0;w<o&&M<P.length;)R[M]=P[M],w+=P[M++];for(0===M&&(M=1);w>o&&M>1;){R=[],M--;for(var D=0;D<P.length;D++)P[D]>(R[D%M]||0)&&(R[D%M]=P[D]);w=R.reduce((function(t,e,n,i){return t+e}))}for(var L=[],k=0,B=0;k<M;k++)L[k]=B,B+=R[k];N.attr("transform",(function(t,e){return"translate("+L[e%M]+","+(5+Math.floor(e/M)*$)+")"})),d?b.attr("transform","translate("+(e-t.right-w)+","+t.top+")"):b.attr("transform","translate(0,"+t.top+")"),n=t.top+t.bottom+Math.ceil(P.length/M)*$}else{var U,F=5,x=5,Y=0;N.attr("transform",(function(n,i){var a=d3.select(this).select("text").node().getComputedTextLength()+u;return U=x,e<t.left+t.right+U+a&&(x=U=5,F+=$),(x+=a)>Y&&(Y=x),w<U+Y&&(w=U+Y),"translate("+U+","+F+")"})),b.attr("transform","translate("+(e-t.right-Y)+","+t.top+")"),n=t.top+t.bottom+F+15}"furious"==_&&(C.attr("width",(function(t,e){return I[0][e].getComputedTextLength()+27})).attr("height",18).attr("y",-9).attr("x",-15),A.insert("rect",":first-child").attr("class","nv-legend-bg").attr("fill","#eee").attr("opacity",0),b.select(".nv-legend-bg").transition().duration(300).attr("x",-$).attr("width",w+$-12).attr("height",n+10).attr("y",-t.top-10).attr("opacity",g?1:0)),C.style("fill",T).style("fill-opacity",y).style("stroke",T)})),v}return v.dispatch=m,v.options=i.utils.optionsFunc.bind(v),v._options=(0,r.default)({},{width:{get:function(){return e},set:function(t){e=t}},height:{get:function(){return n},set:function(t){n=t}},key:{get:function(){return a},set:function(t){a=t}},keyFormatter:{get:function(){return s},set:function(t){s=t}},align:{get:function(){return l},set:function(t){l=t}},maxKeyLength:{get:function(){return c},set:function(t){c=t}},rightAlign:{get:function(){return d},set:function(t){d=t}},padding:{get:function(){return u},set:function(t){u=t}},updateState:{get:function(){return h},set:function(t){h=t}},enableDoubleClick:{get:function(){return f},set:function(t){f=t}},radioButtonMode:{get:function(){return p},set:function(t){p=t}},expanded:{get:function(){return g},set:function(t){g=t}},vers:{get:function(){return _},set:function(t){_=t}},margin:{get:function(){return t},set:function(e){t.top=void 0!==e.top?e.top:t.top,t.right=void 0!==e.right?e.right:t.right,t.bottom=void 0!==e.bottom?e.bottom:t.bottom,t.left=void 0!==e.left?e.left:t.left}},color:{get:function(){return o},set:function(t){o=i.utils.getColor(t)}}}),i.utils.initOptions(v),v},i.models.line=function(){var t,e,n=i.models.scatter(),a={top:0,right:0,bottom:0,left:0},s=960,o=500,c=null,l=1.5,u=i.utils.defaultColor(),d=function(t){return t.x},h=function(t){return t.y},f=function(t,e){return!isNaN(h(t,e))&&null!==h(t,e)},p=function(t){return t.area},g=!1,m="linear",_=250,v=d3.dispatch("elementClick","elementMouseover","elementMouseout","renderEnd");n.pointSize(16).pointDomain([16,256]);var S,T,y=i.utils.renderWatch(v,_);function E(r){return y.reset(),y.models(n),r.each((function(r){c=d3.select(this);var _=i.utils.availableWidth(s,c,a),v=i.utils.availableHeight(o,c,a);i.utils.initSVG(c),t=n.xScale(),e=n.yScale(),S=S||t,T=T||e;var E=c.selectAll("g.nv-wrap.nv-line").data([r]),A=E.enter().append("g").attr("class","nvd3 nv-wrap nv-line"),b=A.append("defs"),C=A.append("g"),$=E.select("g");C.append("g").attr("class","nv-groups"),C.append("g").attr("class","nv-scatterWrap"),E.attr("transform","translate("+a.left+","+a.top+")"),n.width(_).height(v);var N=E.select(".nv-scatterWrap");N.call(n),b.append("clipPath").attr("id","nv-edge-clip-"+n.id()).append("rect"),E.select("#nv-edge-clip-"+n.id()+" rect").attr("width",_).attr("height",v>0?v:0),$.attr("clip-path",g?"url(#nv-edge-clip-"+n.id()+")":""),N.attr("clip-path",g?"url(#nv-edge-clip-"+n.id()+")":"");var O=E.select(".nv-groups").selectAll(".nv-group").data((function(t){return t}),(function(t){return t.key}));O.enter().append("g").style("stroke-opacity",1e-6).style("stroke-width",(function(t){return t.strokeWidth||l})).style("fill-opacity",1e-6),O.exit().remove(),O.attr("class",(function(t,e){return(t.classed||"")+" nv-group nv-series-"+e})).classed("hover",(function(t){return t.hover})).style("fill",(function(t,e){return u(t,e)})).style("stroke",(function(t,e){return u(t,e)})),O.watchTransition(y,"line: groups").style("stroke-opacity",1).style("fill-opacity",(function(t){return t.fillOpacity||.5}));var I=O.selectAll("path.nv-area").data((function(t){return p(t)?[t]:[]}));I.enter().append("path").attr("class","nv-area").attr("d",(function(t){return d3.svg.area().interpolate(m).defined(f).x((function(t,e){return i.utils.NaNtoZero(S(d(t,e)))})).y0((function(t,e){return i.utils.NaNtoZero(T(h(t,e)))})).y1((function(t,n){return T(e.domain()[0]<=0?e.domain()[1]>=0?0:e.domain()[1]:e.domain()[0])})).apply(this,[t.values])})),O.exit().selectAll("path.nv-area").remove(),I.watchTransition(y,"line: areaPaths").attr("d",(function(n){return d3.svg.area().interpolate(m).defined(f).x((function(e,n){return i.utils.NaNtoZero(t(d(e,n)))})).y0((function(t,n){return i.utils.NaNtoZero(e(h(t,n)))})).y1((function(t,n){return e(e.domain()[0]<=0?e.domain()[1]>=0?0:e.domain()[1]:e.domain()[0])})).apply(this,[n.values])}));var w=O.selectAll("path.nv-line").data((function(t){return[t.values]}));w.enter().append("path").attr("class","nv-line").attr("d",d3.svg.line().interpolate(m).defined(f).x((function(t,e){return i.utils.NaNtoZero(S(d(t,e)))})).y((function(t,e){return i.utils.NaNtoZero(T(h(t,e)))}))),w.watchTransition(y,"line: linePaths").attr("d",d3.svg.line().interpolate(m).defined(f).x((function(e,n){return i.utils.NaNtoZero(t(d(e,n)))})).y((function(t,n){return i.utils.NaNtoZero(e(h(t,n)))}))),S=t.copy(),T=e.copy()})),y.renderEnd("line immediate"),E}return E.dispatch=v,E.scatter=n,n.dispatch.on("elementClick",(function(){v.elementClick.apply(this,arguments)})),n.dispatch.on("elementMouseover",(function(){v.elementMouseover.apply(this,arguments)})),n.dispatch.on("elementMouseout",(function(){v.elementMouseout.apply(this,arguments)})),E.options=i.utils.optionsFunc.bind(E),E._options=(0,r.default)({},{width:{get:function(){return s},set:function(t){s=t}},height:{get:function(){return o},set:function(t){o=t}},defined:{get:function(){return f},set:function(t){f=t}},interpolate:{get:function(){return m},set:function(t){m=t}},clipEdge:{get:function(){return g},set:function(t){g=t}},margin:{get:function(){return a},set:function(t){a.top=void 0!==t.top?t.top:a.top,a.right=void 0!==t.right?t.right:a.right,a.bottom=void 0!==t.bottom?t.bottom:a.bottom,a.left=void 0!==t.left?t.left:a.left}},duration:{get:function(){return _},set:function(t){_=t,y.reset(_),n.duration(_)}},isArea:{get:function(){return p},set:function(t){p=d3.functor(t)}},x:{get:function(){return d},set:function(t){d=t,n.x(t)}},y:{get:function(){return h},set:function(t){h=t,n.y(t)}},color:{get:function(){return u},set:function(t){u=i.utils.getColor(t),n.color(u)}}}),i.utils.inheritOptions(E,n),i.utils.initOptions(E),E},i.models.lineChart=function(){var t,e,n=i.models.line(),a=i.models.axis(),s=i.models.axis(),o=i.models.legend(),c=i.interactiveGuideline(),l=i.models.tooltip(),u=i.models.focus(i.models.line()),d={top:30,right:20,bottom:50,left:60},h=null,f=i.utils.defaultColor(),p=null,g=null,m=!0,_="top",v=!0,S=!0,T=!1,y=!1,E=!1,A=i.utils.state(),b=null,C=null,$=d3.dispatch("stateChange","changeState","renderEnd"),N=250;a.orient("bottom").tickPadding(7),s.orient(T?"right":"left"),n.clipEdge(!0).duration(0),l.valueFormatter((function(t,e){return s.tickFormat()(t,e)})).headerFormatter((function(t,e){return a.tickFormat()(t,e)})),c.tooltip.valueFormatter((function(t,e){return s.tickFormat()(t,e)})).headerFormatter((function(t,e){return a.tickFormat()(t,e)}));var O=i.utils.renderWatch($,N),I=function(t){return function(){return{active:t.map((function(t){return!t.disabled}))}}},w=function(t){return function(e){void 0!==e.active&&t.forEach((function(t,n){t.disabled=!e.active[n]}))}};function P(r){return O.reset(),O.models(n),v&&O.models(a),S&&O.models(s),r.each((function(r){var l=d3.select(this);i.utils.initSVG(l);var C,O=i.utils.availableWidth(p,l,d),M=i.utils.availableHeight(g,l,d)-(E?u.height():0);if(P.update=function(){0===N?l.call(P):l.transition().duration(N).call(P)},P.container=this,A.setter(w(r),P.update).getter(I(r)).update(),A.disabled=r.map((function(t){return!!t.disabled})),!b)for(C in b={},A)A[C]instanceof Array?b[C]=A[C].slice(0):b[C]=A[C];if(!(r&&r.length&&r.filter((function(t){return t.values.length})).length))return i.utils.noData(P,l),P;l.selectAll(".nv-noData").remove(),u.dispatch.on("onBrush",(function(t){Y(t)})),t=n.xScale(),e=n.yScale();var R=l.selectAll("g.nv-wrap.nv-lineChart").data([r]),D=R.enter().append("g").attr("class","nvd3 nv-wrap nv-lineChart").append("g"),L=R.select("g");D.append("g").attr("class","nv-legendWrap");var k=D.append("g").attr("class","nv-focus");k.append("g").attr("class","nv-background").append("rect"),k.append("g").attr("class","nv-x nv-axis"),k.append("g").attr("class","nv-y nv-axis"),k.append("g").attr("class","nv-linesWrap"),k.append("g").attr("class","nv-interactive"),D.append("g").attr("class","nv-focusWrap"),m?(o.width(O),L.select(".nv-legendWrap").datum(r).call(o),"bottom"===_?(d.bottom=a.height()+o.height(),M=i.utils.availableHeight(g,l,d),L.select(".nv-legendWrap").attr("transform","translate(0,"+(M+a.height())+")")):"top"===_&&(h||o.height()===d.top||(d.top=o.height(),M=i.utils.availableHeight(g,l,d)-(E?u.height():0)),R.select(".nv-legendWrap").attr("transform","translate(0,"+-d.top+")"))):L.select(".nv-legendWrap").selectAll("*").remove(),R.attr("transform","translate("+d.left+","+d.top+")"),T&&L.select(".nv-y.nv-axis").attr("transform","translate("+O+",0)"),y&&(c.width(O).height(M).margin({left:d.left,top:d.top}).svgContainer(l).xScale(t),R.select(".nv-interactive").call(c)),L.select(".nv-focus .nv-background rect").attr("width",O).attr("height",M),n.width(O).height(M).color(r.map((function(t,e){return t.color||f(t,e)})).filter((function(t,e){return!r[e].disabled})));var B=L.select(".nv-linesWrap").datum(r.filter((function(t){return!t.disabled})));function U(){v&&L.select(".nv-focus .nv-x.nv-axis").transition().duration(N).call(a)}function F(){S&&L.select(".nv-focus .nv-y.nv-axis").transition().duration(N).call(s)}if(v&&a.scale(t)._ticks(i.utils.calcTicksX(O/100,r)).tickSize(-M,0),S&&s.scale(e)._ticks(i.utils.calcTicksY(M/36,r)).tickSize(-O,0),L.select(".nv-focus .nv-x.nv-axis").attr("transform","translate(0,"+M+")"),E||null!==u.brush.extent()){u.width(O),L.select(".nv-focusWrap").style("display",E?"initial":"none").attr("transform","translate(0,"+(M+d.bottom+u.margin().top)+")").call(u);var x=u.brush.empty()?u.xDomain():u.brush.extent();null!==x&&Y(x)}else B.call(n),U(),F();function Y(t){L.select(".nv-focus .nv-linesWrap").datum(r.filter((function(t){return!t.disabled})).map((function(e,i){return{key:e.key,area:e.area,classed:e.classed,values:e.values.filter((function(e,i){return n.x()(e,i)>=t[0]&&n.x()(e,i)<=t[1]})),disableTooltip:e.disableTooltip}}))).transition().duration(N).call(n),U(),F()}o.dispatch.on("stateChange",(function(t){for(var e in t)A[e]=t[e];$.stateChange(A),P.update()})),c.dispatch.on("elementMousemove",(function(e){n.clearHighlights();var a,o,l,d=[];if(r.filter((function(t,e){return t.seriesIndex=e,!t.disabled&&!t.disableTooltip})).forEach((function(s,r){var c=null!==u.brush.extent()?u.brush.empty()?u.xScale().domain():u.brush.extent():t.domain(),h=s.values.filter((function(t,e){return c[0]<=c[1]?n.x()(t,e)>=c[0]&&n.x()(t,e)<=c[1]:n.x()(t,e)>=c[1]&&n.x()(t,e)<=c[0]})),p=h[o=i.interactiveBisect(h,e.pointXValue,n.x())],g=P.y()(p,o);null!==g&&n.highlightPoint(r,o,!0),void 0!==p&&(void 0===a&&(a=p),void 0===l&&(l=P.xScale()(P.x()(p,o))),d.push({key:s.key,value:g,color:f(s,s.seriesIndex),data:p}))})),d.length>2){var h=P.yScale().invert(e.mouseY),p=.03*Math.abs(P.yScale().domain()[0]-P.yScale().domain()[1]),g=i.nearestValueIndex(d.map((function(t){return t.value})),h,p);null!==g&&(d[g].highlight=!0)}c.tooltip.valueFormatter(c.tooltip.valueFormatter()||function(t,e){return null==t?"N/A":s.tickFormat()(t)}).data({value:P.x()(a,o),index:o,series:d})(),c.renderGuideLine(l)})),c.dispatch.on("elementClick",(function(t){var e,a=[];r.filter((function(t,e){return t.seriesIndex=e,!t.disabled})).forEach((function(n){var s=i.interactiveBisect(n.values,t.pointXValue,P.x()),r=n.values[s];if(void 0!==r){void 0===e&&(e=P.xScale()(P.x()(r,s)));var o=P.yScale()(P.y()(r,s));a.push({point:r,pointIndex:s,pos:[e,o],seriesIndex:n.seriesIndex,series:n})}})),n.dispatch.elementClick(a)})),c.dispatch.on("elementMouseout",(function(t){n.clearHighlights()})),$.on("changeState",(function(t){void 0!==t.disabled&&r.length===t.disabled.length&&(r.forEach((function(e,n){e.disabled=t.disabled[n]})),A.disabled=t.disabled),P.update()}))})),O.renderEnd("lineChart immediate"),P}return n.dispatch.on("elementMouseover.tooltip",(function(t){t.series.disableTooltip||l.data(t).hidden(!1)})),n.dispatch.on("elementMouseout.tooltip",(function(t){l.hidden(!0)})),P.dispatch=$,P.lines=n,P.legend=o,P.focus=u,P.xAxis=a,P.x2Axis=u.xAxis,P.yAxis=s,P.y2Axis=u.yAxis,P.interactiveLayer=c,P.tooltip=l,P.state=A,P.dispatch=$,P.options=i.utils.optionsFunc.bind(P),P._options=(0,r.default)({},{width:{get:function(){return p},set:function(t){p=t}},height:{get:function(){return g},set:function(t){g=t}},showLegend:{get:function(){return m},set:function(t){m=t}},legendPosition:{get:function(){return _},set:function(t){_=t}},showXAxis:{get:function(){return v},set:function(t){v=t}},showYAxis:{get:function(){return S},set:function(t){S=t}},defaultState:{get:function(){return b},set:function(t){b=t}},noData:{get:function(){return C},set:function(t){C=t}},focusEnable:{get:function(){return E},set:function(t){E=t}},focusHeight:{get:function(){return u.height()},set:function(t){u.height(t)}},focusShowAxisX:{get:function(){return u.showXAxis()},set:function(t){u.showXAxis(t)}},focusShowAxisY:{get:function(){return u.showYAxis()},set:function(t){u.showYAxis(t)}},brushExtent:{get:function(){return u.brushExtent()},set:function(t){u.brushExtent(t)}},focusMargin:{get:function(){return u.margin},set:function(t){void 0!==t.top&&(d.top=t.top,h=t.top),u.margin.right=void 0!==t.right?t.right:u.margin.right,u.margin.bottom=void 0!==t.bottom?t.bottom:u.margin.bottom,u.margin.left=void 0!==t.left?t.left:u.margin.left}},margin:{get:function(){return d},set:function(t){d.top=void 0!==t.top?t.top:d.top,d.right=void 0!==t.right?t.right:d.right,d.bottom=void 0!==t.bottom?t.bottom:d.bottom,d.left=void 0!==t.left?t.left:d.left}},duration:{get:function(){return N},set:function(t){N=t,O.reset(N),n.duration(N),u.duration(N),a.duration(N),s.duration(N)}},color:{get:function(){return f},set:function(t){f=i.utils.getColor(t),o.color(f),n.color(f),u.color(f)}},interpolate:{get:function(){return n.interpolate()},set:function(t){n.interpolate(t),u.interpolate(t)}},xTickFormat:{get:function(){return a.tickFormat()},set:function(t){a.tickFormat(t),u.xTickFormat(t)}},yTickFormat:{get:function(){return s.tickFormat()},set:function(t){s.tickFormat(t),u.yTickFormat(t)}},x:{get:function(){return n.x()},set:function(t){n.x(t),u.x(t)}},y:{get:function(){return n.y()},set:function(t){n.y(t),u.y(t)}},rightAlignYAxis:{get:function(){return T},set:function(t){T=t,s.orient(T?"right":"left")}},useInteractiveGuideline:{get:function(){return y},set:function(t){(y=t)&&(n.interactive(!1),n.useVoronoi(!1))}}}),i.utils.inheritOptions(P,n),i.utils.initOptions(P),P},i.models.lineWithFocusChart=function(){return i.models.lineChart().margin({bottom:30}).focusEnable(!0)},i.models.ohlcBar=function(){var t,e,n,a,s={top:0,right:0,bottom:0,left:0},o=null,c=null,l=Math.floor(1e4*Math.random()),u=null,d=d3.scale.linear(),h=d3.scale.linear(),f=function(t){return t.x},p=function(t){return t.y},g=function(t){return t.open},m=function(t){return t.close},_=function(t){return t.high},v=function(t){return t.low},S=[],T=[],y=!1,E=!0,A=i.utils.defaultColor(),b=!1,C=d3.dispatch("stateChange","changeState","renderEnd","chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove");function $(r){return r.each((function(r){u=d3.select(this);var b=i.utils.availableWidth(o,u,s),$=i.utils.availableHeight(c,u,s);i.utils.initSVG(u);var N=b/r[0].values.length*.9;d.domain(t||d3.extent(r[0].values.map(f).concat(S))),y?d.range(n||[.5*b/r[0].values.length,b*(r[0].values.length-.5)/r[0].values.length]):d.range(n||[5+N/2,b-N/2-5]),h.domain(e||[d3.min(r[0].values.map(v).concat(T)),d3.max(r[0].values.map(_).concat(T))]).range(a||[$,0]),d.domain()[0]===d.domain()[1]&&(d.domain()[0]?d.domain([d.domain()[0]-.01*d.domain()[0],d.domain()[1]+.01*d.domain()[1]]):d.domain([-1,1])),h.domain()[0]===h.domain()[1]&&(h.domain()[0]?h.domain([h.domain()[0]+.01*h.domain()[0],h.domain()[1]-.01*h.domain()[1]]):h.domain([-1,1]));var O=d3.select(this).selectAll("g.nv-wrap.nv-ohlcBar").data([r[0].values]),I=O.enter().append("g").attr("class","nvd3 nv-wrap nv-ohlcBar"),w=I.append("defs"),P=I.append("g"),M=O.select("g");P.append("g").attr("class","nv-ticks"),O.attr("transform","translate("+s.left+","+s.top+")"),u.on("click",(function(t,e){C.chartClick({data:t,index:e,pos:d3.event,id:l})})),w.append("clipPath").attr("id","nv-chart-clip-path-"+l).append("rect"),O.select("#nv-chart-clip-path-"+l+" rect").attr("width",b).attr("height",$),M.attr("clip-path",E?"url(#nv-chart-clip-path-"+l+")":"");var R=O.select(".nv-ticks").selectAll(".nv-tick").data((function(t){return t}));R.exit().remove(),R.enter().append("path").attr("class",(function(t,e,n){return(g(t,e)>m(t,e)?"nv-tick negative":"nv-tick positive")+" nv-tick-"+n+"-"+e})).attr("d",(function(t,e){return"m0,0l0,"+(h(g(t,e))-h(_(t,e)))+"l"+-N/2+",0l"+N/2+",0l0,"+(h(v(t,e))-h(g(t,e)))+"l0,"+(h(m(t,e))-h(v(t,e)))+"l"+N/2+",0l"+-N/2+",0z"})).attr("transform",(function(t,e){return"translate("+d(f(t,e))+","+h(_(t,e))+")"})).attr("fill",(function(t,e){return A[0]})).attr("stroke",(function(t,e){return A[0]})).attr("x",0).attr("y",(function(t,e){return h(Math.max(0,p(t,e)))})).attr("height",(function(t,e){return Math.abs(h(p(t,e))-h(0))})),R.attr("class",(function(t,e,n){return(g(t,e)>m(t,e)?"nv-tick negative":"nv-tick positive")+" nv-tick-"+n+"-"+e})),d3.transition(R).attr("transform",(function(t,e){return"translate("+d(f(t,e))+","+h(_(t,e))+")"})).attr("d",(function(t,e){var n=b/r[0].values.length*.9;return"m0,0l0,"+(h(g(t,e))-h(_(t,e)))+"l"+-n/2+",0l"+n/2+",0l0,"+(h(v(t,e))-h(g(t,e)))+"l0,"+(h(m(t,e))-h(v(t,e)))+"l"+n/2+",0l"+-n/2+",0z"}))})),$}return $.highlightPoint=function(t,e){$.clearHighlights(),u.select(".nv-ohlcBar .nv-tick-0-"+t).classed("hover",e)},$.clearHighlights=function(){u.select(".nv-ohlcBar .nv-tick.hover").classed("hover",!1)},$.dispatch=C,$.options=i.utils.optionsFunc.bind($),$._options=(0,r.default)({},{width:{get:function(){return o},set:function(t){o=t}},height:{get:function(){return c},set:function(t){c=t}},xScale:{get:function(){return d},set:function(t){d=t}},yScale:{get:function(){return h},set:function(t){h=t}},xDomain:{get:function(){return t},set:function(e){t=e}},yDomain:{get:function(){return e},set:function(t){e=t}},xRange:{get:function(){return n},set:function(t){n=t}},yRange:{get:function(){return a},set:function(t){a=t}},forceX:{get:function(){return S},set:function(t){S=t}},forceY:{get:function(){return T},set:function(t){T=t}},padData:{get:function(){return y},set:function(t){y=t}},clipEdge:{get:function(){return E},set:function(t){E=t}},id:{get:function(){return l},set:function(t){l=t}},interactive:{get:function(){return b},set:function(t){b=t}},x:{get:function(){return f},set:function(t){f=t}},y:{get:function(){return p},set:function(t){p=t}},open:{get:function(){return g()},set:function(t){g=t}},close:{get:function(){return m()},set:function(t){m=t}},high:{get:function(){return _},set:function(t){_=t}},low:{get:function(){return v},set:function(t){v=t}},margin:{get:function(){return s},set:function(t){s.top=null!=t.top?t.top:s.top,s.right=null!=t.right?t.right:s.right,s.bottom=null!=t.bottom?t.bottom:s.bottom,s.left=null!=t.left?t.left:s.left}},color:{get:function(){return A},set:function(t){A=i.utils.getColor(t)}}}),i.utils.initOptions($),$},i.models.pie=function(){var t={top:0,right:0,bottom:0,left:0},e=500,n=500,a=function(t){return t.x},s=function(t){return t.y},o=Math.floor(1e4*Math.random()),c=null,l=i.utils.defaultColor(),u=d3.format(",.2f"),d=!0,h=!1,f="key",p=.02,g=!1,m=!1,_=!1,v=!0,S=0,T=!1,y=!1,E=!1,A=!1,b=0,C=.5,$=250,N=[],O=d3.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","elementMousemove","renderEnd"),I=[],w=[],P=i.utils.renderWatch(O);function M(r){return P.reset(),r.each((function(r){var M=e-t.left-t.right,R=n-t.top-t.bottom,D=Math.min(M,R)/2,L=[],k=[];if(c=d3.select(this),0===N.length)for(var B=D-D/10,U=C*D,F=0;F<r[0].length;F++)L.push(B),k.push(U);else v?(L=N.map((function(t){return(t.outer-t.outer/10)*D})),k=N.map((function(t){return(t.inner-t.inner/10)*D})),C=d3.min(N.map((function(t){return t.inner-t.inner/10})))):(L=N.map((function(t){return t.outer*D})),k=N.map((function(t){return t.inner*D})),C=d3.min(N.map((function(t){return t.inner}))));i.utils.initSVG(c);var x=c.selectAll(".nv-wrap.nv-pie").data(r),Y=x.enter().append("g").attr("class","nvd3 nv-wrap nv-pie nv-chart-"+o).append("g"),G=x.select("g"),V=Y.append("g").attr("class","nv-pie");for(Y.append("g").attr("class","nv-pieLabels"),x.attr("transform","translate("+t.left+","+t.top+")"),G.select(".nv-pie").attr("transform","translate("+M/2+","+R/2+")"),G.select(".nv-pieLabels").attr("transform","translate("+M/2+","+R/2+")"),c.on("click",(function(t,e){O.chartClick({data:t,index:e,pos:d3.event,id:o})})),I=[],w=[],F=0;F<r[0].length;F++){var q=d3.svg.arc().outerRadius(L[F]),H=d3.svg.arc().outerRadius(L[F]+5);!1!==y&&(q.startAngle(y),H.startAngle(y)),!1!==A&&(q.endAngle(A),H.endAngle(A)),m&&(q.innerRadius(k[F]),H.innerRadius(k[F])),q.cornerRadius&&b&&(q.cornerRadius(b),H.cornerRadius(b)),I.push(q),w.push(H)}var W=d3.layout.pie().sort(null).value((function(t){return t.disabled?0:s(t)}));W.padAngle&&E&&W.padAngle(E),m&&_&&(V.append("text").attr("class","nv-pie-title"),x.select(".nv-pie-title").style("text-anchor","middle").text((function(t){return _})).style("font-size",Math.min(M,R)*C*2/(_.length+2)+"px").attr("dy","0.35em").attr("transform",(function(t,e){return"translate(0, "+S+")"})));var j=x.select(".nv-pie").selectAll(".nv-slice").data(W),K=x.select(".nv-pieLabels").selectAll(".nv-label").data(W);j.exit().remove(),K.exit().remove();var z=j.enter().append("g");if(z.attr("class","nv-slice"),z.on("mouseover",(function(t,e){d3.select(this).classed("hover",!0),v&&d3.select(this).select("path").transition().duration(70).attr("d",w[e]),O.elementMouseover({data:t.data,index:e,color:d3.select(this).style("fill"),percent:(t.endAngle-t.startAngle)/(2*Math.PI)})})),z.on("mouseout",(function(t,e){d3.select(this).classed("hover",!1),v&&d3.select(this).select("path").transition().duration(50).attr("d",I[e]),O.elementMouseout({data:t.data,index:e})})),z.on("mousemove",(function(t,e){O.elementMousemove({data:t.data,index:e})})),z.on("click",(function(t,e){O.elementClick({data:t.data,index:e,color:d3.select(this).style("fill"),event:d3.event,element:this})})),z.on("dblclick",(function(t,e){O.elementDblClick({data:t.data,index:e,color:d3.select(this).style("fill")})})),j.attr("fill",(function(t,e){return l(t.data,e)})),j.attr("stroke",(function(t,e){return l(t.data,e)})),z.append("path").each((function(t){this._current=t})),j.select("path").transition().duration($).attr("d",(function(t,e){return I[e](t)})).attrTween("d",(function(t,e){t.endAngle=isNaN(t.endAngle)?0:t.endAngle,t.startAngle=isNaN(t.startAngle)?0:t.startAngle,m||(t.innerRadius=0);var n=d3.interpolate(this._current,t);return this._current=n(0),function(t){return I[e](n(t))}})),d){var Q=[];for(F=0;F<r[0].length;F++)Q.push(I[F]),h?m&&(Q[F]=d3.svg.arc().outerRadius(I[F].outerRadius()),!1!==y&&Q[F].startAngle(y),!1!==A&&Q[F].endAngle(A)):m||Q[F].innerRadius(0);K.enter().append("g").classed("nv-label",!0).each((function(t,e){var n=d3.select(this);n.attr("transform",(function(t,e){if(T){t.outerRadius=L[e]+10,t.innerRadius=L[e]+15;var n=(t.startAngle+t.endAngle)/2*(180/Math.PI);return(t.startAngle+t.endAngle)/2<Math.PI?n-=90:n+=90,"translate("+Q[e].centroid(t)+") rotate("+n+")"}return t.outerRadius=D+10,t.innerRadius=D+15,"translate("+Q[e].centroid(t)+")"})),n.append("rect").style("stroke","#fff").style("fill","#fff").attr("rx",3).attr("ry",3),n.append("text").style("text-anchor",T?(t.startAngle+t.endAngle)/2<Math.PI?"start":"end":"middle").style("fill","#000")}));var X={},J=function(t){return 140*Math.floor(t[0]/140)+","+14*Math.floor(t[1]/14)},Z=function(t){return(t.endAngle-t.startAngle)/(2*Math.PI)};K.watchTransition(P,"pie labels").attr("transform",(function(t,e){if(T){t.outerRadius=L[e]+10,t.innerRadius=L[e]+15;var n=(t.startAngle+t.endAngle)/2*(180/Math.PI);return(t.startAngle+t.endAngle)/2<Math.PI?n-=90:n+=90,"translate("+Q[e].centroid(t)+") rotate("+n+")"}t.outerRadius=D+10,t.innerRadius=D+15;var i=Q[e].centroid(t),a=Z(t);if(t.value&&a>=p){var s=J(i);X[s]&&(i[1]-=14),X[J(i)]=!0}return"translate("+i+")"})),K.select(".nv-label text").style("text-anchor",(function(t,e){return T?(t.startAngle+t.endAngle)/2<Math.PI?"start":"end":"middle"})).text((function(t,e){var n=Z(t),i="";if(!t.value||n<p)return"";if("function"==typeof f)i=f(t,e,{key:a(t.data),value:s(t.data),percent:u(n)});else switch(f){case"key":i=a(t.data);break;case"value":i=u(s(t.data));break;case"percent":i=d3.format("%")(n)}return i})),g&&K.each((function(t,e){if(this.getBBox){var n=this.getBBox(),a=Q[e].centroid(t),s={x:a[0]+n.x,y:a[1]+n.y},r={x:s.x+n.width,y:s.y},o={x:s.x,y:s.y+n.height},c={x:s.x+n.width,y:s.y+n.height};t.visible=i.utils.pointIsInArc(s,t,q)&&i.utils.pointIsInArc(r,t,q)&&i.utils.pointIsInArc(o,t,q)&&i.utils.pointIsInArc(c,t,q)}})).style("display",(function(t){return t.visible?null:"none"}))}})),P.renderEnd("pie immediate"),M}return M.dispatch=O,M.options=i.utils.optionsFunc.bind(M),M._options=(0,r.default)({},{arcsRadius:{get:function(){return N},set:function(t){N=t}},width:{get:function(){return e},set:function(t){e=t}},height:{get:function(){return n},set:function(t){n=t}},showLabels:{get:function(){return d},set:function(t){d=t}},title:{get:function(){return _},set:function(t){_=t}},titleOffset:{get:function(){return S},set:function(t){S=t}},labelThreshold:{get:function(){return p},set:function(t){p=t}},hideOverlapLabels:{get:function(){return g},set:function(t){g=t}},valueFormat:{get:function(){return u},set:function(t){u=t}},x:{get:function(){return a},set:function(t){a=t}},id:{get:function(){return o},set:function(t){o=t}},endAngle:{get:function(){return A},set:function(t){A=t}},startAngle:{get:function(){return y},set:function(t){y=t}},padAngle:{get:function(){return E},set:function(t){E=t}},cornerRadius:{get:function(){return b},set:function(t){b=t}},donutRatio:{get:function(){return C},set:function(t){C=t}},labelsOutside:{get:function(){return h},set:function(t){h=t}},labelSunbeamLayout:{get:function(){return T},set:function(t){T=t}},donut:{get:function(){return m},set:function(t){m=t}},growOnHover:{get:function(){return v},set:function(t){v=t}},pieLabelsOutside:{get:function(){return h},set:function(t){h=t,i.deprecated("pieLabelsOutside","use labelsOutside instead")}},donutLabelsOutside:{get:function(){return h},set:function(t){h=t,i.deprecated("donutLabelsOutside","use labelsOutside instead")}},labelFormat:{get:function(){return u},set:function(t){u=t,i.deprecated("labelFormat","use valueFormat instead")}},margin:{get:function(){return t},set:function(e){t.top=void 0!==e.top?e.top:t.top,t.right=void 0!==e.right?e.right:t.right,t.bottom=void 0!==e.bottom?e.bottom:t.bottom,t.left=void 0!==e.left?e.left:t.left}},duration:{get:function(){return $},set:function(t){$=t,P.reset($)}},y:{get:function(){return s},set:function(t){s=d3.functor(t)}},color:{get:function(){return l},set:function(t){l=i.utils.getColor(t)}},labelType:{get:function(){return f},set:function(t){f=t||"key"}}}),i.utils.initOptions(M),M},i.models.pieChart=function(){var t=i.models.pie(),e=i.models.legend(),n=i.models.tooltip(),a={top:30,right:20,bottom:20,left:20},s=null,o=null,c=null,l=!1,u=!0,d="top",h=i.utils.defaultColor(),f=i.utils.state(),p=null,g=null,m=250,_=d3.dispatch("stateChange","changeState","renderEnd");n.duration(0).headerEnabled(!1).valueFormatter((function(e,n){return t.valueFormat()(e,n)}));var v=i.utils.renderWatch(_),S=function(t){return function(){return{active:t.map((function(t){return!t.disabled}))}}},T=function(t){return function(e){void 0!==e.active&&t.forEach((function(t,n){t.disabled=!e.active[n]}))}};function y(n){return v.reset(),v.models(t),n.each((function(n){var r=d3.select(this);i.utils.initSVG(r);var l,h=i.utils.availableWidth(o,r,a),g=i.utils.availableHeight(c,r,a);if(y.update=function(){r.transition().call(y)},y.container=this,f.setter(T(n),y.update).getter(S(n)).update(),f.disabled=n.map((function(t){return!!t.disabled})),!p)for(l in p={},f)f[l]instanceof Array?p[l]=f[l].slice(0):p[l]=f[l];if(!n||!n.length)return i.utils.noData(y,r),y;r.selectAll(".nv-noData").remove();var m=r.selectAll("g.nv-wrap.nv-pieChart").data([n]),v=m.enter().append("g").attr("class","nvd3 nv-wrap nv-pieChart").append("g"),E=m.select("g");if(v.append("g").attr("class","nv-pieWrap"),v.append("g").attr("class","nv-legendWrap"),u)if("top"===d)e.width(h).key(t.x()),m.select(".nv-legendWrap").datum(n).call(e),s||e.height()===a.top||(a.top=e.height(),g=i.utils.availableHeight(c,r,a)),m.select(".nv-legendWrap").attr("transform","translate(0,"+-a.top+")");else if("right"===d){var A=i.models.legend().width();h/2<A&&(A=h/2),e.height(g).key(t.x()),e.width(A),h-=e.width(),m.select(".nv-legendWrap").datum(n).call(e).attr("transform","translate("+h+",0)")}else"bottom"===d&&(e.width(h).key(t.x()),m.select(".nv-legendWrap").datum(n).call(e),a.bottom=e.height(),g=i.utils.availableHeight(c,r,a),m.select(".nv-legendWrap").attr("transform","translate(0,"+g+")"));else E.select(".nv-legendWrap").selectAll("*").remove();m.attr("transform","translate("+a.left+","+a.top+")"),t.width(h).height(g);var b=E.select(".nv-pieWrap").datum([n]);d3.transition(b).call(t),e.dispatch.on("stateChange",(function(t){for(var e in t)f[e]=t[e];_.stateChange(f),y.update()})),_.on("changeState",(function(t){void 0!==t.disabled&&(n.forEach((function(e,n){e.disabled=t.disabled[n]})),f.disabled=t.disabled),y.update()}))})),v.renderEnd("pieChart immediate"),y}return t.dispatch.on("elementMouseover.tooltip",(function(t){t.series={key:y.x()(t.data),value:y.y()(t.data),color:t.color,percent:t.percent},l||(delete t.percent,delete t.series.percent),n.data(t).hidden(!1)})),t.dispatch.on("elementMouseout.tooltip",(function(t){n.hidden(!0)})),t.dispatch.on("elementMousemove.tooltip",(function(t){n()})),y.legend=e,y.dispatch=_,y.pie=t,y.tooltip=n,y.options=i.utils.optionsFunc.bind(y),y._options=(0,r.default)({},{width:{get:function(){return o},set:function(t){o=t}},height:{get:function(){return c},set:function(t){c=t}},noData:{get:function(){return g},set:function(t){g=t}},showTooltipPercent:{get:function(){return l},set:function(t){l=t}},showLegend:{get:function(){return u},set:function(t){u=t}},legendPosition:{get:function(){return d},set:function(t){d=t}},defaultState:{get:function(){return p},set:function(t){p=t}},color:{get:function(){return h},set:function(n){h=n,e.color(h),t.color(h)}},duration:{get:function(){return m},set:function(e){m=e,v.reset(m),t.duration(m)}},margin:{get:function(){return a},set:function(t){void 0!==t.top&&(a.top=t.top,s=t.top),a.right=void 0!==t.right?t.right:a.right,a.bottom=void 0!==t.bottom?t.bottom:a.bottom,a.left=void 0!==t.left?t.left:a.left}}}),i.utils.inheritOptions(y,t),i.utils.initOptions(y),y},i.models.scatter=function(){var t,e,n,a,s,o,c,l,u={top:0,right:0,bottom:0,left:0},d=null,h=null,f=i.utils.defaultColor(),p=null,g=Math.floor(1e5*Math.random()),m=null,_=d3.scale.linear(),v=d3.scale.linear(),S=d3.scale.linear(),T=function(t){return t.x},y=function(t){return t.y},E=function(t){return t.size||1},A=function(t){return t.shape||"circle"},b=[],C=[],$=[],N=!0,O=function(t){return!t.notActive},I=!1,w=.1,P=!1,M=!0,R=!1,D=function(){return 25},L=null,k=null,B=null,U=null,F=null,x=null,Y=!1,G=d3.dispatch("elementClick","elementDblClick","elementMouseover","elementMouseout","renderEnd"),V=!0,q=250,H=300,W=!1,j=!1,K=i.utils.renderWatch(G,q),z=[16,256],Q={};function X(t){var e;e=t[0].series+":"+t[1],delete Q[e]}function J(t){var e,n,i,a=function(t){var e;return e=t[0].series+":"+t[1],Q[e]=Q[e]||{}}(t),s=!1;for(e=1;e<arguments.length;e+=2)n=arguments[e],i=arguments[e+1](t[0],t[1]),a[n]===i&&a.hasOwnProperty(n)||(a[n]=i,s=!0);return s}function Z(r){return K.reset(),r.each((function(r){m=d3.select(this);var q=i.utils.availableWidth(d,m,u),Q=i.utils.availableHeight(h,m,u);i.utils.initSVG(m),r.forEach((function(t,e){t.values.forEach((function(t){t.series=e}))}));var tt="function"==typeof Z.yScale().base,et=L&&k&&F?[]:d3.merge(r.map((function(t){return t.values.map((function(t,e){return{x:T(t,e),y:y(t,e),size:E(t,e)}}))})));if(_.domain(L||d3.extent(et.map((function(t){return t.x})).concat(b))),I&&r[0]?_.range(B||[(q*w+q)/(2*r[0].values.length),q-q*(1+w)/(2*r[0].values.length)]):_.range(B||[0,q]),tt){var nt=d3.min(et.map((function(t){if(0!==t.y)return t.y})));v.clamp(!0).domain(k||d3.extent(et.map((function(t){return 0!==t.y?t.y:.1*nt})).concat(C))).range(U||[Q,0])}else v.domain(k||d3.extent(et.map((function(t){return t.y})).concat(C))).range(U||[Q,0]);S.domain(F||d3.extent(et.map((function(t){return t.size})).concat($))).range(x||z),Y=_.domain()[0]===_.domain()[1]||v.domain()[0]===v.domain()[1],_.domain()[0]===_.domain()[1]&&(_.domain()[0]?_.domain([_.domain()[0]-.01*_.domain()[0],_.domain()[1]+.01*_.domain()[1]]):_.domain([-1,1])),v.domain()[0]===v.domain()[1]&&(v.domain()[0]?v.domain([v.domain()[0]-.01*v.domain()[0],v.domain()[1]+.01*v.domain()[1]]):v.domain([-1,1])),isNaN(_.domain()[0])&&_.domain([-1,1]),isNaN(v.domain()[0])&&v.domain([-1,1]),t=t||_,e=e||v,n=n||S;var it=_(1)!==t(1)||v(1)!==e(1)||S(1)!==n(1);c=c||h;var at=(o=o||d)!==d||c!==h,st=(a=a||[])[0]!==_.domain()[0]||a[1]!==_.domain()[1];a=_.domain(),s=s||[],st=st||s[0]!==v.domain()[0]||s[1]!==v.domain()[1],s=v.domain();var rt=m.selectAll("g.nv-wrap.nv-scatter").data([r]),ot=rt.enter().append("g").attr("class","nvd3 nv-wrap nv-scatter nv-chart-"+g),ct=ot.append("defs"),lt=ot.append("g"),ut=rt.select("g");function dt(){if(j=!1,!N)return!1;if(!0===V){rt.select(".nv-point-paths").selectAll("path").remove();var t=d3.merge(r.map((function(t,e){return t.values.map((function(t,n){var a=T(t,n),s=y(t,n);return[i.utils.NaNtoZero(_(a))+1e-4*Math.random(),i.utils.NaNtoZero(v(s))+1e-4*Math.random(),e,n,t]})).filter((function(t,e){return O(t[4],e)}))})));if(0==t.length)return!1;t.length<3&&(t.push([_.range()[0]-20,v.range()[0]-20,null,null]),t.push([_.range()[1]+20,v.range()[1]+20,null,null]),t.push([_.range()[0]-20,v.range()[0]+20,null,null]),t.push([_.range()[1]+20,v.range()[1]-20,null,null]));var e=d3.geom.polygon([[-10,-10],[-10,h+10],[d+10,h+10],[d+10,-10]]);t=t.sort((function(t,e){return t[0]-e[0]||t[1]-e[1]}));for(var n=0;n<t.length-1;)Math.abs(t[n][0]-t[n+1][0])<1e-4&&Math.abs(t[n][1]-t[n+1][1])<1e-4?t.splice(n+1,1):n++;var a=d3.geom.voronoi(t).map((function(n,i){return{data:e.clip(n),series:t[i][2],point:t[i][3]}})),s=rt.select(".nv-point-paths").selectAll("path").data(a),o=s.enter().append("svg:path").attr("d",(function(t){return t&&t.data&&0!==t.data.length?"M"+t.data.join(",")+"Z":"M 0 0"})).attr("id",(function(t,e){return"nv-path-"+e})).attr("clip-path",(function(t,e){return"url(#nv-clip-"+g+"-"+e+")"}));R&&o.style("fill",d3.rgb(230,230,230)).style("fill-opacity",.4).style("stroke-opacity",1).style("stroke",d3.rgb(200,200,200)),M&&(rt.select(".nv-point-clips").selectAll("*").remove(),rt.select(".nv-point-clips").selectAll("clipPath").data(t).enter().append("svg:clipPath").attr("id",(function(t,e){return"nv-clip-"+g+"-"+e})).append("svg:circle").attr("cx",(function(t){return t[0]})).attr("cy",(function(t){return t[1]})).attr("r",D));var c=function(t,e,n){if(j)return 0;var i=r[e.series];if(void 0!==i){var a=i.values[e.point];a.color=f(i,e.series),a.x=T(a),a.y=y(a);var s=m.node().getBoundingClientRect(),o=window.pageYOffset||document.documentElement.scrollTop,c=window.pageXOffset||document.documentElement.scrollLeft;n({point:a,series:i,pos:{left:_(T(a,e.point))+s.left+c+u.left+10,top:v(y(a,e.point))+s.top+o+u.top+10},relativePos:[_(T(a,e.point))+u.left,v(y(a,e.point))+u.top],seriesIndex:e.series,pointIndex:e.point,event:d3.event,element:t})}};s.on("click",(function(t){c(this,t,G.elementClick)})).on("dblclick",(function(t){c(this,t,G.elementDblClick)})).on("mouseover",(function(t){c(this,t,G.elementMouseover)})).on("mouseout",(function(t,e){c(this,t,G.elementMouseout)}))}else rt.select(".nv-groups").selectAll(".nv-group").selectAll(".nv-point").on("click",(function(t,e){if(j||!r[t.series])return 0;var n=r[t.series],i=n.values[e];G.elementClick({point:i,series:n,pos:[_(T(i,e))+u.left,v(y(i,e))+u.top],relativePos:[_(T(i,e))+u.left,v(y(i,e))+u.top],seriesIndex:t.series,pointIndex:e,event:d3.event,element:this})})).on("dblclick",(function(t,e){if(j||!r[t.series])return 0;var n=r[t.series],i=n.values[e];G.elementDblClick({point:i,series:n,pos:[_(T(i,e))+u.left,v(y(i,e))+u.top],relativePos:[_(T(i,e))+u.left,v(y(i,e))+u.top],seriesIndex:t.series,pointIndex:e})})).on("mouseover",(function(t,e){if(j||!r[t.series])return 0;var n=r[t.series],i=n.values[e];G.elementMouseover({point:i,series:n,pos:[_(T(i,e))+u.left,v(y(i,e))+u.top],relativePos:[_(T(i,e))+u.left,v(y(i,e))+u.top],seriesIndex:t.series,pointIndex:e,color:f(t,e)})})).on("mouseout",(function(t,e){if(j||!r[t.series])return 0;var n=r[t.series],i=n.values[e];G.elementMouseout({point:i,series:n,pos:[_(T(i,e))+u.left,v(y(i,e))+u.top],relativePos:[_(T(i,e))+u.left,v(y(i,e))+u.top],seriesIndex:t.series,pointIndex:e,color:f(t,e)})}))}rt.classed("nv-single-point",Y),lt.append("g").attr("class","nv-groups"),lt.append("g").attr("class","nv-point-paths"),ot.append("g").attr("class","nv-point-clips"),rt.attr("transform","translate("+u.left+","+u.top+")"),ct.append("clipPath").attr("id","nv-edge-clip-"+g).append("rect").attr("transform","translate( -10, -10)"),rt.select("#nv-edge-clip-"+g+" rect").attr("width",q+20).attr("height",Q>0?Q+20:0),ut.attr("clip-path",P?"url(#nv-edge-clip-"+g+")":""),j=!0;var ht=rt.select(".nv-groups").selectAll(".nv-group").data((function(t){return t}),(function(t){return t.key}));ht.enter().append("g").style("stroke-opacity",1e-6).style("fill-opacity",1e-6),ht.exit().remove(),ht.attr("class",(function(t,e){return(t.classed||"")+" nv-group nv-series-"+e})).classed("nv-noninteractive",!N).classed("hover",(function(t){return t.hover})),ht.watchTransition(K,"scatter: groups").style("fill",(function(t,e){return f(t,e)})).style("stroke",(function(t,e){return t.pointBorderColor||p||f(t,e)})).style("stroke-opacity",1).style("fill-opacity",.5);var ft=ht.selectAll("path.nv-point").data((function(t){return t.values.map((function(t,e){return[t,e]})).filter((function(t,e){return O(t[0],e)}))}));if(ft.enter().append("path").attr("class",(function(t){return"nv-point nv-point-"+t[1]})).style("fill",(function(t){return t.color})).style("stroke",(function(t){return t.color})).attr("transform",(function(n){return"translate("+i.utils.NaNtoZero(t(T(n[0],n[1])))+","+i.utils.NaNtoZero(e(y(n[0],n[1])))+")"})).attr("d",i.utils.symbol().type((function(t){return A(t[0])})).size((function(t){return S(E(t[0],t[1]))}))),ft.exit().each(X).remove(),ht.exit().selectAll("path.nv-point").watchTransition(K,"scatter exit").attr("transform",(function(t){return"translate("+i.utils.NaNtoZero(_(T(t[0],t[1])))+","+i.utils.NaNtoZero(v(y(t[0],t[1])))+")"})).remove(),ft.filter((function(t){return J(t,"x",T,"y",y)||it||at||st})).watchTransition(K,"scatter points").attr("transform",(function(t){return"translate("+i.utils.NaNtoZero(_(T(t[0],t[1])))+","+i.utils.NaNtoZero(v(y(t[0],t[1])))+")"})),ft.filter((function(t){return J(t,"shape",A,"size",E)||it||at||st})).watchTransition(K,"scatter points").attr("d",i.utils.symbol().type((function(t){return A(t[0])})).size((function(t){return S(E(t[0],t[1]))}))),W){var pt=ht.selectAll(".nv-label").data((function(t){return t.values.map((function(t,e){return[t,e]})).filter((function(t,e){return O(t[0],e)}))}));pt.enter().append("text").style("fill",(function(t,e){return t.color})).style("stroke-opacity",0).style("fill-opacity",1).attr("transform",(function(n){return"translate("+(i.utils.NaNtoZero(t(T(n[0],n[1])))+Math.sqrt(S(E(n[0],n[1]))/Math.PI)+2)+","+i.utils.NaNtoZero(e(y(n[0],n[1])))+")"})).text((function(t,e){return t[0].label})),pt.exit().remove(),ht.exit().selectAll("path.nv-label").watchTransition(K,"scatter exit").attr("transform",(function(t){return"translate("+(i.utils.NaNtoZero(_(T(t[0],t[1])))+Math.sqrt(S(E(t[0],t[1]))/Math.PI)+2)+","+i.utils.NaNtoZero(v(y(t[0],t[1])))+")"})).remove(),pt.each((function(t){d3.select(this).classed("nv-label",!0).classed("nv-label-"+t[1],!1).classed("hover",!1)})),pt.watchTransition(K,"scatter labels").attr("transform",(function(t){return"translate("+(i.utils.NaNtoZero(_(T(t[0],t[1])))+Math.sqrt(S(E(t[0],t[1]))/Math.PI)+2)+","+i.utils.NaNtoZero(v(y(t[0],t[1])))+")"}))}H?(clearTimeout(l),l=setTimeout(dt,H)):dt(),t=_.copy(),e=v.copy(),n=S.copy(),o=d,c=h})),K.renderEnd("scatter immediate"),Z}return Z.dispatch=G,Z.options=i.utils.optionsFunc.bind(Z),Z._calls=new function(){this.clearHighlights=function(){return i.dom.write((function(){m.selectAll(".nv-point.hover").classed("hover",!1)})),null},this.highlightPoint=function(t,e,n){i.dom.write((function(){m.select(".nv-groups").selectAll(".nv-series-"+t).selectAll(".nv-point-"+e).classed("hover",n)}))}},G.on("elementMouseover.point",(function(t){N&&Z._calls.highlightPoint(t.seriesIndex,t.pointIndex,!0)})),G.on("elementMouseout.point",(function(t){N&&Z._calls.highlightPoint(t.seriesIndex,t.pointIndex,!1)})),Z._options=(0,r.default)({},{width:{get:function(){return d},set:function(t){d=t}},height:{get:function(){return h},set:function(t){h=t}},xScale:{get:function(){return _},set:function(t){_=t}},yScale:{get:function(){return v},set:function(t){v=t}},pointScale:{get:function(){return S},set:function(t){S=t}},xDomain:{get:function(){return L},set:function(t){L=t}},yDomain:{get:function(){return k},set:function(t){k=t}},pointDomain:{get:function(){return F},set:function(t){F=t}},xRange:{get:function(){return B},set:function(t){B=t}},yRange:{get:function(){return U},set:function(t){U=t}},pointRange:{get:function(){return x},set:function(t){x=t}},forceX:{get:function(){return b},set:function(t){b=t}},forceY:{get:function(){return C},set:function(t){C=t}},forcePoint:{get:function(){return $},set:function(t){$=t}},interactive:{get:function(){return N},set:function(t){N=t}},pointActive:{get:function(){return O},set:function(t){O=t}},padDataOuter:{get:function(){return w},set:function(t){w=t}},padData:{get:function(){return I},set:function(t){I=t}},clipEdge:{get:function(){return P},set:function(t){P=t}},clipVoronoi:{get:function(){return M},set:function(t){M=t}},clipRadius:{get:function(){return D},set:function(t){D=t}},showVoronoi:{get:function(){return R},set:function(t){R=t}},id:{get:function(){return g},set:function(t){g=t}},interactiveUpdateDelay:{get:function(){return H},set:function(t){H=t}},showLabels:{get:function(){return W},set:function(t){W=t}},pointBorderColor:{get:function(){return p},set:function(t){p=t}},x:{get:function(){return T},set:function(t){T=d3.functor(t)}},y:{get:function(){return y},set:function(t){y=d3.functor(t)}},pointSize:{get:function(){return E},set:function(t){E=d3.functor(t)}},pointShape:{get:function(){return A},set:function(t){A=d3.functor(t)}},margin:{get:function(){return u},set:function(t){u.top=void 0!==t.top?t.top:u.top,u.right=void 0!==t.right?t.right:u.right,u.bottom=void 0!==t.bottom?t.bottom:u.bottom,u.left=void 0!==t.left?t.left:u.left}},duration:{get:function(){return q},set:function(t){q=t,K.reset(q)}},color:{get:function(){return f},set:function(t){f=i.utils.getColor(t)}},useVoronoi:{get:function(){return V},set:function(t){!1===(V=t)&&(M=!1)}}}),i.utils.initOptions(Z),Z},i.version="1.8.6"},function(t,e,n){"use strict";!function(t){var e=t.nv;angular.module("nvd3",[]).directive("nvd3",["nvd3Utils",function(t){return{restrict:"AE",scope:{data:"=",options:"=",api:"=?",events:"=?",config:"=?",onReady:"&?"},link:function(n,i,a){var s={extended:!1,visible:!0,disabled:!1,refreshDataOnly:!0,deepWatchOptions:!0,deepWatchData:!0,deepWatchDataDepth:2,debounce:10,debounceImmediate:!0};function r(t,e,i){t&&e&&angular.forEach(t,(function(a,s){"_"===s[0]||("dispatch"===s?(void 0!==e[s]&&null!==e[s]||n._config.extended&&(e[s]={}),o(a,e[s])):"tooltip"===s?(void 0!==e[s]&&null!==e[s]||n._config.extended&&(e[s]={}),r(t[s],e[s],i)):"contentGenerator"===s?e[s]&&t[s](e[s]):-1===["axis","clearHighlights","defined","highlightPoint","nvPointerEventsClass","options","rangeBand","rangeBands","scatter","open","close","node"].indexOf(s)&&(void 0===e[s]||null===e[s]?n._config.extended&&(e[s]=a()):t[s](e[s])))}))}function o(t,e){t&&e&&angular.forEach(t,(function(i,a){void 0===e[a]||null===e[a]?n._config.extended&&(e[a]=i.on):t.on(a+"._",e[a])}))}function c(e){var a=t.deepExtend(function(t){switch(t){case"title":return{enable:!1,text:"Write Your Title",className:"h4",css:{width:n.options.chart.width+"px",textAlign:"center"}};case"subtitle":return{enable:!1,text:"Write Your Subtitle",css:{width:n.options.chart.width+"px",textAlign:"center"}};case"caption":return{enable:!1,text:"Figure 1. Write Your Caption text.",css:{width:n.options.chart.width+"px",textAlign:"center"}}}}(e),n.options[e]||{});n._config.extended&&(n.options[e]=a);var s=angular.element("<div></div>").html(a.html||"").addClass(e).addClass(a.className).removeAttr("style").css(a.css);a.html||s.text(a.text),a.enable&&("title"===e?i.prepend(s):"subtitle"===e?angular.element(i[0].querySelector(".title")).after(s):"caption"===e&&i.append(s))}function l(){var e=t.deepExtend({classes:{"with-3d-shadow":!0,"with-transitions":!0,gallery:!1},css:{}},n.options.styles||{});n._config.extended&&(n.options.styles=e),angular.forEach(e.classes,(function(t,e){t?i.addClass(e):i.removeClass(e)})),i.removeAttr("style").css(e.css)}function u(t,e){t!==e&&(n._config.disabled||(n._config.refreshDataOnly?n.api.update():n.api.refresh()))}n.isReady=!1,n._config=angular.extend(s,n.config),n.api={refresh:function(){n.api.updateWithOptions(),n.isReady=!0},refreshWithTimeout:function(t){setTimeout((function(){n.api.refresh()}),t)},update:function(){n.chart&&n.svg?"sunburstChart"===n.options.chart.type?n.svg.datum(angular.copy(n.data)).call(n.chart):n.svg.datum(n.data).call(n.chart):n.api.refresh()},updateWithTimeout:function(t){setTimeout((function(){n.api.update()}),t)},updateWithOptions:function(i){if(arguments.length){if(n.options=i,n._config.deepWatchOptions&&!n._config.disabled)return}else i=n.options;n.api.clearElement(),!1!==angular.isDefined(i)&&n._config.visible&&(n.chart=e.models[i.chart.type](),n.chart.id=Math.random().toString(36).substr(2,15),angular.forEach(n.chart,(function(t,e){"_"===e[0]||["clearHighlights","highlightPoint","id","options","resizeHandler","state","open","close","tooltipContent"].indexOf(e)>=0||("dispatch"===e?(void 0!==i.chart[e]&&null!==i.chart[e]||n._config.extended&&(i.chart[e]={}),o(n.chart[e],i.chart[e])):["bars","bars1","bars2","boxplot","bullet","controls","discretebar","distX","distY","focus","interactiveLayer","legend","lines","lines1","lines2","multibar","pie","scatter","scatters1","scatters2","sparkline","stack1","stack2","sunburst","tooltip","x2Axis","xAxis","y1Axis","y2Axis","y3Axis","y4Axis","yAxis","yAxis1","yAxis2"].indexOf(e)>=0||"stacked"===e&&"stackedAreaChart"===i.chart.type?(void 0!==i.chart[e]&&null!==i.chart[e]||n._config.extended&&(i.chart[e]={}),r(n.chart[e],i.chart[e],i.chart.type)):"focusHeight"===e&&"lineChart"===i.chart.type||"focusHeight"===e&&"lineWithFocusChart"===i.chart.type||("xTickFormat"!==e&&"yTickFormat"!==e||"lineWithFocusChart"!==i.chart.type)&&("tooltips"===e&&"boxPlotChart"===i.chart.type||("tooltipXContent"!==e&&"tooltipYContent"!==e||"scatterChart"!==i.chart.type)&&("x"!==e&&"y"!==e||"forceDirectedGraph"!==i.chart.type)&&(void 0===i.chart[e]||null===i.chart[e]?n._config.extended&&(i.chart[e]="barColor"===e?t()():t()):n.chart[e](i.chart[e]))))})),n.api.updateWithData(),(i.title||n._config.extended)&&c("title"),(i.subtitle||n._config.extended)&&c("subtitle"),(i.caption||n._config.extended)&&c("caption"),(i.styles||n._config.extended)&&l(),e.addGraph((function(){if(n.chart)return n.chart.resizeHandler&&n.chart.resizeHandler.clear(),n.chart.resizeHandler=e.utils.windowResize((function(){n.chart&&n.chart.update&&n.chart.update()})),void 0!==i.chart.zoom&&["scatterChart","lineChart","candlestickBarChart","cumulativeLineChart","historicalBarChart","ohlcBarChart","stackedAreaChart"].indexOf(i.chart.type)>-1&&t.zoom(n,i),n.chart}),i.chart.callback))},updateWithData:function(t){if(arguments.length){if(n.data=t,n._config.deepWatchData&&!n._config.disabled)return}else t="sunburstChart"===n.options.chart.type?angular.copy(n.data):n.data;var e,a;t&&(d3.select(i[0]).select("svg").remove(),n.svg=d3.select(i[0]).insert("svg",".caption"),(e=n.options.chart.height)&&(isNaN(+e)||(e+="px"),n.svg.attr("height",e).style({height:e})),(a=n.options.chart.width)?(isNaN(+a)||(a+="px"),n.svg.attr("width",a).style({width:a})):n.svg.attr("width","100%").style({width:"100%"}),n.svg.datum(t).call(n.chart),n.chart&&n.chart.zoomRender&&n.chart.zoomRender())},clearElement:function(){if(i.find(".title").remove(),i.find(".subtitle").remove(),i.find(".caption").remove(),i.empty(),n.chart&&n.chart.tooltip&&n.chart.tooltip.id&&d3.select("#"+n.chart.tooltip.id()).remove(),e.graphs&&n.chart)for(var t=e.graphs.length-1;t>=0;t--)e.graphs[t]&&e.graphs[t].id===n.chart.id&&e.graphs.splice(t,1);e.tooltip&&e.tooltip.cleanup&&e.tooltip.cleanup(),n.chart&&n.chart.resizeHandler&&n.chart.resizeHandler.clear(),n.chart=null},getScope:function(){return n},getElement:function(){return i}},n._config.deepWatchOptions&&n.$watch("options",t.debounce((function(t){n._config.disabled||n.api.refresh()}),n._config.debounce,n._config.debounceImmediate),!0),n._config.deepWatchData&&(1===n._config.deepWatchDataDepth?n.$watchCollection("data",u):n.$watch("data",u,2===n._config.deepWatchDataDepth)),n.$watch("config",(function(t,e){t!==e&&(n._config=angular.extend(s,t),n.api.refresh())}),!0),n._config.deepWatchOptions||n._config.deepWatchData||n.api.refresh(),angular.forEach(n.events,(function(t,e){n.$on(e,(function(e,i){return t(e,n,i)}))})),i.on("$destroy",(function(){n.api.clearElement()})),n.$watch("isReady",(function(t){t&&n.onReady&&"function"==typeof n.onReady()&&n.onReady()(n,i)}))}}}]).factory("nvd3Utils",(function(){return{debounce:function(t,e,n){var i;return function(){var a=this,s=arguments,r=function(){i=null,n||t.apply(a,s)},o=n&&!i;clearTimeout(i),i=setTimeout(r,e),o&&t.apply(a,s)}},deepExtend:function(t){var e=this;return angular.forEach(arguments,(function(n){n!==t&&angular.forEach(n,(function(n,i){t[i]&&t[i].constructor&&t[i].constructor===Object?e.deepExtend(t[i],n):t[i]=n}))})),t},zoom:function(t,e){var n=e.chart.zoom;if(void 0===n.enabled||null===n.enabled||n.enabled){var i,a,s,r,o,c=t.chart.xAxis.scale(),l=t.chart.yAxis.scale(),u=t.chart.xDomain||c.domain,d=t.chart.yDomain||l.domain,h=c.domain().slice(),f=l.domain().slice(),p=n.scale||1,g=n.translate||[0,0],m=n.scaleExtent||[1,10],_=n.useFixedDomain||!1,v=n.useNiceScale||!1,S=n.horizontalOff||!1,T=n.verticalOff||!1,y=n.unzoomEventType||"dblclick.zoom";v&&(c.nice(),l.nice()),i=function(t,e){return t[0]=Math.min(Math.max(t[0],e[0]),e[1]-e[1]/m[1]),t[1]=Math.max(e[0]+e[1]/m[1],Math.min(t[1],e[1])),t},s=function(){if(void 0!==n.zoomed){var e=n.zoomed(c.domain(),l.domain());S||u([e.x1,e.x2]),T||d([e.y1,e.y2])}else S||u(_?i(c.domain(),h):c.domain()),T||d(_?i(l.domain(),f):l.domain());t.chart&&t.chart.update()},r=function(){if(void 0!==n.unzoomed){var e=n.unzoomed(c.domain(),l.domain());S||u([e.x1,e.x2]),T||d([e.y1,e.y2])}else S||u(h),T||d(f);a.scale(p).translate(g),t.chart&&t.chart.update()},o=function(){void 0!==n.zoomend&&n.zoomend()},a=d3.behavior.zoom().x(c).y(l).scaleExtent(m).on("zoom",s).on("zoomend",o),t.svg&&(t.svg.call(a),a.scale(p).translate(g).event(t.svg),"none"!==y&&t.svg.on(y,r)),t.chart&&(t.chart.zoomRender=function(){a.scale(p).translate(g),c=t.chart.xAxis.scale(),l=t.chart.yAxis.scale(),u=t.chart.xDomain||c.domain,d=t.chart.yDomain||l.domain,h=c.domain().slice(),f=l.domain().slice(),a.x(c).y(l),t.svg.call(a),"none"!==y&&t.svg.on(y,r)})}}}}))}(window)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s){(0,i.default)(this,t),this.$translate=e,this.$filter=n,this.RequesterService=a,this.serviceConstants=s}return(0,a.default)(t,[{key:"getAccounts",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.BILL_PAY_ACCOUNTS)}},{key:"prepareAccountBalance",value:function(){var t=this;return this.getAccounts().then((function(e){return t.prepareAccountAccordion(e.fromAccounts)}))}},{key:"prepareAccountAccordion",value:function(t){var e=this;if(t&&0!==t.lenth){var n=t.reduce((function(t,e){return t+e.account_balance}),0);return this.accountsBalanceAccordionTitle={text:this.$translate.instant("billPay.landingPage.chequingBalance"),value:this.$filter("currency")(n)},this.accountsBalanceAccordionItems=t.map((function(t){return{text:(t.nickname?t.nickname:e.$translate.instant("billPay.multipleBP.chequing"))+" "+e.$filter("maskNumber")(t.display_name),value:e.$filter("currency")(t.account_balance)}})),this.accountsBalanceAccordionItems}}},{key:"getUpdatedAccounts",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_SUMMARY)}}]),t}();r.$inject=["$translate","$filter","RequesterService","serviceConstants"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1961)),a=s(n(1962));function s(t){return t&&t.__esModule?t:{default:t}}n(1963);var r={template:i.default,controller:a.default,bindings:{basket:"<",isModal:"<?",onClose:"&?",cardTileAccounts:"<?",caller:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-account-aggr" ng-if="!$ctrl.isModal"> <section class="medium-width-section-aa"> <tng-plaid-login basket="$ctrl.basket" is-loading="$ctrl.isLoading" is-relogin="$ctrl.isReloginRequired" add-other-bank="$ctrl.addOtherBank" on-institution-public-token-received="$ctrl.onInstitutionPublicTokenReceived()"></tng-plaid-login> <div> <tng-aggregated-accounts items="$ctrl.basket.items" on-item-remove="$ctrl.onItemRemove(itemToRemove)" on-item-refresh="$ctrl.onItemRefresh(itemToRefresh)" on-account-check="$ctrl.onAccountCheck()"></tng-aggregated-accounts> </div> </section> </div> <div class="c-account-aggr"> <tng-modal-dialog ng-if="$ctrl.isModal && $ctrl.showModal" on-close="$ctrl.onModalClose()"> <header> <span id="externalAccountsTitle1"> {{ ::\'fetchAccountsModal.title\' | translate }} </span> </header> <div> <h2 class="body--2" actionable-id="externalAccountsSubtitle1" translate-cloak> {{ ::\'fetchAccountsModal.subtitle\' | translate }} </h2> </div> <div ng-if="$ctrl.hasBanks"> <h1 class="heading--title2" actionable-id="externalAccountsTitle" translate-cloak> {{ ::\'financialPlan.linkBank.title\' | translate }} </h1> <br> <h2 class="body--2" actionable-id="externalAccountsSubtitle" translate-cloak> {{ ::\'financialPlan.linkBank.linkBankinfo\' | translate }} </h2> </div> <tng-plaid-login basket="$ctrl.basket" is-loading="$ctrl.isLoading" is-relogin="$ctrl.isReloginRequired" add-other-bank="$ctrl.addOtherBank" on-institution-public-token-received="$ctrl.onInstitutionPublicTokenReceived()"></tng-plaid-login> <div> <tng-aggregated-accounts items="$ctrl.basket.items" on-item-remove="$ctrl.onItemRemove(itemToRemove)" on-item-refresh="$ctrl.onItemRefresh(itemToRefresh)" on-account-check="$ctrl.onAccountCheck()" caller="$ctrl.caller"></tng-aggregated-accounts> </div> <footer> <button actionable-id="{{::$ctrl.pageId}}-modal-cancel_btn" class="btn btn--prev" ng-click="$ctrl.onModalCloseCancel()" translate-cloak> {{ :: \'global.components.buttons.cancel\' | translate}} </button> <button actionable-id="{{::$ctrl.pageId}}-add-modal-delete_btn" class="btn btn--next" ng-click="$ctrl.onModalCloseSave()" translate-cloak> {{ :: \'global.components.buttons.done\' | translate}} </button> </footer> </tng-modal-dialog> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(68)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s,r,o,c,l,u,d){(0,a.default)(this,t),this.$log=e,this.$timeout=n,this.AccountAggregationService=i,this.AccountSummaryPrefetchService=l,this.EventBusService=u,this.serviceConstants=s,this.$translate=d,this.pageId="accountAggregation",this.$state=r,this.stateConstants=o,this.sources=c.SOURCES,this.loginRequired=c.AA_LOGIN_REQUIRED,this.isReloginRequired=!1,this.DATA_INVALIDATED=s.DATA_INVALIDATED,this.ROOT_ENDPOINTS=s.ROOT_ENDPOINTS}return(0,s.default)(t,[{key:"$onInit",value:function(){this.isModal&&(this.showModal=!0),this.basket.items||(this.basket.items=[]),this.submitErrors=[]}},{key:"onModalHide",value:function(){this.showWaitAccountsModal=!1}},{key:"onInstitutionPublicTokenReceived",value:function(){this.submitErrors.length=0,this.$log.debug("onInstitutionPublicTokenReceived:",this.basket.inProgressItem.publicToken),this.bankName=this.basket.bankName,this._fetchAccounts(this.basket.inProgressItem.publicToken,this.basket.inProgressItem.bankId,this.basket.inProgressItem.linkSessionId)}},{key:"_fetchAccounts",value:function(t,e,n){var i=this;this.submitErrors.length=0,this.$log.debug("_fetchAccounts called:",t,e,n);var a=[this.serviceConstants.STATUS_CODES.SUCCESS];this.isLoading=!0,this.showWaitAccountsModal=!0;var s=!1;if(this.basket.inProgressItem.isLoading=!0,this.basket.items.length>0){var r=this.basket.items.map((function(t){return t.bankName}));if(r&&r.length>0)r.indexOf(this.basket.inProgressItem.bankName)>=0&&(s=!0)}var o=angular.copy(this.basket.items),c=null;if(s){(c=o.find((function(t){return t.bankName.toUpperCase()===i.basket.inProgressItem.bankName.toUpperCase()}))).firstLink=!0;var l=o.indexOf(c);l>=1&&(o.splice(l,1),o.unshift(this.basket.inProgressItem))}else this.basket.inProgressItem.firstLink=!0,this.basket.inProgressItem.error=null,o.unshift(this.basket.inProgressItem);this.basket.items.length=0,o.forEach((function(t){return i.basket.items.push(t)}));var u=this.caller?this.caller:this.sources.FINANCIAL_PLAN;this.fetchFailed=!1,this.AccountAggregationService.getAccountAggregationSummary(e,"external",u,t,!0).then((function(t){if(t.response_status&&-1!==a.indexOf(t.response_status.status_code))i._processAccountsResponse(t,!1),i.basket.inProgressItem.error=!1,i.isLoading=!1,i._triggerAccountSummaryRefresh();else{i.$log.error("getAccountAggregationSummary failed resp:",t),i.basket.inProgressItem.error=!0;var e=i.basket.items.find((function(t){return t.bankName.toUpperCase()===i.basket.inProgressItem.bankName.toUpperCase()}));i._processAAFetchError(e),i.isLoading=!1}})).catch((function(t){i.$log.error("GET_ACCOUNT_AGGREGATION_SUMMARY rejected promise",t),i.isLoading=!1,(c=i.basket.items.find((function(t){return t.bankId.toUpperCase()===i.basket.inProgressItem.bankId.toUpperCase()}))).isLoading=!1,i._processAAFetchError(c),i.basket.inProgressItem=null}))}},{key:"_processAAFetchError",value:function(t){var e=this.$translate.instant("global.errorCodes.ACCT_AGGREGATION_FETCH");this.$log.error(e),t&&(t.error=e,t.isLoading=!1)}},{key:"_triggerAccountSummaryRefresh",value:function(){this.AccountSummaryPrefetchService.invalidateAggregatedAccounts()}},{key:"_processAccountsResponse",value:function(t,e){var n=this,a=[];if(t&&t.aggregated_accounts&&(a=t.aggregated_accounts),a&&0===a.length)return this.basket.inProgressItem.accounts=[],this.basket.inProgressItem.isLoading=!1,void(this.isLoading=!1);this.basket.inProgressItem&&1===a.length&&(this.basket.inProgressItem.bankId=a[0].institution_seqid?a[0].institution_seqid:a[0].institution_id),a.forEach((function(t){n.basket.items.forEach((function(a){var s;a.bankName.toUpperCase()===t.institution_name.toUpperCase()&&(a.accounts?a.accounts.length=0:a.accounts=[],a.isRelogin=!1,n.$log.debug("inside process items",t.status),t.status&&t.status===n.loginRequired&&(a.isRelogin=!0,a.status=n.loginRequired),(s=a.accounts).push.apply(s,(0,i.default)(t.accounts)),a.last_update_date=t.last_update_date,a.accounts.forEach((function(e){e.isChecked=!0,e.data=n._sanitizeAAaccountDescr(e.description)+"  ****"+e.mask+" "+t.institution_name,e.logo=t.institution_logo})),a.institution_name=t.institution_name,a.institution_id=t.institution_seqid?t.institution_seqid:t.institution_id,a.bankId=a.institution_id,a.logo=t.institution_logo,a.isLoading=!1,a.isRemoved=!1,a.isRefreshed=e)}))}))}},{key:"_postAASelectedAccounts",value:function(t,e){var n=this;this.AccountAggregationService.postAccountAggregationSelectedAccounts(t,!0).then((function(t){if(t.response_status.status_code!==n.serviceConstants.STATUS_CODES.SUCCESS)throw n.$log.error("postAASelectedAccounts -> error:",t),n.isLoading=!1,t;e&&(n.AccountSummaryPrefetchService.invalidateAggregatedAccounts(),n.AccountSummaryPrefetchService.preloadAggregatedAccounts(),n.EventBusService.publish(n.DATA_INVALIDATED,n.ROOT_ENDPOINTS.ACCOUNTS))})).catch((function(t){n.$log.error("FinancialPlanController -> postAASelectedAccounts error:",t),n.isLoading=!1}))}},{key:"_sanitizeAAaccountDescr",value:function(t){return(t=(t=t.replace(/[|&;$%@"<>\-+,_^=]/g,"")).replace(/\s\s/g," ")).trim()}},{key:"_processItemAuthorizationError",value:function(t,e,n,i){this.$log.error("AccountAggregation - Failed to authorise for publicToken="+e+" instId="+n+" reqId="+i);t.error="Failed to authorise. Remove and add the institution again to provide up to date login credentials",this.isLoading=!1,t.isLoading=!1,t.authError=!0,t.isRemoved=!0}},{key:"_processItemFetchAccountsError",value:function(t){this.$log.error("AccountAggregation - Failed to fetch accounts FI with itemRefId = "+t.itemRefId),this.isLoading=!1,t.isLoading=!1,t.fetchAccountsError=!0,t.isRemoved=!0}},{key:"_processItemRemoveError",value:function(t){this.$log.error("AccountAggregation - Failed to remove FI with itemRefId = "+t.itemRefId),this.isLoading=!1,t.isLoading=!1}},{key:"onItemRemove",value:function(){this.basket.inProgressItem&&this.basket.inProgressItem.isRemoved&&(this.isLoading=!1),this._triggerAccountSummaryRefresh()}},{key:"onItemRefresh",value:function(t){var e=this;this.$log.debug("inside item to be refreshed:",t),this.$timeout((function(){e._onRefreshBankItem(t),e.$log.debug("item refresh completed: ",t.bankId),e.isLoading=!0}),300)}},{key:"_onRefreshBankItem",value:function(t){var e=this,n=[this.serviceConstants.STATUS_CODES.SUCCESS],i=this.caller?this.caller:this.sources.FINANCIAL_PLAN;this.$log.debug("refresh will be called soon--- : ",t.bankId),this.AccountAggregationService.getAccountAggregationSummary(t.bankId,"external",i,null,!0).then((function(i){i.response_status&&-1!==n.indexOf(i.response_status.status_code)?(e._processAccountsResponse(i,!0),e.$log.debug("item processing completed : ",t.bankId),e.isLoading=!1,e._triggerAccountSummaryRefresh(),e.$log.debug("item refresh completed on account summary: ",t.bankId)):(e.$log.error("refreshAccountAggregationClient: Failed to refresh Aggregated accounts:",i),e.$log.error("AccountAggregation - Failed to refrsh FI with itemRefId = "+t.itemRefId),e.isLoading=!1,e._processAAFetchError(t))})).catch((function(n){e.$log.error("GET_ACCOUNT_AGGREGATION_SUMMARY rejected promise",n),e.isLoading=!1,e._processAAFetchError(t),e.basket.inProgressItem=null}))}},{key:"onAccountCheck",value:function(){}},{key:"onModalCloseCancel",value:function(){this.showModal=!1,this.isModal&&this.onClose()}},{key:"onModalCloseSave",value:function(){this.showModal=!1;this._postAASelectedAccounts(this.basket.items,!0),this.onClose()}},{key:"_storeItemAccountsInCardAccounts",value:function(){var t=this;this.basket.items.forEach((function(e){if(!e.isRemoved&&e.accounts){var n=void 0;e.accounts.forEach((function(i){i.isChecked&&((n=angular.copy(i)).bankName=e.bankName,n.logo_image=e.institution_logo,n.account_balance=i.balance.amount,n.last_update_date=e.last_update_date,t.aaTileExists(n)||t.cardTileAccounts.push(n))}))}}))}},{key:"aaTileExists",value:function(t){return this.cardTileAccounts.filter((function(e){return e.data===t.data})).length>0}},{key:"onCloseClicked",value:function(){this.showModal=!1,this.isModal&&this.onClose()}},{key:"onModalClose",value:function(){this.showModal=!1,this.isModal&&this.AccountSummaryPrefetchService.getAggregatedAccountsPromise()&&(this.EventBusService.publish(this.serviceConstants.DATA_INVALIDATED,this.serviceConstants.ROOT_ENDPOINTS.ACCOUNTS),this.onClose())}}]),t}();o.$inject=["$log","$timeout","AccountAggregationService","serviceConstants","$state","stateConstants","AccountAggregationConstants","AccountSummaryPrefetchService","EventBusService","$translate"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1965)),a=s(n(1966));function s(t){return t&&t.__esModule?t:{default:t}}n(1967);var r={template:i.default,controller:a.default,bindings:{basket:"<",isLoading:"<",isRelogin:"<",onInstitutionPublicTokenReceived:"&",addOtherBank:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-plaid-login"> <p></p> <p id="plaid-login-subtitle" class="paragraph-read"> {{\'fetchAccountsModal.infoRead\' | translate }} </p> <button ng-disabled="!$ctrl.isAAEnabledCfg || $ctrl.isLoading" class="btn btn-success link-button" id="plaid_login_link_btn" ng-click="$ctrl.openConsentModal()"> {{$ctrl.addBankButtonTitle}} </button> <tng-consent-bank-modal show-warning-on-exit="false" show-modal="$ctrl.showConsentBankModal" on-close-confirm="$ctrl.closeConsentBankModalWithAgree()" on-close="$ctrl.closeConsentBankModal()"> </tng-consent-bank-modal> <div ng-if="$ctrl.triggerAA"> <tng-plaid-login-basic expose-open-plaid-function="$ctrl.bindOpenPlaidFunction(openPlaid)" on-public-token-received-override="$ctrl.onTokenChanged(token, metadata)" on-exit="$ctrl.onExitFromAA(error,metadata)" is-consent-given="true" product-types="$ctrl.products"></tng-plaid-login-basic> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d){(0,i.default)(this,t),this.$log=e,this.$timeout=n,this.EnvironmentService=a,this.$translate=s,this.buildConstants=r,this.localeConstants=o,this.LocaleService=c,this.AccountAggregationService=l,this.AccountAggregationConstants=d,this.AnchorService=u,this.plaidPublicToken=null,this.pageId="plaidLogin",this.showConsentBankModal=!1,this.triggerAA=!1,this.products=[this.AccountAggregationConstants.AA_PRODUCTS_TRANSACTIONS]}return(0,a.default)(t,[{key:"$onInit",value:function(){this._initPlaid()}},{key:"_initPlaid",value:function(){this.isAAEnabledCfg=this.EnvironmentService.getPlaidConfig().isEnabled}},{key:"onTokenChanged",value:function(t,e){var n=this;this.plaidPublicToken=t,this.metadata=e,this.$log.debug("plaidPublicToken received:",this.plaidPublicToken);var i={};i.publicToken=this.plaidPublicToken,this.$timeout((function(){n.isLoading=!1,i.bankName=n.metadata.institution.name,i.bankId=n.metadata.institution.institution_id,i.linkSessionId=n.metadata.link_session_id,i.meta_acccounts=angular.copy(n.metadata.accounts),i.isLoading=!0,i.accounts=null,i.firstLink=!0,n.basket.inProgressItem=i,n.onInstitutionPublicTokenReceived()}),1e3)}},{key:"onExitFromAA",value:function(t,e){var n="unknown";e&&e.status&&(n=e.status),this.$log.log("Reason behind AA exit:",n),this.AccountAggregationService.sendAAExitAnalytics(n),this.AccountAggregationService.gotoAbandonedAAFeedback()}},{key:"openConsentModal",value:function(){this.showConsentBankModal=!0,this.triggerAA=!1}},{key:"closeConsentBankModalWithAgree",value:function(){this.showConsentBankModal=!1,this.triggerAA=!0}},{key:"closeConsentBankModal",value:function(){this.showConsentBankModal=!1,this.triggerAA=!1}},{key:"bindOpenPlaidFunction",value:function(t){this.openPlaid=t}},{key:"addBankButtonTitle",get:function(){var t=this.basket&&this.basket.items&&this.basket.items.length>0&&!this.isRelogin;return t&&1===this.basket.items.length&&this.basket.items[0].isRemoved&&(t=!1),t?this.$translate.instant("fetchAccountsModal.linkAnotherBankButton"):this.$translate.instant("fetchAccountsModal.linkYourBankButton")}}]),t}();r.$inject=["$log","$timeout","EnvironmentService","$translate","buildConstants","localeConstants","LocaleService","AccountAggregationService","AnchorService","AccountAggregationConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1969)),a=s(n(1970));function s(t){return t&&t.__esModule?t:{default:t}}n(1971);var r={template:i.default,controller:a.default,bindings:{items:"<",onItemRemove:"&",onItemRefresh:"&",onAccountCheck:"&",caller:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-aa-accounts"> <section class="medium-width-section-aa" ng-if="$ctrl.items.length > 0"> <div> <div ng-repeat="crtItem in $ctrl.items" track by $index ng-init="itemIndex = $index"> <div actionable_id="{{crtItem.bankName}}_title" class="c-aa-item" ng-if="!crtItem.isRemoved"> <table table--full class="header-section"> <tbody> <tr> <td class="td-image" ng-if="!crtItem.error"> <span> <img class="bank_logo" ng-src="data:image/png;base64,{{ crtItem.logo}}"/> </span> </td> <td colspan="2"> <div class="bank_info"> <div> <span class="bank_name">{{crtItem.bankName}}&nbsp;&nbsp;</span> </div> <div> <span ng-if="!crtItem.error" class="sub-title" id="{{ ::$ctrl.pageId }}_last_update_date_{{crtItem.bankName}}"> {{$ctrl._lastUpdateDateSubTitle(crtItem.last_update_date)}} </span> </div> </div> </td> <td ng-class="crtItem.firstLink ? \'buttons-fi-first-link\' : \'td-buttons-fi\'"> <span class="c-aa-accounts__hide-on-small-screen"> <span ng-if="!crtItem.firstLink && !crtItem.error"> <button ng-if="!crtItem.isRelogin" actionable-id="{{ ::$ctrl.pageId }}_refresh_{{crtItem.bankName}}_item_{{itemIndex}}" class="btn btn--prev c-aa-item btn-refresh-fi" ng-click="$ctrl.refreshAAItem(crtItem)" ng-disabled="$ctrl.isRefreshDisabled(crtItem)"> {{::\'link.refresh\' | translate}} </button> <button actionable-id="{{ ::$ctrl.pageId }}_remove_{{crtItem.bankName}}_item_{{itemIndex}}" class="btn c-aa-item btn-remove-fi" ng-click="$ctrl.removeItem(crtItem)"> {{::\'link.remove\' | translate}} </button> </span> </span> <span ng-if="crtItem.firstLink">&nbsp;</span>  <span class="c-aa-accounts__hide-on-large-screen"> <span ng-if="!crtItem.firstLink && !crtItem.error"> <div> <button ng-if="!crtItem.isRelogin" actionable-id="{{ ::$ctrl.pageId }}_refresh_{{crtItem.bankName}}_item_{{itemIndex}}" class="btn btn--prev c-aa-item btn-refresh-fi" ng-click="$ctrl.refreshAAItem(crtItem)" ng-disabled="$ctrl.isRefreshDisabled(crtItem)"> {{::\'link.refresh\' | translate}} </button> </div> <div> <button actionable-id="{{ ::$ctrl.pageId }}_remove_{{crtItem.bankName}}_item_{{itemIndex}}" class="btn c-aa-item btn-remove-fi" ng-click="$ctrl.removeItem(crtItem)"> {{::\'link.remove\' | translate}} </button> </div> </span> <span ng-if="crtItem.firstLink">&nbsp;</span> </span> </td> </tr> <tr ng-if="crtItem.error"> <td class="c-aa-item icon-warn-td"> <div class="c-aa-item icon-warn-el c-aa-item icon icon--warning"> <span class="icon-warning"></span> </div> </td> <td ng-if="crtItem.error"> <div class="sub-title-error"> <span id="{{ ::$ctrl.pageId }}_error_{{crtItem.bankName}}"> {{crtItem.error}} </span> </div> </td> </tr> <tr ng-if="crtItem.error"> <td> <span class="c-aa-item refresh-btn-err"> <button ng-if="!item.authError || !crtItem.isRelogin" actionable-id="{{ ::$ctrl.pageId }}_refresh_{{crtItem.bankName}}_item_{{itemIndex}}" class="btn btn--prev c-aa-item btn-refresh-fi" ng-click="$ctrl.refreshAAItem(crtItem)" ng-disabled="$ctrl.isRefreshDisabled(crtItem)"> {{::\'link.refresh\' | translate}} </button> </span> </td> <td> <span class="c-aa-item refresh-btn-err"> <button actionable-id="{{ ::$ctrl.pageId }}_remove_{{crtItem.bankName}}_item_{{itemIndex}}" class="btn c-aa-item btn-remove-fi" ng-click="$ctrl.removeItem(crtItem)"> {{::\'link.remove\' | translate}} </button> </span> </td> </tr> </tbody> </table> <div ng-if="crtItem.isRelogin && !crtItem.isLoading"> <div class="c-tile c-inbox__inbox-tile"> <div class="c-inbox-error-tile"> <div class="c-inbox-error-tile__tile-wrapper"> <div class="c-inbox-error-tile__tile-content"> <div class="c-inbox-error-tile__tile-info-wrapper"> <span class="bank_error_relink" ng-bind-html="::\'link.errorText1\' | translate"> </span> </div> <div class="c-inbox-error-tile__balance-info-wrapper"> <span class="c-aa-item refresh-btn-err"> <button actionable-id="{{ ::$ctrl.pageId }}_relink_{{crtItem.bankName}}_item_{{itemIndex}}" class="btn c-aa-item btn-relink-fi" ng-click="$ctrl.relinkAAItem(crtItem)"> {{::\'link.relink\' | translate}} </button> <div ng-if="$ctrl.publicTokenReceived"> <tng-plaid-login-basic expose-open-plaid-function="$ctrl.bindOpenPlaidFunction(openPlaid)" on-public-token-received-override="$ctrl.onTokenReset(token, metadata)" on-exit="$ctrl.onExitFromAA(error,metadata)" is-consent-given="true" product-types="$ctrl.products" public-token="$ctrl.newPublicToken"></tng-plaid-login-basic> </div> </span> </div> </div> </div> </div>  </div> </div> <div class="tile-container" ng-if="crtItem.isLoading"> <table> <tr> <td> <tng-loading-in-progress ng-if="crtItem.isLoading" class="c-loading-spinner"></tng-loading-in-progress> </td> <td> &nbsp;&nbsp;&nbsp; <span ng-bind-html="::\'fetchAccountsModal.fetchAcountsProgressInfo\' | translate: { bank_name: crtItem.bankName}"></span> </td> </tr> </table> </div> <div ng-if="!crtItem.isLoading && crtItem.accounts && crtItem.accounts.length > 0 && !crtItem.isRelogin" class="c-aa-item item-header"> <span class="c-aa-item hdr_include"> {{::\'fetchAccountsModal.headerInclude\' | translate}} </span> <span class="c-aa-item hdr_descr"> {{::\'fetchAccountsModal.headerDescr\' | translate}} </span>  <span class="c-aa-item hdr_amount"> {{::\'fetchAccountsModal.headerAmounts\' | translate}}</span>  </div> <div class="c-aa-item"> <div ng-if="!crtItem.isLoading && crtItem.accounts && !crtItem.isRemoved && !crtItem.isRelogin" ng-repeat="acct in crtItem.accounts" track by $index ng-init="acctIndex = $index"> <div class="c-tile c-inbox__inbox-tile"> <div class="c-inbox-tile"> <div class="c-inbox-tile__tile-wrapper"> <div class="c-inbox-tile__tile-content"> <div class="c-inbox-tile__tile-input field" actionable-id="inbox_tile_checkbox_item_{{crtItem.bankName}}_account_{{ crtItem.accounts[acctIndex].data }}_isChecked={{crtItem.accounts[acctIndex].isChecked}}"> <input actionable-id="inbox_tile_checkbox_item_{{itemIndex}}_account_{{ acctIndex }}" type="checkbox" ng-model="crtItem.accounts[acctIndex].isChecked" ng-change="$ctrl.handleAccountCheck(itemIndex,acctIndex)" class="c-inbox-tile__checkbox input"/> <label actionable_id="check_label_{{ crtItem.accounts[acctIndex].data }}" class="c-inbox-tile__checkbox-label" for="inbox_tile_checkbox_item_{{itemIndex}}_account_{{ acctIndex }}"></label> </div> <div class="c-inbox-tile__tile-info-wrapper"> <div class="c-inbox-tile__tile-info"> <h3 class="c-inbox-tile__tile-subject" id="$ctrl.pageId_accountName_item_{{itemIndex}}_account_{{acctIndex}}"> {{ $ctrl.getAccountName(crtItem,acctIndex) }} </h3> <div actionable-id="{{ crtItem.bankName }}_description" class="c-inbox-tile__tile-bank-name"> <p>{{ crtItem.bankName }}</p> </div> </div> </div> <div class="c-inbox-tile__balance-info-wrapper"> <div class="c-inbox-tile__tile-info"> <h3 class="c-inbox-tile__tile-subject" id="$ctrl.pageId_amount_{{itemIndex}}_account_{{acctIndex}}"> <span> <span>{{ ::acct.balance.amount | currency }}</span> <span ng-if="$ctrl.isUSD(acct)">{{ ::\'global.currencies.USD\' | translate }}</span> </span> </h3> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> </section> <div ng-if="$ctrl.showRemoveBankModal"> <tng-remove-bank-modal bank-item="$ctrl.bankItemToRemove" show-warning-on-exit="false" show-modal="$ctrl.showRemoveBankModal" on-remove="$ctrl.onAAItemRemove(itemToRemove)" on-close-confirm="$ctrl.closeRemoveBankModalWithConfirm(itemToRemove)" on-close="$ctrl.closeRemoveBankModal()"> </tng-remove-bank-modal> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.$log=e,this.AccountAggregationService=n,this.accountConstants=a,this.AccountAggregationConstants=s,this.serviceConstants=r,this.plaidPublicToken=null,this.pageId="plaidLogin",this.showRemoveBankModal=!1,this.removedBanks=[],this.publicTokenReceived=!1,this.products=[this.AccountAggregationConstants.AA_PRODUCTS_TRANSACTIONS]}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.itemToRelink={},this.refreshedBanks=[],this.items&&this.items.length>0&&this.items.forEach((function(e){e.isRefreshed=!1,e.isRelogin=!1,e.status===t.AccountAggregationConstants.AA_LOGIN_REQUIRED&&(e.isRelogin=!0),e.firstLink=!1}))}},{key:"isUSD",value:function(t){return t.balance&&t.balance.currency&&t.balance.currency===this.accountConstants.CURRENCY_TYPES.USD}},{key:"getAccountName",value:function(t,e){var n=t.accounts[e],i=n.description+"  ****"+n.mask;if(n.data){var a=n.data.indexOf("****");i=n.data.substring(0,a+8)}else n.data=n.description+"  ****"+n.mask+" "+t.bankName;return i}},{key:"removeItem",value:function(t){this.bankItemToRemove=t,t&&this.caller&&(t.caller=this.caller),this.showRemoveBankModal=!0}},{key:"refreshAAItem",value:function(t){t.isLoading=!0,t.error=!1,-1===this.refreshedBanks.indexOf(t.institution_id)&&this.refreshedBanks.push(t.institution_id);var e=t;this.onItemRefresh({itemToRefresh:e})}},{key:"relinkAAItem",value:function(t){var e=this;t.isLoading=!0,t.error=!1;var n=[this.serviceConstants.STATUS_CODES.SUCCESS];this.AccountAggregationService.getAccountAggregationPublicToken(t.bankId).then((function(i){i.response_status&&-1!==n.indexOf(i.response_status.status_code)?(e.isLoading=!1,e.newPublicToken=i.public_token,e.publicTokenReceived=!0,t.isLoading=!1,e.itemToRelink=t):(e.$log.error("relinkAAItem: Failed to relink Aggregated accounts:",i),e.$log.error("AccountAggregation - Failed to retrieve token = "+t.bankId),e.isLoading=!1,e._processAAFetchError(t))})).catch((function(n){e.$log.error("GET_ACCOUNT_AGGREGATION_TOKEN rejected promise",n),e.isLoading=!1,e._processAAFetchError(t)}))}},{key:"_processAAFetchError",value:function(t){var e=this.$translate.instant("global.errorCodes.ACCT_AGGREGATION_FETCH");this.$log.error(e),t&&(t.error=e,t.isLoading=!1)}},{key:"onTokenReset",value:function(t,e){this.$log.debug("token reset happened successfully:",e),this.plaidPublicToken=t,this.metadata=e,this.$log.debug("plaidPublicToken received on relink:",this.plaidPublicToken),this.publicTokenReceived=!1,this.itemToRelink.isLoading=!0,this.onItemRefresh({itemToRefresh:this.itemToRelink})}},{key:"bindOpenPlaidFunction",value:function(t){this.openPlaid=t}},{key:"onExitFromAA",value:function(t,e){var n="unknown";e&&e.status&&(n=e.status),this.itemToRelink={},this.publicTokenReceived=!1,this.$log.log("Reason behind AA exit:",n),this.AccountAggregationService.sendAAExitAnalytics(n),this.AccountAggregationService.gotoAbandonedAAFeedback()}},{key:"isRefreshDisabled",value:function(t){return-1!==this.refreshedBanks.indexOf(t.institution_id)&&!t.error}},{key:"onAAItemRemove",value:function(t){this.onItemRemove({itemToRemove:t})}},{key:"closeRemoveBankModalWithConfirm",value:function(t){this.showRemoveBankModal=!1,t.isRemoved=!0}},{key:"closeRemoveBankModal",value:function(){this.showRemoveBankModal=!1}},{key:"handleAccountCheck",value:function(){this.onAccountCheck&&this.onAccountCheck()}},{key:"_lastUpdateDateSubTitle",value:function(t){return this.AccountAggregationService.lastUpdateDateSubTitle(t)}}]),t}();r.$inject=["$log","AccountAggregationService","accountConstants","AccountAggregationConstants","serviceConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1973)),a=s(n(1974));function s(t){return t&&t.__esModule?t:{default:t}}n(1975);var r={template:i.default,controller:a.default,bindings:{bankItem:"<?",onCloseConfirm:"&",onClose:"&",onRemove:"&",showWarningOnExit:"<?",showModal:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog ng-if="$ctrl.showModal" on-close="$ctrl.onModalClose()" class="c-remove-bank"> <div class="c-remove-bank left-aligned-image c-confirm-exit__icon icon icon--warning"> <span class="icon-warning"></span> </div> <header class="narrow-width-section"> <span id="{{::$ctrl.pageId}}-title"> {{::\'removeBank.areYouSure\' | translate: { bank_name: $ctrl.bankItem.institution_name} }} </span> </header> <p></p><p></p> <p id="{{::$ctrl.pageId}}-subtitle"> {{\'removeBank.subHeader\' | translate }} </p> <div ng-if="$ctrl.hasErrors"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> </div> <div ng-show="$ctrl.isLoading"> <div class="loading--full-modal"> <tng-loading-in-progress></tng-loading-in-progress> </div> </div> <footer> <button actionable-id="{{::$ctrl.pageId}}-modal-cancel_btn" class="btn btn--prev" ng-click="$ctrl.onModalClose()" translate-cloak> {{\'removeBank.noCancel\' | translate }} </button> <button actionable-id="{{::$ctrl.pageId}}-add-modal-delete_btn" class="btn btn--warn" ng-click="$ctrl.onRemoveClicked()" translate-cloak> {{\'removeBank.yesRemove\' | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f){(0,i.default)(this,t),this.$scope=e,this.$log=n,this.$q=a,this.$timeout=s,this.$translate=r,this.ErrorService=o,this.errorConstants=c,this.serviceConstants=l,this.AnchorService=u,this.pageId="RemoveBankModal",this.AccountAggregationService=d,this.AccountAggregationConstants=h,this.AccountSummaryPrefetchService=f}return(0,a.default)(t,[{key:"$onInit",value:function(){this.bankRemoved=!1,this.isLoading=!1,this.showModal=!0,this.showModal=!0}},{key:"onModalClose",value:function(){this.showModal=!1,this.onClose()}},{key:"submit",value:function(){this.onRemoveClicked()}},{key:"onRemoveClicked",value:function(){var t=this,e=[this.serviceConstants.STATUS_CODES.SUCCESS];this.bankItem.bankId||(this.bankItem.bankId=this.bankItem.institution_id);var n=this.bankItem.caller?this.bankItem.caller:this.AccountAggregationConstants.SOURCES.FINANCIAL_PLAN;this.AccountAggregationService.deleteAccountAggregationClient(n,this.bankItem.bankId).then((function(n){if(n.response_status&&-1!==e.indexOf(n.response_status.status_code)){t.AccountSummaryPrefetchService.invalidateAggregatedAccounts();var i=t.bankItem;t.onCloseConfirm({itemToRemove:i})}else{t.$log.error("deleteAccountAggregationClient: Failed to remove Aggregated accounts:",n),t.$log.error("AccountAggregation - Failed to remove FI with itemRefId = "+t.bankItem.itemRefId),t.onClose();var a=t.bankItem;t.onCloseConfirm({itemToRemove:a})}}),(function(e){t.$log.error("deleteAccountAggregationClient: Failed to remove Aggregated accounts:",e),t.$log.error("AccountAggregation - Failed to remove FI with itemRefId = "+t.bankItem.itemRefId),t.onClose()})).finally((function(){t.showModal=!1}))}},{key:"onCloseClicked",value:function(){this.showModal=!1}},{key:"_showSubmitErrors",value:function(t){var e=this;this.submitErrors=[],this.ErrorService.processError(t,this.errorConstants.AVAILABLE_EVENTS.REQUEST_ERROR).then((function(t){e.submitErrors=[t.message]})).catch((function(t){e.$log.error("_showSubmitErrors error",t),e.errors=[e.$translate.instant("global.errorCodes.generic")]}))}},{key:"_resetSubmitErrors",value:function(){this.$log.debug("resetting submit errors"),this.submitErrors=[]}},{key:"_closeModal",value:function(){this.onClose()}},{key:"hasErrors",get:function(){return this.submitErrors&&this.submitErrors.length>0}}]),t}();r.$inject=["$scope","$log","$q","$timeout","$translate","ErrorService","errorConstants","serviceConstants","AnchorService","AccountAggregationService","AccountAggregationConstants","AccountSummaryPrefetchService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1977)),a=s(n(1978));function s(t){return t&&t.__esModule?t:{default:t}}n(1979);var r={template:i.default,controller:a.default,bindings:{onCloseConfirm:"&",onClose:"&",showWarningOnExit:"<?",showModal:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog ng-if="$ctrl.showModal" on-close="$ctrl.onModalClose()" class="c-consent-bank"> <header class="narrow-width-section"> <span id="{{::$ctrl.pageId}}-title"> <div ng-bind-html="::\'consentBank.header\' | translate"></div> </span> </header> <div ng-if="$ctrl.hasErrors"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> </div> <div ng-show="$ctrl.isLoading"> <div class="loading--full-modal"> <tng-loading-in-progress></tng-loading-in-progress> </div> </div> <section> <div class="grid__container section-top-space"> <div class="styleguide-grid-unit confirm-tile-section grid__column--1of1 narrow-width-section"> <tng-tile-item class="c-tile c-tile__item--override"> <div class="medium-text-bold content-width" ng-bind-html="::\'consentBank.consentHeader\' | translate"> </div> </tng-tile-item> </div> <div class="styleguide-grid-unit confirm-tile-section grid__column--1of1 narrow-width-section"> <tng-tile-item class="c-tile c-tile__item--override"> <div class="small-text content-width"> <p ng-bind-html="::\'consentBank.consent1\' | translate"> </p> <p ng-bind-html="::\'consentBank.consent2\' | translate"> </p> <p ng-bind-html="::\'consentBank.consent3\' | translate"> </p> </div> </tng-tile-item> </div> </div> <div class="medium-text-bold"> <tng-checkbox-input class="field--override" input-id="{{::$ctrl.pageId}}_checkbox" label="{{ ::\'consentBank.checkbox\' | translate}}" tng-model="$ctrl.consentProvided" tng-change="$ctrl.enableNext()"> </tng-checkbox-input> </div> </section> <footer> <button actionable-id="{{::$ctrl.pageId}}-modal-cancel_btn" class="btn btn--prev" ng-click="$ctrl.onModalClose()" translate-cloak> {{::\'consentBank.cancel\' | translate }} </button> <button actionable-id="{{::$ctrl.pageId}}-add-modal-next_btn" class="btn btn--next" ng-disabled="!$ctrl.consentProvided" ng-click="$ctrl.onNextClicked()" translate-cloak> {{::\'consentBank.next\' | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c){(0,i.default)(this,t),this.$scope=e,this.$log=n,this.$q=a,this.$timeout=s,this.$translate=r,this.ErrorService=o,this.errorConstants=c,this.pageId="ConsentBankModal"}return(0,a.default)(t,[{key:"$onInit",value:function(){this.isLoading=!1,this.consentProvided=!1}},{key:"onModalClose",value:function(){this.showModal=!1,this.consentProvided=!1,this.onClose()}},{key:"submit",value:function(){this.onNextClicked()}},{key:"enableNext",value:function(){this.$log.log("consent received:",this.consentProvided)}},{key:"onNextClicked",value:function(){this.onCloseConfirm(),this.consentProvided=!1,this.showModal=!1}},{key:"onCloseClicked",value:function(){this.showModal=!1,this.consentProvided=!1}},{key:"_resetSubmitErrors",value:function(){this.$log.debug("resetting submit errors"),this.submitErrors=[]}},{key:"_closeModal",value:function(){this.onClose()}},{key:"hasErrors",get:function(){return this.submitErrors&&this.submitErrors.length>0}}]),t}();r.$inject=["$scope","$log","$q","$timeout","$translate","ErrorService","errorConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f,p){(0,i.default)(this,t),this.$q=e,this.$log=n,this.$translate=d,this.RequesterService=a,this.AVAILABLE_SERVICES=s.AVAILABLE_SERVICES,this.sources=r.SOURCES,this.timeDivision=r.TIME_DIVISION,this.AnalyticsService=o,this.GlobalModalsService=c,this.StepUpService=l,this.$timeout=u,this.FeedbackSurveyConstants=h,this.AccountAggregationFeedbackService=f,this.ANALYTICS_AVAILABLE_EVENTS=this.AnalyticsService.availableEvents,this.AccountAggregationConstants=r,this.AccountSummaryPrefetchService=p}return(0,a.default)(t,[{key:"postAccountAggregationAuthorization",value:function(t,e,n,i){var a={urlVars:{},data:{public_token:t,request_id:n}};return i&&(a.data.caller=i),this.$log.debug("postAccountAggregationAuthorization",a),this.RequesterService.request(this.AVAILABLE_SERVICES.POST_ACCOUNT_AGGREGATION_AUTHORIZATION,a)}},{key:"getAccountAggregationSummary",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.sources.FINANCIAL_PLAN,i=arguments[3],a=arguments[4];this.$log.debug("getAccountAggregationSummary");var s={urlVars:{queryString:i?"caller="+n+"&institutions="+t+"&source="+e+"&public_token="+i+"&include_logo="+a:"caller="+n+"&institutions="+t+"&source="+e+"&include_logo="+a}};return this.RequesterService.request(this.AVAILABLE_SERVICES.GET_ACCOUNT_AGGREGATION_SUMMARY,s,{resetCache:!0})}},{key:"deleteAccountAggregationClient",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sources.FINANCIAL_PLAN,e=arguments[1];this.$log.info("source: ",t,"remove institution: ",e);var n={urlVars:{queryString:e?"caller="+t+"&institution_id="+e:"caller="+t}};return this.$log.debug("deleteAccountAggregationClient"),this.RequesterService.request(this.AVAILABLE_SERVICES.DELETE_ACCOUNT_AGGREGATION_CLIENT,n)}},{key:"getAccountAggregationPublicToken",value:function(t){this.$log.info("getAccountAggregationPublicToken institution: ",t);var e={urlVars:{queryString:"institution_id="+t}};return this.$log.debug("getAccountAggregationPublicToken"),this.RequesterService.request(this.AVAILABLE_SERVICES.GET_ACCOUNT_AGGREGATION_TOKEN,e)}},{key:"postAccountAggregationSelectedAccounts",value:function(t,e){this.$log.info("inside postAccountAggregationSelectedAccounts: ");var n={urlVars:{},data:{caller:e?this.sources.ACCOUNT_SUMMARY:this.sources.FINANCIAL_PLAN,selected_accounts:[]}};return this._prepareSelectedAccounts(n,t),this.$log.debug("postAccountAggregationSelectedAccounts"),this.AccountSummaryPrefetchService.invalidateAggregatedAccounts(),this.RequesterService.request(this.AVAILABLE_SERVICES.POST_ACCOUNT_AGGREGATION_SELECTED_ACCOUNTS,n)}},{key:"sendAAExitAnalytics",value:function(t){this.AnalyticsService.sendAction(this.ANALYTICS_AVAILABLE_EVENTS.ACCOUNT_AGGREGATION_EVENT,t)}},{key:"_prepareSelectedAccounts",value:function(t,e){e.forEach((function(e){if(!e.isRemoved&&e.accounts&&!e.isRelogin){var n={institution_id:e.bankId,accounts:[]};e.accounts.forEach((function(t){if(t.isChecked){var e={id:t.id_hashed};n.accounts.push(e)}})),t.data.selected_accounts.push(n)}}))}},{key:"lastUpdateDateSubTitle",value:function(t){return t?this.$translate.instant("lastUpdateDate.updatedSubtitle",{value:t}):null}},{key:"getMostRecentLastUpdateDateSubtitle",value:function(t){if(t&&t.length>0){var e=t.map((function(t){return t.last_update_date})).reduce((function(t,e){return t>e?t:e}));return this.lastUpdateDateSubTitle(e)}return null}},{key:"gotoAbandonedAAFeedback",value:function(){var t=this;this.$timeout((function(){var e=t.FeedbackSurveyConstants.MEDALLIA_FORM_IDS.ACCOUNT_AGGREGATION_ABANDONED_FEEDBACK;t.AccountAggregationFeedbackService.launchFeedbackSurvey(e)}),this.AccountAggregationConstants.AA_ABANDON_DELAY_SURVEY)}},{key:"editAggregatedAccount",value:function(t,e,n){var i=this,a=t,s={items:[],userReviewed:!0};return e.forEach((function(e){e.bankName=e.institution_name,e.logo=e.institution_logo,e.bankId=e.institution_seqid?e.institution_seqid:e.institution_id,e.isRemoved=!1,e.accounts&&e.accounts.forEach((function(n){return function(e,n){var i=t.filter((function(t){return t.bankId===n.bankId&&t.id_hashed===e.id_hashed&&!t.isRelogin}));e.isChecked=!1,i&&i.length>0&&(e.isChecked=!0);var a=e.description+"  ****"+e.mask+" "+n.institution_name;e.data=a}(n,e)})),s.items.push(e)})),this.StepUpService.requestLevel2().then((function(){return i.GlobalModalsService.showAccountAggregationModal(a,s,n)}))}},{key:"addAggregatedAccount",value:function(t,e){var n=this,i=t;return this.StepUpService.requestLevel2().then((function(){return n.GlobalModalsService.showAccountAggregationModal(i,{},e)}))}}]),t}();r.$inject=["$q","$log","RequesterService","serviceConstants","AccountAggregationConstants","AnalyticsService","GlobalModalsService","StepUpService","$timeout","$translate","FeedbackSurveyConstants","AccountAggregationFeedbackService","AccountSummaryPrefetchService"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f){(0,i.default)(this,t),this.$log=e,this.$rootScope=h,this.LocaleService=n,this.$window=a,this.$timeout=s,this.document=r[0],this.isMedalliaSupported=this.$window.MEDALLIA_BUTTON_ENABLED,this.localeConstants=o,this.LOCALES=o.LOCALES,this.serviceConstants=c,this.RequesterService=l,this.SessionService=u,this.FeedbackSurveyConstants=d,this.SURVEY_OPEN_CSS_CLASS="medallia-survey-open",this.eventConstants=f}return(0,a.default)(t,[{key:"launchFeedbackSurvey",value:function(t){this.loadFormId=this.LocaleService.locale===this.LOCALES.EN_CA?t.EN:t.FR,this.aaFormId=this.loadFormId,this.loadFormId&&(this.document.body.classList.add(this.SURVEY_OPEN_CSS_CLASS),this.document.documentElement.classList.add(this.SURVEY_OPEN_CSS_CLASS),void 0!==this.$window.KAMPYLE_EVENT_DISPATCHER&&null!==this.$window.KAMPYLE_EVENT_DISPATCHER&&(this.$window.KAMPYLE_EVENT_DISPATCHER.trigger("neb_buttonClicked",{formId:this.loadFormId}),this.$window.KAMPYLE_EVENT_DISPATCHER.subscribeOnce("neb_formClosed",this.onFeedbackSurveyClosed.bind(this))))}},{key:"onFeedbackSurveyClosed",value:function(){this.document.body.classList.remove(this.SURVEY_OPEN_CSS_CLASS),this.document.documentElement.classList.remove(this.SURVEY_OPEN_CSS_CLASS),this.processAASurveyClosed()}},{key:"updatePageViewAndLocale",value:function(){this.$window.KAMPYLE_ONSITE_SDK.updatePageView()}},{key:"processAASurveyClosed",value:function(){this.aaFormId&&(this.loadFormId=this.aaFormId);var t=this.FeedbackSurveyConstants.MEDALLIA_FORM_IDS;switch(this.loadFormId){case t.ACCOUNT_AGGREGATION_ABONDONED_FEEDBACK.EN:case t.ACCOUNT_AGGREGATION_ABONDONED_FEEDBACK.FR:this.$rootScope.$broadcast(this.eventConstants.AA_ABONDONED_SURVEY_CLOSED)}}}]),t}();r.$inject=["$log","LocaleService","$window","$timeout","$document","localeConstants","serviceConstants","RequesterService","SessionService","FeedbackSurveyConstants","$rootScope","eventConstants"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={SOURCES:{FINANCIAL_PLAN:"FP",KYC_MANAGER:"KYC_MANAGER",ACCOUNT_SUMMARY:"ACCOUNT_SUMMARY"},AA_EXIT_EVENT:"plaidLinkExit",TIME_DIVISION:[{unit:"hour",maxValue:24},{unit:"day",maxValue:1e5}],AA_ABANDON_DELAY_SURVEY:3e3,AA_PRODUCTS_TRANSACTIONS:"transactions",AA_LOGIN_REQUIRED:"LOGIN_REQUIRED"},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=r(n(272));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e){var n=e.type,a=e.description,r=e.value,o=e.currency,c=e.minMonthlyPayment,l=e.propertyTaxes;(0,i.default)(this,t),this.type=n,this.typeCode=n?n.code:null,this.description=a,this.value=r,this.currency=o||s.default.CAD,this.minMonthlyPayment=c,this.propertyTaxes=l}return(0,a.default)(t,[{key:"accountData",get:function(){return["<strong>"+this.description+"</strong>",this.type.name]}}]),t}();e.default=o,t.exports=e.default},,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(15)),a=c(n(0)),s=c(n(2)),r=c(n(199)),o=c(n(367));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(){(0,a.default)(this,t)}return(0,s.default)(t,null,[{key:"getDisplayedPhones",value:function(t,e,n,a){var s={displayedInfo:e,preferredPhoneKey:n,editHomePhone:{},editMobilePhone:{},editWorkPhone:{}};return(0,i.default)(r.default.API.PHONE_TYPE).forEach((function(e,n){(!a||r.default.API.PHONE_TYPE[e]!==r.default.API.PHONE_TYPE.HOME&&r.default.API.PHONE_TYPE[e]!==r.default.API.PHONE_TYPE.CELL)&&o.default.findObjectType(t,"phone_list",r.default.API.PHONE_TYPE[e].KEY,(function(t){var i={order:2+n,label:r.default.API.PHONE_TYPE[e].TABLE_TITLE_TRANSLATION},a=t.number;r.default.API.PHONE_TYPE[e]===r.default.API.PHONE_TYPE.BUSINESS&&t.extension&&(a=a+" ext. "+t.extension),t.preferred?(i.preferredText=a,s.preferredPhoneKey=r.default.API.PHONE_TYPE[e].KEY):i.text=a,s.displayedInfo.push(i),r.default.API.PHONE_TYPE[e]===r.default.API.PHONE_TYPE.HOME?s.editHomePhone=t:r.default.API.PHONE_TYPE[e]===r.default.API.PHONE_TYPE.CELL?s.editMobilePhone=t:r.default.API.PHONE_TYPE[e]===r.default.API.PHONE_TYPE.BUSINESS&&(s.editWorkPhone=t)}),(function(){r.default.API.PHONE_TYPE[e]===r.default.API.PHONE_TYPE.HOME?s.editHomePhone={number:"",type:r.default.API.PHONE_TYPE.HOME.KEY}:r.default.API.PHONE_TYPE[e]===r.default.API.PHONE_TYPE.CELL?s.editMobilePhone={number:"",type:r.default.API.PHONE_TYPE.CELL.KEY}:r.default.API.PHONE_TYPE[e]===r.default.API.PHONE_TYPE.BUSINESS&&(s.editWorkPhone={number:"",type:r.default.API.PHONE_TYPE.BUSINESS.KEY})}))})),s}},{key:"updatePhoneNumber",value:function(t,e,n,i,a,s){var o={userData:n,editHomePhone:i,editMobilePhone:a,editWorkPhone:s};return e===r.default.API.PHONE_TYPE.HOME.KEY?(o.editHomePhone.number=t,o=this._updatedResponsePhoneUserData(t,e,o)):e===r.default.API.PHONE_TYPE.CELL.KEY?(o.editMobilePhone.number=t,o=this._updatedResponsePhoneUserData(t,e,o)):e===r.default.API.PHONE_TYPE.BUSINESS.KEY&&(o.editWorkPhone.number=t,o=this._updatedResponsePhoneUserData(t,e,o)),o}},{key:"updatePreferredPhone",value:function(t,e,n,i,a){var s={preferredPhoneKey:t,editHomePhone:n,editMobilePhone:i,editWorkPhone:a};return e===r.default.API.PHONE_TYPE.HOME.KEY&&s.editHomePhone.number?(s.preferredPhoneKey=e,s.editHomePhone.preferred=!0,s.editMobilePhone.preferred&&delete s.editMobilePhone.preferred,s.editWorkPhone.preferred&&delete s.editWorkPhone.preferred):e===r.default.API.PHONE_TYPE.CELL.KEY&&s.editMobilePhone.number&&(s.preferredPhoneKey=e,s.editMobilePhone.preferred=!0,s.editHomePhone.preferred&&delete s.editHomePhone.preferred,s.editWorkPhone.preferred&&delete s.editWorkPhone.preferred),e===r.default.API.PHONE_TYPE.BUSINESS.KEY&&s.editWorkPhone.number&&(s.preferredPhoneKey=e,s.editWorkPhone.preferred=!0,s.editHomePhone.preferred&&delete s.editHomePhone.preferred,s.editMobilePhone.preferred&&delete s.editMobilePhone.preferred),s}},{key:"getPhoneListForRequest",value:function(t,e){var n={infoPayload:e};return n.infoPayload[r.default.CUSTOMER_JSON_KEY].phone_list||(n.infoPayload[r.default.CUSTOMER_JSON_KEY].phone_list=[]),(0,i.default)(r.default.API.PHONE_TYPE).forEach((function(e){o.default.findObjectType(t,"phone_list",r.default.API.PHONE_TYPE[e].KEY,(function(t){n.infoPayload[r.default.CUSTOMER_JSON_KEY].phone_list.push(t)}),(function(){}))})),n}},{key:"savePhones",value:function(t,e,n,i,a,s){var o={infoPayload:e,originalData:angular.copy(t),isAnyPhoneChanged:n};o.infoPayload[r.default.CUSTOMER_JSON_KEY].phone_list||(o.infoPayload[r.default.CUSTOMER_JSON_KEY].phone_list=[]),o=this._comparePhoneForSaving(i,r.default.API.PHONE_TYPE.HOME.KEY,o),o=this._comparePhoneForSaving(a,r.default.API.PHONE_TYPE.CELL.KEY,o);var c=s;return Object.prototype.hasOwnProperty.call(c,"extension")&&c.extension.length<1&&delete c.extension,(o=this._comparePhoneForSaving(c,r.default.API.PHONE_TYPE.BUSINESS.KEY,o)).infoPayload[r.default.CUSTOMER_JSON_KEY].phone_list.length<=0&&delete o.infoPayload[r.default.CUSTOMER_JSON_KEY].phone_list,o}},{key:"_updatedResponsePhoneUserData",value:function(t,e,n){var i=n;return o.default.findObjectType(i.userData,"phone_list",e,(function(n,a){i.userData.phone_list[a].number=t,i.userData.phone_list[a].type=e})),i}},{key:"_comparePhoneForSaving",value:function(t,e,n){var a=n;return(0,i.default)(t).length>1&&angular.isDefined(t.number)?o.default.findObjectType(a.originalData,"phone_list",e,(function(e,n){angular.equals(t,e)?a.infoPayload[r.default.CUSTOMER_JSON_KEY].phone_list.push(e):(a.infoPayload[r.default.CUSTOMER_JSON_KEY].phone_list.push(t),a.originalData.phone_list[n]=angular.copy(t),a.isAnyPhoneChanged=!0)}),(function(){t.number&&(a.infoPayload[r.default.CUSTOMER_JSON_KEY].phone_list.push(t),a.originalData.phone_list.push(angular.copy(t)),a.isAnyPhoneChanged=!0)})):o.default.findObjectType(a.originalData,"phone_list",e,(function(t){a.infoPayload[r.default.CUSTOMER_JSON_KEY].phone_list.push(t)})),a}}]),t}();e.default=l,t.exports=e.default},,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(8)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s,r){(0,a.default)(this,t),this.RequesterService=e,this.serviceConstants=n,this.$httpParamSerializer=i,this.TransactionsFiltersService=s,this.TransactionsChartRequestsService=r}return(0,s.default)(t,[{key:"getScheduledPayments",value:function(){var t={urlVars:{queryString:void 0}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.PENDING_TRANSACTIONS,t)}},{key:"getPostedPayments",value:function(t,e){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.BILL_POSTED_PAYMENTS,{urlVars:{queryString:this._prepareQueryStringForPostedPayments(t,e)}})}},{key:"getAccounts",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.BILL_PAY_ACCOUNTS)}},{key:"getPayeeDetails",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.PAYEE_LIST).then((function(e){return e.payees.find((function(e){return e.id===t}))}))}},{key:"getHistoryChartData",value:function(t){return this.TransactionsChartRequestsService.getPayeeTransactionsHistory(t,{payeeId:t.id})}},{key:"_prepareQueryStringForPostedPayments",value:function(t,e){return this.$httpParamSerializer((0,i.default)({payeeId:t.id},this.TransactionsFiltersService.filtersToQueryObject(e)))}}]),t}();o.$inject=["RequesterService","serviceConstants","$httpParamSerializer","TransactionsFiltersService","TransactionsChartRequestsService"],e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CaretPositioningHelper=e.KEYBOARD_KEYS=void 0;var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=e.KEYBOARD_KEYS={BACK_SPACE:8,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,DELETE:46},o=e.CaretPositioningHelper=function(){function t(e,n,a,s){(0,i.default)(this,t),this.input=angular.element(e)[0],this.$log=n,this.element=e,this.getCaretMap=a,this.isLeftFormated=s,this.caretPositionFromLeft=0,this.caretPositionFromRight=0,this.caretPositionCorrection=0,this.oldInputValue=null,this.oldCountInvalidPositionsToEnd=0,this.oldCountInvalidPositionsToStart=0,this.oldCountInvalidPositionsAfterCaret=0,this.oldCountInvalidPositionsBeforeCaret=0,this.oldCountValidPositionsToEnd=0,this.oldCountValidPositionsToStart=0,e.on("keydown",this.keydownHandler.bind(this)),e.on("keyup",this.keyupHandler.bind(this))}return(0,a.default)(t,[{key:"$onDestroy",value:function(){this.element.off("keydown"),this.element.off("keyup")}},{key:"isValidCaretPosition",value:function(t){return this.getCaretMap()[angular.isDefined(t)?t:this.getCaretPosition()]}},{key:"getSelectionLength",value:function(){var t=this.input;return t?void 0!==t.selectionStart?t.selectionEnd-t.selectionStart:window.getSelection?window.getSelection().toString().length:document.selection?document.selection.createRange().text.length:0:0}},{key:"getCaretPosition",value:function(){var t=this.input;if(!t)return 0;if(void 0!==t.selectionStart)return t.selectionStart;if(document.selection&&this._isFocused()){t.focus();var e=document.selection.createRange();return e.moveStart("character",t.value?-t.value.length:0),e.text.length}return 0}},{key:"getCaretPositionFromRight",value:function(){return this.input.value.length-this.getCaretPosition()}},{key:"isFocused",value:function(){var t=this.input;return t===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(t.type||t.href||~t.tabIndex)}},{key:"setCaretPosition",value:function(t){this.caretPositionFromLeft=t;var e=this.input;this.$log;if(e&&0!==e.offsetWidth&&0!==e.offsetHeight)if(e.setSelectionRange)this.isFocused()&&(e.focus(),e.setSelectionRange(t,t));else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}}},{key:"setCaretPositionFromRight",value:function(t){this.caretPositionFromRight=angular.isDefined(t)?t:this.caretPositionFromRight,this.setCaretPosition(this.input.value.length-this.caretPositionFromRight)}},{key:"restoreCaretPosition",value:function(){this.setCaretPosition(this.caretPositionFromLeft)}},{key:"restoreCaretPositionFromRight",value:function(){this.caretPositionFromRight>this.input.value.length&&(this.caretPositionFromRight=this.input.value.length),this.setCaretPosition(this.input.value.length-this.caretPositionFromRight)}},{key:"getCountInvalidPositionsAfterCaret",value:function(t){var e=0;return this.getCaretMap().slice(angular.isDefined(t)?t:this.getCaretPosition()).every((function(t){return t||(e+=1),!t})),e}},{key:"getCountInvalidPositionsBeforeCaret",value:function(t){var e=0;return this.getCaretMap().slice(0,angular.isDefined(t)?t:this.getCaretPosition()).reverse().every((function(t){return t||(e+=1),!t})),e}},{key:"getCountInvalidPositionsToEnd",value:function(t){return this.getCaretMap().slice(angular.isDefined(t)?t:this.getCaretPosition()).reduce((function(t,e){return e?t:t+1}),0)}},{key:"getCountInvalidPositionsToStart",value:function(t){return this.getCaretMap().slice(0,angular.isDefined(t)?t:this.getCaretPosition()).reduce((function(t,e){return e?t:t+1}),0)}},{key:"getCountValidPositionsToEnd",value:function(t){return this.getCaretMap().slice(angular.isDefined(t)?t:this.getCaretPosition()).reduce((function(t,e){return e?t+1:t}),0)}},{key:"getCountValidPositionsToStart",value:function(t){return this.getCaretMap().slice(0,angular.isDefined(t)?t:this.getCaretPosition()).reduce((function(t,e){return e?t+1:t}),0)}},{key:"isDeleteKeyPress",value:function(t){return t.which===r.DELETE}},{key:"isBackspaceKeyPress",value:function(t){return t.which===r.BACK_SPACE}},{key:"isCharacterKeyPress",value:function(t){var e=[r.BACK_SPACE,r.PAGE_UP,r.PAGE_DOWN,r.END,r.HOME,r.ARROW_LEFT,r.ARROW_UP,r.ARROW_RIGHT,r.ARROW_DOWN,r.DELETE];return void 0===t.which||"number"==typeof t.which&&t.which>0&&!(t.ctrlKey||t.metaKey||t.altKey||-1!==e.indexOf(t.which))}},{key:"keyupHandler",value:function(t){var e=this.isDeleteKeyPress(t),n=this.isBackspaceKeyPress(t),i=this.isCharacterKeyPress(t);if(this.oldInputValue!==this.input.value){this.isLeftFormated?this.restoreCaretPosition():this.restoreCaretPositionFromRight();var a=this.caretPositionFromLeft+this.caretPositionCorrection,s=this.getCaretPositionFromRight()+this.caretPositionCorrection;n?a+=-(this.oldCountInvalidPositionsToStart-this.getCountInvalidPositionsToStart()-(this.caretPositionFromLeft-this.getCaretPosition())):e?a+=this.oldCountInvalidPositionsAfterCaret-this.getCountInvalidPositionsAfterCaret(a):(a+=this.getCountInvalidPositionsToStart(a)-this.oldCountInvalidPositionsToStart,a+=this.getCountInvalidPositionsAfterCaret(a)+1),this.caretPositionFromLeft!==a&&this.isLeftFormated?this.setCaretPosition(a):this.caretPositionFromRight===s||this.isLeftFormated||this.setCaretPositionFromRight(s)}else(e||n||i)&&this.isLeftFormated&&this.caretPositionFromLeft!==this.getCaretPosition()?this.restoreCaretPosition():(e||n||i)&&!this.isLeftFormated&&this.caretPositionFromRight!==this.getCaretPositionFromRight()&&this.restoreCaretPositionFromRight()}},{key:"keydownHandler",value:function(t){this.$log;var e=this.isDeleteKeyPress(t),n=this.isBackspaceKeyPress(t);this.caretPositionCorrection=0,this.oldInputValue=this.input.value,this.oldCountValidPositionsToEnd=this.getCountValidPositionsToEnd(),this.oldCountValidPositionsToStart=this.getCountValidPositionsToStart(),this.oldCountInvalidPositionsToEnd=this.getCountInvalidPositionsToEnd(),this.oldCountInvalidPositionsToStart=this.getCountInvalidPositionsToStart(),this.oldCountInvalidPositionsAfterCaret=this.getCountInvalidPositionsAfterCaret(),this.oldCountInvalidPositionsBeforeCaret=this.getCountInvalidPositionsBeforeCaret(),this.caretPositionFromRight=this.getCaretPositionFromRight(),this.caretPositionFromLeft=this.getCaretPosition(),n?(this.isLeftFormated&&(this.caretPositionCorrection-=1),this.oldCountInvalidPositionsBeforeCaret>0&&this.oldCountValidPositionsToStart>0?(this.setCaretPosition(this.caretPositionFromLeft-this.oldCountInvalidPositionsBeforeCaret),!this.isLeftFormated&&this.oldCountValidPositionsToEnd>0&&(this.caretPositionFromRight-=this.oldCountInvalidPositionsBeforeCaret),this.oldCountValidPositionsToEnd>0&&(this.caretPositionCorrection+=this.oldCountInvalidPositionsBeforeCaret)):1===this.oldCountInvalidPositionsAfterCaret&&1===this.oldCountValidPositionsToStart&&0===this.oldCountInvalidPositionsBeforeCaret&&(this.caretPositionFromRight-=1),this.oldCountInvalidPositionsBeforeCaret>0&&this.oldCountValidPositionsToStart):e&&(this.oldCountValidPositionsToEnd>0&&(this.oldCountInvalidPositionsAfterCaret&&(this.setCaretPosition(this.caretPositionFromLeft+this.oldCountInvalidPositionsAfterCaret),this.caretPositionFromLeft-=this.oldCountInvalidPositionsAfterCaret,this.caretPositionFromRight-=this.oldCountInvalidPositionsAfterCaret),this.isLeftFormated||0!==this.oldCountValidPositionsToStart||this.isValidCaretPosition(this.getCaretPosition()+1)||(this.caretPositionFromRight-=1),this.caretPositionFromRight-=1),0===this.caretPositionFromLeft&&(this.caretPositionFromRight+=1))}},{key:"inputValue",get:function(){return this.input.value}}]),t}();e.default=o},,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=h(n(1997)),a=h(n(2001)),s=h(n(2005)),r=h(n(2009)),o=h(n(2013)),c=h(n(2015)),l=h(n(2019)),u=h(n(2020)),d=h(n(2021));function h(t){return t&&t.__esModule?t:{default:t}}var f=angular.module("tangerine.chooseAccountsForm",[]).component("onboardingAccountTile",a.default).component("tngAccountTileRequirements",s.default).component("tpwRedirectModal",r.default).component("tngCallCenterModal",o.default).component("chooseAccountsForm",i.default).component("termLoanModal",c.default).constant("tpwConstants",u.default).constant("termLoanConstants",d.default).service("ChooseAccountsFormService",l.default);e.default=f,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(1998)),a=s(n(1999));function s(t){return t&&t.__esModule?t:{default:t}}n(2e3);var r={template:i.default,controller:a.default,bindings:{customer:"<",customerAccounts:"<",preselectedAccountPpt:"<?",preselectedAccountDealId:"<?",onEnableNext:"&",onLoaded:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<form class="c-choose-accounts-form container"> <section class="c-choose-accounts-form__upper-section" ng-if="!$ctrl.flowService.isLoading"> <h1 class="c-choose-accounts-form__greeting"> <span ng-if="$ctrl.userHasEligibleAccounts && !$ctrl.businessCifType"> {{ \'clientOnboarding.chooseAccountsForm.greeting\' | translate:{ firstName: $ctrl.customer.first_name } }} </span> <span ng-if="$ctrl.businessCifType"> {{ \'clientOnboarding.chooseAccountsForm.businessGreeting\' | translate:{ firstName: $ctrl.customer.first_name } }} </span> <span ng-if="!$ctrl.userHasEligibleAccounts && !$ctrl.areAccountsLoading"> {{ ::\'clientOnboarding.chooseAccountsForm.noEligibleAccountsTitle\' | translate }} </span> </h1> <p ng-if="$ctrl.businessCifType" translate> {{ ::\'clientOnboarding.chooseAccountsForm.openBussAccountContactInfo.message\'}} </p> <div id="accountLimitationKycPendingMsg" class="c-choose-accounts-form__warning panel margin__tb--fix2" ng-if="$ctrl.isKycPending && !$ctrl.businessCifType && $ctrl.userHasEligibleAccounts"> <strong ng-bind-html="\'clientOnboarding.chooseAccountsForm.accountLimitationKycPendingHeader\' | translate"></strong> <div ng-bind-html="\'clientOnboarding.chooseAccountsForm.accountLimitationKycPending\' | translate" class="c-choose-accounts-form__warning__text"></div> </div> <section class="c-choose-accounts-form__selected-account-list"> <h4 ng-show="$ctrl.customerAccounts.selectedAccounts.length">{{ \'clientOnboarding.chooseAccountsForm.accountsSelected\' | translate}}</h4> <div ng-if="$ctrl.showCompanionAdded" class="c-choose-accounts-form__companion-message"> <strong>{{:: \'clientOnboarding.basket.companionAdded\' | translate }}</strong> <p>{{ $ctrl.companionAddedMessageKey | translate }}</p> </div> <div ng-if="$ctrl.companionsRemoved.length > 0" class="c-choose-accounts-form__companion-message c-choose-accounts-form__companion-message--removed"> <strong>{{:: \'clientOnboarding.basket.companionRemoved\' | translate }}</strong> <p ng-repeat="r in $ctrl.companionsRemoved" ng-bind-html="$ctrl.getCompanionRemovedMessageKey(r) | translate"></p> </div> <onboarding-account-tile ng-repeat="account in $ctrl.customerAccounts.selectedAccounts | orderBy : \'product_description\'" is-selected="true" account="account" remove-account="$ctrl.removeFromSelectedAccounts(account)"> </onboarding-account-tile> <div ng-show="$ctrl.showBasketAddRemoveOverlay"> <div id="addRemoveBasketOverlay" class="c-choose-accounts-form__overlay"> </div> <div id="addRemoveBasketText" class="flex-container"> <div class="c-choose-accounts-form__text"> <span class="icon-complete2"></span> {{ $ctrl.overlayText | translate }} </div> </div> </div> </section> <div id="accountLimitationGenericMsg" class="c-choose-accounts-form__warning panel margin__tb--fix2" ng-if="$ctrl.userHasEligibleAccounts && !$ctrl.areAccountsLoading && $ctrl.showAccountLimitationGeneric && !$ctrl.businessCifType"> <span ng-bind-html="\'clientOnboarding.chooseAccountsForm.accountLimitationGeneric\' | translate"></span> </div> <div id="accountLimitationSpendingMsg" class="c-choose-accounts-form__warning panel margin__tb--fix2" ng-if="$ctrl.userHasEligibleAccounts && !$ctrl.areAccountsLoading && $ctrl.showAccountLimitationSpending"> <span ng-bind-html="\'clientOnboarding.chooseAccountsForm.accountLimitationSpending\' | translate"></span> </div> <div id="accountLimitationSavingMsg" class="c-choose-accounts-form__warning panel margin__tb--fix2" ng-if="$ctrl.userHasEligibleAccounts && !$ctrl.areAccountsLoading && $ctrl.showAccountLimitationSaving"> <span ng-bind-html="\'clientOnboarding.chooseAccountsForm.accountLimitationSaving\' | translate"></span> </div> <div id="accountLimitationProductMsg" class="c-choose-accounts-form__warning panel margin__tb--fix2" ng-if="$ctrl.userHasEligibleAccounts && !$ctrl.areAccountsLoading && $ctrl.showAccountLimitationProduct"> <span ng-bind-html="\'clientOnboarding.chooseAccountsForm.accountLimitationProduct\' | translate"></span> </div> <div id="accountLimitationCBKtoCBWMsg" class="c-choose-accounts-form__warning panel margin__tb--fix2" ng-if="$ctrl.userHasEligibleAccounts && !$ctrl.areAccountsLoading && $ctrl.showAccountLimitationCBKtoCBW"> <span ng-bind-html="\'clientOnboarding.chooseAccountsForm.accountLimitationCBKToCBW\' | translate"></span> </div> <div id="accountLimitationInvestingMsg" class="c-choose-accounts-form__warning panel margin__tb--fix2" ng-if="$ctrl.userHasEligibleAccounts && !$ctrl.areAccountsLoading && $ctrl.showAccountLimitationInvesting"> <span ng-bind-html="\'clientOnboarding.chooseAccountsForm.accountLimitationInvesting\' | translate"></span> </div> <div id="accountLimitationCSAMsg" class="c-choose-accounts-form__warning panel margin__tb--fix2" ng-if="!$ctrl.userHasEligibleAccounts && $ctrl.childCifType && !$ctrl.areAccountsLoading"> <span ng-bind-html="\'clientOnboarding.chooseAccountsForm.accountLimitationCSA\' | translate"></span> </div> <div class="c-choose-accounts-form__warning panel margin__tb--fix2" ng-if="$ctrl.eligibilityError && $ctrl.userHasEligibleAccounts && !$ctrl.areAccountsLoading"> <strong>{{ $ctrl.eligibilityError.title | translate }}</strong> <p> <span ng-bind-html="$ctrl.eligibilityError.message | translate"></span> </p> </div> <div class="margin__tb--fix2"> <div class="c-choose-accounts-form__warning panel" ng-if="!$ctrl.userHasEligibleAccounts && !$ctrl.childCifType && !$ctrl.areAccountsLoading && !$ctrl.foreignHomeAddress"> {{::\'clientOnboarding.chooseAccountsForm.noEligibleAccountsError\' | translate }} </div> <div id="foreignHomeAddressMsg" class="c-choose-accounts-form__warning panel" ng-if="!$ctrl.userHasEligibleAccounts && !$ctrl.childCifType && !$ctrl.areAccountsLoading && $ctrl.foreignHomeAddress"> <span ng-bind-html="\'clientOnboarding.chooseAccountsForm.noEligibleAccountsForeignAddress\' | translate"></span> </div> <span ng-show="$ctrl.registrationOrangeKey"> <div class="c-choose-accounts-form__warning panel" ng-if="$ctrl.userHasEligibleAccounts && $ctrl.displayOrangeKeyMessage &&\n            !($ctrl.showAccountLimitationGeneric || $ctrl.showAccountLimitationCategory || $ctrl.showAccountLimitationProduct || $ctrl.showAccountLimitationInvesting)"> {{::\'clientOnboarding.chooseAccountsForm.orangeKeyConfirmed\' | translate }} </div> </span> </div> <div ng-if="$ctrl.userHasEligibleAccounts && !$ctrl.businessCifType"> <h4 class="c-choose-accounts-form__add-accounts medium-width-section"> {{ \'clientOnboarding.chooseAccountsForm.heading\' | translate }} </h4> <div class="c-choose-accounts-form__filter-section grid__container"> <div class="styleguide-grid-unit grid__column--1of3 c-choose-accounts-form__filter-width"> <div class="field"> <tng-select-autocomplete input-id="{{::$ctrl.pageId}}_filterSelection" is-static="true" ng-model="$ctrl.selectedFilterGroup" on-select="$ctrl.selectAccountGroup(option.value)" options="$ctrl.filterGroupOptions" option-label-key="label" option-value-key="value"></tng-select-autocomplete> </div> </div> <div class="c-choose-accounts-form__search-section styleguide-grid-unit grid__column--1of3 c-choose-accounts-form__filter-width"> <div class="field"> <button class="field__icon icon-search c-choose-accounts-form__icon-search" actionable-id="{{::$ctrl.pageId}}_accountSearch_button"></button> <input actionable-id="{{::$ctrl.pageId}}_accountSearch" class="input" type="search" ng-model="$ctrl._searchText" ng-attr-placeholder="{{ \'clientOnboarding.chooseAccountsForm.accountSearch\' | translate }}"/> </div> </div> </div> <div class="margin__tb--fix2 medium" ng-if="$ctrl.filterGroup === $ctrl.ACCOUNT_GROUPS.SPECIAL_OFFERS"> {{ ::\'clientOnboarding.chooseAccountsForm.subheading2\' | translate }} </div> </div> </section> <tng-loading-in-progress ng-if="$ctrl.areAccountsLoading"></tng-loading-in-progress> <section class="c-choose-accounts-form__available-account-list"> <tng-error-message ng-if="$ctrl.errorMessage"> {{ $ctrl.errorMessage }} </tng-error-message> <div ng-if="!$ctrl.businessCifType"> <onboarding-account-tile actionable-id="availableAccount" ng-repeat="account in $ctrl.customerAccounts.availableAccounts | filter:$ctrl.filterRates($ctrl.filterGroup) | filter:{ product_description: $ctrl._searchText } | orderBy:\'product_description\'" add-account="$ctrl.addToSelectedAccounts(account)" tpw-redirect="$ctrl.tpwRedirect(account)" is-disabled="$ctrl.isAddCCDisabled(account) || $ctrl.isAddingAccount || ($ctrl.customerAccounts.selectedAccounts.length > 0 && $ctrl.flowService.isSingleProductEnrollment)" not-eligible="$ctrl.ineligibleAccounts.has(account)" account="account"> </onboarding-account-tile> </div> <div ng-if="$ctrl.businessCifType"> <onboarding-account-tile actionable-id="businessAvailableAccount" ng-repeat="account in $ctrl.customerAccounts.availableAccounts" add-account="$ctrl.addToSelectedAccounts(account)" tpw-redirect="$ctrl.tpwRedirect(account)" is-disabled="$ctrl.isAddingAccount || ($ctrl.customerAccounts.selectedAccounts.length > 0 && $ctrl.flowService.isSingleProductEnrollment)" not-eligible="$ctrl.ineligibleAccounts.has(account)" account="account"> </onboarding-account-tile> </div> <div class="medium" ng-if="$ctrl.isMobilePilot && !$ctrl.areAccountsLoading && $ctrl.customerAccounts.availableAccounts && !$ctrl.foreignHomeAddress"> <p>{{ ::\'clientOnboarding.basket.mobilePilotRoadblock\' | translate }}</p> </div> </section> </form> <tpw-redirect-modal ng-if="$ctrl.isRedirectDialogOpen" account="$ctrl.tpwAccount" on-modal-close="$ctrl.closeRedirectDialog()"></tpw-redirect-modal> <tng-call-center-modal ng-if="$ctrl.isCallCenterDialogOpen" account="$ctrl.callCenterAccount" on-modal-close="$ctrl.isCallCenterDialogOpen = false"></tng-call-center-modal> <tng-cc-enrollment-redirect-modal ng-if="$ctrl.isCCEnrollmentRedirectDialogOpen" on-modal-close="$ctrl.onCCEnrollmentRedirectDialogClose()"></tng-cc-enrollment-redirect-modal> <term-loan-modal ng-if="$ctrl.isTermLoanDialogOpen" account="$ctrl.termLoanAccount" on-modal-close="$ctrl.closeTermLoanDialog()"></term-loan-modal> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=v(n(15)),a=v(n(39)),s=v(n(68)),r=v(n(58)),o=v(n(8)),c=v(n(269)),l=v(n(0)),u=v(n(2)),d=v(n(1807)),h=v(n(369)),f=v(n(529)),p=v(n(271)),g=v(n(116)),m=v(n(541)),_=v(n(535));function v(t){return t&&t.__esModule?t:{default:t}}var S=function(){function t(e,n,i,a,s,r,u,d,h,f,p,g,m,_,v,S,T,y,E,A,b,C,$,N,O,I,w,P,M,R,D){(0,l.default)(this,t),this.$stateParams=e,this.$location=n,this.$log=i,this.$q=a,this.$timeout=s,this.UrlService=_,this.AccountSummaryService=r,this.ChooseAccountsFormService=u,this.flowService=d,this.accountConstants=h,this.ACCOUNT_GROUPS=h.ACCOUNT_GROUPS,this.ACCOUNT_PPTS=h.ACCOUNT_PPTS,this.ACCOUNT_GROUPS_WITH_LIMITED_NUMBER_OF_CODES=h.ACCOUNT_GROUPS_WITH_LIMITED_NUMBER_OF_CODES,this.InsightsService=f,this.AnalyticsService=g,this.TlocService=E,this.UserConstants=I,this.isTSFASeasonOn=!1,this.InsightsInteractionPoint=p.INTERACTION_POINTS.BASKET,this.ANALYTICS_AVAILABLE_EVENTS=g.availableEvents,this.$translate=m,this.serviceConstants=v,this.locale=S.locale,this.LocaleService=S,this.$window=T,this.SessionService=y,this.KYCPendingService=b,this.RspLoanConstants=C,this.CustomerInfoService=$,this.UserSettingsConstants=N,this.CustomersService=O,this.ResumeApplicationService=w,this.RequesterService=P,this.EnvironmentService=A,this.stateConstants=M,this.$state=R,this.AccountDetailsService=D,this.insights=[],this.showCompanionAdded=!1,this.companionsRemoved=[],this.isLoading=!1,this.pageId="clientOnboardingChooseAccountsForm",this.ineligibleAccounts=new c.default([]),this.isMobilePilot=A.isNative(),this.existingAccounts=[],this.filterGroup=null,this.spendingGroup=[this.ACCOUNT_GROUPS.CHEQUING,this.ACCOUNT_GROUPS.SPENDING],this.savingsGroup=[this.ACCOUNT_GROUPS.SAVINGS,this.ACCOUNT_GROUPS.GIC],this.borrowingGroup=[this.ACCOUNT_GROUPS.BORROWING,this.ACCOUNT_GROUPS.MORTGAGE],this.filterGroupOptions=[{value:"all",label:"clientOnboarding.chooseAccountsForm.accountFilters.all"},{value:this.ACCOUNT_GROUPS.SPENDING,label:"clientOnboarding.chooseAccountsForm.accountFilters.spending"},{value:this.ACCOUNT_GROUPS.SAVINGS,label:"clientOnboarding.chooseAccountsForm.accountFilters.saving"},{value:this.ACCOUNT_GROUPS.INVESTING,label:"clientOnboarding.chooseAccountsForm.accountFilters.investing"},{value:this.ACCOUNT_GROUPS.BORROWING,label:"clientOnboarding.chooseAccountsForm.accountFilters.borrowing"},{value:this.ACCOUNT_GROUPS.SPECIAL_OFFERS,label:"clientOnboarding.chooseAccountsForm.accountFilters.specialOffers"}].map((function(t){return(0,o.default)(t,{label:m.instant(t.label)})})),this.selectedFilterGroup=this.filterGroupOptions[0].value,this.tpwAccount=null,this.isRedirectDialogOpen=!1,this.isTermLoanDialogOpen=!1,this.callCenterAccount=null,this.isCallCenterDialogOpen=!1,this.areAccountsLoading=!1,this.isAddingAccount=!1,this.errorMessage=null,this.registrationOrangeKey=null,this.foreignHomeAddress=!1,this.isNative=A.isNative(),this.showBasketAddRemoveOverlay=!1,this.isPersonalInsight=!1,this.CREDIT_CARD_PRODUCTS=[this.accountConstants.CREDIT_CARD_PRODUCT_TYPES_CODE.CBW,this.accountConstants.CREDIT_CARD_PRODUCT_TYPES_CODE.CBK]}return(0,u.default)(t,[{key:"$onInit",value:function(){this.$location.search().category&&this.$location.search().personalInsight&&(this.isPersonalInsight=!0),this._loadAccounts(),this._loadCustomerInfo(),this._loadCapabilities(),this.flowService.hideAccountLimitationMessages&&this._clearAccountLimitationMessages(),this.flowService.isBusiness||(this.$stateParams.addAccount?this._setAccountFilterSelection(this.$stateParams.addAccount):this.$location.search().category&&this._setAccountFilterSelection(this.$location.search().category)),this.registrationOrangeKey=this.SessionService.getSession().enrolledWithOrangeKey,this.onLoaded({onSubmit:this._orderAccounts.bind(this)}),this.flowService.selectedAccounts=this.customerAccounts.selectedAccounts}},{key:"_clearAccountLimitationMessages",value:function(){this.showAccountLimitationGeneric=!1,this.showAccountLimitationProduct=!1,this.showAccountLimitationSpending=!1,this.showAccountLimitationSaving=!1,this.showAccountLimitationInvesting=!1,this.showAccountLimitationCBKtoCBW=!1}},{key:"_checkAccountLimitations",value:function(){this._clearAccountLimitationMessages();var t=this.customerAccounts.availableAccounts.map((function(t){return t.profile_product_type})),e=this._getAccountCodesWithLimitation();if(this.filterGroup){if(e){var n=this._shouldShowLimitationMessage(e,t);this.filterGroup===this.ACCOUNT_GROUPS.SPENDING?this.showAccountLimitationSpending=n:this.filterGroup===this.ACCOUNT_GROUPS.SAVINGS?this.showAccountLimitationSaving=n:this.filterGroup===this.ACCOUNT_GROUPS.INVESTING&&(this.showAccountLimitationInvesting=n)}}else this.showAccountLimitationGeneric=this._shouldShowLimitationMessage(e,t)}},{key:"_shouldShowLimitationMessage",value:function(t,e){return!(!t||0===t.length)&&(!e||0===e.length||t.some((function(t){return!(-1!==e.indexOf(t))})))}},{key:"_getAccountCodesWithLimitation",value:function(){var t=this,e=void 0;return e=this.filterGroup?this.ACCOUNT_GROUPS_WITH_LIMITED_NUMBER_OF_CODES[this.filterGroup]||[]:(0,_.default)((0,m.default)(this.ACCOUNT_GROUPS_WITH_LIMITED_NUMBER_OF_CODES,(function(t){return t})))||[],this.isTSFASeasonOn?e:e.filter((function(e){return e!==t.accountConstants.ACCOUNT_PPTS.TFSAKS}))}},{key:"hasTFSAKickStartAccount",value:function(){var t=this;return this.customerAccounts.availableAccounts.some((function(e){return e.profile_product_type===t.accountConstants.ACCOUNT_PPTS.TFSAKS}))}},{key:"selectAccountGroup",value:function(t){this.filterGroup=t===this.filterGroupOptions[0].value?"":t,this._checkAccountLimitations()}},{key:"$onChanges",value:function(t){t.preselectedAccountPpt&&t.preselectedAccountPpt.currentValue&&this._preselectedAccountsAdded&&this._checkForPreselectedAccounts(!1)}},{key:"_mapInsights",value:function(){var t=this;if(this.hasSpecialOffer=!1,!this.isPersonalInsight&&this.insights.length&&this.customerAccounts.availableAccounts.length){var e=!0,n=!1,i=void 0;try{for(var a,s=function(){var e=a.value,n=t.insights.filter((function(t){return e.profile_product_type===t.ic_basketProducts}));n.length&&(t.hasSpecialOffer=!0,e.specialOffer=n[0])},o=(0,r.default)(this.customerAccounts.availableAccounts);!(e=(a=o.next()).done);e=!0)s()}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}this.hasSpecialOffer&&this._isOverrideFilterRequired()&&!this._isQueryParamOverride()&&this._setSpecialOffersFilterSelected()}}},{key:"_setSpecialOffersFilterSelected",value:function(){this.selectedFilterGroup=this.ACCOUNT_GROUPS.SPECIAL_OFFERS,this.selectAccountGroup(this.ACCOUNT_GROUPS.SPECIAL_OFFERS)}},{key:"onDependenciesLoaded",value:function(){this.nextEnabled(),this._checkForPreselectedAccounts()}},{key:"_clearCompanionMessages",value:function(){this.showCompanionAdded=!1,this.companionsRemoved=[]}},{key:"getCompanionRemovedMessageKey",value:function(t){return"clientOnboarding.basket.removed."+this._getCompanionRootProductSubPath(t.rootProduct)+"."+t.companionProductPPT}},{key:"_getCompanionRootProductSubPath",value:function(t){var e=null;return t.isRspLoanPostApproval?e=this.RspLoanConstants.FLOW_TYPES.POST_APPROVAL.localeCode:t.isRspLoanPreApproval&&(e=this.RspLoanConstants.FLOW_TYPES.PRE_APPROVAL.localeCode),t.profile_product_type+(e?"."+e:"")}},{key:"tpwRedirect",value:function(t){return this.tpwAccount=t,this.isRedirectDialogOpen=!0,this.$q.when()}},{key:"openTermLoanDialog",value:function(){this.isTermLoanDialogOpen=!0}},{key:"addToSelectedAccounts",value:function(t,e){var n=this;if(this._clearCompanionMessages(),this.eligibilityError=null,this._isMortgageRateSpecial(t.specialOffer)&&this._createRateHold(t.specialOffer.hash_code),t.redirectToTPW)return this.ResumeApplicationService.hasPendingApplications(t)&&!this._isMortgageRateSpecial(t.specialOffer)?this.ResumeApplicationService.showPendingApplicationsModal(t):(this.tpwAccount=t,this.isRedirectDialogOpen=!0,this.$q.when());if(t.isTermLoan)return this.isTermLoanDialogOpen=!0,this.termLoanAccount=t,this.$q.when();if(this._accountRequiresRedirectToCallCenter(t))return this.callCenterAccount=t,this.isCallCenterDialogOpen=!0,this.$q.when();if(this.isKycPending&&t.isRspLoan&&t.rspLoanPalDealId)return this.ineligibleAccounts.add(t),this.showAccountLimitationProduct=e,this.$q.when();if(t.isCreditCard&&null!=this.ccNativeMobileEnrollmentFlag&&!1===this.ccNativeMobileEnrollmentFlag){var i=this.$translate.instant("clientOnboarding.ccEnrollmentRedirectModal.linkUrl");return this.$window.open(this.UrlService.fixRelativeLink(i),this.EnvironmentService.isNative()?"_system":"_blank"),this.$q.when()}return this.isAddingAccount=!0,this._showAddRemoveToBasketOverlay("account.overview.addRemoveToBasketOverlay.ADDED"),e&&this.flowService.enterLoadingMode(),this.ChooseAccountsFormService.getCustomerEligibilityForAccount(t).then((function(i){if(i.isEligible){n.flowService.isSingleProductEnrollment=i.is_single_product_enrollment;var a=i.is_single_product_enrollment;if(i.companion_products&&!a&&(0,o.default)(t,{companion_products:i.companion_products}),n.customerAccounts.selectedAccounts.push(t),n._removeFromAvailableAccounts(t),n.AnalyticsService.sendAction(n.ANALYTICS_AVAILABLE_EVENTS.BASKET_ADD_TO_CART,"",{products:[{id:t.profile_product_type,name:t.product_description}]}),i.companion_products&&!a){var s=[],c=n.customerAccounts.availableAccounts,l=!0,u=!1,d=void 0;try{for(var h,f=function(){var e=h.value,i=c.filter((function(t){return t.profile_product_type===e}))[0];i&&n._areCompanionRulesBroken(t)?(i.autoAdded=!0,n.customerAccounts.selectedAccounts.push(i),n._removeFromAvailableAccounts(i),s.push(e),n.showCompanionAdded=!0):n.$log.debug("companion product was not in availableAccounts",e)},p=(0,r.default)(i.companion_products);!(l=(h=p.next()).done);l=!0)f()}catch(t){u=!0,d=t}finally{try{!l&&p.return&&p.return()}finally{if(u)throw d}}n.companionProductPPTs=s.sort().join("_"),n.companionProductRootProduct=t,n.showCompanionAdded&&!e&&n.flowService.AnchorService.scrollToPageContentTop()}n.flowService.selectedAccounts=n.customerAccounts.selectedAccounts,n.nextEnabled()}else angular.extend(t,{statusCode:i.response_status.status_code}),n.ineligibleAccounts.add(t),n.showAccountLimitationProduct=e,n.eligibilityError=i.eligibilityError,n.eligibilityError&&!e&&n.flowService.AnchorService.scrollToPageContentTop()})).finally((function(){n.isAddingAccount=!1,n.flowService.selectedAccounts.length&&n.flowService.showWarning(),e&&n.flowService.exitLoadingMode()}))}},{key:"retrieveAppCCEnrollmentConfigurationData",value:function(){var t={urlVars:{os:this._getOS(),version:this.$window.AppVersion}};return this.isNative?this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_APP_CC_ENROLLMENT,t):this.$q.when({})}},{key:"_getOS",value:function(){return this.EnvironmentService.isIOS()?"iOS":this.EnvironmentService.isAndroid()?"Android":""}},{key:"_isMortgageRateSpecial",value:function(t){return t&&t.ic_basketProducts&&"7000"===t.ic_basketProducts&&t.hash_code}},{key:"_createRateHold",value:function(t){var e={data:{rate_holds:{token:t}}};this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.REQUEST_RATE_HOLD,e)}},{key:"removeFromSelectedAccounts",value:function(t){var e=this;this._clearCompanionMessages(),this._showAddRemoveToBasketOverlay("account.overview.addRemoveToBasketOverlay.REMOVED"),angular.equals(t,this.customerAccounts.accountCurrentlyInSetupFlow)&&(this.customerAccounts.accountCurrentlyInSetupFlow=null),this.customerAccounts.selectedAccounts.some((function(n,i){return!!angular.equals(n,t)&&(e.customerAccounts.selectedAccounts.splice(i,1),!0)})),t.autoAdded=!1,this.customerAccounts.availableAccounts.push(t),this.AnalyticsService.sendAction(this.ANALYTICS_AVAILABLE_EVENTS.BASKET_REMOVE_FROM_CART,"",{products:[{id:t.profile_product_type,name:t.product_description}]});var n,i=this._getBrokenProducts(this.customerAccounts.selectedAccounts);i.length>0&&(this.customerAccounts.selectedAccounts=this.customerAccounts.selectedAccounts.filter((function(t){return!i.some((function(e){return e.profile_product_type===t.profile_product_type}))})),(n=this.customerAccounts.availableAccounts).push.apply(n,(0,s.default)(i)),this.companionsRemoved=i.map((function(e){return(0,o.default)({},{companionProductPPT:t.profile_product_type,rootPPT:e.profile_product_type,rootProduct:e})})),this.flowService.AnchorService.scrollToPageContentTop());this.customerAccounts.selectedAccounts.forEach((function(t){if(t.autoAdded){var n=e.customerAccounts.selectedAccounts.filter((function(e){return e.profile_product_type!==t.profile_product_type}));0===e._getBrokenProducts(n).length&&(t.autoAdded=!1,e.customerAccounts.selectedAccounts=n,e.customerAccounts.availableAccounts.push(t))}})),this.flowService.selectedAccounts=this.customerAccounts.selectedAccounts,this.flowService.selectedAccounts.length||this.flowService.hideWarning(),this.nextEnabled()}},{key:"_areCompanionRulesBroken",value:function(t,e){var n=this.accountConstants.INTERCHANGEABLE_COMPANION_PRODUCTS;e||(e=this.customerAccounts.selectedAccounts);var s=n[t.profile_product_type];if(!t.companion_products)return!1;var o=!0,c=!1,l=void 0;try{for(var u,d=function(){var t=u.value;if(!e.some((function(e){return e.profile_product_type===t}))){var n=!1;if(s){var a=!0,o=!1,c=void 0;try{for(var l,d=function(){var i=l.value;if(s[i].indexOf(t)>-1&&(n=e.some((function(t){return s[i].indexOf(t.profile_product_type)>-1}))))return"break"},h=(0,r.default)((0,i.default)(s));!(a=(l=h.next()).done);a=!0){if("break"===d())break}}catch(t){o=!0,c=t}finally{try{!a&&h.return&&h.return()}finally{if(o)throw c}}}if(!n)return{v:!0}}},h=(0,r.default)(t.companion_products);!(o=(u=h.next()).done);o=!0){var f=d();if("object"===(void 0===f?"undefined":(0,a.default)(f)))return f.v}}catch(t){c=!0,l=t}finally{try{!o&&h.return&&h.return()}finally{if(c)throw l}}return!1}},{key:"_getBrokenProducts",value:function(t){var e=this,n=[];return t.forEach((function(i){e._areCompanionRulesBroken(i,t)&&n.push(i)})),n}},{key:"nextEnabled",value:function(){var t=!!this.customerAccounts.selectedAccounts.length;this.onEnableNext({enable:t})}},{key:"_checkForPreselectedAccounts",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!e||!this._preselectedAccountsAdded){this._preselectedAccountsAdded=!0;var n=[];this.preselectedAccountPpt&&n.push(this.preselectedAccountPpt);var i=this.$location.search().products;i&&i.split(",").forEach((function(t){n.push(t)})),this.isKycPending&&n.length>1&&n.splice(1),n.forEach((function(e){var n=t.customerAccounts.availableAccounts.find((function(t){return t.profile_product_type===e}));if(n){if(n.redirectToTPW)return;n.pre_selected=!0,t.addToSelectedAccounts(n,!0),t.preselectedAccountDealId&&e===t.accountConstants.ACCOUNT_PPTS.RSP_LOAN&&(n.rspLoanPalDealId=t.preselectedAccountDealId)}else{var i=t.customerAccounts.selectedAccounts.find((function(t){return t.profile_product_type===e}));i||-1===t.ACCOUNT_GROUPS_WITH_LIMITED_NUMBER_OF_CODES[t.ACCOUNT_GROUPS.INVESTING].indexOf(t.$stateParams.products)?i||(t.accountConstants.CREDIT_CARD_PRODUCT_TYPES_CODE.CBW===e?(t.showAccountLimitationCBKtoCBW=!0,t.showAccountLimitationProduct=!1,t.showAccountLimitationInvesting=!1):(t.showAccountLimitationProduct=!0,t.showAccountLimitationInvesting=!1)):(t.showAccountLimitationInvesting=!0,t.showAccountLimitationProduct=!1),t.showAccountLimitationGeneric=!1,t.showAccountLimitationSpending=!1,t.showAccountLimitationSaving=!1}})),n.length||this._checkAccountLimitations()}}},{key:"_setAccountFilterSelection",value:function(t){"object"===(void 0===t?"undefined":(0,a.default)(t))||this.flowService.isBusinessClient||(t=t.toLowerCase()),this.filterGroupOptions.filter((function(e){return e.value===t})).length>0&&(this.filterGroup=t,this.selectedFilterGroup=t)}},{key:"_removeFromAvailableAccounts",value:function(t){var e=this.customerAccounts.availableAccounts.findIndex((function(e){return e===t}));-1!==e&&this.customerAccounts.availableAccounts.splice(e,1)}},{key:"_orderAccounts",value:function(){var t=this;return this.ChooseAccountsFormService.orderAccounts(this.customerAccounts.selectedAccounts).then((function(e){var n=e.products,i=e.is_sin_required;n&&t.customerAccounts.selectedAccounts.sort((function(t,e){var i=n.find((function(e){return e.profile_product_type===t.profile_product_type})),a=n.find((function(t){return t.profile_product_type===e.profile_product_type}));return i&&a?i.position-a.position:0}));return i}))}},{key:"closeRedirectDialog",value:function(){this.tpwAccount=null,this.isRedirectDialogOpen=!1}},{key:"closeTermLoanDialog",value:function(){this.isTermLoanDialogOpen=!1}},{key:"_loadAccounts",value:function(){var t=this;return this.customerAccounts.availableAccounts?this.$q.resolve(this.onDependenciesLoaded()):(this.flowService.enterLoadingMode(!0),this.areAccountsLoading=!0,this.cbkDetailsLoaded=!0,this.$q.all([this.ChooseAccountsFormService.getAvailableAccounts({isBusiness:this.flowService.isBusinessClient}),this.AccountSummaryService.getAccounts().catch((function(){return{accounts:[]}})),this.InsightsService.getInsights({interactionPoint:this.InsightsInteractionPoint,count:100}).catch((function(){return{insights:[]}})),this.KYCPendingService.isKycPending().then((function(e){t.isKycPending=e})).catch((function(){t.isKycPending=!1})),this.retrieveAppCCEnrollmentConfigurationData().then((function(e){t.ccNativeMobileEnrollmentFlag=e&&e.status})).catch((function(e){t.$log.error(e)}))]).then((function(e){t.flowService.isBusinessClient?t.customerAccounts.availableAccounts=t.businessAccounts(e[0]):t.customerAccounts.availableAccounts=e[0],t.existingAccounts=e[1].accounts,t.AccountSummaryService.allAccounts=e[1].accounts;var n=t.existingAccounts?t.existingAccounts.filter((function(e){return e.product_code===t.accountConstants.CREDIT_CARD_PRODUCT_TYPES_CODE.CBK})):[];t.$location.search().products===t.accountConstants.CREDIT_CARD_PRODUCT_TYPES_CODE.CBW&&n.length&&(t.cbkDetailsLoaded=!1,t.$q.all(n.map((function(e){return t.AccountDetailsService.getAccountDetails(e.number,t.accountConstants.ACCOUNT_TYPES.CREDIT_CARD)}))).then((function(e){e.forEach((function(e){(0,g.default)(e,"account_summary.credit_card.cc_account_details.is_primary_account")&&(0,g.default)(e,"account_summary.credit_card.cc_account_details.card_details.activated")&&(0,g.default)(e,"account_summary.credit_card.cc_account_details.card_details.product_conversion_allowed")&&t.$state.go(t.stateConstants.CREDIT_CARD_CONVERSION_MODAL)}))})).finally((function(){t.cbkDetailsLoaded=!0,t.areAccountsLoading||t.flowService.exitLoadingMode()}))),t.customerAccounts.availableAccountsCopy=angular.copy(t.customerAccounts.availableAccounts),t.flowService.stateData.customerAccounts.accountCurrentlyInSetupFlow||(t.flowService.stateData.noEligibleProducts=!t.customerAccounts.availableAccounts.length),t.flowService.stateData.noActiveAccounts=!e[1].accounts.length,t.insights=e[2]?e[2].insights:[],t._mapInsights(),t._setKycPendingDefaultFilter(),t.onDependenciesLoaded(),t._setforeignHomeAddressFlag()})).catch((function(e){t.serviceConstants.RESPONSE_ERRORS.ERROR_MESSAGE in e?t.errorMessage=e.errorMessage:e.response_status&&e.response_status.technical_description?t.errorMessage=e.response_status.technical_description:e.response_status&&e.response_status.status_code?t.errorMessage=t.$translate.instant("global.errorCodes."+e.response_status.status_code):t.errorMessage=t.$translate.instant("global.errorCodes.generic")})).finally((function(){t.cbkDetailsLoaded&&t.flowService.exitLoadingMode(),t.areAccountsLoading=!1})))}},{key:"_isOverrideFilterRequired",value:function(){return!(0,p.default)(this.$location.$$search)}},{key:"_isQueryParamOverride",value:function(){return!!this.$location.search().override}},{key:"_loadCustomerInfo",value:function(){var t=this;this.customer?this._setforeignHomeAddressFlag():this.CustomerInfoService.get().then((function(e){t.customer=e.customer,t._setforeignHomeAddressFlag()}))}},{key:"_loadCapabilities",value:function(){var t=this;this.CustomersService.getCapabilities().then((function(e){e.capabilities&&-1!==e.capabilities.indexOf(t.UserSettingsConstants.CIF_TYPES.CHILD.CAPABILITY)&&(t.childCifType=!0),e.capabilities&&-1!==e.capabilities.indexOf(t.UserConstants.USER.CAPABILITIES.PRE_TFS_ENROLL)?t.isTSFASeasonOn=!0:t.isTSFASeasonOn=!1,t.businessCifType=t.flowService.isBusinessClient}))}},{key:"_setforeignHomeAddressFlag",value:function(){var t=this.customer&&this.customer.address_list?this.customer.address_list.find((function(t){return"HOME"===t.address_type})):null;t&&"CA"!==t.country?this.foreignHomeAddress=!0:this.foreignHomeAddress=!1}},{key:"_setKycPendingDefaultFilter",value:function(){this.isKycPending&&this.hasSpecialOffer&&!this.isPersonalInsight&&(this.selectedFilterGroup=this.ACCOUNT_GROUPS.SPECIAL_OFFERS,this.selectAccountGroup(this.ACCOUNT_GROUPS.SPECIAL_OFFERS))}},{key:"filterRates",value:function(t){var e=this;return t?function(n){var i=n.group.toLowerCase();switch(t){case e.ACCOUNT_GROUPS.SPENDING:return-1!==e.spendingGroup.indexOf(i);case e.ACCOUNT_GROUPS.SAVINGS:return-1!==e.savingsGroup.indexOf(i);case e.ACCOUNT_GROUPS.BORROWING:return-1!==e.borrowingGroup.indexOf(i);case e.ACCOUNT_GROUPS.SPECIAL_OFFERS:return e.isKycPending?!!n.specialOffer||"4000"===n.profile_product_type:!!n.specialOffer;default:return t===i}}:function(){return!0}}},{key:"businessAccounts",value:function(t){var e=[],n=this.sortByHighestInterestRate((0,f.default)(t,{profile_product_type:this.accountConstants.ACCOUNT_PPTS.BUSINESS_SAVINGS})),i=this.sortByHighestInterestRate((0,f.default)(t,{profile_product_type:this.accountConstants.ACCOUNT_PPTS.BUSINESS_US_SAVINGS})),a=this.sortByHighestInterestRate((0,f.default)(t,{profile_product_type:this.accountConstants.ACCOUNT_PPTS.BUSINESS_GIC})),s=this.sortByHighestInterestRate((0,f.default)(t,{profile_product_type:this.accountConstants.ACCOUNT_PPTS.BUSINESS_GIC_USD}));return e.push(n,i,a,s),e}},{key:"sortByHighestInterestRate",value:function(t){return t.length>1&&(0,h.default)(t,(function(t){t.isMaxInterestRate=!0})),(0,d.default)(t,"interest_rate")}},{key:"_accountRequiresRedirectToCallCenter",value:function(t){return-1!==[this.ACCOUNT_PPTS.MUTUAL_FUND_RIF].indexOf(t.profile_product_type)}},{key:"_showAddRemoveToBasketOverlay",value:function(t){var e=this;this.showBasketAddRemoveOverlay=!0,this.overlayText=t,this.$timeout((function(){e._hideAddRemoveToBasketOverlay()}),800)}},{key:"_hideAddRemoveToBasketOverlay",value:function(){this.showBasketAddRemoveOverlay=!1}},{key:"isAddCCDisabled",value:function(t){var e=this;return-1!==this.CREDIT_CARD_PRODUCTS.indexOf(t.profile_product_type)&&this.customerAccounts.selectedAccounts.find((function(t){return-1!==e.CREDIT_CARD_PRODUCTS.indexOf(t.profile_product_type)}))}},{key:"companionAddedMessageKey",get:function(){return"clientOnboarding.basket.added."+this._getCompanionRootProductSubPath(this.companionProductRootProduct)+"."+this.companionProductPPTs}},{key:"displayOrangeKeyMessage",get:function(){var t=this;return this.flowService.stateData.noActiveAccounts&&angular.isArray(this.customerAccounts.selectedAccounts)&&0===this.customerAccounts.selectedAccounts.filter((function(e){return e.group===t.ACCOUNT_GROUPS.SAVINGS})).length}},{key:"userHasEligibleAccounts",get:function(){return this.businessCifType||this.customerAccounts.availableAccounts&&!!this.customerAccounts.availableAccounts.length}}]),t}();S.$inject=["$stateParams","$location","$log","$q","$timeout","AccountSummaryService","ChooseAccountsFormService","ExistingClientOnboardingFlowService","accountConstants","InsightsService","InsightsConstants","AnalyticsService","$translate","UrlService","serviceConstants","LocaleService","$window","SessionService","TlocService","EnvironmentService","KYCPendingService","RspLoanConstants","CustomerInfoService","UserSettingsConstants","CustomersService","userConstants","ResumeApplicationService","RequesterService","stateConstants","$state","AccountDetailsService"],e.default=S,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2002)),a=s(n(2003));function s(t){return t&&t.__esModule?t:{default:t}}n(2004);var r={template:i.default,controller:a.default,bindings:{account:"<",isDisabled:"<",isSelected:"<",notEligible:"<",addAccount:"&",removeAccount:"&",addAccountString:"@",tpwRedirect:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-basket-account-tile"> <tng-modal-dialog ng-if="$ctrl.isModalOpen" on-close="$ctrl.isModalOpen = false" analytics-id="choose-accounts-tile"> <div ng-switch="$ctrl.showLearnMore"> <div ng-switch-when="true"> <tloc-learn-more></tloc-learn-more> </div> <div ng-switch-default> <header>{{ $ctrl.account.product_description }}</header> </div> </div> <footer> <button class="btn btn--orange" ng-click="$ctrl.isModalOpen = false" actionable-id="accountTile_detailsModal_close">{{ \'global.pageFlow.buttons.done\' | translate }} </button> </footer> </tng-modal-dialog> <tng-modal-dialog ng-if="$ctrl.isBusinessEnrollModalOpen" on-close="$ctrl.openBusinessEnrollModal(false)" analytics-id="choose-business-accounts-tile" class="c-business-openAccount-modal"> <header>{{ \'clientOnboarding.chooseAccountsForm.businessOpenAccountModal.modalTitle\' | translate }}</header> <div class="grid__container"> <div class="grid__column--4of4"> <div class="c-business-openAccount-modal__content"> <p>{{ \'clientOnboarding.chooseAccountsForm.businessOpenAccountModal.modalBody01\' | translate }}</p> <p translate>{{ ::\'clientOnboarding.chooseAccountsForm.businessOpenAccountModal.modalBody02\'}}</p> </div> </div> </div> <footer> <button class="btn btn--orange" ng-click="$ctrl.openBusinessEnrollModal(false)" actionable-id="accountTile_detailsModal_close">{{ \'global.pageFlow.buttons.done\' | translate }} </button> </footer> </tng-modal-dialog> <div class="c-basket-account-tile__main"> <h4 class="medium" ng-bind-html=" ::$ctrl.account.product_description | translate"></h4> <p class="small" ng-show="!$ctrl.notEligible" ng-bind-html="$ctrl.account.details | translate"></p> <tng-account-tile-requirements ng-if="!$ctrl.account.isBusinessAccount" account="$ctrl.account"></tng-account-tile-requirements> <div class="grid__container c-basket-account-tile__main__footer" style="margin-top:1.25rem"> <div class="c-basket-account-tile__main__interest styleguide-grid-unit grid__column--1of2"> <div class="small" ng-show="::$ctrl.showSubheader()"> <strong>{{::$ctrl.subheaderKey()| translate }}</strong> </div> <div class="c-basket-account-tile__main__interest-percentage"> <strong ng-if="$ctrl.account.interest_rate" ng-show="::$ctrl.showInterestRate()"> <span ng-bind-html="$ctrl.account.interest_rate | numberPercentage: 2"></span> <span class="star" ng-if="$ctrl.isTloc">*</span> <span class="medium" ng-if="$ctrl.isPal"> {{:: \'clientOnboarding.chooseAccountsForm.preApprovedInterest\' | translate }} </span> </strong> </div> </div> <div class="c-basket-account-tile__main__footer__buttons styleguide-grid-unit grid__column--1of2"> <div class="medium" ng-show="$ctrl.isTloc">&nbsp;</div> <div class="btn__row"> <button ng-if="$ctrl.account.isBusinessAccount" ng-click="$ctrl.openBusinessEnrollModal(true)" actionable-id="accountTile_enrollBusinessAccount" class="btn"> <span>{{:: \'clientOnboarding.chooseAccountsForm.add\' | translate }}</span> </button> <button ng-if="!$ctrl.isSelected && !$ctrl.account.isBusinessAccount && !$ctrl.account.isTermLoan" ng-click="$ctrl.tryAddAccount()" ng-disabled="($ctrl.isDisabled && !$ctrl.account.redirectToTPW) || $ctrl.isAdding" actionable-id="accountTile_addAccount" class="btn"> <span ng-if="$ctrl.account.redirectToTPW">{{:: \'clientOnboarding.chooseAccountsForm.enroll\' | translate }}</span> <span ng-if="!$ctrl.addAccountString && !$ctrl.account.redirectToTPW">{{:: \'clientOnboarding.chooseAccountsForm.add\' | translate }}</span> <span ng-if="$ctrl.addAccountString && !$ctrl.account.redirectToTPW">{{:: $ctrl.addAccountString }}</span> </button> <button ng-if="$ctrl.account.isTermLoan" ng-click="$ctrl.tryAddAccount()" actionable-id="accountTile_termLoanAccount" class="btn"> <span>{{:: \'clientOnboarding.chooseAccountsForm.apply\' | translate }}</span> </button> <button ng-if="$ctrl.isSelected" ng-click="$ctrl.removeAccount()" actionable-id="accountTile_removeAccount" class="btn"> {{:: \'clientOnboarding.chooseAccountsForm.remove\' | translate }} </button> <button ng-click="$ctrl.isModalOpen = true" ng-if="$ctrl.showLearnMore" actionable-id="accountTile_learnMore" class="btn btn--edit"> {{:: \'clientOnboarding.chooseAccountsForm.learnMore\' | translate }} </button> <button ng-click="$ctrl.openNewTab()" ng-if="$ctrl.isIncluded && !$ctrl.showLearnMore" actionable-id="accountTile_learnMore" class="btn btn--edit"> {{:: \'clientOnboarding.chooseAccountsForm.learnMore\' | translate }} </button> </div> </div> </div> <div class="spread" ng-show="$ctrl.isTloc"> <p ng-if="!$ctrl.account.isTlocApplication" class="loc_prime_rate">{{:: \'clientOnboarding.chooseAccountsForm.spreadMessage\' | translate : { spread: $ctrl.account.tlocOffer.offerDetails.spread} }}</p> <p ng-if="$ctrl.account.isTlocApplication" class="fine-print"> {{:: \'clientOnboarding.chooseAccountsForm.tlocApplicationMessage\' | translate }} </p> </div> <p class="small field__error" ng-if="$ctrl.notEligible"> {{ ::\'clientOnboarding.chooseAccountsForm.notEligibleError\' | translate }}</p> </div> <section ng-if="$ctrl.account.specialOffer" class="c-basket-account-tile__insight"> <div class="productBasket"> <tng-insight-banner insight="$ctrl.account.specialOffer"></tng-insight-banner> </div> </section> </div> <tng-modal-insight ng-if="$ctrl.isInsightModalOpen" insight="$ctrl.account.specialOffer" on-event="$ctrl.handleEvent(action, properties, $ctrl.account.specialOffer)"></tng-modal-insight> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u){(0,i.default)(this,t),this.$translate=e,this.$window=n,this.accountConstants=a,this.environmentService=s,this.InsightsService=r,this.InsightsEvents=o.EVENT_MAP,this.InsightsEventService=c,this.isInsightModalOpen=!1,this.$log=l,this.$q=u,this.accountTypeToLearnMoreExclusionList=a.ACCOUNT_TYPE_TO_LEARN_MORE_EXCLUSION_LIST}return(0,a.default)(t,[{key:"$onInit",value:function(){this.isModalOpen=!1,this.isBusinessEnrollModalOpen=!1,this.accountConstants.ACCOUNT_PPTS.TLOC_INTEREST===this.account.profile_product_type||this.accountConstants.ACCOUNT_PPTS.TLOC_INTEREST_BAL===this.account.profile_product_type?(this.isTloc=!0,this.showLearnMore=!this.account.isTlocApplication):this.accountConstants.ACCOUNT_PPTS.RSP_LOAN===this.account.profile_product_type&&(this.isPal=!!this.account.rspLoanPalDealId),this.marketingUrl=this.environmentService.getBaseUrl()}},{key:"tryAddAccount",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.isAdding=!0,(e?this.tpwRedirect():this.addAccount()).finally((function(){t.isAdding=!1}))}},{key:"openBusinessEnrollModal",value:function(t){this.isBusinessEnrollModalOpen=t}},{key:"showSubheader",value:function(){var t=[this.accountConstants.ACCOUNT_PPTS.TFSAKS,this.accountConstants.ACCOUNT_PPTS.MORTGAGE,this.accountConstants.ACCOUNT_PPTS.MUTUAL_FUND_RIF,this.accountConstants.ACCOUNT_PPTS.TLOC_INTEREST,this.accountConstants.ACCOUNT_PPTS.TLOC_INTEREST_BAL];return this.account.isMaxInterestRate&&this.account.interest_rate&&!(-1!==t.indexOf(this.account.profile_product_type))||!!this.account.isTlocApplication}},{key:"subheaderKey",value:function(){return this.account.isTlocApplication?"clientOnboarding.chooseAccountsForm.asLowAs":"clientOnboarding.chooseAccountsForm.upTo"}},{key:"showInterestPhrase",value:function(){return this.account.isTlocApplication}},{key:"interestPhrase",value:function(){return"clientOnboarding.chooseAccountsForm.tlocinterestphrase"}},{key:"showInterestRate",value:function(){var t=[this.accountConstants.ACCOUNT_PPTS.MORTGAGE];return this.account.interest_rate&&!(-1!==t.indexOf(this.account.profile_product_type))}},{key:"openNewTab",value:function(){if(!this.isExcluded){var t=[this.marketingUrl,this.$translate.instant("clientOnboarding.accountsList.learnMore."+this.account.profile_product_type)].join("");this.$window.open(t,"_blank")}}},{key:"handleEvent",value:function(t,e,n){switch(this.$log.debug(t,e,n),t){case this.InsightsEvents.CLOSE_MODAL:this._closeModal();break;case this.InsightsEvents.INSIGHT_LOADED:break;default:this.InsightsEventService.sendEvent(n,t,e)}}},{key:"_closeModal",value:function(){this.isInsightModalOpen=!1}},{key:"isModalOpen",set:function(t){this._isModalOpen=t},get:function(){return this._isModalOpen}},{key:"isBusinessEnrollModalOpen",set:function(t){this._isBusinessEnrollModalOpen=t},get:function(){return this._isBusinessEnrollModalOpen}},{key:"notEligibleErrorString",get:function(){return this.account.statusCode?"global.errorCodes."+this.account.statusCode:"clientOnboarding.chooseAccountsForm.notEligibleError"}},{key:"isIncluded",get:function(){return!(-1!==this.accountTypeToLearnMoreExclusionList.indexOf(this.account.profile_product_type))}}]),t}();r.$inject=["$translate","$window","accountConstants","EnvironmentService","InsightsService","InsightsConstants","InsightsEventService","$log","$q"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2006)),a=s(n(2007));function s(t){return t&&t.__esModule?t:{default:t}}n(2008);var r={template:i.default,controller:a.default,bindings:{account:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-basket-account-tile-requirements" ng-if="$ctrl.requirementsTemplate"> <div class="c-basket-account-tile-requirements__toggle" ng-click="$ctrl.toggleRequirements()"> {{ ::\'clientOnboarding.accountsList.requirements.whatYouNeed\' | translate }} <span class="" ng-class="$ctrl.showRequirements ? \'icon-uparrow\' : \'icon-downarrow\'"> </span> </div> <div class="requirements-container" ng-show="$ctrl.showRequirements"> <div class="c-basket-account-tile-requirements__header" ng-if="$ctrl.requirementsTemplate.requirementsListTitle" ng-bind-html="$ctrl.requirementsTemplate.requirementsListTitle | translate"> </div> <ul> <li ng-repeat="listItem in $ctrl.requirementsTemplate.listItems" ng-bind-html="listItem | translate"></li> </ul> <div class="c-basket-account-tile-requirements__header" ng-if="$ctrl.requirementsTemplate.additionalListTitle" ng-bind-html="$ctrl.requirementsTemplate.additionalListTitle | translate"> </div> <ul> <li ng-repeat="additionalListItem in $ctrl.requirementsTemplate.additionalListItems" ng-bind-html="additionalListItem | translate"></li> </ul> <div class="c-basket-account-tile-requirements__subdescription" ng-if="$ctrl.requirementsTemplate.subDescription" ng-bind-html="$ctrl.requirementsTemplate.subDescription | translate"> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(365)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s){(0,a.default)(this,t),this.$translate=e,this.accountConstants=n,this.$log=i,this.$q=s,this.showRequirements=!1;var r=n.ACCOUNT_PPTS;this.ACCOUNT_ENROLLMENT_REQUIREMENTS={noRequirements:{applicableProducts:[r.SAVINGS,r.CSA,r.RSP,r.TFSA,r.USDSAVINGS,r.CHEQUING],listItems:["clientOnboarding.accountsList.requirements.noRequirements"]},nonRegGic:{applicableProducts:[r.GIC,r.GIC_USD],listItems:["clientOnboarding.accountsList.requirements.gic.listItem1","clientOnboarding.accountsList.requirements.gic.listItem2"]},regGic:{applicableProducts:[r.GIC_RSP,r.GIC_TFSA,r.GIC_RIF],listItems:["clientOnboarding.accountsList.requirements.gic.listItem1","clientOnboarding.accountsList.requirements.gic.listItem2"],subDescription:"clientOnboarding.accountsList.requirements.gic.subDescription"},cc:{applicableProducts:[r.CC],listItems:["clientOnboarding.accountsList.requirements.cc.listItem1","clientOnboarding.accountsList.requirements.cc.listItem2"],additionalListTitle:"clientOnboarding.accountsList.requirements.cc.additionalListTitle",additionalListItems:["clientOnboarding.accountsList.requirements.cc.additionalListItem1","clientOnboarding.accountsList.requirements.cc.additionalListItem2","clientOnboarding.accountsList.requirements.cc.additionalListItem3","clientOnboarding.accountsList.requirements.cc.additionalListItem4"]},ccWorldMastercard:{applicableProducts:[r.CC_WORLD_MASTERCARD],requirementsListTitle:"clientOnboarding.accountsList.requirements.ccWorldMastercard.requirementsListTitle",listItems:["clientOnboarding.accountsList.requirements.ccWorldMastercard.listItem1","clientOnboarding.accountsList.requirements.ccWorldMastercard.listItem2","clientOnboarding.accountsList.requirements.ccWorldMastercard.listItem3"],additionalListTitle:"clientOnboarding.accountsList.requirements.ccWorldMastercard.additionalListTitle",additionalListItems:["clientOnboarding.accountsList.requirements.ccWorldMastercard.additionalListItem1","clientOnboarding.accountsList.requirements.ccWorldMastercard.additionalListItem2","clientOnboarding.accountsList.requirements.ccWorldMastercard.additionalListItem3"],subDescription:"clientOnboarding.accountsList.requirements.ccWorldMastercard.subDescription"},borrowing:{applicableProducts:[r.HELOC,r.MORTGAGE,r.MORTGAGE_PRE_APPROVAL],listItems:["clientOnboarding.accountsList.requirements.borrowing.home.listItem1","clientOnboarding.accountsList.requirements.borrowing.home.listItem2","clientOnboarding.accountsList.requirements.borrowing.home.listItem3","clientOnboarding.accountsList.requirements.borrowing.home.listItem4"],additionalListTitle:"clientOnboarding.accountsList.requirements.borrowing.home.additionalListTitle",additionalListItems:["clientOnboarding.accountsList.requirements.borrowing.home.additionalListItem1","clientOnboarding.accountsList.requirements.borrowing.home.additionalListItem2","clientOnboarding.accountsList.requirements.borrowing.home.additionalListItem3","clientOnboarding.accountsList.requirements.borrowing.home.additionalListItem4"],subDescription:"clientOnboarding.accountsList.requirements.borrowing.home.subDescription"},tloc:{applicableProducts:[r.TLOC_INTEREST,r.TLOC_INTEREST_BAL],additionalCondition:{attribute:"isTlocApplication",value:"true"},listItems:["clientOnboarding.accountsList.requirements.borrowing.tloc.listItem1","clientOnboarding.accountsList.requirements.borrowing.tloc.listItem2"],additionalListTitle:"clientOnboarding.accountsList.requirements.borrowing.tloc.additionalListTitle",additionalListItems:["clientOnboarding.accountsList.requirements.borrowing.tloc.additionalListItem1"]},rspLoan:{applicableProducts:[r.RSP_LOAN],listItems:["clientOnboarding.accountsList.requirements.borrowing.rspLoan.listItem1","clientOnboarding.accountsList.requirements.borrowing.rspLoan.listItem2","clientOnboarding.accountsList.requirements.borrowing.rspLoan.listItem3"],subDescription:"clientOnboarding.accountsList.requirements.borrowing.rspLoan.subDescription"},rateHold:{applicableProducts:[r.MORTGAGE_RATE_HOLD],listItems:["clientOnboarding.accountsList.requirements.borrowing.rateHold.listItem1"]},nonRegInvestment:{applicableProducts:[r.MUTUAL_FUND],listItems:["clientOnboarding.accountsList.requirements.investments.nonRegistered.listItem1"]},rspInvestement:{applicableProducts:[r.MUTUAL_FUND_RSP],listItems:["clientOnboarding.accountsList.requirements.investments.rsp.listItem1"]},tfsaInvestement:{applicableProducts:[r.MUTUAL_FUND_TFSA],listItems:["clientOnboarding.accountsList.requirements.investments.tfsa.listItem1"]}}}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;this.requirementsTemplate=null,(0,i.default)(this.ACCOUNT_ENROLLMENT_REQUIREMENTS).forEach((function(e){-1!==e.applicableProducts.indexOf(t.account.profile_product_type)&&(e.additionalCondition?""+t.account[e.additionalCondition.attribute]===""+e.additionalCondition.value&&(t.requirementsTemplate=e):t.requirementsTemplate=e)}))}},{key:"toggleRequirements",value:function(){this.showRequirements=!this.showRequirements}}]),t}();o.$inject=["$translate","accountConstants","$log","$q"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2010)),a=s(n(2011));function s(t){return t&&t.__esModule?t:{default:t}}n(2012);var r={template:i.default,controller:a.default,bindings:{account:"<",message:"<?",href:"<?",onModalClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose()" class="c-tpw-redirect-modal"> <header> {{ ::\'clientOnboarding.tpwRedirect.header\' | translate }} </header> <div ng-if="!$ctrl.message"> <p class="medium">{{ ::\'clientOnboarding.tpwRedirect.message\' | translate }}</p> <br> </div> <div ng-if="$ctrl.message"> <p class="medium">{{ ::$ctrl.message }}</p> <br> </div> <footer> <button class="btn btn--edit" ng-click="$ctrl.onModalClose()" actionable-id="tpwRedirectModal_cancel"> {{ ::\'global.components.buttons.cancel\' | translate }} </button> <a class="btn" ng-href="{{ $ctrl.getHref()  }}" actionable-id="tpwRedirectModal_continue"> {{ ::\'global.components.buttons.continue\' | translate }} </a> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.apiUrl=a.getAPIUrl(),this.accountConstants=n,this.$log=e,this.LocaleService=s,this.localeConstants=r}return(0,a.default)(t,[{key:"getHref",value:function(){if(this.href)return this.href;var t="";if("mortgage"===this.account.group){var e="";switch(this.account.profile_product_type){case this.accountConstants.ACCOUNT_PPTS.MORTGAGE_PRE_APPROVAL:t="/web/Tangerine.html?command=openAccount&DST=OPENMRTGPREAPP&FBE_NAV=true";break;case this.accountConstants.ACCOUNT_PPTS.MORTGAGE_RATE_HOLD:t="/web/Tangerine.html?command=openAccount&DST=OPENMRTGRATEHOLD&FBE_NAV=true";break;default:this.account&&this.account.specialOffer&&this.account.specialOffer.ic_basketProducts&&"7000"===this.account.specialOffer.ic_basketProducts&&this.account.specialOffer.hash_code&&this.account.specialOffer.marketingTerm&&(this.account.specialOffer.mortgageTypeEN||this.account.specialOffer.mortgageTypeFR)&&this.account.specialOffer.mortgageRate&&this.account.specialOffer.mortgageAPR&&(e="&marketingTerm="+this.account.specialOffer.marketingTerm+"&mortgageType="+(this.LocaleService.locale===this.localeConstants.LOCALES.FR_CA?this.account.specialOffer.mortgageTypeFR:this.account.specialOffer.mortgageTypeEN)+"&mortgageRate="+this.account.specialOffer.mortgageRate+"&mortgageAPR="+this.account.specialOffer.mortgageAPR),t="/web/Tangerine.html?command=openAccount&DST=OPENMRTG&FBE_NAV=true"+e}}else switch(this.account.profile_product_type){case this.accountConstants.ACCOUNT_PPTS.HELOC:t="/web/Tangerine.html?command=openAccount&DST=OPENMRTG&FBE_NAV=true";break;case this.accountConstants.ACCOUNT_PPTS.GIC_USD:t="/web/Tangerine.html?command=goToOpenAccount&productType="+this.account.profile_product_type+"USD&FBE_NAV=true";break;default:t="/web/Tangerine.html?command=goToOpenAccount&productType="+this.account.profile_product_type+"CAD&FBE_NAV=true"}return this.apiUrl+t}}]),t}();r.$inject=["$log","accountConstants","EnvironmentService","LocaleService","localeConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(2014);var s={template:((i=a)&&i.__esModule?i:{default:i}).default,controller:angular.noop,bindings:{account:"<",message:"<?",onModalClose:"&"}};e.default=s,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose()" class="c-tpw-redirect-modal"> <header> {{:: \'clientOnboarding.callCenterModal.header\' | translate }} </header> <div ng-if="!$ctrl.message"> <p ng-bind-html="::\'clientOnboarding.callCenterModal.callUs\' | translate:{account: $ctrl.account}"> </p> </div> <div ng-if="$ctrl.message"> <p class="medium">{{ ::$ctrl.message }}</p> <br> </div> <footer> <button class="btn btn--edit" ng-click="$ctrl.onModalClose()" actionable-id="callCenterModal_done"> {{:: \'global.components.buttons.close\' | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2016)),a=s(n(2017));function s(t){return t&&t.__esModule?t:{default:t}}n(2018);var r={template:i.default,controller:a.default,bindings:{account:"<",onModalClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose()" class="c-term-loan-modal"> <header> {{ ::\'clientOnboarding.tpwRedirect.header\' | translate }} </header> <div ng-if="!$ctrl.message"> <p class="medium">{{ ::\'clientOnboarding.tpwRedirect.message\' | translate }}</p> <br> </div> <div ng-if="$ctrl.message"> <p class="medium">{{ ::$ctrl.message }}</p> <br> </div> <footer> <button class="btn btn--edit" ng-click="$ctrl.onModalClose()" actionable-id="termLoanModal_cancel"> {{ ::\'global.components.buttons.cancel\' | translate }} </button> <button class="btn btn--orange" ng-click="$ctrl.startTermLoanFlow()" actionable-id="termLoanModal_continue"> {{ ::\'global.components.buttons.continue\' | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(8)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,s,r){(0,a.default)(this,t),(0,i.default)(this,{$log:e,$state:n,accountConstants:s,stateConstants:r})}return(0,s.default)(t,[{key:"startTermLoanFlow",value:function(){this.$state.go(this.stateConstants.EXISTING_CLIENT_ONBOARDING,{termLoan:{isIncomplete:!0,product:this.account}})}}]),t}();o.$inject=["$log","$state","accountConstants","stateConstants"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(68)),a=d(n(58)),s=d(n(15)),r=d(n(8)),o=d(n(0)),c=d(n(2)),l=d(n(1798)),u=d(n(1808));function d(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(e,n,i,a,s,c,l,u,d,h,f,p,g,m){(0,o.default)(this,t),(0,r.default)(this,{$log:e,$q:n,$translate:i,RequesterService:a,serviceConstants:s,accountConstants:c,$httpParamSerializer:l,$cookies:u,$window:d,RspLoanService:f,TlocService:p,EnvironmentService:g,buildConstants:m}),this.mergedRates=c.ACCOUNT_RATES_TO_MERGE.reduce((function(t,e){return t.concat(angular.isArray(e)?e:[e])}),[]),this.currencyTypeRequiredList=[this.accountConstants.ACCOUNT_PPTS.USDSAVINGS,this.accountConstants.ACCOUNT_PPTS.SAVINGS,this.accountConstants.ACCOUNT_PPTS.GIC,this.accountConstants.ACCOUNT_PPTS.GIC_USD],this.ACCOUNT_TYPES=c.ACCOUNT_TYPES,this.mobilePilotPPTS=c.MOBILE_PILOT_OPEN_ACCOUNT_WHITELIST,this.descriptionPrefix="clientOnboarding.chooseAccountsForm.productDescriptions",this.locale=h.locale}return(0,c.default)(t,[{key:"getTlocOffers",value:function(){return this.TlocService.getOffers().catch((function(){return null}))}},{key:"getAccountsRates",value:function(){var t={urlVars:{locale:this.locale}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNTS_RATES,t)}},{key:"getAvailableRspPAL",value:function(t){var e=this;return this.EnvironmentService.isNative()?this.$q.resolve():this.RspLoanService.getAvailablePAL(t).catch((function(t){e.$log.error("GET Rsp Loan Post-approvals ERROR: ",t)}))}},{key:"getCapabilitiesAccounts",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.resetCache,n=void 0!==e&&e;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.USER_CAPABILITIES,{urlVars:{queryString:this.$httpParamSerializer({"include-available-products":!0})}},{resetCache:n})}},{key:"getCreditCards",value:function(){var t={urlVars:{productCode:this.accountConstants.ACCOUNT_PPTS.CC}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.CC_RATES,t)}},{key:"getAvailableAccounts",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,s.default)(this.accountConstants.ACCOUNT_CODES_BY_MUTUAL_FUND_PPT);return this.$q.all([this.getCapabilitiesAccounts(),this.getAccountsRates(),this.getAvailableRspPAL(),this.getTlocOffers(),this.getAvailableRspPAL({getPostApprovals:!0})]).then((function(i){var s=e.isBusiness?t.accountConstants.BUSINESS_ACCOUNT_PPTS:i[0].available_products,o=i[1].rates,c=i[2],d=i[4]&&i[4].length>0,h=null;c?h=i[2].deal_id:d&&(h=i[4][0].deal_id);var f=t.accountConstants.ACCOUNT_PPTS.RSP_LOAN;(o=o.filter((function(n){return(c||d)&&n.profile_product_type===f||(e.ignoreCapabilities||s&&s.indexOf(n.profile_product_type)>=0)&&(!t.EnvironmentService.isNative()||-1!==t.mobilePilotPPTS.indexOf(n.profile_product_type))})).map((function(a){return(0,r.default)({details:t._getDetailsTranslationKey(a),isMutualFund:-1!==n.indexOf(a.profile_product_type),isMortgage:a.profile_product_type===t.accountConstants.ACCOUNT_PPTS.MORTGAGE,isHeloc:a.profile_product_type===t.accountConstants.ACCOUNT_PPTS.HELOC,isMortgageOrHeloc:-1!==[t.accountConstants.ACCOUNT_PPTS.MORTGAGE,t.accountConstants.ACCOUNT_PPTS.HELOC].indexOf(a.profile_product_type),isDepositAccount:a.group===t.ACCOUNT_TYPES.SAVINGS.toLowerCase(),isGic:-1!==t.accountConstants.GIC_ACCOUNT_PPTS.indexOf(a.profile_product_type),isCsa:a.profile_product_type===t.accountConstants.ACCOUNT_PPTS.CSA,isRifIsa:a.profile_product_type===t.accountConstants.ACCOUNT_PPTS.RIF_ISA,isRspLoan:a.profile_product_type===f,isRspLoanPreApproval:a.profile_product_type===f&&c,isRspLoanPostApproval:a.profile_product_type===f&&!c&&d,isRspLoanApplication:a.profile_product_type===f&&!c&&!d,rspLoanPalDealId:a.profile_product_type===f&&(c||d)?h:null,isRspLoanClone:a.profile_product_type===f&&c&&c.isCloned,isChqSav:-1!==t.accountConstants.CHQ_SAV_ACCOUNT_PPTS.indexOf(a.profile_product_type),isUsdSav:a.profile_product_type===t.accountConstants.ACCOUNT_PPTS.USDSAVINGS,isCreditCard:a.profile_product_type===t.accountConstants.ACCOUNT_PPTS.CC||a.profile_product_type===t.accountConstants.ACCOUNT_PPTS.CC_WORLD_MASTERCARD,isTloc:t._isTlocRate(a),isTermLoan:t._isTermLoan(a),isMaxInterestRate:t.mergedRates.indexOf(a.profile_product_type)>=0,isBusinessAccount:e.isBusiness},a,{product_description:t._getProductDescription(a)},{group:a.profile_product_type===t.accountConstants.ACCOUNT_PPTS.RSP_LOAN?t.accountConstants.ACCOUNT_GROUPS.BORROWING:a.group},{tlocOffer:i[3]})}))).find((function(e){return e.isTloc&&e.tlocOffer&&t._activeTlocOffer(e.tlocOffer)}))?(o=(0,u.default)(o,(function(e){return e.isTloc&&!e.tlocOffer||e.isTloc&&!t._activeTlocOffer(e.tlocOffer)||e.isTloc&&!t._isTlocRateMatchesOffer(e)}))).forEach((function(t){t.isTloc&&(t.interest_rate+=t.tlocOffer.offerDetails.spread)})):t.EnvironmentService.isEnabled("enableTLOCApplicationFlow")?o=t._addTlocApplicationTile(o):(0,l.default)(o,(function(t){return t.isTloc})),o=t._filterHigerRatesTermLoan(o);var p=!0,g=!1,m=void 0;try{for(var _,v=(0,a.default)(t.accountConstants.ACCOUNT_RATES_TO_MERGE);!(p=(_=v.next()).done);p=!0){var S=_.value;o=t._mergeRates(o,S)}}catch(t){g=!0,m=t}finally{try{!p&&v.return&&v.return()}finally{if(g)throw m}}var T=t.accountConstants.ACCOUNT_PPTS.MORTGAGE;return o.find((function(t){return t.profile_product_type===T}))&&t._addExtraMortgageTiles(o),t.$log.debug("available accounts",o),o}))}},{key:"_addTlocApplicationTile",value:function(t){var e=this;if(t&&t.length>0){var n=t.find((function(t){return t.profile_product_type===e.accountConstants.ACCOUNT_PPTS.TLOC_INTEREST}));n&&(n.isTlocApplication=!0),(0,l.default)(t,(function(t){return t.profile_product_type===e.accountConstants.ACCOUNT_PPTS.TLOC_INTEREST_BAL}))}return t}},{key:"_filterHigerRatesTermLoan",value:function(t){var e=t.filter((function(t){return t.isTermLoan})),n=Math.min.apply(Math,(0,i.default)(e.map((function(t){return t.interest_rate}))));return(0,l.default)(t,(function(t){return t.isTermLoan&&t.interest_rate>n})),t}},{key:"_getProductDescription",value:function(t){return t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.RSP_LOAN?this.$translate.instant("rspLoan.tileTitle"):t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.CC_WORLD_MASTERCARD?this.$translate.instant("clientOnboarding.accountsList.requirements.ccWorldMastercard.title"):t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.MUTUAL_FUND?this.$translate.instant("clientOnboarding.accountsList.requirements.investments.nonRegistered.title"):this._isTlocRate(t)?t.product_description:t.product_description?t.product_description.replace(/^Tangerine\s|\sTangerine/,""):void 0}},{key:"_isTlocRateMatchesOffer",value:function(t){return this._isTlocRate(t)&&!!t.tlocOffer&&t.profile_product_type===t.tlocOffer.productTypeNumber}},{key:"_activeTlocOffer",value:function(t){return t&&t.offerStatus&&this.TlocService.tlocConstants.OFFER_STATUS.ACTIVE===t.offerStatus}},{key:"_addExtraMortgageTiles",value:function(t){var e={profile_product_type:this.accountConstants.ACCOUNT_PPTS.MORTGAGE_RATE_HOLD,currency:this.accountConstants.CURRENCY_TYPES.CAD,group:this.accountConstants.ACCOUNT_GROUPS.MORTGAGE,redirectToTPW:!0},n=angular.copy(e);n.profile_product_type=this.accountConstants.ACCOUNT_PPTS.MORTGAGE_RATE_HOLD,n.product_description=this.$translate.instant("clientOnboarding.chooseAccountsForm.mortgage.rateHold"),n.details=this._getDetailsTranslationKey(n),t.push(n)}},{key:"_isTlocRate",value:function(t){return t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.TLOC_INTEREST||t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.TLOC_INTEREST_BAL}},{key:"_mergeRates",value:function(t,e){var n=this,i=angular.isArray(e)?e:[e];if(-1!==i.indexOf(this.accountConstants.ACCOUNT_PPTS.MORTGAGE)){var a=t.find((function(t){return t.profile_product_type===n.accountConstants.ACCOUNT_PPTS.MORTGAGE}));return t.filter((function(t){return t===a||i.indexOf(t.profile_product_type)<0}))}var s=this._getHighestInterestAccount(t,i);return s?t.filter((function(t){return t===s||i.indexOf(t.profile_product_type)<0})):t}},{key:"_isTermLoan",value:function(t){return t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.TERM_LOAN}},{key:"_getHighestInterestAccount",value:function(t,e){var n=Math.max.apply(Math,(0,i.default)(t.filter((function(t){return e.indexOf(t.profile_product_type)>=0})).map((function(t){return t.interest_rate}))));return t.find((function(t){return e.indexOf(t.profile_product_type)>=0&&t.interest_rate===n}))}},{key:"_getDetailsTranslationKey",value:function(t){return this.descriptionPrefix+"."+t.profile_product_type}},{key:"getCustomerEligibilityForAccount",value:function(t){var e=this,n=this.serviceConstants.SERVICE_CONFIG.accountServicesByPPT[t.profile_product_type],i={data:{validate_client_eligibility:!0}},a=-1!==this.currencyTypeRequiredList.indexOf(t.profile_product_type);t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.CC?(i.data.validate_only=!1,i.data.creditcard_type="CBK"):t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.CC_WORLD_MASTERCARD&&(i.data.validate_only=!1,i.data.creditcard_type="CBW"),a&&(i.data.product_currency_type=t.currency);var s=this.accountConstants.ACCOUNT_CODES_BY_MUTUAL_FUND_PPT[t.profile_product_type];s&&(i.data.application={account_type:s}),t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.SAVINGS&&t.CCDealId&&(i.data.companion_deal_id=t.CCDealId);var r=t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.RSP_LOAN;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES[n],i).then((function(n){var i=n.response_status,a=e.serviceConstants.STATUS_CODES,s=i&&(i.status_code===a.SUCCESS&&i.return_code!==a.NOT_ELIGIBLE_FOR_ENROLL||r&&i.status_code===a.CREATED),o=null;return s&&r&&!t.isRspLoanPreApproval&&!t.isRspLoanPostApproval?(angular.isNumber(n.available_amount)&&(t.available_amount=n.available_amount,(o=e.RspLoanService.getCustomEligibilityErrorMessage(t))&&(s=!1)),n.companion_products=[]):-1!==e.accountConstants.GIC_PPTS.indexOf(t.profile_product_type)&&(n.companion_products=[]),angular.extend(n,{isEligible:s,eligibilityError:o}),n}))}},{key:"orderAccounts",value:function(t){var e=this,n={products:t.map((function(t,e){return{position:e+1,profile_product_type:t.profile_product_type,pre_selected:!!t.pre_selected,application:t.isRspLoanApplication}}))},i={rawValue:this.$cookies.get("afflres")||"",name:"afflres"},a={rawValue:this.$cookies.get("tngres")||"",name:"tngres"},s={rawValue:this.$cookies.get("extres")||"",name:"extres"};return n.analytics=[],[i,a,s].forEach((function(t){t.rawValue&&n.analytics.push({name:t.name,value:e.$window.btoa(t.rawValue)})})),this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ORDER_ACCOUNTS,{data:n}).then((function(t){if(t.response_status.status_code!==e.serviceConstants.STATUS_CODES.SUCCESS)throw t;return t}))}}]),t}();h.$inject=["$log","$q","$translate","RequesterService","serviceConstants","accountConstants","$httpParamSerializer","$cookies","$window","LocaleService","RspLoanService","TlocService","EnvironmentService","buildConstants"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={PROFILE_PRODUCT_TYPE:{7910:"7910",3510:"3510"}};e.default=i,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={PROFILE_PRODUCT_TYPE:{5700:"5700"}};e.default=i,t.exports=e.default},,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=e.STATES={FUND_ACCOUNT:{name:"fundAccount"},EMAIL_MONEY:{name:"emailMoney"},PHOTO_CHEQUE_DEPOSIT:{name:"photoChequeDeposit"},PHOTO_CHEQUE_DEPOSIT_NATIVE:{name:"photoChequeDepositNative"},MOVE_MONEY:{name:"moveMoney"}};e.FUND_ACCOUNT_TILES={EMAIL_MONEY:{header:"depositMoney.modal.fundAccount.tiles.emailMoney.header",subHeader:"depositMoney.modal.fundAccount.tiles.emailMoney.subHeader",state:i.EMAIL_MONEY},PHOTO_CHEQUE_DEPOSIT:{header:"depositMoney.modal.fundAccount.tiles.photoChequeDeposit.header",subHeader:"depositMoney.modal.fundAccount.tiles.photoChequeDeposit.subHeader",state:i.PHOTO_CHEQUE_DEPOSIT},MOVE_MONEY:{header:"depositMoney.modal.fundAccount.tiles.moveMoney.header",subHeader:"depositMoney.modal.fundAccount.tiles.moveMoney.subHeader",state:i.MOVE_MONEY}},e.PROCESS_LIST_EMAIL_MONEY={E_TRANSFER_FUNCTION:{LABEL:"depositMoney.modal.emailMoney.processList.eTransferFunction"},ENTER_AMOUNT:{LABEL:"depositMoney.modal.emailMoney.processList.enterAmount"},RECEIVE_EMAIL:{LABEL:"depositMoney.modal.emailMoney.processList.receiveEmail"}},e.PROCESS_LIST_PHOTO_DEPOSIT={DOWNLOAD_APP:{LABEL:"depositMoney.modal.photoChequeDeposit.processList.downloadApp"},LOGIN_TO_ACCOUNT:{LABEL:"depositMoney.modal.photoChequeDeposit.processList.loginToAccount"},FOLLOW_INSTRUCTIONS:{LABEL:"depositMoney.modal.photoChequeDeposit.processList.followInstructions"}}},,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=v(n(1908)),a=v(n(2033)),s=v(n(2037)),r=v(n(2041)),o=v(n(2045)),c=v(n(2049)),l=v(n(2053)),u=v(n(2057)),d=v(n(2061)),h=v(n(2065)),f=v(n(2069)),p=v(n(2073)),g=v(n(2077)),m=v(n(2081)),_=v(n(2082));function v(t){return t&&t.__esModule?t:{default:t}}var S=angular.module("tangerine.app.core.components.mutualFund",[]).component("tngMutualFund",a.default).service("MutualFundService",m.default).service("MutualFundFlowService",_.default).constant("mutualFundConstants",i.default).component("tngMutualFundIntro",s.default).component("tngMutualFundSetupPortfolio",r.default).component("tngMutualFundEmployment",o.default).component("tngMutualFundFundFrom",f.default).component("tngMutualFundRecommend",c.default).component("tngMutualFundKnowledge",l.default).component("tngMutualFundObjective",u.default).component("tngMutualFundRisk",d.default).component("tngMutualFundProfile",h.default).component("tngMutualFundSpousalRsp",p.default).component("tngMutualFundReview",g.default);e.default=S,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2034)),a=s(n(2035));function s(t){return t&&t.__esModule?t:{default:t}}n(2036);var r={template:i.default,controller:a.default,bindings:{account:"<",accountsToOpenCount:"<",basketCount:"<",confirmationHandler:"&",isMultiProductEnrollment:"<?",customer:"<",registerFlow:"&",resumingApplication:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-mutual-fund"> <div class="mutual-fund-loading-wrapper"> <div class="c-move-money__error container" ng-show="$ctrl.submitErrors"> <tng-error-message ng-if="$ctrl.hasSubmitErrors"> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.INTRO ||\n        $ctrl.flowService.currentState === $ctrl.flowService.STATES.INCOMPLETE_APP_CONFIRM_INFO"> <tng-mutual-fund-intro account="$ctrl.account" on-enable-next="$ctrl.onEnableNext(enable)" resuming-application="$ctrl.resumingApplication"> </tng-mutual-fund-intro> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.PROFILE"> <tng-mutual-fund-profile customer="$ctrl.customer" pageid="$ctrl.pageId" on-enable-next="$ctrl.onEnableNext(enable)"> </tng-mutual-fund-profile> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.OBJECTIVE"> <tng-mutual-fund-objective customer="$ctrl.customer" pageid="$ctrl.pageId"> </tng-mutual-fund-objective> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.RISK"> <tng-mutual-fund-risk customer="$ctrl.customer" pageid="$ctrl.pageId"> </tng-mutual-fund-risk> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.KNOWLEDGE"> <tng-mutual-fund-knowledge customer="$ctrl.customer" pageid="$ctrl.pageId"> </tng-mutual-fund-knowledge> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.RECOMMENDATION" class="recommend-step"> <tng-mutual-fund-recommend account="$ctrl.account" customer="$ctrl.customer" pageid="$ctrl.pageId" on-enable-next="$ctrl.onEnableNext(enable)" accounts-to-open-count="$ctrl.accountsToOpenCount"> </tng-mutual-fund-recommend> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.SETUP_PORTFOLIO"> <tng-mutual-fund-setup-portfolio account="$ctrl.account" customer="$ctrl.customer" on-enable-next="$ctrl.onEnableNext(enable)"> </tng-mutual-fund-setup-portfolio> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.TPI"> <tpi-form account="$ctrl.account" customer="$ctrl.customer" on-enable-next="$ctrl.onEnableNext(enable)"> </tpi-form> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.EMPLOYMENT"> <tng-mutual-fund-employment account="$ctrl.account" customer="$ctrl.customer" on-enable-next="$ctrl.onEnableNext(enable)"> </tng-mutual-fund-employment> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.JOINT_ACCOUNT_HOLDER"> joint-account-holder disabled for now </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.FUNDFROM"> <tng-mutual-fund-fund-from account="$ctrl.account" customer="$ctrl.customer" basket-count="$ctrl.basketCount" set-sub-flow="$ctrl.flowService.setSubFlow(subFlow)" is-returning="$ctrl.isReturningToMS"> </tng-mutual-fund-fund-from> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.SPOUSAL_RSP"> <tng-mutual-fund-spousal-rsp account="$ctrl.account" customer="$ctrl.customer" on-enable-next="$ctrl.onEnableNext(enable)"> </tng-mutual-fund-spousal-rsp> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.AMOUNT"> <tng-fund-amount account="$ctrl.account" customer="$ctrl.customer" on-enable-next="$ctrl.onEnableNext(enable)" localization-prefix="$ctrl.amountLocalizationPrefix" show-to-portfolio-tile="true" show-borrowed-money="true"> </tng-fund-amount> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.BORROWED_MONEY"> <tng-leverage-section page-id="$ctrl.pageId" initial-value="$ctrl.account.confirmed_borrowed_money" on-value-changed="$ctrl.handleLeverageChange(leverage)" is-required="true"> </tng-leverage-section> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW"> <tng-mutual-fund-review account="$ctrl.account" customer="$ctrl.customer" magic-switch-data="$ctrl.account.fromAccount.UIData" on-enable-submit="$ctrl.onEnableSubmit(enable)"> </tng-mutual-fund-review> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=r(n(1901));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f,p,g,m,_,v,S,T,y,E,A,b,C,$,N,O,I,w,P){(0,i.default)(this,t),this.$interval=e,this.$log=n,this.$q=a,this.$translate=s,this.$window=r,this.SetupAccountFormService=o,this.$timeout=c,this.flowService=l,this.MutualFundService=u,this.EventBusService=d,this.$scope=h,this.pageFlowConstants=f,this.CustomerInfoService=p,this.datePickerConstants=g,this.tileListConstants=_,this.accountConstants=v,this.nativeService=S,this.LOCALES=m.LOCALES,this.ReferenceDataService=T,this.MutualFundConstants=y,this.chooseAccountsFormService=E,this.employmentStatusConstants=A,this.UserSettingsConstants=b,this.serviceConstants=C,this.RequesterService=$,this.MagicSwitchFlowService=N,this.ErrorService=O,this.ERROR_EVENTS=I.AVAILABLE_EVENTS,this.BUTTON_TYPES=f.BUTTON_TYPES,this.EnvironmentService=w,this.ResumeApplicationService=P,this.msmfUpgraded=this.MutualFundService.magicSwitchFundsUpgraded}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.accountTypeToExisting={},this.$scope.$watch("$ctrl.account",(function(){t.flowService.setInitialState(t.flowService.STATES.INTRO),t.flowService.activate(t.registerFlow,!1,!0),t.flowService._parentFlow.incompleteApplicationWarning=!1;var e=t._reset();t.$q.when(!0).then((function(){return!t.flowService._parentFlow.resumingApplication&&t.ResumeApplicationService.hasPendingApplications(t.account)?t.ResumeApplicationService.showPendingApplicationsModal(t.account):t.$q.resolve(!1)})).then((function(){return t.account.applicationId?e.then((function(){return t.MutualFundService.getMutualFundApplication(t.account.applicationId)})).then((function(){t.MutualFundService.setupUIModel(t.customer,t.account),t.flowService.setInitialState(t.flowService.STATES.INCOMPLETE_APP_CONFIRM_INFO),t.flowService.resetState(),t._updateUI()})):t.$q.resolve()})).finally((function(){t.flowService.exitLoadingMode()}))})),this.pageId="mutualFundForm",this.amountLocalizationPrefix="mutualFund",this.flowService.onButtonClickDone=function(){t._done()},this.flowService.onButtonClickCancel=function(){t._cancel()},this.flowService.onButtonClickSkip=function(){t._cancel()},this.flowService.onButtonClickBack=function(){t._goBackState()},this.flowService.onButtonClickSubmit=function(){t._submit()},this.flowService._updateUI=function(e){t._updateUI(e)},this.flowService.gotoNextState=function(){t.gotoNextState()},this.MutualFundService.getSavingsAccounts().then((function(e){e.accounts&&(t.accountTypeToExisting[t.accountConstants.ACCOUNT_PPTS.MUTUAL_FUND]=e.accounts.find((function(e){return e.type===t.accountConstants.ACCOUNT_TYPES.SAVINGS&&!1===e.registered&&!1===e.tax_free&&e.currency_type===t.accountConstants.CURRENCY_TYPES.CAD})),t.accountTypeToExisting[t.accountConstants.ACCOUNT_PPTS.MUTUAL_FUND_TFSA]=e.accounts.find((function(e){return e.type===t.accountConstants.ACCOUNT_TYPES.SAVINGS&&!0===e.registered&&!0===e.tax_free})),t.accountTypeToExisting[t.accountConstants.ACCOUNT_PPTS.MUTUAL_FUND_RSP]=e.accounts.find((function(e){return e.type===t.accountConstants.ACCOUNT_TYPES.SAVINGS&&!0===e.registered&&!1===e.tax_free})))})),this.serviceOrchestrator=new s.default(this.$log,this.$q,this.$interval,{createFn:function(){return t.MutualFundService.createMutualFundApplication(t.customer,t.account).then((function(e){t.account.applicationId=e}))},updateFn:function(e){return e.isSubmit?t.MutualFundService.submitMutualFundApplication(t.customer,t.account,e.skipTransferPdfGeneration):t.MutualFundService.updateMutualFundApplication(t.customer,t.account)},isCreatedFn:function(){return t.account.applicationId},errorProcessingFn:function(e){return t.showSubmitErrors(e)}})}},{key:"getExistingSavingsAccount",value:function(){return this.accountTypeToExisting[this.account.profile_product_type]}},{key:"_done",value:function(){this.flowService.flowIsDone({cancelled:this.cancelled,success:!0,response:{account:{complete:!0}}}),this._reset({deactivateFlowService:!0})}},{key:"_cancel",value:function(){var t=this;return this.confirmationHandler({skipWasClicked:!1}).then((function(e){e&&(t.flowService.flowIsDone({cancelled:!0}),t._reset({deactivateFlowService:!0}))}))}},{key:"_goBackState",value:function(){var t=this.flowService.STATES;switch(this.flowService.currentState){case t.OBJECTIVE:this.customer.objective=this.MutualFundConstants.defaultValues.objective;break;case t.RISK:this.customer.risk=this.MutualFundConstants.defaultValues.risk;break;case t.KNOWLEDGE:this.customer.knowledge=this.MutualFundConstants.defaultValues.knowledge}this.resetSubmitErrors(),this.flowService.gotoPreviousState()}},{key:"updateStepInfo",value:function(t){var e=this.flowService,n=e.currentState,i=e.STATES,a=this.account.tpi_required?1:0,s=this.account.confirmed_joint_account?1:0,r=this.isRSP&&this.account.confirmed_spousal_account?1:0,o=(this.isFundingFromMagicSwitch?this.MagicSwitchFlowService.stepCountInOnboardingMF:0)-(this.msmfUpgraded&&this.isFundingFromMagicSwitch&&!this.isMagicSwitchPaperSign?1:0);this.flowService.currentStepNumber=this.flowService.stateHistoryCount()+1,!this.msmfUpgraded&&this.isFundingFromMagicSwitch&&-1!==[i.REVIEW].indexOf(n)&&(this.flowService.currentStepNumber+=o+1);var c=0;if(this.customer.savingsAccount)c=this.flowService.currentStepNumber;else if(n===i.INCOMPLETE_APP_CONFIRM_INFO)c=1;else{c=13+a+s+r+o-(this.isMultiProductEnrollment?0:1)}this.flowService.totalStepsInSubFlow=c,this.msmfUpgraded&&t&&(this.flowService.currentStepNumber=this.flowService.totalStepsInSubFlow)}},{key:"_updateUI",value:function(t){var e=this.flowService,n=e.currentState,i=e.BUTTON_TYPES,a=e.BUTTONS,s=e.STATES;switch(a.BTN_GRY.show=!0,a.BTN_GRY.disable=!1,a.BTN_ORG.show=!0,a.BTN_ORG.disable=!1,this.updateStepInfo(t),n){case s.INCOMPLETE_APP_CONFIRM_INFO:case s.INTRO:a.BTN_GRY.type=i.CANCEL,a.BTN_ORG.type=i.NEXT,a.BTN_ORG.disable=!0;break;case s.PROFILE:a.BTN_GRY.type=i.BACK,a.BTN_ORG.type=i.NEXT,a.BTN_ORG.show=!0;break;case s.OBJECTIVE:case s.RISK:case s.KNOWLEDGE:a.BTN_ORG.show=!1,a.BTN_GRY.type=i.BACK;break;case s.RECOMMENDATION:if(a.BTN_ORG.type=i.NEXT,a.BTN_ORG.show=!0,a.BTN_GRY.show=!0,this.customer.savingsAccount&&this.customer.savingsAccountEligiblityError){a.BTN_GRY.show=!1,a.BTN_ORG.type=0===this.accountsToOpenCount?i.DONE:i.NEXT;break}this.customer.recommendation.isSavingAccount?void 0!==this.getExistingSavingsAccount()?0===this.accountsToOpenCount?(a.BTN_GRY.type=i.NEXT,a.BTN_ORG.type=i.DONE,this.cancelled=!0):(a.BTN_GRY.show=!1,a.BTN_ORG.type=i.NEXT):(a.BTN_GRY.type=i.SKIP,a.BTN_ORG.type=i.NEXT):a.BTN_GRY.type=i.CANCEL;break;case s.SETUP_PORTFOLIO:case s.TPI:case s.EMPLOYMENT:a.BTN_GRY.type=i.BACK,a.BTN_ORG.type=i.NEXT,a.BTN_ORG.show=!0;break;case s.FUNDFROM:a.BTN_GRY.type=i.BACK,a.BTN_ORG.type=i.NEXT,a.BTN_ORG.show=!1;break;case s.JOINT_ACCOUNT_HOLDER:case s.SPOUSAL_RSP:case s.AMOUNT:case s.BORROWED_MONEY:a.BTN_GRY.type=i.BACK,a.BTN_ORG.type=i.NEXT,a.BTN_ORG.show=!0,a.BTN_ORG.disable=!0;break;case s.REVIEW:a.BTN_ORG.type=i.SUBMIT,a.BTN_ORG.show=!0,a.BTN_ORG.disable=!1,a.BTN_GRY.show=!1}}},{key:"_cycleToRecommendationStep",value:function(){for(this.flowService.moveTo(this.flowService.STATES.PROFILE);this.flowService.currentState!==this.flowService.STATES.RECOMMENDATION;)this.gotoNextState(!0)}},{key:"gotoNextState",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.flowService,i=n.currentState,a=n.STATES;switch(this.resetSubmitErrors(),i){case a.INCOMPLETE_APP_CONFIRM_INFO:this._cycleToRecommendationStep();break;case a.INTRO:this.flowService.moveTo(a.PROFILE);break;case a.PROFILE:this.flowService.moveTo(a.OBJECTIVE);break;case a.OBJECTIVE:this.flowService.moveTo(a.RISK);break;case a.RISK:this.flowService.moveTo(a.KNOWLEDGE);break;case a.KNOWLEDGE:e?this.flowService.moveTo(a.RECOMMENDATION):this.getRecommendation();break;case a.RECOMMENDATION:if(this.customer.recommendation.isSavingAccount){var s=null,r=this.getExistingSavingsAccount();s=void 0!==r&&0===this.accountsToOpenCount?{moveMoney:{toAccount:r}}:{moveToSavingAccount:{savingsAccount:this.customer.savingsAccount}},this.flowService.flowIsDone(s),this._reset({deactivateFlowService:!0})}else this.account.isIncomplete?(this.account.fundFactSent=!0,this.flowService.enterLoadingMode(),this.resetSubmitErrors(),this.updateMutualFundApplication().finally((function(){t.flowService.exitLoadingMode(),t.hasSubmitErrors||t.flowService.moveTo(a.SETUP_PORTFOLIO)}))):this.flowService.moveTo(a.SETUP_PORTFOLIO);break;case a.SETUP_PORTFOLIO:this.account.confirmed_spousal_account||this._resetSpousalObject(),this.account.tpi_required?this.flowService.moveTo(a.TPI):this.flowService.moveTo(a.EMPLOYMENT);break;case a.TPI:this.flowService.moveTo(a.EMPLOYMENT);break;case a.EMPLOYMENT:var o=function(){t.account.confirmed_joint_account?t.flowService.moveTo(a.JOINT_ACCOUNT_HOLDER):t.isRSP&&t.account.confirmed_spousal_account?t.flowService.moveTo(t.flowService.STATES.SPOUSAL_RSP):t.flowService.moveTo(a.FUNDFROM)};this._employmentCleanup(),this.flowService._parentFlow.incompleteApplicationWarning=!0,this.requiresEmploymentInput?(this.flowService.enterLoadingMode(),this.resetSubmitErrors(),this.updateMutualFundApplication().finally((function(){t.flowService.exitLoadingMode(),t.hasSubmitErrors||o()}))):(this.updateMutualFundApplication(),o());break;case a.JOINT_ACCOUNT_HOLDER:this.isRSP&&this.account.confirmed_spousal_account?this.flowService.moveTo(this.flowService.STATES.SPOUSAL_RSP):this.flowService.moveTo(a.FUNDFROM);break;case a.SPOUSAL_RSP:this.updateMutualFundApplication(),this.flowService.moveTo(a.FUNDFROM);break;case a.FUNDFROM:if(this.msmfUpgraded&&this.isFundingFromMagicSwitch){this.isMagicSwitchPaperSign?(this.flowService.showLoadingDoneIcon(),this.$timeout((function(){return t._done()}),this.pageFlowConstants.MODAL_VISIBILITY_TIMEOUT)):this.submitAndCompleteFlow(!0);break}this.updateMutualFundApplication(),!this.msmfUpgraded&&this.isFundingFromMagicSwitch?this.flowService.moveTo(a.REVIEW):this.flowService.moveTo(a.AMOUNT);break;case a.AMOUNT:this.updateMutualFundApplication(),this.flowService.moveTo(a.BORROWED_MONEY);break;case a.BORROWED_MONEY:this.updateMutualFundApplication(),this.flowService.moveTo(a.REVIEW);break;case a.REVIEW:this.submitAndCompleteFlow();break;default:this.$log.error("bad state")}}},{key:"_employmentCleanup",value:function(){this.requiresEmploymentInput||(delete this.customer.companyName,this.customer.companyAddress={},this.customer.employmentIndustry=null,this.customer.employmentOccupation=null)}},{key:"updateMutualFundApplication",value:function(){return this.serviceOrchestrator.saveApplication({isSubmit:!1})}},{key:"submitAndCompleteFlow",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.flowService.enterLoadingMode(),this.submitMutualFundApplication(e).then((function(){t.flowService.showLoadingDoneIcon(),t.$timeout((function(){return t._done()}),t.pageFlowConstants.MODAL_VISIBILITY_TIMEOUT)})).catch((function(e){t.$log.error("submitAndCompleteFlow error:",e),t.flowService.exitLoadingMode(),t.flowService.flowIsDone({cancelled:!1,success:!1,response:{account:t.account}})}))}},{key:"submitMutualFundApplication",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.serviceOrchestrator.saveApplication({isSubmit:!0,skipTransferPdfGeneration:t})}},{key:"showSubmitErrors",value:function(t){var e=this;return this.submitErrors=[],this.ErrorService.processError(t,this.ERROR_EVENTS.REQUEST_ERROR).then((function(n){e.submitErrors.push(n.message),n.code===e.serviceConstants.STATUS_CODES.VALIDATION_ERROR&&"details"in t.response_status&&Array.isArray(t.response_status.details)&&t.response_status.details.forEach((function(t){t.field_name&&t.field_name.indexOf("street_number")>=0&&e.submitErrors.push("global.errorCodes.2151")}))}))}},{key:"resetSubmitErrors",value:function(){this.$log.debug("resetting submit errors"),this.submitErrors=[]}},{key:"_reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.deactivateFlowService,n=void 0!==e&&e;return this.account.type=this.accountConstants.ACCOUNT_TYPES.MUTUAL_FUND,this.customer.income=null,this.customer.netWorth=null,this.customer.timeHorizon=null,this.customer.objective=this.MutualFundConstants.defaultValues.objective,this.customer.risk=this.MutualFundConstants.defaultValues.risk,this.customer.knowledge=this.MutualFundConstants.defaultValues.knowledge,this.customer.savingsAccount=null,this.customer.savingsAccountEligiblityError=null,this.account.confirmed_joint_account=!1,this.account.fundFactAccepted=!1,this.account.third_party_info={address:{},person_info:{birth_date:null},corporate_info:{}},this.customer.recommendation={},this.customer.employmentStatus=null,this.customer.employmentIndustry=null,this.customer.employmentOccupation=null,this.customer.companyName=null,this.customer.companyAddress={},this.customer.numberOfDependents=null,this._resetSpousalObject(),this.account.mfWSAppQueue=0,this.isReturningToMS=!1,this.cancelled=!1,n?this.flowService.deactivate():(this.flowService.resetState(),this._updateUI()),n?this.$q.resolve():this.MutualFundService.retrieveFromAccounts(this.account)}},{key:"_resetSpousalObject",value:function(){this.customer.spouse={dateOfBirth:null}}},{key:"onEnableNext",value:function(t){this.flowService.BUTTONS.BTN_ORG.disable=!t}},{key:"onEnableSubmit",value:function(t){this.flowService.BUTTONS.BTN_ORG.disable=!t}},{key:"getRecommendation",value:function(){var t=this,e=this.accountConstants.ACCOUNT_CODES_BY_MUTUAL_FUND_PPT[this.account.profile_product_type];return e||this.$log.error("Missing account type"),this.resetSubmitErrors(),this.flowService.enterLoadingMode(),this.MutualFundService.submit({accountType:e,age:(new Date).getFullYear()-this.customer.dateOfBirth.year(),clientId:this.customer.client_number,income:this.customer.income,knowledge:this.customer.knowledge,netWorth:this.customer.netWorth,objective:this.customer.objective,riskTolerance:this.customer.risk,timeHorizon:this.customer.timeHorizon}).then((function(e){return e.response_status.status_code!==t.serviceConstants.STATUS_CODES.CREATED?(t.$log.error("MF profile submission error:",e.response_status),t.showSubmitErrors(e),null):(e&&e.recommended_account&&(t.account.recommendedAccount=e.recommended_account),e&&e.recommended_fund&&(t.account.recommendedFund=e.recommended_fund),e&&e.recommended_account&&t.accountConstants.ACCOUNT_CODES_BY_PPT[e.recommended_account.product_type]===t.accountConstants.ACCOUNT_NAME_TO_ACCOUNT_CODE.SAVINGS?t._recommendSavingsAccount(e):(t.customer.recommendation={recommendedAccount:e.recommended_account,recommendedFund:e.recommended_fund},t.flowService.moveTo(t.flowService.STATES.RECOMMENDATION),null))})).catch((function(e){return t.$log.error("MF profile submission error:",e),t.showSubmitErrors(e)})).finally((function(){t.flowService.exitLoadingMode()}))}},{key:"_recommendSavingsAccount",value:function(t){var e=this,n=this.accountConstants.ACCOUNT_PPTS.SAVINGS;return this.isRSP?n=this.accountConstants.ACCOUNT_PPTS.RSP:this.isTFSA&&(n=this.accountConstants.ACCOUNT_PPTS.TFSA),this.customer.recommendation={recommendedAccount:{product_type:n},recommendedFund:t.recommended_fund,isSavingAccount:!0},this.getExistingSavingsAccount()?(this.flowService.moveTo(this.flowService.STATES.RECOMMENDATION),this.$q.resolve()):this.chooseAccountsFormService.getAvailableAccounts().then((function(t){var i=t.find((function(t){return t.profile_product_type===n})),a=e.$q.resolve();return i?a=e._getCustomerEligibility(i):(e.$log.error("Eligiblity error: missing savings account"),e.customer.savingsAccountEligiblityError=!0),a.then((function(){return e.flowService.moveTo(e.flowService.STATES.RECOMMENDATION)}))}))}},{key:"_getCustomerEligibility",value:function(t){var e=this;return this.chooseAccountsFormService.getCustomerEligibilityForAccount(t).then((function(n){e.customer.savingsAccount=t,e.customer.savingsAccountEligiblityError=!n.isEligible,n.isEligible||e.$log.error("Eligiblity error: ",n)}))}},{key:"getPlanType",value:function(){return this.MutualFundService.getPlanType(this.account)}},{key:"_submit",value:function(){this.flowService.gotoNextState()}},{key:"getMutualFundApplication",value:function(){return this.MutualFundService.getMutualFundApplication(this.account.applicationId)}},{key:"$onDestroy",value:function(){this.flowService.deactivate(),this.serviceOrchestrator.dispose()}},{key:"handleLeverageChange",value:function(t){this.account.confirmed_borrowed_money=t}},{key:"requiresEmploymentInput",get:function(){return this.UserSettingsConstants.EMPLOYED_STATUS_CODES.indexOf(this.customer.employmentStatus.code)>=0}},{key:"hasSubmitErrors",get:function(){return this.submitErrors&&this.submitErrors.length>0}},{key:"isNREG",get:function(){return this.account.profile_product_type===this.accountConstants.ACCOUNT_PPTS.MUTUAL_FUND}},{key:"isRSP",get:function(){return this.account.profile_product_type===this.accountConstants.ACCOUNT_PPTS.MUTUAL_FUND_RSP}},{key:"isTFSA",get:function(){return this.account.profile_product_type===this.accountConstants.ACCOUNT_PPTS.MUTUAL_FUND_TFSA}},{key:"isRIF",get:function(){return this.account.profile_product_type===this.accountConstants.ACCOUNT_PPTS.MUTUAL_FUND_RIF}},{key:"isRegistered",get:function(){return this.isRSP||this.isTFSA||this.isRIF}},{key:"isFundingFromMagicSwitch",get:function(){return this.account.fromAccount&&this.account.fromAccount.isMagicSwitch}},{key:"isMagicSwitchPaperSign",get:function(){return this.isFundingFromMagicSwitch&&this.account.fromAccount.isMagicSwitchPaperSign}},{key:"sourceIsMutualFund",get:function(){return this.account.fromAccount&&this.account.fromAccount.type===this.accountConstants.ACCOUNT_TYPES.MUTUAL_FUND}},{key:"sourceIsTFSAMutualFund",get:function(){return this.sourceIsMutualFund&&this.account.fromAccount.tax_free}},{key:"sourceIsExternalAccount",get:function(){return this.account.fromAccount&&this.account.fromAccount.type===this.accountConstants.ACCOUNT_TYPES.EXT}},{key:"isSendCheque",get:function(){return this.account.fromAccount.sendCheque}},{key:"hasFundingAccounts",get:function(){return this.account.fromAccounts&&this.account.fromAccounts.length>0}}]),t}();o.$inject=["$interval","$log","$q","$translate","$window","SetupAccountFormService","$timeout","MutualFundFlowService","MutualFundService","EventBusService","$scope","pageFlowConstants","CustomerInfoService","tngDatePickerConstants","localeConstants","tngTileListConstants","accountConstants","NativeService","ReferenceDataService","mutualFundConstants","ChooseAccountsFormService","employmentStatusConstants","UserSettingsConstants","serviceConstants","RequesterService","MagicSwitchFlowService","ErrorService","errorConstants","EnvironmentService","ResumeApplicationService"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2038)),a=s(n(2039));function s(t){return t&&t.__esModule?t:{default:t}}n(2040);var r={template:i.default,controller:a.default,require:{parentCtrl:"^tngMutualFund"},bindings:{account:"<",onEnableNext:"&",resumingApplication:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports=' <ng-form name="$ctrl.form" class="c-setup-account-form"> <section class="c-setup-account-form__upper-section container"> <section class="c-setup-account-form__upper-section__heading-wrapper"> <h1 class="c-setup-account-form__heading max-text-width"> {{ ::\'mutualFund.intro.fundAccount.header1\' | translate: {investmentFundType: $ctrl.account.product_description} }} </h1> <div ng-if="!$ctrl.resumingApplication"> <p>{{ ::\'mutualFund.intro.fundAccount.part1d1\' | translate }} <strong>{{ ::\'mutualFund.intro.fundAccount.part1d2\' | translate: {investmentFundType: $ctrl.account.product_description} }}</strong>.</p> <p>{{ ::\'mutualFund.intro.fundAccount.part1d3\' | translate: {estimatedMinutes: $ctrl.ESTIMATE_MINUTES} }}</p> </div> <div ng-if="$ctrl.resumingApplication"> <p>{{ ::\'mutualFund.intro.fundAccount.descriptionResuming\' | translate: {investmentFundType: $ctrl.account.product_description} }}</p> </div> </section> <section ng-if="!$ctrl.resumingApplication" class="c-mutual-fund__section--top-margin-mid"> <div class="c-setup-account-form__terms__panel"> <h4>{{ ::\'mutualFund.intro.fundAccount.header2\' | translate }}</h4> <div class="c-setup-account-form__terms__panel__item">{{ ::\'mutualFund.intro.fundAccount.subheader\' | translate }}</div> <ul class="c-setup-account-form__terms__panel__item"> <li>{{ ::\'mutualFund.intro.fundAccount.fundTangerine\' | translate }}</li> <li>{{ ::\'mutualFund.intro.fundAccount.fundExternal\' | translate }}</li> <li ng-if="$ctrl.parentCtrl.isRSP">{{ ::\'mutualFund.intro.fundAccount.fundRSPForm\' | translate }}</li> <li ng-if="$ctrl.parentCtrl.isTFSA">{{ ::\'mutualFund.intro.fundAccount.fundTFSAForm\' | translate }}</li> <li ng-if="!$ctrl.parentCtrl.hasFundingAccounts">{{ ::\'mutualFund.intro.fundAccount.fundCheque\' | translate }}</li> </ul> </div> </section> </section> <section ng-if="$ctrl.parentCtrl.isTFSA" class="c-setup-account-form__upper-section container c-mutual-fund__section--top-margin-large"> <section class="c-setup-account-form__upper-section__heading-wrapper"> <h2 class="c-setup-account-form__heading max-text-width"> {{ ::\'mutualFund.intro.contributionLimits.header1\' | translate }} </h2> <p>{{ ::\'mutualFund.intro.contributionLimits.part1d1\' | translate }}</p> <p ng-if="$ctrl.isTfsaCampaign">{{ ::\'mutualFund.intro.contributionLimits.part1d2\' | translate: {nextYear: $ctrl.nextYear} }}</p> </section> <section class="c-setup-account-form__upper-section__heading-wrapper c-mutual-fund__section--top-margin-mid"> <div class="field"> <label ng-bind-html="::\'mutualFund.intro.contributionLimits.header2\' | translate"></label> <div class="field__group--inline top-margin-medium"> <div class="field"> <input actionable-id="{{ ::$ctrl.pageId }}_contributionLimitsYes" class="input input--pill" ng-model="$ctrl.account.confirmed_contribution_limits" ng-value="true" ng-click="$ctrl.enableNext()" required type="radio"/> <label for="{{ ::$ctrl.pageId }}_contributionLimitsYes" class="c-client-onboarding__toggle-button">{{ ::\'mutualFund.intro.contributionLimits.button1\' | translate }}</label> </div> <div class="field margin__l--fix1"> <input actionable-id="{{ ::$ctrl.pageId }}_contributionLimitsNo" class="input input--pill" ng-model="$ctrl.account.confirmed_contribution_limits" ng-value="false" ng-click="$ctrl.enableNext()" type="radio"/> <label for="{{ ::$ctrl.pageId }}_contributionLimitsNo" class="c-client-onboarding__toggle-button">{{ ::\'mutualFund.intro.contributionLimits.button2\' | translate }}</label> </div> </div> <div ng-show="($ctrl.form.mutualFundIntro_contributionLimitsYes.$dirty || $ctrl.form.mutualFundIntro_contributionLimitsNo.$dirty) && !$ctrl.account.confirmed_contribution_limits" class="field__error"> <p> {{::\'mutualFund.intro.contributionLimits.required\' | translate}} </p> </div> </div> </section> </section> <section class="c-setup-account-form__upper-section container c-mutual-fund__section--top-margin-large c-mutual-fund-amount__section--intro-adjustment"> <section class="c-setup-account-form__upper-section__heading-wrapper"> <h2 class="c-setup-account-form__heading max-text-width"> {{ ::\'mutualFund.intro.personalInfo.header1\' | translate }} </h2> <p>{{ ::\'mutualFund.intro.personalInfo.part1d1\' | translate }}</p> </section> <section class="c-setup-account-form__upper-section__heading-wrapper c-mutual-fund__section--top-margin-mid"> <div class="field"> <label>{{ ::\'mutualFund.intro.personalInfo.header2\' | translate }}</label> <div class="field__group--inline"> <div class="field margin__r--fix1 top-margin-medium"> <input actionable-id="{{ ::$ctrl.pageId }}_personalInfoYes" class="input input--pill CB_ReadOnly" ng-model="$ctrl.account.confirmed_personal_info" ng-value="true" ng-click="$ctrl.enableNext()" required type="radio"/> <label class="c-mutual-fund-amount__section--label c-client-onboarding__toggle-button" for="{{ ::$ctrl.pageId }}_personalInfoYes">{{ ::\'mutualFund.intro.personalInfo.button1\' | translate }}</label> </div> <div class="field top-margin-medium"> <input actionable-id="{{ ::$ctrl.pageId }}_personalInfoNo" class="input input--pill CB_ReadOnly" ng-model="$ctrl.account.confirmed_personal_info" ng-value="false" ng-click="$ctrl.enableNext()" type="radio"/> <label class="c-mutual-fund-amount__section--label c-client-onboarding__toggle-button" for="{{ ::$ctrl.pageId }}_personalInfoNo">{{ ::\'mutualFund.intro.personalInfo.button2\' | translate }}</label> </div> </div> <div ng-show="($ctrl.form.mutualFundIntro_personalInfoYes.$dirty || $ctrl.form.mutualFundIntro_personalInfoNo.$dirty) && !$ctrl.account.confirmed_personal_info" class="field__error"> <p> {{::\'mutualFund.intro.required\' | translate}} </p> </div> </div> </section> </section> </ng-form> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c){(0,i.default)(this,t),this.$window=e,this.$scope=n,this.$translate=a,this.EnvironmentService=s,this.FlowFooterService=r,this.UserService=o,this.USER_CAPABILITIES=c.CAPABILITIES}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.pageId="mutualFundIntro",this.ESTIMATE_MINUTES=10,this.userCapabilities=[],this.enableNext(),this.$scope.$watch("$ctrl.form.$valid",(function(){t.enableNext()})),this.resumingApplication||this.parentCtrl.flowService.enterLoadingMode(),this.$scope.$watch("$ctrl.account.fromAccounts",(function(){!t.resumingApplication&&t.account.fromAccounts&&angular.isArray(t.account.fromAccounts)&&t.parentCtrl.flowService.exitLoadingMode()}));var e=new Date;this.nextYear=e.getFullYear()+1,this.FlowFooterService.agreements=this.agreements,this.FlowFooterService.account=this.account,this.FlowFooterService.agreementsChanged=this.enableNext.bind(this),this._getUserCapabilities()}},{key:"$onDestroy",value:function(){this.FlowFooterService.clearAgreements()}},{key:"enableNext",value:function(){if(this.form){var t=this.form.$valid&&this.account.confirmed_personal_info&&this.account.confirmed_terms&&this.account.confirmed_electronic_signature&&(!this.parentCtrl.isTFSA||this.account.confirmed_contribution_limits);this.onEnableNext({enable:t})}}},{key:"_getUserCapabilities",value:function(){var t=this;return this.parentCtrl.flowService.enterLoadingMode(),this.UserService.getCapabilities().then((function(e){t.userCapabilities=e.capabilities})).finally((function(){t.parentCtrl.flowService.exitLoadingMode()}))}},{key:"agreements",get:function(){var t="mutualFund.intro.agreements",e="mutualFund.intro.agreements";return[{actionableId:this.pageId+"_confirmed_e_docs",required:!1,modelVar:"confirmed_e_docs",labels:[this.$translate.instant(t+".part1d1"),this.$translate.instant(t+".part1d2"),this.$translate.instant(t+".part1d3")],links:[{actionableId:"mutual-fund-intro-link1",url:this.marketingResourcesUrl+this.$translate.instant(e+".link1")}]},{actionableId:this.pageId+"_confirmed_terms",required:!0,modelVar:"confirmed_terms",labels:[this.$translate.instant(t+".part2d1"),this.$translate.instant(t+".part2d2"),this.$translate.instant(t+".part2d3"),this.$translate.instant(t+".part2d4"),this.$translate.instant(t+".part2d5")],links:[{actionableId:"mutual-fund-intro-link2a",url:this.marketingResourcesUrl+this.$translate.instant(e+".link2a")},{actionableId:"mutual-fund-intro-link2b",url:this.marketingResourcesUrl+this.$translate.instant(e+".link2b")}]},{actionableId:this.pageId+"_electronic_signature",required:!0,modelVar:"confirmed_electronic_signature",labels:[this.$translate.instant(t+".part3d1"),this.$translate.instant(t+".part3d2"),this.$translate.instant(t+".part3d3")],links:[{actionableId:"mutual-fund-intro-link3",url:this.marketingResourcesUrl+this.$translate.instant(e+".link3")}]}]}},{key:"marketingResourcesUrl",get:function(){return this.EnvironmentService.getBaseUrl()}},{key:"isTfsaCampaign",get:function(){return this.parentCtrl.isTFSA&&-1!==this.userCapabilities.indexOf(this.USER_CAPABILITIES.PRE_TFSA_ENROLL)}}]),t}();r.$inject=["$window","$scope","$translate","EnvironmentService","FlowFooterService","UserService","menuConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2042)),a=s(n(2043));function s(t){return t&&t.__esModule?t:{default:t}}n(2044);var r={template:i.default,controller:a.default,require:{parentCtrl:"^tngMutualFund"},bindings:{account:"<",customer:"<",onEnableNext:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports=' <ng-form name="$ctrl.form" class="c-setup-account-form" novalidate> <section class="c-setup-account-form__upper-section container"> <section class="c-setup-account-form__upper-section__heading-wrapper"> <h1 class="c-setup-account-form__heading max-text-width"> {{ ::\'mutualFund.setupPortfolio.intro.header1\' | translate: {portfolioType: $ctrl.customer.recommendation.accountTitle} }} </h1> <p>{{ ::\'mutualFund.setupPortfolio.intro.part1d1\' | translate }}</p> </section> </section> <section ng-show="false" ng-if="$ctrl.parentCtrl.isNREG" class="c-setup-account-form__upper-section container c-mutual-fund__section--top-margin-mid"> <section class="c-setup-account-form__upper-section__heading-wrapper"> <div class="field"> <label>{{ ::\'mutualFund.setupPortfolio.jointAccount.header1\' | translate }}</label> <div class="field__group--inline"> <div class="field"> <input class="input input--pill CB_ReadOnly" id="mutualFundForm_jointAccountYes" name="mutualFundForm_jointAccount" ng-model="$ctrl.account.confirmed_joint_account" ng-value="true" required type="radio"/> <label for="mutualFundForm_jointAccountYes" class="c-client-onboarding__toggle-button">{{ ::\'mutualFund.setupPortfolio.jointAccount.button1\' | translate }}</label> </div> <div class="field margin__l--fix1"> <input class="input input--pill CB_ReadOnly" id="mutualFundForm_jointAccountNo" name="mutualFundForm_jointAccount" ng-model="$ctrl.account.confirmed_joint_account" ng-value="false" required type="radio"/> <label for="mutualFundForm_jointAccountNo" class="c-client-onboarding__toggle-button">{{ ::\'mutualFund.setupPortfolio.jointAccount.button2\' | translate }}</label> </div> </div> </div> <p>{{ ::\'mutualFund.setupPortfolio.jointAccount.part1d1\' | translate }}</p> </section> </section> <section ng-if="$ctrl.parentCtrl.isRSP" class="c-setup-account-form__upper-section container c-mutual-fund__section--top-margin-mid"> <section class="c-setup-account-form__upper-section__heading-wrapper"> <h2 class="c-setup-account-form__heading max-text-width"> {{ ::\'mutualFund.setupPortfolio.spousalAccount.header1\' | translate: \'\' }} </h2> <p>{{ ::\'mutualFund.setupPortfolio.spousalAccount.part1d1\' | translate }}</p> </section> <section class="c-setup-account-form__upper-section__heading-wrapper c-mutual-fund__section--top-margin-mid"> <div class="field"> <label>{{ ::\'mutualFund.setupPortfolio.spousalAccount.header2\' | translate }}</label> <div class="field__group--inline top-margin-medium"> <div class="field"> <input class="input input--pill CB_ReadOnly" id="mutualFundForm_spousalAccountYes" name="mutualFundForm_spousalAccount" ng-model="$ctrl.account.confirmed_spousal_account" ng-disabled="$ctrl.account.applicationId" ng-value="true" required type="radio"/> <label for="mutualFundForm_spousalAccountYes" class="c-client-onboarding__toggle-button">{{ ::\'mutualFund.setupPortfolio.spousalAccount.button1\' | translate }}</label> </div> <div class="field margin__l--fix1"> <input class="input input--pill CB_ReadOnly" id="mutualFundForm_spousalAccountNo" name="mutualFundForm_spousalAccount" ng-model="$ctrl.account.confirmed_spousal_account" ng-disabled="$ctrl.account.applicationId" ng-value="false" required type="radio"/> <label for="mutualFundForm_spousalAccountNo" class="c-client-onboarding__toggle-button">{{ ::\'mutualFund.setupPortfolio.spousalAccount.button2\' | translate }}</label> </div> </div> </div> </section> </section> <section ng-if="$ctrl.parentCtrl.isNREG" class="c-setup-account-form__upper-section container c-mutual-fund__section--top-margin-mid"> <section class="c-setup-account-form__upper-section__heading-wrapper"> <h2 class="c-setup-account-form__heading max-text-width"> {{ ::\'mutualFund.setupPortfolio.thirdParty.header1\' | translate }} </h2> <p>{{ ::\'mutualFund.setupPortfolio.thirdParty.part1d1\' | translate }}</p> </section> <section class="c-setup-account-form__upper-section__heading-wrapper c-mutual-fund__section--top-margin-mid"> <div class="field"> <label> <div class="max-text-width"> {{ ::\'mutualFund.setupPortfolio.thirdParty.header2\' | translate }} <tng-help-bubble> {{ ::\'mutualFund.setupPortfolio.thirdParty.tooltip\' | translate }} </tng-help-bubble> </div> </label> <div class="field__group--inline top-margin-medium"> <div class="field"> <input class="input input--pill CB_ReadOnly" id="mutualFundForm_thirdPartyYes" name="mutualFundForm_thirdParty" ng-model="$ctrl.account.tpi_required" ng-value="true" required type="radio"/> <label id="label_mutualFundForm_thirdPartyYes" for="mutualFundForm_thirdPartyYes" class="c-client-onboarding__toggle-button">{{ ::\'mutualFund.setupPortfolio.thirdParty.button1\' | translate }}</label> </div> <div class="field margin__l--fix1"> <input class="input input--pill CB_ReadOnly" id="mutualFundForm_thirdPartyNo" name="mutualFundForm_thirdParty" ng-model="$ctrl.account.tpi_required" ng-value="false" required type="radio"/> <label id="label_mutualFundForm_thirdPartyNo" for="mutualFundForm_thirdPartyNo" class="c-client-onboarding__toggle-button">{{ ::\'mutualFund.setupPortfolio.thirdParty.button2\' | translate }}</label> </div> </div> </div> </section> </section> <section ng-if="$ctrl.parentCtrl.isRSP" class="c-setup-account-form__upper-section container c-mutual-fund__section--top-margin-mid"> <section class="c-setup-account-form__upper-section__heading-wrapper"> <h2 class="c-setup-account-form__heading max-text-width"> {{ ::\'mutualFund.setupPortfolio.intendedUse.header1\' | translate}} </h2> <p>{{ ::\'mutualFund.setupPortfolio.thirdParty.part1d1\' | translate }}</p> </section> </section> <section class="c-setup-account-form__upper-section container c-mutual-fund__section--top-margin-mid"> <section class="c-setup-account-form__upper-section__heading-wrapper"> <div class="field"> <label for="{{ ::$ctrl.pageId }}_intendedUse"> <div> {{ ::\'mutualFund.setupPortfolio.investmentTypes.header1\' | translate }} <tng-help-bubble ng-if="!$ctrl.parentCtrl.isRSP"> {{ ::(\'mutualFund.setupPortfolio.investmentTypes.tip1\' | translate) }} </tng-help-bubble> </div> </label> <div class="medium-width-section"> <tng-select-autocomplete input-id="{{ ::$ctrl.pageId }}_intendedUse" is-static="true" ng-model="$ctrl.account.intendedUse" ng-required="true" options="$ctrl.intendedUses" option-label-key="name" option-value-key="code" placeholder="{{ ::\'mutualFund.setupPortfolio.investmentTypes.placeholder1\' | translate }}"></tng-select-autocomplete> </div> <section class="medium-width-section" ng-if="$ctrl.account.intendedUse === \'OTHER\'"> <input actionable-id="other" class="input top-margin-small" ng-model="$ctrl.account.otherIntendedUse" placeholder="{{ ::\'mutualFund.setupPortfolio.intendedUse.other\' | translate }}" required type="text"/> <div ng-messages="$ctrl.form.other.$error" ng-show="$ctrl.form.other.$dirty" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> </div> </section> </div> </section> <div class="mf-tfsa-spacing" ng-if="$ctrl.parentCtrl.isTFSA"> </div> </section> </ng-form> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$q=e,this.$translate=n,this.$scope=a,this.mutualFundConstants=s,this.ReferenceDataService=r,this.MutualFundService=o}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.form={},this._getIntendedUses(),this.nextEnabled(),this.$scope.$watch("$ctrl.form.$valid",(function(){t.nextEnabled()})),this.$scope.$watch("$ctrl.account.confirmed_spousal_account",(function(e,n){!!e!=!!n&&t.MutualFundService.retrieveFromAccounts(t.account)}))}},{key:"nextEnabled",value:function(){if(this.form){var t=this.form.$valid;this.onEnableNext({enable:t})}}},{key:"_getIntendedUses",value:function(){var t=this;return this.parentCtrl.isRSP?(this.intendedUses=[{name:this.$translate.instant("mutualFund.setupPortfolio.intendedUse.retirement"),code:"RETSA"}],this.account.intendedUse=this.intendedUses[0].code,this.$q.resolve()):this.ReferenceDataService.getDataByType(this.ReferenceDataService.TYPES.INTENDED_USE_ACCOUNT).then((function(e){var n=e[t.ReferenceDataService.TYPES.INTENDED_USE_ACCOUNT].find((function(t){return"MF"===t.code}));if(n){var i=n.data;t.intendedUses=[];for(var a=function(e){var n=t.mutualFundConstants.sortedIntendedUses[e];t.intendedUses.push(i.find((function(t){return t.code===n})))},s=0;s<t.mutualFundConstants.sortedIntendedUses.length;s++)a(s)}}))}}]),t}();r.$inject=["$q","$translate","$scope","mutualFundConstants","ReferenceDataService","MutualFundService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2046)),a=s(n(2047));function s(t){return t&&t.__esModule?t:{default:t}}n(2048);var r={template:i.default,controller:a.default,bindings:{account:"<",customer:"<",onEnableNext:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="container"> <ng-form name="$ctrl.form" class="c-setup-mutual-fund-employment-form" novalidate> <section class="c-setup-mutual-fund-employment-form__section medium-width-section"> <h1>{{::\'mutualFund.employment.header.heading\' | translate:{\'clientsFirstName\': $ctrl.customer.first_name} }}</h1> <p class="medium-width-section">{{::\'mutualFund.employment.header.description\' | translate}}</p> </section> <section class="c-setup-mutual-fund-employment-form__section medium-width-section"> <h2>{{::\'mutualFund.employment.employmentInfo.heading\' | translate}}</h2> <p class="medium-width-section">{{::\'mutualFund.employment.employmentInfo.description\' | translate}}</p> </section> <section class="medium-width-section"> <tng-employment-sio class="medium-width-section" customer="$ctrl.customer" initial-industry="$ctrl.initialIndustry" initial-occupation="$ctrl.initialOccupation" initial-status="$ctrl.initialStatus" page-id="{{::$ctrl.pageId}}" require-industry="true" require-occupation="true" require-status="true"></tng-employment-sio> </section> <section class="c-setup-mutual-fund-employment-form__section medium-width-section" ng-if="$ctrl.customer.employmentStatus && $ctrl.customer.employmentStatus.require_employment_details"> <div class="c-basic-info__edit__field__label"> {{::\'mutualFund.employment.companyName.label\' | translate}} </div> <div class="field"> <input actionable-id="companyName" class="input c-basic-info__edit__field__input top-margin-small" maxlength="50" ng-maxlength="50" ng-model="$ctrl.customer.companyName" placeholder="{{ ::\'userSettings.general.basicInfo.editModal.employmentInfo.employerName\' | translate }}" required type="text"/> <div ng-messages="$ctrl.form.companyName.$error" ng-show="$ctrl.form.companyName.$dirty" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> </div> </div> </section> <section class="c-basic-info__edit__field c-general__component-column__component medium-width-section" ng-if="$ctrl.customer.employmentStatus && $ctrl.customer.employmentStatus.require_employment_details"> <div class="c-basic-info__edit__field__label"> {{ ::\'userSettings.general.basicInfo.editModal.employerAddress\' | translate }} </div> <ng-form name="basic-info-employer-address" class="c-basic-info__edit__field__input__address" novalidate> <tng-address-form-fields street-perfect="false" page-id="{{$ctrl.pageId}}" address-object="$ctrl.customer.companyAddress" actionable-id="companyAddress" is-required="true" show-street-number="true" hide-address-line2="true" address-line1-max-length="32" suite-max-length="8"> </tng-address-form-fields> </ng-form> </section> <section class="c-setup-mutual-fund-employment-form__section medium-width-section"> <h2>{{::\'mutualFund.employment.household.heading\' | translate}}</h2> <p class="medium-width-section">{{::\'mutualFund.employment.household.description\' | translate}}</p> </section> <section class="c-setup-mutual-fund-employment-form__section medium-width-section"> <h4 class="c-setup-mutual-fund-profile-form__section__label">{{::\'mutualFund.employment.numberOfDependents.heading\' | translate}}</h4> <input class="input top-margin-small" min="0" max="99" placeholder="{{::\'mutualFund.employment.numberOfDependents.placeholder\' | translate }}" required type="number" actionable-id="numberOfDependents" ng-model="$ctrl.customer.numberOfDependents"/> <div ng-messages="$ctrl.form.numberOfDependents.$error" ng-show="$ctrl.form.numberOfDependents.$dirty" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> <p ng-message="min"> {{::\'mutualFund.employment.numberOfDependentsRange\' | translate}} </p> <p ng-message="max"> {{::\'mutualFund.employment.numberOfDependentsRange\' | translate}} </p> <p ng-message="number"> {{::\'mutualFund.employment.numbersOnlyError\' | translate}} </p> </div> </section> </ng-form> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(15)),a=o(n(8)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,a,r){(0,s.default)(this,t),this.$log=e,this.$q=n,this.$scope=i,this.customerInfoService=a,this.userSettingsConstants=r}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;return this.pageId="mutualFundEmployment",this.employedStatusCodes=this.userSettingsConstants.EMPLOYED_STATUS_CODES,this.form={},this.industryMap={},this.initialStatus=this.customer.employment_status&&this.customer.employment_status.code?this.customer.employment_status.code:this.customer.employment_status,this.initialIndustry=this.customer.occupation.industry_code,this.initialOccupation=this.customer.occupation.occupation_code,this.$scope.$watch("$ctrl.form.$valid",(function(){t.nextEnabled()})),this._retrieveEmployerAddress().then((function(){t.customer.employer=t.customer.employer||{},t.customer.companyName=t.customer.companyName||t.customer.employer.company_name,t.syncCompanyAddress(),t.nextEnabled()}))}},{key:"syncCompanyAddress",value:function(){this.customer.employer.company_address=this.customer.employer.company_address||{},this.customer.companyAddress=this.customer.companyAddress||{};var t=(0,a.default)({},this.customer.companyAddress);if(delete t.country,0===(0,i.default)(t).length){var e=this.customer.employer.company_address;this.customer.companyAddress=(0,a.default)({address_line1:e.street_name},e),delete this.customer.companyAddress.street_name}}},{key:"_retrieveEmployerAddress",value:function(){var t=this;return this.customerInfoService.get().then((function(e){angular.isObject(e.customer.employer.company_address)&&(t.customer.employer.company_address=e.customer.employer.company_address)}))}},{key:"nextEnabled",value:function(){if(this.form){var t=this.form.$valid;this.onEnableNext({enable:t})}}}]),t}();c.$inject=["$log","$q","$scope","CustomerInfoService","UserSettingsConstants"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2050)),a=s(n(2051));function s(t){return t&&t.__esModule?t:{default:t}}n(2052);var r={template:i.default,controller:a.default,require:{parentController:"^tngMutualFund"},bindings:{account:"<",customer:"<",pageId:"<",onEnableNext:"&",accountsToOpenCount:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-mutual-fund-recommend container"> <h1 class="max-text-width">{{ :: \'mutualFund.recommend.title\' | translate }}</h1> <div ng-if="!$ctrl.customer.recommendation.isSavingAccount"> <p class="bottom-margin-large" ng-bind-html="\'mutualFund.recommend.descriptionMF\' | translate: { accountType: $ctrl.customer.recommendation.accountType }"> </p> <section class="chart-panels"> <div class="chart-panels__column"> <div class="panel chart-panels__left-panel"> <h2 class="top-margin-none" id="customer_recommendation_accountTitle" ng-bind-html="$ctrl.customer.recommendation.accountTitle"></h2> <div class="medium top-margin-small" ng-bind-html="$ctrl.customer.recommendation.accountDescription"></div> </div> </div> <div class="chart-panels__column"> <div class="panel chart-panels__right-panel"> <div class="chart-container"> <tng-donut-chart data="$ctrl.chartData.data" chart-options="$ctrl.chartData.options" is-disabled="false" ng-if="$ctrl.chartBuild"> </tng-donut-chart> <div class="legend__container"> <h3 class="medium margin__b--fix1"> {{ :: \'mutualFund.recommend.legendTitle\' | translate }} </h3> <div class="legend__category medium" ng-repeat="category in $ctrl.chartData.data"> <div class="legend__name medium">{{category.name}}</div> <div class="legend__value medium" ng-style="{ \'color\': category.color }">{{category.amount}}%</div> </div> </div> </div> </div> </div> </section> <h2 class="max-text-width">{{ :: \'mutualFund.recommend.fundFactsTitle\' | translate }}</h2> <p class="medium"> {{ :: \'mutualFund.recommend.fundFactsDescription\' | translate }} </p> <div class="top-margin-medium"> <a actionable-id="mutual-fund-intro-fund_facts_view" target="_blank" href="{{ $ctrl.pdfLink }}" class="btn btn--orange">{{ :: \'mutualFund.recommend.fundFactsView\' | translate }}</a> </div> <div class="small margin__t--fix2 max-text-width"> {{ :: \'mutualFund.recommend.fundFactsDisclaimer\' | translate }} </div> </div> <div ng-if="$ctrl.customer.recommendation.isSavingAccount"> <p style="margin-bottom:2.5rem" ng-bind-html="$ctrl.savingsDescription"></p> <div class="panel chart-panels__full-panel"> <h4 ng-bind-html="$ctrl.customer.recommendation.accountTitle"></h4> <p class="medium" ng-bind-html="$ctrl.customer.recommendation.accountDescription"></p> <ul class="description__list"> <li class="medium">{{ $ctrl.customer.recommendation.accountDescription1 }}</li> <li class="medium">{{ $ctrl.customer.recommendation.accountDescription2 }}</li> <li class="medium">{{ $ctrl.customer.recommendation.accountDescription3 }}</li> <li class="medium">{{ $ctrl.customer.recommendation.accountDescription4 }}</li> </ul> <p class="medium" ng-bind-html="\'mutualFund.recommend.\'+$ctrl.customer.recommendation.productNumber+\'.descriptionEnd\' | translate"></p> </div> <div ng-if="!$ctrl.customer.savingsAccountEligiblityError"> <h2> {{ :: \'mutualFund.recommend.savingsAccount.nextStepsTitle\' | translate }} </h2> <p class="medium" ng-if="!$ctrl.hasSavingsAccount" ng-bind-html="\'mutualFund.recommend.savingsAccount.nextStepsDescription\' | translate: { accountType: $ctrl.customer.recommendation.accountType }"> </p> <p class="medium" ng-if="$ctrl.hasSavingsAccount && $ctrl.accountsToOpenCount > 0" ng-bind-html="\'mutualFund.recommend.savingsAccount.nextStepsDescriptionExisting\' | translate: { accountType: $ctrl.customer.recommendation.accountType }"> </p> <p class="medium" ng-if="$ctrl.hasSavingsAccount && $ctrl.accountsToOpenCount === 0" ng-bind-html="\'mutualFund.recommend.savingsAccount.nextStepsDescriptionExistingMoveMoney\' | translate: { accountType: $ctrl.customer.recommendation.accountType }"> </p> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c){(0,i.default)(this,t),this.$log=e,this.$scope=n,this.$translate=a,this.MutualFundConstants=s,this.$window=r,this.UrlService=o,this.FlowFooterService=c}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.nextEnabled(),this.$scope.$watch("$ctrl.account.fundFactAccepted",(function(){t.nextEnabled()})),this.chartData={},this.$scope.$watch((function(){return!angular.element(document.getElementsByClassName("recommend-step")).hasClass("ng-hide")&&angular.element(document.getElementsByClassName("ob-loading-spinner")).hasClass("ng-hide")&&!angular.element(document.getElementsByClassName("mutual-fund-loading-wrapper")).hasClass("ng-hide")}),(function(e){e&&(t._getRecommendationDetails(),t._setChartData(),t.nextEnabled())})),this.FlowFooterService.agreements=this.agreements,this.FlowFooterService.account=this.account,this.FlowFooterService.agreementsChanged=this.nextEnabled.bind(this)}},{key:"$onDestroy",value:function(){this.FlowFooterService.clearAgreements()}},{key:"_setChartData",value:function(){if(void 0!==this.customer.recommendation.isSavingAccount&&!this.customer.recommendation.isSavingAccount){var t=this.customer.recommendation.productNumber;this.chartData.data=this.MutualFundConstants.accountChartData[t].map(this._mapAccountTypesToTranslations,this),this.chartData.options={chart:{type:"pieChart",height:220,donut:!0,x:function(t){return t.name},y:function(t){return t.amount},color:function(t){return t.color},showLabels:!1,showLegend:!1,legend:{width:200,margin:{top:0,right:0,bottom:0,left:0}},growOnHover:!1,tooltip:{enabled:!1},margin:{left:0,right:0,top:0,bottom:0}}},this.chartBuild=!0}}},{key:"_getRecommendationDetails",value:function(){if(void 0!==this.customer.recommendation.recommendedAccount||void 0!==this.customer.recommendation.recommendedFund){var t=this.customer.recommendation;this.customer.recommendation.isSavingAccount=!!t.recommendedAccount,this.customer.recommendation.productNumber=0,t.recommendedAccount&&t.recommendedAccount.product_type&&(this.customer.recommendation.productNumber=t.recommendedAccount.product_type),t.recommendedFund&&t.recommendedFund.fund_code&&(this.customer.recommendation.productNumber=t.recommendedFund.fund_code);var e="mutualFund.recommend.";this.customer.recommendation.accountType=this.$translate.instant(""+e+t.productNumber+".accountType"),this.customer.recommendation.accountTitle=this.$translate.instant(""+e+t.productNumber+".title"),this.customer.recommendation.accountDescription=this.$translate.instant(""+e+t.productNumber+".description"),this.customer.recommendation.isSavingAccount&&(this.customer.recommendation.accountDescription1=this.$translate.instant(""+e+t.productNumber+".description1"),this.customer.recommendation.accountDescription2=this.$translate.instant(""+e+t.productNumber+".description2"),this.customer.recommendation.accountDescription3=this.$translate.instant(""+e+t.productNumber+".description3"),this.customer.recommendation.accountDescription4=this.$translate.instant(""+e+t.productNumber+".description4")),this.customer.recommendation.accountRisk=this.$translate.instant(""+e+t.productNumber+".accountRisk"),this.pdfLink=this.$translate.instant(""+e+t.productNumber+".pdfLink"),this.pdfLink=this.UrlService.fixRelativeLink(this.pdfLink)}}},{key:"_mapAccountTypesToTranslations",value:function(t){return{name:this.$translate.instant(t.name),amount:t.amount,color:t.color,key:t.key}}},{key:"nextEnabled",value:function(){var t=void 0;t=!!this.customer.recommendation.isSavingAccount||this.account.fundFactAccepted,this.onEnableNext({enable:t})}},{key:"agreements",get:function(){var t="mutualFund.recommend.agreements";return this.customer&&this.customer.recommendation&&this.customer.recommendation.isSavingAccount?[]:[{actionableId:this.pageId+"_agreeFundFacts",required:!0,modelVar:"fundFactAccepted",labels:[this.$translate.instant(t+".part1d1")+" \n        "+this.$translate.instant(t+".part1d2")+"\n        "+this.$translate.instant(t+".part1d3")]}]}},{key:"hasSavingsAccount",get:function(){return this.parentController.getExistingSavingsAccount()}},{key:"savingsDescription",get:function(){var t={accountType:this.customer.recommendation.accountType},e=this.hasSavingsAccount?"mutualFund.recommend.descriptionSavingsExisting":"mutualFund.recommend.descriptionSavings";return this.customer.savingsAccountEligiblityError&&(e="mutualFund.recommend.descriptionSavingsIneligible"),this.$translate.instant(e,t)}}]),t}();r.$inject=["$log","$scope","$translate","mutualFundConstants","$window","UrlService","FlowFooterService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2054)),a=s(n(2055));function s(t){return t&&t.__esModule?t:{default:t}}n(2056);var r={template:i.default,controller:a.default,require:{parentController:"^tngMutualFund"},bindings:{customer:"<",pageId:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="container large-width-section mutual-fund-obj-risk-know"> <section> <h1>{{ :: \'mutualFund.knowledge.header\' | translate }}</h1> <p style="margin-bottom:1.875rem"> {{ :: \'mutualFund.knowledge.description\' | translate }} </p> <tng-tile-list tile-data="$ctrl.limitedTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.knowledgeClicked($ctrl.MutualFundConstants.knowledge.TYPES.LIMITED)" all-actionable="true" tile-list-id="knowledge-option-limitedTile" ng-if="true"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.moderateTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.knowledgeClicked($ctrl.MutualFundConstants.knowledge.TYPES.MODERATE)" all-actionable="true" tile-list-id="knowledge-option-moderateTile" ng-if="true"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.extensiveTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.knowledgeClicked($ctrl.MutualFundConstants.knowledge.TYPES.EXTENSIVE)" all-actionable="true" tile-list-id="knowledge-option-extensiveTile" ng-if="true"> </tng-tile-list> </section> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.$log=e,this.$scope=n,this.$translate=a,this.tileListConstants=s,this.MutualFundConstants=r}return(0,a.default)(t,[{key:"$onInit",value:function(){this.limitedTile={accountName:this.$translate.instant("mutualFund.knowledge.limitedHeader"),bottomText:this.$translate.instant("mutualFund.knowledge.limitedDescription")},this.moderateTile={accountName:this.$translate.instant("mutualFund.knowledge.moderateHeader"),bottomText:this.$translate.instant("mutualFund.knowledge.moderateDescription")},this.extensiveTile={accountName:this.$translate.instant("mutualFund.knowledge.extensiveHeader"),bottomText:this.$translate.instant("mutualFund.knowledge.extensiveDescription")}}},{key:"knowledgeClicked",value:function(t){this.customer.knowledge=t,this.parentController.gotoNextState()}}]),t}();r.$inject=["$log","$scope","$translate","tngTileListConstants","mutualFundConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2058)),a=s(n(2059));function s(t){return t&&t.__esModule?t:{default:t}}n(2060);var r={template:i.default,controller:a.default,require:{parentController:"^tngMutualFund"},bindings:{customer:"<",pageId:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-mutual-fund-objective container large-width-section mutual-fund-obj-risk-know"> <section> <h1>{{ :: \'mutualFund.objective.header\' | translate }}</h1> <p style="margin-bottom:1.875rem"> {{ :: \'mutualFund.objective.description\' | translate }} </p> <tng-tile-list tile-data="$ctrl.safetyTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.objectiveClicked($ctrl.MutualFundConstants.objective.TYPES.SAFETY)" all-actionable="true" iconed="true" icon="\'icon-lock\'" tile-list-id="objective-option-safetyTile" ng-if="true"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.incomeTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.objectiveClicked($ctrl.MutualFundConstants.objective.TYPES.INCOME)" all-actionable="true" iconed="true" icon="\'icon-income\'" tile-list-id="objective-option-incomeTile" ng-if="true"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.balancedTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.objectiveClicked($ctrl.MutualFundConstants.objective.TYPES.BALANCED)" all-actionable="true" iconed="true" icon="\'icon-balance\'" tile-list-id="objective-option-balancedTile" ng-if="true"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.growthTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.objectiveClicked($ctrl.MutualFundConstants.objective.TYPES.GROWTH)" all-actionable="true" iconed="true" icon="\'icon-high\'" tile-list-id="objective-option-growthTile" ng-if="true"> </tng-tile-list> </section> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.$log=e,this.$scope=n,this.$translate=a,this.tileListConstants=s,this.MutualFundConstants=r}return(0,a.default)(t,[{key:"$onInit",value:function(){this.safetyTile={accountName:this.$translate.instant("mutualFund.objective.safetyHeader"),bottomText:this.$translate.instant("mutualFund.objective.safetyDescription"),extraTitle:this.$translate.instant("mutualFund.objective.safetyDescription2")},this.incomeTile={accountName:this.$translate.instant("mutualFund.objective.incomeHeader"),bottomText:this.$translate.instant("mutualFund.objective.incomeDescription"),extraTitle:this.$translate.instant("mutualFund.objective.incomeDescription2")},this.balancedTile={accountName:this.$translate.instant("mutualFund.objective.balancedHeader"),bottomText:this.$translate.instant("mutualFund.objective.balancedDescription"),extraTitle:this.$translate.instant("mutualFund.objective.balancedDescription2")},this.growthTile={accountName:this.$translate.instant("mutualFund.objective.growthHeader"),bottomText:this.$translate.instant("mutualFund.objective.growthDescription"),extraTitle:this.$translate.instant("mutualFund.objective.growthDescription2")}}},{key:"objectiveClicked",value:function(t){this.customer.objective=t,this.parentController.gotoNextState()}}]),t}();r.$inject=["$log","$scope","$translate","tngTileListConstants","mutualFundConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2062)),a=s(n(2063));function s(t){return t&&t.__esModule?t:{default:t}}n(2064);var r={template:i.default,controller:a.default,require:{parentController:"^tngMutualFund"},bindings:{customer:"<",pageId:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-mutual-fund-risk container large-width-section mutual-fund-obj-risk-know"> <section> <h1>{{ :: \'mutualFund.risk.header\' | translate }}</h1> <p style="margin-bottom:1.875rem"> {{ :: \'mutualFund.risk.description\' | translate }} </p> <tng-tile-list tile-data="$ctrl.lowTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.riskClicked($ctrl.MutualFundConstants.risk.TYPES.LOW)" all-actionable="true" iconed="true" icon="\'icon-low\'" ng-if="true"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.mediumlowTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.riskClicked($ctrl.MutualFundConstants.risk.TYPES.MEDIUMLOW)" all-actionable="true" iconed="true" icon="\'icon-medium-low\'" ng-if="true"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.mediumTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.riskClicked($ctrl.MutualFundConstants.risk.TYPES.MEDIUM)" all-actionable="true" iconed="true" icon="\'icon-medium\'" ng-if="true"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.mediumhighTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.riskClicked($ctrl.MutualFundConstants.risk.TYPES.MEDIUMHIGH)" all-actionable="true" iconed="true" icon="\'icon-medium-high\'" ng-if="true"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.highTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.riskClicked($ctrl.MutualFundConstants.risk.TYPES.HIGH)" all-actionable="true" iconed="true" icon="\'icon-high\'" ng-if="true"> </tng-tile-list> </section> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.$log=e,this.$scope=n,this.$translate=a,this.tileListConstants=s,this.MutualFundConstants=r}return(0,a.default)(t,[{key:"$onInit",value:function(){var t="mutualFund.risk.";this.lowTile={accountName:this.$translate.instant(t+"lowHeader"),bottomText:this.$translate.instant(t+"lowDescription1"),extraTitle:this.$translate.instant(t+"lowDescription2")},this.mediumlowTile={accountName:this.$translate.instant(t+"mediumlowHeader"),bottomText:this.$translate.instant(t+"mediumlowDescription")},this.mediumTile={accountName:this.$translate.instant(t+"mediumHeader"),bottomText:this.$translate.instant(t+"mediumDescription")},this.mediumhighTile={accountName:this.$translate.instant(t+"mediumhighHeader"),bottomText:this.$translate.instant(t+"mediumhighDescription")},this.highTile={accountName:this.$translate.instant(t+"highHeader"),bottomText:this.$translate.instant(t+"highDescription")}}},{key:"riskClicked",value:function(t){this.customer.risk=t,this.parentController.gotoNextState()}}]),t}();r.$inject=["$log","$scope","$translate","tngTileListConstants","mutualFundConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2066)),a=s(n(2067));function s(t){return t&&t.__esModule?t:{default:t}}n(2068);var r={template:i.default,controller:a.default,bindings:{customer:"<",pageId:"<",onEnableNext:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="container"> <ng-form class="c-setup-account-form" name="$ctrl.form" novalidate> <section class="c-setup-mutual-fund-profile-form__section medium-width-section"> <h2 class="c-setup-mutual-fund-profile-form__heading">{{::\'mutualFund.profile.heading\' | translate}}</h2> <p class="c-setup-mutual-fund-profile-form__description">{{::\'mutualFund.profile.description\' | translate}}</p> </section> <section class="c-setup-mutual-fund-profile-form__section medium-width-section"> <h4 class="c-setup-mutual-fund-profile-form__section__label">{{::\'mutualFund.profile.incomeLabel\' | translate}}</h4> <div class="field top-margin-medium"> <tng-select-autocomplete input-id="incomeSelection" is-static="true" ng-model="$ctrl.customer.income" ng-required="true" options="$ctrl.incomeOptions" option-label-key="label" option-value-key="value" placeholder="{{::\'mutualFund.profile.selectPlaceholder\' | translate}}"></tng-select-autocomplete> </div> </section> <section class="c-setup-mutual-fund-profile-form__section medium-width-section"> <h4 class="c-setup-mutual-fund-profile-form__section__label">{{::\'mutualFund.profile.networthLabel\' | translate}}</h4> <div class="field top-margin-medium"> <tng-select-autocomplete input-id="networthSelection" is-static="true" ng-model="$ctrl.customer.netWorth" ng-required="true" options="$ctrl.networthOptions" option-label-key="label" option-value-key="value" placeholder="{{::\'mutualFund.profile.selectPlaceholder\' | translate}}"></tng-select-autocomplete> </div> </section> <section class="c-setup-mutual-fund-profile-form__section medium-width-section"> <h4 class="c-setup-mutual-fund-profile-form__section__label">{{::\'mutualFund.profile.timeHorizonLabel\' | translate}}</h4> <div class="field top-margin-medium"> <tng-select-autocomplete input-id="timeHorizonSelection" is-static="true" ng-model="$ctrl.customer.timeHorizon" ng-required="true" options="$ctrl.timeHorizonOptions" option-label-key="label" option-value-key="value" placeholder="{{::\'mutualFund.profile.selectPlaceholder\' | translate}}"></tng-select-autocomplete> </div> </section> </ng-form> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d){(0,i.default)(this,t),this.$log=e,this.$scope=n,this.$translate=a,this.customerConstants=s,this.customersService=r,this.datePickerConstants=u,this.mutualFundConstants=o,this.referenceDataConstants=c,this.referenceDataService=l,this.userSettingsConstants=d}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.employedStatusCodes=this.userSettingsConstants.EMPLOYED_STATUS_CODES,this.form={},this.nextEnabled(),this.$scope.$watch("$ctrl.form.$valid",(function(){t.nextEnabled()})),this.incomeOptions=[],this.networthOptions=[],this.timeHorizonOptions=[],this.incomeOptions=this.mutualFundConstants.incomeOptions.map(this._mapSelectionToTranslations,this),this.networthOptions=this.mutualFundConstants.networthOptions.map(this._mapSelectionToTranslations,this),this.timeHorizonOptions=this.mutualFundConstants.timeHorizonOptions.map(this._mapSelectionToTranslations,this)}},{key:"_mapSelectionToTranslations",value:function(t){return{label:this.$translate.instant(t.label),value:t.value}}},{key:"nextEnabled",value:function(){if(this.form){var t=this.form.$valid;this.onEnableNext({enable:t})}}}]),t}();r.$inject=["$log","$scope","$translate","customerConstants","CustomersService","mutualFundConstants","referenceDataConstants","ReferenceDataService","tngDatePickerConstants","UserSettingsConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2070)),a=s(n(2071));function s(t){return t&&t.__esModule?t:{default:t}}n(2072);var r={template:i.default,controller:a.default,require:{parentController:"^tngMutualFund"},bindings:{account:"=",customer:"<",basketCount:"<",setSubFlow:"&?",isReturning:"="}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-mutual-fund-fund-from container flex" ng-show="!$ctrl.isMagicSwitchModalVisible"> <h2 class="top-margin-none">{{::\'mutualFund.fundFrom.header\' | translate:{ accountType: $ctrl.account.product_description } }}</h2> <div class="top-margin-medium"> <tng-account-select sub-title-key="mutualFund.fundFrom.chooseFrom" accounts="$ctrl.account.fromAccounts" selected-accounts="$ctrl.selectedAccounts" on-select="$ctrl.onFromSelect(account)" hide-footer-copy="true"> </tng-account-select> <tng-tile-list tile-data="$ctrl.chequeTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.onFromSelect(\'fromCheque\')" all-actionable="true" class="c-magic-switch__single-tile" single-select="true" selected-tiles="$ctrl.selectedAccounts" ng-if="!$ctrl.parentController.hasFundingAccounts"> </tng-tile-list> <tng-tile-list ng-if="$ctrl.parentController.isRegistered" tile-data="$ctrl.magicSwitchTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.onFromSelect(\'fromMagicSwitch\')" all-actionable="true" class="c-magic-switch__single-tile" single-select="true" selected-tiles="$ctrl.selectedAccounts"> </tng-tile-list> </div> </div> <tng-magic-switch basket-count="$ctrl.basketCount" ng-if="$ctrl.isMagicSwitchModalVisible" on-close="$ctrl.closeMagicSwitchModal()" is-on-boarding="true" on-boarding-update-function="$ctrl.parentController.updateMutualFundApplication()" submit-mutual-fund-application="$ctrl.parentController.submitMutualFundApplication()" type="$ctrl.parentController.getPlanType()" account="$ctrl.account" register-flow="$ctrl.parentController.flowService.setSubFlow(subFlow)" inline-mode="true" save-application="$ctrl.account.fromAccount" go-to-last-step="$ctrl.isReturning" parent-flow-previous-step-number="$ctrl.parentController.flowService.currentStepNumber" parent-flow-total-steps="$ctrl.parentController.flowService.totalStepsInSubFlow" customer="$ctrl.customer"> </tng-magic-switch> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c){(0,i.default)(this,t),this.$log=e,this.$scope=n,this.$translate=a,this.accountConstants=s,this.mutualFundService=r,this.requesterService=o,this.tileListConstants=c}return(0,a.default)(t,[{key:"_setupModels",value:function(){var t=this;this.account.fromAccount||(this.account.fromAccount={},this.selectedAccounts=[]),this.account.fromAccount.sendCheque?this.selectedAccounts=[this.chequeTile]:this.account.fromAccount.isMagicSwitch?this.selectedAccounts=[this.magicSwitchTile]:this.account.fromAccounts&&this.account.fromAccount&&(this.selectedAccounts=this.account.fromAccounts.filter((function(e){return e.number===t.account.fromAccount.number})))}},{key:"$onInit",value:function(){var t=this;this.isMagicSwitchModalVisible=!1,this.account.fromAccount&&(this.account.fromAccount.tileDescription=null),this.chequeTile={accountName:this.$translate.instant("mutualFund.fundFrom.chequeTitle")},this.magicSwitchTile={accountName:this.$translate.instant("mutualFund.fundFrom.magicSwitchTitle"),bottomText:this.$translate.instant("mutualFund.fundFrom.magicSwitchDescription",{switchAccountType:""+this.parentController.getPlanType()})},this.$scope.$watch("$ctrl.parentController.flowService.currentFlow",(function(e){e.currentState!==t.parentController.flowService.STATES.FUNDFROM||t.isReturning||t.closeMagicSwitchModal()})),this.isReturning&&this.openMagicSwitchModal(),this._setupModels()}},{key:"onFromSelect",value:function(t){if("fromCheque"===t)this.account.fromAccount={sendCheque:!0};else{if("fromMagicSwitch"===t){var e=this.account.fromAccount.request,n=this.account.fromAccount.UIData;return this.account.fromAccount={isMagicSwitch:!0},this.parentController.updateStepInfo(),this.account.fromAccount.request=e,this.account.fromAccount.UIData=n,void this.openMagicSwitchModal()}this.account.fromAccount=t[0]}this.parentController.gotoNextState()}},{key:"openMagicSwitchModal",value:function(){this.isMagicSwitchModalVisible=!0}},{key:"closeMagicSwitchModal",value:function(){this.isMagicSwitchModalVisible=!1}}]),t}();r.$inject=["$log","$scope","$translate","accountConstants","MutualFundService","RequesterService","tngTileListConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2074)),a=s(n(2075));function s(t){return t&&t.__esModule?t:{default:t}}n(2076);var r={template:i.default,controller:a.default,bindings:{account:"<",customer:"<",onEnableNext:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="container"> <ng-form name="$ctrl.form" class="c-setup-mutual-fund-spousalRsp-form" novalidate> <section class="c-setup-mutual-fund-spousalRsp-form__section medium-width-section"> <h2>{{::\'mutualFund.spousalRsp.header.heading\' | translate}}</h2> <p>{{::\'mutualFund.spousalRsp.header.description\' | translate}}</p> </section> <section class="c-setup-mutual-fund-spousalRsp-form__section medium-width-section"> <h2>{{::\'mutualFund.spousalRsp.annuitantInfo.header.heading\' | translate}}</h2> <p>{{::\'mutualFund.spousalRsp.annuitantInfo.header.description\' | translate}}</p> </section> <section class="c-setup-mutual-fund-spousalRsp-form__section medium-width-section"> <h4 class="c-setup-mutual-fund-spousalRsp-form__section__label">{{::\'mutualFund.spousalRsp.annuitantInfo.label\' | translate}}</h4> <div class="grid__container"> <div class="field styleguide-grid-unit grid__column--1of2 top-margin-small"> <input class="input" readonly="readonly" placeholder="{{ ::\'clientOnboarding.basicInfoForm.placeholders.firstName\' | translate }}" type="text" actionable-id="{{ ::$ctrl.pageId }}_firstName" ng-model="$ctrl.customer.first_name"/> </div> <div class="field styleguide-grid-unit grid__column--1of2 top-margin-small"> <input class="input" placeholder="{{ ::\'clientOnboarding.basicInfoForm.placeholders.lastName\' | translate }}" readonly="readonly" type="text" actionable-id="{{ ::$ctrl.pageId }}_lastName" ng-model="$ctrl.customer.last_name"/> </div> </div> </section> <section class="c-setup-mutual-fund-spousalRsp-form__section medium-width-section"> <h2>{{::\'mutualFund.spousalRsp.contributorInfo.header.heading\' | translate}}</h2> <p>{{::\'mutualFund.spousalRsp.contributorInfo.header.description\' | translate}}</p> </section> <section class="c-setup-mutual-fund-spousalRsp-form__section medium-width-section"> <h4 class="c-setup-mutual-fund-spousalRsp-form__section__label">{{::\'mutualFund.spousalRsp.contributorInfo.name\' | translate}}</h4> <div class="field"> <tng-salutation-select is-read-only="false" on-update="$ctrl.updateSalutation(salutation)" is-required="true" input-name="{{ ::$ctrl.pageId }}_salutation" init-value="$ctrl.customer.spouse.title"></tng-salutation-select> <div ng-messages="$ctrl.form.spousalForm_salutation.$error" ng-show="$ctrl.form.spousalForm_salutation.$dirty" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> </div> </div> <div class="grid__container margin__t--fix1"> <div class="field styleguide-grid-unit grid__column--1of2 top-margin-small"> <input class="input" placeholder="{{ ::\'clientOnboarding.basicInfoForm.placeholders.firstName\' | translate }}" required type="text" actionable-id="{{ ::$ctrl.pageId }}_firstName" ng-minlength="2" ng-maxlength="32" ng-model="$ctrl.customer.spouse.firstName"/> <div ng-messages="$ctrl.form.spousalForm_firstName.$error" ng-show="$ctrl.form.spousalForm_firstName.$invalid && $ctrl.form.spousalForm_firstName.$dirty && $ctrl.form.spousalForm_firstName.$touched" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> <p ng-message="minlength"> {{::\'mutualFund.spousalRsp.contributorInfo.minlength\' | translate}} </p> <p ng-message="maxlength"> {{::\'mutualFund.spousalRsp.contributorInfo.maxlength\' | translate}} </p> </div> </div> <div class="field styleguide-grid-unit grid__column--1of2 top-margin-small"> <input class="input" placeholder="{{ ::\'clientOnboarding.basicInfoForm.placeholders.lastName\' | translate }}" required type="text" actionable-id="{{ ::$ctrl.pageId }}_lastName" ng-minlength="2" ng-maxlength="32" ng-model="$ctrl.customer.spouse.lastName"/> <div ng-messages="$ctrl.form.spousalForm_lastName.$error" ng-show="$ctrl.form.spousalForm_lastName.$invalid && $ctrl.form.spousalForm_lastName.$dirty && $ctrl.form.spousalForm_lastName.$touched" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> <p ng-message="minlength"> {{::\'mutualFund.spousalRsp.contributorInfo.minlength\' | translate}} </p> <p ng-message="maxlength"> {{::\'mutualFund.spousalRsp.contributorInfo.maxlength\' | translate}} </p> </div> </div> </div> </section> <section class="c-setup-mutual-fund-spousalRsp-form__section__date-selector medium-width-section"> <div class="field"> <tng-date-selector show-input-display="true" input-display-label="clientOnboarding.basicInfoForm.dateOfBirth" ng-required="true" is-date-of-birth="true" selected-date="$ctrl.customer.spouse.dateOfBirth" hide-frequency-selector="true" hide-selection-mode-selector="true"> </tng-date-selector> </div> </section> <section class="c-setup-mutual-fund-spousalRsp-form__section medium-width-section"> <div class="field"> <label> {{::\'mutualFund.spousalRsp.contributorInfo.sin.label\' | translate }} <tng-help-bubble> {{::\'mutualFund.spousalRsp.contributorInfo.sin.help\' | translate}} </tng-help-bubble> </label> <tng-sin-input input-id="{{ ::$ctrl.pageId }}_sin" ng-model="$ctrl.customer.spouse.sin" ng-required="true"></tng-sin-input> </div> </section> <section class="medium-width-section"> <tng-employment-sio class="medium-width-section" customer="$ctrl.customer.spouse" page-id="{{::$ctrl.pageId}}" require-industry="true" require-occupation="true" require-status="true" title-key="mutualFund.spousalRsp.occupation.heading"></tng-employment-sio> </section> </ng-form> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.$log=e,this.$scope=n,this.dateSelectorConstants=a}return(0,a.default)(t,[{key:"_resetModels",value:function(){this.pageId="spousalForm",this.form={},this.industryMap={}}},{key:"$onInit",value:function(){var t=this;this._resetModels(),this.nextEnabled(),this.$scope.$watch("$ctrl.form.$valid",(function(){t.nextEnabled()}))}},{key:"nextEnabled",value:function(){if(this.form){var t=this.form.$valid;this.onEnableNext({enable:t})}}},{key:"updateSalutation",value:function(t){this.customer.spouse.title=t}}]),t}();r.$inject=["$log","$scope","tngDateSelectorConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2078)),a=s(n(2079));function s(t){return t&&t.__esModule?t:{default:t}}n(2080);var r={template:i.default,controller:a.default,require:{parentCtrl:"^tngMutualFund"},bindings:{account:"<",customer:"<",withinMagicSwitch:"<?",gotoFundingSourceStep:"&?",magicSwitchData:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-mutual-fund-review"> <ng-form name="setupMutualFundReveiwForm" class="c-setup-account-form"> <section class="c-setup-account-form__upper-section container"> <section class="c-setup-account-form__upper-section__heading-wrapper"> <h2 ng-if="!($ctrl.msmfUpgraded && $ctrl.withinMagicSwitch)" class="c-setup-account-form__heading"> {{ ::\'mutualFund.review.header\' | translate }} </h2> <div ng-if="!($ctrl.msmfUpgraded && $ctrl.withinMagicSwitch)"> <p ng-if="$ctrl.parentCtrl.isSendCheque">{{ ::\'mutualFund.review.part1\' | translate }}</p> <p ng-if="!$ctrl.parentCtrl.isSendCheque">{{ ::\'mutualFund.review.part2\' | translate }}</p> </div> <div ng-if="$ctrl.msmfUpgraded && $ctrl.withinMagicSwitch"> <p ng-if="$ctrl.parentCtrl.isSendCheque">{{ ::\'mutualFund.review.part1_upgraded\' | translate }}</p> <p ng-if="!$ctrl.parentCtrl.isSendCheque">{{ ::\'mutualFund.review.part2_upgraded\' | translate }}</p> </div> </section> </section> <section class="c-setup-account-form__upper-section container flex c-mutual-fund-amount__section--tiles c-mutual-fund__section--top-margin-small"> <div class="c-general__component-column"> <div class="heading--sub2"> {{ ::\'mutualFund.review.investment.header\' | translate }} </div> </div> <div class="c-general__sub-component__settings-table-container"> <tng-tile-list class="c-account-select__tile-list" tile-data="$ctrl.account.toPortfolio" tile-type="$ctrl.tileListConstants.TILE_TYPE.account"> </tng-tile-list> <tng-tile-list class="c-account-select__tile-list" tile-data="$ctrl.amountTile" all-actionable="true" on-tile-click="$ctrl.goToAmountStep()" tile-type="$ctrl.tileListConstants.TILE_TYPE.amount"> </tng-tile-list> <tng-tile-list class="c-account-select__tile-list" tile-data="$ctrl.account.fromAccount" all-actionable="true" on-tile-click="$ctrl.parentCtrl.flowService.moveBackTo($ctrl.flowService.STATES.FUNDFROM)" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" ng-if="!$ctrl.parentCtrl.isFundingFromMagicSwitch"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.msFundFromTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.externalAccount" on-tile-click="$ctrl.goToFundFromStep()" all-actionable="true" ng-if="$ctrl.parentCtrl.isFundingFromMagicSwitch" class="c-account-select__tile-list"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.reviewGICTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.goToMagicSwitchExternalInfoStep()" all-actionable="true" class="c-magic-switch__single-tile c-magic-switch__single-tile--last-tile" short-tile="false" ng-if="$ctrl.shouldShowGICreviewTile"> </tng-tile-list> </div> <p class="confirm-message" ng-if="$ctrl.flowService.buyFundsHasBorrowedMoney"> {{ ::\'mutualFund.review.borrowedMoneyMessage\' | translate }} </p> </section> <section class="c-setup-account-form__upper-section container c-mutual-fund__section--top-margin-mid"> <div class="c-general__component-column"> <div class="heading--sub2"> <span ng-if="!$ctrl.account.confirmed_spousal_account"> {{ ::\'mutualFund.review.employment.header\' | translate }} </span> <span ng-if="$ctrl.account.confirmed_spousal_account"> {{ ::\'mutualFund.review.employment.spousalHeader\' | translate }} </span> </div> </div> <div class="c-general__sub-component__settings-table-container"> <tng-settings-table settings="$ctrl.clientInfo"> </tng-settings-table> </div> <button actionable-id="mutual-fund-review-back_btn" class="c-general__sub-component__edit-button btn--edit" ng-click="$ctrl.parentCtrl.flowService.moveBackTo($ctrl.flowService.STATES.EMPLOYMENT)" translate-cloak> {{ ::\'mutualFund.review.edit\' | translate }} </button> </section> <section ng-if="$ctrl.account.confirmed_joint_account" class="c-setup-account-form__upper-section container"> <div class="c-general__component-column"> <div class="heading--sub2"> {{ ::\'mutualFund.review.jointAccountHolder.header\' | translate }} </div> </div> <div class="c-general__sub-component__settings-table-container"> <tng-settings-table settings="$ctrl.jointAccountHolderInfo"> </tng-settings-table> </div> <button actionable-id="mutual-fund-review-edit_btn" class="c-general__sub-component__edit-button btn--edit" ng-click="$ctrl.parentCtrl.flowService.moveBackTo($ctrl.flowService.STATES.JOINT_ACCOUNT_HOLDER)" translate-cloak> {{ ::\'mutualFund.review.edit\' | translate }} </button> </section> <section ng-if="$ctrl.account.confirmed_spousal_account" class="c-setup-account-form__upper-section container"> <div class="c-general__component-column"> <div class="heading--sub2"> {{ ::\'mutualFund.review.contributor.header\' | translate }} </div> </div> <div class="c-general__sub-component__settings-table-container"> <tng-settings-table settings="$ctrl.spousalRspInfo"> </tng-settings-table> </div> <button actionable-id="mutual-fund-review-back_btn_rsp" class="c-general__sub-component__edit-button btn--edit" ng-click="$ctrl.parentCtrl.flowService.moveBackTo($ctrl.flowService.STATES.SPOUSAL_RSP)" translate-cloak> {{ ::\'mutualFund.review.edit\' | translate }} </button> </section> </ng-form> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(15)),a=o(n(0)),s=o(n(2)),r=o(n(45));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,s,r,o,c,l,u,d){(0,a.default)(this,t),this.$timeout=e,this.$translate=n,this.$window=i,this.flowService=s,this.magicSwitchFlowService=r,this.SetupAccountFormService=o,this.tileListConstants=c,this.accountConstants=l,this.DateService=d,this.msmfUpgraded=u.magicSwitchFundsUpgraded}return(0,s.default)(t,[{key:"$onInit",value:function(){if(this.account.toPortfolio={},this.account.toPortfolio.accountName=this.customer.recommendation.accountTitle,this.account.toPortfolio.tileDescription=this.$translate.instant("mutualFund.review.investment.portfolio"),this.account.toPortfolio.bottomText=this.$translate.instant("mutualFund.recommend."+this.customer.recommendation.productNumber+".accountRiskReview"),this.amountTile={},this.amountTile.amount=this.account.investment_amount,this.parentCtrl.isFundingFromMagicSwitch?this.amountTile.header=this.magicSwitchData.isFullAmount?this.$translate.instant("magicSwitch.review.approxInitAmountLabelOB"):this.$translate.instant("magicSwitch.review.transferAmountLabel"):this.amountTile.header=this.$translate.instant("mutualFund.review.investment.initialFund"),this.account.fromAccount.tileDescription=this.$translate.instant("mutualFund.review.investment.source"),this.parentCtrl.isFundingFromMagicSwitch){var t=this.magicSwitchData;this.msFundFromTile={tileDescription:this.$translate.instant("magicSwitch.review.fundFromLabel"),externalName:t.institution,externalNumber:this.$translate.instant("magicSwitch.externalInfo.accountNumber")+": \n          "+t.accountNumber,externalAddress:t.institutionAddress.displayAddress},this.shouldShowGICreviewTile&&(this.reviewGICTile={tileDescription:this.$translate.instant("magicSwitch.review.GICTitle"),accountName:this.DateService.convertToFormattedMonthDayYear(t.gicMaturityDate),bottomText:t.isGICEarly?this.$translate.instant("magicSwitch.review.GICEarly"):this.$translate.instant("magicSwitch.review.GICLater")})}this.clientInfo=[],this.jointAccountHolderInfo=[],this.spousalRspInfo=[],this._populateClientInfo(),this._populateJointAccountHolderInfo(),this._populateSpousalRspInfo()}},{key:"_populateClientInfo",value:function(){if(this.clientInfo.push({order:0,label:this.$translate.instant("mutualFund.review.employment.employmentStatus"),text:this.customer.employmentStatus.name}),this.customer.employmentIndustry&&this.clientInfo.push({order:1,label:this.$translate.instant("mutualFund.review.employment.industry"),text:this.customer.employmentIndustry.name}),this.customer.employmentOccupation&&this.clientInfo.push({order:2,label:this.$translate.instant("mutualFund.review.employment.occupation"),text:this.customer.employmentOccupation.name}),this.customer.companyName&&this.clientInfo.push({order:3,label:this.$translate.instant("mutualFund.review.employment.employerName"),text:this.customer.companyName}),this.customer.companyAddress&&0!==(0,i.default)(this.customer.companyAddress).length){var t=[],e=[];this.customer.companyAddress.street_number&&e.push(this.customer.companyAddress.street_number),this.customer.companyAddress.address_line1&&e.push(this.customer.companyAddress.address_line1),void 0!==this.customer.companyAddress.address_line2&&this.customer.companyAddress.address_line2.length>0&&e.push(""+this.customer.companyAddress.address_line2),t.push(e.join(" ")),void 0!==this.customer.companyAddress.suite&&this.customer.companyAddress.suite.length>0&&t.push(", "+this.customer.companyAddress.suite),t.push("\n"),t.push(this.customer.companyAddress.city+", "+this.customer.companyAddress.province+"\n"),t.push(this.customer.companyAddress.country+", "+this.customer.companyAddress.postal_code),this.clientInfo.push({order:4,label:this.$translate.instant("mutualFund.review.employment.employerAddress"),text:t.join("")})}this.clientInfo.push({order:5,label:this.$translate.instant("mutualFund.review.employment.dependents"),text:this.customer.numberOfDependents})}},{key:"_populateJointAccountHolderInfo",value:function(){this.account.confirmed_joint_account&&(this.jointAccountHolderInfo.push({order:0,label:this.$translate.instant("mutualFund.review.jointAccountHolder.name"),text:this.account.joint_account_holder.holder.first_name+" "+this.account.joint_account_holder.holder.last_name}),this.jointAccountHolderInfo.push({order:1,label:this.$translate.instant("mutualFund.review.jointAccountHolder.email"),text:this.account.joint_account_holder.holder.email_address}),this.jointAccountHolderInfo.push({order:2,label:this.$translate.instant("mutualFund.review.jointAccountHolder.clientNumber"),text:this.account.joint_account_holder.holder.sequence_number}),this.jointAccountHolderInfo.push({order:3,label:this.$translate.instant("mutualFund.review.jointAccountHolder.question"),text:this.account.joint_account_holder.holder.email_question}),void 0!==this.account.joint_account_holder.holder.email_answer&&this.account.joint_account_holder.holder.email_answer.length>0&&this.jointAccountHolderInfo.push({order:4,label:this.$translate.instant("mutualFund.review.jointAccountHolder.answer"),text:this.account.joint_account_holder.holder.email_answer}))}},{key:"_populateSpousalRspInfo",value:function(){if(this.account.confirmed_spousal_account){this.spousalRspInfo.push({order:0,label:this.$translate.instant("mutualFund.review.contributor.name"),text:this.customer.spouse.firstName+" "+this.customer.spouse.lastName});var t=this.customer.spouse.dateOfBirth,e=(0,r.default)(t).format("DD/MM/YYYY");this.spousalRspInfo.push({order:1,label:this.$translate.instant("mutualFund.review.contributor.birthday"),text:e}),this.spousalRspInfo.push({order:2,label:this.$translate.instant("mutualFund.review.contributor.sin"),text:"******"+this.customer.spouse.sin.substring(6)}),this.spousalRspInfo.push({order:2,label:this.$translate.instant("mutualFund.review.contributor.status"),text:this.customer.spouse.employmentStatus.name}),this.customer.spouse.employmentIndustry&&(this.spousalRspInfo.push({order:3,label:this.$translate.instant("mutualFund.review.contributor.industry"),text:this.customer.spouse.employmentIndustry.name}),this.customer.spouse.employmentOccupation.name&&this.spousalRspInfo.push({order:4,label:this.$translate.instant("mutualFund.review.contributor.occupation"),text:this.customer.spouse.employmentOccupation.name}))}}},{key:"goToAmountStep",value:function(){var t=this.parentCtrl.isFundingFromMagicSwitch;if(this.parentCtrl.isReturningToMS=!this.msmfUpgraded&&t,this.msmfUpgraded){var e=this.withinMagicSwitch?this.magicSwitchFlowService:this.flowService;e.moveBackTo(e.STATES.AMOUNT)}else this.flowService.moveBackTo(t?this.flowService.STATES.FUNDFROM:this.flowService.STATES.AMOUNT)}},{key:"goToFundFromStep",value:function(){this.parentCtrl.isReturningToMS=!1,this.withinMagicSwitch&&this.gotoFundingSourceStep?this.gotoFundingSourceStep():this.flowService.moveBackTo(this.flowService.STATES.FUNDFROM)}},{key:"goToMagicSwitchExternalInfoStep",value:function(){var t=this;this.withinMagicSwitch?this.magicSwitchFlowService.moveBackTo(this.magicSwitchFlowService.STATES.EXTERNAL_INFO):(this.parentCtrl.isReturningToMS=!0,this.flowService.moveBackTo(this.flowService.STATES.FUNDFROM),this.$timeout((function(){t.magicSwitchFlowService.moveTo(t.magicSwitchFlowService.STATES.EXTERNAL_INFO)}),0))}},{key:"shouldShowGICreviewTile",get:function(){return this.parentCtrl.isFundingFromMagicSwitch&&this.magicSwitchData.isGIC&&this.magicSwitchData.gicMaturityDate}}]),t}();c.$inject=["$timeout","$translate","$window","MutualFundFlowService","MagicSwitchFlowService","SetupAccountFormService","tngTileListConstants","accountConstants","MutualFundService","DateService"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(15)),a=o(n(8)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,a,r,o,c,l,u,d,h,f){(0,s.default)(this,t),this.addressFormFieldsService=e,this.RequesterService=n,this.serviceConstants=i,this.$log=a,this.mutualFundConstants=r,this.accountConstants=o,this.employmentStatusConstants=c,this.tpiFormConstants=l,this.$translate=u,this.$q=d,this.MagicSwitchFlowService=h,this.DateService=f,this.mutualFundRequest=null}return(0,r.default)(t,[{key:"submit",value:function(t){var e=this;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.MUTUAL_FUND_PROFILE_SUBMIT,{data:{account_type:t.accountType,client_id:t.clientId,client:{age:t.age,income:t.income.toString(),knowledge:t.knowledge||this.mutualFundConstants.defaultValues.knowledge,net_worth:t.netWorth.toString(),objective:t.objective||this.mutualFundConstants.defaultValues.objective,risk_tolerance:t.riskTolerance||this.mutualFundConstants.defaultValues.risk,time_horizon:t.timeHorizon.toString()}}}).catch((function(t){throw e.$log.error(t),t}))}},{key:"createMutualFundApplication",value:function(t,e){var n=this;this._setMutualFundRequest(t,e);var i={data:this.mutualFundRequest};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.CREATE_MUTUAL_FUND_APPLICATION,i).then((function(t){if(t.response_status.status_code!==n.serviceConstants.STATUS_CODES.CREATED)throw n.$log.error("Create MF application response error:",t),t;return n.$log.debug("MF applicaton is created"),t.confirmation.deal_id})).catch((function(t){throw n.$log.error("Create MF application error:",t),t}))}},{key:"updateMutualFundApplication",value:function(t,e){var n=this;return this.getMutualFundApplication(e.applicationId).then((function(){return n.mutualFundRequest.submit_application=!1,n._updateMutualFundRequest(t,e),n._setQuestions(t,e),n._updateMutualFundApplication(e,"update").catch((function(t){throw t}))})).catch((function(t){throw t}))}},{key:"submitMutualFundApplication",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.getMutualFundApplication(e.applicationId).then((function(){return n.mutualFundRequest.submit_application=!0,i?n.mutualFundRequest.skip_transfer_pdf_generation=!0:delete n.mutualFundRequest.skip_transfer_pdf_generation,n._updateMutualFundRequest(t,e),n._setQuestions(t,e),n._updateMutualFundApplication(e,"submit").catch((function(t){throw t}))})).catch((function(t){throw t}))}},{key:"_occupationCodesToString",value:function(t,e,n){var i=[];return t&&i.push(t),e&&i.push(e),n&&i.push(n),"NEWOCC::"+i.join(",")}},{key:"_getOccupationStringCodes",value:function(t){var e=(t||"").match(/.*::(.*)/);return e&&e.length>=1?e[1].split(",").map((function(t){return t.trim()})):[]}},{key:"_getAccountType",value:function(t){var e=this.accountConstants.ACCOUNT_CODES_BY_MUTUAL_FUND_PPT[t.profile_product_type];return t.confirmed_joint_account&&t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.MUTUAL_FUND?e=this.accountConstants.MUTUAL_FUND_PLAN_TYPES.NREGJ:t.confirmed_spousal_account&&t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.MUTUAL_FUND_RSP&&(e=this.accountConstants.MUTUAL_FUND_PLAN_TYPES.RSPSP),e}},{key:"_setMutualFundRequest",value:function(t,e){var n=this.accountConstants.FUND_NUMBER_TO_PORTFOLIO_TYPE,i=e.recommendedFund;this.mutualFundRequest={validate_client_eligibility:!1,validate_only:!1,application:{qualification_questions:{income:""+t.income,knowledge:t.knowledge,net_worth:""+t.netWorth,objective:t.objective,risk_tolerance:t.risk,time_horizon:""+t.timeHorizon},investment_selection:{client_score:i.client_score,company_code:i.company_code,fund_number:i.fund_code,portfolio_type:n[i.fund_code]},applicants:[{type:"PR",cif:t.client_number,name:{prefix:t.title,first_name:t.first_name,last_name:t.last_name},DOB:t.date_of_birth,SIN1:t.sin?t.sin.split("-")[0]:"",SIN2:t.sin?t.sin.split("-")[1]:"",SIN3:t.sin?t.sin.split("-")[2]:"",occupation:this.employmentStatusConstants.WS_CODES[t.employmentStatus.code],contact:{},number_of_dependant:t.numberOfDependents}],application_status:this.mutualFundConstants.applicationStatus.INC,application_category:"MF",account_type:this._getAccountType(e),detail_info:[{type:"PR",questions:[{code:"TERM",value:e.confirmed_terms?this.mutualFundConstants.booleanValues.Y:this.mutualFundConstants.booleanValues.N},{code:"PRIVACY",value:e.confirmed_terms?this.mutualFundConstants.booleanValues.Y:this.mutualFundConstants.booleanValues.N},{code:"ESTCONSENT",value:e.confirmed_electronic_signature?this.mutualFundConstants.booleanValues.Y:this.mutualFundConstants.booleanValues.N}]}]},legal_instructions:{}},this._setEmploymentInfo(t,e),this._setThirdPartyInfo(t,e),this._setIntendedUse(e)}},{key:"_updateMutualFundRequest",value:function(t,e){delete this.mutualFundRequest.response_status,delete this.mutualFundRequest.responseHeaders,delete this.mutualFundRequest.cache_status,delete this.mutualFundRequest.fund_fact_sent,this.mutualFundRequest.validate_only=!1,this.mutualFundRequest.application.account_type=this._getAccountType(e),this._setEmploymentInfo(t,e),this._setNumberOfDependents(t),this._setThirdPartyInfo(t,e),this._setSpousalInfo(t,e),this._setSourceOfFundInfo(t,e),this._setInvestmentAmount(t,e),this._setIntendedUse(e),e.fundFactSent&&(this.mutualFundRequest.fund_fact_sent=!0,delete e.fundFactSent)}},{key:"getPlanType",value:function(t){var e=this.accountConstants.ACCOUNT_CODES_BY_MUTUAL_FUND_PPT,n=this.accountConstants.ACCOUNT_PPTS,i=t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.MUTUAL_FUND_RSP,a=t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.MUTUAL_FUND_TFSA,s=e[n.MUTUAL_FUND];return a?s=e[n.MUTUAL_FUND_TFSA]:i&&(s=e[n.MUTUAL_FUND_RSP]),s}},{key:"getPlanTypeForOpenAccounts",value:function(t){var e=this.accountConstants.MUTUAL_FUND_PLAN_TYPES_FOR_OPEN_ACCOUNTS,n=this.getPlanType(t);return t.confirmed_spousal_account&&(n=this.accountConstants.MUTUAL_FUND_PLAN_TYPES.RSPSP),e[n]}},{key:"retrieveFromAccounts",value:function(t){var e=this;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.MUTUAL_FUND_FROM_ACCOUNTS,{urlVars:{planType:this.getPlanTypeForOpenAccounts(t)}}).then((function(n){if(n.response_status.status_code!==e.serviceConstants.STATUS_CODES.SUCCESS&&n.response_status.status_code!==e.serviceConstants.STATUS_CODES.NO_DATA)throw e.$log.error("Get MF from account response error:",n),n;t.fromAccounts=n.fromAccounts}))}},{key:"getMutualFundApplication",value:function(t){var e=this,n={urlVars:{dealId:t}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_MUTUAL_FUND_APPLICATION,n).then((function(t){if(t.response_status.status_code!==e.serviceConstants.STATUS_CODES.SUCCESS)throw e.$log.error("Get MF application response error:",t),t;return e.mutualFundRequest=angular.copy(t),t})).catch((function(t){throw e.$log.error("Get MF application error:",t),t}))}},{key:"setupUIModel",value:function(t,e){var n=this.mutualFundRequest,i=n.application,a=i.investment_selection.fund_number,s=n.legal_instructions||{},r=(i.detail_info||[]).find((function(t){return"PR"===t.type}))||{},o=(i.applicants||[]).find((function(t){return"PR"===t.type}))||{},c=r.questions||[],l=i.qualification_questions||{};if(e.type=this.accountConstants.ACCOUNT_TYPES.MUTUAL_FUND,!e.isMutualFund)throw new Error("Missing mutual fund flag");if(this._setQuestionsInverse(e,c),e.confirmed_contribution_limits=null,e.confirmed_personal_info=null,e.confirmed_e_docs=!1,e.confirmed_terms=!1,e.confirmed_electronic_signature=!1,t.income=l.income||null,t.netWorth=l.net_worth||null,t.timeHorizon=l.time_horizon||null,t.objective=l.objective||null,t.risk=l.risk_tolerance||null,t.knowledge=l.knowledge||null,e.recommendedFund={},e.recommendedFund.fund_code=a,t.recommendation={},t.recommendation.recommendedFund={},t.recommendation.recommendedFund.fund_code=a,e.fundFactAccepted=!1,e.confirmed_joint_account=n.application.account_type===this.accountConstants.MUTUAL_FUND_PLAN_TYPES.NREGJ,e.confirmed_spousal_account=n.application.account_type===this.accountConstants.MUTUAL_FUND_PLAN_TYPES.RSPSP,e.tpi_required=s.third_party,e.intendedUse=s.intended_account_use,e.otherIntendedUse=s.other_intended_use,s.third_party_info){var u=e.third_party_info;this._setThirdPartyInfoInverse(u,s)}if(r.employer_detail){var d=r.employer_detail;this._setEmploymentInfoInverse(t,d,o)}var h=r.spouse;if(h){t.spouse=t.spouse||{};var f=t.spouse;this._setSpousalInfoInverse(f,h)}var p=n.application.source_of_funds;this._setSourceOfFundInfoInverse(e,p),e.fromAccount.UIData.transaction.amount=n.application.investment_selection.investment_amount,e.fromAccount.UIData.isFullAmount=e.fullAmount,e.toPortfolio=e.toPortfolio||{},e.toPortfolio.accountName=this.$translate.instant("mutualFund.recommend."+a+".title"),this._setInvestmentAmountInverse(e,n.application.investment_selection),e.applicationId=n.application.deal_id,e.confirmation=e.confirmation||{},e.confirmation.plan_type=n.application.account_type,e.confirmation.funding_required=!1,e.confirmation.application_status=e.confirmation.plan_type=n.application.application_status,e.confirmation.created_date=n.application.create_date,e.confirmation.joint_application=!1,e.confirmation.status_date=n.application.status_date,e.confirmation.deal_id=n.application.deal_id}},{key:"_updateMutualFundApplication",value:function(t,e){var n=this,i=t.applicationId,s={data:this.mutualFundRequest,urlVars:{dealId:i}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UPDATE_MUTUAL_FUND_APPLICATION,s).then((function(i){if(i.response_status.status_code!==n.serviceConstants.STATUS_CODES.SUCCESS)throw n.$log.error("Update MF application response error:",i),i;return i.confirmation&&(t.confirmation||(t.confirmation={}),(0,a.default)(t.confirmation,i.confirmation)),"update"===e?n.$log.debug("MF applicaton is updated"):"submit"===e&&n.$log.debug("MF applicaton is submitted"),i})).catch((function(t){throw n.$log.error("Update MF application error:",t),t}))}},{key:"_setEmploymentInfo",value:function(t){var e=this.mutualFundRequest.application.detail_info[0];e.employer_detail={},e.employer_detail.occupation=this.employmentStatusConstants.WS_CODES[t.employmentStatus.code],t.employmentIndustry&&(e.employer_detail.industry=t.employmentIndustry.code,e.employer_detail.employer_name=t.companyName,e.employer_detail.occup_description=this._occupationCodesToString(null,t.employmentIndustry.code,t.employmentOccupation.code),e.employer_detail.employer_adress={appartment:t.companyAddress.suite,city:t.companyAddress.city,state:t.companyAddress.province,country:t.companyAddress.country,street_number:t.companyAddress.street_number,street_name:t.companyAddress.address_line1,postal_code:t.companyAddress.postal_code})}},{key:"_setNumberOfDependents",value:function(t){t.numberOfDependents&&(this.mutualFundRequest.application.applicants[0].number_of_dependant=t.numberOfDependents)}},{key:"_setEmploymentInfoInverse",value:function(t,e,n){var a=this;t.employment_status&&angular.isString(t.employment_status)&&(t.employment_status={code:t.employment_status}),t.companyName=e.employer_name,t.employmentIndustry=t.employmentIndustry||{},t.employmentOccupation=t.employmentOccupation||{},t.employmentStatus=t.employmentStatus||{};var s=this._getOccupationStringCodes(e.occup_description);s&&(t.employmentIndustry.code=s[0],t.employmentOccupation.code=s[1]),t.employmentStatus.code=(0,i.default)(this.employmentStatusConstants.WS_CODES).find((function(t){return a.employmentStatusConstants.WS_CODES[t]===e.occupation})),t.companyAddress=t.companyAddress||{};var r=t.companyAddress,o=e.employer_adress;r.address_line1=o.street_name,r.city=o.city,r.country=o.country,r.postal_code=o.postal_code,r.province=o.state,r.street_number=o.street_number,r.suite=o.appartment,t.numberOfDependents=n.number_of_dependant}},{key:"_setIntendedUse",value:function(t){var e=t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.MUTUAL_FUND_RSP;if(t.intendedUse)this.mutualFundRequest.legal_instructions.intended_account_use=t.intendedUse;else{var n=e?"RETSA":"LONIN";this.mutualFundRequest.legal_instructions.intended_account_use=n}t.otherIntendedUse&&(this.mutualFundRequest.legal_instructions.other_intended_use=t.otherIntendedUse)}},{key:"_setThirdPartyInfo",value:function(t,e){var n=this.mutualFundRequest.legal_instructions;n.third_party=void 0!==e.tpi_required&&e.tpi_required,e.tpi_required&&(n.third_party_info={},n.third_party_info.relationship=e.third_party_info.relationship,n.third_party_info.relationship_other=e.third_party_info.relationship_other,n.third_party_info.type=e.third_party_info.type,e.third_party_info.type===this.tpiFormConstants.TYPES.INDIVIDUAL?n.third_party_info.person_info={birth_date:e.third_party_info.person_info.birth_date,first_name:e.third_party_info.person_info.first_name,industry:e.third_party_info.person_info.industry,last_name:e.third_party_info.person_info.last_name,occupation:e.third_party_info.person_info.occupation,title:e.third_party_info.person_info.title}:e.third_party_info.type===this.tpiFormConstants.TYPES.BUSINESS&&(n.third_party_info.corporate_info={incorporation_number:e.third_party_info.corporate_info.incorporation_number,incorporation_place:e.third_party_info.corporate_info.incorporation_place,incorporation_place_other:e.third_party_info.corporate_info.incorporation_place_other,industry:e.third_party_info.corporate_info.industry,name:e.third_party_info.corporate_info.name,nature_of_business:e.third_party_info.corporate_info.nature_of_business,occupation:e.third_party_info.corporate_info.occupation,type:e.third_party_info.corporate_info.type}),n.third_party_info.address={address_line1:e.third_party_info.address.address_line1,address_type:"HOME",city:e.third_party_info.address.city,country:e.third_party_info.address.country,postal_code:e.third_party_info.address.postal_code,province:e.third_party_info.address.province,street_number:e.third_party_info.address.street_number||null,suite:e.third_party_info.address.suite})}},{key:"_setThirdPartyInfoInverse",value:function(t,e){var n=e.third_party_info;if(t.relationship=e.third_party_info.relationship,t.relationship_other=e.third_party_info.relationship_other,t.type=e.third_party_info.type,n.person_info){var i=n.person_info,a=t.person_info;a.birth_date=i.birth_date,a.first_name=i.first_name,a.last_name=i.last_name,a.industry=i.industry,a.occupation=i.occupation,a.title=i.title}if(n.corporate_info){var s=n.corporate_info,r=t.corporate_info;r.name=s.name,r.industry=s.industry,r.nature_of_business=s.nature_of_business,r.occupation=s.occupation,r.type=s.type,r.incorporation_number=t.corporate_info.incorporation_number,r.incorporation_place=t.corporate_info.incorporation_place,r.incorporation_place_other=t.corporate_info.incorporation_place_other}var o=t.address;if(o.address_type="HOME",n.address){var c=n.address;o.address_line1=c.address_line1,o.address_type=c.address_type,o.city=c.city,o.country=c.country,o.postal_code=c.postal_code,o.province=c.province,o.street_number=c.street_number,o.suite=c.suite}}},{key:"_setSpousalInfo",value:function(t){if(t.spouse.firstName){var e=this.mutualFundRequest.application.detail_info[0],n=t.spouse.sin.replace(/[^0-9]/g,"");e.spouse={},e.spouse.name={},e.spouse.name.prefix=t.spouse.title,e.spouse.name.first_name=t.spouse.firstName,e.spouse.name.last_name=t.spouse.lastName,e.spouse.DOB=this.DateService.momentToServerFormat(t.spouse.dateOfBirth),e.spouse.SIN1=n.substring(0,3),e.spouse.SIN2=n.substring(3,6),e.spouse.SIN3=n.substring(6),e.spouse.occupation=this._occupationCodesToString(t.spouse.employmentStatus.code,t.spouse.employmentIndustry?t.spouse.employmentIndustry.code:null,t.spouse.employmentOccupation?t.spouse.employmentOccupation.code:null),e.spouse.is_exist=this.mutualFundConstants.booleanValues.Y}}},{key:"_setSpousalInfoInverse",value:function(t,e){e.name&&(t.title=e.name.prefix,t.firstName=e.name.first_name,t.lastName=e.name.last_name),e.DOB&&(t.dateOfBirth=this.DateService.serverFormatToMoment(e.DOB)),t.sin=[e.SIN1,e.SIN2,e.SIN3].join(""),t.employmentStatus=t.employmentStatus||{},t.employmentIndustry=t.employmentIndustry||{},t.employmentOccupation=t.employmentOccupation||{};var n=this._getOccupationStringCodes(e.occupation);n&&n.length>=3&&(t.employmentStatus.code=n[0],t.employmentIndustry.code=n[1],t.employmentOccupation.code=n[2])}},{key:"_setSourceOfFundInfo",value:function(t,e){var n=this.mutualFundRequest.application,i=this.accountConstants.ACCOUNT_PPTS,a=this.accountConstants.ACCOUNT_TYPES,s=this.accountConstants.FUND_TYPE_CODES;if(n&&delete n.source_of_funds,e.fromAccount&&(e.fromAccount.display_name||e.fromAccount.isMagicSwitch&&e.fromAccount.request||e.fromAccount.sendCheque)){if(n.source_of_funds={},e.fromAccount.display_name&&(n.source_of_funds.account={},n.source_of_funds.account.account_number=e.fromAccount.display_name),e.fromAccount.isMagicSwitch&&e.fromAccount.request){delete n.source_of_funds.account,n.source_of_funds.transfer_info={external_account:{address:{}}};var r=e.fromAccount.request,o=n.source_of_funds.transfer_info;o.linked_application=r.linked_application||"",o.transfer_in_full=r.transfer_all,r.is_gic&&(o.redeem_early=r.redeem_early,o.gic_maturity_date=r.maturity_date);var c=n.source_of_funds.transfer_info.external_account;c.action="",c.branch_name="",c.external_account_number=r.account_number,c.institution_name=r.institution,c.product_type="",c.sequence_number="";var l=n.source_of_funds.transfer_info.external_account.address;l.address_line1=r.institution_address.address_line1,l.address_type="BUSINESS",l.city=r.institution_address.city,l.country=r.institution_address.country,l.postal_code=r.institution_address.postal_code,l.province=r.institution_address.province,l.suite=r.institution_address.suite}else delete n.source_of_funds.transfer_info;var u=n.source_of_funds;if(e.fromAccount.sendCheque)u.type_of_fund=s.CHQ;else if(e.fromAccount.isMagicSwitch)u.type_of_fund=s.CTE;else if(e.fromAccount.type===a.MUTUAL_FUND)if(e.fullAmount||e.profile_product_type!==i.MUTUAL_FUND_TFSA){if(!e.fullAmount)throw this.$log.error("MF type_of_fund setup unexpected MF source"),new Error("Expected non-TFSA MF source of funding to be full amount");u.type_of_fund=s.CTIF}else u.type_of_fund=s.TFSAP;else u.type_of_fund=s.EFT}}},{key:"_setSourceOfFundInfoInverse",value:function(t,e){if(e&&e.type_of_fund===this.accountConstants.FUND_TYPE_CODES.CTIF?t.fullAmount=!0:t.fullAmount=!1,t.fromAccounts&&e&&e.account&&e.account.account_number&&(t.fromAccount=t.fromAccounts.find((function(t){return t.display_name===e.account.account_number}))||{}),t.fromAccount||(t.fromAccount={}),t.fromAccount.request||(t.fromAccount.request={},t.fromAccount.request.institution_address={}),t.fromAccount.UIData||(t.fromAccount.UIData={},t.fromAccount.UIData.institutionAddress={},t.fromAccount.UIData.transaction={}),e&&e.transfer_info){var n=e.transfer_info,i=t.fromAccount,a=t.fromAccount.request,s=t.fromAccount.UIData;i.display_name=e.account.account_number,i.isMagicSwitch=n&&n.linked_application,i.sendCheque=e.type_of_fund===this.accountConstants.FUND_TYPE_CODES.CHQ,a.linked_application=n.linked_application,a.transfer_all=n.transfer_in_full,a.is_gic&&(a.maturity_date=n.gic_maturity_date,a.redeem_early=n.redeem_early);var r=n.external_account;s.accountNumber=a.account_number=r.external_account_number,a.institution=r.institution_name,s.institution=r.institution_name;var o=r.address,c=a.institution_address;c.address_line1=o.address_line1,c.city=o.city,c.country=o.country,c.postal_code=o.postal_code,c.province=o.province,c.suite=o.suite;var l=s.institutionAddress;l.address_line1=o.address_line1,l.city=o.city,l.country=o.country,l.postal_code=o.postal_code,l.province=o.province,l.suite=o.suite}}},{key:"_setInvestmentAmount",value:function(t,e){e.investment_amount&&(this.mutualFundRequest.application.investment_selection.investment_amount=e.investment_amount)}},{key:"_setInvestmentAmountInverse",value:function(t,e){e&&(t.investment_amount=e.investment_amount)}},{key:"upsertQuestion",value:function(t,e){var n=t.find((function(t){return t.code===e.code}));n?n.value=e.value:t.push(e)}},{key:"upsertQuestions",value:function(t,e){var n=this;e.forEach((function(e){return n.upsertQuestion(t,e)}))}},{key:"_setQuestions",value:function(t,e){var n=this.mutualFundRequest.application.detail_info[0].questions,i=this.mutualFundConstants.booleanValues;this.upsertQuestions(n,[{code:"TERM",value:e.confirmed_terms?i.Y:i.N},{code:"PRIVACY",value:e.confirmed_terms?i.Y:i.N},{code:"ESTCONSENT",value:e.confirmed_electronic_signature?i.Y:i.N},{code:"CONSENT",value:e.confirmed_electronic_signature?i.Y:i.N},{code:"EPROC",value:e.confirmed_electronic_signature?i.Y:i.N},{code:"ACK",value:e.fundFactAccepted?i.Y:i.N},{code:"LEVERDISC",value:e.confirmed_borrowed_money?i.Y:i.N},{code:"ESTPAPERLS",value:e.confirmed_e_docs?i.Y:i.N}])}},{key:"_setQuestionsInverse",value:function(t,e){var n,i,a=this;t.confirmed_borrowed_money=(n="LEVERDISC",!!(i=e.find((function(t){return t.code===n})))&&i.value===a.mutualFundConstants.booleanValues.Y)}},{key:"sendJointAccountHolderInvitation",value:function(t){var e=this,n={data:{validate_only:!1,invitation:{type:"APPLICATION",recipient_sequence_number:t.joint_account_holder.holder.sequence_number,account_id:"",deal_id:t.applicationId}}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.SEND_JOINT_ACCOUNT_HOLDER_INVITATION,n).then((function(t){if(t.response_status.status_code!==e.serviceConstants.STATUS_CODES.CREATED)throw e.$log.error("Send MF joint account invitation response error:",t),t;e.$log.debug("MF joint account invitation is sent")})).catch((function(t){throw e.$log.error("Send MF joint account holder invitation error:",t),t}))}},{key:"getSavingsAccounts",value:function(){var t=this.RequesterService,e=this.serviceConstants;return t.request(e.AVAILABLE_SERVICES.ACCOUNT_SUMMARY_SAVINGS)}},{key:"magicSwitchFundsUpgraded",get:function(){return this.MagicSwitchFlowService.magicSwitchFundsUpgraded}}]),t}();c.$inject=["AddressFormFieldsService","RequesterService","serviceConstants","$log","mutualFundConstants","accountConstants","employmentStatusConstants","tpiFormConstants","$translate","$q","MagicSwitchFlowService","DateService"],e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(177)),a=d(n(0)),s=d(n(2)),r=d(n(264)),o=d(n(266)),c=d(n(265)),l=d(n(267)),u=d(n(1908));function d(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(t,n,s,o,c,l,d,h,f,p,g){(0,a.default)(this,e);var m=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,l,d,p));return m.$window=c,m.BUTTON_TYPES=d.BUTTON_TYPES,m.AMOUNT_INPUT_TYPES=h.AMOUNT_INPUT_TYPES,m.CURRENCY_TYPES=f.CURRENCY_TYPES,m.$log=t,m.AnchorService=g,m.STATES=u.default.states,m._initialState=m.STATES.INTRO,m}return(0,c.default)(e,t),(0,s.default)(e,[{key:"resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this)}},{key:"stateHistoryCount",value:function(){return(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"stateHistoryCount",this).call(this)}},{key:"_subFlowIsDone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.stopEnrollmentFlow,a=void 0!==n&&n,s=t.submissionFailed,r=void 0!==s&&s;a?(this.deactivate(),this.flowIsDone({cancelled:!0})):r?this.flowIsDone({cancelled:!1,success:!1,response:{}}):((0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_subFlowIsDone",this).call(this),this._updateUI(!0))}},{key:"getCurrentStateKey",value:function(){return this._getCurrentStateKey()}},{key:"_getAnalyticsID",value:function(){return"mutualfund"}},{key:"_conditionalScrollToTop",value:function(){this.AnchorService.scrollToPageContentTop()}},{key:"setBuyFundsHasBorrowedMoney",value:function(t){this._buyFundsHasBorrowedMoney=t}},{key:"setBorrowedMoneyFrom",value:function(t){this._borrowedMoneyFrom=t}},{key:"setBorrowedMoneyAgreement",value:function(t){this._borrowedMoneyAgreementAccepted=!!t}},{key:"buyFundsHasBorrowedMoney",get:function(){return this._buyFundsHasBorrowedMoney}},{key:"borrowedMoneyFrom",get:function(){return this._borrowedMoneyFrom}},{key:"borrowedMoneyAgreement",get:function(){return this._borrowedMoneyAgreementAccepted}}]),e}(l.default);h.$inject=["$log","$q","$transitions","$state","$window","$rootScope","pageFlowConstants","amountInputConstants","accountConstants","AnalyticsService","AnchorService"],e.default=h,t.exports=e.default},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=f(n(15)),a=f(n(68)),s=f(n(365)),r=f(n(8)),o=f(n(0)),c=f(n(2)),l=f(n(1896)),u=n(1898),d=f(n(272)),h=f(n(1983));function f(t){return t&&t.__esModule?t:{default:t}}var p=function(){function t(e,n,i,a,s,r,c,u,d,h){(0,o.default)(this,t),this.$log=e,this.RequesterService=a,this.ReferenceDataService=r,this.referenceDataConstants=c,this.serviceConstants=s,this.$q=n,this.accountHelpersService=u,this.tpiFormConstants=d,this.maskNumberFilter=i("maskNumber"),this.translateFilter=i("translate"),this.currencyFilter=i("currency"),this.AccountPayload=new l.default(this.tpiFormConstants),this.SERVICES=this.serviceConstants.AVAILABLE_SERVICES,this.internalCustomerAccounts=[],this.ADDRESS_STATUS_CODES=h.ADDRESS_STATUS_CODES,this.ExistingClientOnboardingConstants=h}return(0,c.default)(t,[{key:"getReferenceData",value:function(t){var e=this,n=[this.referenceDataConstants.TYPES.ASSETS,this.referenceDataConstants.TYPES.LIABILITIES,t.isMortgageOrHeloc?this.referenceDataConstants.TYPES.INCOME_MORTGAGE:this.referenceDataConstants.TYPES.INCOME,this.referenceDataConstants.TYPES.INCOME_FREQUENCY,this.referenceDataConstants.TYPES.EMPLOYMENT_STATUSES,this.referenceDataConstants.TYPES.INDUSTRY_OCCUPATIONS,this.referenceDataConstants.TYPES.MARITAL_STATUS,this.referenceDataConstants.TYPES.ADDRESS_STATUS];return t.isMortgageOrHeloc&&n.push(this.referenceDataConstants.TYPES.INTENDED_USE_ACCOUNT),this.ReferenceDataService.getDataByType(n).then((function(n){t.externalAssetTypes=n[e.referenceDataConstants.TYPES.ASSETS],t.externalLiabilityTypes=n[e.referenceDataConstants.TYPES.LIABILITIES],n[e.referenceDataConstants.TYPES.INCOME_MORTGAGE]?t.incomeTypes=n[e.referenceDataConstants.TYPES.INCOME_MORTGAGE]:t.incomeTypes=n[e.referenceDataConstants.TYPES.INCOME],t.incomeFrequencyTypes=n[e.referenceDataConstants.TYPES.INCOME_FREQUENCY],t.employmentStatuses=n[e.referenceDataConstants.TYPES.EMPLOYMENT_STATUSES],t.industriesOccupations=n[e.referenceDataConstants.TYPES.INDUSTRY_OCCUPATIONS],t.maritalStatusOptions=n[e.referenceDataConstants.TYPES.MARITAL_STATUS],n[e.referenceDataConstants.TYPES.INTENDED_USE_ACCOUNT]&&(t.intendedUseOptions=n[e.referenceDataConstants.TYPES.INTENDED_USE_ACCOUNT].find((function(t){return t.code===e.referenceDataConstants.INTENDED_USE_CODES.MORT_WEB})).data);var i=n[e.referenceDataConstants.TYPES.ADDRESS_STATUS],a=i.find((function(t){return t.code===e.ADDRESS_STATUS_CODES.RENT})),s=i.find((function(t){return t.code===e.ADDRESS_STATUS_CODES.OWN})),r=i.find((function(t){return t.code===e.ADDRESS_STATUS_CODES.LIVE_WITH_PARENTS}));a.name=e.translateFilter("rspLoan.homeStatus.options.rent"),s.name=e.translateFilter("rspLoan.homeStatus.options.own"),r.name=e.translateFilter("rspLoan.homeStatus.options.parents"),t.addressStatusOptions=[a,s,r]})).catch((function(t){throw e.$log.error("Loan service - get reference data error:",t),t}))}},{key:"getFullAssetLiabilityTypes",value:function(t){var e=this;return this.RequesterService.request(this.SERVICES.GET_FULL_ASSET_LIABILITY_TYPES).then((function(n){if(n.response_status.status_code!==e.serviceConstants.STATUS_CODES.SUCCESS)throw e.$log.error("Loan Service - getting full asset/liability types - error:",n),n;t.assetTypes=n.reference_data.find((function(t){return t.type===e.referenceDataConstants.TYPES.ASSETS})).data,t.liabilityTypes=n.reference_data.find((function(t){return t.type===e.referenceDataConstants.TYPES.LIABILITIES})).data})).catch((function(t){throw e.$log.error("Loan Service - getting full asset/iability types - error:",t),t}))}},{key:"getInternalCustomerAccounts",value:function(){var t=this;return this.RequesterService.request(this.SERVICES.GET_INTERNAL_CUSTOMER_ACCOUNTS).then((function(e){if(e.response_status.status_code!==t.serviceConstants.STATUS_CODES.SUCCESS&&e.response_status.status_code!==t.serviceConstants.STATUS_CODES.NO_DATA)throw t.$log.error("Loan Service - getInternalCustomerAccounts response error:",e),e;t.internalCustomerAccounts=e.accounts?e.accounts:[]})).catch((function(e){throw t.$log.error("Loan Service - getInternalCustomerAccounts error:",e),e}))}},{key:"_convertAssetOrLiabilityData",value:function(t){if(t.type===u.ASSET_CODES.REAL_ESTATE||t.type===u.LIABILITY_CODES.MORTGAGE_RENT)return{displayName:t.address,currency:d.default.CAD};var e=this.internalCustomerAccounts.find((function(e){return e.display_name===t.financial_institution}));return{displayName:e?this.getAccountDisplayName(e):t.financial_institution,currency:e?e.currency_type:d.default.CAD}}},{key:"getAccountDisplayName",value:function(t){return(t.accountName||this.accountHelpersService.getDisplayNameInstant(t)||t.description)+" "+this.maskNumberFilter(t.display_name||t.number)}},{key:"_mapAssetFrontEndToBackEnd",value:function(t){var e=t.asset?t.asset:{};switch((0,r.default)(e,{value:t.value,type:t.type.code}),t.type.code){case u.ASSET_CODES.REAL_ESTATE:e.address=t.description;break;default:e.financial_institution=t.description}return e}},{key:"_mapLiabilityFrontEndToBackEnd",value:function(t){var e=t.liability?t.liability:{};switch((0,r.default)(e,{balance:t.value,type:t.type.code,monthly_payment:t.minMonthlyPayment}),t.type.code){case u.LIABILITY_CODES.MORTGAGE_RENT:e.address=t.description;break;default:e.financial_institution=t.description}return e}},{key:"_processAssetsFromService",value:function(t,e,n){var i=this;t.internalAssets||(t.internalAssets=e.map((function(e){var n=i._convertAssetOrLiabilityData(e);return new h.default({type:t.assetTypes.find((function(t){return t.code===e.type})),description:n.displayName,value:e.value,currency:n.currency})}))),t.externalAssets=n.map((function(e){var n=new h.default({type:t.assetTypes.find((function(t){return t.code===e.type})),description:i._convertAssetOrLiabilityData(e).displayName,value:e.value});return n.asset=e,n}))}},{key:"_processLiabilitiesFromService",value:function(t,e,n){var i=this;t.internalLiabilities||(t.internalLiabilities=e.map((function(e){return new h.default({type:t.liabilityTypes.find((function(t){return t.code===e.type})),description:i._convertAssetOrLiabilityData(e).displayName,value:e.balance,minMonthlyPayment:e.monthly_payment})}))),t.externalLiabilities=n.map((function(e){var n=new h.default({type:t.liabilityTypes.find((function(t){return t.code===e.type})),description:i._convertAssetOrLiabilityData(e).displayName,value:e.balance,minMonthlyPayment:e.monthly_payment});return n.liability=e,n}))}},{key:"_setUpAdditionalIncome",value:function(t,e){var n=this;if(e){var i=e.filter((function(t){return!(t.employer_sequence_num&&-1!==(0,s.default)(n.ExistingClientOnboardingConstants.EMPLOYER_INCOME).indexOf(t.income_source))}));i.length>0&&(t.additionalIncomeSources=[],t.otherIncomeSources=!0),i.forEach((function(e){t.additionalIncomeSources.push({sequenceNumber:e.sequence_number?e.sequence_number:null,amount:e.income_amount,incomeType:t.incomeTypes.find((function(t){return t.code===e.income_source})),sourceName:e.description,frequency:t.incomeFrequencyTypes.find((function(t){return t.code===e.frequency})),employerSequenceNumber:e.employer_sequence_num?e.employer_sequence_num:null})}))}}},{key:"_setupEmployerUIModel",value:function(t,e,n,i){var a=this;e.sequence_number&&(t.sequenceNumber=e.sequence_number),e.employer_name&&(t.employerName=e.employer_name),e.years_in_line_of_bus&&(t.industryYears=e.years_in_line_of_bus),(e.years_of_employment||0===e.years_of_employment)&&(t.workDurationYears={key:e.years_of_employment,value:i.yearOptions.find((function(t){return t.key===e.years_of_employment})).value}),e.months_of_employment&&(t.workDurationMonths={key:e.months_of_employment,value:i.monthOptions.find((function(t){return t.key===e.months_of_employment})).value}),e.employer_adress&&(t.employerAddress=angular.copy(e.employer_adress),t.employerAddress.address_line1=t.employerAddress.street_name,e.employer_adress.state&&e.employer_adress.country===this.ExistingClientOnboardingConstants.CANADA_CTRY_CODE&&(t.employerAddress.province=e.employer_adress.state,delete t.employerAddress.state),e.employer_adress.appartment&&(t.employerAddress.suite=e.employer_adress.appartment,delete t.employerAddress.appartment)),e.employer_contact_phone&&(e.employer_contact_phone.phone_number&&(t.number=e.employer_contact_phone.phone_number),e.employer_contact_phone.extension&&(t.extension=e.employer_contact_phone.extension)),n.filter((function(e){return e.employer_sequence_num===t.sequenceNumber&&-1!==(0,s.default)(a.ExistingClientOnboardingConstants.EMPLOYER_INCOME).indexOf(e.income_source)})).sort((function(t,e){return t.income_source===a.ExistingClientOnboardingConstants.EMPLOYER_INCOME.BONUS?1:e.income_source===a.ExistingClientOnboardingConstants.EMPLOYER_INCOME.BONUS?-1:t.income_source.localeCompare(e.income_source)})).forEach((function(e){e.income_source&&e.income_source!==a.ExistingClientOnboardingConstants.EMPLOYER_INCOME.BONUS?(e.income_amount&&(t.incomeWithoutBonus=e.income_amount),t.incomeWithoutBonusSequenceNumber=e.sequence_number,t.incomeWithoutBonusDescription=e.description,t.incomeWithoutBonusFrequency=e.frequency):e.income_source&&(e.income_amount&&(t.incomeBonus=e.income_amount),t.incomeBonusSequenceNumber=e.sequence_number,t.incomeBonusDescription=e.description,t.incomeBonusFrequency=e.frequency)}))}},{key:"_setupAddressInfoUIModel",value:function(t,e){var n=void 0;if(t.addressType===this.ExistingClientOnboardingConstants.ADDRESS_TYPES.CURRENT)e.crtAddressInfo||(e.crtAddressInfo={}),n=e.crtAddressInfo;else{if(t.addressType!==this.ExistingClientOnboardingConstants.ADDRESS_TYPES.PREVIOUS)return void this.$log.error("Loan Service - APP _setupAddressInfoUIModel: invalid addressType",t.addressType);e.prevAddressInfo||(e.prevAddressInfo={}),n=e.prevAddressInfo}t.home_status&&(n.addressStatus=e.addressStatusOptions.find((function(e){return e.code===t.home_status}))),(t.dur_year||t.dur_month)&&(n.livingDuration={year:t.dur_year,month:t.dur_month});var i=this.ExistingClientOnboardingConstants.ADDRESS_LINE1_PATTERN.exec(t.addressLine1);n.address={address_line1:i?i[2]:t.addressLine1,address_line2:t.addressLine2,street_number:i?i[1]:null,suite:t.suite,city:t.city,country:t.country,province:t.state,postal_code:t.postalCode}}},{key:"getYearMonthOptions",value:function(t){var e=this;t.yearOptions=Array(100).fill(0).map((function(t,n){var i=1===n?"global.year":"global.years";return{key:n,value:n+" "+e.translateFilter(i)}})),t.monthOptions=Array(12).fill(0).map((function(t,n){var i=1===n?"global.month":"global.months";return{key:n,value:n+" "+e.translateFilter(i)}}))}},{key:"cleanAdditionalIncomeObject",value:function(t){-1===(0,s.default)(this.ExistingClientOnboardingConstants.ADDITIONAL_INCOMES_LINK_TO_EMPLOYER).indexOf(t.incomeType.code)&&t.employerSequenceNumber&&delete t.employerSequenceNumber,t.sequenceNumber&&delete t.sequenceNumber}},{key:"generateAddressPayload",value:function(t,e){return{addressType:e?this.ExistingClientOnboardingConstants.ADDRESS_TYPES.CURRENT:this.ExistingClientOnboardingConstants.ADDRESS_TYPES.PREVIOUS,addressLine1:t.address.street_number+" "+t.address.address_line1,addressLine2:t.address.address_line2,suite:t.address.suite,city:t.address.city,country:t.address.country,state:t.address.province,postalCode:t.address.postal_code}}},{key:"generateAddressDisplayText",value:function(t,e){return t?(t.suite?this.translateFilter(e,{suite:t.suite}):"")+" "+(t.street_number?t.street_number:"")+" "+(t.address_line1?t.address_line1:"")+"<br>\n       "+(t.city?t.city+",":"")+" "+(t.province?t.province:"")+"<br>\n       "+(t.country?t.country+",":"")+" "+(t.postal_code?t.postal_code:""):""}},{key:"generateBooleanDisplayText",value:function(t){return!0===t?this.translateFilter("global.yes"):!1===t?this.translateFilter("global.no"):""}},{key:"generateAdditionalIncomeDisplayText",value:function(t){var e=this,n=t.otherIncomeSources,i=t.additionalIncomeSources,s=t.incomeTypes;return n||i?s.reduce((function(t,n){var s=i.filter((function(t){return n.code===t.incomeType.code})).reduce((function(t,e){return t+parseFloat(e.amount)*parseFloat(e.frequency?e.frequency.code:1)}),0);return s?[].concat((0,a.default)(t),[{label:n.name,html:e.currencyFilter(s)}]):t}),[]):null}},{key:"generateAggregationDisplayText",value:function(t,e){var n=this;return(0,i.default)(e).reduce((function(i,s){var r=t.filter((function(t){return-1!==e[s].codes.indexOf(t.loanType?t.loanType.code:t.type.code?t.type.code:t.type)})).reduce((function(t,e){return t+parseFloat(e.value?e.value:e.amount)}),0);return r?[].concat((0,a.default)(i),[{label:n.translateFilter(e[s].localizationCode),html:n.currencyFilter(r)}]):i}),[])}}]),t}();e.default=p,t.exports=e.default},,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2176)),a=s(n(2179));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("tangerine.app.core.components.plaidLoginBasic",[]).component("tngPlaidLoginBasic",i.default).constant("PlaidLoginBasicConstants",a.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2177)),a=s(n(2178));function s(t){return t&&t.__esModule?t:{default:t}}var r={template:i.default,controller:a.default,bindings:{callerId:"<?",productTypes:"<",onReferenceIdReceived:"&",onExit:"&?",onError:"&?",onEvent:"&?",openPlaidOnInit:"<?",exposeOpenPlaidFunction:"&?",exposeClosePlaidFunction:"&?",onPublicTokenReceivedOverride:"&?",isConsentGiven:"<",publicToken:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports=" <div class=\"c-plaid-login-basic\"> <div> <div ng-show=\"false\" id=\"div1\">{{$ctrl.plaidCfg}}</div> </div> <input id=\"public_token\" ng-show=\"false\" ng-model=\"$ctrl.plaidPublicToken\" ng-change=\"$ctrl.onTokenChanged()\" class=\"input\" type=\"text\"/> <input id=\"metadata\" ng-show=\"false\" ng-model=\"$ctrl.metadata\" class=\"input\" type=\"text\"/> <script src=\"https://cdn.plaid.com/link/v2/stable/link-initialize.js\"><\/script> <script ng-if=\"$ctrl.triggerAA\"> (function($) {\n      var ctrlscope = angular.element(\"#div1\").scope();\n      var plaidCfg = ctrlscope['$ctrl'].plaidCfg;\n      var handler = Plaid.create({\n        apiVersion: plaidCfg.apiVersion,\n        clientName: plaidCfg.clientName,\n        env: plaidCfg.env,\n        product: plaidCfg.product,\n        language: plaidCfg.language,\n        key: plaidCfg.key,\n        countryCodes: plaidCfg.countryCodes,\n        token: plaidCfg.token,\n        // webhook: 'https://your-domain.tld/plaid-webhook',\n        onSuccess: function (public_token, metadata) {\n          ctrlscope['$ctrl'].metadata = metadata;\n          ctrlscope['$ctrl'].plaidPublicToken = public_token;\n          $('#public_token').val(public_token).trigger('input'); // ios app\n          $('#metadata').val(metadata).trigger('input'); // ios app\n          ctrlscope['$ctrl'].onTokenChanged(); // IE\n        },\n        onExit: function (error, metadata) {\n          ctrlscope['$ctrl'].error = error;\n          ctrlscope['$ctrl'].metadata = metadata;\n          ctrlscope['$ctrl'].onExitFromAA();\n        },\n        onEvent: function(eventName, metadata) {\n          if (typeof ctrlscope['$ctrl'].onEvent === 'function' ){\n            ctrlscope['$ctrl'].onEvent({eventName, metadata});\n          }\n        },\n      });\n      ctrlscope['$ctrl'].handler = handler;\n      handler.open();\n      ctrlscope['$ctrl'].triggerAA = false;\n    })(jQuery); <\/script> </div> "},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c){(0,i.default)(this,t),this.$log=e,this.EnvironmentService=n,this.localeConstants=a,this.LocaleService=s,this.PlaidLoginBasicConstants=r,this.AccountAggregationService=o,this.$timeout=c}return(0,a.default)(t,[{key:"$onInit",value:function(){this.selectedProductTypes=this.productTypes||this.PlaidLoginBasicConstants.DEFAULT_PRODUCTS,this.exposeOpenPlaidFunction&&this.exposeOpenPlaidFunction({openPlaid:this.openPlaid.bind(this)}),this.exposeClosePlaidFunction&&this.exposeClosePlaidFunction({closePlaid:this.closePlaid.bind(this)}),!1!==this.openPlaidOnInit&&this.openPlaid()}},{key:"openPlaid",value:function(){var t=this;this.handler?this.handler.open():(this.plaidCfg=this.initPlaidConfig(),this.$timeout((function(){t.triggerAA=t.isConsentGiven}),1e3))}},{key:"closePlaid",value:function(){this.handler&&this.handler.exit({force:!0})}},{key:"initPlaidConfig",value:function(){var t=this.EnvironmentService.getPlaidConfig().countryCodes&&this.EnvironmentService.getPlaidConfig().countryCodes.length>0?this.EnvironmentService.getPlaidConfig().countryCodes:["CA"],e=this.EnvironmentService.getPlaidConfig().apiVersion,n=this.EnvironmentService.getPlaidConfig().clientName,i=this.EnvironmentService.getPlaidConfig().env,a=this.selectedProductTypes,s=this.EnvironmentService.getPlaidConfig().publicKey,r=this.localeConstants.SHORTHAND_LOCALE[this.LocaleService.locale],o=this.publicToken;return this.plaidCfg={apiVersion:e,clientName:n,env:i,product:a,language:r,key:s,countryCodes:t,token:o},this.$log.log("plaid config sent:",this.plaidCfg),this.plaidCfg}},{key:"onTokenChanged",value:function(){var t=this;this.$timeout((function(){if(!t.tokenChanged&&t.plaidPublicToken&&t.metadata){t.tokenChanged=!0,t.$log.debug("plaidPublicToken received:",t.plaidPublicToken);var e=t.plaidPublicToken,n=t.metadata;t.onPublicTokenReceivedOverride?t.onPublicTokenReceivedOverride({token:e,metadata:n}):t.onPublicTokenReceived({token:e,metadata:n})}}),300)}},{key:"onPublicTokenReceived",value:function(t){var e=this,n=t.token,i=t.metadata;this.$log.log("Plaid token:",n);var a=i.institution.institution_id,s=i.link_session_id;return this.AccountAggregationService.postAccountAggregationAuthorization(n,a,s,this.callerId).then((function(t){if(!t.reference_id)throw new Error(t);return e.onReferenceIdReceived({referenceId:t.reference_id}),t.reference_id})).catch((function(t){e.$log.error("Failed to get referenceId for Plaid authorization.",t)}))}},{key:"onExitFromAA",value:function(){var t=this.error,e=this.metadata;this.onExit({error:t,metadata:e})}}]),t}();r.$inject=["$log","EnvironmentService","localeConstants","LocaleService","PlaidLoginBasicConstants","AccountAggregationService","$timeout"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={AUTH:"auth",TRANSACTIONS:"transactions",INCOME:"income",IDENTITY:"identity",ASSETS:"assets",INVESTMENTS:"investments"},a=[i.AUTH,i.IDENTITY,i.TRANSACTIONS];e.default={PRODUCT_TYPES:i,PLAID_EVENTS:{ERROR:"ERROR",EXIT:"EXIT",HANDOFF:"HANDOFF",OPEN:"OPEN",SELECT_INSTITUTION:"SELECT_INSTITUTION",SUBMIT_CREDENTIALS:"SUBMIT_CREDENTIALS",TRANSITION_VIEW:"TRANSITION_VIEW"},DEFAULT_PRODUCTS:a},t.exports=e.default},,,,,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(2191)),a=c(n(2195)),s=c(n(2200)),r=c(n(1902)),o=c(n(2201));function c(t){return t&&t.__esModule?t:{default:t}}var l=angular.module("ExternalAccountsModule",[a.default.name]).component("tngSettingsExternalAccounts",i.default).service("ExternalAccountsService",s.default).service("AddExternalAccountFlowService",r.default).constant("externalAccountsConstants",o.default);e.default=l,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2192)),a=s(n(2193));function s(t){return t&&t.__esModule?t:{default:t}}n(2194);var r={template:i.default,controller:a.default,bindings:{}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-external-accounts"> <tng-error-message ng-show="$ctrl.submitErrors.length > 0"> <ul> <li ng-repeat="error in $ctrl.submitErrors"> {{error}} </li> </ul> </tng-error-message> <p translate-cloak class="c-general__description body--2" ng-if="!$ctrl.cifTypeService.isChild()"> <span tng-hide-kyc-pending>{{ \'userSettings.externalAccounts.youCanHave\' | translate}}</span> <span tng-show-kyc-pending>{{ \'userSettings.externalAccounts.youCanHaveKycPending\' | translate}}</span> </p> <p translate-cloak class="c-general__description body--2" ng-if="$ctrl.cifTypeService.isChild()"> <span tng-hide-kyc-pending>{{ \'userSettings.externalAccounts.yourChildCanHave\' | translate}}</span> <span tng-show-kyc-pending>{{ \'userSettings.externalAccounts.youCanHaveKycPending\' | translate}}</span> </p> <div ng-show="$ctrl.isLoading" class="c-external-accounts__loading"> <tng-loading-in-progress></tng-loading-in-progress> <div class="c-loading" translate-cloak>{{ \'billPay.states.interstitialLoadingState\' | translate }}</div> </div> <table ng-if="$ctrl.accounts.length > 0" class="table table--full c-external-accounts__table" ng-hide="$ctrl.isLoading"> <thead> <tr> <th class="c-external-accounts__mobile" translate-cloak>{{ \'userSettings.externalAccounts.account\' | translate}}</th> <th class="c-external-accounts__hide-mobile" translate-cloak>{{ \'userSettings.externalAccounts.transitNumber\' | translate}}</th> <th class="c-external-accounts__hide-mobile" translate-cloak>{{ \'userSettings.externalAccounts.currency\' | translate}}</th> <th class="c-external-accounts__hide-mobile" translate-cloak>{{ \'userSettings.externalAccounts.status\' | translate}}</th> <th></th> </tr> </thead> <tbody id="userSettings-externalAccounts"> <tr ng-repeat="account in $ctrl.accounts track by $index"> <td class="c-external-accounts__table-column-mobile-contact"> {{::account.institution_description | camelCaseType}} <div class="table__quiet CB_DataMask">{{::account.account_number}}</div> <div class="table__quiet c-external-accounts__table-column-mobile CB_DataMask">{{::account.transit_number}}</div> <div class="table__quiet c-external-accounts__table-column-mobile">{{::account.currency}}</div> <div class="table__quiet c-external-accounts__table-column-mobile"> <span ng-if="account.status === $ctrl.STATUS.COM" translate-cloak> {{ \'userSettings.externalAccounts.linked\' | translate}} </span> <span ng-if="account.status === $ctrl.STATUS.CAN" translate-cloak> {{ \'userSettings.externalAccounts.cancelled\' | translate}} </span> <span ng-if="$ctrl.isAccountPending(account)" translate-cloak> {{ \'userSettings.externalAccounts.pending\' | translate}} </span> </div> </td> <td class="c-external-accounts__hide-mobile"> <div class="table__quiet CB_DataMask">{{::account.transit_number}}</div> </td> <td class="c-external-accounts__hide-mobile"> <div class="table__quiet">{{::account.currency}}</div> </td> <td class="c-external-accounts__hide-mobile"> <div class="table__quiet"> <span ng-if="account.status === $ctrl.STATUS.COM" translate-cloak> {{ \'userSettings.externalAccounts.linked\' | translate}} </span> <span ng-if="account.status === $ctrl.STATUS.CAN" translate-cloak> {{ \'userSettings.externalAccounts.cancelled\' | translate}} </span> <span ng-if="$ctrl.isAccountPending(account)" translate-cloak> {{ \'userSettings.externalAccounts.pending\' | translate}} </span> <span ng-if="$ctrl.isAccountFailed(account)" translate-cloak> {{ \'userSettings.externalAccounts.failed\' | translate}} </span> <span ng-if="$ctrl.isAccountFailedConfirmation(account)" translate-cloak> {{ \'userSettings.externalAccounts.failed_confirmation\' | translate}} </span> </div> </td> <td> <button actionable-id="external-accounts-delete_external" class="btn btn--large btn--warn c-external-accounts__button-table CB_ReadOnly" ng-if="$ctrl.shouldShowDelete(account)" ng-click="$ctrl.deleteExternalAccount(account)" translate-cloak> {{ \'userSettings.externalAccounts.delete\' | translate}} </button> <button actionable-id="external-accounts-cancel_external" class="btn btn--large btn--edit c-external-accounts__button-table CB_ReadOnly" ng-if="$ctrl.shouldShowCancel(account)" ng-click="$ctrl.cancelExternalAccount(account)" translate-cloak> {{ \'userSettings.externalAccounts.cancel\' | translate}} </button> <button actionable-id="external-accounts-verify_external" class="btn btn--large btn--edit c-external-accounts__button-table CB_ReadOnly" ng-if="$ctrl.shouldShowConfirm(account)" ng-click="$ctrl.verifyExternalAccount(account)" translate-cloak> {{ \'userSettings.externalAccounts.verify\' | translate}} </button> </td> </tr> </tbody> </table> <button actionable-id="external-accounts-add_external" ng-if="$ctrl.hasExternalLinCapability() && $ctrl.canAddAccount()" ng-hide="$ctrl.isLoading" class="btn btn--large btn--edit-dark c-external-accounts__button-add" ng-click="$ctrl.showAddExternalAccountModal()" translate-cloak> {{ \'userSettings.externalAccounts.addAccount\' | translate}} </button> <p ng-if="!$ctrl.hasExternalLinCapability()"> {{ \'userSettings.externalAccounts.newLinkedAccount\' | translate}} </p> <tng-add-external-account-modal ng-if="$ctrl.showAddExternalAccount" initial-step="$ctrl.initialStep" check-account="$ctrl.account" pending-transactions="$ctrl.pendingTransactions" on-close="$ctrl.closeExternalAccountModal(result)" delete-account="$ctrl.deleteAccount(account)"> </tng-add-external-account-modal> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u){(0,i.default)(this,t),this.cifTypeService=l,this.$log=e,this.$translate=r,this.externalAccountsService=n,this.addExternalAccountFlowService=s,this.externalAccountsConstants=a,this.STATUS=this.externalAccountsConstants.STATUS,this.userService=u,this.capabilities=[],this.$state=o,this.stateConstants=c}return(0,a.default)(t,[{key:"$onInit",value:function(){this.showAddExternalAccount=!1,this._getAccounts(),this._getCapabilities(),this.isLoading=!1,this.submitErrors=[]}},{key:"showAddExternalAccountModal",value:function(){this.initialStep=this.addExternalAccountFlowService.STATES.ADD_ACCOUNT,this.showAddExternalAccount=!0}},{key:"cancelExternalAccount",value:function(t){this.initialStep=this.addExternalAccountFlowService.STATES.CANCEL,this.showAddExternalAccount=!0,this.account=t}},{key:"verifyExternalAccount",value:function(t){this.initialStep=this.addExternalAccountFlowService.STATES.VERIFY,this.showAddExternalAccount=!0,this.account=t}},{key:"closeExternalAccountModal",value:function(){this.showAddExternalAccount=!1}},{key:"hasExternalLinCapability",value:function(){return-1!==this.capabilities.indexOf("EXTERNAL_LINK_ADD")}},{key:"canAddAccount",value:function(){return angular.isDefined(this.accounts)&&this.accounts.length<3}},{key:"shouldShowConfirm",value:function(t){return this.cifTypeService.isNormal()&&t.status===this.STATUS.PENCF}},{key:"shouldShowCancel",value:function(t){return this.cifTypeService.isNormal()&&t.status!==this.STATUS.COM&&t.status!==this.STATUS.FAIL&&t.status!==this.STATUS.FAILC&&t.status!==this.STATUS.CONF&&t.status!==this.STATUS.CAN}},{key:"shouldShowDelete",value:function(t){return(this.cifTypeService.isNormal()||this.cifTypeService.isBusiness())&&-1!==[this.STATUS.CAN,this.STATUS.COM,this.STATUS.CONF,this.STATUS.FAIL,this.STATUS.FAILC].indexOf(t.status)}},{key:"deleteExternalAccount",value:function(t){var e=this;return this.isLoading=!0,this.externalAccountsService.fetchPendingTransactions(t.sequence).then((function(n){e.$log.debug("DELETE ACCOUNT RESPONSE: ",n),e.isLoading=!1,e.$log.debug("Delete account fetch pending transactions: ",n),n.pending_transactions&&n.pending_transactions.length,e.initialStep=e.addExternalAccountFlowService.STATES.DELETE,e.showAddExternalAccount=!0,e.account=t,e.pendingTransactions=n.pending_transactions,e.pendingTransactions.institution_description=t.institution_description,e.isLoading=!1})).catch((function(t){e.isLoading=!1,e.$log.debug("ERROR IN RESPONSE CATCH: ",t),e._showSubmitErrors(t)}))}},{key:"deleteAccount",value:function(t){var e=this;return this.isLoading=!0,this.externalAccountsService.deleteAccount(t).then((function(t){return e.isLoading=!1,e.$log.debug("Delete response: ",t),t}))}},{key:"isAccountPending",value:function(t){return t.status===this.STATUS.PENCF||t.status===this.STATUS.PEN||t.status===this.STATUS.SUB||t.status===this.STATUS.NEW}},{key:"isAccountFailed",value:function(t){return t.status===this.STATUS.FAIL}},{key:"isAccountFailedConfirmation",value:function(t){return t.status===this.STATUS.FAILC}},{key:"_getAccounts",value:function(){var t=this;this.externalAccountsService.fetchAccounts().then((function(){t.accounts=t.externalAccountsService.accounts||[]})).catch((function(e){return t._showSubmitErrors(e)}))}},{key:"_getCapabilities",value:function(){var t=this;this.userService.getCapabilities().then((function(e){t.capabilities=e.capabilities}))}},{key:"_showSubmitErrors",value:function(t){var e=this.submitErrors;this.$log.debug("ERROR IN RESPONSE: ",t),"errorMessage"in t&&e.push(t.errorMessage),t.response_status&&"details"in t.response_status&&t.response_status.details.forEach((function(t){e.push(t)})),t.response_status&&"status_code"in t.response_status&&"return_code"in t.response_status&&-1===["CREATED","SUCCESS"].indexOf(t.response_status.status_code)&&e.push(this.$translate.instant("global.errorCodes."+t.response_status.return_code)),this.$log.debug("formatted error:",e),this.isLoading=!1}}]),t}();r.$inject=["$log","ExternalAccountsService","externalAccountsConstants","AddExternalAccountFlowService","$translate","$state","stateConstants","CifTypeService","UserService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2196)),a=s(n(1902));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("AddExternalAccountModalModule",[]).component("tngAddExternalAccountModal",i.default).service("AddExternalAccountModalServiceFlow",a.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2197)),a=s(n(2198));function s(t){return t&&t.__esModule?t:{default:t}}n(2199);var r={template:i.default,controller:a.default,bindings:{onClose:"&",initialStep:"<",checkAccount:"<",pendingTransactions:"<",deleteAccount:"&",isOnboarding:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog class="c-add-external-account-modal" on-close="$ctrl.onModalClose(result)" hide-close="$ctrl.isLoadingMode" flow-service="$ctrl.flowService"> <header> <span id="add-external-account-title-review" translate ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW &&\n      ($ctrl.cifTypeService.isChild() || $ctrl.cifTypeService.isBusiness())"> {{ $ctrl.flowService.currentState.titleKeyChildOrBISA }} </span> <span id="add-external-account-title" translate ng-if="$ctrl.flowService.currentState !== $ctrl.flowService.STATES.REVIEW &&\n      !($ctrl.flowService.currentState === $ctrl.flowService.STATES.ADDED && $ctrl.cifTypeService.isBusiness()) ||\n      (!$ctrl.cifTypeService.isChild() && !$ctrl.cifTypeService.isBusiness())"> {{ $ctrl.flowService.currentState.titleKey }} </span> <span id="add-external-account-title" translate ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.ADDED &&\n      $ctrl.cifTypeService.isBusiness()"> {{::\'userSettings.externalAccounts.addExternalAccountContactModal.header.completeLink\'}} </span> </header> <div ng-if="!$ctrl.flowService.showConfirmExitUI"> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.ADD_ACCOUNT"> <div ng-show="$ctrl.submitErrors.length"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> </div> <p class="c-add-external-account-modal__add-account-header body--2" ng-if="!$ctrl.cifTypeService.isChild()"> {{::\'userSettings.externalAccounts.addExternalAccountContactModal.addStepHeader\' | translate}} </p> <p class="c-add-external-account-modal__add-account-header body--2" ng-if="$ctrl.cifTypeService.isChild()"> {{::\'userSettings.externalAccounts.addExternalAccountContactModal.addStepHeaderForChild\' | translate}} </p> <div class="margin__b--fix2 c-add-external-account-modal__add-account-container"> <div class="c-add-external-account-modal__add-account-form"> <form name="$ctrl.accountForm"> <div class="field__group"> <div class="field"> <label for="transitNumber_externalAccounts"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.transitNumber\' | translate}} </label> <input class="input CB_DataMask" ng-class="{\'warning\':\n                        ($ctrl.accountForm.transitNumber_externalAccounts.$invalid &&\n                        $ctrl.accountForm.transitNumber_externalAccounts.$touched) ||\n                        $ctrl.financialInstitutionError\n                       }" actionable-id="transitNumber_externalAccounts" type="text" tng-ignore-mouse-wheel required autofocus minlength="5" maxlength="5" pattern="\\d*" ng-model-options="{\n                                          updateOn: \'keyup blur\',\n                                          debounce: { \'keyup\': 200, \'blur\': 200 }\n                                        }" ng-change="$ctrl.watchFormChange()" ng-model="$ctrl.account.transitNumber" placeholder="{{\'userSettings.externalAccounts.addExternalAccountContactModal.transitNumber\' | translate}}"/> <div ng-messages="$ctrl.accountForm.transitNumber_externalAccounts.$error" ng-show="$ctrl.accountForm.transitNumber_externalAccounts.$touched" class="field__error"> <p ng-message="required"> {{ ::(\'validation.isRequired\' | translate) }} </p> <p ng-message="pattern"> {{ ::(\'global.validation.onlyNumbers\' | translate) }} </p> <p ng-message="minlength"> {{ ::(\'validation.exact5digits\' | translate) }} </p> </div> </div> </div> <div class="field__group"> <div class="field"> <label for="bankNumber_externalAccounts"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.bankNumber\' | translate}} </label> <input class="input CB_DataMask" ng-class="{\'warning\':\n                        ($ctrl.accountForm.bankNumber_externalAccounts.$invalid &&\n                        $ctrl.accountForm.bankNumber_externalAccounts.$touched) ||\n                        $ctrl.financialInstitutionError\n                       }" actionable-id="bankNumber_externalAccounts" type="text" tng-ignore-mouse-wheel required ng-model-options="{\n                                          updateOn: \'keyup blur\',\n                                          debounce: { \'keyup\': 200, \'blur\': 200 }\n                                        }" minlength="3" maxlength="3" pattern="\\d*" ng-change="$ctrl.watchFormChange()" ng-model="$ctrl.account.bankNumber" placeholder="{{\'userSettings.externalAccounts.addExternalAccountContactModal.bankNumber\' | translate}}"/> <div ng-messages="$ctrl.accountForm.bankNumber_externalAccounts.$error" ng-show="$ctrl.accountForm.bankNumber_externalAccounts.$touched" class="field__error"> <p ng-message="required"> {{ ::(\'validation.isRequired\' | translate) }} </p> <p ng-message="pattern"> {{ ::(\'global.validation.onlyNumbers\' | translate) }} </p> <p ng-message="minlength"> {{ ::(\'validation.exact3digits\' | translate) }} </p> </div> </div> </div> <div class="field__group"> <div class="field"> <label for="accountNumber_externalAccounts"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.accountNumber\' | translate}} </label> <input class="input CB_DataMask" name="accountNumber" ng-class="{\'warning\':\n                    ($ctrl.accountsInequalityValidationError ||\n                    $ctrl.accountForm.accountNumber_externalAccounts.$invalid) &&\n                    $ctrl.accountForm.accountNumber_externalAccounts.$touched\n                  }" actionable-id="accountNumber_externalAccounts" type="text" required tng-ignore-mouse-wheel min="1" maxlength="32" pattern="\\d*" max="999999999999999999" ng-change="$ctrl.clearErrorIfAccountNumberMatches()" ng-blur="$ctrl.watchFormChange()" ng-model="$ctrl.account.accountNumber" placeholder="{{\'userSettings.externalAccounts.addExternalAccountContactModal.accountNumber\' | translate}}"/> <div ng-messages="$ctrl.accountForm.accountNumber_externalAccounts.$error" ng-show="$ctrl.accountForm.accountNumber_externalAccounts.$touched" class="field__error"> <p ng-message="required"> {{ ::(\'validation.isRequired\' | translate) }} </p> <p ng-message="pattern"> {{ ::(\'global.validation.onlyNumbers\' | translate) }} </p> </div> </div> </div> <div class="field__group margin__t--fix1"> <div class="field"> <label for="accountNumberSecond_externalAccounts"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.confirmAccountNumber\' | translate}} </label> <input class="input CB_DataMask" name="accountNumberSecond" ng-class="{\'warning\':\n                    ($ctrl.accountsInequalityValidationError ||\n                    $ctrl.accountForm.accountNumberSecond_externalAccounts.$invalid) &&\n                    $ctrl.accountForm.accountNumberSecond_externalAccounts.$touched\n                  }" actionable-id="accountNumberSecond_externalAccounts" type="text" required tng-ignore-mouse-wheel maxlength="32" pattern="\\d*" max="999999999999999999" min="1" ng-change="$ctrl.clearErrorIfAccountNumberMatches()" ng-blur="$ctrl.watchFormChange()" ng-model="$ctrl.account.accountNumberSecond" placeholder="{{\'userSettings.externalAccounts.addExternalAccountContactModal.accountNumber\' | translate}}"/> <div ng-messages="$ctrl.accountForm.accountNumberSecond_externalAccounts.$error" ng-show="$ctrl.accountForm.accountNumberSecond_externalAccounts.$touched || $ctrl.accountsInequalityValidationError" class="field__error"> <p ng-message="required"> {{ ::(\'validation.isRequired\' | translate) }} </p> <p ng-message="pattern"> {{ ::(\'global.validation.onlyNumbers\' | translate) }} </p> <p ng-if="$ctrl.accountsInequalityValidationError"> {{ ::(\'validation.notEqual\' | translate) }} </p> </div> </div> </div> <div class="field"> <label> {{\'userSettings.externalAccounts.addExternalAccountContactModal.currency\' | translate}} </label> </div> <div class="personalAccount_externalAccounts_currency c-add-external-account-modal__currency_bottom field__group--inline"> <div class="field"> <input actionable-id="currencyCAD_externalAccounts" class="input input--pill" value="CAD" type="radio" ng-model="$ctrl.account.currency"/> <label id="currencyCAD_externalAccounts_label" for="currencyCAD_externalAccounts">CAD</label> </div> <div class="field" ng-if="!$ctrl.cifTypeService.isChild()"> <input actionable-id="currencyUSD_externalAccounts" class="input input--pill" value="USD" type="radio" ng-model="$ctrl.account.currency"/> <label id="currencyUSD_externalAccounts_label" for="currencyUSD_externalAccounts">USD</label> </div> </div> <div class="c-external-account__agreements-container"> <section class="c-external-account__agreements__section c-external-account__agreements hide-for-print"> <div class="container"> <div class="field"> <input id="external-account__confirmation" class="input" name="external-account__confirmation" actionable-id="external-account__confirmation" ng-model="$ctrl.isPersonalAccount" ng-change="$ctrl.watchFormChange()" type="checkbox"/> <label ng-if="$ctrl.cifTypeService.didParentSwitchToChild()" class="c-external-account__agreements__label" for="external-account__confirmation" id="label-external-account__confirmation"> {{ \'userSettings.externalAccounts.addExternalAccountContactModal.childAccount\' | translate }} </label> <label ng-if="(!$ctrl.cifTypeService.isChild() && $ctrl.cifTypeService.isNormal()) ||\n                         ($ctrl.cifTypeService.isChild() && !$ctrl.cifTypeService.didParentSwitchToChild())" class="c-external-account__agreements__label" for="external-account__confirmation" id="label-external-account__confirmation"> {{ \'userSettings.externalAccounts.addExternalAccountContactModal.personalAccount\' | translate }} </label> <label ng-if="$ctrl.cifTypeService.isBusiness()" class="c-external-account__agreements__label" for="external-account__confirmation" id="label-external-account__confirmation"> {{ \'userSettings.externalAccounts.addExternalAccountContactModal.businessAccount\' | translate }} </label> </div> </div> </section> </div> </form> </div> <div class="c-add-external-account-modal__add-account-example"> <div class="c-add-external-account-modal__add-account-example-top"> <img ng-src="{{ \'global.chequeReceivingImage\' | translate}}"/> <br/> <span class="c-add-external-account-modal__add-account-example-top-your-transit" ng-bind-html="\'userSettings.externalAccounts.addExternalAccountContactModal.yourTransit\' | translate"> </span> </div> </div> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW && $ctrl.submitErrors.length > 0"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW" class="c-add-external-account-modal__review"> <div class="body margin__all margin__all--fix1"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.reviewBody\' | translate}} </div> <table class="table table--full c-add-external-account-modal__table"> <tbody> <tr> <td id="addExternalAccountContactModal-transitNumber"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.transitNumber\' | translate}} </td> <td> <span class="c-add-external-account-modal__table-value CB_DataMask"> {{::$ctrl.account.transitNumber}} </span> </td> </tr> <tr> <td id="addExternalAccountContactModal-bankNumber"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.bankNumber\' | translate}} </td> <td> <span class="c-add-external-account-modal__table-value CB_DataMask"> {{::$ctrl.account.bankNumber}} </span> </td> </tr> <tr> <td id="addExternalAccountContactModal-accountNumber"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.accountNumber\' | translate}} </td> <td> <span class="c-add-external-account-modal__table-value CB_DataMask" id="externalAccounts-addExternalAccountContactModal-accountNumber"> {{::$ctrl.account.accountNumber}} </span> </td> </tr> <tr> <td id="addExternalAccountContactModal-financialInstitution"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.financialInstitution\' | translate}} </td> <td> <span class="c-add-external-account-modal__table-value"> {{::$ctrl.financialInstitution.name}} <br> {{::$ctrl.financialInstitution.address}} </span> </td> </tr> <tr> <td id="addExternalAccountContactModal-currencyType"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.currencyType\' | translate}} </td> <td> <span class="c-add-external-account-modal__table-value"> {{::$ctrl.account.currency}} </span> </td> </tr> </tbody> </table> <button class="btn btn--large btn--edit c-external-accounts__button-add" actionable-id="buttonAdd_externalAccounts" aria-label="Edit External Account" ng-click="$ctrl.editAccount()"> {{ \'userSettings.externalAccounts.addExternalAccountContactModal.edit\' | translate}} </button> </div> <div ng-if="$ctrl.isLoadingMode"> <div ng-if="$ctrl.submitErrors.length === 0"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div ng-if="$ctrl.submitErrors.length > 0"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.ADDED_PRIV"> <span class="body--2"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.yourAccountHasBeenAdded\' | translate}} </span> <div class="c-add-external-account-modal__added-confirmation-box"> <div class="c-add-external-account-modal__added-confirmation-box-column c-add-external-account-modal__added-confirmation-box-column--bordered"> <span class="c-add-external-account-modal__description"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.financialInstitution\' | translate}} </span> <span class="c-add-external-account-modal__value">{{::$ctrl.financialInstitution.name}}</span> </div> <div class="c-add-external-account-modal__added-confirmation-box-column"> <span class="c-add-external-account-modal__description"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.accountNumber\' | translate}} </span> <span class="c-add-external-account-modal__value">{{::$ctrl.account.accountNumber}}</span> </div> </div> <span class="heading--sub c-add-external-account-modal__next-steps"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.nextSteps\' | translate}} </span> <div class="c-add-external-account-modal__next-steps_btns" ng-if="$ctrl.initialStep !== $ctrl.flowService.STATES.VERIFY"> <p class="body--2" ng-bind-html="\'userSettings.externalAccounts.addExternalAccountContactModal.nextStepsDescPriv\' | translate : {\n          account : ($ctrl.financialInstitution.name + \'....\' + ($ctrl.account.accountNumber | limitTo : 4 : -4))\n        }"> </p> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.ADDED"> <span class="body--2" ng-if="!$ctrl.cifTypeService.isBusiness()"> {{ ::\'userSettings.externalAccounts.addExternalAccountContactModal.completeLink.subHeader\' | translate }} </span> <span class="body--2" ng-if="$ctrl.cifTypeService.isBusiness()"> {{ ::\'userSettings.externalAccounts.addExternalAccountContactModal.completeLink.subHeader\' | translate }} </span> <div class="c-add-external-account-modal__added-confirmation-box"> <div class="c-add-external-account-modal__added-confirmation-box-column c-add-external-account-modal__added-confirmation-box-column--bordered"> <span class="c-add-external-account-modal__description"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.financialInstitution\' | translate}} </span> <span class="c-add-external-account-modal__value">{{::$ctrl.financialInstitution.name}}</span> </div> <div class="c-add-external-account-modal__added-confirmation-box-column"> <span class="c-add-external-account-modal__description"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.accountNumber\' | translate}} </span> <span class="c-add-external-account-modal__value">{{::$ctrl.account.accountNumber}}</span> </div> </div> <span class="heading--sub c-add-external-account-modal__next-steps"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.nextSteps\' | translate}} </span> <div class="c-add-external-account-modal__csa-box-one-column" ng-if="$ctrl.initialStep !== $ctrl.flowService.STATES.VERIFY && !$ctrl.cifTypeService.isBusiness()"> <div class="c-add-external-account-modal__added-confirmation-box"> <div class="c-add-external-account-modal__stepslist"> <ul> <li> <span class="c-add-external-account-modal__circle">1</span> <span class="desc" ng-bind-html="\'userSettings.externalAccounts.addExternalAccountContactModal.step1\' | translate : { account : $ctrl.AccountHelpersService.getMaskedAccountNumber($ctrl.account.accountNumber), bank: $ctrl.financialInstitution.name }"> </span> </li> <li> <span class="c-add-external-account-modal__circle">2</span> <span class="desc" ng-bind-html="\'userSettings.externalAccounts.addExternalAccountContactModal.step2\' | translate"> </span> </li> </ul> </div> </div> </div> <div class="c-add-external-account-modal__next-steps_btns" ng-if="$ctrl.initialStep !== $ctrl.flowService.STATES.VERIFY && $ctrl.cifTypeService.isBusiness()"> <p class="body--2"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.nextStepsDesc\' | translate}} </p> <div class="tiles"> <tng-tile-list tile-type="text" tile-data="$ctrl.nextStepsLinks" is-actionable="true" on-tile-click="$ctrl.flowService.onNextStepsLinksClick(index)"> </tng-tile-list> </div> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.COMPLETE_LINK"> <span class="body--2"> {{ ::\'userSettings.externalAccounts.addExternalAccountContactModal.completeLink.subHeader\' | translate }} </span> <div class="c-add-external-account-modal__added-confirmation-box"> <div class="c-add-external-account-modal__added-confirmation-box-column c-add-external-account-modal__added-confirmation-box-column--bordered"> <span class="c-add-external-account-modal__description"> {{ ::\'userSettings.externalAccounts.addExternalAccountContactModal.completeLink.financial\' | translate }} </span> <span class="c-add-external-account-modal__value">{{::$ctrl.financialInstitution.name}}</span> </div> <div class="c-add-external-account-modal__added-confirmation-box-column"> <span class="c-add-external-account-modal__description"> {{ ::\'userSettings.externalAccounts.addExternalAccountContactModal.completeLink.account\' | translate }} </span> <span class="c-add-external-account-modal__value">{{::$ctrl.account.accountNumber}}</span> </div> <div class="c-add-external-account-modal__csa-box-one-column"> <div class="c-add-external-account-modal__stepslist"> <ul> <li> <span class="c-add-external-account-modal__circle">1</span> <span class="desc" ng-bind-html="\'userSettings.externalAccounts.addExternalAccountContactModal.completeLink.msg1\' | translate : { account : $ctrl.cifTypeService.selectedCif.cif }"> </span> </li> <li> <span class="c-add-external-account-modal__circle">2</span> <span class="desc" ng-bind-html="\'userSettings.externalAccounts.addExternalAccountContactModal.completeLink.msg2\' | translate"> </span> </li> </ul> </div> </div> </div> <span class="heading--sub c-add-external-account-modal__next-steps"> {{ ::\'userSettings.externalAccounts.addExternalAccountContactModal.completeLink.optional\' | translate }} </span> <div class="c-add-external-account-modal__next-steps_btns"> <tng-tile-list tile-type="text" tile-data="$ctrl.ASPLink" is-actionable="true" on-tile-click="$ctrl.switchToASP()"> </tng-tile-list> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.SEND_BUS_CHECK"> <p class="body--2 margin__b--rel2"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.sendBusCheck.desc\' | translate}} </p> <div class="panel margin__t--rel2"> <div class="c-add-external-account-modal__stepslist"> <ul> <li> <span class="c-add-external-account-modal__circle">1</span> <span class="desc"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.sendBusCheck.step1.prefix\' | translate}} <span class="orange">{{\'userSettings.externalAccounts.addExternalAccountContactModal.sendBusCheck.step1.value\' | translate | currency}}</span> {{\'userSettings.externalAccounts.addExternalAccountContactModal.sendBusCheck.step1.suffix\' | translate}} </span> </li> <li> <span class="c-add-external-account-modal__circle">2</span> <span class="desc"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.sendBusCheck.step2.prefix\' | translate}} <strong> {{\'userSettings.externalAccounts.addExternalAccountContactModal.sendBusCheck.step2.suffix\' | translate}} </strong> </span> </li> <li> <span class="c-add-external-account-modal__circle">3</span> <span class="desc"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.sendBusCheck.step3.prefix\' | translate}} <strong> {{\'userSettings.externalAccounts.addExternalAccountContactModal.sendBusCheck.step3.suffix\' | translate}} </strong> </span> </li> </ul> </div> </div> <button actionable-id="add-external-account-print_btn" class="btn c-add-external-account-modal__print" ng-if="$ctrl.isWeb" ng-click="$ctrl.print()"> {{ \'userSettings.externalAccounts.addExternalAccountContactModal.sendBusCheck.print\' | translate }} </button> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.SEND_DIRECT_DEPOSIT"> <p class="body--2 margin__b--rel2"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.directDeposit.desc\' | translate}} </p> <div class="panel margin__t--rel2"> <div class="c-add-external-account-modal__stepslist"> <ul> <li> <span class="c-add-external-account-modal__circle">1</span> <span class="desc"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.directDeposit.step1.prefix\' | translate}} <ul> <li>{{\'userSettings.externalAccounts.addExternalAccountContactModal.directDeposit.step1.substep1\' | translate}}</li> <li>{{\'userSettings.externalAccounts.addExternalAccountContactModal.directDeposit.step1.substep2\' | translate}}</li> <li>{{\'userSettings.externalAccounts.addExternalAccountContactModal.directDeposit.step1.substep3\' | translate}}</li> <li>{{\'userSettings.externalAccounts.addExternalAccountContactModal.directDeposit.step1.substep4\' | translate}}</li> <li>{{\'userSettings.externalAccounts.addExternalAccountContactModal.directDeposit.step1.substep5\' | translate}}</li> </ul> </span> </li> <li> <span class="c-add-external-account-modal__circle">2</span> <span class="desc"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.directDeposit.step2.prefix\' | translate}} <strong> {{\'userSettings.externalAccounts.addExternalAccountContactModal.directDeposit.step2.suffix\' | translate}} </strong> </span> </li> </ul> </div> </div> <button actionable-id="add-external-account-print_btn_1" class="btn c-add-external-account-modal__print" ng-if="$ctrl.isWeb" ng-click="$ctrl.print()"> {{ \'userSettings.externalAccounts.addExternalAccountContactModal.sendBusCheck.print\' | translate }} </button> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.CANCEL"> <div class="c-add-external-account-modal__pending-transaction-info"> <p> {{\'userSettings.externalAccounts.addExternalAccountContactModal.cancelRequest\' | translate}} </p> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DELETE"> <div> <div class="c-error-message panel" ng-if="!$ctrl.canDeleteExternalAccount()"> <div class="c-add-external-account-modal__pending-transaction-info"> <p> {{\'userSettings.externalAccounts.addExternalAccountContactModal.pendingTransactionInfo\' | translate}} </p> </div> </div> <div class="margin__tb--fix2 c-add-external-account-modal__pending-transaction" ng-if="$ctrl.pendingTransactions.length"> <strong class="family-fancy"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.pendingTransaction\' | translate}} </strong> {{$ctrl.checkAccount.account_number}} </div> <table class="table table--full" ng-if="$ctrl.pendingTransactions.length"> <thead> <tr> <th>{{ \'userSettings.externalAccounts.addExternalAccountContactModal.account\' | translate}}</th> <th>{{ \'userSettings.externalAccounts.addExternalAccountContactModal.transaction\' | translate}}</th> <th>{{ \'userSettings.externalAccounts.addExternalAccountContactModal.frequency\' | translate}}</th> <th>{{ \'userSettings.externalAccounts.addExternalAccountContactModal.endDate\' | translate}}</th> <th> {{ \'userSettings.externalAccounts.addExternalAccountContactModal.amount\' | translate}} </th> </tr> </thead> <tbody> <tr ng-repeat="pendingTransaction in $ctrl.pendingTransactions"> <td> {{::$ctrl.pendingTransactions.institution_description | camelCaseType}} <div class="table__quiet">{{::pendingTransaction.from_account.number}}</div> </td> <td> <div class="table__quiet">{{::pendingTransaction.type}}</div> </td> <td> <div class="table__quiet">{{::pendingTransaction.frequency}}</div> </td> <td> <div class="table__quiet">{{::pendingTransaction.expiry_date}}</div> </td> <td> {{::pendingTransaction.amount | currency}} </td> </tr> </tbody> </table> </div> <div ng-if="$ctrl.canDeleteExternalAccount()"> <div> {{\'userSettings.externalAccounts.addExternalAccountContactModal.deleteLinkSummary1\' | translate}} </div> <div class="margin__t--fix2"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.deleteLinkSummary2\' | translate}} </div> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DELETED"> <div class="margin__b--fix2"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.deleted\' | translate}} </div> <div class="margin__b--fix1 body"> {{::$ctrl.account.institution_description | camelCaseType}} </div> <div class="c-add-external-account-modal__added-confirmation-box--no-margin-top" id="addExternalAccountContactModal-delete-block"> <div class="c-add-external-account-modal__added-confirmation-box-column c-add-external-account-modal__added-confirmation-box-column--bordered c-add-external-account-modal__added-confirmation-box-column--small"> <span class="c-add-external-account-modal__description"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.transitNumber\' | translate}} </span> <span class="c-add-external-account-modal__value">{{$ctrl.account.transit_number}}</span> </div> <div class="c-add-external-account-modal__added-confirmation-box-column c-add-external-account-modal__added-confirmation-box-column--bordered c-add-external-account-modal__added-confirmation-box-column--small"> <span class="c-add-external-account-modal__description"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.accountNumber\' | translate}} </span> <span class="c-add-external-account-modal__value">{{$ctrl.account.account_number}}</span> </div> <div class="c-add-external-account-modal__added-confirmation-box-column c-add-external-account-modal__added-confirmation-box-column--small"> <span class="c-add-external-account-modal__description"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.currency\' | translate}} </span> <span class="c-add-external-account-modal__value">{{$ctrl.account.currency}}</span> </div> </div> <tng-print-button button-class="btn btn--orange">{{ ::\'global.print\' | translate}}</tng-print-button> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.VERIFY && !$ctrl.flowService.isLoading"> <div ng-if="$ctrl.submitErrors.length > 0" class="margin__b--fix2"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> </div> <span class="body--2 c-add-external-account-modal__verify-header" ng-bind-html="\'userSettings.externalAccounts.addExternalAccountContactModal.verifyAccountHeader\' | translate"> </span> <div class="c-add-external-account-modal__verify-form"> <form name="$ctrl.amountForm"> <div class="field__group"> <div class="field"> <label for="deposit1_externalAccounts"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.deposit1\' | translate}} </label> <input class="input" ng-class="{\'warning\': $ctrl.amountForm.deposit1 <= 0}" actionable-id="deposit1_externalAccounts" type="number" tng-ignore-mouse-wheel ng-change="$ctrl.validateVerifyForm()" ng-blur="$ctrl.validateVerifyForm()" required autofocus step="0.01" min="0" ng-model="$ctrl.verifyAmount.deposit1" placeholder="{{\'userSettings.externalAccounts.addExternalAccountContactModal.depositPlaceholder\' | translate}}"/> </div> </div> <div class="field__group"> <div class="field"> <label for="deposit2_externalAccounts"> {{\'userSettings.externalAccounts.addExternalAccountContactModal.deposit2\' | translate}} </label> <input class="input" ng-class="{\'warning\': $ctrl.amountForm.deposit2 <= 0}" actionable-id="deposit2_externalAccounts" type="number" tng-ignore-mouse-wheel required ng-change="$ctrl.validateVerifyForm()" ng-blur="$ctrl.validateVerifyForm()" step="0.01" min="0" ng-model="$ctrl.verifyAmount.deposit2" placeholder="{{\'userSettings.externalAccounts.addExternalAccountContactModal.depositPlaceholder\' | translate}}"/> </div> </div> </form> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.VERIFIED"> <span class="body--2" ng-bind-html="\'userSettings.externalAccounts.addExternalAccountContactModal.yourAccountHasBeenVerified\' | translate"> </span> <div class="margin__t margin__t--fix2"> <div class="icon icon--loading-done xx-large"> <span class="icon-check2"></span> </div> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.VERIFY_FAILED"> <span class="body--2" ng-bind-html="\'userSettings.externalAccounts.addExternalAccountContactModal.accountVerificationFailed\' | translate"> </span> </div> </div> <footer ng-hide="$ctrl.flowService.showConfirmExitUI"> <button actionable-id="add-external-account-back" class="btn btn--edit" ng-show="$ctrl.flowService.BUTTONS.BTN_GRY.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_GRY.disable" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_GRY)"> {{ $ctrl.flowService.BUTTONS.BTN_GRY.type.label | translate }} </button> <button actionable-id="add-external-account-next" class="btn btn--orange" ng-class="{\'CB_ReadOnly\': $ctrl.flowService.CB_DISABLED_BUTTONS.includes($ctrl.flowService.BUTTONS.BTN_ORG.type)}" ng-show="$ctrl.flowService.BUTTONS.BTN_ORG.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_ORG.disable" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_ORG)"> {{ $ctrl.flowService.BUTTONS.BTN_ORG.type.label | translate }} </button> <button actionable-id="add-external-account-cancel" class="btn btn--warn" ng-disabled="!$ctrl.canDeleteExternalAccount()" ng-show="$ctrl.flowService.BUTTONS.BTN_RED.show" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_RED)"> {{ $ctrl.flowService.BUTTONS.BTN_RED.type.label | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f,p,g,m,_,v){(0,i.default)(this,t),this.$log=e,this.$state=d,this.$timeout=n,this.$translate=a,this.$window=s,this.flowService=r,this.stateConstants=f,this.EnvironmentService=h,this.externalAccountsService=o,this.cifTypeService=c,this.customersConstants=l,this.CURRENCY_TYPES=u.CURRENCY_TYPES,this.userSettingsConstants=p,this.GlobalModalsService=g,this.AccountHelpersService=m,this.$anchorScroll=_,this.$location=v}return(0,a.default)(t,[{key:"$onInit",value:function(){this.flowService.activate(),this.accountForm={},this.amountForm={},this.verifyAmount={},this.submitErrors=[],this.account={currency:this.CURRENCY_TYPES.CAD,transitNumber:null,bankNumber:null,accountNumber:null,accountNumberSecond:null},this.isPersonalAccount=!1,this.watchFormChange(),this._goToInitialState(),this.accountCopy=angular.copy(this.account),this.nextStepsLinks=this.flowService.getNextStepsLinks(),this.ASPLink=this.flowService.getASPLink(),this.isWeb=!this.EnvironmentService.isNative()}},{key:"$onDestroy",value:function(){this.accountForm={},this.amountForm={},this.verifyAmount={},this.account={},this.flowService.deactivate()}},{key:"onModalClose",value:function(){this._close()}},{key:"onButtonClick",value:function(t){var e=this,n=this.$log,i=this.flowService;switch(n.debug("ACTION: "+t.type.label),this._clearErrors(),t.type){case i.BUTTON_TYPES.BACK:i.gotoPreviousState();break;case i.BUTTON_TYPES.CANCEL:this._close();break;case i.BUTTON_TYPES.SUBMIT:this._addAccount();break;case i.BUTTON_TYPES.DELETE:this.handleDeleteAccount();break;case i.BUTTON_TYPES.NEXT:this._getBankInformationValidity().then((function(){i.gotoNextState(),e.$timeout((function(){e._scrollTo("add-external-account-title")}),100)})).catch((function(t){e.$log.debug("error occured "+t)}));break;case i.BUTTON_TYPES.REVIEW:i.gotoNextState();break;case i.BUTTON_TYPES.VERIFY:this._verifyAccount();break;case i.BUTTON_TYPES.DONE:this.onClose(),this.flowService.hideWarning(),this.isOnboarding||this.$state.reload(this.stateConstants.USER_SETTINGS_EXTERNAL_ACCOUNTS);break;default:n.debug("default - NO ACTION")}}},{key:"canDeleteExternalAccount",value:function(){var t=!0;return this.pendingTransactions&&this.pendingTransactions.length>0&&this.pendingTransactions.some((function(e){return!(!e||!e.hasErrorCodeSCO&&!e.hasErrorCodeHASFDT)&&(t=!1)})),t}},{key:"_close",value:function(){var t=this,e=this.flowService;e.showConfirmExitUI?e.denyExit():((e.currentState===e.STATES.DELETE||e.currentState===e.STATES.VERIFY&&void 0===this.verifyAmount.deposit1||e.currentState===e.STATES.ADD_ACCOUNT&&angular.equals(this.accountCopy,this.account))&&this.onClose(),e.showWarning(),e.warn().then((function(){t.onClose(),e.returnToStart()})))}},{key:"watchFormChange",value:function(){this._clearErrors(),this.flowService.BUTTONS.BTN_ORG.disable=!0;var t=this._checkFieldCompleteness(),e=this._isFormValid(),n=this._agreementMarked(),i=this._checkAccountNumberEquality();t&&e&&n&&i?this.flowService.BUTTONS.BTN_ORG.disable=!1:i||this._showAccountInequalityErrors()}},{key:"_clearErrors",value:function(){this.accountsInequalityValidationError=null,this.financialInstitutionError=null,this.submitErrors=[]}},{key:"clearErrorIfAccountNumberMatches",value:function(){var t=this.account;t.accountNumber===t.accountNumberSecond?this.watchFormChange():this.flowService.BUTTONS.BTN_ORG.disable=!0}},{key:"_anySubmitErrors",value:function(){return this.submitErrors&&this.submitErrors.length>0}},{key:"_agreementMarked",value:function(){return!!this.isPersonalAccount}},{key:"_checkFieldCompleteness",value:function(){return!!(this.account.transitNumber&&this.account.accountNumber&&this.account.accountNumberSecond&&this.account.bankNumber)}},{key:"_checkAccountNumberEquality",value:function(){return!this.account.accountNumberSecond||!this.account.accountNumber||!(this.account.accountNumber!==this.account.accountNumberSecond)}},{key:"_isFormValid",value:function(){return!(!this.accountForm||this.accountForm.$invalid)}},{key:"_showAccountInequalityErrors",value:function(){this.accountsInequalityValidationError=!0}},{key:"_getBankInformationValidity",value:function(){var t=this;return this.financialInstitutionError=null,this.externalAccountsService.getFinancialInstitution(this.account.bankNumber,this.account.transitNumber).then((function(e){if(e.response_status.status_code!==t.customersConstants.API.RESPONSE_CODES.INVALID_BANK_INFO)return e;throw t.financialInstitutionError=e.response_status.technical_description,e})).then((function(e){t.financialInstitution=e.financial_institution})).catch((function(e){throw t._pushSubmittedErrors(e),t._anySubmitErrors()&&t._scrollTo("addAccountErrors"),e}))}},{key:"_scrollTo",value:function(t){var e=this;t&&this.$location.hash(t),this.$timeout((function(){e.$anchorScroll()}),200)}},{key:"editAccount",value:function(){this.flowService.gotoPreviousState(),this.flowService.BUTTONS.BTN_ORG.disable=!1}},{key:"handleDeleteAccount",value:function(){var t=this,e=["CREATED","SUCCESS"];return this.flowService.gotoNextState(),this.deleteAccount({account:this.account}).then((function(n){return n?n.response_status&&"status_code"in n.response_status&&e.indexOf(n.response_status.status_code)<0?t._showSubmitErrors(n):t.$timeout((function(){return t.flowService.gotoNextState()}),0):t._showSubmitErrors({errorMessage:t.$translate.instant("global.customErrorCodes.NO_CALL_SCHEDULED")})})).catch(this._showSubmitErrors.bind(this))}},{key:"print",value:function(){this.$window.print()}},{key:"_goToInitialState",value:function(){var t=this.flowService;if(this.initialStep)switch(this.initialStep.titleKey){case t.STATES.DELETE.titleKey:t.moveTo(t.STATES.DELETE),this.account=this.checkAccount;break;case t.STATES.CANCEL.titleKey:this.account=this.checkAccount,t.moveTo(t.STATES.CANCEL);break;case t.STATES.VERIFY.titleKey:t.moveTo(this.flowService.STATES.VERIFY);break;default:t.moveTo(this.flowService.STATES.ADD_ACCOUNT)}}},{key:"validateVerifyForm",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=!(this.verifyAmount.deposit1>=.01&&this.verifyAmount.deposit2>=.01)}},{key:"_verifyAccount",value:function(){var t=this;this.submitErrors=[];var e=this.$log,n=this.externalAccountsService,i=this.flowService;i.enterLoadingMode(),n.verifyAccount(this.verifyAmount,this.checkAccount.dealId).then((function(n){e.debug("response: ",n),n.response_status&&n.response_status.status_code&&"EXCEEDED_ATTEMPTS_LIMIT"===n.response_status.status_code?(t._showSubmitErrors(n),i.goToVerifyFailed()):n.response_status&&n.response_status.status_code&&-1===["CREATED","SUCCESS"].indexOf(n.response_status.status_code)?t._showSubmitErrors(n):i.gotoNextState()})).catch((function(e){t._showSubmitErrors(e)})).finally((function(){i.exitLoadingMode()}))}},{key:"_hasSuccessStatusCode",value:function(t){return["CREATED","SUCCESS"].indexOf(t)>-1}},{key:"_addAccount",value:function(){var t=this,e=this.$log,n=this.externalAccountsService,i=this.flowService;i.gotoNextState(),n.addAccount(this.account).then((function(n){var a=n.response_status,s=a.status_code,r=a.return_code;e.debug("response: ",n),s!==t.customersConstants.API.RESPONSE_CODES.BIINV&&r!==t.customersConstants.API.RESPONSE_CODES.INVALID&&t._hasSuccessStatusCode(s)?t.cifTypeService.isBusiness()?i.moveTo(t.flowService.STATES.ADDED):t.cifTypeService.isChild()?i.moveTo(t.flowService.STATES.COMPLETE_LINK):i.gotoNextState():(i.gotoPreviousState(),t._showSubmitErrors(n))})).catch((function(e){t._showSubmitErrors(e)}))}},{key:"_pushSubmittedErrors",value:function(t){var e=this.submitErrors;"errorMessage"in t&&e.push(t.errorMessage),t.response_status&&"details"in t.response_status&&t.response_status.details.forEach((function(t){t.technical_description?e.push(t.technical_description):e.push(t)})),t.response_status&&"status_code"in t.response_status&&!this._hasSuccessStatusCode(t.response_status.status_code)&&e.push(this.$translate.instant("global.errorCodes."+t.response_status.return_code))}},{key:"_showSubmitErrors",value:function(t){this.$log.debug("Submit Error:",t);var e=this.submitErrors,n=this.flowService;this._pushSubmittedErrors(t),n.BUTTONS.BTN_GRY.disable=!1,n.BUTTONS.BTN_GRY.show=!0,n.BUTTONS.BTN_GRY.type=n.BUTTON_TYPES.BACK,t.response_status.status_code&&t.response_status.status_code.toUpperCase().indexOf("ERROR")>=0&&(n.BUTTONS.BTN_ORG.disable=!0,n.BUTTONS.BTN_GRY.show=!1),this.$log.debug("formatted error:",e)}},{key:"switchToASP",value:function(){this.flowService.hideWarning(),this.GlobalModalsService.showASP()}},{key:"isLoadingMode",get:function(){return this.flowService.currentState===this.flowService.STATES.INTERSTITIAL_PROCESSING||this.flowService.currentState===this.flowService.STATES.INTERSTITIAL_PROCESSING_DELETE||this.flowService.isLoading}}]),t}();r.$inject=["$log","$timeout","$translate","$window","AddExternalAccountModalServiceFlow","ExternalAccountsService","CifTypeService","customerConstants","accountConstants","$state","EnvironmentService","stateConstants","UserSettingsConstants","GlobalModalsService","AccountHelpersService","$anchorScroll","$location"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(104)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s,r){(0,a.default)(this,t),this._RequesterService=e,this.cifTypeService=n,this._serviceConstants=i,this.$log=s,this.locale=r.locale,this.accounts=[],this.pendingTransactions=[]}return(0,s.default)(t,[{key:"fetchAccounts",value:function(){var t=this;this.accounts=[],this.pendingTransactions=[];var e=function(e){if(e&&e.externalLinks){var n=(0,i.default)(e.externalLinks,1)[0];angular.extend(t.accounts,n.accounts),"rvtAccounts"in n&&(t.accounts=t.accounts.concat(n.rvtAccounts))}return e};return this.cifTypeService.didParentSwitchToChild()?this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.GET_EXTERNAL_ACCOUNTS_DEPENDENT,{urlVars:{id:this.cifTypeService.selectedCif.customerInfo.dependent_id}}).then(e):this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.GET_EXTERNAL_ACCOUNTS).then(e)}},{key:"deleteAccount",value:function(t){var e=t.dealId||t.sequence;return this.cifTypeService.didParentSwitchToChild()?this.deleteExternalAccountDependent(e):this.deleteExternalAccount(e)}},{key:"deleteExternalAccount",value:function(t){var e={urlVars:{id:t}};return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.DELETE_EXTERNAL_ACCOUNT,e)}},{key:"deleteExternalAccountDependent",value:function(t){var e={urlVars:{id:this.cifTypeService.selectedCif.customerInfo.dependent_id,lookupId:t}};return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.DELETE_EXTERNAL_ACCOUNT_DEPENDENT,e)}},{key:"fetchPendingTransactions",value:function(t){var e=this,n={urlVars:{external_link_seq_number:t}};return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.CHECK_PENDING_TRANSACTIONS,n).then((function(t){return angular.copy(t.pending_transactions,e.pendingTransactions),t}))}},{key:"addAccount",value:function(t){var e=this,n={data:{external_link:{transit_number:t.transitNumber,account_number:t.accountNumber,bank_number:t.bankNumber,currency:t.currency,has_personal_account:!0}}},i=function(t){return"CREATED"===t.response_status.status_code&&e.accounts.push(n.data.external_link),t};return this.cifTypeService.didParentSwitchToChild()?(n.urlVars={},n.urlVars.id=this.cifTypeService.selectedCif.customerInfo.dependent_id,this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.ADD_EXTERNAL_ACCOUNT_DEPENDENT,n).then(i)):this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.ADD_EXTERNAL_ACCOUNT,n).then(i)}},{key:"getFinancialInstitution",value:function(t,e){var n={urlVars:{institutionId:t,transit_number:e,locale:this.locale}};return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.GET_FINANCIAL_INSTITUTION,n)}},{key:"verifyAccount",value:function(t,e){var n={urlVars:{dealId:e},data:{external_link:{amount1:t.deposit1,amount2:t.deposit2,action:"CONFIRM"}}};return this.cifTypeService.didParentSwitchToChild()?(n.urlVars={},n.urlVars.id=this.cifTypeService.selectedCif.customerInfo.dependent_id,this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.VERIFY_EXTERNAL_LINK_ACCOUNT_DEPENDENT,n)):this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.VERIFY_EXTERNAL_LINK_ACCOUNT,n)}}]),t}();o.$inject=["RequesterService","CifTypeService","serviceConstants","$log","LocaleService"],e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={STATUS:e.STATUS={SUB:"SUB",NEW:"NEW",PENCF:"PENCF",PEN:"PEN",COM:"COM",FAIL:"FAIL",FAILC:"FAILC",CONF:"CONF",CAN:"CAN"}};e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(2203),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("SettingsTableModule",[]).component("tngSettingsTable",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2204)),a=s(n(2205));function s(t){return t&&t.__esModule?t:{default:t}}n(2206);var r={template:i.default,controller:a.default,bindings:{settings:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-settings-table panel"> <table> <tbody class="c-settings-table__body"> <tr class="c-settings-table__row" ng-repeat="setting in $ctrl.settings | orderBy:\'order\' track by $index" ng-class="{\'c-settings-table__row--no-border\': $index >= $ctrl.settings.length - 1}"> <th class="c-settings-table__row__text--header" id="settings-label_{{ setting.label }}" ng-class="{\'withsublabel\' : setting.sublabel}" ng-if="setting.label"> {{ setting.label | translate }} <tng-help-bubble ng-if="setting.toolTip">{{ setting.toolTip | translate }}</tng-help-bubble> <span ng-if="setting.value !== undefined" class="c-settings-table__row--inlineValue">{{setting.value || 0 | currency}}</span> <span ng-if="setting.sublabel" class="c-settings-table__row--sublabel">{{ setting.sublabel | translate }}</span> </th> <th class="c-settings-table__row__text--loading" ng-if="setting.loading"> </th> <th class="c-settings-table__row__text--header" id="creditCard-label_{{ setting.label }}" ng-if="setting.number" translate-cloak> {{ \'userSettings.general.creditCard.label\' | translate }} {{ setting.number}} </th> <td class="c-settings-table__row__text--value" ng-class="{\'CB_ReadOnly\': setting.cbReadonly}" ng-if="setting.text != null"> <p ng-class="{\'c-bank-card__not-exist-label\': setting.isBankCardNotExist}" id="settings-{{ setting.text | translate}}"> <span ng-bind-html="setting.text | translate"></span> </p> </td> <td class="c-settings-table__row__text--value" ng-if="setting.texts"> <p ng-repeat="item in setting.texts track by $index">{{item.label|translate}}: {{item.text | translate}}</p> </td> <td class="c-settings-table__row__text--value" ng-if="setting.html"> <div ng-bind-html="setting.html"></div> </td> <td class="c-settings-table__row__text--value" ng-if="setting.list"> <p ng-if="setting.list.header">{{setting.list.header | translate}}</p> <ul class="c-settings-table__row__text__list"> <li ng-repeat="item in setting.list.items track by $index"> {{item | translate}} </li> </ul> </td> <td class="c-settings-table__row__text--value" ng-if="setting.preferredText"> <span>{{setting.preferredText | translate}}</span> <span class="c-settings-table__row__text__preferred" translate-cloak>{{ \'userSettings.general.basicInfo.preferred\' | translate }}</span> </td> <td class="c-settings-table__row__text--value" ng-if="setting.number"> </td> </tr> </tbody> </table> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(0),s=(i=a)&&i.__esModule?i:{default:i};var r=function t(e){(0,s.default)(this,t),this.$log=e,this.$log.debug("Input Settings: ",this.settings)};r.$inject=["$log"],e.default=r,t.exports=e.default},function(t,e,n){},,,,,,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2219)),a=s(n(2220));function s(t){return t&&t.__esModule?t:{default:t}}n(2221);var r={template:i.default,controller:a.default};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-bill-pay"> <div ng-if="$ctrl.showLanding" class="landing"> <h1 ng-if="!$ctrl.showEmptyStateSplash()" class="heading--title" id="billPay-title">{{ ::\'billPay.bills\' | translate }}</h1> <tng-loading-in-progress is-loading-key="billPay.states.interstitialLoadingState" ng-if="$ctrl.isLoadingData"> </tng-loading-in-progress> <div ng-if="!$ctrl.isLoadingData && !$ctrl.showEmptyStateSplash()"> <div class="bill__buttons" ng-if="$ctrl.displayActionableButtons"> <button actionable-id="bill-pay-add_bill_pay" class="btn btn--edit" ng-if="$ctrl.canAddBillPayee" tng-click="$ctrl.showAddBillPay()" level2-auth> {{ \'billPay.landingPage.addPayee\' | translate }} </button> </div> <div class="bills-and-balance"> <tng-info-summary-accordion class="accordion" actionable-id-root="upcoming-bills" title-info="$ctrl.upcomingBillsTitle" summaries="$ctrl.upcomingPaymentList"> </tng-info-summary-accordion> <tng-info-summary-accordion class="accordion" actionable-id-root="account-balance" title-info="$ctrl.accountService.accountsBalanceAccordionTitle" summaries="$ctrl.accountService.accountsBalanceAccordionItems"> </tng-info-summary-accordion> </div> <div class="c-bill-pay__error" ng-if="$ctrl.payeeList && $ctrl.payeeList.length === 0"> <tng-error-message> <span>{{ \'billPay.landingPage.noBillPayments\' | translate }}</span> </tng-error-message> </div> <div ng-show="$ctrl.payeeList ? $ctrl.payeeList.length > 0 : $ctrl.hasPayee()"> <tng-payee-list payees="$ctrl.payeeList" on-tile-click="$ctrl.showPayeeDetailSection(payee)"> </tng-payee-list> </div> <div ng-if="!$ctrl.hasPayee()"> <h1 class="heading--title"> {{ \'billPay.landingPage.noPayees\' | translate }} </h1> </div> </div> </div> <tng-add-biller-dialog ng-if="$ctrl.showAddBPModal" on-close="$ctrl.onAddBPModalClose(result)"> </tng-add-biller-dialog> <tng-empty-state-splash-screen ng-if="$ctrl.showEmptyStateSplash()" background-image-url="\'assets/images/empty_state_splash_bills_{{locale}}.jpg\'"> <div class="c-empty-state-splash__cta"> <h2 class="heading--title2">{{\'billPay.landingPage.emptyState.header\' | translate}}</h2> <p ng-bind-html="\'billPay.landingPage.emptyState.content\' | translate"></p> <button ng-if="$ctrl.canAddBillPayee" actionable-id="bill-pay-add_bill_pay" class="btn btn--primary" ng-click="$ctrl.showAddBillPay()"> {{ \'billPay.landingPage.addPayee\' | translate }} </button> </div> </tng-empty-state-splash-screen> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(92)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s,r,o,c,l,u,d,h,f,p,g,m,_,v,S,T){(0,a.default)(this,t),this.$log=e,this.$q=n,this.$state=i,this.$scope=s,this.$filter=r,this.$translate=o,this.payeeListService=c,this.payBillService=l,this.billHistoryService=u,this.accountService=d,this.userService=h,this.EventBusService=f,this.AddBillerDialogService=p,this.dateService=S,this.serviceConstants=v,this.CAPABILITIES=_.CAPABILITIES,this.ACCOUNT_TYPES=g.ACCOUNT_TYPES,this.CC_VALUE=m.CC_VALUE,this.bpHistoryFilter=m.BILL_HISTORY_FILTER,this.billPayConstants=m,this.isNickName2Long=!1,this.showAddBPModal=!1,this.showSendEmtModal=!1,this.showSingleBPModal=!1,this.showPayeeDetail=!1,this.showLanding=!0,this.payeeList=[],this.upcomingPaymentList=[],this.upcomingBillsTitle="",this.currentMonth="",this.searchTerm="",this.isSchedule=!1,this.nickNameMaxLen=g.NICKNAME_MAX_LEN,this.accountHelpersService=T,this.addBillPayeeCapabilities=[this.CAPABILITIES.PERSON_UPDATE_FULL,this.CAPABILITIES.PERSON_UPDATE_BASIC,this.CAPABILITIES.PERSON_UPDATE_PARTIAL,this.CAPABILITIES.PERSON_UPDATE_MINIMUM,this.CAPABILITIES.PERSON_UPDATE_LIMITED]}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;return this.currentMonth=moment().format("MMMM"),this.EventBusService.subscribe(this.$scope,this.billPayConstants.EVENTS.REFRESH_PAYEES,(function(){t.upcomingPaymentList=[],t.isLoadingData=!0,t.$q.all([t._requestAccounts(),t._requestPayees()]).finally((function(){t.isLoadingData=!1}))})),this.isLoadingData=!0,this.$q.all([this._requestCapabilities(),this._requestPayees(),this._requestAccounts(),this.accountService.prepareAccountBalance()]).finally((function(){t.isLoadingData=!1}))}},{key:"showEmtModal",value:function(){this.showSendEmtModal=!0}},{key:"_isFrench",value:function(){return this.LocaleService.locale===this.LOCALES.FR_CA}},{key:"dateFormatter",value:function(){return this._isFrench()?this.DATE_FORMAT_STRINGS.fr:this.DATE_FORMAT_STRINGS.en}},{key:"_handleLoadPayees",value:function(t,e){var n=this;this.$log.debug("Payee data:",t),this.$log.debug("Transaction history data:",e),t.payees?(this.payeeList=t.payees,this.payeeList=this._addEffectiveDate(this.payeeList,e),this.upcomingBillsTitle={text:this.$translate.instant("billPay.landingPage.scheduledPayments")},this.payeeList=this.payeeList.map((function(t){return(0,i.default)({},t,{recurring:!!e.find((function(e){return(e.to_account.number===t.account_number||e.to_account.number===t.account_token)&&"ONCE"!==e.frequency}))})})),this._checkForCC(this.payeeList).then((function(){n.isLoadingData=!1})).catch((function(t){n.$log.error(t)}))):(this.$log.debug("No payees received in Payee data!"),this.isLoadingData=!1)}},{key:"_addEffectiveDate",value:function(t,e){var n=this,i=t,a=e;return i.forEach((function(t){var i=t;i.pendingTransactions=[],a.forEach((function(a,s){(e[s].to_account.number&&t.account_number===e[s].to_account.number||e[s].to_account.payee_id&&t.id===e[s].to_account.payee_id||e[s].to_account.number&&t.account_token===e[s].to_account.number)&&(!t.last_payment_date||a.effective_date>t.last_payment_date)&&(i.pendingTransactions.push({date:a.effective_date,amount:n._getTransactionAmount(a)}),n.upcomingPaymentList.push({text:n._formatPayee(t.nickname,t.name,t.account_number),value:n._getTransactionAmount(a),date:a.effective_date})),i.pendingTransactions.sort((function(t,e){return new Date(t.date)-new Date(e.date)})),n.upcomingPaymentList.sort((function(t,e){return new Date(t.date)-new Date(e.date)})),n.upcomingPaymentList.length>15&&(n.upcomingPaymentList=n.upcomingPaymentList.slice(0,15))}))})),i}},{key:"_getTransactionAmount",value:function(t){switch(t.paymentIndicator){case this.billPayConstants.PAYMENT_INDICATOR.MINIMUM_PAYMENT:return this.$translate.instant("billPay.payeeDetails.minimumPayment");case this.billPayConstants.PAYMENT_INDICATOR.FULL_BALANCE:return this.$translate.instant("billPay.payeeDetails.fullBalance");default:return t.amount?this.$filter("currency")(t.amount):t.amount}}},{key:"_formatPayee",value:function(t,e,n){var i=e.length>15?e.substring(0,15).concat("..."):e;return(t||i)+" "+this.accountHelpersService.getMaskedAccountNumber(n)}},{key:"_checkForCC",value:function(t){var e=this,n=this.$q.defer(),i=[];return t.forEach((function(t,n){t.vendor_id===e.CC_VALUE.ID&&t.account_token&&i.push(e._getCCDetails(t.account_token).then((function(t){e._processCCAccountDetails(t,n)})))})),this.$q.all(i).then((function(){e.$log.debug("all promises have resolved"),n.resolve()})).catch((function(t){e.$log.error(t)}))}},{key:"_getCCDetails",value:function(t){return this.payBillService.getAccountDetails(t)}},{key:"_getTransactionHistory",value:function(){return this.billHistoryService.getScheduledPayments()}},{key:"_processCCAccountDetails",value:function(t,e){this.$log.info("Credit Card info",t),this.payeeList[e].ACCOUNT_DETAILS=t.account_summary}},{key:"_requestCapabilities",value:function(){var t=this;return this.userService.getCapabilities().then((function(e){var n=e.capabilities;t.displayActionableButtons=-1!==n.indexOf(t.CAPABILITIES.BILLPAY_TRANSACT),t.canAddBillPayee=!(-1!==n.indexOf(t.CAPABILITIES.KYC_PENDING))&&-1!==n.indexOf(t.CAPABILITIES.BILLPAY_TRANSACT)&&t.addBillPayeeCapabilities.some((function(t){return-1!==n.indexOf(t)}))})).catch((function(){t.canAddBillPayee=!1}))}},{key:"_requestAccounts",value:function(){var t=this,e=this.$log;return this.accountService.getAccounts().then((function(e){t._processAccounts(e)})).catch((function(t){e.error(t)}))}},{key:"_requestPayees",value:function(){var t=this;return this.$q.all({payeeResp:this.payeeListService.getPayees(),transResp:this._getTransactionHistory()}).then((function(e){var n=e.transResp.pending_transactions.filter((function(e){return e.type===t.bpHistoryFilter.BP||e.type===t.bpHistoryFilter.CC_BP}));t._handleLoadPayees(e.payeeResp,n)})).catch((function(e){t.$log.error("Error requesting payees",e)}))}},{key:"_processAccounts",value:function(t){var e=this;this.$log.debug("From Accounts: ",t),this.fromAccounts=t.fromAccounts.filter((function(t){return t.type===e.ACCOUNT_TYPES.CHEQUING}))}},{key:"hasPayee",value:function(){return this.payeeList&&this.payeeList.length>0}},{key:"onAddBPModalClose",value:function(t){this.$log.debug("examples onModalClose:",t),this.showAddBPModal=!1}},{key:"showSingleBillPay",value:function(t,e){t.stopPropagation(),this.AddBillerDialogService.initialState=this.AddBillerDialogService.STATES.SET_UP_PAYMENT,this.AddBillerDialogService.selectedPayee=e,this.AddBillerDialogService.singleBillPay=!0,this.showAddBillPay()}},{key:"showAddBillPay",value:function(){this.showAddBPModal=!0}},{key:"showPayeeDetailSection",value:function(t){this.payee=t,this.payee.fromAccounts=this.fromAccounts,this.$state.go("billHistory",{payeeId:this.payee.id,payee:this.payee})}},{key:"showEmptyStateSplash",value:function(){return!(this.isLoadingData||this.payeeList&&0!==this.payeeList.length)}}]),t}();o.$inject=["$log","$q","$state","$scope","$filter","$translate","PayeeListService","PayBillService","BillHistoryService","BillPayAccountsService","UserService","EventBusService","AddBillerDialogService","accountConstants","billPayConstants","menuConstants","serviceConstants","DateService","AccountHelpersService"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(2223)),a=c(n(2227)),s=c(n(2231)),r=c(n(2232)),o=c(n(2233));function c(t){return t&&t.__esModule?t:{default:t}}var l=angular.module("bill-pay-add-bill",[]).component("addBillPayModal",i.default).component("payeeSearch",a.default).service("AddBillPayFlowService",s.default).service("BillPayService",r.default).directive("tngInfinityScroll",o.default);e.default=l,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2224)),a=s(n(2225));function s(t){return t&&t.__esModule?t:{default:t}}n(2226);var r={controller:a.default,template:i.default,bindings:{onClose:"&",fromAccounts:"<?",isFinancialPlan:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog class="m-bill-pay" hide-close="$ctrl.flowService.showConfirmExitUI || $ctrl.flowService.inLoadingMode" on-close="$ctrl.onModalClose(result)" scroll-id="add-bill-modal-event" flow-service="$ctrl.flowService"> <header> <span ng-if="$ctrl.flowService.showMainUI" id="addBillModal-title"> {{$ctrl.getHeaderText()}} </span> </header> <div ng-if="!$ctrl.flowService.showConfirmExitUI && $ctrl.flowService.showMainUI"> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.SEARCH"> <payee-search class="m-bill-pay__search" payee-selected="$ctrl.searchValueChanged(payee)" province-selected="$ctrl.provinceValueChanged(code)" search-value="$ctrl.searchValueUpdated(value)" recommend-payee="$ctrl.recommendPayee(payee)"> </payee-search> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.RECOMMEND_START"> <label for="recommend_addBill" class="margin__tb--fix2"> {{ ::\'billPay.addBill.recommendTellUs\' | translate }} </label> <p class="heading--sub3 margin__tb--fix2">{{ ::\'billPay.addBill.payeeName\' | translate }}</p> <input id="recommend_addBill" class="input" type="text" name="amount-input" ng-change="$ctrl.recommendPayeeOnChange()" ng-model="$ctrl.selected.recommended"> <div ng-show="$ctrl.selected.recommended.trim().length === 0" class="field__error"> <p ng-message="pattern"> {{ ::\'global.validation.required\' | translate}} </p> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.RECOMMEND_END"> <span class="margin__tb--fix2"> {{ ::\'billPay.addBill.weWillInvestigate\' | translate }} </span> <div class="panel m-bill-pay__panel margin__t--fix2"> <div class="m-bill-pay__tile-description">{{ ::\'billPay.addBill.payeeName\' | translate}}</div> <span class="m-bill-pay__tile-orange heading--sub2">{{ $ctrl.selected.recommended }}</span> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.NUMBER"> <div class="c-bill-pay__error" ng-show="$ctrl.ModalErrorHandlerService.hasErrors()"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.ModalErrorHandlerService.submitErrors track by $index">{{ error }}</li> </ul> </tng-error-message> </div> <span ng-bind-html="\'billPay.addBill.whatIsYourAccountNumber\' | translate:{ name: $ctrl.selected.payeeName }"> </span> <form name="$ctrl.accountForm" ng-submit="$ctrl.flowService.submit()"> <div class="m-bill-pay__input margin__t--fix2"> <span class="m-bill-pay__prefix family-fancy" ng-class="{\'sizeChanged\':$ctrl.sizeChanged}"> # </span> <input class="input m-bill-pay__amount-input family-fancy" type="text" ng-pattern="/^[a-zA-Z0-9]*$/" actionable-id="addBill_accountNumber" placeholder="123456-123456" maxlength="30" ng-class="{\'sizeChanged\':$ctrl.sizeChanged}" ng-model="$ctrl.accountNumber" ng-change="$ctrl.accountNumChanged($ctrl.accountNumber)" autofocus> </div> <div ng-messages="$ctrl.accountForm.addBill_accountNumber.$error" ng-show="$ctrl.accountForm.addBill_accountNumber.$dirty" class="field__error"> <p ng-message="pattern"> {{ ::\'billPay.addBill.validationErrorAccountNumber\' | translate}} </p> </div> </form> <span class="field__error" ng-if="$ctrl.selected.payee.hint"> {{$ctrl.selected.payee.hint}} </span> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.NICKNAME"> <tng-error-message ng-show="$ctrl.isNickName2Long"> <span ng-bind-html="\'billPay.addBill.validationErrorLongNickname\' |  translate"> </span> </tng-error-message> <tng-error-message ng-show="$ctrl.isNickNameInvalidChars"> <span ng-bind-html="\'billPay.addBill.validationErrorNickname\' |  translate"></span> </tng-error-message> <form name="$ctrl.nicknameForm" ng-submit="$ctrl.flowService.submit()"> <div class="m-bill-pay__input"> <input type="text" class="input m-bill-pay__amount-input m-bill-pay__amount-input--nickname family-fancy" placeholder="{{$ctrl.selected.payee.name}}" autofocus maxlength="{{$ctrl.nickNameMaxLen}}" ng-pattern="$ctrl.lettersNumbersSpacesPattern" actionable-id="addBill_accountNickname" ng-model="$ctrl.selected.nickname" ng-change="$ctrl.nickNameChanged($ctrl.selected.nickname)"/> <div ng-messages="$ctrl.nicknameForm.addBill_accountNickname.$error" ng-show="$ctrl.nicknameForm.addBill_accountNickname.$dirty" class="field__error"> <p ng-message="pattern"> {{ ::\'billPay.addBill.validationErrorNickname\' | translate}} </p> </div> </div> </form> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.HOW_PAY" class="m-bill-pay__container-6"> <tng-tile-list tile-data="$ctrl.paymentTypeTiles" tile-type="this.tileListConstants.TILE_TYPE.text" is-actionable="true" on-tile-click="$ctrl.onPaymentType(index)" is-disabled="$ctrl.tileListIsDisabled(index)"> </tng-tile-list> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.SCHEDULE" class="m-bill-pay__container-6"> <span ng-bind-html="\'billPay.addBill.setUpPayment\' | translate:{ name: $ctrl.selected.payee.name }"> </span> <tng-tile-list tile-data="$ctrl.setupPaymentTiles" tile-type="this.tileListConstants.TILE_TYPE.text" is-actionable="true" on-tile-click="$ctrl.setUpPayment(index)"> </tng-tile-list> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.FROM" class="m-bill-pay__container-6"> <p class="body--2">{{ \'billPay.addBill.chooseAccount\' | translate }}</p> <tng-tile-list tile-data="$ctrl.fromAccounts" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.onAccountSelect(tileData)" selected-tiles="$ctrl.selectedAccounts" all-actionable="true"> </tng-tile-list> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DATE"> <span ng-if="$ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.MANUAL" class="m-bill-pay__date-header" ng-bind-html="\'billPay.addBill.selectDate\' | translate:{ name: $ctrl.selected.payeeName }"> </span> <tng-date-selector class="no-top-margin" selected-date="$ctrl.selected.scheduledStartDate" min-date="$ctrl.today" end-date="$ctrl.selected.scheduledEndDate" frequency="$ctrl.selected.frequency" on-date-change="$ctrl.onDateChange(selectionMode)" selection-mode="$ctrl.selected.datePickerSelectionMode" hide-frequency-selector="!$ctrl.selected.isRecurring" hide-selection-mode-selector="!$ctrl.selected.isRecurring" selection-mode-exclude-single="$ctrl.selected.isRecurring" frequency-exclude-daily="true" frequency-exclude-none="true" frequency-quarterly-and-yearly-excluded="true" single-month-view-enabled="true"></tng-date-selector> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.AMOUNT" class="m-bill-pay__container-6"> <div ng-if="!$ctrl.isCCOngoingMonthly"> <span ng-if="($ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.MANUAL)" ng-bind-html="\'billPay.states.amountStateManual\' | translate:{\n            payeeName: $ctrl.selected.payee.name,\n            payDate: $ctrl.selected.scheduledStartDate\n          }"> </span> <span ng-if="$ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.AUTO" ng-bind-html="\'billPay.states.amountStateAuto\' | translate:{\n            payeeName: $ctrl.selected.payee.name,\n            frequency: (\'billPay.transactionFrequencies.\' + $ctrl.selected.frequency | translate).toLowerCase()\n          }"> </span> <div class="c-bill-pay__error" ng-show="$ctrl.ModalErrorHandlerService.hasErrors()"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.ModalErrorHandlerService.submitErrors track by $index">{{ error }}</li> </ul> </tng-error-message> </div> <form ng-submit="$ctrl.flowService.submit()"> <tng-amount-input set-value="$ctrl.selected.amount" input-max-length="9" autofocus on-amount-change="$ctrl.onAmountChange(amount)"> </tng-amount-input> </form> </div> <div ng-if="$ctrl.isCCOngoingMonthly"> <tng-tile-list tile-data="$ctrl.recurringCCButtonTiles" tile-type="this.TILE_TYPE.text" is-actionable="true" on-tile-click="$ctrl.handleRecurringCCTileClick(index)"> </tng-tile-list> <p class="margin__t--fix2">{{ \'billPay.singleBPCC.recurringCCButtons.footer\' | translate }}</p> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW"> <div class="c-bill-pay__error" ng-show="$ctrl.flowService.submitWarnings"> <tng-warning-message> {{::\'global.errorCodes.WARNING_DUPTRAN\' | translate }} </tng-warning-message> </div> <div class="c-bill-pay__error" ng-show="$ctrl.ModalErrorHandlerService.hasErrors()"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.ModalErrorHandlerService.submitErrors track by $index">{{ error }}</li> </ul> </tng-error-message> </div> <p ng-if="$ctrl.selected.paymentSetup === $ctrl.SETUP_PAYMENT.NOW" translate translate-values="{\n            payeeName: $ctrl.selected.payee.name\n          }"> {{ \'billPay.reviewAddPayeeNow\' }} </p> <p ng-if="$ctrl.selected.paymentSetup === $ctrl.SETUP_PAYMENT.LATER" translate translate-values="{\n            payeeName: $ctrl.selected.payee.name,\n          }"> {{ \'billPay.reviewAddPayeeLater\' }} </p> <p ng-if="$ctrl.selected.paymentSetup === $ctrl.SETUP_PAYMENT.ONGOING && !$ctrl.isCCOngoingMonthly" ng-bind-html="\'billPay.reviewAddPayeeOngoing\' | translate:{\n            payeeName: $ctrl.selected.payee.name,\n            amount: $ctrl.selected.amount,\n            frequency: (\'billPay.transactionFrequencies.\' + $ctrl.selected.frequency | translate).toLowerCase()\n        }"> </p> <p ng-if="$ctrl.isCCOngoingMonthly && $ctrl.selected.payment_indicator == \'F\'"> <span ng-bind-html="\'billPay.singleBPCC.descCCPayFull\' | translate"> </span> </p> <p ng-if="$ctrl.isCCOngoingMonthly && $ctrl.selected.payment_indicator == \'M\'"> <span ng-bind-html="\'billPay.singleBPCC.descCCPayMinimum\' |  translate"> </span> </p> <div class="m-bill-pay__container-6"> <div class="margin__b--fix1" id="addBillModal-amount-tile" ng-if="($ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.MANUAL && $ctrl.selected.paymentSetup === $ctrl.SETUP_PAYMENT.NOW)\n                    || ($ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.AUTO && !$ctrl.isCCOngoingMonthly)" ng-click="$ctrl.goToAmountState()"> <tng-tile-list tile-data="$ctrl.amountTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.amount" all-actionable="true"> </tng-tile-list> </div> <div class="panel m-bill-pay__panel" id="addBillModal-payeeName-tile" ng-click="$ctrl.flowService.moveTo($ctrl.flowService.STATES.NICKNAME)"> <div class="m-bill-pay__panel-body"> <div class="m-bill-pay__tile-description body--4">{{ \'billPay.addBill.billPayee\' | translate}}</div> <span class="heading--sub3">{{$ctrl.selected.payee.name }}</span> <div class="body--4">{{ $ctrl.selected.nickname }}</div> </div> <i class="m-bill-pay__chevron large icon-rightarrow"></i> </div> <div class="panel m-bill-pay__panel" id="addBillModal-accountNumber-tile" ng-click="$ctrl.flowService.moveTo($ctrl.flowService.STATES.NUMBER); $ctrl.enableOrangeButton()"> <div class="m-bill-pay__panel-body"> <div class="m-bill-pay__tile-description body--4"> {{ \'billPay.addBill.accountNumber\' | translate}} </div> <span class="m-bill-pay__tile-orange heading--sub2">{{$ctrl.selected.accountNumber }}</span> </div> <i class="m-bill-pay__chevron large icon-rightarrow"></i> </div> <div class="margin__b--fix1" id="addBillModal-payFromAccount-tile" ng-if="($ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.MANUAL && $ctrl.selected.paymentSetup === $ctrl.SETUP_PAYMENT.NOW)\n                    || $ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.AUTO"> <tng-tile-list tile-data="$ctrl.selected.payFromAccount" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.flowService.moveTo($ctrl.flowService.STATES.FROM)" all-actionable="true"> </tng-tile-list> </div> <div class="panel m-bill-pay__panel" id="addBillModal-paymentType-tile" ng-click="$ctrl.flowService.moveTo($ctrl.flowService.STATES.HOW_PAY)"> <div class="m-bill-pay__panel-body"> <div class="m-bill-pay__tile-description body--4"> {{ \'billPay.addBill.paymentType\' | translate}} </div> <span ng-if="$ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.MANUAL" class="heading--sub3"> {{ \'billPay.addBill.manual\' | translate}} </span> <span ng-if="$ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.AUTO" class="heading--sub3"> {{ \'billPay.addBill.auto\' | translate}} </span> </div> <i class="m-bill-pay__chevron large icon-rightarrow"></i> </div> <div class="panel m-bill-pay__panel" id="addBillModal-manual-tile" ng-if="$ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.MANUAL\n             && $ctrl.selected.paymentSetup === $ctrl.SETUP_PAYMENT.NOW" ng-click="$ctrl.flowService.moveTo($ctrl.flowService.STATES.DATE)"> {{::\'billPay.addBill.payOn\' | translate }}<span class="heading--sub3">{{$ctrl.selected.scheduledStartDate|momentDate:\'longDate\' }}</span> <i class="m-bill-pay__chevron large icon-calendar"></i> </div> <div class="panel m-bill-pay__panel" id="addBillModal-auto-tile" ng-if="$ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.AUTO && !$ctrl.isCCOngoingMonthly" ng-click="$ctrl.flowService.moveTo($ctrl.flowService.STATES.DATE)"> <div class="m-bill-pay__panel-body"> <div class="m-bill-pay__tile-description body--4"> {{::\'global.transactionFrequencies.\' + $ctrl.selected.frequency | translate }} </div> <span class="heading--sub3"> {{ \'billPay.addBill.paidStart\' | translate }} {{ $ctrl.selected.scheduledStartDate | momentDate:\'longDate\' }} </span> <div class="m-bill-pay__tile-description body--4" ng-if="$ctrl.selected.datePickerSelectionMode === $ctrl.selectionMode.RANGE"> {{ \'billPay.addBill.paidEnd\' | translate}} {{$ctrl.selected.scheduledEndDate | momentDate:\'longDate\'}} </div> <div class="m-bill-pay__tile-description body--4" ng-if="$ctrl.selected.datePickerSelectionMode === $ctrl.selectionMode.INDEFINITE"> {{ ::\'global.datePicker.continueIndefinitely\' | translate }} </div> </div> <i class="m-bill-pay__chevron large icon-calendar"></i> </div> </div> <p class="c-billPay-disclaimer"> {{ ::\'billPay.ccReminder\' | translate }} </p> </div> <div id="printMe" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DONE"> <div class="c-bill-pay__error" ng-show="$ctrl.ModalErrorHandlerService.hasErrors()"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.ModalErrorHandlerService.submitErrors track by $index">{{ error }}</li> </ul> </tng-error-message> </div> <div> <span ng-if="$ctrl.selected.paymentSetup === $ctrl.SETUP_PAYMENT.NOW" class="m-bill-pay__container-8 margin__b--fix2"> <span ng-bind-html="\'billPay.addBill.allDone\'| translate:{\n                name: $ctrl.selected.payee.name,\n                payDate: $ctrl.selected.scheduledStartDate,\n                payAmount: $ctrl.selected.amount }"> </span> <a href="" class="body--callout" ng-click="$ctrl.goToPayBillsPage()">{{ ::\'billPay.addBill.allDoneAnchor\' | translate }}</a>. </span> <span ng-if="$ctrl.selected.paymentSetup === $ctrl.SETUP_PAYMENT.LATER" class="m-bill-pay__container-8 margin__b--fix2"> <span ng-bind-html="\'billPay.addBill.allDoneWithoutAmount\'| translate:{name: $ctrl.selected.payee.name}"> </span> <a href="" class="body--callout" ng-click="$ctrl.goToPayBillsPage()">{{ ::\'billPay.addBill.allDoneAnchor\' | translate }}</a>. </span> <span ng-if="$ctrl.selected.paymentSetup === $ctrl.SETUP_PAYMENT.ONGOING" class="m-bill-pay__container-8 margin__b--fix2"> <span ng-bind-html="\'billPay.addBill.allDoneOngoing\'| translate:{\n                name: $ctrl.selected.payee.name}"> </span> <a href="" class="body--callout" ng-click="$ctrl.goToPayBillsPage()">{{ ::\'billPay.addBill.allDoneAnchor\' | translate }}</a>. </span> </div> <div class="c-balance-grid confirm__table"> <div class="c-balance-grid__table-column-top"> <span class="c-balance-grid__table-column-top-left"> <strong>{{ ::$ctrl.selected.nickname }}</strong> {{ ::$ctrl.selected.payee.name}} </span> <span class="c-balance-grid__table-column-top-right" id="addBillModal-done-now-firstPayment-label" ng-if="$ctrl.selected.paymentSetup === $ctrl.SETUP_PAYMENT.NOW && $ctrl.selected.paymentType !== $ctrl.PAYMENT_TYPE.AUTO"> <strong>{{ \'billPay.addBill.firstPayment\' | translate}} </strong> {{ ::$ctrl.selected.scheduledStartDate | momentDate:\'longDate\'}} </span> <span class="c-balance-grid__table-column-top-right" id="addBillModal-done-auto-frequency-label" ng-if="$ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.AUTO"> {{ \'billPay.confirmationFrequency.\' + $ctrl.selected.frequency | translate }} {{ ::\'billPay.from\' | translate }} {{ ::$ctrl.selected.scheduledStartDate | momentDate:\'longDate\'}} <span ng-if="$ctrl.selected.datePickerSelectionMode === $ctrl.selectionMode.RANGE"> {{ ::\'billPay.to\' | translate }} {{ ::$ctrl.selected.scheduledEndDate | momentDate:\'longDate\'}} </span> </span> </div> <div ng-if="$ctrl.selected.confirmationNumber" class="c-balance-grid__table-column-top"> <div class="print-sub-header">{{ \'billPay.singleBP.confirmationNumber\' | translate }}  {{ $ctrl.selected.confirmationNumber }}</div> <span class="c-balance-grid__table-column-top-left confirmed--title" id="addBillModal-done-confirmationNumber-label"> {{ \'billPay.singleBP.confirmationNumber\' | translate }} <span class="body--callout2" id="addBillModal-done-confirmationNumber">{{ $ctrl.selected.confirmationNumber }}</span> </span> <span class="c-balance-grid__table-column-top-right"> <span>{{ \'billPay.currentBalance\' | translate }}</span> <span class="body--callout2">{{ $ctrl.selected.payFromAccount.account_balance | currency }}</span> </span> </div> <div class="c-balance-grid__table"> <div class="c-balance-grid__table-column c-balance-grid__table-column"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title">{{ \'billPay.addBill.accountNumber\' | translate}}</p> <p class="c-balance-grid__value"> {{ ::$ctrl.selected.accountNumber}} </p> </div> </div> <div ng-if="$ctrl.hasPayFromAccounts()" class="c-balance-grid__table-column c-balance-grid__table-column--account c-balance-grid__table-column--has-left-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title">{{ \'billPay.payFrom\' | translate}} </p> <p class="c-balance-grid__value">{{ ::$ctrl.getNickname() }} {{ ::$ctrl.getMaskedAccountNumber() }}</p> </div> </div> <div class="c-balance-grid__table-column c-balance-grid__table-column--has-left-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title">{{ \'billPay.addBill.paymentType\' | translate}}</p> <p class="c-balance-grid__value" id="addBillModal-done-paymentType"> <span ng-if="$ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.MANUAL"> {{ \'billPay.addBill.manual\' | translate}} </span> <span ng-if="$ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.AUTO"> {{ \'billPay.addBill.auto\' | translate}} </span> </p> </div> </div> <div class="c-balance-grid__table-column c-balance-grid__table-column--has-left-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title">{{ \'billPay.addBill.firstPaymentAmount\' | translate}}</p> <p ng-if="$ctrl.hasAmount()" class="c-balance-grid__value" id="addBillModal-done-amount"> {{ ::$ctrl.selected.amount | currency }} </p> <p ng-if="!$ctrl.hasAmount()" class="c-balance-grid__value" id="addBillModal-done-amount-na"> {{ \'billPay.addBill.firstPaymentAmountNA\' | translate}} </p> </div> </div> </div> </div> <tng-print-button only-element="\'printMe\'"> {{ \'global.components.buttons.print\' | translate }} </tng-print-button> </div> </div> <div ng-show="$ctrl.flowService.inLoadingMode" class="c-review-state"> <div ng-show="$ctrl.flowService.isLoading"> <tng-loading-in-progress is-loading-key="billPay.states.interstitialLoadingState"></tng-loading-in-progress> </div> </div> <footer ng-hide="$ctrl.flowService.showConfirmExitUI"> <button class="btn btn--edit" actionable-id="{{$ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_GRY.type.label)}}" watch-actionable-id="true" ng-show="$ctrl.flowService.BUTTONS.BTN_GRY.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_GRY.disable" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_GRY)"> {{ $ctrl.flowService.BUTTONS.BTN_GRY.type.label | translate }} </button> <button class="btn btn--orange" ng-class="{\'CB_ReadOnly\': $ctrl.flowService.CB_DISABLED_BUTTONS.includes($ctrl.flowService.BUTTONS.BTN_ORG.type)}" actionable-id="{{$ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_ORG.type.label)}}" watch-actionable-id="true" ng-show="$ctrl.flowService.BUTTONS.BTN_ORG.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_ORG.disable" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_ORG)"> {{ $ctrl.flowService.BUTTONS.BTN_ORG.type.label | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(0)),a=o(n(2)),s=o(n(45)),r=n(67);function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,a,o,c,l,u,d,h,f,p,g,m,_,v,S,T,y,E,A,b){(0,i.default)(this,t),this.$log=e,this.$filter=n,this.$state=d,this.$translate=m,this.$sce=v,this.$q=E,this.ModalErrorHandlerService=S,this.isNickName2Long=!1,this.isNickNameInvalidChars=!1,this.ACCOUNT_TYPES=_.ACCOUNT_TYPES,this.nickNameMaxLen=_.NICKNAME_MAX_LEN,this.flowService=a,this.accountService=o,this.billPayService=l,this.accountHelpersService=c,this.selectionMode=u.DATE_SELECTOR_MODES,this.stateConstants=p,this.billPayConstants=h,this.PAYMENT_TYPE=this.billPayConstants.PAYMENT_TYPE,this.SETUP_PAYMENT=this.billPayConstants.SETUP_PAYMENT,this.FREQUENCY_MODE_CONSTANTS=this.billPayConstants.FREQUENCY,this.RECURRING_CC_BUTTONS=this.billPayConstants.RECURRING_CC_BUTTONS,this.CC_VALUE=h.CC_VALUE,this.tileListConstants=f,this.SETUP_PAYMENT_TYPES=this.billPayConstants.SETUP_PAYMENT_TYPES,this.PAYMENT_TYPES=this.billPayConstants.PAYMENT_TYPES,this.PAYMENT_INDICATOR=h.PAYMENT_INDICATOR,this.GOOD_STATUS_CODES=g,this.amountMaxLen=_.AMOUNT_MAX_LEN,this.excludedFrequency=this.FREQUENCY_MODE_CONSTANTS.DAILY,this.DateService=T,this.EventBusService=y,this.lettersNumbersSpacesPattern=r.lettersNumbersSpacesPattern,this.recurringCCButtonTiles=[this.RECURRING_CC_BUTTONS.MINIMUM,this.RECURRING_CC_BUTTONS.FULL],this.BackButtonService=A,this.backButtonConstants=b,this.isFinancialPlan&&(this.flowService.isFinancialPlan=!0),this.selected={toAccount:[],amount:0,datePickerSelectionMode:"",currency:{},when:h.WHEN.LATER,isRecurring:!1,paymentSetup:this.isFinancialPlan?this.SETUP_PAYMENT.LATER:this.SETUP_PAYMENT.NOW,paymentType:this.PAYMENT_TYPE.MANUAL,payee:{},recommended:"",frequency:this.FREQUENCY_MODE_CONSTANTS.MONTHLY,scheduledStartDate:(0,s.default)(),scheduledEndDate:(0,s.default)().add(1,"M")},this.selectedAccounts=[],this.setupPaymentTiles=[this.SETUP_PAYMENT_TYPES.NOW,this.SETUP_PAYMENT_TYPES.LATER],this.paymentTypeTiles=[this.PAYMENT_TYPES.MANUAL,this.PAYMENT_TYPES.AUTO],this.amountTile=[{header:this.$translate.instant("billPay.addBill.amount"),amount:0}],this.frequencyString="global.datePicker.frequencies."+this.selected.frequency.toLowerCase(),this.submitErrors=[],this.sizeChanged=!1}return(0,a.default)(t,[{key:"$onInit",value:function(){this.fromAccounts||this._requestAccounts(),this._reset(),this.flowService.activate(),this.setSelectedAccount(),this.$log.log(this.fromAccounts),this.today=(0,s.default)(),this._setupNativeBackButton()}},{key:"$onDestroy",value:function(){this.flowService.deactivate(),this.ModalErrorHandlerService.resetSubmitErrors()}},{key:"_setupNativeBackButton",value:function(){var t=this;this.BackButtonService.addBackButtonListener(this.$scope,this.backButtonConstants.PRIORITY.HIGH,(function(){return t._handleNativeBackButtonClick()}))}},{key:"_handleNativeBackButtonClick",value:function(){return this.flowService.isDoneButtonVisible?this.onButtonClick(this.flowService.BUTTONS.BTN_ORG):this.flowService.BUTTONS.BTN_GRY.show&&this.onButtonClick(this.flowService.BUTTONS.BTN_GRY),!0}},{key:"_reset",value:function(){this.selected&&(this.selected.nickname=void 0,this.selected.amount=void 0),this.accountNumber=void 0,delete this.flowService.nickname}},{key:"_close",value:function(){var t=this,e=this.flowService;(e.currentState===e.STATES.SEARCH&&this.searchValue||e.currentState===e.STATES.SEARCH&&this.selected.province)&&e.showWarning(),e.showConfirmExitUI?e.denyExit():e.warn().then((function(){if(t.isFinancialPlan){var n={payeeCreated:t.newBillPayeeCreated};t.onClose({result:n})}else t.onClose();e.returnToStart()}))}},{key:"_requestAccounts",value:function(){var t=this,e=this.$log;this.accountService.getAccounts().then((function(e){t._processAccounts(e)})).catch((function(t){e.error(t)}))}},{key:"_processAccounts",value:function(t){var e=this;this.$log.debug("From Accounts: ",t),this.fromAccounts=t.fromAccounts.filter((function(t){return t.type===e.ACCOUNT_TYPES.CHEQUING}))}},{key:"_resetSelected",value:function(){this.selected={toAccount:[],amount:0,currency:{},when:this.billPayConstants.WHEN.LATER,paymentSetup:this.isFinancialPlan?this.SETUP_PAYMENT.LATER:this.SETUP_PAYMENT.NOW,paymentType:this.PAYMENT_TYPE.MANUAL,payee:{},recommended:"",frequency:this.FREQUENCY_MODE_CONSTANTS.MONTHLY,scheduledStartDate:(0,s.default)(),scheduledEndDate:(0,s.default)().add(1,"M")},this.flowService.returnToStart(),delete this.flowService.nickname}},{key:"onModalClose",value:function(){this._close()}},{key:"hasAmount",value:function(){return this.selected.amount>0}},{key:"_validatePayee",value:function(){var t=this,e=this.$log,n=this.flowService,i=this.billPayService,a=this.GOOD_STATUS_CODES;return n.BUTTONS.BTN_ORG.disable=!0,this.ModalErrorHandlerService.resetSubmitErrors(),this.flowService.showLoadingSpinner(),i.createPayee(this.selected,!0).then((function(e){-1===a.TRANSACTION_STATUS_CODES.indexOf(e.response_status.status_code)?(t.ModalErrorHandlerService.showSubmitErrors(e),n.exitLoadingMode(),n.moveTo(n.STATES.NUMBER)):n.gotoNextState()})).catch((function(n){t.ModalErrorHandlerService.showSubmitErrors(n),e.error(n)})).finally((function(){return n.exitLoadingMode()}))}},{key:"_createPayee",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.$log,a=this.flowService,s=this.billPayService,r=this.GOOD_STATUS_CODES;return this.resetDuplicateWarning(),i.debug("SUBMIT ACTION"),a.BUTTONS.BTN_ORG.disable=!0,this.ModalErrorHandlerService.resetSubmitErrors(),this.flowService.showLoadingSpinner(),s.createPayee(this.selected,n).then((function(s){return-1===r.TRANSACTION_STATUS_CODES.indexOf(s.response_status.status_code)?(a.exitLoadingMode(),t.ModalErrorHandlerService.showSubmitErrors(s),void a.moveTo(a.STATES.REVIEW)):(t.isFinancialPlan&&"CREATED"===s.response_status.status_code&&(t.newBillPayeeCreated=t.selected,t.newBillPayeeCreated.billPayeeId=s.payeeId),"BP_DUPLICATE_PAYEE_INSTANCE"===s.response_status.status_code?(a.exitLoadingMode(),t.showDuplicateWarning(),void(a.BUTTONS.BTN_ORG.disable=!1)):(e&&(t.selected.payFromAccount=null,t.selected.amount=0),t.selected.payFromAccount?t.isCCOngoingMonthly?t._moveMoneyToPayCC(s):t._validateBillPay(s):(i.debug("SUBMIT COMPLETED",s),a.isLaterPayment=!0,s.response_status.status_code===r.TRANSACTION_STATUS_CODES[1]?a.moveTo(a.STATES.DONE):a.moveTo(a.STATES.REVIEW)),void(n||t.EventBusService.publish(t.billPayConstants.EVENTS.REFRESH_PAYEES))))})).catch((function(e){t.ModalErrorHandlerService.showSubmitErrors(e),i.error(e)})).finally((function(){return a.exitLoadingMode()}))}},{key:"showDuplicateWarning",value:function(){this.flowService.submitWarnings=!0}},{key:"resetDuplicateWarning",value:function(){this.flowService.submitWarnings=!1}},{key:"onDateChange",value:function(t){t===this.selectionMode.INDEFINITE&&delete this.selected.scheduledEndDate}},{key:"onButtonClick",value:function(t){var e=this,n=this.$log,i=this.flowService;switch(t.type){case i.BUTTON_TYPES.BACK:this.ModalErrorHandlerService.resetSubmitErrors(),n.debug("BACK ACTION"),i.gotoPreviousState(),i.currentState===i.STATES.NUMBER&&this.enableOrangeButton();break;case i.BUTTON_TYPES.SKIP:n.debug("SKIP ACTION"),i.gotoNextState();break;case i.BUTTON_TYPES.ADD_ANOTHER_BILL:this._reset(),i.moveTo(i.STATES.SEARCH);break;case i.BUTTON_TYPES.CANCEL:n.debug("CANCEL ACTION"),this._close();break;case i.BUTTON_TYPES.SUBMIT:case i.BUTTON_TYPES.NEXT:if(n.debug("NEXT ACTION"),i.currentState===i.STATES.NUMBER&&this._isTangerineCreditCardPayee()){this.flowService.showLoadingSpinner();var a=this.accountHelpersService.getMaskedCCNumber(this.selected.accountNumber);this.billPayService.getAccountByDisplayName(a).then((function(t){t&&t.number?e.billPayService.getAccountDetails(t.number).then((function(t){e.selected.payee.primaryAccount=t.account_summary.credit_card.cc_account_details.is_primary_account,e.flowService.exitLoadingMode(),i.gotoNextState()})):(e.selected.payee.primaryAccount=!1,e.flowService.exitLoadingMode(),i.gotoNextState())}))}else i.currentState===i.STATES.DATE&&this.selected.scheduledStartDate.format("YY-MM-DD")===(0,s.default)().format("YY-MM-DD")?this.selected.when=this.SETUP_PAYMENT.NOW:i.currentState===i.STATES.NICKNAME&&(this.flowService.nickname=this.selected.nickname?this.selected.nickname:""),i.gotoNextState();break;case i.BUTTON_TYPES.ADD:n.debug("ADD ACTION"),this._createPayee();break;case i.BUTTON_TYPES.CONFIRM:n.debug("CONFIRM ACTION"),this._createPayee();break;case i.BUTTON_TYPES.REVIEW:n.debug("DONE ACTION"),this._createPayee();break;case i.BUTTON_TYPES.DONE:i.STATES.RECOMMEND_END===i.currentState&&this._recommend(),this._close(),this.$state.go(this.$state.current,{},{reload:!0}),i.allowExit();break;default:n.debug("default - NO ACTION")}}},{key:"searchValueChanged",value:function(t){var e=this.flowService;this.$log.debug("selected payee: ",t),this.selected.payee=t,t&&(this.selected.payeeName=t.name,e.BUTTONS.BTN_ORG.disable=!1)}},{key:"provinceValueChanged",value:function(t){this.$log.debug("selected province: ",t),this.selected.province=t}},{key:"searchValueUpdated",value:function(t){this.searchValue=t}},{key:"recommendPayee",value:function(t){var e=this.flowService;this.$log.debug("recommended payee: ",t),this.selected.recommended=t,e.moveTo(e.STATES.RECOMMEND_START)}},{key:"recommendPayeeOnChange",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=0===this.selected.recommended.trim().length}},{key:"accountNumChanged",value:function(t){this.accountForm.addBill_accountNumber.$error.pattern?this.flowService.BUTTONS.BTN_ORG.disable=!0:(this.$log.debug("selected account number: ",t),this.selected.accountNumber=t,this.flowService.BUTTONS.BTN_ORG.disable=!t.length>0,this.selected.accountNumber.length>=18?this.sizeChanged=!0:this.sizeChanged=!1)}},{key:"nickNameChanged",value:function(t){var e="",n=this.flowService;n.BUTTONS.BTN_ORG.disable=!!this.nicknameForm.addBill_accountNickname.$error.pattern,n.nickname=t,""!==t?(this.isNickName2Long=!1,this.isNickNameInvalidChars=!1,t.length>this.nickNameMaxLen?this.isNickName2Long=!0:(e=t.replace(r.lettersNumbersSpacesReplacePattern,""),this.isNickNameInvalidChars=e.length!==t.length),this.selected.nickname=t,n.BUTTONS.BTN_ORG.type=n.BUTTON_TYPES.NEXT):n.BUTTONS.BTN_ORG.type=n.BUTTON_TYPES.SKIP}},{key:"onAmountChange",value:function(t){this.ModalErrorHandlerService.resetSubmitErrors(),this.$log.debug("amount changed: ",t),t&&t>0||this.ModalErrorHandlerService.submitErrors.push(this.$translate.instant("validation.isRequired")),this.selected.amount=t,this.amountTile[0].amount=t,this.flowService.BUTTONS.BTN_ORG.disable=!(t&&t>0)}},{key:"onAccountSelect",value:function(t){var e=this.$log,n=this.$translate;e.debug("account selected: ",t),this.selected.payFromAccount=t,this.selected.payFromAccount.tileDescription=n.instant("billPay.addBill.transferFrom"),this.isCCOngoingMonthly?(this.flowService.moveTo(this.flowService.STATES.AMOUNT),this.flowService.BUTTONS.BTN_ORG.show=!1,this.flowService.STATES.AMOUNT.titleKey="billPay.states.amountStateCCOngoing"):this.flowService.gotoNextState()}},{key:"onPaymentType",value:function(t){var e=this.$log,n=this.flowService;switch(e.debug("payment type selected: ",t),t){case 0:this.selected.paymentType=this.PAYMENT_TYPE.MANUAL,this.selected.datePickerSelectionMode=this.selectionMode.SINGLE,this.selected.isRecurring=!1,this.selected.when=this.SETUP_PAYMENT.LATER,n.moveTo(n.STATES.SCHEDULE);break;case 1:this.selected.paymentType=this.PAYMENT_TYPE.AUTO,this.selected.datePickerSelectionMode=this.selectionMode.INDEFINITE,this.selected.paymentSetup=this.SETUP_PAYMENT.ONGOING,this.selected.when=this.SETUP_PAYMENT.ONGOING,this.selected.isRecurring=!0,n.moveTo(n.STATES.FROM);break;default:e.error("Unrecognized payment type: ",t)}}},{key:"enableOrangeButton",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=!1}},{key:"setUpPayment",value:function(t){var e=this.$log,n=this.flowService;switch(t){case 0:return e.debug("Setup payment: Now"),this.selected.paymentSetup=this.SETUP_PAYMENT.NOW,this.$q.resolve(n.moveTo(n.STATES.FROM));case 1:return e.debug("Setup payment: Later"),this.selected.paymentSetup=this.SETUP_PAYMENT.LATER,this._createPayee(!0,!0);default:return this.$q.resolve(e.error("Unrecognized payment state: ",t))}}},{key:"logDateChangeSingle",value:function(t){this.selected.when=t,this.flowService.BUTTONS.BTN_ORG.disable=!t}},{key:"logDateChangeMulti",value:function(t){this.$log.debug("Date changed! Current Selected/Highlighted days:"),this.$log.debug(t),this.flowService.BUTTONS.BTN_ORG.disable=!t}},{key:"getMaskedAccountNumber",value:function(){return this.accountHelpersService.getMaskedAccountNumber(this.selected.payFromAccount.display_name)}},{key:"getNickname",value:function(){return this.accountHelpersService.getDisplayNameInstant(this.selected.payFromAccount)}},{key:"hasPayFromAccounts",value:function(){return this.selected.payFromAccount}},{key:"getCapitalizedAccountType",value:function(){return this.$filter("normalizeType")(this.selected.payFromAccount.type)}},{key:"getHeaderText",value:function(){var t=this.$log,e=this.flowService,n=this.$translate,i=this.$sce,a=void 0,s=void 0;switch(this.header="",e.currentState){case e.STATES.SEARCH:case e.STATES.NUMBER:s=n.instant("billPay.states.payeeSearchState");break;case e.STATES.NICKNAME:a=n.instant("billPay.states.nickNameState",{name:this.selected.payee.name}),s=i.trustAsHtml(a);break;case e.STATES.HOW_PAY:s=n.instant("billPay.states.howToState");break;case e.STATES.SCHEDULE:s=n.instant("billPay.states.schedule");break;case e.STATES.FROM:s=n.instant("billPay.states.from");break;case e.STATES.DATE:this.selected.paymentType===this.PAYMENT_TYPE.MANUAL&&(s=n.instant("billPay.states.dateStateLater")),this.selected.paymentType===this.PAYMENT_TYPE.AUTO&&(a=n.instant("billPay.states.dateStateRecurring",{name:this.selected.payee.name}),s=i.trustAsHtml(a));break;case e.STATES.AMOUNT:s=n.instant("billPay.states.addPayment");break;case e.STATES.REVIEW:s=n.instant("billPay.states.reviewState");break;case e.STATES.DONE:s=n.instant("billPay.states.doneStateNow");break;case e.STATES.RECOMMEND_START:s=n.instant("billPay.states.recommendStart");break;case e.STATES.RECOMMEND_END:s=n.instant("billPay.states.recommendEnd");break;case e.STATES.INTERSTITIAL_PROCESSING:s="";break;default:t.error("No key for currentState: ",e.currentState),s=""}return s}},{key:"_recommend",value:function(){var t=this.$log;this.billPayService.recommend(this.selected.recommended).then((function(){t.debug("RECOMMENDATION COMPLETED")})).catch((function(e){t.error(e)}))}},{key:"setSelectedAccount",value:function(){this.selectedAccounts=this.fromAccounts&&1===this.fromAccounts.length?this.fromAccounts:[]}},{key:"_validateBillPay",value:function(t){var e=this,n=this.$log,i=this.flowService,a=this.billPayService,s=this.GOOD_STATUS_CODES;n.debug("Validating BillPay"),a.addBillPay(this.selected,t.payeeId,!0).then((function(n){e._hasConfirmationError(n)?(e.ModalErrorHandlerService.showSubmitErrors(n),i.moveTo(i.STATES.REVIEW),i.exitLoadingMode(),i.BUTTONS.BTN_ORG.disable=!0):-1===s.TRANSACTION_STATUS_CODES.indexOf(n.response_status.status_code)?(i.currentState!==i.STATES.REVIEW&&(i.moveTo(i.STATES.REVIEW),i.BUTTONS.BTN_ORG.disable=!0),i.currentState===i.STATES.REVIEW&&(i.moveTo(i.STATES.DONE),i.BUTTONS.BTN_ORG.disable=!1),e.ModalErrorHandlerService.showSubmitErrors(n),i.exitLoadingMode()):e._createBillPay(t)})).catch((function(t){e.ModalErrorHandlerService.showSubmitErrors(t),n.error(t),i.exitLoadingMode(),i.currentState===i.STATES.REVIEW&&i.moveTo(i.STATES.DONE)}))}},{key:"_hasConfirmationError",value:function(t){return(t.confirmations[0].errors||[]).length}},{key:"_moveMoneyToPayCC",value:function(t){var e=this,n=this.$log,i=this.flowService,a=this.billPayService,s=this.GOOD_STATUS_CODES;n.debug("Validating BillPay"),i.showLoadingSpinner();var r=this.accountHelpersService.getMaskedCCNumber(this.selected.accountNumber);a.getAccountPayees(r).then((function(r){a.moveMoney(e.selected,r.account_token,!1).then((function(n){i.exitLoadingMode(),-1===s.TRANSACTION_STATUS_CODES.indexOf(n.response_status.status_code)?(i.currentState!==i.STATES.REVIEW&&(i.moveTo(i.STATES.REVIEW),i.BUTTONS.BTN_ORG.disable=!0),i.currentState===i.STATES.REVIEW&&(i.moveTo(i.STATES.DONE),i.BUTTONS.BTN_ORG.disable=!1),e.ModalErrorHandlerService.showSubmitErrors(n)):e._createBillPay(t)})).catch((function(t){e.ModalErrorHandlerService.showSubmitErrors(t),n.error(t),i.exitLoadingMode(),i.currentState===i.STATES.REVIEW&&i.moveTo(i.STATES.DONE)}))}))}},{key:"_createBillPay",value:function(t){var e=this,n=this.$log,i=this.flowService,a=this.billPayService,s=this.GOOD_STATUS_CODES;n.debug("Creating BillPay"),a.addBillPay(this.selected,t.payeeId,!1).then((function(t){i.exitLoadingMode(),-1===s.TRANSACTION_STATUS_CODES.indexOf(t.response_status.status_code)?(e.ModalErrorHandlerService.showSubmitErrors(t),i.moveTo(i.STATES.REVIEW)):(e.selected.confirmationNumber=t.confirmations[0].confirmation_code,n.debug("Confirmation number: ",e.selected.confirmationNumber),i.moveTo(i.STATES.DONE))})).catch((function(t){e.ModalErrorHandlerService.showSubmitErrors(t),n.error(t),i.exitLoadingMode()}))}},{key:"goToAmountState",value:function(){this.flowService.moveTo(this.flowService.STATES.AMOUNT),this.enableOrangeButton()}},{key:"goToPayBillsPage",value:function(){var t=this;return this.flowService.hideWarning(),this.$state.go(this.stateConstants.BILL_PAY,{},{reload:!0}).then((function(){t.onClose({result:"Finished",goTo:t.stateConstants.BILL_PAY})}))}},{key:"_isCCPrimaryAccountUser",value:function(){return this.selected.payee&&this.selected.payee.primaryAccount}},{key:"_isTangerineCreditCardPayee",value:function(){return this.selected.payee&&this.selected.payee.id===this.CC_VALUE.ID}},{key:"tileListIsDisabled",value:function(t){return!(this.paymentTypeTiles[t]!==this.PAYMENT_TYPES.AUTO||!this._isTangerineCreditCardPayee())&&!this._isCCPrimaryAccountUser()}},{key:"handleRecurringCCTileClick",value:function(t){this.selected.payment_indicator=t<1?this.PAYMENT_INDICATOR.MINIMUM_PAYMENT:this.PAYMENT_INDICATOR.FULL_BALANCE,this.flowService.gotoNextState()}},{key:"isCCOngoingMonthly",get:function(){return this._isTangerineCreditCardPayee()&&this.selected.isRecurring&&this.selected.frequency===this.FREQUENCY_MODE_CONSTANTS.MONTHLY}}]),t}();c.$inject=["$log","$filter","AddBillPayFlowService","BillPayAccountsService","AccountHelpersService","BillPayService","tngDateSelectorConstants","$state","billPayConstants","tngTileListConstants","stateConstants","transactionConstants","$translate","accountConstants","$sce","ModalErrorHandlerService","DateService","EventBusService","$q","BackButtonService","backButtonConstants"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2228)),a=s(n(2229));function s(t){return t&&t.__esModule?t:{default:t}}n(2230);var r={template:i.default,controller:a.default,bindings:{payeeSelected:"&",provinceSelected:"&",searchValue:"&",recommendPayee:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-payee-search fb2"> <div class="field"> <i class="field__icon icon-search c-payee-search__search-icon"></i> <form novalidate name="form" ng-submit="$ctrl.payeeSearchFormSubmit()"> <input ng-model="$ctrl.searchTerm" type="text" maxlength="50" actionable-id="search_addBillModal" class="input" ng-class="{\'warning\': $ctrl.hasError()}" placeholder="{{ ::\'billPay.addBill.billSearchPlaceholder\' | translate }}" autofocus ng-change="$ctrl.search($ctrl.selectedProvince.code)"> </form> <div class="field__error" ng-show="$ctrl.hasError()"> {{$ctrl.errorMessage}} </div> </div> <div class="c-payee-search__grid-dropdown"> <tng-select-autocomplete input-id="addBill_selectProvince" ng-model="$ctrl.selectedProvince" ng-model-set-raw-object="true" options="$ctrl.provinces" option-label-key="name" on-select="$ctrl.updateProvince()" is-static="true"></tng-select-autocomplete> </div> <div class="c-tile c-tile--flat-design ignore-modal-padding"> <div class="c-tile__header c-tile__header--flex"> <div class="c-tile__header-title">{{ ::\'billPay.addBill.payees\' | translate }}</div> </div> <tng-tile-item ng-repeat="(key, payee) in $ctrl.searchResults | filter:$ctrl.searchTerm | orderBy:\'name\'" ng-click="$ctrl.setPayee(key, payee)" class="c-tile--md" ng-class="{\'c-tile--selected\': key === $ctrl.selectedKey}"> <div class="tile-section"> <h1>{{ ::payee.name }}</h1> </div> </tng-tile-item> </div> <div class="c-payee-search__recommended" ng-show="$ctrl.searchTerm.length >= 2"> <span ng-if="$ctrl.searchResults.length === 0" class="table__quiet" ng-bind-html="\'billPay.addBill.recommendRow\' | translate:{ name: $ctrl.searchTerm }"> </span> <button actionable-id="payee-search-recommend" class="btn--edit btn--large" ng-click="$ctrl.recommend($ctrl.searchTerm)"> {{ ::\'billPay.addBill.recommend\' | translate }} </button> </div> </div> <div ng-show="$ctrl.loadingList"> <tng-loading-in-progress></tng-loading-in-progress> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(68)),a=c(n(8)),s=c(n(0)),r=c(n(2)),o=c(n(532));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,i,a,r,o,c,l){(0,s.default)(this,t),this.$log=e,this.$q=o,this.$scope=n,this.$translate=c,this.billPayService=i,this.selectedKey=null,this.loadingList=!1,this.referenceDataService=a,this.referenceDataConstants=r,this.EventBusService=l,this.searchParams={"start-item":0,count:20}}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;return this.errorMessage="",this.loadingList=!0,this.provinces=[],this.selectedProvince=null,this.EventBusService.subscribe(this.$scope,"INFINITE_SCROLL_EVENT",(0,o.default)(this.loadMorePayees.bind(this),2500)),this.$q.all([this.search(),this._getProvinces()]).then((function(){t.$log.info("all promises have resolved"),t.loadingList=!1})).catch((function(e){t.$log.error(e)}))}},{key:"updateProvince",value:function(){this.$log.debug("Selected province: ",this.selectedProvince);var t=this.selectedProvince&&"code"in this.selectedProvince?this.selectedProvince.code:null;this.search(t),this.provinceSelected({code:t})}},{key:"_getProvinces",value:function(){var t=this,e=this.referenceDataService,n=this.referenceDataConstants;return e.getDataByType(n.TYPES.PROVINCES).then((function(e){t.provinces=[{name:t.$translate.instant("billPay.addBill.allProvinces"),code:""}].concat(e[n.TYPES.PROVINCES]),t.selectedProvince=t.provinces[0]}))}},{key:"search",value:function(t){return this.searchParams=(0,a.default)({},this.searchParams,{name:this.searchTerm,"start-item":0}),t?this.searchParams.province=t:delete this.searchParams.province,this.searchValue({value:this.searchTerm}),this.searchTerm&&this.searchTerm.length<2?(this.errorMessage=this.$translate.instant("global.errorCodes.BP_SEARCHPAYEE_NAME_TOO_SHORT"),!1):this.getPayeesList()}},{key:"getPayeesList",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.payeesLoading=!0,this.billPayService.getPayees(this.searchParams).then((function(n){t.searchResults=e?[].concat((0,i.default)(t.searchResults),(0,i.default)(n.registered_payees)):n.registered_payees,t.payeesLoading=!1,t.searchParams["start-item"]=t.searchResults.length,"registered_payees"in n&&0===n.registered_payees.length?t.errorMessage=t.$translate.instant("global.errorCodes.BP_EMPTY_PAYEE_LIST"):(t.errorMessage="",t.$log.log("Registered Payees:",t.searchResults))})).catch((function(){t.payeesLoading=!1,t.errorMessage=t.$translate.instant("global.errorCodes.BP_EMPTY_PAYEE_LIST")}))}},{key:"hasError",value:function(){return this.errorMessage.length>1}},{key:"loadMorePayees",value:function(t,e){return"add-bill-modal-event"===e.id&&!this.payeesLoading&&(this.searchParams=(0,a.default)({},this.searchParams,{"start-item":this.searchParams["start-item"]}),this.getPayeesList(!0))}},{key:"setPayee",value:function(t,e){this.selectedKey=t,this.payeeSelected({payee:e})}},{key:"recommend",value:function(t){this.recommendPayee({payee:t})}},{key:"resetSearch",value:function(){this.searchTerm=""}},{key:"payeeSearchFormSubmit",value:function(){this.generalFormSubmit()}},{key:"generalFormSubmit",value:function(){this.hideMobileKeyboard()}},{key:"hideMobileKeyboard",value:function(){this.removePageFocus()}},{key:"removePageFocus",value:function(){document.activeElement.blur()}}]),t}();l.$inject=["$log","$scope","BillPayService","ReferenceDataService","referenceDataConstants","$q","$translate","EventBusService"],e.default=l,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(177)),a=d(n(0)),s=d(n(2)),r=d(n(264)),o=d(n(266)),c=d(n(265)),l=d(n(267)),u=n(364);function d(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(t,n,s,o,c,l,u,d){(0,a.default)(this,e);var h=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,u,l,d));return h.$window=c,h.$log=t,h.STATES={SEARCH:{titleKey:"billPay.states.payeeSearchState"},NUMBER:{titleKey:"billPay.states.payeeNumber"},NICKNAME:{titleKey:"billPay.states.payeeNickname"},HOW_PAY:{titleKey:"billPay.addPay.howPay"},FROM:{titleKey:"billPay.states.fromState"},DATE:{titleKey:"billPay.states.dateState"},AMOUNT:{titleKey:"billPay.states.amountState"},SCHEDULE:{titleKey:"billPay.states.schedule"},REVIEW:{titleKey:"billPay.states.reviewState"},DONE:{titleKey:"billPay.states.doneState"},RECOMMEND_START:{titleKey:"billPay.states.doneState"},RECOMMEND_END:{titleKey:"billPay.states.doneState"}},h._initialState=h.STATES.SEARCH,h}return(0,c.default)(e,t),(0,s.default)(e,[{key:"showLoadingSpinner",value:function(){this.isLoading=!0,this.doneLoading=!1}},{key:"showLoadingDoneIcon",value:function(){this.isLoading=!1,this.doneLoading=!0}},{key:"exitLoadingMode",value:function(){this.isLoading=!1,this.doneLoading=!1}},{key:"returnToStart",value:function(){this._resetState()}},{key:"_resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.isRecurring=!1,this.BUTTONS={BTN_GRY:new u.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new u.ModalFooterButton(this.BUTTON_TYPES.NEXT,!0,!0)}}},{key:"_updateUI",value:function(){var t=this.currentState,e=this.BUTTON_TYPES,n=this.BUTTONS,i=this.STATES;switch(n.BTN_GRY.show=!0,n.BTN_GRY.disable=!1,n.BTN_ORG.show=!0,n.BTN_ORG.disable=!1,t){case i.SEARCH:n.BTN_GRY.type=e.CANCEL,n.BTN_ORG.type=e.NEXT,n.BTN_ORG.disable=!0;break;case i.NUMBER:n.BTN_GRY.type=e.BACK,n.BTN_ORG.type=e.NEXT,n.BTN_ORG.disable=!0;break;case i.NICKNAME:n.BTN_GRY.type=e.BACK,n.BTN_ORG.type=this.nickname?e.NEXT:e.SKIP;break;case i.HOW_PAY:case i.FROM:n.BTN_GRY.type=e.BACK,n.BTN_ORG.show=!1;break;case i.AMOUNT:n.BTN_GRY.type=e.BACK,n.BTN_ORG.type=e.NEXT,n.BTN_ORG.disable=!0;break;case i.DATE:n.BTN_GRY.type=e.BACK,n.BTN_ORG.type=e.NEXT,n.BTN_ORG.disable=!1;break;case i.REVIEW:n.BTN_GRY.type=e.BACK,n.BTN_ORG.type=this.isLaterPayment?e.ADD:e.CONFIRM;break;case i.DONE:n.BTN_GRY.show=!0,n.BTN_GRY.type=e.ADD_ANOTHER_BILL,n.BTN_GRY.disable=!1,n.BTN_ORG.show=!0,n.BTN_ORG.type=e.DONE;break;case i.RECOMMEND_START:n.BTN_GRY.type=e.BACK,n.BTN_ORG.type=e.SUBMIT;break;case i.RECOMMEND_END:n.BTN_ORG.type=e.DONE;break;case i.SCHEDULE:n.BTN_GRY.type=e.BACK,n.BTN_ORG.show=!1}}},{key:"gotoNextState",value:function(){var t=this.currentState,e=this.STATES;switch(t){case e.SEARCH:this.moveTo(e.NUMBER);break;case e.NUMBER:this.moveTo(e.NICKNAME);break;case e.NICKNAME:this.isFinancialPlan?this.moveTo(e.REVIEW):this.moveTo(e.HOW_PAY);break;case e.FROM:this.moveTo(e.DATE);break;case e.DATE:this.moveTo(e.AMOUNT);break;case e.AMOUNT:this.moveTo(e.REVIEW);break;case e.REVIEW:this.moveTo(e.DONE);break;case e.RECOMMEND_START:this.moveTo(e.RECOMMEND_END);break;default:this.$log.debug("Unknown or unrecognized state")}}},{key:"postMoveTo",value:function(){this.currentState===this.STATES.DONE&&this.hideWarning()}},{key:"_getAnalyticsID",value:function(){return"bill/add"}},{key:"inLoadingMode",get:function(){return this.isLoading||this.doneLoading}}]),e}(l.default);h.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","$rootScope","AnalyticsService"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d){(0,i.default)(this,t),this.$q=e,this.$log=n,this.RequesterService=a,this.serviceConstants=s,this.billPayConstants=r,this.$httpParamSerializer=l,this.selectionMode=u.DATE_SELECTOR_MODES,this.AccountDetailsService=o,this.accountConstants=c,this.PayeeListService=d}return(0,a.default)(t,[{key:"getPayees",value:function(t){var e={urlVars:{queryString:this.$httpParamSerializer(t)}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.REGISTERED_PAYEES,e)}},{key:"createPayee",value:function(t,e){var n=this.serviceConstants,i={data:{validate_only:e,payee:{vendor_id:t.payee.id,nickname:t.nickname,account_number:t.accountNumber}}};return this.RequesterService.request(n.AVAILABLE_SERVICES.ADD_REGISTERED_PAYEES,i)}},{key:"addBillPay",value:function(t,e,n){var i=this.serviceConstants,a=this.selectionMode,s={urlVars:{accountHash:t.payFromAccount.number},data:{validate_only:n,payments:[{when:t.when,payee_id:e,amount:t.amount,scheduled_start_date:t.scheduledStartDate.format("YYYY-MM-DD")}]}};return t.isRecurring&&(s.data.payments[0].frequency=t.frequency,t.datePickerSelectionMode===a.RANGE&&(s.data.payments[0].scheduled_end_date=t.scheduledEndDate.format("YYYY-MM-DD"))),this.RequesterService.request(i.AVAILABLE_SERVICES.BILL_PAY_TRANSACTION,s)}},{key:"recommend",value:function(t){var e={data:{payee:{name:t}}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.RECOMMEND_PAYEE,e)}},{key:"getAccountByDisplayName",value:function(t){var e=this;return this.AccountDetailsService.getAccounts().then((function(n){return n.accounts.filter((function(n){return e.removeExtraSpaceFromMaskedAccount(n.display_name)===t}))})).then((function(t){return t[0]}))}},{key:"moveMoney",value:function(t,e,n){var i=this.serviceConstants,a={urlVars:{accountHash:t.payFromAccount.number},data:{validate_only:n,transfers:{when:t.when,frequency:t.frequency,to_account:e,currency:"CAD",payment_indicator:t.payment_indicator}}};return this.RequesterService.request(i.AVAILABLE_SERVICES.MOVE_MONEY_SUBMIT,a)}},{key:"getAccountPayees",value:function(t){var e=this;return this.PayeeListService.getPayees().then((function(n){return n.payees.filter((function(n){return e.removeExtraSpaceFromMaskedAccount(n.account_number)===t}))})).then((function(t){return t[0]}))}},{key:"removeExtraSpaceFromMaskedAccount",value:function(t){return t.replace("  "," ")}},{key:"getAccountDetails",value:function(t){var e=this.serviceConstants,n={urlVars:{accountHash:t}};return this.RequesterService.request(e.AVAILABLE_SERVICES.ACCOUNT_DETAILS_CREDIT_CARD,n)}}]),t}();r.$inject=["$q","$log","RequesterService","serviceConstants","billPayConstants","AccountDetailsService","accountConstants","$httpParamSerializer","tngDateSelectorConstants","PayeeListService"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t,e){return{restrict:"A",scope:{tngInfinityScroll:"@?"},link:function(t,n,i){var a=n[0];if(!i.tngInfinityScroll)return e.debug("Infinite scroll: No callback function provided. Destroying."),t.$destroy();var s=function(){return e.debug("Infinite scroll: calculating end position."),a.scrollTop+a.offsetHeight+200<a.scrollHeight||(e.debug("Infinite scroll: bottom reached, dispatching fn."),t.$emit("INFINITE_SCROLL_EVENT",{id:t.tngInfinityScroll}))};return t.$on("$destroy",(function(){e.debug("Infinite scroll: unbinding element on destroy"),angular.element(n).unbind("scroll",s)})),e.debug("Infinite scroll: binding onscroll to element"),angular.element(n).bind("scroll",s),!0}}};i.$inject=["$window","$log"],e.default=i,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2235)),a=s(n(2239));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("bill-pay-edit-bill",[]).component("editBillPayModal",i.default).service("EditPayeeFlowService",a.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2236)),a=s(n(2237));function s(t){return t&&t.__esModule?t:{default:t}}n(2238);var r={controller:a.default,template:i.default,bindings:{onClose:"&",onDelete:"&",payee:"="}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog hide-close="$ctrl.flowService.showConfirmExitUI || $ctrl.flowService.inLoadingMode" on-close="$ctrl.onModalClose(result)" flow-service="$ctrl.flowService"> <div class="c-bill-pay__error" ng-if="$ctrl.hasErrors()"> <tng-error-message> <span>{{ $ctrl.flowService.submitErrors }}</span> </tng-error-message> </div> <header> <span ng-if="$ctrl.flowService.showMainUI"> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_PAYEE"> {{ \'billPay.states.editPayeeState\' | translate : { payeeName: $ctrl.payee.nickname } }} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DELETE_PAYEE"> {{ \'billPay.states.deletePayeeState\' | translate : { payeeName: $ctrl.payee.nickname } }} </span> </span> </header> <div ng-if="$ctrl.flowService.showMainUI" class="c-edit-bill"> <form ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_PAYEE" name="$ctrl.editPayee"> <label class="body" id="billPayeeGoalSubHeaderId" ng-if="$ctrl.payee.goal_account"> {{ ::\'billPay.editBill.billPayeeGoal\' | translate }} </label> <div class="field"> <label for="billPayee"> {{ \'billPay.editBill.billPayee\' | translate }} </label> <input id="billPayee" type="text" class="input" ng-disabled="true" value="{{$ctrl.payee.name}}"> </div> <div class="field"> <label for="nickName"> {{ \'billPay.editBill.nickname\' | translate }} <span class="quiet">{{ \'billPay.editBill.nicknameOptional\' | translate }} </span> </label> <input id="nickName" actionable-id="nickName" type="text" ng-keydown="$ctrl.onEnter($event) " class="input" ng-pattern="$ctrl.lettersNumbersSpacesPattern" ng-change="$ctrl.nickNameChanged()" maxlength="25" ng-model="$ctrl.payee.nickname" placeholder="{{ ::\'billPay.editBill.nicknamePlaceholder\' | translate }}"> </div> <div ng-messages="$ctrl.editPayee.nickName.$error" ng-show="$ctrl.editPayee.nickName.$dirty" class="field__error"> <p ng-message="pattern"> {{ ::\'billPay.addBill.validationErrorNickname\' | translate}} </p> </div> <div class="field"> <label for="accountNumber"> {{ \'billPay.editBill.acctName\' | translate }} </label> <input id="accountNumber" type="text" ng-keydown="$ctrl.onEnter($event)" class="input" ng-change="$ctrl.isPayeeEqualToOriginal()" ng-model="$ctrl.payee.account_number"> </div> <div class="c-edit-bill__button-container"> <button ng-click="$ctrl.flowService.gotoNextState($ctrl.flowService.STATES.DELETE_PAYEE)" aria-label="Delete" actionable-id="delete_editBillModal" class="btn--warn"> {{ \'billPay.editBill.deleteBtn\' | translate }} </button> </div> </form> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DELETE_PAYEE"> <div class="body margin__t--fix2">{{ \'billPay.editBill.confirmDelete\' | translate}}</div> <div class="body margin__t--fix2" ng-if="$ctrl.payee.goal_account"> {{ ::\'billPay.editBill.confirmDeleteGoal\' | translate }} </div> <div class="panel margin__t--fix2"> <div class="body c-edit-bill__description-text"> {{ \'billPay.editBill.billPayee\' | translate }} </div> <div class="body"> {{$ctrl.payee.name}} </div> <div class="body c-edit-bill__description-text"> {{$ctrl.payee.nickname}} </div> </div> <div class="panel margin__t--fix1"> <div class="body c-edit-bill__description-text"> {{ \'billPay.editBill.acctName\' | translate }} </div> <div class="body"> {{$ctrl.payee.account_number}} </div> </div> </div> <div class="c-loading-edit-bill" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.PAYEE_CHANGE_DONE"> <div class="c-loading-edit-bill__loading-container"> <div ng-if="!$ctrl.hasErrors()"> <tng-loading-done></tng-loading-done> </div> <div ng-if="$ctrl.hasErrors()"> <div class="icon-warning"></div> {{ \'global.commonWords.error\' | translate }} </div> </div> </div> </div> <tng-loading-in-progress ng-if="$ctrl.flowService.inLoadingMode" is-loading-key="billPay.states.interstitialLoadingState"> </tng-loading-in-progress> <footer ng-hide="$ctrl.flowService.showConfirmExitUI || $ctrl.flowService.inLoadingMode"> <button class="btn btn--edit" actionable-id="billPay_btn_{{$ctrl.flowService.BUTTONS.BTN_GRY.type.label}}" ng-show="$ctrl.flowService.BUTTONS.BTN_GRY.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_GRY.disable" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_GRY)"> {{ $ctrl.flowService.BUTTONS.BTN_GRY.type.label | translate }} </button> <button class="btn btn--orange" ng-class="{\'CB_ReadOnly\': $ctrl.flowService.CB_DISABLED_BUTTONS.includes($ctrl.flowService.BUTTONS.BTN_ORG.type)}" actionable-id="billPay_btn_{{$ctrl.flowService.BUTTONS.BTN_ORG.type.label}}" ng-show="$ctrl.flowService.BUTTONS.BTN_ORG.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_ORG.disable" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_ORG)"> {{ $ctrl.flowService.BUTTONS.BTN_ORG.type.label | translate }} </button> <button class="btn btn--warn" actionable-id="billPay_btn_{{$ctrl.flowService.BUTTONS.BTN_RED.type.label}}" id="billPay_btn_{{$ctrl.flowService.BUTTONS.BTN_RED.type.label}}" ng-show="$ctrl.flowService.BUTTONS.BTN_RED.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_RED.disable" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_RED)"> {{ $ctrl.flowService.BUTTONS.BTN_RED.type.label | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(8)),a=o(n(0)),s=o(n(2)),r=n(67);function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,s,o,c,l,u){(0,a.default)(this,t),this.$log=e,this.flowService=n,this.editPayeeService=s,this.$timeout=o,this.$state=c,this.stateConstants=l,this.GOOD_STATUS_CODES=u,this.lettersNumbersSpacesPattern=r.lettersNumbersSpacesPattern,this.$log.debug("Passed Edit Bill Payee: ",this.payee),this.originalPayee=(0,i.default)({},this.payee)}return(0,s.default)(t,[{key:"_close",value:function(t){var e=this;t||this.flowService.showWarningOnExit(),this.flowService.warn().then((function(){e.hasBeenDeleted||(0,i.default)(e.payee,e.originalPayee),e.onClose({result:e.hasBeenDeleted}),e.flowService.resetSubmitErrors()})).finally((function(){t||e.flowService.hideWarningOnExit()}))}},{key:"isPayeeEqualToOriginal",value:function(){this.flowService.updateBtnsBasedOnPayeeAndOriginalEquality(angular.equals(this.originalPayee,this.payee))}},{key:"onEnter",value:function(t){if(13===t.keyCode)return t.preventDefault()}},{key:"onModalClose",value:function(t){this._close(t)}},{key:"hasErrors",value:function(){return this.flowService.submitErrors.length>0}},{key:"$onInit",value:function(){this.flowService.activate()}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"onButtonClick",value:function(t){var e=this.$log,n=this.flowService;switch(e.debug(t),t.type){case n.BUTTON_TYPES.CANCEL:e.debug("CANCEL ACTION"),n.currentState===n.STATES.DELETE_PAYEE?n.moveTo(n.STATES.EDIT_PAYEE):this._close(!1);break;case n.BUTTON_TYPES.DONE:return e.debug("DONE ACTION"),n.currentState===n.STATES.PAYEE_CHANGE_DONE?(this._close(!0),void(this.hasBeenDeleted&&this.$state.go(this.stateConstants.BILL_PAY,{},{reload:!0}))):(this.flowService.resetSubmitErrors(),void this._saveBillEdit());case n.BUTTON_TYPES.DELETE:return e.debug("DELETE ACTION"),this.hasBeenDeleted=!0,void this._deleteBill();default:e.debug("default - NO ACTION")}}},{key:"_saveBillEdit",value:function(){var t=this;if(angular.equals(this.originalPayee,this.payee))return this.$log.debug("No Payee Change"),void this._close(!0);this.$log.debug("Payee Changed, send update payee request"),this.flowService.showLoadingSpinner();var e={};this.payee.nickname!==this.originalPayee.nickname&&(0,i.default)(e,{nickname:this.payee.nickname}),this.payee.account_number!==this.originalPayee.account_number&&(0,i.default)(e,{account_number:this.payee.account_number}),this.editPayeeService.editPayee(e,this.payee.id).then((function(e){if(-1===t.GOOD_STATUS_CODES.TRANSACTION_STATUS_CODES.indexOf(e.response_status.status_code))return t.flowService.showSubmitErrors(e),void t.flowService.exitLoadingMode();t.originalPayee=(0,i.default)({},self.payee),t.flowService.BUTTONS.BTN_ORG.type.label="global.components.buttons.done",t._loadingCallbackClose(null,!0)})).catch((function(e){t.$log.error("Edit Payee Request Error: ",e),t.payee=(0,i.default)({},self.originalPayee),t.flowService.showSubmitErrors(e),t._loadingCallbackClose(null,!0)}))}},{key:"_deleteBill",value:function(){var t=this;this.flowService.showLoadingSpinner(),this.editPayeeService.deletePayee(this.payee.id).then((function(){})).catch((function(e){t.$log.error("Delete Payee Request Error: ",e),t.flowService.showSubmitErrors(e)})).finally((function(){t._loadingCallbackClose(t.onDelete,!0)}))}},{key:"_loadingCallbackClose",value:function(t,e){this.flowService.exitLoadingMode(),this.onModalClose(e),t&&t(),this.flowService.hideWarning(),this.hasBeenDeleted&&this.$state.go(this.stateConstants.BILL_PAY,{},{reload:!0})}},{key:"nickNameChanged",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=!!this.editPayee.nickName.$error.pattern,this.isPayeeEqualToOriginal()}}]),t}();c.$inject=["$log","EditPayeeFlowService","EditPayeeService","$timeout","$state","stateConstants","transactionConstants"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(177)),a=u(n(2)),s=u(n(264)),r=u(n(266)),o=u(n(265)),c=u(n(0)),l=u(n(267));function u(t){return t&&t.__esModule?t:{default:t}}var d=function t(e,n,i){(0,c.default)(this,t),this.type=e,this.show=n,this.disable=i},h=function(t){function e(t,n,a,r,o,l,u,d,h){(0,c.default)(this,e);var f=(0,s.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,a,r,o,d,l,h));return f.$window=o,f.$log=t,f.$translate=u,f.STATES={EDIT_PAYEE:{titleKey:"billPay.states.editPayeeState"},DELETE_PAYEE:{titleKey:"billPay.states.deletePayeeState"},LOADING_PAYEE_CHANGE:{titleKey:""},PAYEE_CHANGE_DONE:{titleKey:""}},f.submitErrors="",f._initialState=f.STATES.EDIT_PAYEE,f}return(0,o.default)(e,t),(0,a.default)(e,[{key:"resetSubmitErrors",value:function(){this.submitErrors=""}},{key:"updateBtnsBasedOnPayeeAndOriginalEquality",value:function(t){t?(this.BUTTONS.BTN_GRY.show=!1,this.BUTTONS.BTN_ORG.type.label="global.components.buttons.done"):(this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_ORG.type.label="global.components.buttons.save")}},{key:"_resetState",value:function(){(0,r.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.submitErrors="",this.isRecurring=!1,this.transaction={fromAccount:[],toAccount:[],amount:"0.00",currency:{},when:{},frequency:{},scheduledStartDate:new Date,scheduledEndDate:new Date(new Date+30)},this.BUTTONS={BTN_GRY:new d(this.BUTTON_TYPES.CANCEL,!1,!1),BTN_ORG:new d(this.BUTTON_TYPES.DONE,!0,!1),BTN_RED:new d(this.BUTTON_TYPES.CANCEL,!1,!0)}}},{key:"_updateUI",value:function(){var t=this.currentState,e=this.BUTTON_TYPES,n=this.BUTTONS,i=this.STATES;switch(n.BTN_GRY.show=!0,n.BTN_GRY.disable=!1,n.BTN_ORG.show=!0,n.BTN_ORG.disable=!1,n.BTN_RED.show=!0,n.BTN_RED.disable=!1,t){case i.EDIT_PAYEE:n.BTN_ORG.type=e.DONE,n.BTN_ORG.show=!0,n.BTN_RED.show=!1,n.BTN_GRY.show=!1;break;case i.DELETE_PAYEE:n.BTN_GRY.type=e.CANCEL,n.BTN_RED.type=e.DELETE,n.BTN_RED.show=!0,n.BTN_GRY.show=!0,n.BTN_ORG.show=!1;break;case i.LOADING_PAYEE_CHANGE:n.BTN_RED.show=!1,n.BTN_GRY.show=!1,n.BTN_ORG.show=!1;break;case i.PAYEE_CHANGE_DONE:n.BTN_RED.show=!1,n.BTN_GRY.show=!1,n.BTN_ORG.show=!0}}},{key:"showSubmitErrors",value:function(t){try{var e="";t.response_status&&t.response_status.details?(t.response_status.details.forEach((function(t,n){n>0&&(e+="<br>"),e=""+e+t.technical_description})),this.$log.error("formatted error:",e),this.submitErrors=e):t.response_status&&t.response_status.return_code?(e=this.$translate.instant("global.errorCodes."+t.response_status.return_code),this.submitErrors=e):(e=this.$translate.instant("global.errorCodes.generic"),this.$log.error("formatted error:",e),this.submitErrors=e)}catch(t){this.$log.error(t)}}},{key:"gotoNextState",value:function(t){if(t)return this.moveTo(t),void this.hideWarning();var e=this.currentState,n=this.STATES;switch(e){case n.EDIT_PAYEE:case n.DELETE_PAYEE:this.moveTo(n.PAYEE_CHANGE_DONE),this.showWarning();break;default:this.$log.debug("Unknown or unrecognized state")}}},{key:"_getAnalyticsID",value:function(){return"bill/edit"}}]),e}(l.default);h.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","$translate","$rootScope","AnalyticsService"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2241)),a=s(n(2245));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("multiple-bill-pay",[]).component("multipleBillPayModal",i.default).service("MultipleBillPayFlowService",a.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2242)),a=s(n(2243));function s(t){return t&&t.__esModule?t:{default:t}}n(2244);var r={controller:a.default,template:i.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog class="c-multiple-bill-pay-modal fb2" hide-close="$ctrl.flowService.showConfirmExitUI || $ctrl.flowService.inLoadingMode" on-close="$ctrl.onModalClose(result)" is-visible="true" flow-service="$ctrl.flowService"> <header ng-if="!$ctrl.flowService.showConfirmExitUI"> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.FROM">{{ ::\'billPay.multipleBP.headerFrom\' | translate }}</span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.CONFIRM">{{ ::\'billPay.multipleBP.headerReview\' | translate }}</span> <div ng-if="$ctrl.paymentResult.isAllProcessed && $ctrl.flowService.currentState === $ctrl.flowService.STATES.FINISH"> <span ng-if="$ctrl.hasScheduledPayments"> {{ ::\'billPay.multipleBP.headerDone.successScheduled\' | translate }} </span> <span ng-if="!$ctrl.hasScheduledPayments"> {{ ::\'billPay.multipleBP.headerDone.success\' | translate }} </span> </div> <span ng-if="!$ctrl.paymentResult.isAllProcessed && $ctrl.flowService.currentState == $ctrl.flowService.STATES.FINISH "> {{ ::\'billPay.multipleBP.headerDone.error\' | translate }} </span> </header> <div ng-if="$ctrl.loading || $ctrl.flowService.currentState == $ctrl.flowService.STATES.LOADING"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div ng-if="!$ctrl.loading && !$ctrl.flowService.showConfirmExitUI"> <div class="c-bill-buttons-group" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.FROM"> <button actionable-id="bill-pay-add_bill_pay" class="btn c-bill-button" tng-click="$ctrl.showAddBillPay()" level2-auth> {{ ::\'billPay.landingPage.addBill\' | translate }} </button> <button actionable-id="bill-pay-multiple_pay_bills" class="btn btn--edit c-bill-button" ng-click="$ctrl.showMultiplePayBills()"> {{ ::\'billPay.landingPage.manageBills\' | translate }} </button> </div> <div ng-if="!$ctrl.havePayees"> <h1 class="fb2-title--md"> {{ ::\'billPay.landingPage.noPayees\' | translate }} </h1> </div> <div ng-if="$ctrl.havePayees"> <div class="c-payee-multiple" id="c-payee-multiple-payeeList" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.FROM"> <h4 class="heading--sub3 family-normal margin__b--fix1">{{ ::\'billPay.multipleBP.payFrom\' | translate }}</h4> <div class="field c-payee-multiple__selector" id="billPay-multipleBP-selector"> <tng-select-autocomplete class="margin__b--fix2" input-id="billPay_select_accounts" ng-if="$ctrl.fromAccountOptions" ng-model="$ctrl.selectedFromAccount" on-select="$ctrl.fromAccountChange(option)" options="$ctrl.fromAccountOptions" option-label-key="title" option-right-label-key="balance" option-value-key="number" select-type="$ctrl.selectConstants.SELECT_TYPES.STATIC"> </tng-select-autocomplete> </div> <div class="c-payee-container ignore-modal-padding--mobile" ng-repeat="payee in $ctrl.payeeList"> <tng-error-message ng-show="payee.hasError"> <div class="confirm" ng-bind-html="payee.displayError"> </div> </tng-error-message> <div class="panel c-payee-container__account"> <strong class="medium c-payee-container__account-info" ng-if="payee.nickname"> {{ payee.nickname }} </strong> <strong class="medium c-payee-container__account-info" ng-if="!payee.nickname"> {{ payee.name | uppercase }} </strong> <span class="medium c-payee-container__account-number"> {{ payee.account_number | maskNumber }} </span> </div> <div class="panel c-payee-container__amount"> <form ng-submit="$ctrl.multipleAmountInputFormSubmit()"> <tng-amount-input input-type="\'simple-inline\'" input-max-length="12" set-value="$ctrl.flowService.transaction[payee.id].amount" disable-autofocus="true" on-amount-change="$ctrl.payeeAmountChange(amount, payee)"> </tng-amount-input> </form> </div> <div class="panel c-payee-container__actions"> <div class="btn__row"> <div class="btw__row__wrapper"> <button actionable-id="multiple-bill-pay-payment_date_single" class="btn--larger btn--view" ng-class="{\'is-active\': !$ctrl.flowService.transaction[payee.id].isLater}" ng-click="$ctrl.setPaymentDate(payee.id, true, false, false)"> {{ ::\'global.commonWords.now\' | translate }} </button> </div> <div class="btw__row__wrapper"> <button actionable-id="multiple-bill-pay-payment_date_later" class="btn--larger btn--view" ng-class="{\'is-active\': $ctrl.flowService.transaction[payee.id].isLater &&\n                    $ctrl.flowService.transaction[payee.id].selectionMode ===\n                    $ctrl.dateConstants.DATE_SELECTOR_MODES.SINGLE}" ng-click="$ctrl.setPaymentDate(payee.id, false, true, false)"> {{ ::\'global.commonWords.later\' | translate }} </button> </div> <div class="btw__row__wrapper"> <button actionable-id="multiple-bill-pay-payment_date_cc" class="btn--larger btn--view" ng-show="$ctrl.payeeList[$index].vendor_id !== $ctrl.flowService.CC_VALUE.ID" ng-class="{\'is-active\': $ctrl.flowService.transaction[payee.id].isLater &&\n                  $ctrl.flowService.transaction[payee.id].selectionMode !==\n                  $ctrl.dateConstants.DATE_SELECTOR_MODES.SINGLE}" ng-click="$ctrl.setPaymentDate(payee.id, false, true, true)"> {{ ::\'global.commonWords.ongoing\' | translate }} </button> </div> </div> <tng-error-message ng-hide="payee.dateIsBusinessDay"> {{ ::\'billPay.singleBP.businessDayWarning\' | translate }} </tng-error-message> <tng-date-selector ng-if="$ctrl.flowService.transaction[payee.id].isLater" min-date="$ctrl.nextBusinessDay" max-date="$ctrl.datePickerMaxDate" selection-mode="$ctrl.flowService.transaction[payee.id].selectionMode" selected-date="$ctrl.flowService.transaction[payee.id].selectedDate" end-date="$ctrl.flowService.transaction[payee.id].endDate" frequency="$ctrl.flowService.transaction[payee.id].frequency" hide-frequency-selector="$ctrl.flowService.transaction[payee.id].selectionMode === $ctrl.dateConstants.DATE_SELECTOR_MODES.SINGLE" hide-selection-mode-selector="$ctrl.flowService.transaction[payee.id].selectionMode === $ctrl.dateConstants.DATE_SELECTOR_MODES.SINGLE" selection-mode-exclude-single="$ctrl.flowService.transaction[payee.id].selectionMode !== $ctrl.dateConstants.DATE_SELECTOR_MODES.SINGLE" frequency-exclude-none="true" frequency-exclude-daily="true" frequency-quarterly-and-yearly-excluded="true" component-name="date-selector-{{$index}}" on-date-change="$ctrl.onDateChanged($index, selectedDate)" single-month-view-enabled="true"> </tng-date-selector> </div> </div> </div> <div class="c-confirm-multiple" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.CONFIRM"> <div class="fb2-multi-title" id="fb2-multi-title-header"> <p class="fb2-title" ng-bind-html="$ctrl.totalHeader"></p> <p class="fb2-title" ng-bind-html="$ctrl.billList"></p> </div> <div class="c-confirm-multiple__tiles"> <tng-tile-list tile-data="$ctrl.flowService.transactionAccount" ng-if="$ctrl.fromAccounts.length === 1" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click=""> </tng-tile-list> <tng-tile-list tile-data="$ctrl.flowService.transactionAccount" ng-if="$ctrl.fromAccounts.length > 1" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" all-actionable="true" on-tile-click="$ctrl.flowService.gotoPreviousState();"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.confirmPayments" tile-type="$ctrl.tileListConstants.TILE_TYPE.amount" all-actionable="true" on-tile-click="$ctrl.flowService.gotoPreviousState();"> </tng-tile-list> <p class="fb2-disclaimer" ng-if="$ctrl.flowService.transaction.datePickerSelectionMode ===\n                  $ctrl.flowService.DATE_SELECTOR_MODES.INDEFINITE" translate> {{ ::\'billPay.ccReminder\' | translate }} </p> <br/> <p class="fb2-disclaimer" ng-if="$ctrl.isOneOfPaymentsACreditCardPayment" translate> {{ ::\'billPay.ccOngoingReminder\' | translate }} </p> </div> </div> <div id="printMe" class="c-finished-multiple" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.FINISH"> <div ng-if="$ctrl.paymentError"> <tng-error-message> {{$ctrl.paymentError.errorMessage }} </tng-error-message> </div> <div ng-if="!$ctrl.paymentError"> <div class="c-finished-multiple__description"> <div ng-if="$ctrl.paymentResult.isAllProcessed && $ctrl.paymentResult.isAllNow" ng-bind-html="\'billPay.multipleBP.willProcessNow\' | translate"></div> <div ng-if="$ctrl.paymentResult.isAllProcessed && !$ctrl.paymentResult.isAllNow" ng-bind-html="\'billPay.multipleBP.willProcessLater\' | translate"></div> <div ng-if="!$ctrl.paymentResult.isAllProcessed" ng-bind-html="\'billPay.multipleBP.errorDescription\' | translate"></div> </div> <div class="c-finished-multiple__from-account panel ignore-modal-padding--mobile"> <span> {{ ::\'billPay.multipleBP.newBalance\' | translate }} </span> <span class="c-finished-multiple__from-account__bold-account"> {{ $ctrl.flowService.transactionAccount.data.nickname | normalizeType}} {{$ctrl.flowService.transactionAccount.data.display_name | maskNumber}} </span> <div class="c-finished-multiple__from-account__balance"> {{$ctrl.paymentResult.newBalance | currency}} </div> </div> <div class="c-finished-multiple__payment" ng-repeat="payment in $ctrl.confirmPayments"> <div class="c-finished-multiple__payment__title medium">{{payment.payee.name | normalizeType}}</div> <div class="c-finished-multiple__payment__info panel ignore-modal-padding--mobile"> <div class="c-finished-multiple__payment__info__top-row"> <div class="c-finished-multiple__payment__info__top-row__code"> <div ng-if="payment.isProcessed"> <span> {{ ::\'billPay.multipleBP.confirmationNumber\' | translate }} </span> <span class="c-finished-multiple__payment__info__top-row__code__value"> {{payment.confirmation_code}} </span> </div> <div ng-if="!payment.isProcessed" ng-bind-html="payment.payee.displayError" class="c-finished-multiple__error-text"> {{ ::\'billPay.multipleBP.paymentNotProccessed\' | translate }} </div> </div> <div class="c-finished-multiple__payment__info__top-row__date"> <div ng-if="payment.date" ng-attr-id="multiple__payment__info__top-row__date__when-{{ $index }}"> <span class="c-finished-multiple__payment__info__top-row__date__when"> {{ $ctrl.getPaymentWhenTranslation(payment) | translate }} </span> <span ng-attr-id="payment-date-title-{{ $index }}"> {{payment.date | date:\'longDate\'}} </span> </div> <div ng-if="payment.frequency"> <span class="body"> {{ (\'global.datePicker.frequencies.\' + payment.frequency.toLowerCase()) | translate }} </span> <span ng-if="!payment.isInfinite"> {{ ::\'global.commonWords.from\' | translate }} {{payment.selectedDate | date:\'longDate\'}} <div ng-if="payment.selectionMode!=\'INDEFINITE\'"> {{ ::\'global.commonWords.until\' | translate }} {{ payment.endDate | date:\'longDate\' }} </div> </span> <span ng-if="payment.isInfinite"> {{ ::\'global.commonWords.from\' | translate }} {{payment.selectedDate | date:\'longDate\'}} </span> </div> </div> </div> <div class="c-finished-multiple__payment__info__amount"> <div class="c-finished-multiple__payment__info__amount__title"> {{ ::\'billPay.amount\' | translate }} </div> <div class="c-finished-multiple__payment__info__amount__value" ng-class="{\'c-finished-multiple__payment__info__amount__value--error\': !payment.isProcessed}"> {{payment.amount | currency}} </div> </div> </div> </div> <div class="c-finished-multiple__view-link" translate="billPay.singleBP.canView" translate-values="{ sref: $ctrl.stateConstants.TRANSACTIONS }" ng-click="$ctrl.onModalClose()"> </div> <tng-print-button only-element="\'printMe\'"> {{ \'global.components.buttons.printSave\' | translate }} </tng-print-button> </div> </div> </div> </div> <footer ng-hide="$ctrl.flowService.showConfirmExitUI || $ctrl.loading || ($ctrl.flowService.currentState == $ctrl.flowService.STATES.LOADING)"> <button actionable-id="billpay_multiple_add" class="btn btn--orange" ng-if="!$ctrl.havePayees" ng-click="$ctrl.showAddBillPay()"> {{ \'billPay.landingPage.addBill\' | translate }} </button> <button class="btn btn--edit" ng-show="$ctrl.flowService.BUTTONS.BTN_GRY.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_GRY.disable" actionable-id="{{$ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_GRY.type.label)}}" watch-actionable-id="true" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_GRY)"> {{ $ctrl.flowService.BUTTONS.BTN_GRY.type.label | translate }} </button> <button class="btn btn--orange" ng-class="{\'CB_ReadOnly\': $ctrl.flowService.CB_DISABLED_BUTTONS.includes($ctrl.flowService.BUTTONS.BTN_ORG.type)}" ng-show="$ctrl.flowService.BUTTONS.BTN_ORG.show && $ctrl.havePayees" actionable-id="{{$ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_ORG.type.label)}}" watch-actionable-id="true" ng-disabled="$ctrl.flowService.currentState === $ctrl.flowService.STATES.FROM &&\n        $ctrl.flowService.firstStateNextDisabled()" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_ORG)"> {{ $ctrl.flowService.BUTTONS.BTN_ORG.type.label | translate }} </button> </footer> </tng-modal-dialog> <add-bill-pay-modal ng-if="$ctrl.showAddBPModal" on-close="$ctrl.onAddBPModalClose(result)" from-accounts="$ctrl.fromAccounts"> </add-bill-pay-modal> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(15)),a=o(n(0)),s=o(n(2)),r=o(n(45));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,s,o,c,l,u,d,h,f,p,g,m,_,v,S,T,y,E,A,b,C,$,N,O,I,w,P,M){(0,a.default)(this,t),this.$log=e,this.$translate=n,this.$filter=i,this.$timeout=s,this.$state=o,this.billPayConstants=c,this.dateConstants=l,this.stateConstants=_,this.tileListConstants=u,this.selectConstants=d,this.menuConstants=h,this.flowService=f,this.payeeListService=p,this.accountService=g,this.payBillService=m,this.BusinessDaysService=T,this.DateService=y,this.AccountHelpersService=E,this.EnvironmentService=A,this.BackButtonService=P,this.backButtonConstants=M,this.CC_VALUE=c.CC_VALUE,this.$location=b,this.$anchorScroll=C,this.$sce=$,this.ACCOUNT_TYPES=v.ACCOUNT_TYPES,this.STATUS_CODES=S.STATUS_CODES,this.loading=!1,this.loadingStates={},this.eventConstants=N,this.EventBusService=O,this.$scope=I,this.$q=w,this.fromAccounts=[],this.payeeList=[],this.havePayees=!0,this.hasScheduledPayments=!1,this.confirmPayments=[],this.paymentResult={},this.today=(0,r.default)(),this.nextBusinessDay=this.BusinessDaysService.add((0,r.default)(),1)}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;return this.loading=!0,this.flowService.activate(),this._setupNativeBackButton(),this.EventBusService.subscribe(this.$scope,this.billPayConstants.EVENTS.REFRESH_PAYEES,(function(){return t._refreshPayeeList()})),this.$q.all([this._retrieveAccounts(),this._retrievePayees()]).finally((function(){t.loading=!1}))}},{key:"_setupNativeBackButton",value:function(){var t=this;this.BackButtonService.addBackButtonListener(this.$scope,this.backButtonConstants.PRIORITY.HIGH,(function(){return t._handleNativeBackButtonClick()}))}},{key:"_handleNativeBackButtonClick",value:function(){return this.flowService.isDoneButtonVisible?this.onButtonClick(this.flowService.BUTTONS.BTN_ORG):this.flowService.BUTTONS.BTN_GRY.show&&this.onButtonClick(this.flowService.BUTTONS.BTN_GRY),!0}},{key:"_refreshPayeeList",value:function(){var t=this;return this.loading=!0,this._retrievePayees().finally((function(){t.loading=!1}))}},{key:"_retrievePayees",value:function(){var t=this;return this.payeeListService.getPayees().then((function(e){t.handleLoadPayees(e)})).catch((function(e){t.$log.error(e)}))}},{key:"_retrieveAccounts",value:function(){var t=this;return this.accountService.getAccounts().then((function(e){t.processAccounts(e)})).catch((function(e){t.$log.error(e)}))}},{key:"$postLink",value:function(){this.loading=!0}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"processAccounts",value:function(t){t&&t.fromAccounts&&(this.fromAccounts=t.fromAccounts),this.flowService.transactionAccount.data=this.fromAccounts[0],this.selectedFromAccount=this.fromAccounts[0].number,this.$log.debug("Multi Bill-Pay, From Accounts: ",this.fromAccounts),this._getFromAccountSelectOptions()}},{key:"handleLoadPayees",value:function(t){this.$log.debug("payee data:",t),this.payeeList=t.payees,this.payeeList.forEach((function(t){t.hasError=!1,t.dateIsBusinessDay=!0})),this.payeeList.length<=0?this.havePayees=!1:this.havePayees=!0}},{key:"processServiceResponse",value:function(t,e,n){var i=this,a=this.$log,s=this.flowService,r=!1;(this.confirmPayments.forEach((function(t){t.hasError=!1})),this.payeeList.forEach((function(t){t.hasError=!1})),t.response_status.status_code!==this.STATUS_CODES.SUCCESS)?t.response_status.details?t.response_status.details.forEach((function(t){if(t.field_name.indexOf("payments")>-1){var e=t.field_name.match(/\d+/g);i.confirmPayments[e].hasError=!0,i.confirmPayments[e].technicalDescription=t.technical_description,i.confirmPayments[e].detailsCode=t.details_code,i.confirmPayments.forEach((function(t){i.payeeList.forEach((function(e){e.account_number===t.payee.account_number&&!0===t.hasError&&(e.hasError=!0,r=!0,t.detailsCode===i.STATUS_CODES.RANGE?e.displayError=i.$sce.trustAsHtml(i.$translate.instant("billPay.multipleBP.billsToolTip")):t.detailsCode===i.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_DAILY?e.displayError=i.$sce.trustAsHtml(i.$translate.instant("global.errorCodes.BP_LIMIT_VIOLATION_DAILY")):t.detailsCode===i.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_SINGLE_PAYMENT&&(e.displayError=i.$sce.trustAsHtml(i.$translate.instant("global.errorCodes.BP_LIMIT_VIOLATION_SINGLE_PAYMENT"))))}))}))}})):t.response_status.status_code===this.billPayConstants.ERROR_CODES.DUPLICATE_TRANSACTION?this.confirmPayments.forEach((function(t){i.payeeList.forEach((function(e){e.id===t.payee.id&&(r=!0,e.hasError=!0,e.displayError=i.$sce.trustAsHtml(i.$translate.instant("global.errorCodes.DUPLICATE_TRANSACTION")))}))})):t.response_status.status_code===this.STATUS_CODES.SYSTEM_ERROR?-1!==[this.billPayConstants.ERROR_CODES.BP_RESTRICT,this.billPayConstants.ERROR_CODES.BP_SYSTEM_ERROR,this.billPayConstants.ERROR_CODES.BP_TELUS_SERVICE_DOWN,this.billPayConstants.ERROR_CODES.DUPBPMT].indexOf(t.response_status.return_code)&&this.confirmPayments.forEach((function(e){i.payeeList.forEach((function(n){n.id===e.payee.id&&(r=!0,n.hasError=!0,n.displayError=i.$sce.trustAsHtml(i.$translate.instant("global.errorCodes."+t.response_status.return_code)))}))})):t.response_status.status_code!==this.STATUS_CODES.AVLBAL&&t.response_status.status_code!==this.STATUS_CODES.MM_OVER_PAYMENT||t.response_status.return_code!==this.billPayConstants.ERROR_CODES.MM_OVER_PAYMENT&&t.response_status.return_code!==this.billPayConstants.ERROR_CODES.AVLBAL||this.confirmPayments.forEach((function(e){i.payeeList.forEach((function(n){n.id===e.payee.id&&(r=!0,n.hasError=!0,n.displayError=i.$sce.trustAsHtml(i.$translate.instant("global.errorCodes."+t.response_status.return_code)))}))})):t.response_status.status_code===this.STATUS_CODES.SUCCESS&&(t.confirmations.forEach((function(t,e){t.errors&&(t.errors.forEach((function(t){i.confirmPayments[e].hasError=!0,t.code===i.billPayConstants.ERROR_CODES.AVLBAL?i.confirmPayments[e].code=i.billPayConstants.ERROR_CODES.AVLBAL:t.code===i.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_DAILY?i.confirmPayments[e].code=i.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_DAILY:t.code===i.billPayConstants.ERROR_CODES.BP_SYSTEM_ERROR?i.confirmPayments[e].code=i.billPayConstants.ERROR_CODES.BP_SYSTEM_ERROR:t.code===i.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_SINGLE_PAYMENT&&(i.confirmPayments[e].code=i.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_SINGLE_PAYMENT)})),i.confirmPayments.forEach((function(t){i.payeeList.forEach((function(e){e.id===t.payee.id&&!0===t.hasError?(e.hasError=!0,r=!0,t.code===i.billPayConstants.ERROR_CODES.AVLBAL?e.displayError=i.$sce.trustAsHtml(i.$translate.instant("global.errorCodes.AVLBAL")):t.code===i.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_DAILY?e.displayError=i.$sce.trustAsHtml(i.$translate.instant("global.errorCodes.BP_LIMIT_VIOLATION_DAILY")):t.code===i.billPayConstants.ERROR_CODES.BP_SYSTEM_ERROR?e.displayError=i.$sce.trustAsHtml(i.$translate.instant("global.errorCodes.BP_SYSTEM_ERROR")):t.code===i.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_SINGLE_PAYMENT?e.displayError=i.$sce.trustAsHtml(i.$translate.instant("global.errorCodes.BP_LIMIT_VIOLATION_SINGLE_PAYMENT")):e.displayError=i.$sce.trustAsHtml(i.$translate.instant("billPay.multipleBP.paymentNotProccessed"))):e.id===t.payee.id&&!1===t.hasError&&(e.displayError=i.$sce.trustAsHtml(i.$translate.instant("billPay.multipleBP.paymentNotProccessed")))}))})))})),!1===r&&s.gotoNextState());if(this.flowService.transactionAccount.data=e.fromAccounts.find((function(t){return t.number===i.flowService.transactionAccount.data.number})),!t.confirmations)return this.paymentResult.newBalance=this.flowService.transactionAccount.data.available_balance,this.paymentResult.isAllProcessed=!1,this.paymentResult.isAllNow=!1,void s.hideWarning();this.paymentResult.newBalance=this.flowService.transactionAccount.data.available_balance,a.debug("Transaction Account: ",this.flowService.transactionAccount),this.paymentResult.isAllProcessed=!0,this.confirmPayments.forEach((function(e,n){var a=e;t.confirmations.forEach((function(t){return t.confirmation_code?(a.isProcessed=!0,!0):(i.paymentResult.isAllProcessed=!1,a.isProcessed=!1,!1)})),i.confirmPayments[n].confirmation_code=t.confirmations[n].confirmation_code})),this.paymentResult.isAllNow=!0,n.payments.some((function(t){return t.when!==i.billPayConstants.WHEN.NOW&&(i.paymentResult.isAllNow=!1,!0)}))}},{key:"onButtonClick",value:function(t){var e=this,n=this.$log,i=this.flowService,a=this.payBillService;switch(n.debug(t),t.type){case i.BUTTON_TYPES.BACK:n.debug("BACK ACTION"),i.gotoPreviousState();break;case i.BUTTON_TYPES.CANCEL:n.debug("CANCEL ACTION"),this._close();break;case i.BUTTON_TYPES.NEXT:n.debug("NEXT ACTION"),this.deleteEmptyTransactions(),this._getConfirmState(),this._checkForScheduledBill(),this.paymentError=!1,this.confirmPayments.forEach((function(t){t.hasError=!1})),this.payeeList.forEach((function(t){t.hasError=!1}));var s=this._getTransactionPayload();s.validate_only=!0,a.submitMultiBillTransaction(s).then((function(t){e.accountService.getAccounts().then((function(a){n.debug("Multi Bill Pay Response: ",t),n.debug("Updated Accounts Response: ",a),e.processServiceResponse(t,a,s),i.hideWarning()})).catch((function(t){e.paymentError=t,n.error(t),i.hideWarning()}))})).catch((function(t){e.paymentError=t,n.error(t),i.hideWarning()}));break;case i.BUTTON_TYPES.PAY:n.debug("PAY ACTION"),this.paymentError=!1,s=this._getTransactionPayload(),a.submitMultiBillTransaction(s).then((function(t){e.accountService.getAccounts().then((function(a){if(e.paymentResult.response=t,n.debug("Multi Bill Pay Response: ",t),n.debug("Updated Accounts Response: ",a),e.processServiceResponse(t,a,s),e.flowService.transactionAccount.data=a.fromAccounts.find((function(t){return t.number===e.flowService.transactionAccount.data.number})),!t.confirmations)return e.paymentResult.newBalance=e.flowService.transactionAccount.data.available_balance,e.paymentResult.isAllProcessed=!1,e.paymentResult.isAllNow=!1,i.gotoNextState(),void i.hideWarning();e.paymentResult.newBalance=e.flowService.transactionAccount.data.available_balance,n.debug("Transaction Account: ",e.flowService.transactionAccount),e.paymentResult.isAllProcessed=!0,e.confirmPayments.forEach((function(n,i){var a=n;t.confirmations.forEach((function(t){return t.confirmation_code?(a.isProcessed=!0,!0):(e.paymentResult.isAllProcessed=!1,a.isProcessed=!1,!1)})),e.confirmPayments[i].confirmation_code=t.confirmations[i].confirmation_code})),e.paymentResult.isAllNow=!0,s.payments.some((function(t){return t.when!==e.billPayConstants.WHEN.NOW&&(e.paymentResult.isAllNow=!1,!0)})),n.debug("Payment result: ",e.paymentResult),i.gotoNextState(),i.hideWarning()})).catch((function(t){e.paymentError=t,n.error(t),i.gotoNextState(),i.hideWarning()}))})).catch((function(t){e.paymentError=t,n.error(t),i.gotoNextState(),i.hideWarning()})),i.gotoNextState();break;case i.BUTTON_TYPES.DONE:n.debug("DONE ACTION"),this.paymentResult.isAllProcessed?this._closeImidiately():this._close();break;default:n.debug("default - NO ACTION")}}},{key:"payeeAmountChange",value:function(t,e){this.flowService.transaction[e.id]||(this.flowService.transaction[e.id]={}),this.flowService.transaction[e.id].account_number=e.account_number,this.flowService.transaction[e.id].amount=t}},{key:"setPaymentDate",value:function(t,e,n,i){var a=!1;this.flowService.transaction[t]&&this.flowService.transaction[t].amount&&(a=this.flowService.transaction[t].amount),this.flowService.transaction[t]={},a&&(this.flowService.transaction[t].amount=a),e?this.flowService.transaction[t].selectedDate=(0,r.default)():(this.datePickerMaxDate=r.default.utc().add(1,"years"),this.flowService.transaction[t].selectedDate=this.BusinessDaysService.nextBusinessDay((0,r.default)())),this.flowService.transaction[t].isLater=n,i?(this.flowService.transaction[t].selectionMode=this.dateConstants.DATE_SELECTOR_MODES.INDEFINITE,this.flowService.transaction[t].frequency=this.dateConstants.FREQUENCY_MODE_CONSTANTS.MONTHLY):this.flowService.transaction[t].selectionMode=this.dateConstants.DATE_SELECTOR_MODES.SINGLE}},{key:"onModalClose",value:function(){this.paymentResult.isAllProcessed?this._closeImidiately():this._close()}},{key:"fromAccountChange",value:function(t){this.flowService.transactionAccount.data=this.fromAccounts[t.index],this.$log.debug("New From Account: ",this.flowService.transactionAccount.data)}},{key:"getPaymentWhenTranslation",value:function(t){return(0,r.default)(t.date).format(this.billPayConstants.MOMENT_FORMAT)===(0,r.default)().format(this.billPayConstants.MOMENT_FORMAT)?"global.commonWords.now":"global.commonWords.later"}},{key:"deleteEmptyTransactions",value:function(){var t=this;(0,i.default)(this.flowService.transaction).forEach((function(e){(!t.flowService.transaction[e].amount||t.flowService.transaction[e].amount<=0)&&delete t.flowService.transaction[e]}))}},{key:"_getFromAccountSelectOptions",value:function(){var t=this;this.$translate("billPay.multipleBP.chequing").then((function(e){t.fromAccountOptions=[],t.fromAccounts.forEach((function(n,i){var a=t.EnvironmentService.isPhone()?10:20,s=n.nickname?n.nickname:e;s.length>a&&(s=s.substring(a,0)+"...");var r="<b>"+s+"</b>  "+t.$filter("maskNumber")(n.display_name);t.fromAccountOptions.push({title:r,balance:t.$filter("currency")(n.available_balance),index:i,number:n.number})}))}))}},{key:"_getConfirmState",value:function(){var t=this;this.confirmPayments=[];var e=(0,i.default)(this.flowService.transaction),n=this.payeeList.slice(0),a=this.$filter("maskNumber")(this.flowService.transactionAccount.data.display_name),s=this.AccountHelpersService.getDisplayNameInstant(this.flowService.transactionAccount.data),r=[];this.amountTotal=0,e.forEach((function(e){if(t.flowService.transaction[e].amount){t.amountTotal+=parseFloat(t.flowService.transaction[e].amount);var i={payee_id:e,amount:t.flowService.transaction[e].amount,selectionMode:t.flowService.transaction[e].selectionMode};t.flowService.transaction[e].selectionMode?t.flowService.transaction[e].selectionMode===t.dateConstants.DATE_SELECTOR_MODES.SINGLE?i.date=t._getPayeeSelectedDate(e):(i.frequency=t.flowService.transaction[e].frequency,i.selectedDate=t._getPayeeSelectedDate(e),i.isInfinite=t.flowService.transaction[e].selectionMode===t.dateConstants.DATE_SELECTOR_MODES.INDEFINITE,i.isInfinite||(i.endDate=t._getPayeeEndDate(e))):i.date=new Date;var a=n.findIndex((function(t){return t.id===e})),s=n[a];n.splice(a,1),r.push(s),i.header=t.$translate.instant("global.commonWords.to"),s.name&&(i.header+=" "+t.$filter("normalizeType")(s.name)),t.payeeList.forEach((function(t){t.id===e&&(i.header+=" "+t.account_number)})),i.payee=s,t.confirmPayments.push(i)}else delete t.flowService.transaction[e]})),this.$log.debug("Confirmation Payments: ",this.confirmPayments),this.$translate("billPay.multipleBP.and").then((function(e){var n=t.$filter("currency")(t.amountTotal),i="";r.forEach((function(n,a){var s=void 0;s=n.name?t.$filter("normalizeType")(n.name):n.account_number,i+=t.$translate.instant("billPay.multipleBP.accountTag",{accountName:s}),a<=r.length-3?i+=", ":r.length>1&&a===r.length-2&&(i+=" "+e+" ")})),t.$translate("billPay.multipleBP.billReview",{currencyTotal:n,accountNickName:s,accountNumber:a}).then((function(e){t.totalHeader=e,t.billList=i.toUpperCase()}))}))}},{key:"isCreditCardPayment",value:function(t){return!!t.payee&&(t.payee.vendor_id===this.CC_VALUE.ID&&Object.prototype.hasOwnProperty.call(t.payee,"account_token"))}},{key:"_getPayeeSelectedDate",value:function(t){return this._getFormattedDateObjectFromMoment(this.flowService.transaction[t].selectedDate)}},{key:"_getPayeeEndDate",value:function(t){return this._getFormattedDateObjectFromMoment(this.flowService.transaction[t].endDate)}},{key:"_getFormattedDateObjectFromMoment",value:function(t){return t?new Date(t.year(),t.month(),t.date(),0,0,0):null}},{key:"_getTransactionPayload",value:function(){var t={};t.id=this.flowService.transactionAccount.data.number,t.validate_only=!1,t.payments=[];for(var e=0;e<this.confirmPayments.length;e++){var n={};n.payee_id=this.confirmPayments[e].payee_id,n.amount=this.confirmPayments[e].amount,this.confirmPayments[e].frequency?(n.when=this.billPayConstants.WHEN.ONGOING,n.frequency=this.confirmPayments[e].frequency.toUpperCase(),n.scheduled_start_date=(0,r.default)(this.confirmPayments[e].selectedDate).format(this.billPayConstants.MOMENT_FORMAT),this.confirmPayments[e].endDate&&(n.scheduled_end_date=(0,r.default)(this.confirmPayments[e].endDate).format(this.billPayConstants.MOMENT_FORMAT))):(0,r.default)(this.confirmPayments[e].date).format(this.billPayConstants.MOMENT_FORMAT)===(0,r.default)().format(this.billPayConstants.MOMENT_FORMAT)?n.when=this.billPayConstants.WHEN.NOW:(n.when=this.billPayConstants.WHEN.LATER,n.scheduled_start_date=(0,r.default)(this.confirmPayments[e].date).format(this.billPayConstants.MOMENT_FORMAT)),t.payments.push(n)}return t}},{key:"_close",value:function(){var t=this;this.flowService.isFormDirty()&&this.flowService.showWarning(),this.flowService.warn().then((function(){t.confirmPayments=[],t.paymentResult={},t.onClose()})),this.broadcast()}},{key:"broadcast",value:function(){var t=this;setTimeout((function(){t.flowService.$rootScope.$broadcast(t.eventConstants.UPDATE_LTS_SUMMARY)}),500)}},{key:"_closeImidiately",value:function(){this.confirmPayments=[],this.paymentResult={},this.onClose(),this.broadcast()}},{key:"onAddBPModalClose",value:function(t){this.$log.debug("examples onModalClose:",t),this.showAddBPModal=!1,"Finished"===t&&this._close()}},{key:"onDateChanged",value:function(t,e){this.payeeList[t].dateIsBusinessDay=this.BusinessDaysService.isBusinessDay(e)}},{key:"showAddBillPay",value:function(){0===this.fromAccounts.length&&this._requestAccounts(),this.showAddBPModal=!0}},{key:"showMultiplePayBills",value:function(){var t=this;return this.$state.go(this.menuConstants.ACTIVE_ON_PAGES.BILLS).then((function(){return t._close()}))}},{key:"_requestAccounts",value:function(){var t=this,e=this.$log;this.accountService.getAccounts().then((function(e){t._processAccounts(e)})).catch((function(t){e.error(t)}))}},{key:"_processAccounts",value:function(t){var e=this;this.$log.debug("From Accounts: ",t),this.fromAccounts=t.fromAccounts.filter((function(t){return t.type===e.ACCOUNT_TYPES.CHEQUING}))}},{key:"_checkForScheduledBill",value:function(){var t=this;this.hasScheduledPayments=!1,this.payeeList.forEach((function(e){var n=t.flowService.transaction[e.id];n&&!0===n.isLater&&(t.hasScheduledPayments=!0)}))}},{key:"multipleAmountInputFormSubmit",value:function(){this.generalFormSubmit()}},{key:"generalFormSubmit",value:function(){this.hideMobileKeyboard()}},{key:"hideMobileKeyboard",value:function(){this.removePageFocus()}},{key:"removePageFocus",value:function(){document.activeElement.blur()}},{key:"isOneOfPaymentsACreditCardPayment",get:function(){var t=this;return this.confirmPayments.some((function(e){return t.isCreditCardPayment(e)}))}}]),t}();c.$inject=["$log","$translate","$filter","$timeout","$state","billPayConstants","tngDateSelectorConstants","tngTileListConstants","tngSelectAutocompleteConstants","menuConstants","MultipleBillPayFlowService","PayeeListService","BillPayAccountsService","PayBillService","stateConstants","accountConstants","serviceConstants","BusinessDaysService","DateService","AccountHelpersService","EnvironmentService","$location","$anchorScroll","$sce","eventConstants","EventBusService","$scope","$q","BackButtonService","backButtonConstants"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(15)),a=d(n(177)),s=d(n(2)),r=d(n(264)),o=d(n(266)),c=d(n(265)),l=d(n(0)),u=d(n(267));function d(t){return t&&t.__esModule?t:{default:t}}var h=function t(e,n,i){(0,l.default)(this,t),this.type=e,this.show=n,this.disable=i},f=function(t){function e(t,n,i,s,o,c,u,d,h,f,p,g,m){(0,l.default)(this,e);var _=(0,r.default)(this,(e.__proto__||(0,a.default)(e)).call(this,t,n,i,s,o,p,u,m));return _.CC_VALUE=g.CC_VALUE,_.BusinessDaysService=f,_.TODAY_IN_EST=h.TODAY_IN_EST,_.$log=t,_.$translate=c,_.dateConstants=d,_.STATES={FROM:{titleKey:"billPay.multipleBP.chooseAccount"},CONFIRM:{titleKey:"billPay.multipleBP.headerReview"},LOADING:{},FINISH:{titleKey:"billPay.multipleBP.headerDone"}},_.transaction={},_.transactionAccount={data:{},tileDescription:""},_.$translate("billPay.multipleBP.payFrom").then((function(t){_.transactionAccount.tileDescription=t})),_._initialState=_.STATES.FROM,_.currentState=_._initialState,_._initialTransactionObj=null,_}return(0,c.default)(e,t),(0,s.default)(e,[{key:"gotoNextState",value:function(){switch(this.currentState){case this.STATES.FROM:this.moveTo(this.STATES.CONFIRM);break;case this.STATES.CONFIRM:this.moveTo(this.STATES.LOADING);break;case this.STATES.LOADING:this.moveTo(this.STATES.FINISH)}}},{key:"isFormDirty",value:function(){return!angular.equals(this._initialTransactionObj,this.transaction)}},{key:"firstStateNextDisabled",value:function(){var t=this;if(!this.transactionAccount||!this.transaction)return!0;var e=(0,i.default)(this.transaction),n=this._hasAmounts(e);if(e.length<1||!n)return!0;var a=0;return!e.every((function(e){var n=t.transaction[e];return!n.amount||n.amount<=0||(a+=n.amount,!n.isLater&&n.amount?n.amount>0:n.amount>0&&t.BusinessDaysService.isBusinessDay(n.selectedDate))}))||a<=0}},{key:"_hasAmounts",value:function(t){var e=this,n=!1;return t.forEach((function(t){e.transaction[t].amount&&(n=!0)})),n}},{key:"_resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,a.default)(e.prototype),"_resetState",this).call(this),this.isRecurring=!1,this.transaction={},this._initialTransactionObj=angular.copy(this.transaction),this.BUTTONS={BTN_GRY:new h(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new h(this.BUTTON_TYPES.NEXT,!0,!1)}}},{key:"_updateUI",value:function(){switch(this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_GRY.disable=!1,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!1,this.currentState){case this.STATES.FROM:this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.CANCEL,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.NEXT;break;case this.STATES.CONFIRM:this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.PAY;break;case this.STATES.LOADING:this.BUTTONS.BTN_ORG.show=!1,this.BUTTONS.BTN_GRY.show=!1;break;case this.STATES.FINISH:this.BUTTONS.BTN_GRY.show=!1,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.DONE}}},{key:"_getAnalyticsID",value:function(){return"billpay/multiple"}},{key:"isDoneButtonVisible",get:function(){return this.BUTTONS.BTN_ORG.type===this.BUTTON_TYPES.DONE&&this.BUTTONS.BTN_ORG.show}}]),e}(u.default);f.$inject=["$log","$q","$transitions","$state","$window","$translate","pageFlowConstants","tngDatePickerConstants","tngDateSelectorConstants","BusinessDaysService","$rootScope","billPayConstants","AnalyticsService"],e.default=f,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2247)),a=s(n(2248));function s(t){return t&&t.__esModule?t:{default:t}}n(2249);var r={template:i.default,controller:a.default,bindings:{payees:"<",onTileClick:"&?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="payee-list-container"> <div class="payee-list-heading top-list-margin"> {{ ::\'billPay.landingPage.payee\' | translate }} </div> <div class="search top-list-margin"> <div class="field"> <button actionable-id="bill-pay-seach_icon" class="field__icon icon-search"></button> <input ng-model="$ctrl.search" id="billPay-search-input" minlength="2" type="text" class="input" placeholder="{{ ::\'billPay.landingPage.searchPlaceholder\' | translate }}"> </div> </div> <div class="payee-table-wrapper"> <table class="table table--full payee-table"> <thead> <tr class="payee-table__header"> <th class="left-padded">{{ ::\'billPay.landingPage.name\' | translate }}</th> <th>{{ ::\'billPay.landingPage.lastPayment\' | translate }}</th> <th>{{ ::\'billPay.landingPage.nextPayment\' | translate }}</th> <th>{{ ::\'billPay.landingPage.paymentSetup\' | translate }}</th> <th></th> </tr> </thead> <tbody id="billPay-transactions-table"> <tr class="payee-table__row" ng-repeat="payee in $ctrl.payees | filter: $ctrl.filterPayees($ctrl.search)" ng-click="$ctrl.onTileClick({ payee })"> <td class="payee-name-cell left-padded"> <span ng-if="payee.nickname">{{ ::payee.nickname }}</span> <span ng-if="!payee.nickname">{{ ::payee.name }}</span> <div class="table__quiet CB_DataMask">{{ ::payee.account_number }}</div> </td> <td> {{ ::(payee.last_payment_amount | currency) || (\'billPay.landingPage.notAvailable\' | translate)}} <div class="table__quiet"> {{ ::payee.last_payment_date | date: $ctrl.dateFormatter }} </div> </td> <td> {{ ::payee.pendingTransactions[0].amount || (\'billPay.landingPage.notScheduled\' | translate) }} <div class="table__quiet"> {{ ::payee.pendingTransactions[0].date | date: $ctrl.dateFormatter }} </div> </td> <td> <div class="table__quiet" ng-if="payee.recurring"> {{ ::\'billPay.landingPage.recurringPayment\' | translate }} </div> </td> <td class="payee-chevron-cell"> <span class="payee-table__arrow icon-rightarrow"></span> </td> </tr> </tbody> </table> </div> <div class="payee-grid"> <div class="payee-grid__list" ng-repeat="payee in $ctrl.payees | filter: $ctrl.filterPayees($ctrl.search)" ng-click="$ctrl.onTileClick({ payee })"> <div class="payee-grid__name-tile"> <div class="name-details"> <div class="name-tag"> {{ ::payee.nickname || payee.name }} </div> <div class="number-tag"> {{ ::payee.account_number }} <span ng-if="payee.recurring">&nbsp;|&nbsp;&nbsp;{{ ::\'billPay.landingPage.recurringPayment\' | translate }}</span> </div> </div> <div class="name-arrow"> <span class="payee-grid__icon-arrow icon-rightarrow"></span> </div> </div> <div class="payee-grid__info-table"> <div class="payee-grid__info-tile payee-grid__row"> <div class="last-payment-info payee-grid__cell"> <div class="payment-date" ng-bind-html="::\'billPay.landingPage.lastPayment\' | translate "> </div> <div class="payment-amount"> {{ ::(payee.last_payment_amount | currency) || (\'billPay.landingPage.notAvailable\' | translate) }} </div> <div class="payment-date"> {{ ::payee.last_payment_date | date: $ctrl.dateFormatter }} </div> </div> <div class="next-payment-info payee-grid__cell"> <div class="payment-date" ng-bind-html="::\'billPay.landingPage.nextPayment\' | translate "> </div> <div class="payment-amount"> {{ ::payee.pendingTransactions[0].amount || (\'billPay.landingPage.notScheduled\' | translate) }} </div> <div class="payment-date"> {{ ::payee.pendingTransactions[0].date | date: $ctrl.dateFormatter }} </div> </div> </div> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.$log=e,this.DateService=n}return(0,a.default)(t,[{key:"$onInit",value:function(){this.dateFormatter=this.DateService.dateFormatter()}},{key:"filterPayees",value:function(t){return function(e){if(t){var n=t.toLowerCase(),i=!1;return e.nickname&&(i=i||e.nickname.toLowerCase().indexOf(n)>=0),e.name&&(i=i||e.name.toLowerCase().indexOf(n)>=0),e.account_number&&(i=i||e.account_number.indexOf(n)>=0),i}return!0}}}]),t}();r.$inject=["$log","DateService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.RequesterService=e,this.serviceConstants=n,this.billPayConstants=a,this.$httpParamSerializer=r,this.$q=s}return(0,a.default)(t,[{key:"getPayees",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={urlVars:{queryString:this.$httpParamSerializer(t)}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.PAYEE_LIST,n,e)}},{key:"getAccounts",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.BILL_PAY_ACCOUNTS)}}]),t}();r.$inject=["RequesterService","serviceConstants","billPayConstants","$q","$httpParamSerializer"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.RequesterService=e,this.serviceConstants=n,this.billPayConstants=a,this.$log=s,this.$q=r}return(0,a.default)(t,[{key:"editPayee",value:function(t,e){var n={urlVars:{id:e},data:{payee:t}};return this.$log.debug("PUT payee object: ",t),this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.EDIT_PAYEE,n)}},{key:"deletePayee",value:function(t){var e={urlVars:{id:t}};return this.$log.debug("DELETE payee id: ",t),this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.DELETE_PAYEE,e)}}]),t}();r.$inject=["RequesterService","serviceConstants","billPayConstants","$log","$q"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(104)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s,r,o){(0,a.default)(this,t),this.$log=e,this.RequesterService=n,this.AVAILABLE_SERVICES=i.AVAILABLE_SERVICES,this.serviceConstants=i,this.billPayConstants=s,this.$q=r,this.tngDateSelectorConstants=o}return(0,s.default)(t,[{key:"getAccountDetails",value:function(t){var e={urlVars:{accountHash:t}};return this.RequesterService.request(this.AVAILABLE_SERVICES.ACCOUNT_DETAILS_CREDIT_CARD,e)}},{key:"submitBillTransaction",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.payFromAccount.number,i={urlVars:{}};return t.CC_DETAILS?(i.urlVars.accountHash=n,i.data=this._buildCCParams(t,e),this.RequesterService.request(this.AVAILABLE_SERVICES.MOVE_MONEY_SUBMIT,i)):(i.urlVars.accountHash=n,i.data=this._buildParams(t,e),this.RequesterService.request(this.AVAILABLE_SERVICES.BILL_PAY_TRANSACTION,i))}},{key:"updateExistingTransaction",value:function(t){var e=this._buildParams(t),n=(0,i.default)(e.payments,1)[0];return this.RequesterService.request(this.AVAILABLE_SERVICES.UPDATE_BILL_PAY_TRANSACTION,{urlVars:{accountHash:t.payFromAccount.number,seqNum:t.sequenceNumber},data:{validate_only:!1,payment:{amount:n.amount,frequency:n.frequency||this.billPayConstants.FREQUENCY.ONCE,scheduled_start_date:n.scheduled_start_date,scheduled_end_date:n.scheduled_end_date}}})}},{key:"_buildCCParams",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={validate_only:e,transfers:{to_account:t.payee.account_token,when:t.when,currency:t.currency,amount:t.amount}};return t.when===this.billPayConstants.WHEN.LATER&&(n.transfers.scheduled_start_date=t.scheduledStartDate.format("YYYY-MM-DD")),t.when===this.billPayConstants.WHEN.ONGOING&&(n.transfers.frequency=t.frequency,n.transfers.payment_indicator=t.payment_indicator),n}},{key:"_buildParams",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={validate_only:e,payments:[{payee_id:t.payee.id,when:t.when,amount:t.amount}]};return t.when!==this.billPayConstants.WHEN.NOW&&(n.payments[0].scheduled_start_date=t.scheduledStartDate.format("YYYY-MM-DD"),t.when===this.billPayConstants.WHEN.ONGOING&&(n.payments[0].frequency=t.frequency,t.datePickerSelectionMode!==this.tngDateSelectorConstants.DATE_SELECTOR_MODES.INDEFINITE&&(n.payments[0].scheduled_end_date=t.scheduledEndDate.format("YYYY-MM-DD")))),n}},{key:"submitMultiBillTransaction",value:function(t){var e=t,n=e.id;delete e.id;var i={urlVars:{accountHash:n},data:e};return this.$log.debug("post transaction object"),this.$log.debug(e),this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.BILL_PAY_TRANSACTION,i)}}]),t}();o.$inject=["$log","RequesterService","serviceConstants","billPayConstants","$q","tngDateSelectorConstants"],e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2254)),a=s(n(2255));function s(t){return t&&t.__esModule?t:{default:t}}n(2256);var r={controller:a.default,template:i.default,bindings:{onClose:"&",payee:"<",fromAccounts:"<",isSchedule:"<",isEdit:"<",currentTransaction:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose(result)" class="c-bill-pay" hide-close="$ctrl.flowService.inLoadingMode" flow-service="$ctrl.flowService"> <header> <span ng-if="$ctrl.flowService.showMainUI"> <span ng-if="$ctrl.flowService.currentState !== $ctrl.flowService.STATES.AMOUNT &&\n          !([$ctrl.flowService.STATES.REVIEW, $ctrl.flowService.STATES.REVIEW_WARNING].includes($ctrl.flowService.currentState) &&\n            $ctrl.flowService.isCCOngoingMonthly)"> {{ $ctrl.flowService.currentState.titleKey | translate }} </span> <span ng-if="[$ctrl.flowService.STATES.REVIEW, $ctrl.flowService.STATES.REVIEW_WARNING].includes($ctrl.flowService.currentState) &&\n            $ctrl.flowService.isCCOngoingMonthly"> {{ \'billPay.states.reviewStateCCOngoing\' | translate}} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.AMOUNT && !$ctrl.flowService.isCCOngoingMonthly &&\n            !($ctrl.flowService.isCreditCardPayee &&\n            $ctrl.flowService.transaction.when === $ctrl.flowService.TIME_STATES.ONGOING)" ng-bind-html="\'billPay.states.amountStateManual\' | translate:{\n          payeeName: $ctrl.payee.name,\n          payDate: $ctrl.flowService.transaction.scheduledStartDate\n        }"> </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.AMOUNT &&\n            ($ctrl.flowService.isCreditCardPayee &&\n            $ctrl.flowService.transaction.when === $ctrl.flowService.TIME_STATES.ONGOING)"> {{ \'billPay.states.amountStateCCOngoing\' | translate}} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DATE &&\n        $ctrl.flowService.transaction.when === $ctrl.flowService.TIME_TYPES.WHEN.ONGOING"></span> </span> </header> <div ng-if="$ctrl.flowService.showMainUI"> <div class="c-account-select" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.FROM"> <p class="margin__t--fix2">{{ \'billPay.singleBP.headerChooseAccount\' | translate }}</p> <tng-tile-list class="c-billPay-state__tile-list" tile-data="$ctrl.flowService.transaction.fromAccounts" tile-type="$ctrl.TILE_TYPE.account" all-actionable="true" on-tile-click="$ctrl.getFromAccount(index, tileData)" selected-tiles="$ctrl.selectedTiles" single-select="true"> </tng-tile-list> </div> <div class="c-when-state" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.WHEN ||\n    $ctrl.flowService.currentState == $ctrl.flowService.STATES.WHEN_SCHEDULE"> <tng-tile-list class="c-billPay-state__tile-list" tile-data="$ctrl.WHEN_TILES" tile-type="$ctrl.TILE_TYPE.text" all-actionable="true" on-tile-click="$ctrl.flowService.onWhenSelect(index, tileData)"> </tng-tile-list> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.DATE_LATER ||\n       $ctrl.flowService.currentState == $ctrl.flowService.STATES.DATE_ONGOING" class="c-select-date-state"> <tng-error-message ng-show="!$ctrl.isBusinessDay($ctrl.flowService.transaction.scheduledStartDate)"> <span translate="billPay.singleBP.businessDayWarning"></span> </tng-error-message> <tng-date-selector selected-date="$ctrl.flowService.transaction.scheduledStartDate" min-date="$ctrl.flowService.transaction.minDate" max-date="$ctrl.flowService.transaction.maxDate" end-date="$ctrl.flowService.transaction.scheduledEndDate" hide-selection-mode-selector="!$ctrl.flowService.transaction.isRecurring" hide-frequency-selector="!$ctrl.flowService.transaction.isRecurring" selection-mode="$ctrl.flowService.transaction.datePickerSelectionMode" frequency="$ctrl.flowService.transaction.frequency" selection-mode-exclude-single="true" frequency-exclude-none="true" frequency-exclude-daily="true" frequency-quarterly-and-yearly-excluded="true" single-month-view-enabled="true"> </tng-date-selector> </div> <div class="c-amount-state" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.AMOUNT"> <div class="c-bill-pay__error" ng-show="$ctrl.hasErrors()"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors track by $index">{{ error }}</li> </ul> </tng-error-message> </div> <div ng-if="!$ctrl.flowService.isCCOngoingMonthly"> <div class="c-bill-pay__input-help-bubble-container"> <div class="c-bill-pay__input-help-bubble-cell"> <div ng-if="!$ctrl.flowService.isCCOngoingMonthly"> <form ng-submit="$ctrl.flowService.submit()"> <tng-amount-input ng-model="$ctrl.flowService.transaction.amount" focus="$ctrl.isCustomAmountChecked" locale="$ctrl.locale" input-max-length="$ctrl.mountMaxLen" set-value="$ctrl.flowService.transaction.amount" on-amount-change="$ctrl.amountValueChangedManually(amount, currency)" on-blur="$ctrl.isAmountValid(amount)" input-type="$ctrl.amountInputType" ng-click="$ctrl.selectCustomAmount()" max-amount="$ctrl.billPayMaxAmount"></tng-amount-input> </form> </div> </div> <div class="c-bill-pay__input-help-bubble-cell"> <tng-help-bubble><span ng-bind-html="\'billPay.multipleBP.billsToolTip\' | translate"></span></tng-help-bubble> </div> </div> <div class="c-bill-pay__payment-options" ng-if="$ctrl.flowService.isCreditCardPayment"> <div class="field"> <input id="paymentOption1" name="paymentOptions" class="input input--tangerine-radio" type="radio" ng-value="$ctrl.CC_PAYMENT_OPTIONS.CUSTOM" ng-model="$ctrl.paymentOption" ng-checked="$ctrl.isCustomAmountChecked" ng-click="$ctrl.radioSelectionChanged()"/> <label class="field__CC-label" for="paymentOption1"><strong>{{ \'moveMoney.paymentOptions.custom\' | translate }}</strong></label> </div> <div class="field"> <input id="paymentOption2" name="paymentOptions" class="input input--tangerine-radio" type="radio" ng-value="$ctrl.CC_PAYMENT_OPTIONS.LAST_STATEMENT_BALANCE" ng-model="$ctrl.paymentOption" ng-disabled="$ctrl.isCCStmtBalRadioDisabled($ctrl.flowService.transaction.CC_DETAILS.last_statement_balance)" ng-click="$ctrl.radioSelectionChanged($ctrl.flowService.transaction.CC_DETAILS.last_statement_balance)"/> <label class="field__CC-label" for="paymentOption2"> <strong class="heading--sub4">{{ $ctrl.flowService.transaction.CC_DETAILS.last_statement_balance | currency }}</strong> <strong>{{ \'moveMoney.paymentOptions.lastStatementBalance\' | translate }}</strong> <span ng-if="$ctrl.nextPaymentDueDate"> <span class="field__CC-due-date">- {{ \'moveMoney.paymentOptions.due\' | translate }} {{ $ctrl.nextPaymentDueDate | date:\'MMM dd, yyyy\' }}</span> </span> </label> </div> <div class="field"> <input id="paymentOption3" name="paymentOptions" class="input input--tangerine-radio" type="radio" ng-value="$ctrl.CC_PAYMENT_OPTIONS.MINUMUM_PAYMENT" ng-model="$ctrl.paymentOption" ng-disabled="$ctrl.isCCRadioDisabled($ctrl.flowService.transaction.CC_DETAILS.minimum_payment)" ng-click="$ctrl.radioSelectionChanged($ctrl.flowService.transaction.CC_DETAILS.minimum_payment)"/> <label class="field__CC-label" for="paymentOption3"> <strong class="heading--sub4">{{ $ctrl.flowService.transaction.CC_DETAILS.minimum_payment | currency }}</strong> <strong>{{ \'moveMoney.paymentOptions.minimumPayment\' | translate }}</strong> <span ng-if="$ctrl.nextPaymentDueDate"> <span class="field__CC-due-date">- {{ \'moveMoney.paymentOptions.due\' | translate }} {{ $ctrl.nextPaymentDueDate | date:\'MMM dd, yyyy\' }}</span> </span> </label> </div> <div class="field"> <input id="paymentOption4" name="paymentOptions" class="input input--tangerine-radio" type="radio" ng-value="$ctrl.CC_PAYMENT_OPTIONS.CURRENT_BALANCE" ng-model="$ctrl.paymentOption" ng-disabled="$ctrl.isCCCurBalRadioDisabled($ctrl.flowService.transaction.CC_DETAILS.current_balance)" ng-click="$ctrl.radioSelectionChanged($ctrl.flowService.transaction.CC_DETAILS.current_balance)"/> <label class="field__CC-label" for="paymentOption4"> <strong class="heading--sub4">{{ $ctrl.flowService.transaction.CC_DETAILS.current_balance | currency }}</strong> <strong>{{ \'moveMoney.paymentOptions.currentBalance\' | translate }}</strong> </label> </div> </div> <tng-tile-list class="c-billPay-state__tile-list" tile-data="$ctrl.flowService.accountFromTileData" tile-type="$ctrl.TILE_TYPE.account" short-tile="$ctrl.flowService.shortTile"> </tng-tile-list> <tng-tile-list class="c-billPay-state__tile-list" tile-data="$ctrl.flowService.whenStateDateTileListData" tile-type="$ctrl.TILE_TYPE.date" short-tile="$ctrl.flowService.shortTile"> </tng-tile-list> </div> <div class="c-payment-recurring__tile-list" ng-if="$ctrl.flowService.isCCOngoingMonthly"> <tng-tile-list tile-data="$ctrl.recurringCCButtonTiles" tile-type="this.TILE_TYPE.text" is-actionable="true" on-tile-click="$ctrl.flowService.handleRecurringCCTileClick(index)"> </tng-tile-list> <p>{{ \'billPay.singleBPCC.recurringCCButtons.footer\' | translate }}</p> </div> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.REVIEW || $ctrl.flowService.currentState == $ctrl.flowService.STATES.REVIEW_WARNING" class="c-review-state"> <div class="c-bill-pay__error" ng-show="$ctrl.flowService.submitWarnings"> <tng-warning-message> {{::\'global.errorCodes.WARNING_DUPTRAN\' | translate }} </tng-warning-message> </div> <div class="c-bill-pay__error" ng-show="$ctrl.flowService.submitErrors"> <tng-error-message> <span ng-bind-html="$ctrl.flowService.submitErrors"></span> </tng-error-message> </div> <p class="c-bill-pay__confirmation-header margin__tb--fix2 has-no-margin-top"> <span ng-if="$ctrl.flowService.transaction.when === $ctrl.flowService.TIME_STATES.NOW" id="billPay-reviewDetailsNow-title" ng-bind-html="\'billPay.reviewDetailsNow\' | translate:{\n            amount: $ctrl.flowService.transaction.amount,\n            accountName: $ctrl.displayName,\n            accountNumber: $ctrl.flowService.getMaskedAccountNumber(),\n            payeeName: $ctrl.payee.name\n          }"> </span> <span ng-if="$ctrl.flowService.transaction.when === $ctrl.flowService.TIME_STATES.LATER" id="billPay-reviewDetailsLater-title" ng-bind-html="\'billPay.reviewDetailsLater\' | translate:{\n            amount: $ctrl.flowService.transaction.amount,\n            accountName: $ctrl.displayName,\n            accountNumber: $ctrl.flowService.getMaskedAccountNumber(),\n            payeeName: $ctrl.payee.name,\n            when: $ctrl.flowService.reviewData.date\n          }"> </span> <span ng-if="$ctrl.flowService.transaction.when === $ctrl.flowService.TIME_STATES.ONGOING && $ctrl.flowService.isCCOngoingMonthly== false" id="billPay-reviewDetailsOngoing-title" ng-bind-html="\'billPay.reviewDetailsOngoing\' | translate:{\n            amount: $ctrl.flowService.transaction.amount,\n            accountName: $ctrl.displayName,\n            accountNumber: $ctrl.flowService.getMaskedAccountNumber(),\n            payeeName: $ctrl.payee.name,\n            when: $ctrl.flowService.reviewData.date,\n            frequency:  ($ctrl.getFrequencyTranslationKey($ctrl.flowService.transaction.frequency) | translate),\n            scheduledStartDate: $ctrl.flowService.reviewData.startDate,\n            scheduledEndDate: $ctrl.flowService.reviewData.endDate,\n            isIndefinite: ($ctrl.flowService.transaction.datePickerSelectionMode ===\n                $ctrl.flowService.DATE_SELECTOR_MODES.INDEFINITE),\n          }"> </span> </p> <div ng-if="$ctrl.flowService.isCCOngoingMonthly"> <p class="confirm-message" ng-if="$ctrl.flowService.reviewData.payment_indicator == \'F\'"> <span ng-bind-html="\'billPay.singleBPCC.descCCPayFull\' | translate:{day: $ctrl.flowService.reviewData.ccRecurringPaymentDay }"> </span> </p> <p class="confirm-message" ng-if="$ctrl.flowService.reviewData.payment_indicator == \'M\'"> <span ng-bind-html="\'billPay.singleBPCC.descCCPayMinimum\' |  translate:{day: $ctrl.flowService.reviewData.ccRecurringPaymentDay }"> </span> </p> </div> <tng-tile-list class="c-billPay-state__single-tile" tile-data="$ctrl.flowService.reviewData.amountTileData" tile-type="$ctrl.TILE_TYPE.amount" short-tile="$ctrl.flowService.shortTile && !$ctrl.flowService.isCCOngoingMonthly" is-actionable="$ctrl.modalType !== $ctrl.MODAL_TYPES.CC" on-tile-click="$ctrl.modalType !== $ctrl.MODAL_TYPES.CC ? $ctrl.flowService.moveBackTo($ctrl.flowService.STATES.AMOUNT) : \'\'"></tng-tile-list> <tng-tile-list class="c-billPay-state__single-tile" tile-data="$ctrl.flowService.accountFromTileData" tile-type="$ctrl.TILE_TYPE.account" short-tile="$ctrl.flowService.shortTile" is-actionable="$ctrl.isActionable(index)" on-tile-click="$ctrl.moveBackToAccountSelect(index)"> </tng-tile-list> <tng-tile-list ng-if="!($ctrl.flowService.isCreditCardPayment && $ctrl.flowService.isCCOngoingMonthly) && $ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW" class="c-billPay-state__single-tile review__date-tile" ng-class="{disabled: $ctrl.modalType === $ctrl.MODAL_TYPES.CCFULLPAY}" tile-data="$ctrl.flowService.whenStateDateTileListData" tile-type="$ctrl.TILE_TYPE.date" is-actionable="true" short-tile="$ctrl.flowService.shortTile" on-tile-click="$ctrl.moveBackToWhen()" tile-list-id="singleBillPay-date-tile-list"> </tng-tile-list> <p class="c-billPay-disclaimer"> {{ ::\'billPay.ccReminder\' | translate }} </p> <br/> <p class="c-billPay-disclaimer" ng-if="$ctrl.flowService.isCreditCardPayment && $ctrl.flowService.isCCOngoingMonthly"> {{ ::\'billPay.ccOngoingReminder\' | translate }} </p> <p class="c-billPay-discalimer-space-below"></p> </div> <single-bill-confirmed-state data="$ctrl.confirmedData" payee="$ctrl.payee" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.DONE_NOW ||\n        $ctrl.flowService.currentState == $ctrl.flowService.STATES.DONE_LATER"> </single-bill-confirmed-state> </div> <div ng-show="$ctrl.flowService.inLoadingMode" class="c-review-state"> <tng-loading-in-progress is-loading-key="billPay.states.interstitialLoadingState"> </tng-loading-in-progress> </div> <footer ng-hide="$ctrl.flowService.showConfirmExitUI"> <button actionable-id="{{$ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_GRY.type.label)}}" watch-actionable-id="true" class="btn btn--edit" ng-show="$ctrl.flowService.BUTTONS.BTN_GRY.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_GRY.disable" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_GRY)"> {{ $ctrl.flowService.BUTTONS.BTN_GRY.type.label | translate }} </button> <button actionable-id="{{$ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_ORG.type.label)}}" watch-actionable-id="true" class="btn btn--orange" ng-class="{\'CB_ReadOnly\': $ctrl.flowService.CB_DISABLED_BUTTONS.includes($ctrl.flowService.BUTTONS.BTN_ORG.type)}" ng-show="$ctrl.flowService.BUTTONS.BTN_ORG.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_ORG.disable" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_ORG)"> {{ $ctrl.flowService.BUTTONS.BTN_ORG.type.label | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(15)),a=l(n(1795)),s=l(n(104)),r=l(n(8)),o=l(n(0)),c=l(n(2));function l(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(e,n,i,a,s,r,c,l,u,d,h,f,p,g,m,_,v,S){(0,o.default)(this,t),this.flowService=n,this.$translate=g,this.$log=e,this.accountService=i,this.accountHelpersService=a,this.payBillService=s,this.tngDateSelectorConstants=f,this.billPayConstants=c,this.accountConstants=r,this.dateService=p,this.$q=_,this.MoveMoneyAccountsService=v,this.TimerService=S,this.ACCOUNT_TYPES=r.ACCOUNT_TYPES,this.TILE_TYPE=l.TILE_TYPE,this.LOCALES=d.LOCALES,this.MODAL_TYPES=u.MODAL_TYPES,this.modalType=this.MODAL_TYPES.DEFAULT,this.RECURRING_CC_BUTTONS=c.RECURRING_CC_BUTTONS,this.CC_PAYMENT_OPTIONS=c.CC_PAYMENT_OPTIONS,this.CC_VALUE=c.CC_VALUE,this.GOOD_STATUS_CODES=h,this.amountMaxLen=this.accountConstants.AMOUNT_MAX_LEN,this.locale=this.LOCALES.EN_CA,this.amountValue="",this.submitErrors=[],this.selectedTiles=[],this.isCustomAmountChecked=!0,this.paymentOption=this.CC_PAYMENT_OPTIONS.CUSTOM,this.nickNameMaxLen=r.NICKNAME_MAX_LEN,this.recurringCCButtonTiles=[this.RECURRING_CC_BUTTONS.MINIMUM,this.RECURRING_CC_BUTTONS.FULL],this.tngDatePickerConstants=m,this.fromAccounts||this._requestAccounts()}return(0,c.default)(t,[{key:"$onInit",value:function(){var t=this;this.flowService.activate(),this.isSchedule&&(this.flowService.schedulePay=!0),this.flowService.transaction.fromAccounts=this.fromAccounts,this.flowService.transaction.payee=this.payee,this.flowService.isCreditCardPayment?(this.WHEN_TILES=this.billPayConstants.WHEN.WHEN_TILES,this.payee.ACCOUNT_DETAILS.credit_card.cc_account_details.is_primary_account||(this.WHEN_TILES=this.WHEN_TILES.filter((function(e){return e.when!==t.billPayConstants.WHEN.ONGOING}))),this.flowService.transaction.CC_DETAILS=this.payee.ACCOUNT_DETAILS.credit_card.cc_account_details.card_details):this.flowService.isCreditCardPaymentBySec?(this.WHEN_TILES=this.billPayConstants.WHEN.WHEN_A_TILES,this.flowService.transaction.CC_DETAILS=this.payee.ACCOUNT_DETAILS.credit_card.cc_account_details.card_details):this.WHEN_TILES=this.billPayConstants.WHEN.WHEN_TILES,this.isSchedule&&(this.WHEN_TILES=this.WHEN_TILES.filter((function(e){return e.when!==t.billPayConstants.WHEN.NOW}))),this.isEdit&&(this.flowService.editPay=!0,this._updateFlowServiceWithExistingTransactionData()),this.amountDirty=!1}},{key:"_checkLastPaymentRadio",value:function(){var t=this.flowService.transaction.payFromAccount.available_balance,e=this.flowService.transaction.CC_DETAILS.last_statement_balance;e>0&&t>=e&&(this.isCustomAmountChecked=!1,this.amountValueChanged(e),this.paymentOption=this.CC_PAYMENT_OPTIONS.LAST_STATEMENT_BALANCE)}},{key:"_updateFlowServiceWithExistingTransactionData",value:function(){var t=this;(0,r.default)(this.flowService.transaction,{amount:this.currentTransaction.amount,currency:this.currentTransaction.from_account.currency,datePickerSelectionMode:this.currentTransaction.frequency===this.billPayConstants.FREQUENCY.ONCE?this.tngDateSelectorConstants.DATE_SELECTOR_MODES.SINGLE:angular.isDefined(this.currentTransaction.expiry_date)?this.tngDateSelectorConstants.DATE_SELECTOR_MODES.RANGE:this.tngDateSelectorConstants.DATE_SELECTOR_MODES.INDEFINITE,frequency:this.currentTransaction.frequency===this.billPayConstants.FREQUENCY.ONCE?null:this.currentTransaction.frequency,isRecurring:this.currentTransaction.frequency!==this.billPayConstants.FREQUENCY.ONCE,payFromAccount:this.currentTransaction.from_account,scheduledStartDate:moment.utc(this.currentTransaction.effective_date),scheduledEndDate:this.currentTransaction.frequency===this.billPayConstants.FREQUENCY.ONCE?null:moment.utc(this.currentTransaction.expiry_date),sequenceNumber:this.currentTransaction.sequenceNumber}),this.flowService.gotoNextState(),this.getFromAccount(0,this.currentTransaction.from_account);var e=this.currentTransaction.frequency===this.billPayConstants.FREQUENCY.ONCE?this.WHEN_TILES.find((function(e){return e.when===t.billPayConstants.WHEN.LATER})):this.WHEN_TILES.find((function(e){return e.when===t.billPayConstants.WHEN.ONGOING}));this.flowService.onWhenSelect(this.WHEN_TILES.indexOf(e),e),this.flowService.moveBackToWhen()}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"_close",value:function(t){var e=this;this.flowService.showConfirmExitUI?this.flowService.denyExit():(this.flowService.exitLoadingMode(),this.flowService.warn().then((function(){e.flowService.returnToStart(),e.onClose({payload:t}),e.flowService.resetSubmitErrors()})))}},{key:"_requestAccounts",value:function(){var t=this,e=this.flowService;return this.accountService.getAccounts().then((function(e){return t._processAccounts(e)})).catch((function(t){return e.showSubmitErrors(t)}))}},{key:"_processAccounts",value:function(t){var e=this;this.$log.debug("From Accounts: ",t),this.flowService.transaction.fromAccounts=t.fromAccounts.filter((function(t){return t.type===e.ACCOUNT_TYPES.CHEQUING}))}},{key:"selectCustomAmount",value:function(){return this.flowService.isCreditCardPayment?(this.isCustomAmountChecked=!0,this.paymentOption=this.CC_PAYMENT_OPTIONS.CUSTOM,this.amountValueChanged()):angular.noop()}},{key:"radioSelectionChanged",value:function(t){return this.isCustomAmountChecked=void 0===t,this.amountValueChanged(t),this.isAmountValid(t)}},{key:"onModalClose",value:function(){this._close()}},{key:"moveBackToWhen",value:function(){this.$log.debug("moving back to WHEN state"),this.flowService.moveBackToWhen()}},{key:"moveBackToAccountSelect",value:function(t){this.isEdit||(this.$log.debug("Account INDEX: :",t),(this.flowService.transaction.fromAccounts.length>1&&1===t||this.flowService.transaction.payee.ACCOUNT_DETAILS&&this.flowService.transaction.payee.ACCOUNT_DETAILS.credit_card)&&(this.flowService.moveBackTo(this.flowService.STATES.FROM),this.selectedTiles=[],this.selectedTiles.push(this.flowService.transaction.payFromAccount),this.$log.debug("moving back to FROM state")))}},{key:"isActionable",value:function(t){return!(0===t&&"TANGERINE MASTERCARD"!==this.flowService.transaction.payee.name||this.flowService.transaction.fromAccounts.length<2)}},{key:"onButtonClick",value:function(t){var e=this.$log,n=this.flowService;switch(t.type){case n.BUTTON_TYPES.BACK:if(this._shouldCloseModalOnBackButtonClick())return this.flowService.hideWarning(),void this._close();e.debug("BACK ACTION"),n.gotoPreviousState();break;case n.BUTTON_TYPES.CANCEL:if(this._shouldCloseModalOnBackButtonClick())return this.flowService.hideWarning(),void this._close();e.debug("CANCEL ACTION"),this._close();break;case n.BUTTON_TYPES.NEXT:e.debug("NEXT ACTION"),n.gotoNextState();break;case n.BUTTON_TYPES.PAY:e.debug("VALIDATE ACTION"),this._submitData(!0);break;case n.BUTTON_TYPES.CONTINUE:e.debug("SUBMIT ACTION"),this._submitData();break;case n.BUTTON_TYPES.DONE:e.debug("DONE ACTION"),this.flowService.hideWarning(),this._close({isDone:!0});break;case n.BUTTON_TYPES.CONFIRM:e.debug("SUBMIT ACTION"),this._submitData();break;default:e.debug("default - NO ACTION")}}},{key:"_shouldCloseModalOnBackButtonClick",value:function(){return this.isEdit&&(this.flowService.currentState===this.flowService.STATES.DATE_ONGOING||this.flowService.currentState===this.flowService.STATES.DATE_LATER)}},{key:"_submitTransactionUpdate",value:function(){var t=this;return this.payBillService.updateExistingTransaction(this.flowService.transaction).then(this._handleResponseWarnings.bind(this)).then(this._renewAccountsList.bind(this)).catch((function(e){t.flowService.exitLoadingMode(),t.$log.error("cannot update transaction",e),t.flowService.showSubmitErrors(e)}))}},{key:"_submitData",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.flowService,i=this.payBillService;return this.TimerService.startTimerForAction(this.TimerService.EVENTS.SUBMIT_BILL_PAY),n.BUTTONS.BTN_ORG.disable=!0,this.flowService.enterLoadingMode(),this.isEdit?this._submitTransactionUpdate():i.submitBillTransaction(n.transaction,e).then(this._handleResponseWarnings.bind(this)).then((function(n){return e?t._submitData():t._renewAccountsList(n)})).catch((function(e){return n.exitLoadingMode(),t.$log.error("Transaction was rejected:",e),e.warningMessage?n.showSubmitWarnings(e.warningMessage):n.showSubmitErrors(e)})).finally((function(){t.TimerService.endTimerForAction(t.TimerService.EVENTS.SUBMIT_BILL_PAY)}))}},{key:"_handleResponseWarnings",value:function(t){var e=this.GOOD_STATUS_CODES,n=this.$log,i=this.flowService,a=t.response_status;if(-1===e.TRANSACTION_STATUS_CODES.indexOf(a.status_code))return n.error("Transaction brought system error:",t),this.$q.reject(t);var r=this.getConfirmationErrors(t),o=(0,s.default)(r,1)[0],c=this.getConfirmationErrors(t,"warnings"),l=(0,s.default)(c,1)[0];return this.isEdit||i.transaction.CC_DETAILS||!o?l&&l.code&&!i.showContinue?(i.showContinueBtn(),this.$q.reject({warningMessage:l.code})):e.TRANSACTION_STATUSES.DUPLICATE_TRANSACTION===a.status_code?(i.showContinueBtn(),this.$q.reject({warningMessage:a.status_code})):t:this.$q.reject({errorMessage:o.code})}},{key:"_renewAccountsList",value:function(t){var e=this,n=this.$log,i=this.flowService,a=this.accountService,s=this.payBillService,r=this.ACCOUNT_TYPES;return a.getAccounts().then((function(a){n.debug("Submission accepted:",t),i.transaction.payee.vendor_id===e.CC_VALUE.ID&&i.transaction.payee.account_token&&s.getAccountDetails(i.transaction.payee.account_token).then((function(t){i.transaction.CC_DETAILS=t.account_summary})).catch((function(t){n.error("error fetching new available credit balances:",t),i.showSubmitErrors(t)}));var o=a.fromAccounts.filter((function(t){return t.type===r.CHEQUING})).filter((function(t){return t.number===i.transaction.payFromAccount.number}));e.confirmedData=i.getFormattedConfirmationData(i.transaction,t,o),i.exitLoadingMode(),i.gotoNextState()})).catch((function(t){n.error("error fetching new account balances:",t),i.showSubmitErrors(t)}))}},{key:"getConfirmationErrors",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"errors",n=t.confirmations;if(!Array.isArray(n))return[];var i=(0,s.default)(n,1),a=i[0];return a[e]&&Array.isArray(a[e])&&a[e].length?a[e]:[]}},{key:"getFromAccount",value:function(t,e){var n=this,i=this.flowService,a=this.payee;i.transaction.payFromAccount=e,i.transaction.payee=a,i.transaction.currency=e.currency_type,this.flowService.isCreditCardPayment&&this._checkLastPaymentRadio();var s={urlVars:{accountHash:this.flowService.transaction.payFromAccount.number}};i.enterLoadingMode(),this.MoveMoneyAccountsService.getAccountDetails(s).then((function(t){i.transaction.payFromAccountDetails=t.account_summary})).finally((function(){n.isEdit||i.gotoNextState(),i.exitLoadingMode()})),this.accountHelpersService.getDisplayName(this.flowService.transaction.payFromAccount).then((function(t){n.displayName=t}))}},{key:"amountValueChangedManually",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.paymentOption!==this.CC_PAYMENT_OPTIONS.CUSTOM)return!1;this.$log.debug("amount changed: ",t);var e=(0,a.default)(t);return this.amountValueChanged(e)}},{key:"amountValueChanged",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.$log,n=this.flowService;e.debug("Single Bill pay Amount Changed:",t),t>0&&(this.amountDirty=!0),n.transaction.amount=t>0?t:"",n.BUTTONS.BTN_ORG.disable=!(t>0)}},{key:"isAmountValid",value:function(t){var e=this.$log,n=this.flowService;e.debug("Single Bill pay amount is valid? ",t),this.isCustomAmountChecked||(this.submitErrors=t>0?[]:[this.$translate.instant("validation.isRequired")]),n.BUTTONS.BTN_ORG.disable=!(t>0)}},{key:"hasErrors",value:function(){return this.submitErrors.length>0}},{key:"isCCRadioDisabled",value:function(t){return!this.isSufficientFunds(t)}},{key:"isCCStmtBalRadioDisabled",value:function(t){return!this.isSufficientFunds(t)}},{key:"isCCCurBalRadioDisabled",value:function(t){return!this.isSufficientFunds(t)}},{key:"isSufficientFunds",value:function(t){if(t<=0||!this.flowService.transaction.payFromAccountDetails)return!1;var e=this.flowService.transaction.payFromAccountDetails,n=this.flowService.transaction.payFromAccount.available_balance,i=0;return e.overdraft&&e.overdraft.overdraft_limit&&(i=e.overdraft.overdraft_limit),n+i>=t}},{key:"isBusinessDay",value:function(t){if(!(t instanceof moment))return!0;var e=t.isoWeekday()<=5;return this.flowService.BUTTONS.BTN_ORG.disable=!e,e}},{key:"getFrequencyTranslationKey",value:function(t){var e=this,n=(0,i.default)(this.tngDatePickerConstants.DATE_PICKER_FREQUENCY).find((function(n){return e.tngDatePickerConstants.DATE_PICKER_FREQUENCY[n].value===t}));return this.tngDatePickerConstants.DATE_PICKER_FREQUENCY[n]?this.tngDatePickerConstants.DATE_PICKER_FREQUENCY[n].name:""}},{key:"nextPaymentDueDate",get:function(){return this.flowService.transaction.CC_DETAILS.next_payment_due_date}}]),t}();u.$inject=["$log","SingleBillPayFlowService","BillPayAccountsService","AccountHelpersService","PayBillService","accountConstants","billPayConstants","tngTileListConstants","pageFlowConstants","localeConstants","transactionConstants","tngDateSelectorConstants","DateService","$translate","tngDatePickerConstants","$q","MoveMoneyAccountsService","TimerService"],e.default=u,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=p(n(8)),a=p(n(104)),s=p(n(177)),r=p(n(0)),o=p(n(2)),c=p(n(264)),l=p(n(266)),u=p(n(265)),d=p(n(45)),h=p(n(267)),f=n(364);function p(t){return t&&t.__esModule?t:{default:t}}var g=function(t){function e(t,n,i,a,o,l,u,d,h,f,p,g,m,_,v,S,T,y,E,A,b){(0,r.default)(this,e);var C=(0,c.default)(this,(e.__proto__||(0,s.default)(e)).call(this,t,n,a,l,u,S,d,y));return C.$q=n,C.$log=t,C.$window=u,C.accountConstants=T,C.billPayConstants=h,C.accountHelpersService=g,C.$filter=i,C.$translate=o,C.BusinessDaysService=m,C.DateService=_,C.MultiLineDateTile=v,C.AMOUNT_INPUT_TYPES=f.AMOUNT_INPUT_TYPES,C.FREQ_TYPES=h.FREQUENCY,C.TIME_STATES=h.WHEN,C.PAYMENT_INDICATOR=h.PAYMENT_INDICATOR,C.MODAL_TYPES=d.MODAL_TYPES,C.RECURRING_CC_BUTTONS=h.RECURRING_CC_BUTTONS,C.CC_VALUE=h.CC_VALUE,C.TODAY_IN_EST=p.TODAY_IN_EST,C.DATE_SELECTOR_MODES=p.DATE_SELECTOR_MODES,C.FREQUENCY_MODE_CONSTANTS=p.FREQUENCY_MODE_CONSTANTS,C.accountConstants=T,C.excludedFrequency=C.FREQUENCY_MODE_CONSTANTS.DAILY,C.errorService=E,C.ERROR_EVENTS=A.AVAILABLE_EVENTS,C.serviceConstants=b,C.STATES={FROM:{titleKey:"billPay.states.fromState"},WHEN:{titleKey:"billPay.states.whenState"},WHEN_SCHEDULE:{titleKey:"billPay.states.whenStateSchedule"},DATE_LATER:{titleKey:"billPay.states.dateStateLater"},DATE_ONGOING:{titleKey:"billPay.states.dateStateOngoing"},RECURRING:{titleKey:"billPay.states.fromState"},AMOUNT:{titleKey:"billPay.states.amountState"},REVIEW:{titleKey:"billPay.states.reviewState"},DONE_NOW:{titleKey:"billPay.states.doneStateNow"},DONE_LATER:{titleKey:"billPay.states.doneStateLater"}},C.isLoading=!1,C.doneLoading=!1,C.shortTile=!1,C.schedulePay=!1,C._initialState=C.STATES.FROM,C._initialTransactionObj=null,C}return(0,u.default)(e,t),(0,o.default)(e,[{key:"returnToStart",value:function(){this._resetState()}},{key:"resetFrequencyAndDateMode",value:function(){this._resetFrequencyAndDateMode()}},{key:"showContinueBtn",value:function(){return this.showContinue=!0,this._updateUI()}},{key:"_resetFrequencyAndDateMode",value:function(){this.transaction.frequency=this.FREQUENCY_MODE_CONSTANTS.MONTHLY,this.transaction.when===this.TIME_STATES.LATER?this.transaction.datePickerSelectionMode=this.DATE_SELECTOR_MODES.SINGLE:this.transaction.datePickerSelectionMode=this.DATE_SELECTOR_MODES.INDEFINITE}},{key:"_resetState",value:function(){(0,l.default)(e.prototype.__proto__||(0,s.default)(e.prototype),"_resetState",this).call(this),this.schedulePay=!1,this.showContinue=!1,this.submitWarnings=null,this.submitErrors=null,this.transaction={fromAccounts:[],isRecurring:!1,payFromAccount:{},payee:{},amount:"",currency:"",frequency:this.FREQUENCY_MODE_CONSTANTS.MONTHLY,scheduledStartDate:null,scheduledEndDate:null,datePickerSelectionMode:this.DATE_SELECTOR_MODES.INDEFINITE},this._initialTransactionObj=angular.copy(this.transaction),this.whenStateAccountTileListData=[],this.accountFromTileData=[],this.whenStateDateTileListData=[],this.reviewData={},this.shortTile=!1,this.BUTTONS={BTN_GRY:new f.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new f.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!1,!0)}}},{key:"_getReviewDate",value:function(){if(this.transaction.when&&this.transaction.scheduledStartDate&&this.transaction.when===this.TIME_STATES.LATER)return this.DateService.formatMomentToDateIgnoreTimezone(this.transaction.scheduledStartDate);return""}},{key:"_setReviewAccountName",value:function(t,e){var n=this;e&&this.accountHelpersService.getDisplayName(e).then((function(e){n.reviewData[t]=e}))}},{key:"isValidAmount",value:function(t){return!(t&&t>=.01)}},{key:"showSubmitWarnings",value:function(t){var e="";t&&(e=t,this.showWarning()),this.$log.error("formatted Warning:",e),this.submitWarnings=e}},{key:"showSubmitErrors",value:function(t){var e=this,n="";this.errorService.processError(t,this.ERROR_EVENTS.REQUEST_ERROR).then((function(i){e.$log.log("data",i),i.code===e.serviceConstants.STATUS_CODES.RANGE?t.response_status&&t.response_status.details&&t.response_status.details.forEach((function(t,i){i>0&&(n+=n+"<br>"),t.details_code&&(n=0===t.details_code.indexOf("RANGE")?e.transaction.amount<e.billPayConstants.PAYMENT_LIMITS.MIN?e.$translate.instant("accountDetails.loan.transactionsTab.changePaymentModal.validation.minAmountError",{minimumPaymentAmount:e.billPayConstants.PAYMENT_LIMITS.MIN}):e.$translate.instant("accountDetails.loan.transactionsTab.changePaymentModal.validation.maxAmountError",{accountBalance:e.billPayConstants.PAYMENT_LIMITS.MAX}):e.$translate.instant("global.errorCodes."+t.details_code))})):n="generic"===i.code?t.errorMessage===e.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_DAILY?e.$translate.instant("global.errorCodes.BP_LIMIT_VIOLATION_DAILY"):t.errorMessage===e.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_SINGLE_PAYMENT?e.$translate.instant("global.errorCodes.BP_LIMIT_VIOLATION_SINGLE_PAYMENT"):t.errorMessage===e.billPayConstants.ERROR_CODES.AVLBAL?e.$translate.instant("global.errorCodes.AVLBAL"):i.message:i.code===e.billPayConstants.ERROR_CODES.DUPTRAN?e.$translate.instant("global.errorCodes.DUPTRAN"):e.$translate.instant("global.errorCodes."+i.code),e.$log.error("formatted error:",n),e.submitErrors=n}))}},{key:"resetSubmitErrors",value:function(){this.submitErrors=""}},{key:"moveBackTo",value:function(t){(0,l.default)(e.prototype.__proto__||(0,s.default)(e.prototype),"moveBackTo",this).call(this,t),this.resetSubmitErrors()}},{key:"moveBackToWhen",value:function(){this.transaction.when===this.TIME_STATES.NOW?this.moveTo(this.STATES.WHEN):this.transaction.when===this.TIME_STATES.LATER?this.moveTo(this.STATES.DATE_LATER):this.transaction.when===this.TIME_STATES.ONGOING&&this.moveTo(this.STATES.DATE_ONGOING),this.resetSubmitErrors()}},{key:"amountChanged",value:function(t,e){this.transaction.amount=t,this.BUTTONS.BTN_ORG.disable=!this.isValidAmount(t),e&&(this.$log.debug("received",e,"as currency type"),this.transaction.currency=e)}},{key:"_updateUI",value:function(){var t=this,e=this.currentState,n=this.BUTTON_TYPES,i=this.BUTTONS,s=this.STATES;switch(i.BTN_GRY.show=!0,i.BTN_GRY.disable=!1,i.BTN_ORG.show=!0,i.BTN_ORG.disable=!1,e){case s.FROM:angular.equals(this._initialTransactionObj,this.transaction)?this.hideWarning():this.showWarning(),i.BTN_GRY.type=n.CANCEL,i.BTN_ORG.show=!1;break;case s.WHEN:case s.WHEN_SCHEDULE:i.BTN_GRY.type=n.BACK,i.BTN_ORG.show=!1;break;case s.AMOUNT:this.transaction.datePickerSelectionMode===this.DATE_SELECTOR_MODES.INDEFINITE&&(this.transaction.scheduledEndDate=(0,d.default)().add(1,"years")),this._getWhenStateData().then((function(e){var n=(0,a.default)(e,2);t.whenStateAccountTileListData=n[0],t.whenStateDateTileListData=n[1],t.whenStateAccountTileListDataTo=[t.whenStateAccountTileListData[0]],t.whenStateAccountTileListDataFrom=[t.whenStateAccountTileListData[1]],t.accountFromTileData=t.whenStateAccountTileListData})),i.BTN_GRY.type=n.BACK,i.BTN_ORG.type=n.NEXT,i.BTN_ORG.disable=this.isValidAmount(this.transaction.amount);break;case s.DATE_ONGOING:this.transaction.frequency=this.transaction.frequency||this.FREQUENCY_MODE_CONSTANTS.MONTHLY,i.BTN_GRY.type=this.editPay?n.CANCEL:n.BACK,i.BTN_ORG.type=n.NEXT;break;case s.DATE_LATER:i.BTN_GRY.type=this.editPay?n.CANCEL:n.BACK,i.BTN_ORG.type=n.NEXT;break;case s.REVIEW:i.BTN_GRY.show=!1,i.BTN_ORG.type=this.showContinue?n.CONFIRM:n.PAY,this.reviewData=this.getReviewData();break;case s.DONE_NOW:case s.DONE_LATER:i.BTN_GRY.show=!1,i.BTN_ORG.show=!0,i.BTN_ORG.type=n.DONE,this.hideWarning();break;default:this.$log.warn("Unrecognized state passed")}}},{key:"gotoNextState",value:function(){var t=this.currentState,e=this.TIME_STATES,n=this.transaction,i=this.STATES;switch(n.when||(n.frequency===this.FREQ_TYPES.WEEKLY||n.frequency===this.FREQ_TYPES.BIWEEKLY||n.frequency===this.FREQ_TYPES.MONTHLY?n.when=e.ONGOING:n.when=e.LATER),t){case i.FROM:if(this.schedulePay){this.moveTo(i.WHEN_SCHEDULE);break}this.moveTo(i.WHEN);break;case i.WHEN:case i.WHEN_SCHEDULE:n.when===e.LATER?(this.resetFrequencyAndDateMode(),this.moveTo(i.DATE_LATER)):(this.resetFrequencyAndDateMode(),this.moveTo(i.DATE_ONGOING));break;case i.DATE_LATER:case i.DATE_ONGOING:this.moveTo(i.AMOUNT);break;case i.AMOUNT:this.moveTo(i.REVIEW);break;case i.REVIEW:this.hideWarning(),this.moveTo(n.when===e.NOW?i.DONE_NOW:i.DONE_LATER);break;default:this.$log.debug("Unknown or unrecognized state")}}},{key:"showLoadingSpinner",value:function(){this.isLoading=!0,this.doneLoading=!1}},{key:"showLoadingDoneIcon",value:function(){this.isLoading=!1,this.doneLoading=!0}},{key:"enterLoadingMode",value:function(){this.showLoadingSpinner()}},{key:"exitLoadingMode",value:function(){this.isLoading=!1,this.doneLoading=!1}},{key:"getReviewData",value:function(){var t={date:"",fromName:"",toName:"",amountTileData:[{amount1:this.transaction.amount,currency1:"",amount2:null,currency2:""}],totalNumTrans:0,recurringTotalAmount:0,ccRecurringi18nDescString:"",ccRecurringPaymentDay:""};if(this._setReviewAccountName("fromName",this.transaction.payFromAccount),this._setReviewAccountName("toName",this.transaction.payee),this.transaction.when===this.TIME_STATES.LATER)t.date=this._getReviewDate();else if(this.transaction.when===this.TIME_STATES.ONGOING){var e=this.DateService.momentToServerFormat(this.transaction.scheduledStartDate);t.startDate=e,t.endDate=this.DateService.momentToServerFormat(this.transaction.scheduledEndDate),this.isCCOngoingMonthly&&(t.ccRecurringPaymentDay=this.transaction.scheduledStartDate.format("D"),t.payment_indicator="",this.transaction.payment_indicator===this.PAYMENT_INDICATOR.MINIMUM_PAYMENT?(t.ccRecurringi18nDescString="billPay.singleBPCC.descCCPayMinimum",t.amountTileData=[this.RECURRING_CC_BUTTONS.MINIMUM],t.payment_indicator="M"):this.transaction.payment_indicator===this.PAYMENT_INDICATOR.FULL_BALANCE&&(t.ccRecurringi18nDescString="billPay.singleBPCC.descCCPayFull",t.amountTileData=[this.RECURRING_CC_BUTTONS.FULL],t.payment_indicator="F"),t.amountTileData[0].isCCOngoing=this.isCCOngoingMonthly)}return this.$log.debug("reviewData:",t),t}},{key:"getFormattedConfirmationData",value:function(t,e,n){var a=t,s=t.CC_DETAILS||t.sequenceNumber||this.editPay?e.confirmation:e.confirmations[0],r=n[0],o=t.CC_DETAILS,c={warnings:Array.isArray(e.confirmations)?e.confirmations[0].warnings:null,payFromAccount:r,accountBalance:r.account_balance,payee:a.payee.name,payeeNickname:a.payee.nickname,nickname:r.nickname,payeeId:t.payee.id,confirmationNumber:s.confirmation_code,scheduledStartDate:this.DateService.momentToServerFormat(t.scheduledStartDate),scheduledEndDate:t.scheduledEndDate?this.DateService.momentToServerFormat(t.scheduledEndDate):null,frequency:a.frequency,amount:a.amount,when:a.when,whenNormalized:this.$filter("normalizeType")(a.when),isCC:void 0!==o,isIndefinite:t.datePickerSelectionMode===this.DATE_SELECTOR_MODES.INDEFINITE};return o&&(0,i.default)(c,{date:this.DateService.formatMomentToDateWithTimezone(t.scheduledStartDate),time:t.scheduledStartDate.format("hh:mm A"),availableCredit:o.available_credit,ccAccountNum:o.card_number_display_name}),this.isCCOngoingMonthly&&(c.payment_indicator="",t.payment_indicator===this.PAYMENT_INDICATOR.MINIMUM_PAYMENT?c.payment_indicator="M":t.payment_indicator===this.PAYMENT_INDICATOR.FULL_BALANCE&&(c.payment_indicator="F")),c}},{key:"onWhenSelect",value:function(t,e){var n=this.transaction,i=this.TIME_STATES,a=this.FREQUENCY_MODE_CONSTANTS,s=this.STATES;switch(this.shortTile=!0,e.when){case i.NOW:n.scheduledStartDate=(0,d.default)(),n.isRecurring=!1,n.when=i.NOW,this.moveTo(s.AMOUNT);break;case i.LATER:n.scheduledStartDate||(n.scheduledStartDate=this.BusinessDaysService.nextBusinessDay((0,d.default)())),n.minDate=this.BusinessDaysService.nextBusinessDay((0,d.default)()),n.maxDate=(0,d.default)().add(1,"y"),n.datePickerSelectionMode=this.DATE_SELECTOR_MODES.SINGLE,n.isRecurring=!1,n.when=i.LATER,this.gotoNextState();break;case i.ONGOING:n.isRecurring=!0,n.scheduledStartDate||(n.scheduledStartDate=this.BusinessDaysService.nextBusinessDay((0,d.default)())),n.scheduledEndDate||(n.scheduledEndDate=(0,d.default)().add(1,"month")),n.minDate=this.BusinessDaysService.nextBusinessDay((0,d.default)()),n.when=i.ONGOING,n.datePickerSelectionMode=n.datePickerSelectionMode||this.DATE_SELECTOR_MODES.RANGE,this.isCreditCardPayment?(n.datePickerSelectionMode=this.DATE_SELECTOR_MODES.INDEFINITE,n.frequency=a.MONTHLY,this.transaction.CC_DETAILS.next_payment_due_date&&(n.scheduledStartDate=(0,d.default)(this.transaction.CC_DETAILS.next_payment_due_date),n.scheduledEndDate=(0,d.default)(this.transaction.CC_DETAILS.next_payment_due_date).add(1,"years")),this.moveTo(this.STATES.AMOUNT)):this.gotoNextState();break;default:this.$log.warn('Unknown "WHEN STATE"!')}}},{key:"selectionModeChange",value:function(){this.$log.log(this.transaction)}},{key:"_getWhenStateData",value:function(){var t=this.$q,e=this.$log,n=this.$translate,a=this.transaction,s=this.TIME_STATES,r=t.defer(),o=[(0,i.default)({},a.payee),(0,i.default)({},a.payFromAccount)];o[0].tileDescription="billPay.payTo",o[1].tileDescription="billPay.accountTile.payFrom",this.transaction.payee&&this.transaction.payee.ACCOUNT_DETAILS&&this.transaction.payee.ACCOUNT_DETAILS.credit_card&&o.shift();var c=[];if(a.when===s.NOW)c.push(this.transaction.when),r.resolve([o,c]);else if(a.when===s.LATER)c.push(a.scheduledStartDate),r.resolve([o,c]);else if(a.when===s.ONGOING){var l=new this.MultiLineDateTile;if(this.isCCOngoingMonthly)l.middle=this.DateService.momentToServerFormat(a.scheduledStartDate);else{var u="global.transactionFrequencies."+a.frequency;e.debug("frequency translation key:",u);var d=n.instant(u),h=n.instant("billPay.dateTile.ongoing.top",{frequency:d}),f=n.instant("billPay.dateTile.ongoing.middle",{startDate:this.DateService.momentToServerFormat(a.scheduledStartDate)}),p=n.instant("billPay.dateTile.ongoing.bottom",{endDate:this.DateService.momentToServerFormat(a.scheduledEndDate)});l.top=h,l.middle=f,this.transaction.datePickerSelectionMode===this.DATE_SELECTOR_MODES.INDEFINITE?l.bottom=this.$translate.instant("global.datePicker.continueIndefinitely"):l.bottom=p}c.push(l.toAccountTileObject()),r.resolve([o,c])}return r.promise}},{key:"handleRecurringCCTileClick",value:function(t){t<1?(this.transaction.payment_indicator=this.PAYMENT_INDICATOR.MINIMUM_PAYMENT,this.amountChanged(this.transaction.CC_DETAILS.minimum_payment)):(this.transaction.payment_indicator=this.PAYMENT_INDICATOR.FULL_BALANCE,this.amountChanged(this.transaction.CC_DETAILS.current_balance)),this.gotoNextState()}},{key:"getMaskedAccountNumber",value:function(){return this.accountHelpersService.getMaskedAccountNumber(this.transaction.payFromAccount.display_name)}},{key:"_getAnalyticsID",value:function(){return"billpay/single"}},{key:"isCreditCardPayee",get:function(){return!!this.transaction.payee&&this.transaction.payee.vendor_id===this.CC_VALUE.ID}},{key:"isCreditCardPayment",get:function(){return this.isCreditCardPayee&&Object.prototype.hasOwnProperty.call(this.transaction.payee,"account_token")}},{key:"isCreditCardPaymentBySec",get:function(){return this.isCreditCardPayee&&!Object.prototype.hasOwnProperty.call(this.transaction.payee,"account_token")}},{key:"isCCOngoingMonthly",get:function(){return this.isCreditCardPayment&&this.transaction.isRecurring&&this.transaction.frequency===this.FREQUENCY_MODE_CONSTANTS.MONTHLY}},{key:"inLoadingMode",get:function(){return this.isLoading||this.doneLoading}}]),e}(h.default);g.$inject=["$log","$q","$filter","$transitions","$translate","$state","$window","pageFlowConstants","billPayConstants","amountInputConstants","tngDateSelectorConstants","AccountHelpersService","BusinessDaysService","DateService","MultiLineDateTile","$rootScope","accountConstants","AnalyticsService","ErrorService","errorConstants","serviceConstants"],e.default=g,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2259)),a=s(n(2260));function s(t){return t&&t.__esModule?t:{default:t}}n(2261);var r={template:i.default,controller:a.default,bindings:{data:"<",payee:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div id="printMe" class="c-confirmed-state"> <p ng-if="!$ctrl.data.isCC" class="confirmed--title-medium"> <span id="singleBP-billPaymentProcessedLater-sub-header" ng-if="$ctrl.data.when !== $ctrl.flowService.TIME_STATES.NOW" translate> {{ ::\'billPay.singleBP.billPaymentProcessedLater\' }} </span> <span ng-if="$ctrl.data.when === $ctrl.flowService.TIME_STATES.NOW" translate> {{ ::\'billPay.singleBP.billPaymentProcessedNow\' }} </span> <strong>{{ ::$ctrl.data.date | date:\'longDate\' }}</strong> </p> <div class="confirm__table margin__t--fix2 no-bottom-margin" ng-if="$ctrl.data.isCC"> <p class="margin__b--fix2 header-bottom-margin" ng-bind-html="(\'billPay.singleBPCC.confirmationHeader\' + $ctrl.data.whenNormalized) | translate"> </p> <div class="confirm__table"> <div class="confirm__table__row" ng-if="!!$ctrl.data.confirmationNumber"> <div class="print-sub-header">{{ ::\'billPay.singleBP.confirmationNumber\' | translate }}  {{ ::$ctrl.data.confirmationNumber }}</div> <div class="confirm__table__header cell__code"> <span class="confirmed--title">{{ ::\'billPay.singleBP.confirmationNumber\' | translate }} <span class="body--callout2">{{ ::$ctrl.data.confirmationNumber }}</span></span> </div> </div> <div class="confirm__table__row"> <div class="confirm__table__cell cell__amount"> <strong class="confirmed--title">{{ ::\'billPay.singleBPCC.paymentAmount\' | translate }}</strong> <br> <div class="amount--orange"> {{ ::$ctrl.data.amount | currency }} {{ $ctrl.data.currency }} </div> <div ng-if="$ctrl.flowService.isCreditCardPayment"> <div ng-if="$ctrl.flowService.transaction.payment_indicator === $ctrl.flowService.PAYMENT_INDICATOR.MINIMUM_PAYMENT"> {{::\'billPay.singleBPCC.minimumPayment\' | translate}} </div> <div ng-if="$ctrl.flowService.transaction.payment_indicator === $ctrl.flowService.PAYMENT_INDICATOR.FULL_BALANCE"> {{::\'billPay.singleBPCC.currentBalance\' | translate}} </div> </div> <div ng-if="$ctrl.data.isCrossCurrency" class="amount--grey"> {{ ::$ctrl.data.amountConverted | currency }} {{ $ctrl.data.currencyConverted }} </div> </div> <div class="confirm__table__cell cell__new-balance-from"> <span class="confirmed--title"> <span ng-if="$ctrl.data.when === $ctrl.flowService.TIME_STATES.NOW"> {{ ::\'billPay.newBalance\' | translate }} </span> <span ng-if="$ctrl.data.when !== $ctrl.flowService.TIME_STATES.NOW"> {{ ::\'billPay.currentBalance\' | translate }} </span> <strong> <tng-account-name account="$ctrl.data.payFromAccount"></tng-account-name> {{ ::$ctrl.data.payFromAccount.display_name | maskNumber }} </strong> </span> <br> <span class="amount--orange">{{::$ctrl.data.accountBalance | currency}}</span> </div> <div class="confirm__table__cell cell__new-balance-to"> <span class="confirmed--title"> <span translate>{{ \'billPay.singleBPCC.payee\' }}</span> <strong> {{ ::$ctrl.data.payee}} {{ ::$ctrl.data.ccAccountNum | maskNumber }} </strong> </span> <br> <span class="amount--orange">{{ ::$ctrl.data.payeeNickname }}</span> </div> </div> </div> <p ng-if="$ctrl.data.when === $ctrl.flowService.TIME_STATES.NOW" class="c-confirmed-state__disclaimer">{{ ::\'billPay.singleBPCC.availableCreditNow\' | translate }}</p> <p ng-if="$ctrl.data.when === $ctrl.flowService.TIME_STATES.ONGOING" class="c-confirmed-state__disclaimer"> <span ng-if="$ctrl.data.payment_indicator === \'M\'">{{ ::\'billPay.singleBPCC.availableCreditMinOngoing\' | translate }}</span> <span ng-if="$ctrl.data.payment_indicator === \'F\'">{{ ::\'billPay.singleBPCC.availableCreditFullOngoing\' | translate }}</span> </p> </div> <div ng-if="!$ctrl.data.isCC" class="confirm__table margin__t--fix2"> <div class="confirm__table__row"> <div class="confirm__table__header cell__code"> <div class="confirmed--title"> <span ng-if="$ctrl.data.when === $ctrl.flowService.TIME_STATES.NOW"> {{ ::\'billPay.newBalance\' | translate }} </span> <span ng-if="$ctrl.data.when !== $ctrl.flowService.TIME_STATES.NOW"> {{ ::\'billPay.currentBalance\' | translate }} </span> <strong> <tng-account-name account="$ctrl.data.payFromAccount"></tng-account-name> {{ ::$ctrl.data.payFromAccount.display_name | maskNumber }} </strong> </div> <div class="amount--orange">{{ ::$ctrl.data.accountBalance | currency }}</div> </div> </div> </div> <div ng-if="!$ctrl.data.isCC" class="confirm__table"> <div class="confirm__table__row"> <div class="confirm__table__header__payee"> <strong>{{ ::$ctrl.data.payee }}</strong> <span>{{ ::$ctrl.data.payeeNickname }}</span><br/> <span class="confirmed--title-medium">{{$ctrl.data.payeeAccountNumber}}</span> </div> </div> <div class="confirm__table__row"> <div class="confirm__table__header cell__code"> <div class="confirmed--title" id="single-bill-confirm-info"> <span ng-if="!!$ctrl.data.confirmationNumber"> {{ ::\'billPay.singleBP.confirmationNumber\' | translate }} <span class="body--callout2">{{ ::$ctrl.data.confirmationNumber }}</span> </span> <span class="confirm__table__header__frequency" id="confirm__table__header__frequency"> <strong ng-if="$ctrl.data.when === $ctrl.flowService.TIME_STATES.NOW">{{ ::\'global.commonWords.now\' | translate }}</strong> <strong ng-if="$ctrl.data.when === $ctrl.flowService.TIME_STATES.LATER">{{ ::\'global.commonWords.later\' | translate }}</strong> <strong ng-if="$ctrl.data.when === $ctrl.flowService.TIME_STATES.ONGOING" translate>{{ ::$ctrl.getFrequencyTranslationKey($ctrl.data.frequency) | translate }}</strong> <span ng-if="$ctrl.data.when === $ctrl.flowService.TIME_STATES.ONGOING"> {{ ::\'billPay.from\' | translate }} </span> <span id="confirm__table__header__scheduledStartDate">{{ ::$ctrl.data.scheduledStartDate | date:\'longDate\' }}</span> <span id="confirm__table__header__scheduledEndDate" ng-if="$ctrl.data.when === $ctrl.flowService.TIME_STATES.ONGOING && !$ctrl.data.isIndefinite"> {{ ::\'billPay.to\' | translate }} {{ ::$ctrl.data.scheduledEndDate | date:\'longDate\' }}</span> </span> </div> </div> </div> <div class="confirm__table__row"> <div class="c-balance-grid"> <div class="c-balance-grid__table"> <div class="c-balance-grid__table-column--sbill c-balance-grid__table-column--has-borders"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title">{{ ::\'billPay.addBill.accountNumber\' | translate }}</p> <p class="c-balance-grid__value large-font-size"> {{ ::$ctrl.payee.account_number }} </p> </div> </div> <div class="c-balance-grid__table-column--sbill c-balance-grid__table-column--has-borders"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title">{{ ::\'billPay.amount\' | translate }}</p> <p class="c-balance-grid__value amount--orange"> {{ ::$ctrl.data.amount | currency }} </p> </div> </div> </div> </div> </div> </div> <p class="c-confirmed-state__messages"> <span> {{ ::\'billPay.singleBP.canViewBillPayments\' | translate }} <a actionable-id="single-bill-confirmed-state" ui-sref="transactionsPage" ui-sref-opts="{reload: true}"> <strong>{{::\'billPay.singleBP.transactionPage\' | translate}}</strong> </a> </span> </p> <p> <tng-print-button button-class="btn btn--orange" only-element="\'printMe\'"> {{ ::\'global.print\' | translate}} </tng-print-button> </p> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(15)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s,r){(0,a.default)(this,t),this.$window=e,this.$filter=n,this.accountHelpersService=i,this.tngDatePickerConstants=s,this.flowService=r}return(0,s.default)(t,[{key:"$onInit",value:function(){this.SINGLE_BILL_DATE_PICKER_FREQUENCY={weekly:{name:"billPay.singleBillConfirmationFrequency.WEEKLY",value:"WEEKLY"},biWeekly:{name:"billPay.singleBillConfirmationFrequency.BIWEEKLY",value:"BIWEEKLY"},monthly:{name:"billPay.singleBillConfirmationFrequency.MONTHLY",value:"MONTHLY"}}}},{key:"getCapitalizedAccountType",value:function(t){return this.$filter("normalizeType")(t)}},{key:"getMaskedAccountNumber",value:function(){return this.accountHelpersService.getMaskedAccountNumber(this.data.payFromAccount.display_name)}},{key:"getFrequencyTranslationKey",value:function(t){var e=this,n=(0,i.default)(this.SINGLE_BILL_DATE_PICKER_FREQUENCY).find((function(n){return e.SINGLE_BILL_DATE_PICKER_FREQUENCY[n].value===t}));return this.SINGLE_BILL_DATE_PICKER_FREQUENCY[n]?this.SINGLE_BILL_DATE_PICKER_FREQUENCY[n].name:""}}]),t}();o.$inject=["$window","$filter","AccountHelpersService","tngDatePickerConstants","SingleBillPayFlowService"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(198)),a=c(n(8)),s=c(n(0)),r=c(n(2)),o=c(n(1813));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,i,a){(0,s.default)(this,t),this.RequesterService=e,this.serviceConstants=n,this.$filter=i,this.$httpParamSerializer=a}return(0,r.default)(t,[{key:"getStatements",value:function(t){var e=t?{"need-statement-months":!1,"start-month":t,"end-month":t}:{};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_STATEMENTS,{urlVars:{queryString:this.$httpParamSerializer(e)}})}},{key:"getInvestmentReports",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.INVESTMENT_REPORTS)}},{key:"getOtherDocuments",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.OTHER_DOCUMENTS).then((function(t){var e=t;return e.OtherDocumentsList=e.OtherDocumentsList.map((function(t){return(0,a.default)({},t,{date_received:new Date(t.date_received)})})),e}))}},{key:"deleteOtherDocument",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.DELETE_OTHER_DOCUMENT,{urlVars:{id:t.document_id}})}},{key:"getTaxReceipts",value:function(t){var e=this,n=t?{"receipt-year":t}:{"include-dropdown-ranges":!0};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.TAX_RECEIPTS,{urlVars:{queryString:this.$httpParamSerializer(n)}}).then((function(n){var i=n;return!t&&angular.isArray(i.tax_receipts_account_type_range)&&angular.isArray(i.tax_receipts_receipt_type_range)&&(i.tax_receipts_account_type_range=e.$filter("filter")((0,o.default)(i.tax_receipts_account_type_range,(function(t){return t.code})),{code:"!ALL"}),i.tax_receipts_receipt_type_range=e.$filter("filter")((0,o.default)(i.tax_receipts_receipt_type_range,(function(t){return t.code})),{code:"!ALL"})),i}))}},{key:"updateTaxReceipt",value:function(t,e){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UPDATE_TAX_RECEIPT,{urlVars:{key:t.receipt_key},data:{receipt_year:e,tax_receipts_notes:[{receipt_key:t.receipt_key,receipt_type:t.receipt_type,receipt_note:t.receipt_note}]}})}},{key:"updateTaxReceipts",value:function(t,e){if(!t)return i.default.resolve();var n=t.map((function(t){return{receipt_key:t.receipt_key,receipt_type:t.receipt_type,receipt_note:t.receipt_note}}));return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UPDATE_TAX_RECEIPT,{data:{receipt_year:e,tax_receipts_notes:n}})}}]),t}();l.$inject=["RequesterService","serviceConstants","$filter","$httpParamSerializer"],e.default=l,t.exports=e.default},,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(){(0,i.default)(this,t)}return(0,a.default)(t,[{key:"putInsightData",value:function(t){this.insight=t}},{key:"getInsightData",value:function(){return this.insight}}]),t}();e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2267)),a=s(n(2268));function s(t){return t&&t.__esModule?t:{default:t}}n(2269);var r={template:i.default,controller:a.default,bindings:{data:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-people-like-you-chart"> <span class="c-people-like-you-chart-options"> <span class="c-people-like-you-chart-options-label"> {{ ::"peopleLikeYou.chart.optionsLabel" | translate }} </span> <ul class="c-people-like-you-chart-options-list hide-in-small-screen"> <li class="c-people-like-you-chart-options-list-items" ng-repeat="group in $ctrl.groups"> <button class="btn" ng-class="{\'is-selected\' : $index === $ctrl.selectedGroupIndex }" ng-click="$ctrl.switchGroup($index)"> {{ group.key }} </button> </li> </ul> <tng-select-autocomplete class="CB_DataMask hide-in-big-screen" input-id="people-like-you-chart-options" ng-required="true" ng-model="$ctrl.selectedGroupIndex" on-select="$ctrl.switchGroup(option.index)" options="$ctrl.groups" option-label-key="key" option-value-key="index" select-type="$ctrl.selectConstants.SELECT_TYPES.STATIC"> </tng-select-autocomplete> </span> <span class="c-people-like-you-chart__spacer1"> </span> <div class="chart-group" ng-class="{\'isInternetExplorer\': $ctrl.EnvironmentService.isIE()}"> <nvd3 ng-if="$ctrl.displayChart" options="$ctrl.options" data="$ctrl.data" api="api" on-ready="$ctrl.chartReady()"></nvd3> <svg id="you-popup" width="58px" height="51px" viewBox="0 0 58 51"> <defs> <filter x="-14.1%" y="-22.4%" width="128.3%" height="136.8%" filterUnits="objectBoundingBox" id="filter-1"> <feOffset dx="0" dy="1" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset> <feColorMatrix values="0 0 0 0 0.756862745   0 0 0 0 0.756862745   0 0 0 0 0.760784314  0 0 0 0.0753793025 0" type="matrix" in="shadowOffsetOuter1" result="shadowMatrixOuter1"></feColorMatrix> <feMerge> <feMergeNode in="shadowMatrixOuter1"></feMergeNode> <feMergeNode in="SourceGraphic"></feMergeNode> </feMerge> </filter> <filter x="-21.7%" y="-21.1%" width="143.5%" height="152.6%" filterUnits="objectBoundingBox" id="filter-2"> <feOffset dx="0" dy="2" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset> <feGaussianBlur stdDeviation="3" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur> <feColorMatrix values="0 0 0 0 0.2   0 0 0 0 0.2   0 0 0 0 0.2  0 0 0 0.61 0" type="matrix" in="shadowBlurOuter1" result="shadowMatrixOuter1"></feColorMatrix> <feMerge> <feMergeNode in="shadowMatrixOuter1"></feMergeNode> <feMergeNode in="SourceGraphic"></feMergeNode> </feMerge> </filter> </defs> <g id="Current" class="root-g" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="People-like-you--Modal---mobile" transform="translate(-182.000000, -484.000000)"> <g id="Group-6" filter="url(#filter-1)" transform="translate(188.000000, 488.000000)"> <g id="Group-8-Copy-3" filter="url(#filter-2)" transform="translate(23.000000, 19.000000) rotate(180.000000) translate(-23.000000, -19.000000) " fill="#FFFFFF"> <rect id="Rectangle-65" x="0" y="4" width="46" height="34" rx="6"></rect> <path d="M20.9374452,0.819334709 C22.0748043,-0.277067909 23.9270436,-0.269148053 25.0561871,0.819334709 L27.3347806,3.01587551 C28.4721397,4.11227813 28.1087683,5.00108807 26.5227776,5.00108807 L19.4708546,5.00108807 C17.8850386,5.00108807 17.5297082,4.10435828 18.6588517,3.01587551 L20.9374452,0.819334709 Z" id="Triangle-1"></path> </g> <text font-family="ProximaNova-Bold, Proxima Nova" font-size="14" font-weight="bold" fill="#F58426"> <tspan x="11" y="22">{{ ::"peopleLikeYou.chart.youLabel" | translate }}</tspan> </text> </g> </g> </g> </svg> </div> <div ng-if="$ctrl.displayChart" class="c-people-like-you-chart__x-label nv-axislabel">{{ $ctrl.translations.xLabel }}</div> </div> <div class="c-people-like-you-chart__description" ng-bind-html="\'peopleLikeYou.chart.description\' | translate:{selectedGroup: $ctrl.selectedGroup}"> </div> '},function(t,e,n){"use strict";(function(i){Object.defineProperty(e,"__esModule",{value:!0});var a=c(n(1814)),s=c(n(104)),r=c(n(0)),o=c(n(2));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,i,a,s){(0,r.default)(this,t),this.$window=e,this.$timeout=n,this.$translate=i,this.EnvironmentService=a,this.LocaleService=s}return(0,o.default)(t,[{key:"$onInit",value:function(){this.translations={xLabel:this.$translate.instant("peopleLikeYou.chart.xLabel"),yLabel:this.$translate.instant("peopleLikeYou.chart.yLabel"),group1:this.$translate.instant("peopleLikeYou.chart.group1"),group2:this.$translate.instant("peopleLikeYou.chart.group2"),group3:this.$translate.instant("peopleLikeYou.chart.group3"),group1desc:this.$translate.instant("peopleLikeYou.chart.group1desc"),group2desc:this.$translate.instant("peopleLikeYou.chart.group2desc"),group3desc:this.$translate.instant("peopleLikeYou.chart.group3desc")},this.parseInsightData(this.data),this.switchGroup(0);var t=this;this.resizeEventListener=function(){return t.onResize()},this.$window.addEventListener("resize",this.resizeEventListener),this.locale=this.LocaleService.locale}},{key:"$onDestroy",value:function(){this.$window.removeEventListener("resize",this.resizeEventListener)}},{key:"parseInsightData",value:function(t){function e(t){return t?t.split("|")[2]:null}function n(t){return t?parseFloat(t.split("|")[2]):null}var i={ICPARAM1:n(t.ic_param1),ICPARAM2:n(t.ic_param2),ICPARAM3:n(t.ic_param3),ICPARAM4:e(t.ic_param4),ICPARAM5:n(t.ic_param5),ICPARAM6:n(t.ic_param6),ICPARAM7:e(t.ic_param7),ICPARAM8:n(t.ic_param8),ICPARAM9:n(t.ic_param9),ICPARAM10:e(t.ic_param10)};if(this.groups=[],i.ICPARAM8&&i.ICPARAM9&&i.ICPARAM10){var a={key:this.translations.group3,groupDesc:this.translations.group3desc,mySaving:i.ICPARAM1,groupAverage:i.ICPARAM8,yourPercentileInGroup:i.ICPARAM9-1,values:this.parseChartData(i.ICPARAM1,i.ICPARAM10)};this.groups.push(a)}if(i.ICPARAM2&&i.ICPARAM3&&i.ICPARAM4){var s={key:this.translations.group1,groupDesc:this.translations.group1desc,mySaving:i.ICPARAM1,groupAverage:i.ICPARAM2,yourPercentileInGroup:i.ICPARAM3-1,values:this.parseChartData(i.ICPARAM1,i.ICPARAM4)};this.groups.push(s)}if(i.ICPARAM5&&i.ICPARAM6&&i.ICPARAM7){var r={key:this.translations.group2,groupDesc:this.translations.group2desc,mySaving:i.ICPARAM1,groupAverage:i.ICPARAM5,yourPercentileInGroup:i.ICPARAM6-1,values:this.parseChartData(i.ICPARAM1,i.ICPARAM7)};this.groups.push(r)}for(var o=0;o<this.groups.length;o++)this.groups[o].index=o}},{key:"parseChartData",value:function(t,e){t=Math.round(t);for(var n=e.split("^").filter((function(t){return""!==t})),i=[],r=0;r<n.length;r++){var o=n[r].split("~"),c=(0,s.default)(o,2),l=c[0],u=c[1],d=l.split("-"),h=(0,s.default)(d,2),f=h[0],p=h[1];i.push({start:f,end:p,percentage:parseFloat(u)/100})}i.sort((function(t,e){return t.start-e.start})),i[0].end=i[0].start,i[0].start=void 0;for(var g=0;g<i.length;g++){var m=i[g];(f=m.start)||(f=0),(p=m.end)||(p=a.default),m.isMyRange=t<=p&&t>=f}return i}},{key:"switchGroup",value:function(t){var e=this;this.displayChart=!1,this.$timeout((function(){e.selectGroup(t),e.displayChart=!0}),100)}},{key:"selectGroup",value:function(t){var e=this,n=this.groups[t];this.selectedGroupIndex=t,this.selectedGroup=n,this.chartChanged=!0,this.data=[n];for(var i=0,a=0;a<n.values.length;a++)n.values[a].percentage>i&&(i=n.values[a].percentage);var s=.2*(Math.ceil(i/.2)+1);s=s>1.2?1.2:s,this.options={chart:{type:"discreteBarChart",height:320,x:function(t){return t.start?t.end?"en_CA"===e.locale?"$"+t.start+" - "+t.end:t.start+" - "+t.end+" $":"en_CA"===e.locale?">$"+t.start:"> "+t.start+" $":"en_CA"===e.locale?"<$"+t.end:"< "+t.end+" $"},y:function(t){return t.percentage},color:function(t){return t.isMyRange?"#f58426":"#888888"},showValues:!1,valueFormat:function(t){return d3.format(",.4f")(t)},yAxis:{tickValues:[0,.2,.4,.6,.8,1],axisLabel:this.translations.yLabel,axisLabelDistance:-3,tickFormat:function(t){return"en_CA"===e.locale?100*t+"%":100*t+" %"}},yDomain:[0,s],tooltip:{valueFormatter:function(t){return(100*t).toFixed(1)+("en_CA"===e.locale?"%":" %")},enabled:!1}}};var r=0;for(r=0;r<this.selectedGroup.values.length&&!this.selectedGroup.values[r].isMyRange;r++);this.selectedGroup.myBarIndex=r,this.selectedGroup.numberOfBars=this.selectedGroup.values.length,this.selectedGroup.yDomainMax=s}},{key:"chartReady",value:function(){var t=this;if(!this.EnvironmentService.isIE()){var e=i("svg g.nv-y")[0],n='<rect id="back-rect" class="background-rect" height="255" width="700" style="fill:rgb(240,240,240);" transform="translate(10, 0)"></rect>'+e.innerHTML;e.innerHTML=n}this.chartChanged&&(this.chartChanged=!1,this.EnvironmentService.isIE()?this.onResize():this.$timeout((function(){t.$window.dispatchEvent(new Event("resize"))}),100))}},{key:"onResize",value:function(){var t=this;this.$timeout((function(){t._onResize()}),1e3)}},{key:"_onResize",value:function(){var t=this.selectedGroup.myBarIndex,e=this.selectedGroup.values.length,n="calc(40px + (100% - 80px) / "+e+" * "+t+" + (100% - 80px) / "+2*e+")",a="calc(50px + "+255*this.selectedGroup.values[t].percentage/this.selectedGroup.yDomainMax+"px)";if(i("#you-popup").attr("style","position: absolute; left: "+n+"; bottom: "+a+";"),!this.EnvironmentService.isIE()){var s=i("g.nv-zeroLine line").attr("x2");i("#back-rect").attr("width",s-10);var r=i("rect.discreteBar");r.attr("width",Math.floor(s/(2*e+2))),r.attr("style","transform: translate("+.5/(2*e+1)*s+"px, 0);")}}}]),t}();l.$inject=["$window","$timeout","$translate","EnvironmentService","LocaleService"],e.default=l,t.exports=e.default}).call(this,n(93))},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2271)),a=s(n(2272));function s(t){return t&&t.__esModule?t:{default:t}}n(2273);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose()" class="c-people-like-you" scrolltopon="true" hide-close="false"> <header> <span>{{ ::\'peopleLikeYou.modalTitle\' | translate }}</span> </header> <div> <p class="c-people-like-you__subheader"> {{ ::\'peopleLikeYou.modalSubtitle\' | translate }} </p> <tng-people-like-you-chart data="$ctrl.insight"></tng-people-like-you-chart> <p class="c-people-like-you__extra-description">{{ ::\'peopleLikeYou.extraDescription\' | translate }}</p> <div class="c-people-like-you__recommendations"> <p class="c-people-like-you__recommendations__header">{{ ::\'peopleLikeYou.recommendations.header\' | translate }}</p> <a ng-repeat="r in $ctrl.recommendations" ng-click="$ctrl.recommendationTileClick(r)"> <div class="c-tile"> <div class="panel pane c-tile__content"> <div ng-if="$ctrl.recommendations.length > 1" class="recommendations-tile-number"> {{ $index + 1 }} </div> <div class="text-content" ng-class="{\'is-numbered\': $ctrl.recommendations.length > 1}"> <h3>{{ ::r.title | translate }}</h3> <div> {{ ::r.content | translate }} </div> </div> <span class="c-tile__arrow icon-rightarrow large"></span> </div> </div> </a> </div> <p class="c-people-like-you__note"> {{ :: \'peopleLikeYou.note\' | translate }} </p> </div> <div ng-if="$ctrl.inLoadingMode" class="c-people-like-you__loading-container"> <tng-loading-spinner>{{ :: \'global.pageFlow.loading.isLoading\' | translate }}</tng-loading-spinner> </div> <footer> <button class="btn btn--orange" actionable-id="peopleLikeYou_btn_close" ng-click="$ctrl.onClose()"> <span> {{ ::\'global.components.buttons.close\' | translate }} </span> </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s){(0,i.default)(this,t),this.$stateParams=e,this.PeopleLikeYouService=n,this.$timeout=a,this.$location=s}return(0,a.default)(t,[{key:"$onInit",value:function(){this.$stateParams.insight&&this.PeopleLikeYouService.putInsightData(this.$stateParams.insight),this.insight=this.PeopleLikeYouService.getInsightData(),this.recommendations=[{href:"/create-goal",title:"peopleLikeYou.recommendations.title1",content:"peopleLikeYou.recommendations.content1"},{href:"/start-asp",title:"peopleLikeYou.recommendations.title4",content:"peopleLikeYou.recommendations.content4"},{href:"/left-to-spend",title:"peopleLikeYou.recommendations.title2",content:"peopleLikeYou.recommendations.content2"}]}},{key:"recommendationTileClick",value:function(t){this.onClose(),this.$location.path(t.href)}}]),t}();r.$inject=["$stateParams","PeopleLikeYouService","$timeout","$location"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2275)),a=s(n(2276));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("tangerine.insights.modules.reachGoalSooner",[]).service("ReachGoalSoonerService",i.default).component("tngReachGoalSooner",a.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(){(0,i.default)(this,t)}return(0,a.default)(t,[{key:"putInsightData",value:function(t){this.insight=t}},{key:"getInsightData",value:function(){return this.insight}}]),t}();e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(2277)),a=s(n(2278));function s(t){return t&&t.__esModule?t:{default:t}}n(2279);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose()" class="c-reach-goal-sooner" scrolltopon="true" hide-close="false"> <header> <span>{{ ::\'reachGoalSooner.modalTitle\' | translate }}</span> </header> <div c-reach-goal-sooner__main-content> <tng-goal-progress-section ng-if="$ctrl.goalData" goal-data="$ctrl.goalData"> </tng-goal-progress-section> <div class="c-reach-goal-sooner__congrats" ng-bind-html="\'reachGoalSooner.congrats\' | translate:{insight: $ctrl.insight, frequency: $ctrl.translations.frequency}"> </div> <h2 class="c-reach-goal-sooner__table-header">{{ ::\'reachGoalSooner.currentSavingHeader\' | translate }}</h2> <table id="goalsHalfwayCurrentSavingsData" class="c-reach-goal-sooner__saving-info-tiles"> <tr> <td valign="top"> <div class="c-reach-goal-sooner__tile-title">{{ \'reachGoalSooner.amountSaved\' | translate: {frequency: $ctrl.translations.frequency} }}</div> </td> <td valign="top"> <div class="c-reach-goal-sooner__tile-title">{{ ::\'reachGoalSooner.expectedDate\' | translate }}</div> </td> </tr> <tr> <td valign="top"> <div id="goalsHalfwayCurrentSavingsAmount" class="c-reach-goal-sooner__tile-content">{{ $ctrl.insight.Current_Recurring_Amt | currency }}</div> </td> <td valign="top"> <div id="goalsHalfwayCurrentSavingsExpectedDate" class="c-reach-goal-sooner__tile-content">{{ $ctrl.goalData.targetDate.format() | date: \'longDate\' }}</div> </td> </tr> </table> <h2 class="c-reach-goal-sooner__table-header">{{ ::\'reachGoalSooner.reachGoalSoonerHeader\' | translate }}</h2> <table id="goalsHalfwayReachGoalSoonerData" class="c-reach-goal-sooner__saving-info-tiles"> <tr> <td valign="top"> <div class="c-reach-goal-sooner__tile-title">{{ \'reachGoalSooner.amountIncreased\' | translate: {frequency: $ctrl.translations.frequency} }}</div> </td> <td valign="top"> <div class="c-reach-goal-sooner__tile-title">{{ ::\'reachGoalSooner.newExpectedDate\' | translate }}</div> </td> </tr> <tr> <td valign="top"> <div id="goalsHalfwayReachGoalSoonerAmount" class="c-reach-goal-sooner__tile-content">{{ $ctrl.insight.New_Recurring_Amt | currency }}</div> </td> <td valign="top"> <div id="goalsHalfwayReachGoalSoonerExpectedDate" class="c-reach-goal-sooner__tile-content">{{ $ctrl.goalData.newTargetDate.format() | date: \'longDate\' }}</div> </td> </tr> </table> </div> <div ng-if="$ctrl.inLoadingMode" class="c-reach-goal-sooner__loading-container"> <tng-loading-spinner>{{ :: \'global.pageFlow.loading.isLoading\' | translate }}</tng-loading-spinner> </div> <footer> <button class="btn btn--orange" actionable-id="reachGoalSooner_btn_edit" ng-click="$ctrl.gotoEditGoal()"> <span> {{ ::\'reachGoalSooner.editGoal\' | translate }} </span> </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(104)),a=o(n(0)),s=o(n(2)),r=o(n(45));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,s,r,o,c,l,u,d){(0,a.default)(this,t),this.$log=e,this.$q=n,this.$translate=i,this.$stateParams=s,this.ReachGoalSoonerService=r,this.GoalsService=o,this.GoalSummaryService=c,this.STATES_FLOW=l.STATES_FLOW,this.STATES_ALL=l.STATES_ALL,this.AccountDetailsService=u,this.GlobalModalsService=d}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;if(this.$stateParams.insight){var e=this.$stateParams.insight;e.New_Recurring_Added_Amt=parseFloat(e.New_Recurring_Added_Amt.replace(/,/g,"")),e.Current_Recurring_Amt=parseFloat(e.Current_Recurring_Amt.replace(/,/g,"")),e.New_Recurring_Amt=parseFloat(e.New_Recurring_Amt.replace(/,/g,""));var n=e.New_Completion_Date.split("-"),a=(0,i.default)(n,3),s=a[0],o=a[1],c=a[2];s=""+s,o=("0"+o).slice(-2),c=("0"+c).slice(-2),e.New_Completion_Date=s+"-"+o+"-"+c,this.ReachGoalSoonerService.putInsightData(e)}this.insight=this.ReachGoalSoonerService.getInsightData(),this.$q.all({goalData:this.getGoal(this.insight.GoalID),account:this.AccountDetailsService.getAccountByNumber(this.insight.hash_ACCTNum)}).then((function(e){return t.goalData=e.goalData,t.goalData.goalName=t.goalData.name,t.account=e.account,t.goalData.newTargetDate=(0,r.default)(t.insight.New_Completion_Date),t.goalData.targetDate=(0,r.default)(t.insight.New_Completion_Date).add(t.insight.Reach_XDaysEarly,"days"),t.$q.all({accountDetails:t.AccountDetailsService.getAccountDetails(t.account.number,t.account.type),pendingTransactions:t.GoalsService.requestGoalPendingTransactions(t.account.type,t.account.number)})})).then((function(e){t.pendingTransactions=e.pendingTransactions,t.accountDetails=e.accountDetails,t.translations={frequency:t.$translate.instant("reachGoalSooner.frequency."+t.goalData.goalFrequency)}})).catch((function(e){t.$log.error("Error when fetching data for reachGoalSooner module: "+e)}))}},{key:"getGoal",value:function(t){return this.GoalSummaryService.getLifeGoalById(t).then((function(t){return t.data}))}},{key:"gotoEditGoal",value:function(){var t={lifeGoalId:this.insight.GoalID,account_balance:this.account.account_balance,flowType:this.STATES_FLOW.EDIT,pendingTransactions:this.pendingTransactions,interestRate:this.accountDetails.account_summary.interest.interest_rate,toAccountProductCode:this.account.product_code,entryState:this.STATES_ALL.EDIT.GOAL_EDIT_BASE.SUB_STATES.subStatesMappingData.GOAL_EDIT_CONTRIBUTION};this.GlobalModalsService.showGoalModal(t)}}]),t}();c.$inject=["$log","$q","$translate","$stateParams","ReachGoalSoonerService","GoalsService","GoalSummaryService","GoalsConstants","AccountDetailsService","GlobalModalsService"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(177)),a=u(n(0)),s=u(n(2)),r=u(n(264)),o=u(n(266)),c=u(n(265)),l=n(364);function u(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(t,n,s,o,c,l,u,d){(0,a.default)(this,e);var h=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,l,u,d));return h.$window=c,h.$log=t,h.STATES={HISTORY:{titleKey:"accountDetails.creditCard.rewardsTabModal.history"},MANAGE:{titleKey:"accountDetails.creditCard.rewardsTabModal.manage"},TO_ACCOUNT:{titleKey:"accountDetails.creditCard.rewardsTabModal.toAccount"},REVIEW:{titleKey:"accountDetails.creditCard.rewardsTabModal.review"},CONFIRMATION:{titleKey:"accountDetails.creditCard.rewardsTabModal.confirmation"},PROCESSING:{titleKey:""},OPTIMIZE:{titleKey:"accountDetails.creditCard.rewardsTabModal.optimize"},REDEMPTION:{titleKey:"accountDetails.creditCard.rewardsTabModal.redemption"}},h._initialState=h.STATES.MANAGE,h.openNewSavingAccount=!1,h.modalObj={},h.selected={},h}return(0,c.default)(e,t),(0,s.default)(e,[{key:"selectRewardCount",value:function(t){this._rewardCount=t}},{key:"resetState",value:function(){this._resetState()}},{key:"_resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this._rewardCount=null,this.BUTTONS={BTN_GRY:new l.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new l.ModalFooterButton(this.BUTTON_TYPES.NEXT,!0,!0),BTN_RED:new l.ModalFooterButton(this.BUTTON_TYPES.DELETE,!1,!0)}}},{key:"_updateUI",value:function(){var t=this.currentState,e=this.BUTTON_TYPES,n=this.BUTTONS,i=this.STATES;switch(n.BTN_GRY={type:e.CANCEL,show:!0,disable:!1},n.BTN_ORG={type:e.NEXT,show:!0,disable:!0},n.BTN_RED={type:e.DELETE,show:!1,disable:!0},t){case i.HISTORY:n.BTN_GRY={type:e.BACK,show:!1,disable:!0},n.BTN_ORG={type:e.DONE,show:!0,disable:!1};break;case i.MANAGE:n.BTN_GRY={type:e.CANCEL,show:!0,disable:!1},n.BTN_ORG={type:e.NEXT,show:!0,disable:!0};break;case i.TO_ACCOUNT:n.BTN_GRY={type:e.BACK,show:!0,disable:!1},n.BTN_ORG={type:e.NEXT,show:!1,disable:!1};break;case i.REVIEW:n.BTN_GRY={type:e.BACK,show:!1,disable:!1},n.BTN_ORG={type:e.SUBMIT,show:!0,disable:!1};break;case i.CONFIRMATION:case i.REDEMPTION:n.BTN_GRY={type:e.BACK,show:!1,disable:!1},n.BTN_ORG={type:e.DONE,show:!0,disable:!1};break;case i.OPTIMIZE:n.BTN_GRY={type:e.CANCEL,show:!0,disable:!1},n.BTN_ORG={type:e.OPTIMIZE,show:!0,disable:!1};break;case i.PROCESSING:}}},{key:"_showToAccount",value:function(){return 3===this._rewardCount}},{key:"gotoNextState",value:function(){var t=this.currentState,e=this.STATES,n=void 0;switch(t){case e.MANAGE:n=e.REVIEW,this._showToAccount()&&(n=e.TO_ACCOUNT),this.moveTo(n);break;case e.TO_ACCOUNT:this.moveTo(e.REVIEW);break;case e.REVIEW:this.moveTo(e.PROCESSING);break;case e.PROCESSING:this.moveTo(e.CONFIRMATION);break;case e.OPTIMIZE:this.moveTo(e.MANAGE);break;case e.CONFIRMATION:case e.HISTORY:case e.REDEMPTION:break;default:this.$log.debug("Unknown or unrecognized state:",t)}}},{key:"returnToStart",value:function(){this._resetState()}},{key:"exitLoadingMode",value:function(){this.isLoading=!1,this.doneLoading=!1}},{key:"enterLoadingMode",value:function(){this.showLoadingSpinner()}},{key:"_getAnalyticsID",value:function(){return"rewards"}},{key:"clearSelectedCategories",value:function(){this.selected.categories.clear()}}]),e}(u(n(267)).default);d.$inject=["$log","$q","$transitions","$state","$window","$rootScope","pageFlowConstants","AnalyticsService"],e.default=d,t.exports=e.default},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d){(0,i.default)(this,t),this.MenuService=e,this.menuConstants=n,this.stateConstants=a,this.$translate=s,this.GlobalModalsService=r,this.CustomersService=o,this.buildConstants=c,this.BeneficiariesService=l,this.EnvironmentService=u,this.$q=d}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.hasRegisteredBankingProducts=!1,this.hasRegisteredInvestmentProducts=!1,this.isLoading=!0,this.BeneficiariesService.getRegisteredPlans().then((function(e){e.registered_plans&&e.registered_plans.length>0&&(t.hasRegisteredBankingProducts=!0),e.investment_plans&&e.investment_plans.length>0&&(t.hasRegisteredInvestmentProducts=!0)})),this._getResidencyStatus()}},{key:"handleButtonClick",value:function(t,e,n){var i=angular.isString(n)?this.$translate.instant(n):e;this.MenuService.handleMenuInteraction(t,i)}},{key:"showBeneficiariesModal",value:function(){this.GlobalModalsService.showBeneficiaries()}},{key:"_getResidencyStatus",value:function(){var t=this,e=this.CustomersService;this.$q.all([e.isQuebecResident(),e.isNonResident()]).then((function(e){t.isQuebecResident=e[0],t.isNonResident=e[1]})).finally((function(){t.isLoading=!1}))}}]),t}();r.$inject=["MenuService","menuConstants","stateConstants","$translate","GlobalModalsService","CustomersService","buildConstants","BeneficiariesService","EnvironmentService","$q"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";(function(i){Object.defineProperty(e,"__esModule",{value:!0});var a=o(n(68)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,a,r,o,c,l,u,d,h,f){(0,s.default)(this,t),this.$log=e,this.$timeout=n,this.$window=i,this.$scope=a,this.$document=r,this.PersonalInsightsService=o,this.PersonalInsightsConstants=d,this.serviceConstants=c,this.GlobalModalsService=l,this.EnvironmentService=u,this.isNative=u.isNative(),this.$window.isNative=this.isNative,this.storyParams=this.$window.storyParams,this.mboxNavLink=this.PersonalInsightsConstants.PERSONAL_INSIGHTS_NAV.MBOX_NAV,this.stateConstants=h,this.$state=f}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;this.PersonalInsightsService.isCarousel&&(this.$window.storyParams=null,this.storyParams=null),this.isCarousel?this.PersonalInsightsService.setCarousel():(this.isMBox=this.PersonalInsightsService.isMBox,this.isMBox&&(this.storyParams=null,this.PersonalInsightsService.setMBox()),this.isStory=!this.isMBox&&!!this.storyParams,this.PersonalInsightsService.isStory=this.isStory,this.isStory&&this.PersonalInsightsService.setStory()),this.config={},this.config.lang="en",this.config.widgetType="teaser-widget-carousel",this.config.el=angular.element(i("#perso-widget-container")),this.PersonalInsightsService.isLoading=!0,this._hidePersoWidget(),this.insights=[],this.PersonalInsightsService.insights=[],this.PersonalInsightsService.enhancedInsightsCount=0,this.PersonalInsightsService.pagination=0,this.$log.info(">load perso widget"),this.isCarousel?(this.$log.info(">load perso widget carousel"),this.PersonalInsightsService.getCustomerInsightsWithRetries().then((function(e){t.$log.info(">got cust insights for carousel"),t.insights=e&&e.customer_insights&&e.customer_insights.insights?e.customer_insights.insights:[],t.PersonalInsightsService.insights=t.insights,t.PersonalInsightsService.enhancedInsightsCount=t.insights.length,t.PersonalInsightsService.pagination=0,t.onInsightsFetch(),personetics?t.$timeout((function(){t._startPersoneticsWidget()}),500):t.$timeout((function(){personetics?t.$timeout((function(){t._startPersoneticsWidget()}),500):t.$log.error(">personetics object not defined, cannot start widget!")}),2e3)})).catch((function(e){t.$log.info(e),t.onInsightsFetch()}))):this.$timeout((function(){personetics?(t.$log.info(">Personetics loaded 2"),t.PersonalInsightsService.isLoading=!1,t._showPersoWidget(),t._startPersoneticsWidget()):t.$log.error("personetics object not defined, cannot start widget!")}),2e3)}},{key:"showInboxPage",value:function(){this.$state.go(this.stateConstants.PERSONAL_INSIGHTS_MBOX)}},{key:"_startPersoneticsWidget",value:function(){this.tngEventDelegate={},this.tngEventDelegate.widgetEvent=this.widgetEvent.bind(this),this.tngEventDelegate.sessionEnded=this.sessionEnded,this.tngEventDelegate.sendRequestToPServer=this.sendRequestToPServer,this.tngEventDelegate.handlePServerResponse=this.handlePServerResponse,this.tngEventDelegate.sendRequest=this.sendRequest.bind(this),this.tngEventDelegate.navigateToPage=this.navigateToPage.bind(this),this.tngEventDelegate.notifyEvent=this.notifyEvent.bind(this),this.config.pDelegate=this.tngEventDelegate,personetics?(this.config.channel=this._getChannel(),this._startWidget()):this.$log.error("_startPersoneticsWidget : personetics object not defined, cannot start widget!")}},{key:"_getChannel",value:function(){var t=personetics.getDeviceType();return t||(t="web"),t}},{key:"_startWidget",value:function(){if(this.$log.info(">_startWidget"),this.config.isPredefined=!1,this.config.el.empty(),this.config.payload=this._buildPayLoad(),this.config.payload.isPayloadEncode=!1,this.PersonalInsightsService.isStory){this.PersonalInsightsService.isLoading=!1,this._showPersoWidget();var t={};t.payload=this.storyParams,t.isPredefined=!1,t.payload.isPayloadEncode=!1,t.insightId=this.storyParams.insightId,t.lang="en",t.deviceType=this._getChannel(),t.widgetType="story-widget",t.el=i("#perso-widget-container"),t.pDelegate=this.tngEventDelegate,personetics.startWidget(t)}else this.PersonalInsightsService.isMBox?(this.PersonalInsightsService.isLoading=!1,this._showPersoWidget(),this.config.widgetType="teaser-widget",this.config.payload.insights=this.allStories,this.PersonalInsightsService.storySource=this.PersonalInsightsConstants.WIDGET_STORY_SOURCE.MBOX,personetics.startWidget(this.config)):this.isCarousel&&(this.PersonalInsightsService.enhancedInsightsCount=null,this.PersonalInsightsService.isLoading=!1,this._showPersoWidget(),this.orderedInsights=this._focusOnLastViewedInsight(this.insights),this.config.payload.insights=this.orderedInsights,this.config.widgetType="teaser-widget-carousel",this.PersonalInsightsService.storySource=this.PersonalInsightsConstants.WIDGET_STORY_SOURCE.CAROUSEL,personetics.startWidget(this.config))}},{key:"_focusOnLastViewedInsight",value:function(t){var e=this;if(this.PersonalInsightsService.lastViewedInsightId){var n=t.findIndex((function(t){return t.id===e.PersonalInsightsService.lastViewedInsightId}));if(n<=0)return t;var i=angular.copy(t[n]);return t.splice(n,1),t.unshift(i),t}return t}},{key:"showMailbox",value:function(){this.PersonalInsightsService.insights=this.insights,window.isNative?window.location.href="#/personal-insights-mbox":window.open("#/personal-insights-mbox","_self")}},{key:"handlePServerResponse",value:function(t,e){personetics.handlePServerResponse(t,e)}},{key:"_buildPayLoad",value:function(){var t={lang:this.config.lang,ctxId:null,insights:null,isPayloadEncode:!0};return t.channel=this._getChannel(),t}},{key:"widgetEvent",value:function(t,e){var n=this;switch(e.actionType&&("externalNavigation"===e.actionType?this.navigateToPage(e):"externalNavigationUrl"===e.actionType?this.$window.location.href=e.payload.navigateTarget:this.tngEventDelegate.handleWidgetAction(t,e)),e.eventType){case"teaserClick":var i=this._buildStoryDetailsParam(e);this.PersonalInsightsService.setStory(),this.PersonalInsightsService.getStoryDetails(i).then((function(t){var i=t;i.insightId=e.insightId,n.$timeout((function(){window.storyParams=i,window.isNative?window.location.href="#/personal-insight-story":window.open("#/personal-insight-story","_self")}),500)})).catch((function(t){n.$log.error(t),n.onServiceError(!0)}));break;case"teaserSwiped":this._preparePagination(e);break;case"teaserDismiss":this._processTeaserDismiss(e)}}},{key:"_buildStoryDetailsParam",value:function(t){return{deviceType:this._getChannel(),insightId:t.insightId,ctxId:t.instanceId,type:"getInsightDetails",protocolVersion:"2.6"}}},{key:"_processTeaserDismiss",value:function(t){this.PersonalInsightsService.pagination=t.pagination,this.onTeaserDismiss()}},{key:"_preparePagination",value:function(t){var e;this.PersonalInsightsService.pagination=t.pagination,this.PersonalInsightsService.paginationInfo.length=0,(e=this.PersonalInsightsService.paginationInfo).push.apply(e,(0,a.default)(this.PersonalInsightsService.insights)),this.onTeaserSwipe()}},{key:"_hidePersoWidget",value:function(){this.config.el.addClass("ng-hide")}},{key:"_showPersoWidget",value:function(){this.config.el.removeClass("ng-hide")}},{key:"sendRequestToPServer",value:function(t,e,n){var i=e.hasOwnProperty("requestString")?e.requestString:"sendRequestToPServer";"sendRequestToPServer"===i&&e.type&&(i=e.type);var a={requestData:e,requestId:n};this.sendRequest(a,i,n)}},{key:"sendRequest",value:function(t,e,n){var a=this;this.PersonalInsightsService.sendRequestToPserverViaBackendService(t,e,n).then((function(t){if("200"===t.status&&"ok"===t.statusMessage){a.onServiceError(!1);try{personetics.handlePServerResponse(t,n)}catch(t){a.$log.error("Failed on handlePServerResponse",t)}if(a.PersonalInsightsService.isStory){var e=angular.element(i("#story-frame-container"));e&&e.css({height:"auto","margin-top":"20px"}),(e=angular.element(document.querySelector(".perso-ratings-wrapper")))&&e.css({height:"auto","margin-top":"10px"})}}else a.onServiceError(!0)})).catch((function(t){console.log("sendRequestToPserverViaBackendService error: ",t),a.$log.error("Failed on post personal insights data ",t);try{personetics.handlePServerResponse({ok:!1,status:"600",statusMessage:"A network error occurred - check your network and try again."},n)}catch(t){a.$log.error("Failed on handlePServerResponse",t)}a.onServiceError(!0)}))}},{key:"onServiceError",value:function(t){this.PersonalInsightsService.isServiceError=t}},{key:"handlePServerResponse",value:function(t,e){var n=t;n||(n={ok:!1,status:"600",statusMessage:"A network error occurred - check your network and try again."}),personetics.handlePServerResponse(n,e)}},{key:"notifyEvent",value:function(){}},{key:"navigateToPage",value:function(t){if(this._hidePersoWidget(),this.PersonalInsightsService.isLoading=!0,this.PersonalInsightsService.isStory=!1,this.PersonalInsightsService.isMBox=!1,t&&t.navigateTarget)switch(t.navigateTarget){case"LearnAboutGICs":this._processGotoSavings();break;case"LearnAboutInvestments":this._processGotoInvesting();break;case"ABMlocator":this._processGotoAbmLocation();break;case"BillPay":this._processGotoPayBills();break;case"SavingsOptionsLink":this._processGotoASP();break;case"MoveMoney":this._processMakeAPaymentLink();break;case"OrangeAlerts":this._processGotoOrangeAlerts();break;case"SetUpLTS":case"ReviewLTS":this._processGotoLts();break;case"OrangeAlerts":this._processGotoOrangeAlerts();break;case"SavingsBasket":this._processGotoSavings();break;case"SetUpASP":this._processGotoASP();break;case"SetUpGoal":this._processSetUpGoal();break;case"RDCFAQ":this._processRDC()}else this._routeToUrl(t)}},{key:"_sendNavigateRequest",value:function(t){if("web"!=this._getChannel()){var e={requestString:"navigateToPage",data:t};this.sendRequestToPServer(null,e)}}},{key:"_gotoToHashTagRoute",value:function(t){this.$timeout((function(){window.isNative?window.location.href=t:window.open(t,"_self")}),100)}},{key:"_routeToUrl",value:function(t){if(t.url){var e=t.url;0!==e.indexOf("http")?this.isNative?(0===e.indexOf("/")?e=e.substring(1):0===e.indexOf(this.EnvironmentService.getBaseUrl())&&0===(e=e.substring(this.EnvironmentService.getBaseUrl().length)).indexOf("/")&&(e=e.substring(1)),0===e.indexOf("en/")||0===e.indexOf("fr/")?(e=this.EnvironmentService.getBaseUrl()+"/"+e,this.$window.open(e,"_self"),this._sendNavigateRequest(t)):0===e.indexOf("#")&&(window.location.href=e,this._sendNavigateRequest(t))):(this.$window.open(e,"_self"),this._sendNavigateRequest(t)):this.$window.open(e,this.isNative?"_system":"_blank")}}},{key:"_processRDC",value:function(){var t=this.EnvironmentService.getBaseUrl()+"//en/faq/answer?permaLink=what-is-cheque-in--generic-phone--en--0--1&responseId=219--ANzJov7WDR7dgfOe8QGcqw";this.$window.open(t,this.isNative?"_system":"_self")}},{key:"_processSetUpGoal",value:function(){this._gotoToHashTagRoute("#/financialplan-goals")}},{key:"_processGotoLts",value:function(){this._gotoToHashTagRoute("#/left-to-spend")}},{key:"_processGotoOpenAccount",value:function(){this._gotoToHashTagRoute("#/open-account")}},{key:"_processGotoAbmLocation",value:function(){var t=this;this.$timeout((function(){t.$state.go(t.stateConstants.ABM_LOCATIONS)}),50)}},{key:"_processGotoPayBills",value:function(){var t=this;this.$timeout((function(){t.$state.go(t.stateConstants.PAY_BILLS_MODAL_V2)}),50)}},{key:"_processGotoSavings",value:function(){this._gotoToHashTagRoute("#/open-account?category=savings&personalInsight=y")}},{key:"_processGotoInvesting",value:function(){this._gotoToHashTagRoute("#/open-account?category=investing&personalInsight=y")}},{key:"_processGotoASP",value:function(){var t=this;this.$timeout((function(){t.$state.go(t.stateConstants.ASP_MODAL)}),50)}},{key:"_processGotoOrangeAlerts",value:function(){this._gotoToHashTagRoute("#/settings/orange-alerts")}},{key:"_processMakeAPaymentLink",value:function(){var t=this;this.$timeout((function(){t.$state.go(t.stateConstants.MOVE_MONEY_MODAL)}),50)}}]),t}();c.$inject=["$log","$timeout","$window","$scope","$document","PersonalInsightsService","serviceConstants","GlobalModalsService","EnvironmentService","PersonalInsightsConstants","stateConstants","$state"],e.default=c,t.exports=e.default}).call(this,n(93))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";(function(t){!function(t,e){t.fn.signingPad=function(e){var i=t.extend(e,{isDisabled:!1,lineColor:"#4e4e4e",color:"#002888",initialSignature:null,signatureValid:"SubmitButton",texts:{signatureLineText:""}});if(void 0===t(this).data("signingPad")){var a=new n(this,i);a.init(),t(this).data("signingPad",a)}};var n=function(e,n){this.element=t(e),this.self=this,this.options=t.extend({},n,this.element.data()),this._blankSignature=""};n.prototype={init:function(){var n=this;this.options.padId=this.element.attr("id"),this.options.hiddenPathsId=this.options.padId+"value",this.options.enableChangeCallback=!0,0===this.element.next("#"+this.options.hiddenPathsId).length&&t("<input/>").attr("type","hidden").attr("id",this.options.hiddenPathsId).attr("name",this.options.hiddenPathsId).insertAfter(this.element),this.options.signaturePaths=this.element.next("#"+this.options.hiddenPathsId),this.options=t.extend({disabled:this.options.isDisabled,minArcLength:10,ratio:3,lineColor:this.options.lineColor,color:this.options.color,lineWidth:3,sizeRatio:6,minDimension:{width:400,height:300},maxDimension:{width:900,height:630},signatureLineWidth:2,signInPlace:!this._isTouchDevice(),showUndo:!1,disableCancelMessage:!0,onSubmit:function(e){t("[data-signature-valid-target="+n.options.signatureValid+"]").prop("disabled",n.options.signaturePaths.val()===n.getBlankSignature())},onCancel:function(){},onInit:function(){},onClear:function(){}},this.options),this.options=t.extend(this.options,this.element.data()),this._recreateWidget(),this.element.on("change",this._handleChange.bind(this));var i=void 0!==e?e.debounce(this._handleWindowResize.bind(this),10):this._handleWindowResize.bind(this);t(window).on("resize",i)},_handleWindowResize:function(t){var e=this;e._handleResize(t),setTimeout((function(){e._handleResize(t),e.element.trigger("signingpad.onresize"),e._addingZindex(e.element)}),200)},_handleChange:function(){if(this.options.signatureValid){this.element.off("change");var e=this.options.enableChangeCallback;this.options.enableChangeCallback=!1,this.options.signatureValid&&t("[data-signature-valid-target="+this.options.signatureValid+"]").prop("disabled",this.options.signaturePaths.val()===this.getBlankSignature()),this.options.enableChangeCallback=e,this.element.on("change",this._handleChange.bind(this))}this.options.enableChangeCallback&&(this._saveSignature(),this.element.trigger("signingpad.onchange",null,{signature:this.getSignature()}))},destroy:function(){1===this.element.next("#"+this.options.hiddenPathsId).length&&this.element.next("#"+this.options.hiddenPathsId).remove(),this.element.empty()},_handleResize:function(t){this.element.off("change");var e=this.options.enableChangeCallback;this.options.enableChangeCallback=!1;var n=this.options.signaturePaths.val();this.element.html(""),this.element.capsig("destroy").capsig(this.options),this._blankSignature=this.element.capsig("getSignature"),this.setSignature(n),this.element.capsig("disable",this.options.isDisabled),this.element.on("change",this._handleChange.bind(this)),this.options.enableChangeCallback=e},_recreateWidget:function(){this.element.capsig(this.options),this._blankSignature=this.element.capsig("getSignature"),this._addingZindex(this.element),this.options.initialSignature&&(this.setSignature(this.options.initialSignature),this.options.signaturePaths.val(this.options.initialSignature),this.element.trigger("signingpad.onchange",null,{signature:this.options.initialSignature}),t("[data-signature-valid-target="+this.options.signatureValid+"]").prop("disabled",this.options.signaturePaths.val()===this.getBlankSignature()))},_saveSignature:function(){var t=this.element.capsig("getSignature");this.options.signaturePaths.val(t),this._addingZindex(this.element)},getSignature:function(){return this.element.capsig("getSignature")},getBlankSignature:function(){return this._blankSignature},setSignature:function(t){this.element.capsig("setSignature",t||this.options.signaturePaths.val())},clearSignature:function(){this.element.off("change"),this.options.enableChangeCallback=!1,this.options.signaturePaths.val(""),this.element.capsig("clear"),this.options.enableChangeCallback=!0,this._addingZindex(this.element),this.options.signatureValid&&t("[data-signature-valid-target="+this.options.signatureValid+"]").prop("disabled",!0),this.element.on("change",this._handleChange.bind(this))},disableWidget:function(){this.element.off("change"),this.options.isDisabled=!0,this.element.capsig(this.options).capsig("disable",!0),this.element.on("change")},enableWidget:function(){this.element.off("change"),this.options.isDisabled=!1,this.element.capsig(this.options).capsig("disable",!1),this.element.on("change")},_isTouchDevice:function(){return!!t("html").hasClass("touch")},_addingZindex:function(t){this._isTouchDevice()&&t.find(".signature").css("z-index",1).find("canvas").css("z-index",-1)}}}(t,window._)}).call(this,n(93))},function(t,e,n){"use strict";var i,a,s;a=[n(93)],void 0===(s="function"==typeof(i=function(t){var e,n=0,i=Array.prototype.hasOwnProperty,a=Array.prototype.slice;return t.cleanData=(e=t.cleanData,function(n){var i,a,s;for(s=0;null!=(a=n[s]);s++)(i=t._data(a,"events"))&&i.remove&&t(a).triggerHandler("remove");e(n)}),t.widget=function(e,n,i){var a,s,r,o={},c=e.split(".")[0],l=c+"-"+(e=e.split(".")[1]);return i||(i=n,n=t.Widget),t.isArray(i)&&(i=t.extend.apply(null,[{}].concat(i))),t.expr.pseudos[l.toLowerCase()]=function(e){return!!t.data(e,l)},t[c]=t[c]||{},a=t[c][e],s=t[c][e]=function(t,e){if(!this._createWidget)return new s(t,e);arguments.length&&this._createWidget(t,e)},t.extend(s,a,{version:i.version,_proto:t.extend({},i),_childConstructors:[]}),(r=new n).options=t.widget.extend({},r.options),t.each(i,(function(e,i){t.isFunction(i)?o[e]=function(){function t(){return n.prototype[e].apply(this,arguments)}function a(t){return n.prototype[e].apply(this,t)}return function(){var e,n=this._super,s=this._superApply;return this._super=t,this._superApply=a,e=i.apply(this,arguments),this._super=n,this._superApply=s,e}}():o[e]=i})),s.prototype=t.widget.extend(r,{widgetEventPrefix:a&&r.widgetEventPrefix||e},o,{constructor:s,namespace:c,widgetName:e,widgetFullName:l}),a?(t.each(a._childConstructors,(function(e,n){var i=n.prototype;t.widget(i.namespace+"."+i.widgetName,s,n._proto)})),delete a._childConstructors):n._childConstructors.push(s),t.widget.bridge(e,s),s},t.widget.extend=function(e){for(var n,s,r=a.call(arguments,1),o=0,c=r.length;o<c;o++)for(n in r[o])s=r[o][n],i.call(r[o],n)&&void 0!==s&&(t.isPlainObject(s)?e[n]=t.isPlainObject(e[n])?t.widget.extend({},e[n],s):t.widget.extend({},s):e[n]=s);return e},t.widget.bridge=function(e,n){var i=n.prototype.widgetFullName||e;t.fn[e]=function(s){var r="string"==typeof s,o=a.call(arguments,1),c=this;return r?this.length||"instance"!==s?this.each((function(){var n,a=t.data(this,i);return"instance"===s?(c=a,!1):a?t.isFunction(a[s])&&"_"!==s.charAt(0)?(n=a[s].apply(a,o))!==a&&void 0!==n?(c=n&&n.jquery?c.pushStack(n.get()):n,!1):void 0:t.error("no such method '"+s+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+s+"'")})):c=void 0:(o.length&&(s=t.widget.extend.apply(null,[s].concat(o))),this.each((function(){var e=t.data(this,i);e?(e.option(s||{}),e._init&&e._init()):t.data(this,i,new n(s,this))}))),c}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,(function(t,n){e._removeClass(n,t)})),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,n){var i,a,s,r=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(r={},i=e.split("."),e=i.shift(),i.length){for(a=r[e]=t.widget.extend({},this.options[e]),s=0;s<i.length-1;s++)a[i[s]]=a[i[s]]||{},a=a[i[s]];if(e=i.pop(),1===arguments.length)return void 0===a[e]?null:a[e];a[e]=n}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];r[e]=n}return this._setOptions(r),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var n,i,a;for(n in e)a=this.classesElementLookup[n],e[n]!==this.options.classes[n]&&a&&a.length&&(i=t(a.get()),this._removeClass(a,n),i.addClass(this._classes({element:i,keys:n,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){var n=[],i=this;function a(a,s){var r,o;for(o=0;o<a.length;o++)r=i.classesElementLookup[a[o]]||t(),e.add?(e.element.each((function(e,n){t.map(i.classesElementLookup,(function(t){return t})).some((function(t){return t.is(n)}))||i._on(t(n),{remove:"_untrackClassesElement"})})),r=t(t.uniqueSort(r.get().concat(e.element.get())))):r=t(r.not(e.element).get()),i.classesElementLookup[a[o]]=r,n.push(a[o]),s&&e.classes[a[o]]&&n.push(e.classes[a[o]])}return(e=t.extend({element:this.element,classes:this.options.classes||{}},e)).keys&&a(e.keys.match(/\S+/g)||[],!0),e.extra&&a(e.extra.match(/\S+/g)||[]),n.join(" ")},_untrackClassesElement:function(e){var n=this;t.each(n.classesElementLookup,(function(i,a){-1!==t.inArray(e.target,a)&&(n.classesElementLookup[i]=t(a.not(e.target).get()))})),this._off(t(e.target))},_removeClass:function(t,e,n){return this._toggleClass(t,e,n,!1)},_addClass:function(t,e,n){return this._toggleClass(t,e,n,!0)},_toggleClass:function(t,e,n,i){i="boolean"==typeof i?i:n;var a="string"==typeof t||null===t,s={extra:a?e:n,keys:a?t:e,element:a?this.element:t,add:i};return s.element.toggleClass(this._classes(s),i),this},_on:function(e,n,i){var a,s=this;"boolean"!=typeof e&&(i=n,n=e,e=!1),i?(n=a=t(n),this.bindings=this.bindings.add(n)):(i=n,n=this.element,a=this.widget()),t.each(i,(function(i,r){function o(){if(e||!0!==s.options.disabled&&!t(this).hasClass("ui-state-disabled"))return("string"==typeof r?s[r]:r).apply(s,arguments)}"string"!=typeof r&&(o.guid=r.guid=r.guid||o.guid||t.guid++);var c=i.match(/^([\w:-]*)\s*(.*)$/),l=c[1]+s.eventNamespace,u=c[2];u?a.on(l,u,o):n.on(l,o)}))},_off:function(e,n){n=(n||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(n),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){var n=this;return setTimeout((function(){return("string"==typeof t?n[t]:t).apply(n,arguments)}),e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,n,i){var a,s,r=this.options[e];if(i=i||{},(n=t.Event(n)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),n.target=this.element[0],s=n.originalEvent)for(a in s)a in n||(n[a]=s[a]);return this.element.trigger(n,i),!(t.isFunction(r)&&!1===r.apply(this.element[0],[n].concat(i))||n.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},(function(e,n){t.Widget.prototype["_"+e]=function(i,a,s){var r;"string"==typeof a&&(a={effect:a});var o=a?!0===a||"number"==typeof a?n:a.effect||n:e;"number"==typeof(a=a||{})&&(a={duration:a}),r=!t.isEmptyObject(a),a.complete=s,a.delay&&i.delay(a.delay),r&&t.effects&&t.effects.effect[o]?i[e](a):o!==e&&i[o]?i[o](a.duration,a.easing,s):i.queue((function(n){t(this)[e](),s&&s.call(i[0]),n()}))}})),t.widget})?i.apply(e,a):i)||(t.exports=s)},function(module,exports,__webpack_require__){"use strict";(function(jQuery,$){var _typeof2=__webpack_require__(39),_typeof3=_interopRequireDefault(_typeof2);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}!function($){for(var supportedCSS,supportedCSSOrigin,styles=document.getElementsByTagName("head")[0].style,toCheck="WebkitTransform transformProperty OTransform msTransform MozTransform".split(" "),a=0;a<toCheck.length;a++)void 0!==styles[toCheck[a]]&&(supportedCSS=toCheck[a]);supportedCSS&&(supportedCSSOrigin=supportedCSS.replace(/[tT]ransform/,"TransformOrigin"),"T"==supportedCSSOrigin[0]&&(supportedCSSOrigin[0]="t")),eval('window.IE = "v"=="\v"'),jQuery.fn.extend({rotate:function(t){if(0!==this.length&&void 0!==t){"number"==typeof t&&(t={angle:t});for(var e=[],n=0,i=this.length;i>n;n++){var a=this.get(n);if(a.Wilq32&&a.Wilq32.PhotoEffect)a.Wilq32.PhotoEffect._handleRotation(t);else{var s=$.extend(!0,{},t),r=new Wilq32.PhotoEffect(a,s)._rootObj;e.push($(r))}}return e}}});var Wilq32=window.Wilq32||{};Wilq32.PhotoEffect=supportedCSS?function(t,e){t.Wilq32={PhotoEffect:this},this._img=this._rootObj=this._eventObj=t,this._handleRotation(e)}:function(t,e){if(this._img=t,this._onLoadDelegate=[e],this._rootObj=document.createElement("span"),this._rootObj.style.display="inline-block",this._rootObj.Wilq32={PhotoEffect:this},t.parentNode.insertBefore(this._rootObj,t),t.complete)this._Loader();else{var n=this;jQuery(this._img).bind("load",(function(){n._Loader()}))}},Wilq32.PhotoEffect.prototype={_setupParameters:function(t){this._parameters=this._parameters||{},"number"!=typeof this._angle&&(this._angle=0),"number"==typeof t.angle&&(this._angle=t.angle),this._parameters.animateTo="number"==typeof t.animateTo?t.animateTo:this._angle,this._parameters.step=t.step||this._parameters.step||null,this._parameters.easing=t.easing||this._parameters.easing||this._defaultEasing,this._parameters.duration=t.duration||this._parameters.duration||1e3,this._parameters.callback=t.callback||this._parameters.callback||this._emptyFunction,this._parameters.center=t.center||this._parameters.center||["50%","50%"],"string"==typeof this._parameters.center[0]?this._rotationCenterX=parseInt(this._parameters.center[0],10)/100*this._imgWidth*this._aspectW:this._rotationCenterX=this._parameters.center[0],"string"==typeof this._parameters.center[1]?this._rotationCenterY=parseInt(this._parameters.center[1],10)/100*this._imgHeight*this._aspectH:this._rotationCenterY=this._parameters.center[1],t.bind&&t.bind!=this._parameters.bind&&this._BindEvents(t.bind)},_emptyFunction:function(){},_defaultEasing:function(t,e,n,i,a){return-i*((e=e/a-1)*e*e*e-1)+n},_handleRotation:function(t,e){return supportedCSS||this._img.complete||e?(this._setupParameters(t),void this._rotate(this._angle)):void this._onLoadDelegate.push(t)},_BindEvents:function(t){if(t&&this._eventObj){if(this._parameters.bind){var e=this._parameters.bind;for(var n in e)e.hasOwnProperty(n)&&jQuery(this._eventObj).unbind(n,e[n])}for(var n in this._parameters.bind=t,t)t.hasOwnProperty(n)&&jQuery(this._eventObj).bind(n,t[n])}},_Loader:function(){this._rootObj.setAttribute("id",this._img.getAttribute("id")),this._rootObj.className=this._img.className,this._imgWidth=this._img.naturalWidth,this._imgHeight=this._img.naturalHeight;var t,e=Math.sqrt(this._imgHeight*this._imgHeight+this._imgWidth*this._imgWidth);for(this._width=3*e,this._height=3*e,this._aspectW=this._img.offsetWidth/this._img.naturalWidth,this._aspectH=this._img.offsetHeight/this._img.naturalHeight,this._img.parentNode.removeChild(this._img),this._canvas=document.createElement("canvas"),this._canvas.setAttribute("width",this._width),this._canvas.style.position="relative",this._canvas.style.left=-this._img.height*this._aspectW+"px",this._canvas.style.top=-this._img.width*this._aspectH+"px",this._canvas.Wilq32=this._rootObj.Wilq32,this._rootObj.appendChild(this._canvas),this._rootObj.style.width=this._img.width*this._aspectW+"px",this._rootObj.style.height=this._img.height*this._aspectH+"px",this._eventObj=this._canvas,this._cnv=this._canvas.getContext("2d");t=this._onLoadDelegate.shift();)this._handleRotation(t,!0)},_rotate:function(){var t=Math.PI/180;return supportedCSS?function(t){this._angle=t,this._img.style[supportedCSS]="rotate("+t%360+"deg)",this._img.style[supportedCSSOrigin]=this._parameters.center.join(" ")}:function(e){this._angle=e,e=e%360*t,this._canvas.width=this._width,this._canvas.height=this._height,this._cnv.translate(this._imgWidth*this._aspectW,this._imgHeight*this._aspectH),this._cnv.translate(this._rotationCenterX,this._rotationCenterY),this._cnv.rotate(e),this._cnv.translate(-this._rotationCenterX,-this._rotationCenterY),this._cnv.scale(this._aspectW,this._aspectH),this._cnv.drawImage(this._img,0,0)}}()}}(jQuery),function(){function t(t,e){this.x=t,this.y=e,this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)},this._length=null,this.getLength=function(){return this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))),this._length};var n=function(t){return Math.round(t/Math.abs(t))};this.resizeTo=function(t){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=t,this.y=t*n(this.y);else if(0===this.y)this._length=t,this.x=t*n(this.x);else{var e=Math.abs(this.y/this.x),i=Math.sqrt(Math.pow(t,2)/(1+Math.pow(e,2))),a=e*i;this._length=t,this.x=i*n(this.x),this.y=a*n(this.y)}return this},this.angleTo=function(t){var e=this.getLength()*t.getLength();return 0===e?0:Math.acos(Math.min(Math.max((this.x*t.x+this.y*t.y)/e,-1),1))/Math.PI}}function e(e,n){this.x=e,this.y=n,this.getVectorToCoordinates=function(e,n){return new t(e-this.x,n-this.y)},this.getVectorFromCoordinates=function(t,e){return this.getVectorToCoordinates(t,e).reverse()},this.getVectorToPoint=function(e){return new t(e.x-this.x,e.y-this.y)},this.getVectorFromPoint=function(t){return this.getVectorToPoint(t).reverse()}}function n(t,e,n,i,a){if(this.data=t,this.context=e,t.length)for(var s,r,o=t.length,c=0;o>c;c++){r=(s=t[c]).x.length,n.call(e,s);for(var l=1;r>l;l++)i.call(e,s,l);a.call(e,s)}this.changed=function(){},this.startStrokeFn=n,this.addToStrokeFn=i,this.endStrokeFn=a,this.inStroke=!1,this._lastPoint=null,this._stroke=null,this.startStroke=function(t){if(t&&"number"==typeof t.x&&"number"==typeof t.y){this._stroke={x:[t.x],y:[t.y]},this.data.push(this._stroke),this._lastPoint=t,this.inStroke=!0;var e=this._stroke,n=this.startStrokeFn,i=this.context;return setTimeout((function(){n.call(i,e)}),3),t}return null},this.addToStroke=function(t){if(this.inStroke&&"number"==typeof t.x&&"number"==typeof t.y&&Math.abs(t.x-this._lastPoint.x)+Math.abs(t.y-this._lastPoint.y)>4){var e=this._stroke.x.length;this._stroke.x.push(t.x),this._stroke.y.push(t.y),this._lastPoint=t;var n=this._stroke,i=this.addToStrokeFn,a=this.context;return setTimeout((function(){i.call(a,n,e)}),3),t}return null},this.endStroke=function(){var t=this.inStroke;if(this.inStroke=!1,this._lastPoint=null,t){var e=this._stroke,n=this.endStrokeFn,i=this.context,a=this.changed;return setTimeout((function(){n.call(i,e),a.call(i)}),3),!0}return null}}function i(t,e,n,i){("ratio"===e||"%"===e.split("")[e.length-1])&&(this.eventTokens[n+".parentresized"]=i.subscribe(n+".parentresized",function(e,a,s,r){return function(){var r=a.width();if(r!==s&&a.height()>=100){for(var o in e)e.hasOwnProperty(o)&&(i.unsubscribe(e[o]),delete e[o]);var c=t.settings;for(var o in t.$parent.find(".signatureparent").remove(),t)t.hasOwnProperty(o)&&delete t[o];c.data=function(t,e){var n,i,a,s,r,o,c=[];for(i=0,a=t.length;a>i;i++){for(n={x:[],y:[]},s=0,r=(o=t[i]).x.length;r>s;s++)n.x.push(o.x[s]*e),n.y.push(o.y[s]*e);c.push(n)}return c}(c.data,1*r/s),a[n](c)}}}(this.eventTokens,this.$parent,this.$parent.width(),(this.canvas.width,this.canvas.height))))}function a(t,n,a){var c=this.$parent=$(t),l=this.eventTokens={},u=(this.events=new o(this),$.fn[s]("globalEvents")),d={width:"ratio",disabled:!1,minPoints:1,showUndo:!1,showHeader:!0,showSignatureLine:!0,LeftPanel:!0,RightPanel:!0,height:"ratio",sizeRatio:3.3,color:"#000","background-color":"#fff",lineColor:"#eee",lineWidth:0,minFatFingerCompensation:-10,data:[]};for(var h in $.extend(d,function(t){for(var e,n,i,a=t.css("color"),s=t[0],r=!1;s&&!i&&!r;){try{e=$(s).css("background-color")}catch(t){e="transparent"}"transparent"!==e&&"rgba(0, 0, 0, 0)"!==e&&(i=e),r=s.body,s=s.parentNode}var o,c,l=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,u=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/;e=n,(e=a.match(l))?o={r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}:(e=a.match(u))&&(o={r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}),i?(e=n,(e=i.match(l))?c={r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}:(e=i.match(u))&&(c={r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)})):c=o&&Math.max.apply(null,[o.r,o.g,o.b])>127?{r:0,g:0,b:0}:{r:255,g:255,b:255};var d,h,f,p=function(t){return"rgb("+[t.r,t.g,t.b].join(", ")+")"};if(o&&c){var g=Math.max.apply(null,[o.r,o.g,o.b]);h=Math.max.apply(null,[c.r,c.g,c.b]),d={r:f=Math.round(h+-1*(h-g)*.75),g:f,b:f}}else if(o){var m=1;(h=Math.max.apply(null,[o.r,o.g,o.b]))>127&&(m=-1),d={r:f=Math.round(h+96*m),g:f,b:f}}else d={r:191,g:191,b:191};return{color:a,"background-color":c?p(c):i,lineColor:p(d)}}(c)),n&&$.extend(d,n),this.settings=d,c.append('<div class="signature"></div>'),c.show(),a)a.hasOwnProperty(h)&&a[h].call(this,h);window.SILANIS_JSIGNATURE_BUTTONS_ARE_DISABLED&&(c.addClass("disable-behavior"),setTimeout((function(){for(var t=c.jSignature("getData","native"),e=0,n=0;n<t.length;n++)e+=t[n].x.length;c.find(".clear").button(e>=1?"enable":"disable"),c.find(".submit").button(e>=c.jSignature("getSettings").minPoints?"enable":"disable")}),0)),this.events.publish(s+".initializing"),this.$controlbarUpper=$('<div class="control-bar-upper"></div>').appendTo(c.find(".signature")),this.isCanvasEmulator=!1;var f=this.canvas=this.initializeCanvas(d),p=$(f);this.$controlbarLower=$('<div class="control-bar clearfix"></div>').appendTo(c.find(".signature")),this.canvasContext=f.getContext("2d"),p.data(s+".this",this),d.lineWidth=function(t,e){return t||Math.max(Math.round(e/400),2)}(d.lineWidth,f.width),this.lineCurveThreshold=3*d.lineWidth,d.cssclass&&""!=$.trim(d.cssclass)&&p.addClass(d.cssclass),this.fatFingerCompensation=0;var g=function(t){var n,i,a=function(){var e=$(t.canvas).offset(),a=navigator.userAgent;UA.isAndroid()&&!UA.isFirefox()&&!UA.isOpera()&&!UA.isChrome()&&parseFloat(a.slice(a.indexOf("Android")+8))>=4.1?(n=-1*(e.left+$(window).scrollLeft()),i=-1*(e.top+$(window).scrollTop())):(n=-1*e.left,i=-1*e.top)},s=function(a){var s=a.changedTouches&&a.changedTouches.length>0?a.changedTouches[0]:a;return new e(Math.round(s.pageX+n),Math.round(s.pageY+i)+t.fatFingerCompensation)},o=new r(750,(function(){t.dataEngine.endStroke()}));return this.drawEndHandler=function(e){try{e.preventDefault()}catch(t){}t.settings.disabled||(o.clear(),t.dataEngine.endStroke())},this.drawStartHandler=function(e){e.preventDefault(),t.settings.disabled||(a(),t.dataEngine.startStroke(s(e)),o.kick())},this.drawMoveHandler=function(e){if(e.preventDefault(),!t.settings.disabled){if(!t.dataEngine.inStroke)return;t.dataEngine.addToStroke(s(e)),o.kick()}},this}.call({},this);return function(t,e,n){var i,a=this.canvas,r=$(a);this.isCanvasEmulator?(r.bind("mousemove."+s,n),r.bind("mouseup."+s,t),r.bind("mousedown."+s,e)):(a.ontouchstart=function(s){a.onmousedown=i,a.onmouseup=i,a.onmousemove=i,this.fatFingerCompensation=d.minFatFingerCompensation&&-3*d.lineWidth>d.minFatFingerCompensation?-3*d.lineWidth:d.minFatFingerCompensation,e(s),a.ontouchend=t,a.ontouchstart=e,a.ontouchmove=n},r.bind("mousedown",(function(s){a.ontouchstart=i,a.ontouchend=i,a.ontouchmove=i,e(s),r.unbind("mousedown").bind("mousedown",e),r.unbind("mouseup").bind("mouseup",t),r.unbind("mousemove").bind("mousemove",n)})))}.call(this,g.drawEndHandler,g.drawStartHandler,g.drawMoveHandler),l[s+".windowmouseup"]=u.subscribe(s+".windowmouseup",g.drawEndHandler),this.events.publish(s+".attachingEventHandlers"),i.call(this,this,d.width.toString(10),s,u),this.resetCanvas(d.data),this.events.publish(s+".initialized"),this}var s="jSignature",r=function(t,e){var n;return this.kick=function(){clearTimeout(n),n=setTimeout(e,t)},this.clear=function(){clearTimeout(n)},this},o=function(t){this.topics={},this.context=t||this,this.publish=function(t,e,n,i){if(this.topics[t]){var a,s,r,o,c=this.topics[t],l=Array.prototype.slice.call(arguments,1),u=[];for(s=0,r=c.length;r>s;s++)a=(o=c[s])[0],o[1]&&(o[0]=function(){},u.push(s)),a.apply(this.context,l);for(s=0,r=u.length;r>s;s++)c.splice(u[s],1)}},this.subscribe=function(t,e,n){return this.topics[t]?this.topics[t].push([e,n]):this.topics[t]=[[e,n]],{topic:t,callback:e}},this.unsubscribe=function(t){if(this.topics[t.topic])for(var e=this.topics[t.topic],n=0,i=e.length;i>n;n++)e[n][0]===t.callback&&e.splice(n,1)}},c=function(t,e,n,i,a){t.beginPath(),t.moveTo(e,n),t.lineTo(i,a),t.stroke()},l=function(t,e,n,i,a,s,r,o,c){t.beginPath(),t.moveTo(e,n),t.bezierCurveTo(s,r,o,c,i,a),t.stroke()},u=function(t){!function(t,e,n,i){var a=t.fillStyle;t.fillStyle=t.strokeStyle,t.fillRect(e+i/-2,n+i/-2,i,i),t.fillStyle=a}(this.canvasContext,t.x[0],t.y[0],this.settings.lineWidth)},d=function(n,i){var a=new e(n.x[i-1],n.y[i-1]),s=new e(n.x[i],n.y[i]),r=a.getVectorToPoint(s);if(i>1){var o,u=new e(n.x[i-2],n.y[i-2]),d=u.getVectorToPoint(a);if(d.getLength()>this.lineCurveThreshold){o=i>2?new e(n.x[i-3],n.y[i-3]).getVectorToPoint(u):new t(0,0);var h=.35*d.getLength(),f=d.angleTo(o.reverse()),p=r.angleTo(d.reverse()),g=new t(o.x+d.x,o.y+d.y).resizeTo(Math.max(.05,f)*h),m=new t(d.x+r.x,d.y+r.y).reverse().resizeTo(Math.max(.05,p)*h);l(this.canvasContext,u.x,u.y,a.x,a.y,u.x+g.x,u.y+g.y,a.x+m.x,a.y+m.y)}}r.getLength()<=this.lineCurveThreshold&&c(this.canvasContext,a.x,a.y,s.x,s.y)},h=function(n){var i=n.x.length-1;if(i>0){var a,s=new e(n.x[i],n.y[i]),r=new e(n.x[i-1],n.y[i-1]),o=r.getVectorToPoint(s);if(o.getLength()>this.lineCurveThreshold)if(i>1){var u=new t((a=new e(n.x[i-2],n.y[i-2]).getVectorToPoint(r)).x+o.x,a.y+o.y).resizeTo(o.getLength()/2);l(this.canvasContext,r.x,r.y,s.x,s.y,r.x+u.x,r.y+u.y,s.x,s.y)}else c(this.canvasContext,r.x,r.y,s.x,s.y)}};a.prototype.resetCanvas=function(t){var e=this.canvas,i=this.settings,a=this.canvasContext;this.isCanvasEmulator,e.width,e.height,a.fillStyle=i["background-color"],a.lineWidth=i.lineWidth,a.strokeStyle=i.lineColor,a.lineCap=a.lineJoin="round",a.strokeStyle=i.color,t||(t=[]);var r=this.dataEngine=new n(t,this,u,d,h);return i.data=t,$(e).data(s+".data",t).data(s+".settings",i),r.changed=function(t,e,n){return function(){e.publish(n+".change"),t.trigger("change")}}(this.$parent,this.events,s),r.changed(),!0},a.prototype.initializeCanvas=function(t){var e=document.createElement("canvas"),n=$(e);return t.width===t.height&&"ratio"===t.height&&(t.width="100%"),n.css("margin",0).css("padding",0).css("border","none").css("height","ratio"!==t.height&&t.height?t.height.toString(10):1).css("width","ratio"!==t.width&&t.width?t.width.toString(10):1),n.prependTo(this.$parent.find(".signature")),"ratio"===t.height?n.css("height",Math.round(Math.max(n.width(),2)/t.sizeRatio,1)):"ratio"===t.width&&n.css("width",Math.round(Math.max(n.height(),2)*t.sizeRatio)),n.addClass(s),e.width=n.width(),e.height=n.height(),this.isCanvasEmulator=function(t){if(t.getContext)return!1;if(window.G_vmlCanvasManager)return window.G_vmlCanvasManager.initElement(t),!1;var e=t.ownerDocument.parentWindow,n=e.FlashCanvas?t.ownerDocument.parentWindow.FlashCanvas:"undefined"==typeof FlashCanvas?void 0:FlashCanvas;if(n){t=n.initElement(t);var i=1;if(e&&e.screen&&e.screen.deviceXDPI&&e.screen.logicalXDPI&&(i=1*e.screen.deviceXDPI/e.screen.logicalXDPI),1!==i)try{$(t).children("object").get(0).resize(Math.ceil(t.width*i),Math.ceil(t.height*i)),t.getContext("2d").scale(i,i)}catch(t){}return!0}throw new Error("Canvas element does not support 2d context. jSignature cannot proceed.")}(e),e.onselectstart=function(t){return t&&t.preventDefault&&t.preventDefault(),t&&t.stopPropagation&&t.stopPropagation(),!1},e};!function(t){function e(t,e,n){var i=new Image,a=this;i.onload=function(){a.getContext("2d").drawImage(i,0,0,i.width<a.width?i.width:a.width,i.height<a.height?i.height:a.height)},i.src="data:"+e+","+t}function n(t){return this.find("canvas."+s).add(this.filter("canvas."+s)).data(s+".this").resetCanvas(t),this}function i(t,e){if(e||(e="native"),void 0!==e||"string"!=typeof t||"data:"!==t.substr(0,5)||(e=t.slice(5).split(",")[0])!==(t=t.slice(6+e.length))){var n=this.find("canvas."+s).add(this.filter("canvas."+s));if(!u.hasOwnProperty(e))throw new Error(s+" is unable to find import plugin with for format '"+String(e)+"'");return 0!==n.length&&u[e].call(n[0],t,e,function(t){return function(){return t.resetCanvas.apply(t,arguments)}}(n.data(s+".this"))),this}}var r=new o;!function(t,e,n,i){n(i).bind("resize."+e,(function(){t.publish(e+".parentresized"),n(i).trigger("jSignatureResize")})).bind("mouseup."+e,(function(n){t.publish(e+".windowmouseup")}))}(r,s,$,t);var c={},l={default:function(t){return this.toDataURL()},native:function(t){return t},image:function(t){var e=this.toDataURL();if("string"==typeof e&&e.length>4&&"data:"===e.slice(0,5)&&-1!==e.indexOf(",")){var n=e.indexOf(",");return[e.slice(5,n),e.substr(n+1)]}return[]}},u={native:function(t,e,n){n(t)},image:e,"image/png;base64":e,"image/jpeg;base64":e,"image/jpg;base64":e},d={export:l,import:u,instance:c},h={init:function(t){return this.each((function(){(function(t){var e=!1;for(t=t.parentNode;t&&!e;)e=t.body,t=t.parentNode;return!e})(this)||new a(this,t,c)}))},getSettings:function(){return this.find("canvas."+s).add(this.filter("canvas."+s)).data(s+".this").settings},clear:n,reset:n,addPlugin:function(t,e,n){return d.hasOwnProperty(t)&&(d[t][e]=n),this},listPlugins:function(t){var e=[];if(d.hasOwnProperty(t)){var n=d[t];for(var i in n)n.hasOwnProperty(i)&&e.push(i)}return e},getData:function(t){var e=this.find("canvas."+s).add(this.filter("canvas."+s));return void 0===t&&(t="esep"),0!==e.length&&l.hasOwnProperty(t)?l[t].call(e.get(0),e.data(s+".data")):void 0},importData:i,setData:i,globalEvents:function(){return r},events:function(){return this.find("canvas."+s).add(this.filter("canvas."+s)).data(s+".this").events}};$.fn[s]=function(t){if(!t||"object"==(void 0===t?"undefined":(0,_typeof3.default)(t))){var e=h.init.apply(this,arguments);return e}return"string"==typeof t&&h[t]?h[t].apply(this,Array.prototype.slice.call(arguments,1)):void $.error("Method "+String(t)+" does not exist on jQuery."+s)}}(window)}();var UA=function(t,e){function n(t){return function(){return t.test(i)}}var i=t.navigator&&e.userAgent||"";return{isChrome:n(/webkit\W.*(chrome|chromium)\W/i),isFirefox:n(/mozilla.*\Wfirefox\W/i),isGecko:n(/mozilla(?!.*webkit).*\Wgecko\W/i),isIE:function(){return"Microsoft Internet Explorer"===e.appName}||n(/\bTrident\b/),isKindle:n(/\W(kindle|silk)\W/i),isMobile:n(/(iphone|ipod|((?:android)?.*?mobile)|blackberry|nokia)/i),isOpera:n(/opera.*\Wpresto\W/i),isSafari:n(/webkit\W(?!.*chrome).*safari\W/i),isTablet:function(){return!!n(/(ipad|android(?!.*mobile)|IEMobile)/i)()||!this.isMobile()&&("ontouchstart"in t||e.msMaxTouchPoints)},isTV:n(/googletv|sonydtv/i),isWebKit:n(/webkit\W/i),isAndroid:n(/android/i),isIOS:n(/(ipad|iphone|ipod)/i),isIOS7:n(/(iPad|iPhone);.*CPU.*OS 7_\d/i),isIPad:n(/ipad/i),isIPhone:n(/iphone/i),isIPod:n(/ipod/i),whoami:function(){return i}}}(window,navigator),d,e,f,g;window.SJL||(window.SJL={}),window.SJL.encodings||(window.SJL.encodings={}),SJL.encodings.b64=(d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e=d.split(""),f=/^[A-Za-z0-9+\/]+={0,2}$/,g=String.fromCharCode,{encode:function(t){for(var n,i,a,s,r,o,c,l=[],u=0,d=t.length;d>u;)s=(n=t.charCodeAt(u++))>>2,r=(3&n)<<4|(i=t.charCodeAt(u++))>>4,o=(15&i)<<2|(a=t.charCodeAt(u++))>>6,c=63&a,isNaN(i)?o=c=64:isNaN(a)&&(c=64),l.push(e[s],e[r],e[o],e[c]);return l.join("")},decode:function(t){if(!t)return"";if(!f.test(t))throw new Error("b64.decode input contains invalid character");for(var e,n,i,a,s,r,o=[],c=0,l=t.length;l>c;)e=d.indexOf(t.charAt(c++))<<2|(a=d.indexOf(t.charAt(c++)))>>4,n=(15&a)<<4|(s=d.indexOf(t.charAt(c++)))>>2,i=(3&s)<<6|(r=d.indexOf(t.charAt(c++))),o.push(g(e)),64!==s&&o.push(g(n)),64!==r&&o.push(g(i));return o.join("")}}),window.SJL||(window.SJL={}),window.SJL.encodings||(window.SJL.encodings={}),window.SJL.encodings.capsig=function(t){function e(t){var e,n=(t.x<0?32:0)|(t.y<0?16:0),i=Math.abs(t.x),a=Math.abs(t.y),s=Math.max(i,a);switch(t.up?(15>=s?6:255>=s&&7)||4095>=s&&4||5:(3>=s?1:63>=s&&2)||1023>=s&&3||4095>=s&&4||5){case 1:e=[128|n|i<<2|a];break;case 2:e=[64|n|i>>>2&12|a>>>4&3,i<<4&240|15&a];break;case 3:e=[192|n|i>>>6&12|a>>>8&3,255&i,255&a];break;case 4:e=[4|n|(t.up?0:1),i>>>4&240|a>>>8&15,255&i,255&a];break;case 5:e=[6|n|(t.up?0:1),i>>>8&255,255&i,a>>>8&255,255&a];break;case 6:e=[n,i<<4|a];break;case 7:e=[2|n,i,a];break;default:throw"Packet type could not be determine correctly"}return String.fromCharCode.apply(null,e)}function n(t){for(var n=t.length,i=[];n--;)i.unshift(e(t[n]));return i.join("")}function i(t){var e,n=null,i=t.read(1),a={down:!1,up:!0},s=32&i?-1:1,r=16&i?-1:1;switch(192&i){case 128:n=[(12&i)>>2,3&i,a.down];break;case 64:n=[(12&i)<<2|(240&(e=t.read(1)))>>4,(3&i)<<4|15&e,a.down];break;case 192:n=[(12&i)<<6|t.read(1),(3&i)<<8|t.read(1),a.down];break;default:switch(a=1&i?a.down:a.up,6&i){case 0:n=[(e=t.read(1))>>4,15&e];break;case 2:n=[t.read(1),t.read(1)];break;case 4:n=[(240&(e=t.read(1)))<<4|t.read(1),(15&e)<<8|t.read(1)];break;case 6:n=[t.read(2),t.read(2)]}n.push(a)}return function(t,e,n){var i={x:t,y:e};return!0===n&&(i.up=!0),i}(n[0]*s,n[1]*r,n[2])}return{encode:function(t){var e=n(t.deltas),i=t.deltas.length,a=(t.width,t.height,String.fromCharCode(255&t.width,t.width>>8&255,255&t.height,t.height>>8&255,3,0,3,0,e.length+12&255,e.length+12>>8&255,e.length+12>>16&255,e.length+12>>24&255,3,0,0,0,255&t.width,t.width>>8&255,255&t.height,t.height>>8&255,255&i,i>>8&255,i>>16&255,i>>24&255));return[String.fromCharCode(1,0,0,0),SJL.encodings.md5.encode(a+e,!1),a,e].join("")},decode:function(t){var e=t.split("").slice(36).map((function(t){return t.charCodeAt()}));e.read=function(t,e){for(var n=0,i=0,a=t-1;t--;)i=e?a-t:t,n|=this.shift()<<8*i;return n};var n={width:e.read(2,!0),height:e.read(2,!0),deltas:[]};return e.read(4,!0),n.deltas=function(t){for(var e=t.length,n=[];t.length&&e--;)n.push(i(t));return n}(e),n}}}(),window.SJL||(window.SJL={}),window.SJL.encodings||(window.SJL.encodings={}),window.SJL.encodings.hex=function(){function t(t){return(1===t.length?"0":"")+t}var e=/^([0-9a-f]{2})+$/;return{encode:function(e){for(var n=e.length,i=[];n--;)i[n]=t(e.charCodeAt(n).toString(16));return i.join("")},decode:function(t){if(!t)return"";if(!e.test(t))throw new Error("Invalid hexadecimal string: "+t);for(var n=[],i=t.length;i--;)n.unshift(String.fromCharCode(parseInt(t.substr(--i,2),16)));return n.join("")}}}(),window.SJL||(window.SJL={}),window.SJL.encodings||(window.SJL.encodings={}),SJL.encodings.md5=function(){function t(t){return function(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e}(function(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var o,c,l,u,d=1732584193,h=-271733879,f=-1732584194,p=271733878,g=0,m=t.length;m>g;g+=16)o=d,c=h,l=f,u=p,d=n(d,h,f,p,t[g+0],7,-680876936),p=n(p,d,h,f,t[g+1],12,-389564586),f=n(f,p,d,h,t[g+2],17,606105819),h=n(h,f,p,d,t[g+3],22,-1044525330),d=n(d,h,f,p,t[g+4],7,-176418897),p=n(p,d,h,f,t[g+5],12,1200080426),f=n(f,p,d,h,t[g+6],17,-1473231341),h=n(h,f,p,d,t[g+7],22,-45705983),d=n(d,h,f,p,t[g+8],7,1770035416),p=n(p,d,h,f,t[g+9],12,-1958414417),f=n(f,p,d,h,t[g+10],17,-42063),h=n(h,f,p,d,t[g+11],22,-1990404162),d=n(d,h,f,p,t[g+12],7,1804603682),p=n(p,d,h,f,t[g+13],12,-40341101),f=n(f,p,d,h,t[g+14],17,-1502002290),h=n(h,f,p,d,t[g+15],22,1236535329),d=i(d,h,f,p,t[g+1],5,-165796510),p=i(p,d,h,f,t[g+6],9,-1069501632),f=i(f,p,d,h,t[g+11],14,643717713),h=i(h,f,p,d,t[g+0],20,-373897302),d=i(d,h,f,p,t[g+5],5,-701558691),p=i(p,d,h,f,t[g+10],9,38016083),f=i(f,p,d,h,t[g+15],14,-660478335),h=i(h,f,p,d,t[g+4],20,-405537848),d=i(d,h,f,p,t[g+9],5,568446438),p=i(p,d,h,f,t[g+14],9,-1019803690),f=i(f,p,d,h,t[g+3],14,-187363961),h=i(h,f,p,d,t[g+8],20,1163531501),d=i(d,h,f,p,t[g+13],5,-1444681467),p=i(p,d,h,f,t[g+2],9,-51403784),f=i(f,p,d,h,t[g+7],14,1735328473),h=i(h,f,p,d,t[g+12],20,-1926607734),d=a(d,h,f,p,t[g+5],4,-378558),p=a(p,d,h,f,t[g+8],11,-2022574463),f=a(f,p,d,h,t[g+11],16,1839030562),h=a(h,f,p,d,t[g+14],23,-35309556),d=a(d,h,f,p,t[g+1],4,-1530992060),p=a(p,d,h,f,t[g+4],11,1272893353),f=a(f,p,d,h,t[g+7],16,-155497632),h=a(h,f,p,d,t[g+10],23,-1094730640),d=a(d,h,f,p,t[g+13],4,681279174),p=a(p,d,h,f,t[g+0],11,-358537222),f=a(f,p,d,h,t[g+3],16,-722521979),h=a(h,f,p,d,t[g+6],23,76029189),d=a(d,h,f,p,t[g+9],4,-640364487),p=a(p,d,h,f,t[g+12],11,-421815835),f=a(f,p,d,h,t[g+15],16,530742520),h=a(h,f,p,d,t[g+2],23,-995338651),d=s(d,h,f,p,t[g+0],6,-198630844),p=s(p,d,h,f,t[g+7],10,1126891415),f=s(f,p,d,h,t[g+14],15,-1416354905),h=s(h,f,p,d,t[g+5],21,-57434055),d=s(d,h,f,p,t[g+12],6,1700485571),p=s(p,d,h,f,t[g+3],10,-1894986606),f=s(f,p,d,h,t[g+10],15,-1051523),h=s(h,f,p,d,t[g+1],21,-2054922799),d=s(d,h,f,p,t[g+8],6,1873313359),p=s(p,d,h,f,t[g+15],10,-30611744),f=s(f,p,d,h,t[g+6],15,-1560198380),h=s(h,f,p,d,t[g+13],21,1309151649),d=s(d,h,f,p,t[g+4],6,-145523070),p=s(p,d,h,f,t[g+11],10,-1120210379),f=s(f,p,d,h,t[g+2],15,718787259),h=s(h,f,p,d,t[g+9],21,-343485551),d=r(d,o),h=r(h,c),f=r(f,l),p=r(p,u);return[d,h,f,p]}(function(t){for(var e=Array(t.length>>2),n=0;n<e.length;n++)e[n]=0;for(n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e}(t),8*t.length))}function e(t,e,n,i,a,s){return r(function(t,e){return t<<e|t>>>32-e}(r(r(e,t),r(i,s)),a),n)}function n(t,n,i,a,s,r,o){return e(n&i|~n&a,t,n,s,r,o)}function i(t,n,i,a,s,r,o){return e(n&a|i&~a,t,n,s,r,o)}function a(t,n,i,a,s,r,o){return e(n^i^a,t,n,s,r,o)}function s(t,n,i,a,s,r,o){return e(i^(n|~a),t,n,s,r,o)}function r(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}var o=SJL.encodings.hex.encode;return{encode:function(e,n){var i=t(e);return!1!==n?o(i):i}}}(),function(t){var e,n,i,a,s,r,o,c,l,u,d,h=null,f=!1,p=[],g=null,m=!1,_=!1,v=null,S=null,T=!1,y=!1,E=!1,A=0,b=0,C=0,$={texts:{header:"Header",undo:"Undo",clear:"Clear",submit:"Submit",cancel:"Cancel",cancelMessage:"Are you sure you would like to cancel the transaction?",yes:"Yes",no:"No",signatureLineText:"Click here to launch signature capture widget."},ratio:3,minDimension:{width:400,height:300},maxDimension:{width:900,height:630},lineWidth:2,signatureLineTextFontSize:10,signatureLineTextFont:"Georgia",signatureLineTextColor:"blue",signatureLineWidth:2,color:"#002888",lineColor:"#d8deeb",showUndo:!1,minArcLength:20,disableButtonMode:!0,data:[],disableCancelMessage:!1,onInit:function(){},onClear:function(){},onSubmit:function(){},onCancel:function(){},dialog:{texts:{signatureLineText:"Feel free to try this a few times until you are comfortable with your signature."}}},N=function(t,e,n){for(var i={width:e,height:n,deltas:[]},a=i.deltas,s={x:0,y:0},r=0,o=t.length;o>r;r++)for(var c=t[r],l=0,u=c.x.length;u>l;l++){var d={x:c.x[l],y:c.y[l]},h={x:c.x[l]-s.x,y:c.y[l]-s.y};0===l&&(h.up=!0),a.push(h),s=d}return i},O=function(t,e,n){var i=t.deltas,a=e/t.width;a*t.height>n&&(a=n/t.height);for(var s=(e-a*t.width)/2,r=(n-a*t.height)/2,o=[],c=null,l={x:0,y:0},u=0,d=i.length;d>u;u++){var h=i[u];h.up&&(c=null),c||(c={x:[],y:[]},o.push(c)),l.x+=h.x,l.y+=h.y,c.x.push(l.x*a+s),c.y.push(l.y*a+r)}return o},I=function(t,e,n,i,a){var s={width:t.width(),height:t.height()},r=t.find("canvas")[0];if(r){var o=r.getContext("2d");o.beginPath(),o.lineWidth=n.signatureLineWidth;var c=n.texts.signatureLineText,l=o.measureText&&c;if(l){var u=n.signatureLineTextFontSize;o.font=n.signatureLineTextFontSize+"px "+n.signatureLineTextFont;var d=o.measureText(c)}if(0==a){if(i){if(o.moveTo(e[0].line.x[0],.05*s.width),o.lineTo(e[0].line.x[1],.95*s.height),l){var h=(s.height-d.width)/2,f=e[0].line.x[0]+o.lineWidth/2+u;o.save(),o.rotate(-Math.PI/2),o.fillStyle=n.signatureLineTextColor,o.fillText(c,-h-d.width,f-0),o.restore()}}else if(o.moveTo(.05*s.width,e[0].line.y[0]),o.lineTo(.95*s.width,e[0].line.y[1]),l){var p=s.height,g=.2*s.height;o.save(),o.fillStyle=n.signatureLineTextColor,o.fillText(c,(s.width-d.width)/2,e[0].line.y[1]+o.lineWidth/2+u),o.restore()}}else if(o.moveTo(.05*s.width,.8*s.height),o.lineTo(.95*s.width,.8*s.height),l){var m=s.width;p=s.height,g=.2*s.height;o.save(),o.fillStyle=n.signatureLineTextColor,o.fillText(c,(m-d.width)/2,p-g+o.lineWidth/2+u),o.restore()}o.strokeStyle=n.lineColor,o.stroke(),o.lineWidth=n.lineWidth,o.strokeStyle=n.color}},w=function(t,e,n){if(n)var i=[{line:{x:[.8*e,.8*e],y:[.05*t,.95*t]}}];else i=[{line:{x:[.05*t,.95*t],y:[.8*e,.8*e]}}];return i},P=function(t,e,n){for(var i=0;i<t.length;i++)for(var a=t[i],s=0;s<a.x.length;s++){var r=a.x[s];n?(a.x[s]=a.y[s],a.y[s]=e.width-r):(a.x[s]=e.width-a.y[s],a.y[s]=r)}};t.capsig=function(O,M){var R=function(t,e){initialCapsigDim||(0!=A?t/d.ratio>e?initialCapsigDim={width:t,height:t/d.ratio}:initialCapsigDim={width:e*d.ratio,height:e}:initialCapsigDim={width:t,height:e},v={x:0,y:0},g=null,S={width:t,height:e},D(t,e))},D=function(t,e){h||(h=w(t,e,m))},L=function(t,e){if(0==A){if(g)S.width,g.width,S.height,g.height;else({x:0,y:0});for(var n=!1,i=0;i<p.length;i++){for(var a=p[i],s=0;s<a.x.length;s++)if(_){if(a.x[s]<v.y){n=!0;break}if(a.y[s]<v.x){n=!0;break}if(a.x[s]>v.y+g.height){n=!0;break}if(a.y[s]>v.x+g.width){n=!0;break}}else{if(a.x[s]<v.x){n=!0;break}if(a.y[s]<v.y){n=!0;break}if(a.x[s]>v.x+g.width){n=!0;break}if(a.y[s]>v.y+g.height){n=!0;break}}if(n)break}n&&(initialCapsigDim=null,R(S.width,S.height),g=S)}return k(t,e)},k=function(t,e){return e/t>initialCapsigDim.height/initialCapsigDim.width?{width:t,height:t*initialCapsigDim.height/initialCapsigDim.width}:{width:e*initialCapsigDim.width/initialCapsigDim.height,height:e}},B=function(t){0==A&&g&&(P(p,t,m),P([h[0].line],t,m),tl=g.height,g.height=g.width,g.width=tl)},U=function(t,e){if(g)if(0==A){for(var n={x:(t.width-e.width)/2,y:(t.height-e.height)/2},i=e.width/g.width,a=0;a<p.length;a++)for(var s=p[a],r=0;r<s.x.length;r++)_?(s.x[r]=(s.x[r]-v.y)*i+n.y,s.y[r]=(s.y[r]-v.x)*i+n.x):(s.x[r]=(s.x[r]-v.x)*i+n.x,s.y[r]=(s.y[r]-v.y)*i+n.y);for(r=0;2>r;r++)_?(h[0].line.x[r]=(h[0].line.x[r]-v.y)*i+n.y,h[0].line.y[r]=(h[0].line.y[r]-v.x)*i+n.x):(h[0].line.x[r]=(h[0].line.x[r]-v.x)*i+n.x,h[0].line.y[r]=(h[0].line.y[r]-v.y)*i+n.y);v=n}else{i=e.width/g.width;for(a=0;a<p.length;a++)for(s=p[a],r=0;r<s.x.length;r++)s.x[r]=s.x[r]*i,s.y[r]=s.y[r]*i}},F=0,x=0,Y=0,G=function(t,e){var n;return n=Y,1>t?n|=1:t>F&&(n|=2),1>e?n|=4:e>x&&(n|=8),n},V=function(t,e,n,i){for(var a=G(t,e),s=G(n,i),r=!1;;){if(!(a|s)){r=!0;break}if(a&s)break;var o,c,l=a||s;8&l?(o=t+(n-t)*(x-e)/(i-e),c=x):4&l?(o=t+(n-t)*(1-e)/(i-e),c=1):2&l?(c=e+(i-e)*(F-t)/(n-t),o=F):1&l&&(c=e+(i-e)*(1-t)/(n-t),o=1),l==a?a=G(t=o,e=c):s=G(n=o,i=c)}return r?{x0:t,y0:e,x1:n,y1:i}:null},q=function(){var s=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;t(window).width()<s&&(UA.isMobile()||UA.isAndroid()||(o=t(window).height(),s=t(window).width()));var c=s,l=o,h={width:c-(parseInt(e.css("border-left-width"),10)||0)-(parseInt(e.css("border-right-width"),10)||0)-parseInt(e.css("padding-left"),10)-parseInt(e.css("padding-right"),10),height:l-(parseInt(e.css("border-top-width"),10)||0)-(parseInt(e.css("border-bottom-width"),10)||0)-parseInt(e.css("padding-top"),10)-parseInt(e.css("padding-bottom"),10)},v={width:i.width(),height:i.height()},y=0,E=0;if(u.width!==c||u.height!==l){if(_=m,0==A){if(e.width(h.width).height(h.height).css("position","fixed"),h.height>h.width){if(m=!0,n.width(h.height).css("top",h.height+"px").rotate({angle:-90,center:["0%","0%"]}),a.css("position","absolute").css("bottom","").css("top",h.height+parseInt(e.css("padding-left"),10)+"px").css("left",h.width-a.height()+parseInt(e.css("padding-left"),10)+"px").width(h.height).rotate({angle:-90,center:["0%","0%"]}),!f){y=h.width-n.outerHeight(!0)-a.outerHeight(!0),E=h.height,R(E,y);var b=L(E,y);i.css("position","absolute").css("top",parseInt(e.css("border-left-width"),10)+parseInt(e.css("padding-left"),10)+"px").css("left",parseInt(e.css("border-top-width"),10)+parseInt(e.css("padding-top"),10)+n.outerHeight(!0)+"px").css("width",y+"px").css("height",E+"px")}}else if(m=!1,n.width(h.width).css("top","0").rotate(0),a.css("position","absolute").css("top","").css("bottom",parseInt(e.css("padding-bottom"),10)+"px").css("left",parseInt(e.css("padding-left"),10)+"px").width(h.width).rotate(0),!f){y=h.height-n.outerHeight(!0)-a.outerHeight(!0),E=h.width,R(E,y);b=L(E,y);i.css("position","absolute").css("top",(parseInt(e.css("border-top-width"),10)||0)+parseInt(e.css("padding-top"),10)+n.outerHeight(!0)+"px").css("left",(parseInt(e.css("border-left-width"),10)||0)+parseInt(e.css("padding-left"),10)+"px").css("width",E+"px").css("height",y+"px")}}else if(m=!1,h={width:Math.max(Math.min(h.width,d.maxDimension.width),d.minDimension.width),height:Math.max(Math.min(h.height,d.maxDimension.height),d.minDimension.height)},e.css("width",h.width+"px"),e.css("height",h.height+"px"),n.width(h.width).css("top","0px").rotate(0),a.css("position","absolute").css("top","").css("bottom",parseInt(e.css("padding-bottom"),10)+"px").css("left",parseInt(e.css("padding-left"),10)+"px").width(h.width).rotate(0),!f){y=h.height-n.outerHeight(!0)-a.outerHeight(!0),E=h.width,R(E,y);b=L(E,y);h.height=b.height+n.outerHeight(!0)+a.outerHeight(!0),window.innerWidth>b.width&&(h.width=b.width,n.width(h.width),a.width(h.width)),i.css("position","absolute").css("top",(parseInt(e.css("border-top-width"),10)||0)+parseInt(e.css("padding-top"),10)+n.outerHeight(!0)+"px").css("left",(parseInt(e.css("border-left-width"),10)||0)+parseInt(e.css("padding-left"),10)+"px").css("width",b.width+"px").css("height",b.height+"px"),e.width(h.width).height(h.height),UA.isMobile()&&!UA.isTablet()?e.css("bottom","0px").css("left","0px"):e.css("top",(o-e.height())/2-((parseInt(e.css("border-top-width"),10)||0)+parseInt(e.css("padding-top"),10))+"px").css("left",(s-e.width())/2-((parseInt(e.css("border-left-width"),10)||0)+parseInt(e.css("padding-left"),10))+"px")}if(!f){if(g&&(p=i.jSignature("getData","native"),i.html("")),function(t){var e=[];F=t.width,x=t.height;for(var n=0;n<p.length;n++){var i=p[n];if(0==i.x.length);else if(1==i.x.length)G(i.x[0],i.y[0])==Y&&e.push({x:[i.x[0]],y:[i.y[0]]});else for(var a={x:i.x[0],y:i.y[0]},s=!0,r=1;r<i.x.length;r++){var o={x:i.x[r],y:i.y[r]},c=V(a.x,a.y,o.x,o.y);if(null===c)s=!0;else{var l=c.x0==a.x&&c.y0==a.y;c.x1==o.x&&c.y1,s?(s=!1,e.push({x:[c.x0,c.x1],y:[c.y0,c.y1]})):(e[e.length-1].x.push(c.x1),e[e.length-1].y.push(c.y1)),s=!l}a=o}}p=e}(v),U({width:E,height:y},b),_!=m&&B({width:E,height:y}),J(),i.jSignature("setData",p,"native"),T&&UA.isAndroid()&&UA.isTablet()){t("img.canvas").remove();var C=new Image;C.src=i.find("canvas")[0].toDataURL("image/png"),C.className="canvas",t(C).attr("style",i.attr("style")),T=!0,i.after(C),i.hide()}g=b}u={width:c,height:l},X(),UA.isAndroid()&&UA.isMobile()&&!UA.isTablet()&&(setTimeout((function(){X()}),100),setTimeout((function(){X()}),1e3),setTimeout((function(){X()}),2e3),setTimeout((function(){X()}),3e3)),r.width(s).height(o),S={width:E,height:y}}},H=function(){q(),setTimeout((function(){q()}),300),setTimeout((function(){UA.isIPhone()&&(t(window).scrollTop(),t(window).scrollTop(-1)),q()}),1e3)},W=function(t){for(var e=i.jSignature("getData","native"),n=0,a=0;a<e.length;a++){var s=e[a],r=[s.x[0],s.y[0]];if(s.x.length<=1)n+=1;else for(var o=1;o<s.x.length;o++){var c=r[0]-s.x[o],l=r[1]-s.y[o];r=[s.x[o],s.y[o]],n+=Math.sqrt(c*c+l*l)}if(n>=t)return!0}return!1},j=function(){y=!1,E=!1,initialCapsigDim=null,h=null,m?R(i.height(),i.width()):R(i.width(),i.height()),d.data=[],J(),g=S,d.onClear&&d.onClear()},K=function(){y=!1,E=!1,p=i.jSignature("getData","native"),i.signature("destroy"),p.splice(p.length-1),J(),i.signature("draw",p),d.onUndo&&d.onUndo()},z=function(){d.onSubmit&&d.onSubmit(),it()},Q=0,X=function(){if(o){if(UA.isAndroid()&&0==A){var n=t(".blockMsg h2").html();t(".blockMsg h2").html(n+Q),t(".blockMsg h2").html(n),Q++}var i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;t(window).width()<i&&(UA.isMobile()||UA.isAndroid()||(a=document.body.clientHeight,i=t(window).width()));var s=i,r=a,c={width:s-parseInt(e.css("border-left-width"),10)-parseInt(e.css("border-right-width"),10)-parseInt(e.css("padding-left"),10)-parseInt(e.css("padding-right"),10),height:r-parseInt(e.css("border-top-width"),10)-parseInt(e.css("border-bottom-width"),10)-parseInt(e.css("padding-top"),10)-parseInt(e.css("padding-bottom"),10)};c.height>c.width&&0==A?o.css("position","absolute").width(.4*r).css("top",(r-o.outerHeight(!0))/2+"px").css("left",(s-o.outerWidth(!0))/2+"px").rotate({angle:-90,center:["50%","50%"]}):(0!=A&&(c={width:Math.max(Math.min(c.width,d.maxDimension.width),d.minDimension.width),height:Math.max(Math.min(c.height,d.maxDimension.height),d.minDimension.height)}),o.css("position","absolute").width(.4*e.width()).css("top",(e.outerHeight(!0)-o.outerHeight(!0))/2+"px").css("left",(e.outerWidth(!0)-o.outerWidth(!0))/2+"px").rotate({angle:0}))}},J=function(){var e=t.extend({},d);e.width=i.width(),e.height=i.height(),i.html(""),i.jSignature(e).change((function(){d.disableButtonMode?E||(W(d.minArcLength)?($capsigSubmit.button({disabled:!1}),E=!0):$capsigSubmit.button({disabled:!0}),y||(W(0)?(c.button({disabled:!1}),l.button({disabled:!1}),y=!0):(c.button({disabled:!0}),l.button({disabled:!0})))):E||(W(d.minArcLength)?($capsigSubmit.show(),E=!0):$capsigSubmit.hide(),y||(W(0)?(c.show(),l.show(),y=!0):(c.hide(),l.hide())))})),I(i,h,d,m,A)},Z=function(){o.remove(),s.remove(),o=null,s=null},tt=function(){e.remove(),r&&r.remove()},et=function(){d.disableCancelMessage?(tt(),t(window).scrollTop(b),t(window).scrollLeft(C),d.onCancel&&d.onCancel(),it()):(e.find('input[type="button"]').attr("disabled","disabled"),e.append('<div class="overlay"></div><div class="blockMsg"><h2>'+d.texts.cancelMessage+'</h2><input type="button" class="sigcancelyes" value="'+d.texts.yes+'" /><input type="button" class="sigcancelno" value="'+d.texts.no+'" /></div>'),s=e.find(".overlay"),o=e.find(".blockMsg"),X(),(UA.isAndroid()||UA.isIPhone())&&(setTimeout((function(){X()}),100),setTimeout((function(){X()}),1e3),setTimeout((function(){X()}),2e3),setTimeout((function(){X()}),3e3)),e.find(".sigcancelno").click((function(){e.find('input[type="button"]').removeAttr("disabled"),Z(),UA.isAndroid()&&UA.isTablet()&&(i.show(),T=!1,u={width:0,height:0},t("img.canvas").remove(),i.show(),H())})).button(),e.find(".sigcancelyes").click((function(){e.find('input[type="button"]').removeAttr("disabled"),Z(),T=!1,tt(),t(window).scrollTop(b),t(window).scrollLeft(C),d.onCancel&&d.onCancel(),it()})).button(),UA.isAndroid()&&UA.isTablet()&&(u={width:0,height:0},T=!0,i.hide()))},nt=function(e){return t(['<div class="capsig">','   <div class="title">',"      "+e.texts.header,"   </div>",'   <div class="canvas"></div>','   <div class="button-container clearfix">','      <div class="panel leftpanel">',"         "+(e.showUndo?'<button class="undo">'+e.texts.undo+"</button>":""),'         <button class="clear">'+e.texts.clear+"</button>","      </div>",'      <div class="panel rightpanel">','         <button class="submit">'+e.texts.submit+"</button>",'         <button class="cancel">'+e.texts.cancel+"</button>","      </div>","   </div>","</div>"].join(""))},it=function(){t(window).unbind("scroll",H).unbind("resize",H)};if("destroy"===O)it();else{if("data"===O)return function(){var t=i.width(),e=i.height(),n=i.jSignature("getData","native");if(m){p=n,m=!1,B({width:e,height:t}),m=!0,n=p;var a=t;t=e,e=a}var s=["2_0_0_"];s.push(t),s.push("_"),s.push(e);for(var r=0;r<n.length;r++){var o=n[r];s.push("!");for(var c=0;c<o.x.length;c++)0!=c&&s.push("_"),s.push(Math.round(o.x[c])),s.push("_"),s.push(Math.round(o.y[c]));s.push("'")}return s.join("")}();if("scaleLines"===O)return function(t,e,n){var i=e.width/e.height,a=n.width/n.height,s=0,r=0;i>a?(a=e.height/n.height,s=(e.width-n.width*a)/2,r=0):(a=e.width/n.width,s=0,r=(e.height-n.height*a)/2);for(var o=0;o<t.length;o++)for(var c=t[o],l=0;l<c.x.length;l++)c.x[l]=Math.round(c.x[l]*a+s),c.y[l]=Math.round(c.y[l]*a+r)}(M[0],M[1],M[2]);if("jSignatureData"===O)return function(){var t=i.width(),e=i.height();return i.jSignature("getData","native"),{width:t,height:e,lines:i.jSignature("getData","native")}}();if("eSignLiveData"===O)return function(){var t=i.width(),e=i.height(),n=i.jSignature("getData","native");return SJL.encodings.b64.encode(SJL.encodings.capsig.encode(N(n,t,e)))}();if("remove"===O)tt();else{if("isRotated"===O)return m;!function(s){d=t.extend(!0,{},$,s),u={width:0,height:0},initialCapsigDim=null,f=!1,p=[],g=null,m=!1,h=null,y=!1,E=!1,A=UA.isMobile()&&!UA.isTablet()?0:1,e=(s.customPopUpHtmlTemp||nt)(d),t("body").append(e),e.bind("touchmove",(function(t){t.preventDefault()})),e.find("button").button(),n=e.find(".title"),i=e.find(".canvas"),a=e.find(".button-container"),l=e.find(".clear").click(j),c=e.find(".undo").click(K),e.find(".cancel").click(et),$capsigSubmit=e.find(".submit").click(z),d.disableButtonMode?($capsigSubmit.button({disabled:!0}),c.button({disabled:!0}),l.button({disabled:!0})):($capsigSubmit.hide(),c.hide(),l.hide()),t("body").append('<div class="capsig-overlay"></div>'),(r=t(".capsig-overlay").bind("touchmove",(function(t){t.preventDefault()}))).width(t(document).width()).height(t(document).height()),f=!0,H(),setTimeout((function(){f=!1,u={width:0,height:0},H()}),0),t(window).scroll(H).resize(H).bind("orientationchange",(function(){H(),setTimeout((function(){X()}),4e3)})),b=t(window).scrollTop(),C=t(window).scrollLeft(),0==A&&(setTimeout((function(){t(window).scrollTop(0),setTimeout((function(){t(window).scrollLeft(0)}),100)}),100),t(".capsig-overlay").remove()),d.onInit&&d.onInit()}(O)}}},t.widget("custom.capsig",{_create:function(){var e=this,n=t(e.element);e.options=t.extend(!0,{},$,e.options);var i=e.options;i.dialog=t.extend(!0,{},i,i.dialog);var a=i.onSubmit;i.onSubmit=function(){var e=t.capsig("jSignatureData");if(t.capsig("isRotated")){P(e.lines,{width:e.height,height:e.width},!1);var i=e.width;e.width=e.height,e.height=i}if(t.capsig("scaleLines",[e.lines,{width:n.width(),height:n.height()},{width:e.width,height:e.height}]),e.width=n.width(),e.height=n.height(),n.html("").jSignature(s),I(n,w(n.width(),n.height(),!1),s,!1,1),n.jSignature("setData",e.lines),a){var r=t.capsig("eSignLiveData");a(r)||(t.capsig("remove"),t.capsig("destroy"))}},i.dialog.onSubmit=i.onSubmit;var s=t.extend({},i);s.disabled=!0,s.width=n.width(),s.height=n.height(),s.disabled=!0!==i.signInPlace||i.disabled,n.click((function(){!0===i.signInPlace||i.disabled||t.capsig(i.dialog)})).jSignature(s),I(n,w(s.width,s.height,!1),s,!1,1)},clear:function(){var e=this,n=t(e.element);e.options.data=[];var i=t.extend({},e.options);i.width=n.width(),i.height=n.height(),i.disabled=!0!==e.options.signInPlace||e.options.disabled,n.html("").jSignature(i),I(n,w(i.width,i.height,!1),i,!1,1)},getSignature:function(e){var n=this,i=t(n.element).width(),a=t(n.element).height(),s=t(n.element).jSignature("getData","native");if("native"===e)return N(s,i,a);for(var r=new Array(s.length),o=0;o<s.length;o++){r[o]={x:new Array(s[o].x.length),y:new Array(s[o].y.length)};for(var c=0;c<s[o].x.length;c++)r[o].x[c]=Math.round(s[o].x[c]),r[o].y[c]=Math.round(s[o].y[c])}return SJL.encodings.b64.encode(SJL.encodings.capsig.encode(N(r,i,a)))},setSignature:function(e,n){var i=this,a=t(i.element),s=null;s=O("native"===n?e:SJL.encodings.capsig.decode(SJL.encodings.b64.decode(e)),a.width(),a.height());a=t(i.element);var r=t.extend({},i.options);r.width=a.width(),r.height=a.height(),r.disabled=!0!==i.options.signInPlace||i.options.disabled,a.html("").jSignature(r),I(a,w(r.width,r.height,!1),r,!1,1),a.jSignature("setData",s)},disable:function(t){var e=this;e.options.disabled=t,e.options.signInPlace&&e.setSignature(e.getSignature())},_destroy:function(){t(this.element).unbind("click")}})}(jQuery)}).call(this,__webpack_require__(93),__webpack_require__(93))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(8)),a=l(n(0)),s=l(n(2)),r=l(n(529)),o=l(n(143)),c=l(n(116));function l(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(e,n,s,r,o,c,l,u){(0,a.default)(this,t),(0,i.default)(this,{$log:e,RequesterService:n,customerConstants:s,accountConstants:r,serviceConstants:o,cardsConstants:c,AccountDetailsService:l,$q:u}),this.STATUS_CODES=o.STATUS_CODES}return(0,s.default)(t,[{key:"createCardModelFromAccountDetails",value:function(t){var e=t.account_summary.credit_card.cc_account_details;return{number:e.card_details.card_number,previousNumber:e.card_details.previous_card_number,displayName:e.card_details.card_number_display_name,previousDisplayName:e.card_details.previousCardDisplayNumber,authorizedUsers:e.authorized_users,accountNumber:t.account_summary.account_number,reissue:(0,c.default)(e,"card_details.reissue"),activateReplacement:(0,c.default)(e,"card_details.activate_replacement"),forceReissueWindow:(0,c.default)(e,"card_details.within_force_reissue_window"),productChanged:(0,c.default)(e,"card_details.productChanged"),productType:(0,c.default)(e,"product_info.product_type"),description:this.AccountDetailsService.getCCAccountNameByProductType((0,c.default)(e,"product_info.product_type"))}}},{key:"extractCreditCards",value:function(t){return this._extractCards(t,this.customerConstants.API.CARD.TYPE.CREDIT.KEY)}},{key:"extractDebitCards",value:function(t){return this._extractCards(t,this.customerConstants.API.CARD.TYPE.DEBIT.KEY)}},{key:"getCardChequingAccount",value:function(t){return this._getCardLinkedAccount(t,this.accountConstants.ACCOUNT_TYPES.CHEQUING)}},{key:"getCardSavingsAccount",value:function(t){return this._getCardLinkedAccount(t,this.accountConstants.ACCOUNT_TYPES.SAVINGS)}},{key:"getCardOtherAccount",value:function(t){return this._getCardLinkedAccount(t,this.accountConstants.ACCOUNT_TYPES.OTHER)}},{key:"replaceDebitCard",value:function(t,e,n){var i={number:t,orderType:e,hash_account_number:n};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.REPLACE_CUSTOMER_CARDS,{data:i})}},{key:"saveDebitAccounts",value:function(t,e){var n=[];e.chequing&&n.push({type:this.accountConstants.ACCOUNT_TYPES.CHEQUING,account_number:e.chequing.account_number}),e.savings&&n.push({type:this.accountConstants.ACCOUNT_TYPES.SAVINGS,account_number:e.savings.account_number}),e.other&&n.push({type:this.accountConstants.ACCOUNT_TYPES.OTHER,account_number:e.other.account_number});var i={number:t.number,linked_accounts:n};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.PUT_CUSTOMER_CARDS,{data:i})}},{key:"getValidChequingAccounts",value:function(t){return this._getAvailableDebitAccounts(t,this.accountConstants.ACCOUNT_TYPES.CHEQUING)}},{key:"getValidSavingsAccounts",value:function(t){return this._getAvailableDebitAccounts(t,this.accountConstants.ACCOUNT_TYPES.SAVINGS)}},{key:"getValidOtherAccounts",value:function(t){return this._getAvailableDebitAccounts(t,this.accountConstants.ACCOUNT_TYPES.OTHER)}},{key:"pauseCard",value:function(t){var e={id:t.number},n={action_code:this.cardsConstants.CARDS_API_ACTIONS.UPDATE_STATUS,credit_card_status_type:this.cardsConstants.UPDATE_CC_STATUS_TYPE.SUSPEND};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UPDATE_CARD,{urlVars:e,data:n})}},{key:"changeCardPin",value:function(t,e,n){var i={id:t.number},a={action_code:this.cardsConstants.CARDS_API_ACTIONS.UPDATE_PIN,cvc2:e,pin:n};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UPDATE_CARD,{urlVars:i,data:a})}},{key:"activateDebitCard",value:function(t,e){var n={id:t.number},i={action_code:this.cardsConstants.CARDS_API_ACTIONS.ACTIVATE,last_digits_on_card:e};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UPDATE_CARD,{urlVars:n,data:i})}},{key:"activateCard",value:function(t,e,n){var i=this,a={id:t.number},s={action_code:this.cardsConstants.CARDS_API_ACTIONS.ACTIVATE,cvc2:e};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UPDATE_CARD,{urlVars:a,data:s}).then((function(t){if(t&&t.response_status.status_code===i.STATUS_CODES.SUCCESS&&n){var s={action_code:i.cardsConstants.CARDS_API_ACTIONS.UPDATE_PIN,cvc2:e,pin:n};return i.RequesterService.request(i.serviceConstants.AVAILABLE_SERVICES.UPDATE_CARD,{urlVars:a,data:s}).then((function(t){return t&&t.response_status.status_code===i.STATUS_CODES.SUCCESS?t:i.$q.reject()})).catch((function(){return i.$q.reject("global.modals.activateCreditDialog.errors.pinFailed")}))}return t}))}},{key:"activateReplacementCard",value:function(t,e){var n={id:t.number},i={action_code:this.cardsConstants.CARDS_API_ACTIONS.ACTIVATE,cvc2:e};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UPDATE_CARD,{urlVars:n,data:i})}},{key:"reactivateCard",value:function(t,e){var n={id:t.number},i={action_code:this.cardsConstants.CARDS_API_ACTIONS.UPDATE_STATUS,credit_card_status_type:this.cardsConstants.UPDATE_CC_STATUS_TYPE.REACTIVATE,cvc2:e};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UPDATE_CARD,{urlVars:n,data:i})}},{key:"creditLimitIncreaseRequest",value:function(t){var e={accountHash:t.card_number};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.CREDIT_LIMIT_INCREASE_REQUEST,{urlVars:e})}},{key:"updateCardLimit",value:function(t,e,n,i){var a={accountHash:t.card_number},s={cc_creditLimit_current:e,cc_creditLimit_new:n};return void 0!==i&&(s.express_consent=i),this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UPDATE_CREDIT_CARD_LIMIT,{urlVars:a,data:s})}},{key:"updateLoanCardLimit",value:function(t,e){var n={accountHash:t.accountHash},i={new_creditlimit:e,confirmation_preference:"EMAIL"};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UPDATE_LOAN_CREDIT_CARD_LIMIT,{urlVars:n,data:i})}},{key:"getAuthorizedUsers",value:function(t){var e={urlVars:{accountHash:t}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_AUTHORIZED_USERS,e)}},{key:"updateCCEmploymentInformation",value:function(t,e){var n={employment_sequence:e.employment_sequence,income_deal_id:e.income_deal_id,income_sequence:e.income_sequence,employment_status:e.employmentStatus.code.code,employer_name:e.employerName,annual_income:e.annualIncome};e.employmentStatus&&e.employmentStatus.require_employment_details&&e.employmentOccupation&&(n.industry_occupation=e.employmentOccupation.code);var i={data:{credit_card_emp_details:n,credit_card_action_code:this.cardsConstants.CARDS_API_ACTIONS.UPDATE_EMPLOYMENT},urlVars:{accountHash:t.card_number}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UPDATE_CC_EMPLOYMENT_INFORMATION,i)}},{key:"_getAvailableDebitAccounts",value:function(t,e){if(t&&t.valid_debit_accounts){var n=(0,o.default)(t.valid_debit_accounts,{type:e});return n&&n.account_numbers?n.account_numbers.map((function(t){return{account_number:t}})):[]}}},{key:"_getCardLinkedAccount",value:function(t,e){if(t&&t.linked_accounts)return(0,o.default)(t.linked_accounts,{type:e})}},{key:"_extractCards",value:function(t,e){if(Array.isArray(t))return(0,r.default)(t,{type:e})}},{key:"isCardWithinForceReissueWindow",value:function(t){return t.forceReissueWindow}},{key:"extractErrors",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=[];if("errorMessage"in t&&e.push(t.errorMessage),"response_status"in t&&"status_code"in t.response_status)switch(t.response_status.status_code){case this.STATUS_CODES.VALIDATION_ERROR:t.response_status.details.forEach((function(t){"cvc2"===t.field_name?e.push("global.customErrorCodes.NO_INFO_MATCH"):e.push(t.technical_description+" "+t.field_name)}));break;default:e.push("global.errorCodes."+t.response_status.return_code),"details"in t.response_status&&t.response_status.details.forEach((function(t){e.push(t.technical_description)}))}return this.$log.debug("extractErrors: formatted error:",e),e}},{key:"convertCard",value:function(t,e){var n={id:t.card_number},i=e;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UPDATE_CARD,{urlVars:n,data:i})}},{key:"getConversionOffer",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.CC_CONVERT_OFFER).then((function(t){return t.offers&&t.offers[0]}))}}]),t}();u.$inject=["$log","RequesterService","customerConstants","accountConstants","serviceConstants","cardsConstants","AccountDetailsService","$q"],e.default=u,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.$q=n,this.RequesterService=a,this.CurrencyService=s,this.CURRENCY_TYPES=r.CURRENCY_TYPES,this.AVAILABLE_SERVICES=o.AVAILABLE_SERVICES,this.exchangeRates={}}return(0,a.default)(t,[{key:"_resetExchangeRates",value:function(){this.exchangeRates={CAD:{to:{}}}}},{key:"getExchangeRates",value:function(){var t=this,e=this.$q.defer();return this._resetExchangeRates(),this.RequesterService.request(this.AVAILABLE_SERVICES.EXCHANGE_RATES).then((function(n){n.exchange_rates.length>0&&n.exchange_rates.forEach((function(e){t.exchangeRates.CAD.to[e.currency]=1/e.buy,t.exchangeRates.CAD.to[e.currency+"RAW"]=e.buy,e.currency in t.exchangeRates||(t.exchangeRates[e.currency]={to:{}}),t.exchangeRates[e.currency].to.CAD=e.sell})),e.resolve(t.exchangeRates)})).catch((function(t){e.reject("error fetching exchange rates:",t)})),e.promise}},{key:"getDisplayRate",value:function(t,e){var n=0,i=this.CurrencyService.isCanadian(t)?e+"RAW":e;return t in this.exchangeRates&&i in this.exchangeRates[t].to&&(n=this.exchangeRates[t].to[i]),n}},{key:"calculateExchange",value:function(t,e,n){return e in this.exchangeRates&&n in this.exchangeRates&&e!==n&&e in this.exchangeRates[n].to&&n in this.exchangeRates[e].to?t*this.exchangeRates[e].to[n]:t}}]),t}();r.$inject=["$log","$q","RequesterService","CurrencyService","accountConstants","serviceConstants"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(68)),a=o(n(8)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i){(0,s.default)(this,t),(0,a.default)(this,{moveMoneyConstants:e,transactionConstants:n,accountConstants:i,BP_TYPE:n.TRANSACTION_TYPE_TO_CODE[n.TRANSACTION_TYPE_FILTER_MAP.billPayment]})}return(0,r.default)(t,[{key:"getPayeeNameFromPendingTransaction",value:function(t){var e=t.to_account&&t.to_account.display_name?t.to_account.display_name.match(/-(.*)-/,""):null;return e&&Array.isArray(e)&&e.length>1?e[1].trim():""}},{key:"prepareListOfAccountHashesForPostedTransactionsRequest",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{account_summary:{}},n=this,a=arguments[2],s=arguments[3];if(t){var r=[];return t.forEach((function(t){r.push(t.number),t.authorized_user_cc_numbers&&s===n.transactionConstants.TRANSACTION_VIEWS.ALL&&r.push.apply(r,(0,i.default)(t.authorized_user_cc_numbers))})),r}var o=e.account_summary?e.account_summary.credit_card:null;return o&&o.cc_account_details&&o.cc_account_details.authorized_users.length>0&&o.cc_account_details.is_primary_account?[o.cc_account_details.card_details.card_number].concat((0,i.default)(o.cc_account_details.authorized_users.map((function(t){return t.card_number})))):[e&&e.account_summary&&e.account_summary.account_number?e.account_summary.account_number:a]}},{key:"getActualTransactionAmount",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.amount||t.originalAmount?t.hasIncompleteCategoryList&&t.amount?t.amount:t.originalAmount&&t.originalAmount!==t.amount?t.originalAmount:t.amount:0}},{key:"getDisplayTransactionAmountForTransactionModals",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.hasIncompleteCategoryList?t.parent?t.parent.originalAmount:t.originalAmount?t.originalAmount:t.amount:this.getActualTransactionAmount(t)}},{key:"isTransactionFromMeniga",value:function(t){return!!t.category_id}},{key:"isFullBalanceTransaction",value:function(t){return t.paymentIndicator===this.moveMoneyConstants.PAYMENT_INDICATOR.FULL_BALANCE}},{key:"isMinimumPaymentTransaction",value:function(t){if(t.to_account&&t.to_account.display_name){var e=t.to_account.display_name;if(t.amountType===this.moveMoneyConstants.AMOUNT_TYPE.EMPTY_SCO_TRANS&&(e.startsWith("68")||e.startsWith("69"))&&t.to_account.type===this.accountConstants.ACCOUNT_TYPES.LOAN)return!0}return t.paymentIndicator===this.moveMoneyConstants.PAYMENT_INDICATOR.MINIMUM_PAYMENT}},{key:"getCrossCurrencyDetailsFromLegacyTransactionDescription",value:function(t){var e=/.*?([0-9.,]+)\s+(\w*)\s+(\w*)\s+(\w*).*?([0-9.,]+)/.exec(t);return!e||e.length<6?null:{amount_in_currency:e[5],exchange_rate:e[1],currency:e[4],exchange_amount:e[5]}}},{key:"canTransactionOccurOnPostedList",value:function(t){return t.type===this.BP_TYPE&&moment(t.effective_date,"YYYY-MM-DD").isBefore(moment().add(1,"days"),"day")&&t.frequency===this.moveMoneyConstants.TIME_STATES.FREQUENCY.ONCE&&!!t.reference_seq_num}}]),t}();c.$inject=["moveMoneyConstants","transactionConstants","accountConstants"],e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.locale=e.locale,this.RequesterService=n,this.serviceConstants=a}return(0,a.default)(t,[{key:"getMessaageTemplates",value:function(t){var e=this;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_MESSAGE_TEMPLATES,{urlVars:{templateId:t,locale:this.locale}}).then((function(t){return t.messageTemplateDetails.filter((function(t){return t.locale===e.locale}))||[]}))}}]),t}();r.$inject=["LocaleService","RequesterService","serviceConstants"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=r(n(1815));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.$q=e,this.$http=n,this.$log=a,this.ConfigDataService=s,this.EnvironmentService=r,this._getConfig()}return(0,a.default)(t,[{key:"_getConfig",value:function(){var t=this;this.CONFIG={},this.$log.debug("FileUploadService _getConfig Retrieving Config"),this.ConfigDataService.getConfig().then((function(e){t.CONFIG=e,t.$log.debug("FileUploadService _getConfig Fetch RDC Config Successfully: ",e)})).catch((function(e){t.$log.error("FileUploadService _getConfig Exception",e)}))}},{key:"rdcVerify",value:function(t){if(this.EnvironmentService.isMock()){return this.$q.when({data:{UploadStatus:"COMPLETED",MitekResponse:{ChequeSerialNumber:"123",ChequeTransitNumber:"123",ChequeInstitutionNumber:"123",ChequeAccountNumber:"123",EnteredAmount:0,RecognizedAmount:0,RecognizedAmountConf:0,MicrConf:0,TransactionID:12345,CorrectedFrontImage:"correctedFrontImageInBase64",CorrectedBackImage:"correctedBackImageInBase64",Reason:"IQAGOOD"}}})}if(!this.CONFIG.rdc)return this.$log.error("FileUploadService _getConfig Missing RDC Config : ",this.CONFIG.rdc),this.$q.reject({messagePath:"remoteDepositCapture.errorCodes.others.ING_Network_Error"});var e=this.CONFIG.rdc["rdc.fileupload.baseurl"]+this.CONFIG.rdc["rdc.fileupload.verify"],n=this.CONFIG.rdc["rdc.fileupload.timeout"];return this._fileupload(t,e,n)}},{key:"rdcConfirm",value:function(t){if(this.EnvironmentService.isMock()){return this.$q.when({data:{UploadStatus:"COMPLETED"}})}if(!this.CONFIG.rdc)return this.$log.error("FileUploadService _getConfig Missing RDC Config : ",this.CONFIG.rdc),this.$q.reject({messagePath:"remoteDepositCapture.errorCodes.others.ING_Network_Error"});var e=this.CONFIG.rdc["rdc.fileupload.baseurl"]+this.CONFIG.rdc["rdc.fileupload.confirm"],n=this.CONFIG.rdc["rdc.fileupload.timeout"];return this._fileupload(t,e,n)}},{key:"_fileupload",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"12000",i={method:"POST",timeout:n,url:e,headers:{"Content-Type":void 0},transformResponse:function(t){var e=(new s.default).xml2js(t);return e&&e.DocumentUploadReport?e.DocumentUploadReport:e},data:t};return this.$log.debug("FileUploadService _fileupload sending POST request ",i),this.$http(i)}}]),t}();o.$inject=["$q","$http","$log","ConfigDataService","EnvironmentService"],e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(104)),a=l(n(68)),s=l(n(0)),r=l(n(2)),o=l(n(116)),c=l(n(1815));function l(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(e,n,i,a,r,o,c,l){(0,s.default)(this,t),this.$q=e,this.$http=l,this.$log=n,this.$window=c,this.RequesterService=i,this.serviceConstants=a,this.EnvironmentService=r,this.AVAILABLE_SERVICES=a.AVAILABLE_SERVICES,this.FileUploadHelperService=o}return(0,r.default)(t,[{key:"upload",value:function(t){var e=this,n=t.files,s=t.type,r=t.reason,c=t.url,l=t.timeout,u=t.transactionId,d=t.updateUploadHistory,h=void 0!==d&&d,f=t.conditionId,p=void 0===f?null:f;return this._getFileUploadToken(s,r,u).then((function(t){e.$log.debug(t);var d=new FormData;n.forEach((function(t){return d.append(t.name,t)})),d.append("Token",t.token),d.append("DocumentType",s),d.append("DocumentReason",r),u&&d.append("ReferenceNo",u);var f=void 0;if(e.EnvironmentService.isMock()){f=e.$q.when({data:{response_status:{status_code:"COMPLETED"}}})}else f=e.$http({headers:{"Content-Type":void 0},url:c,method:"POST",data:d,timeout:l,transformResponse:e._transformUploadResponse.bind(e)});return f.then((function(s){if("COMPLETED"!==(0,o.default)(s,"data.response_status.status_code")){e.$log.debug("Rejecting response: "+s);var r=s&&s.data||s;return e.$q.reject(new Error(r))}if(h){var c=250/n.length-8,l=[].concat((0,a.default)(n.map((function(t){if(t.name.length>c){var e=t.name.split("."),n=(0,i.default)(e,2),a=n[0],s=n[1],r=s?s.slice(0,4):"";return a.slice(0,c)+"~."+(r||"")}return t.name})))).join(" | "),u={data:{token:t.token,condition_id:p,files:l}};return e.RequesterService.request(e.AVAILABLE_SERVICES.UPDATE_UPLOAD_HISTORY,u).then((function(t){if(t.response_status.status_code!==e.serviceConstants.STATUS_CODES.SUCCESS)throw t;return n}))}return n}))}))}},{key:"_getFileUploadToken",value:function(t,e,n){var i=this,a={data:{documentType:t,uploadPurpose:e,dealId:n}};return this.RequesterService.request(this.AVAILABLE_SERVICES.FILE_UPLOAD_GET_TOKEN,a).then((function(t){var e=i.serviceConstants.STATUS_CODES;if(-1===[e.SUCCESS,e.CREATED].indexOf(t.response_status.status_code))throw t;return t}))}},{key:"_transformUploadResponse",value:function(t){var e=(new c.default).xml2js(t);return{response_status:{status_code:(0,o.default)(e,"DocumentUploadReport.UploadStatus")||"FAIL",return_code:(0,o.default)(e,"DocumentUploadReport.UploadedFiles.UploadedFile.Reason")}}}},{key:"_scaleImage",value:function(t,e){var n=this;return this.$q((function(i){var a=new FileReader;a.readAsArrayBuffer(t),a.onload=function(a){var s=new Blob([a.target.result]);n.$window.URL=n.$window.URL||n.$window.webkitURL;var r=n.$window.URL.createObjectURL(s),o=new Image;o.src=r,o.onload=function(){var a=n._resizeImage(o,t.type,e);i(n._dataURLtoFile(a,t.name))}}}))}},{key:"_dataURLtoFile",value:function(t,e){for(var n=t.split(","),i=n[0].match(/:(.*?);/)[1],a=atob(n[1]),s=new Uint8Array(a.length),r=a.length;r>0;r--)s[r]=a.charCodeAt(r);return new File([s],e,{type:i})}},{key:"_blobToFile",value:function(t,e){return new File([t],e,{lastModified:(new Date).getTime()})}},{key:"_resizeImage",value:function(t,e,n){var i=document.createElement("canvas"),a=t.width,s=t.height;return a>s?a>690&&(s=Math.round(s*=690/a),a=690):s>690&&(a=Math.round(a*=690/s),s=690),i.width=a,i.height=s,i.getContext("2d").drawImage(t,0,0,a,s),i.toDataURL(e,n)}}]),t}();u.$inject=["$q","$log","RequesterService","serviceConstants","EnvironmentService","FileUploadHelperService","$window","$http"],e.default=u,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=r(n(1816));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,s){(0,i.default)(this,t),this.$log=e,this.SessionService=n,this.UserService=a,this.NativeService=s,this._getLoggingInfo()}return(0,a.default)(t,[{key:"_getLoggingInfo",value:function(){var t=this;this.logging={device:{},userInfo:{}},this.NativeService.getDeviceBuildNumber().then((function(e){t.$log.debug("FileUploadHelperService _getLoggingInfo Fetching Device Build Number Returned: ",e),t.logging.device.buildNumber=e.buildNumber}),(function(e){t.$log.error("FileUploadHelperService _getLoggingInfo Error Fetching Device Build Number: ",e)})),this.NativeService.getDevicePlatform().then((function(e){t.$log.debug("FileUploadHelperService _getLoggingInfo Fetching Device Platform Returned: ",e),t.logging.device.devicePlatform=e.devicePlatform}),(function(e){t.$log.error("FileUploadHelperService _getLoggingInfo Error Fetching Device Platform: ",e)})),this.SessionService.isAuthenticated()&&this.UserService.getUserInfo().then((function(e){t.$log.debug("FileUploadHelperService _getLoggingInfo GET Customers Info Returned: ",e),t.logging.userInfo=e.customer||{}})).catch((function(e){t.$log.error("FileUploadHelperService _getLoggingInfo GET Customers Info Error: ",e)}))}},{key:"constructOCRPayload",value:function(t,e){var n={Token:t,Amount:e.amount,DocumentName:"NCR Scaled Cheque",DocumentReason:"REMOTE_DEPOSIT",DocumentType:"RDEPCHQ",Comments:"No Comments",IsHTML:"false","frontImage.jpg":e.frontChequeImage,"backImage.jpg":e.backChequeImage,AppVersion:this.logging.device.buildNumber,DeviceType:this.logging.device.devicePlatform,OrangeKey:this.logging.userInfo.orange_key};return this.$log.debug("FileUploadHelperService constructOCRPayload ",n),this._constructChequePayload(n,"frontImage.jpg","backImage.jpg","image/jpg")}},{key:"constructSubmitPayload",value:function(t,e){var n={Token:t.depositToken,DocumentName:"NCR Scaled Cheque",DocumentReason:"REMOTE_DEPOSIT",DocumentType:"RDEPCHQ",ReferenceNo:t.dealId,EnteredAmount:e.EnteredAmount,RecognizedAmount:e.RecognizedAmount,RecognizedAmountConf:e.RecognizedAmountConf,MicrConf:e.MicrConf,TransactionID:e.TransactionID,Comments:"No Comments",IsHTML:"false","frontImage.tiff":e.CorrectedFrontImage,"backImage.tiff":e.CorrectedBackImage};return this.$log.debug("FileUploadHelperService constructSubmitPayload ",n),this._constructChequePayload(n,"frontImage.tiff","backImage.tiff","image/tiff")}},{key:"_ocrChequeBase64toBlob",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=t;n=n.replace("data:image/jpg;base64,","").replace("data:image/png;base64,","").replace(/(\r\n|\n|\r)/gm,"");var i=this._base64ToByteArray(n),a=new Blob(i,{type:e});return a}},{key:"base64toBlob",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=(t=t.replace(/(\r\n|\n|\r)/gm,"")).split(";"),i=n[0].split(":")[1],a=n[1].split(",")[1],s=this._base64ToByteArray(a);return new Blob(s,{type:e&&e.length>0?e:i})}},{key:"_base64ToByteArray",value:function(t){for(var e=atob(t),n=[],i=0;i<e.length;i+=512){for(var a=e.slice(i,i+512),s=new Array(a.length),r=0;r<a.length;r++)s[r]=a.charCodeAt(r);var o=new Uint8Array(s);n.push(o)}return n}},{key:"_constructChequePayload",value:function(t,e,n,i){return t[e]=this._ocrChequeBase64toBlob(t[e],i),t[n]=this._ocrChequeBase64toBlob(t[n],i),this._convertPayloadDataToPayloadString(t,e,n)}},{key:"_convertPayloadDataToPayloadString",value:function(t,e,n){this.$log.debug("FileUploadHelperService _convertPayloadDataToPayloadString ",t);var i=new FormData;return(0,s.default)(t,(function(t,a){a===e||a===n?i.append(a,t,a):i.append(a,t)})),i}}]),t}();o.$inject=["$log","SessionService","UserService","NativeService"],e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(142)),a=o(n(0)),s=o(n(2)),r=o(n(45));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,s,r,o,c,l,u,d,h,f){(0,a.default)(this,t),this.$q=e,this.$log=n,this.$httpParamSerializer=i,this.$translate=s,this.RequesterService=r,this.AccountHelpersService=l,this.ReferenceDataService=u,this.accountConstants=c,this.serviceConstants=o,this.categoryConstants=d,this.ACCOUNT_USAGE_TYPES_MAP=c.ACCOUNT_USAGE_TYPES_MAP,this.ACCOUNT_SAVING_TYPES=c.ACCOUNT_SAVING_TYPES,this.ACCOUNT_LOAN_TYPES=c.ACCOUNT_LOAN_TYPES,this.ACCOUNT_TYPES=c.ACCOUNT_TYPES,this.DESTINATION_TYPES={ACCOUNT:"ACCOUNT",CREDIT_CARD:"CREDITCARD"},this.LocaleService=h,this.EnvironmentService=f}return(0,s.default)(t,[{key:"getAccounts",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_SUMMARY)}},{key:"getCCAccounts",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_SUMMARY).then((function(t){return t.accounts.filter((function(t){return"CREDIT_CARD"===t.type}))}))}},{key:"getTlocAccounts",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_SUMMARY).then((function(t){return t.accounts.filter((function(t){return"LOAN"===t.type}))}))}},{key:"getSavingsAccounts",value:function(){var t=this.RequesterService,e=this.serviceConstants;return t.request(e.AVAILABLE_SERVICES.ACCOUNT_SUMMARY_SAVINGS).then((function(t){return t.accounts.filter((function(t){return!1===t.registered}))}))}},{key:"getSavingsAccountsWithoutRIF",value:function(){var t=this.RequesterService,e=this.serviceConstants;return t.request(e.AVAILABLE_SERVICES.SAVINGS_ACCOUNT_WITHOUT_RIF).then((function(t){return t.toAccounts?t.toAccounts.filter((function(t){return!1===t.registered})):t}))}},{key:"addRewards",value:function(t){var e=this.RequesterService,n=this.serviceConstants,a={categories:(0,i.default)(t.categories.values())};t.savingsAccount?(a.redemption_destination=this.DESTINATION_TYPES.ACCOUNT,a.redemption_savings_account_number=t.savingsAccount.number):a.redemption_destination=this.DESTINATION_TYPES.CREDIT_CARD;var s={urlVars:{accountHash:t.accountHash},data:{credit_card_rewards_preference:{new_rewards_option:a}}};return e.request(n.AVAILABLE_SERVICES.ADD_REWARDS,s)}},{key:"getCloseAccounts",value:function(t){var e={urlVars:{queryString:null}};if(t){var n={};n.accNum=t,e.urlVars.queryString=this.$httpParamSerializer(n)}return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.CLOSE_ACCOUNT,e)}},{key:"getAccountByNumber",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_SUMMARY).then((function(e){return e.accounts.filter((function(e){return e.number===t}))})).then((function(t){return t[0]}))}},{key:"getAccountByDisplayName",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_SUMMARY).then((function(e){return e.accounts.filter((function(e){return e.display_name===t}))})).then((function(t){return t[0]}))}},{key:"getAccountDetails",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.accountConstants.ACCOUNT_TYPES.CHEQUING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i={urlVars:{accountHash:t,queryString:"include-available-actions=true"}},a="ACCOUNT_DETAILS_"+e;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES[a],i,n)}},{key:"getAccountHolds",value:function(t){var e={urlVars:{accountHash:t}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_HOLDS,e)}},{key:"getAccountUsageTypes",value:function(t){var e=this,n={urlVars:{locale:this.LocaleService.locale}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_USAGE_TYPES,n).then((function(n){return n.reference_data[0].data[e.ACCOUNT_USAGE_TYPES_MAP[t]].data}))}},{key:"getBankInfo",value:function(){var t=this;return this.ReferenceDataService.getDataByType(this.ReferenceDataService.TYPES.BANK_INFO).then((function(e){return e[t.ReferenceDataService.TYPES.BANK_INFO]}))}},{key:"getRewardsCategories",value:function(){var t=this;return this.ReferenceDataService.getDataByType(this.ReferenceDataService.TYPES.CC_REWARD_CATS).then((function(e){return e[t.ReferenceDataService.TYPES.CC_REWARD_CATS]}))}},{key:"getAccountCards",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.CARDS)}},{key:"getAccountName",value:function(t){return this.AccountHelpersService.getDisplayNameInstant(t.account_summary)}},{key:"getCCAccountName",value:function(t){var e=t.account_summary.account_number;return this.getAccountByNumber(e).then((function(t){return t?t.description:""}))}},{key:"getCCAccountNameByProductType",value:function(t){var e=this.accountConstants.CREDIT_CARD_DESCRIPTIONS[t];return this.$translate.instant(e)}},{key:"isActionAvailable",value:function(t,e){return!(!t.account_summary||!Array.isArray(t.account_summary.available_actions))&&-1!==t.account_summary.available_actions.indexOf(e)}},{key:"getAvailableActions",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.AVAILABLE_ACTIONS)}},{key:"hasSuspendedOverdraft",value:function(t){return!!(t&&t.account_summary&&t.account_summary.overdraft&&t.account_summary.overdraft.status===this.accountConstants.OVERDRAFT_STATUSES.SUSPENDED)}},{key:"checkRegistration",value:function(t,e){return t&&t.account_summary&&t.account_summary.account_registration===e}},{key:"isPrimaryHolder",value:function(t,e){return!(!t||!t.account_summary||t.account_summary.primary_account_holder!==e)}},{key:"getRewardsPreference",value:function(t){var e={urlVars:{accountHash:t}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_REWARDS_PREFERENCE,e)}},{key:"getRewards",value:function(t,e,n){var i={urlVars:{accountHash:t,queryString:"start-billing-cycle="+e+"&end-billing-cycle="+n+"&additional-rewards-info=true"}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_REWARDS,i)}},{key:"getAccountContributionDetails",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_CONTRIBUTION_DETAILS,{urlVars:{account_id:t}})}},{key:"getAccountContributionsSummaryByAccountId",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_CONTRIBUTIONS_SUMMARY_BY_ACCOUNT_ID,{urlVars:{account_id:t}})}},{key:"getAccountContributionsSummaryByAccountType",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_CONTRIBUTIONS_SUMMARY_BY_ACCOUNT_TYPE,{urlVars:{accountType:t}})}},{key:"getContributions",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_CONTRIBUTIONS,{urlVars:{accountHash:t}})}},{key:"getDistributions",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_DISTRIBUTIONS,{urlVars:{accountHash:t}})}},{key:"putDistributions",value:function(t,e){var n=this,i={urlVars:{accountHash:t.accountHash},data:{validate_only:e,frequency:t.frequency,next_withdrawal_date:t.next_withdrawal_date,to_account:t.to_account}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.PUT_DISTRIBUTIONS,i).catch((function(t){n.$log.error("error during putDistributions():",t)}))}},{key:"getSavingsAccountType",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.tax_free?this.ACCOUNT_SAVING_TYPES.TFSA:t.registered?t.income_fund||t.type===this.ACCOUNT_SAVING_TYPES.OTHER?this.ACCOUNT_SAVING_TYPES.RIF:this.ACCOUNT_SAVING_TYPES.RSP:t.HELOC?this.ACCOUNT_LOAN_TYPES.HELOC:t.LOC?this.ACCOUNT_LOAN_TYPES.LOC:t.TLOC?this.ACCOUNT_LOAN_TYPES.TLOC:t.TERMLOAN?this.ACCOUNT_LOAN_TYPES.TERM_LOAN:this.ACCOUNT_SAVING_TYPES.OTHER}},{key:"getGoalsAccountType",value:function(){return this.ACCOUNT_TYPES.GOALS}},{key:"getAggregatedAccountType",value:function(){return this.ACCOUNT_TYPES.ACCOUNT_AGGREGATION}},{key:"isRIF",value:function(t){return this.getSavingsAccountType(t)===this.ACCOUNT_SAVING_TYPES.RIF}},{key:"isTloc",value:function(t){return this.getSavingsAccountType(t)===this.ACCOUNT_LOAN_TYPES.TLOC}},{key:"isRSP",value:function(t){return this.getSavingsAccountType(t)===this.ACCOUNT_SAVING_TYPES.RSP}},{key:"isTfsa",value:function(t){return this.getSavingsAccountType(t)===this.ACCOUNT_SAVING_TYPES.TFSA}},{key:"getLoanType",value:function(t){switch(t){case"LOC":return this.accountConstants.ACCOUNT_TYPES.LOAN;case"HELOC":return this.accountConstants.ACCOUNT_TYPES.MORT_DAWT;default:return this.accountConstants.ACCOUNT_TYPES.LOAN}}},{key:"isGicAccount",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!t.GIC}},{key:"isBusiness",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!t.business}},{key:"saveAccountDetails",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a={urlVars:{accountHash:t.account_number},data:{account_nick_name:t.account_nick_name,intended_use:t.intended_use,other_intended_use:t.other_intended_use}};return n&&(a.data.abm_limit=n),i&&(a.data.debit_limit=i),this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.PUT_ACCOUNT_DETAILS,a).catch((function(t){e.$log.error("error during saveAccountDetails():",t)}))}},{key:"saveGicOptions",value:function(t,e){var n=this,i={urlVars:{accountHash:t.number},data:{gic_change_options:e}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.PUT_ACCOUNT_DETAILS,i).catch((function(t){n.$log.error("error during saveGicOptions():",t)}))}},{key:"closeAccount",value:function(t){var e=this,n={urlVars:{accountHash:t.fromAccount.display_name},data:{validate_only:!1,transfer_type:"CLOSE_ACCOUNT",transfers:{when:t.when,frequency:t.frequency,to_account:t.toAccount.display_name,currency:t.toAccount.currency_type,amount:t.fromAccount.account_balance}}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.CLOSE_ACCOUNT_SUBMIT,n).catch((function(t){e.$log.error("error during closeAccount():",t)}))}},{key:"orderCheques",value:function(t){var e=this,n={urlVars:{accountHash:t.accountHash},data:{validate_only:!1,language:t.language}};return t.print_address&&(n.data.address_type=t.print_address.address_type),this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.POST_CHEQUE_ORDERS,n).catch((function(t){e.$log.error("error during orderCheques():",t)}))}},{key:"createOrUpdateTransactionComment",value:function(t,e){var n=t&&t.comments&&t.comments[0];return this.RequesterService.request(n?this.serviceConstants.AVAILABLE_SERVICES.AMEND_TRANSACTION_NOTE:this.serviceConstants.AVAILABLE_SERVICES.ADD_TRANSACTION_NOTE,{urlVars:{id:t.id,commentId:n?t.comments[0].id:null},data:{comment:e}})}},{key:"orderDraft",value:function(t,e){var n={urlVars:{accountHash:t},data:{validate_only:!1,draft_order:e}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.POST_DRAFT_ORDERS,n)}},{key:"getRates",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n={urlVars:{locale:this.LocaleService.locale}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNTS_RATES,n).then((function(n){return n.response_status.status_code===t.serviceConstants.STATUS_CODES.SUCCESS&&Array.isArray(n.rates)?e?n.rates.filter((function(t){return t.profile_product_type===e})):n.rates:t.$q.reject()}))}},{key:"getFees",value:function(t){var e=this,n={urlVars:{accountHash:t}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_ACCOUNT_FEES,n).catch((function(t){e.$log.error("error during getFees():",t)}))}},{key:"getWithholdingTaxRates",value:function(t,e){var n=this,i={urlVars:{queryString:"from-account="+t+"&to-account="+e}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_WITHHOLDING_TAX_RATES,i).then((function(t){return t.response_status.status_code===n.serviceConstants.STATUS_CODES.SUCCESS&&Array.isArray(t.withholding_tax_rates)?t:n.$q.reject()}))}},{key:"getPendingLoanPaymentTransactions",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.PENDING_TRANSACTIONS,{urlVars:{queryString:null}}).then((function(e){return e.pending_transactions.find((function(e){return"LP"===e.type&&(!t||e.to_account&&e.to_account.number&&e.to_account.number.toLowerCase()===t.toLowerCase())}))}))}},{key:"getRIFPaymentAccounts",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.RIF_PAYMENT_ACCOUNTS,{urlVars:{queryString:null}})}},{key:"rewardsListToTransactionList",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(e)?e.map((function(e){return{transaction_date:(0,r.default)(e.transaction_date,"YYYY-MM-DDTHH:mm:ssZ").format("YYYY-MM-DDTHH:mm:ss"),amount:Math.abs(e.amount),description:e.transaction_desc,posted_date:(0,r.default)(e.posted_date,"YYYY-MM-DDTHH:mm:ssZ").format("YYYY-MM-DDTHH:mm:ss"),category_id:t.categoryConstants.REWARDS_CATEGORY[e.category].id,icon:t.categoryConstants.REWARDS_CATEGORY[e.category].icon,color:t.categoryConstants.REWARDS_CATEGORY[e.category].color,account_id:e.card_number_display_name,vendor_code:e.category,reward:e.rewards}})):[]}},{key:"getPendingTransactions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e={urlVars:{queryString:t?"include-mf-transactions=true":null}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.PENDING_TRANSACTIONS,e)}},{key:"getInvestmentBeneficiary",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_INVESTMENT_BENEFICIARY,{urlVars:{planId:t}})}},{key:"isAfterCdicChangeDate",value:function(){var t=this.EnvironmentService.get("cdicChangeEnableDate");return!!t&&(0,r.default)().isAfter((0,r.default)(t,"YYYY-MM-DD HH:mm:ss"))}}]),t}();c.$inject=["$q","$log","$httpParamSerializer","$translate","RequesterService","serviceConstants","accountConstants","AccountHelpersService","ReferenceDataService","categoryConstants","LocaleService","EnvironmentService"],e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(528)),a=l(n(104)),s=l(n(0)),r=l(n(2)),o=l(n(544)),c=l(n(530));function l(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(e,n,i,a,r,o,c,l,u,d,h,f,p,g,m){(0,s.default)(this,t),this.$q=a,this.$state=i,this.RequesterService=e,this.AccountHelpersService=c,this.ReferenceDataService=l,this.moveMoneyConstants=d,this.aspConstants=h,this.accountConstants=r,this.stateConstants=o,this.serviceConstants=n,this.TRANSACTION_CODE=d.TRANSACTION_CODE,this.ACCOUNT_USAGE_TYPES_MAP=r.ACCOUNT_USAGE_TYPES_MAP,this.ACCOUNT_SAVING_TYPES=r.ACCOUNT_SAVING_TYPES,this.ACCOUNT_TYPES=r.ACCOUNT_TYPES,this.CURRENCY_TYPES=r.CURRENCY_TYPES,this.ACCOUNT_CATEGORIES=r.ACCOUNT_CATEGORIES,this.ACCOUNT_MAPS=r.ACCOUNT_MAPS,this.STATUS_CODES=n.STATUS_CODES,this.timeStateConstants=u,this.$httpParamSerializer=p,this.locale=f.locale,this.$log=g,this.tpiFormConstants=m,this.currencyTypeRequiredArray=[this.accountConstants.ACCOUNT_PPTS.USDSAVINGS,this.accountConstants.ACCOUNT_PPTS.SAVINGS,this.accountConstants.ACCOUNT_PPTS.BUSINESS_SAVINGS,this.accountConstants.ACCOUNT_PPTS.BUSINESS_US_SAVINGS],this.isBusinessRequiredArray=[this.accountConstants.ACCOUNT_PPTS.BUSINESS_SAVINGS,this.accountConstants.ACCOUNT_PPTS.BUSINESS_US_SAVINGS],this.effectiveDateRequiredArray=[this.accountConstants.ACCOUNT_PPTS.TFSA,this.accountConstants.ACCOUNT_PPTS.TFSAKS,this.accountConstants.ACCOUNT_PPTS.RSP]}return(0,r.default)(t,[{key:"isInternal",value:function(t){return t.type!==this.ACCOUNT_TYPES.EXT}},{key:"isCAD",value:function(t){return t.currency_type===this.CURRENCY_TYPES.CAD}},{key:"isCreditCard",value:function(t){return t.type===this.ACCOUNT_TYPES.CREDIT_CARD}},{key:"isSaving",value:function(t){return t.type===this.ACCOUNT_TYPES.SAVINGS}},{key:"isInvesting",value:function(t){return this.ACCOUNT_MAPS[t.type]===this.ACCOUNT_CATEGORIES.INVESTING}},{key:"isCreditAccount",value:function(t){return t.type===this.ACCOUNT_TYPES.LOAN}},{key:"isInternalCAD",value:function(t){return this.isInternal(t)&&this.isCAD(t)}},{key:"isInternalNonCAD",value:function(t){return this.isInternal(t)&&!this.isCAD(t)}},{key:"isExternalCAD",value:function(t){return!this.isInternal(t)&&this.isCAD(t)}},{key:"isExternalNonCAD",value:function(t){return!this.isInternal(t)&&!this.isCAD(t)}},{key:"getAccounts",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_SUMMARY)}},{key:"getDirectDepositAccounts",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.DIRECT_DEPOSIT_ACCOUNTS)}},{key:"getAccountBalances",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_SUMMARY)}},{key:"getCloseAccounts",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.CLOSE_ACCOUNT).then((function(t){return t.toAccounts}))}},{key:"getAccountByNumber",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_SUMMARY).then((function(e){return e.accounts.filter((function(e){return e.number===t}))})).then((function(t){return t[0]}))}},{key:"getAccountDetails",value:function(t,e){var n={urlVars:{accountHash:t}},i="ACCOUNT_DETAILS_"+e;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES[i],n)}},{key:"getGenericAccountDetails",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_DETAILS,{urlVars:{accountHash:t}})}},{key:"getMutualFundDetails",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_MUTUAL_FUND_DETAILS,{urlVars:{dealId:t}})}},{key:"getFullLoanBalance",value:function(t){var e=t.toAccount[0].product_code===this.accountConstants.ACCOUNT_PPTS.TERM_LOAN?this.TRANSACTION_CODE.FULL_TERM_LOAN_PAYMENT:this.TRANSACTION_CODE.LINE_OF_CREDIT_REQUEST,n={urlVars:{accountHash:t.fromAccount[0].number},header:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:{validate_only:!0,transfers:{to_account_transaction_code:e,when:this.timeStateConstants.WHEN.NOW,to_account:t.toAccount[0].number,currency:t.currency}}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.MOVE_MONEY_SUBMIT,n)}},{key:"getAccountHolds",value:function(t){var e={urlVars:{accountHash:t}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_HOLDS,e)}},{key:"getAccountUsageTypes",value:function(t){var e=this,n={urlVars:{locale:this.locale}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_USAGE_TYPES,n).then((function(n){var i=e.ACCOUNT_USAGE_TYPES_MAP[t];return(0,a.default)(n.reference_data,1)[0].data[i].data}))}},{key:"getBankInfo",value:function(){var t=this;return this.ReferenceDataService.getDataByType(this.ReferenceDataService.TYPES.BANK_INFO).then((function(e){return e[t.ReferenceDataService.TYPES.BANK_INFO]}))}},{key:"getTaxReceiptAvailableDates",value:function(){var t=this;return this.ReferenceDataService.getDataByType(this.ReferenceDataService.TYPES.TAX_RECEIPT_AVAILABLE_DATES).then((function(e){return e[t.ReferenceDataService.TYPES.TAX_RECEIPT_AVAILABLE_DATES]}))}},{key:"getAccountCards",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.CARDS)}},{key:"getAccountName",value:function(t){var e=t.account_summary.account_nick_name,n=this.AccountHelpersService.sanitizeAccountDescription(t.account_summary.product_description);return"account_nick_name"in t.account_summary&&0!==e.length?e:n}},{key:"getCCAccountName",value:function(t){var e=t.account_summary.account_number;return this.getAccountByNumber(e).then((function(t){return t.description}))}},{key:"getAvailableActions",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.AVAILABLE_ACTIONS)}},{key:"hasSuspendedOverdraft",value:function(t){return!!(t&&t.account_summary&&t.account_summary.overdraft&&t.account_summary.overdraft.status===this.accountConstants.OVERDRAFT_STATUSES.SUSPENDED)}},{key:"getContributions",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_CONTRIBUTIONS,{urlVars:{id:t}}).then((function(t){return t.contributions_summary}))}},{key:"getDistributions",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_DISTRIBUTIONS,{urlVars:{id:t}}).then((function(t){return t}))}},{key:"putDistributions",value:function(t){var e=this.$q.defer();return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.PUT_DISTRIBUTIONS,t).then((function(t){e.resolve(t)})).catch((function(t){e.reject(t)})),e.promise}},{key:"getSavingsAccountType",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.tax_free?this.ACCOUNT_SAVING_TYPES.TFSA:t.registered&&t.income_fund?this.ACCOUNT_SAVING_TYPES.RIF:t.registered?this.ACCOUNT_SAVING_TYPES.RSP:this.ACCOUNT_SAVING_TYPES.OTHER}},{key:"saveAccountDetails",value:function(t){var e=this;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.PUT_ACCOUNT_DETAILS,t).then((function(t){return t})).catch((function(){return e.$state.go(e.stateConstants.LOGING)}))}},{key:"closeAccount",value:function(t){var e=this.$q.defer();return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.CLOSE_ACCOUNT_SUBMIT,t).then((function(t){e.resolve(t)})).catch((function(t){e.reject(t)})),e.promise}},{key:"moveMoney",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.moveMoneyConstants.MODAL_TYPES.DEFAULT,a=void 0;switch(i){case this.aspConstants.MODAL_TYPES.INVESTMENT:case this.moveMoneyConstants.MODAL_TYPES.INVESTMENTS_BUY:case this.moveMoneyConstants.MODAL_TYPES.INVESTMENTS_SELL:case this.moveMoneyConstants.MODAL_TYPES.INVESTMENTS_WITHDRAWAL:a=e?this.serviceConstants.AVAILABLE_SERVICES.MUTUAL_FUNDS_EDIT:this.serviceConstants.AVAILABLE_SERVICES.MUTUAL_FUNDS_SUBMIT;break;default:a=e?this.serviceConstants.AVAILABLE_SERVICES.MOVE_MONEY_EDIT:this.serviceConstants.AVAILABLE_SERVICES.MOVE_MONEY_SUBMIT}var s=[this.STATUS_CODES.SUCCESS,this.STATUS_CODES.CREATED];return this.RequesterService.request(a,t).then((function(t){return-1!==s.indexOf(t.response_status.status_code)?t:n.$q.reject(t)}))}},{key:"getChequingAccounts",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_SUMMARY_CHEQUING)}},{key:"getBISASources",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accountConstants.CURRENCY_TYPES.CAD;return this.RequesterService.request(this.AVAILABLE_SERVICES.BISA_FUND_SOURCE_ACCOUNTS,{urlVars:{currency:t}})}},{key:"getRedemptionAccounts",value:function(t){var e=this.$httpParamSerializer({accNum:t.number,actionCode:"REDEMPTION_ACCOUNTS",currency:t.currency_type});return this.RequesterService.request(this.AVAILABLE_SERVICES.REQUEST_ACCOUNTS,{urlVars:{queryString:e}})}},{key:"openAccount",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.$q.defer(),a=this.serviceConstants.SERVICE_CONFIG.accountServicesByPPT[t.profile_product_type],s=this._buildOpenAccountParams(t,n);return this.serviceConstants.AVAILABLE_SERVICES[a]||i.reject("service not available : "+a+" -account type : "+t.code),this.$log.debug("post request --- open account no TPI",s,a),this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES[a],s).then((function(t){e._openAccountResponseHandler(i,t)})).catch(i.reject),i.promise}},{key:"_buildOpenAccountParams",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=-1!==this.currencyTypeRequiredArray.indexOf(t.profile_product_type),i=-1!==this.effectiveDateRequiredArray.indexOf(t.profile_product_type),a=-1!==this.isBusinessRequiredArray.indexOf(t.profile_product_type),s={data:{validate_only:e,validate_client_eligibility:!1,legal_instructions:{terms_and_conditions_accepted:!!t.termsAndConditionsAccepted,electronic_documents_selected:!!t.eDocsSelected,intended_account_use:t.intendedUse,other_intended_use:t.otherIntendedUse,third_party:!!t.third_party}}};return angular.isUndefined(t.eDocsSelected)&&(s.data.legal_instructions.electronic_documents_selected=!0),t.third_party&&(s.data.legal_instructions.third_party_info=this.getThirdPartyInfo(t)),n&&(s.data.product_currency_type=t.currency),a&&(s.data.business=!0,s.data.legal_instructions.consent_credit_bureau=!0),i&&(s.data.effective_date=moment().format("YYYY-MM-DD")),t.nickname&&t.nickname.value&&(s.data.create_account_info={nick_name:t.nickname.value}),t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.SAVINGS&&t.CCDealId&&(s.data.companion_deal_id=t.CCDealId),s}},{key:"_openAccountResponseHandler",value:function(t,e){if(-1!==[this.accountConstants.POSITIVE_ACCOUNT_SERVICE_ANSERS.CREATED,this.accountConstants.POSITIVE_ACCOUNT_SERVICE_ANSERS.SUCCESS].indexOf(e.response_status.status_code)&&e.response_status.return_code!==this.serviceConstants.STATUS_CODES.NO_ENROLL_CAPBILITY)this.$log.debug("new account successfully opened",e),angular.extend(e,{account:{complete:!0,confirmation:e.confirmation,clients:e.clients}}),t.resolve(e);else{this.$log.error("new account NOT opened",e);var n=(0,c.default)(e);angular.extend(e,{account:{failed:!0,errors:n}}),this.mapServiceSpecificErrorMessages(e,n),t.reject(e)}}},{key:"mapServiceSpecificErrorMessages",value:function(t,e){var n={profanity:new i.default([["legal_instructions.third_party_info.person_info.first_name","global.errorCodes.12008"],["legal_instructions.third_party_info.person_info.last_name","global.errorCodes.12013"],["legal_instructions.third_party_info.relationship_other","global.errorCodes.12004"],["legal_instructions.third_party_info.corporate_info.business_name","global.errorCodes.12020"]])};try{t.response_status&&Array.isArray(t.response_status.details)&&t.response_status.details.forEach((function(t){var i=t.description||t.technical_description,a=n[i];if(a){var s=a.get(t.field_name);s&&(angular.extend(t,{error_message_code:s}),e&&(0,o.default)(e,t.field_name,s))}}))}catch(t){this.$log.error("failed to map service errors",t)}}},{key:"getThirdPartyInfo",value:function(t){if(!t.third_party_info)return null;var e=angular.copy(t.third_party_info);return e.address&&!e.address.address_line2&&delete e.address.address_line2,e.type===this.tpiFormConstants.TYPES.BUSINESS?delete e.person_info:e.type===this.tpiFormConstants.TYPES.INDIVIDUAL&&(delete e.corporate_info,e.person_info.birth_date&&(e.person_info.birth_date=moment(e.person_info.birth_date).format("YYYY-MM-DD"))),e}}]),t}();u.$inject=["RequesterService","serviceConstants","$state","$q","accountConstants","stateConstants","AccountHelpersService","ReferenceDataService","timeStateConstants","moveMoneyConstants","aspConstants","LocaleService","$httpParamSerializer","$log","tpiFormConstants"],e.default=u,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(8)),a=c(n(365)),s=c(n(15)),r=c(n(0)),o=c(n(2));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,i,a,s,o){(0,r.default)(this,t),this.$log=e,this.$q=n,this.RequesterService=i,this.serviceConstants=a,this.BeneficiariesModalConstants=s,this.DateService=o}return(0,o.default)(t,[{key:"getRegisteredPlans",value:function(){var t=this;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_REGISTERED_BENEFICIARY_PLANS).then((function(e){if(e.response_status.status_code!==t.serviceConstants.STATUS_CODES.SUCCESS)throw t.$log.error("getRegisteredBeneficiaryPlans response error:",e),e;return t.$log.debug("getRegisteredBeneficiaryPlans response retrieved",e),e})).catch((function(e){throw t.$log.error("getRegisteredBeneficiaryPlans error:",e),e}))}},{key:"sanitizeBeneficiary",value:function(t){delete t.$$hashKey,delete t.listIndex,t.beneficiary_type===this.BeneficiariesModalConstants.BENEFICIARY_TYPES.CHARITY?(delete t.sin,delete t.first_name,delete t.last_name,delete t.relationship_other):(delete t.business_name,delete t.business_number),t.address_list&&t.address_list.length>0&&((0,s.default)(t.address_list[0]).length<=3||(0,a.default)(t.address_list[0]).filter((function(t){return!!t})).length<=3)&&delete t.address_list,t.phone_list&&t.phone_list.length>0&&!t.phone_list[0].number&&delete t.phone_list,t.date_of_birth||delete t.date_of_birth}},{key:"saveBeneficiary",value:function(t,e){var n=this,a=this.serviceConstants.AVAILABLE_SERVICES.UPDATE_BENEFICIARIES,s=(0,i.default)({},t);this.sanitizeBeneficiary(s);var r={data:{plan_number:e,beneficiaries:[s]}};return this.RequesterService.request(a,r).then((function(t){if(t.response_status.status_code!==n.serviceConstants.STATUS_CODES.SUCCESS)throw n.$log.error("Update beneficiaries response error:",t),t;return n.$log.debug("Beneficiaries updated successfully",t),t})).catch((function(t){throw n.$log.error("Beneficiaries error:",t),t}))}},{key:"beneficiaryFormValidation",value:function(t){var e=this,n=this.serviceConstants.AVAILABLE_SERVICES.GENERATE_BENEFICIARY_PDF,i={data:t};return this.RequesterService.request(n,i).then((function(t){if(t.response_status.status_code!==e.serviceConstants.STATUS_CODES.SUCCESS)throw e.$log.error("Beneficiaries beneficiaryFormValidation response error:",t),t;return e.$log.debug("Beneficiaries beneficiaryFormValidation response retrieved",t),t})).catch((function(t){throw e.$log.error("Beneficiaries beneficiaryFormValidation error:",t),t}))}}]),t}();l.$inject=["$log","$q","RequesterService","serviceConstants","BeneficiariesModalConstants","DateService"],e.default=l,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.dropOffConstants=n,this.pendingApplicationsConstants=a,this.accountConstants=r,this.availabileCapabilities=s.CAPABILITIES,this.PendingApplicationsService=o,this.longFormApplicationTypes=[this.pendingApplicationsConstants.TYPES.MORTGAGE,this.pendingApplicationsConstants.TYPES.MUTUAL_FUND,this.pendingApplicationsConstants.TYPES.T2033,this.pendingApplicationsConstants.TYPES.RSP_LOAN,this.pendingApplicationsConstants.TYPES.CREDIT],this.shortFormApplicationTypes=[this.pendingApplicationsConstants.TYPES.DEPOSIT_ENROLLMENT,this.pendingApplicationsConstants.TYPES.CC_ENROLLMENT],this.applicationTypes=this.longFormApplicationTypes.concat(this.shortFormApplicationTypes)}return(0,a.default)(t,[{key:"determineOutflowState",value:function(t,e,n,i){var a=this;this.$log.debug("Determining outflow with params","accounts:",t,"applications:",e,"capabilities:",n);var s=this.dropOffConstants.OUTFLOW_STATES.ACCOUNT_OVERVIEW,r=Array.isArray(e)?e.filter((function(t){return-1!==a.applicationTypes.indexOf(t.type)})):void 0,o=Array.isArray(t)&&0===t.length,c=Array.isArray(r)&&0===r.length,l=Array.isArray(r)&&r.length>0;if(o&&c)s=this.dropOffConstants.OUTFLOW_STATES.BASKET_PAGE;else if(o&&l){var u=1===r.length&&-1!==this.longFormApplicationTypes.indexOf(r[0].type);Array.isArray(n)&&-1!==n.indexOf(this.availabileCapabilities.KYC_PENDING)?s=this.dropOffConstants.OUTFLOW_STATES.ACCOUNT_OVERVIEW_LOCKED:u&&i&&i.length>0&&(s=this.dropOffConstants.OUTFLOW_STATES.PENDING_APPLICATIONS)}else if(!o){var d=r&&1===r.length&&r[0].type===this.pendingApplicationsConstants.TYPES.CC_ENROLLMENT,h=r&&2===r.length&&r.every((function(t){return t.type===a.pendingApplicationsConstants.TYPES.CC_ENROLLMENT||t.type===a.pendingApplicationsConstants.TYPES.DEPOSIT_ENROLLMENT})),f=(d||h)&&-1!==n.indexOf(this.availabileCapabilities.PERSON_UPDATE_LIMITED),p=t&&1===t.length&&t[0].type===this.accountConstants.ACCOUNT_TYPES.CREDIT_CARD;f&&p&&(s=this.dropOffConstants.OUTFLOW_STATES.ACCOUNT_OVERVIEW_LOCKED)}return s}}]),t}();r.$inject=["$log","dropOffConstants","pendingApplicationsConstants","menuConstants","accountConstants","PendingApplicationsService"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(8)),a=c(n(49)),s=c(n(0)),r=c(n(2)),o=n(67);function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,i,a,r,c,l,u,d,h,f,p,g,m,_,v,S,T,y){(0,s.default)(this,t),this.$httpParamSerializer=h,this.fileNameAlphaNumericPattern=o.fileNameAlphaNumericPattern,this.SessionService=i,this.AnalyticsService=e,this.EnvironmentService=n,this.ErrorService=a,this.NativeService=c,this.PDFRequestConfig=r,this.defaultConfig=r.SERVICE_CONFIG.defaults,this.serviceConstants=d,this.HTTP_VERBS=d.HTTP_VERBS,this.ANALYTICS_EVENTS=l.AVAILABLE_EVENTS,this.ERROR_EVENTS=u.AVAILABLE_EVENTS,this.REQUEST_TYPES=d.REQUEST_TYPES,this.$interpolate=f,this.$log=p,this.$q=g,this.$window=m,this.$document=_,this.LocaleService=v,this.$http=S,this.$translate=T,this.$timeout=y,this.headerKeys={TRANSACTION_TOKEN:"x-transaction-token",WEB_FLAVOUR:"x-web-flavour"},this.baseUrl=n.getAPIUrl(),n.isMock()?this.requestType=this.REQUEST_TYPES.MOCK:n.isNative()?this.requestType=this.REQUEST_TYPES.WL:this.requestType=this.REQUEST_TYPES.HTTP}return(0,r.default)(t,[{key:"viewStatement",value:function(t){return this._request(this.PDFRequestConfig.AVAILABLE_SERVICES.ACCOUNT_STATEMENT,{urlVars:{id:t.statement_id,queryString:this.$httpParamSerializer({"statement-type":t.statement_type,"file-name":t.statement_filename,language:this.LocaleService.shortHandLocaleUppercase})}})}},{key:"viewReport",value:function(t){var e={year:moment(t.report_date).year()};return this._request(this.PDFRequestConfig.AVAILABLE_SERVICES.INVESTMENT_REPORT,{urlVars:{id:t.report_id,queryString:this.$httpParamSerializer({language:this.LocaleService.shortHandLocaleUppercase,"file-name":this.$translate.instant("accountDocuments.investments.reportFileName",e)})}})}},{key:"viewCheque",value:function(t,e){return this._request(this.PDFRequestConfig.AVAILABLE_SERVICES.VIEW_CHEQUE,{urlVars:{accountHash:t,id:e,queryString:this.$httpParamSerializer({language:this.LocaleService.shortHandLocaleUppercase})}})}},{key:"isViewChequeViewable",value:function(t,e){return this._requestContent(this.PDFRequestConfig.AVAILABLE_SERVICES.VIEW_CHEQUE,{urlVars:{accountHash:t,id:e,queryString:this.$httpParamSerializer({language:this.LocaleService.shortHandLocaleUppercase})},doNotOpen:!0})}},{key:"_requestContent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],i=this.PDFRequestConfig.SERVICE_CONFIG[t];switch(this.$log.debug("Documents PDF content request for "+t),this.requestType){case this.REQUEST_TYPES.HTTP:return this._httpContent(i,e);case this.REQUEST_TYPES.WL:return this._worklight(i,e,n);default:return this._mockRequest(i,e,n)}}},{key:"_httpContent",value:function(t,e){var n=t.HTTP,i=this.baseUrl+n.url;i="string"==typeof e?this._interpolate(i,null):this._interpolate(i,e),this.$log.debug("_http",i,t.method);var a=this.$q.defer();return this.$http({method:t.method,url:i,data:e.data,withCredentials:!0}).success((function(t){a.resolve(t)})).error((function(){a.reject("Failed to get response")})),a.promise}},{key:"getVoidCheque",value:function(t){return this._request(this.PDFRequestConfig.AVAILABLE_SERVICES.ACCOUNT_VOID_CHEQUE,{urlVars:{accountHash:t,queryString:this.$httpParamSerializer({language:this.LocaleService.shortHandLocaleUppercase})}})}},{key:"viewOtherDocument",value:function(t){var e=t.document_name||"document";return this._request(this.PDFRequestConfig.AVAILABLE_SERVICES.OTHER_DOCUMENT,{urlVars:{id:t.document_id,queryString:this.$httpParamSerializer({"file-name":e.replace(new RegExp(this.fileNameAlphaNumericPattern,"gi"),"")+".pdf",language:this.LocaleService.shortHandLocaleUppercase})}})}},{key:"viewTaxReceipt",value:function(t,e){return this._request(this.PDFRequestConfig.AVAILABLE_SERVICES.TAX_RECEIPT,{urlVars:{key:t.receipt_key,queryString:this.$httpParamSerializer({"receipt-type":t.receipt_type,"receipt-year":e,"account-type":t.account_type,"file-name":t.receiptDescription.replace(new RegExp(this.fileNameAlphaNumericPattern,"gi"),"")+".pdf",language:this.LocaleService.shortHandLocaleUppercase})}})}},{key:"viewMagicSwitchForm",value:function(t){return this._request(this.PDFRequestConfig.AVAILABLE_SERVICES.MAGIC_SWITCH_VIEW_FORM,{urlVars:{id:t,queryString:this.$httpParamSerializer({language:this.LocaleService.shortHandLocaleUppercase})}})}},{key:"getSummary",value:function(t){return this._request(this.PDFRequestConfig.AVAILABLE_SERVICES.GET_SUMMARY,{urlVars:{accountHash:t,queryString:this.$httpParamSerializer({language:this.LocaleService.shortHandLocaleUppercase})}})}},{key:"viewBeneficiaryForm",value:function(t){var e=""+this.baseUrl+this.PDFRequestConfig.SERVICE_CONFIG.beneficiaryForm.HTTP.url;switch(this.requestType){case this.REQUEST_TYPES.HTTP:return this._postRequest(e,t);default:return this._request(this.PDFRequestConfig.AVAILABLE_SERVICES.BENEFICIARY_FORM,{data:t})}}},{key:"getTradeConfirmation",value:function(t){var e=t.id,n=moment(t.trade_date).format("DD-MM-YYYY");return this._request(this.PDFRequestConfig.AVAILABLE_SERVICES.TRADE_CONFIRMATION,{urlVars:{id:e,queryString:this.$httpParamSerializer({language:this.LocaleService.shortHandLocaleUppercase,"file-name":this.$translate.instant("transactions.viewTransactionModal.tradeConfirmationFileName",n)})}})}},{key:"_request",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],i=this.PDFRequestConfig.SERVICE_CONFIG[t];switch(this.$log.debug("Documents PDF request for "+t),this.AnalyticsService.sendAction(this.ANALYTICS_EVENTS.API_REQUEST,t),this.requestType){case this.REQUEST_TYPES.HTTP:return this._http(i,e,n);case this.REQUEST_TYPES.WL:return this._worklight(i,e,n);default:return this._mockRequest(i,e,n)}}},{key:"_postRequest",value:function(t,e){var n="form-"+(new Date).getTime(),i='\n      <form\n        id="'+n+'"\n        style="display:none;"\n        method="POST"\n        target="_blank"\n        action="'+t+'"\n      >\n        <input type="hidden" name="json" value=\''+(0,a.default)(e)+'\' />\n        <input type="hidden" name="x-transaction-token" value="'+this.SessionService.transaction_token+'" />\n      </form>\n    ';this.$document.find("body").append(i);var s=this.$document.find("#"+n);return s.submit(),s.remove()}},{key:"_http",value:function(t,e){var n=t.HTTP,i=this.baseUrl+n.url;return i="string"==typeof e?this._interpolate(i,null):this._interpolate(i,e),this.$log.debug("_http",i,t.method),this.$window.open(i)}},{key:"_worklight",value:function(t,e,n){var a=this,s=t.WL,r=s.adapter,o=WLResourceRequest[t.method]||WLResourceRequest.GET,c=!(!e||!e.doNotOpen);e&&delete e.doNotOpen,this.$log.debug("WORKLIGHT WORKING FOR",s,e);var l=["adapters/",r,"/",s.path].join("");l=this._interpolate(l,e),this.$log.debug("adapterString",l);var u=new WLResourceRequest(l,o);if(e&&(e.urlVars||e.queries)){var d=(0,i.default)({},e.urlVars,e.queries);u.setQueryParameters(d)}var h=e&&e.headers||{};return h[this.headerKeys.ACCEPT_LANGUAGE]=this.LocaleService.localeDisplay.toLowerCase(),u.setHeaders(h),u.send(e&&e.data||null).then((function(t){if(a.$log.debug("Worklight Success",s,e,t),c)return t.responseJSON;a.NativeService.openPDF(t.responseJSON,n)}),(function(t){return a.$log.debug("Worklight Failure",s,e,t),a.$q.reject(t)}))}},{key:"_mockRequest",value:function(t,e,n){var i=this,a=t.MOCK,s=this.defaultConfig.mockBaseURL+a.url,r=a.timeout||this.defaultConfig.timeout;this.$log.debug("_mockRequest",s,this.HTTP_VERBS.GET);var o=this.$q.defer();return this.$http({method:this.HTTP_VERBS.GET,url:s,timeout:r}).success((function(t){e&&e.doNotOpen?o.resolve(t):(i.NativeService.openPDF(t.default||t,n),o.resolve(!0))})).error((function(){o.reject("Failed to get response")})),o.promise}},{key:"_interpolate",value:function(t,e){return e&&e.urlVars?(this.$log.debug("interpolating",t,e),this.$interpolate(t)(e.urlVars)):t}},{key:"openPDFURL",value:function(t){this.EnvironmentService.isNative()?this.NativeService.openPDFURL(t):this.$window.open(t)}}]),t}();l.$inject=["AnalyticsService","EnvironmentService","SessionService","ErrorService","PDFRequestConfig","NativeService","analyticsConstants","errorConstants","serviceConstants","$httpParamSerializer","$interpolate","$log","$q","$window","$document","LocaleService","$http","$translate","$timeout"],e.default=l,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(8)),a=o(n(0)),s=o(n(2)),r=o(n(116));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,s,r,o,c,l){(0,a.default)(this,t),(0,i.default)(this,{AccountHelpersService:e,$translate:n,$filter:s,transactionConstants:r,emtConstants:o,investmentConstants:c,translatePrefix:"transactions.pendingTransactionsList",types:r.TRANSACTION_TYPE_TO_CODE,moveMoneyConstants:l,TRANSACTION_TYPE_FILTER_MAP:r.TRANSACTION_TYPE_FILTER_MAP})}return(0,s.default)(t,[{key:"format",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.category_id)return t.description?t.description:[this.$translate.instant(this.translatePrefix+".to"),this.$translate.instant("global.accountType.CREDIT_CARD"),"-",this.$translate.instant(this.translatePrefix+".account"),t.account_id].join(" ");if(t.mutual_fund)return this._formatMFTransactionTitle(t);switch(t.type){case this.types[this.TRANSACTION_TYPE_FILTER_MAP.billPayment]:return t.to_account.display_name;case this.types[this.TRANSACTION_TYPE_FILTER_MAP.electronicFundTransfer]:return this.$translate.instant(this.translatePrefix+".fullEFTTitle",{type:this.getPendingTransactionTypeOrName(t),number:this.getMaskedNumber(t.to_account?t.to_account.display_name:"")});case this.types[this.TRANSACTION_TYPE_FILTER_MAP.automaticSavingProgram]:return this.$translate.instant(this.translatePrefix+".fullASPTitle",{type:this.getPendingTransactionTypeOrName(t),number:this.getMaskedNumber(t.to_account?t.to_account.display_name:"")});case this.types[this.TRANSACTION_TYPE_FILTER_MAP.emailMoneyTransfer]:return this.$translate.instant(t.emt.type===this.emtConstants.TRANSFER_TYPE.INTERAC_EMT||t.emt.type===this.emtConstants.TRANSFER_TYPE.INTERAC_AUTODEP?this.translatePrefix+".fullEMTInteracTitle":this.translatePrefix+".fullEMTTangerineTitle",{name:t.emt.recipient_name,email:t.emt.recipient_email});case this.types[this.TRANSACTION_TYPE_FILTER_MAP.loanPayment]:return this.$translate.instant(this.translatePrefix+".fullLPTitle",{name:(0,r.default)(t,"to_account.nickname",""),number:this.getMaskedNumber(t.to_account?t.to_account.display_name:"")});default:return[this.$translate.instant(this.translatePrefix+".to"),this.getPendingTransactionTypeOrName(t),this.$translate.instant(this.translatePrefix+".account"),this.getMaskedNumber(t.to_account?t.to_account.display_name:"")].join(" ")}}},{key:"getMaskedNumber",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.$filter("maskNumber")(t)}},{key:"getPendingTransactionTypeOrName",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.to_account?t.to_account.fi_name?t.to_account.fi_name:t.to_account.nickname?t.to_account.nickname:t.to_account.product_description?this.AccountHelpersService.getDisplayNameInstant(t.to_account):"EFT"!==t.type||t.to_account.type?t.to_account.type?this.$translate.instant("global.accountType."+t.to_account.type):t.to_account.display_name:"":""}},{key:"_formatMFTransactionTitle",value:function(t){var e=(0,r.default)(t,"mutual_fund.transaction_type",null);if(e)return this._formatMFTransactionTitleByType(t,e);var n=(0,r.default)(t,"mutual_fund.trade_type",null);return this.$translate.instant(n===this.investmentConstants.TRANSACTION_TYPE.SELL?this.translatePrefix+".fullSellMFTitle":this.translatePrefix+".fullBuyMFTitle",{portfolio:(0,r.default)(t,"mutual_fund.portfolio_name","")})}},{key:"_formatMFTransactionTitleByType",value:function(t,e){return this.formatMFTransactionType(e)+" - "+(0,r.default)(t,"mutual_fund.portfolio_name",null)}},{key:"formatMFTransactionType",value:function(t){var e=this.moveMoneyConstants.MUTUAL_FUND_TRANSACTION_LOCALIZED_TYPES[t];return-1!==[this.moveMoneyConstants.MUTUAL_FUND_TRANSACTION_TYPES.ONGOING_PURCHASE,this.moveMoneyConstants.MUTUAL_FUND_TRANSACTION_TYPES.ONGOING_WITHDRAWAL].indexOf(e)?this.$translate.instant(this.translatePrefix+".mfTypeOverrides."+e):t}}]),t}();c.$inject=["AccountHelpersService","$translate","$filter","transactionConstants","emtConstants","investmentConstants","moveMoneyConstants"],e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DisplayErrorService=void 0;var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=e.DisplayErrorService=function(){function t(e,n,a,s){(0,i.default)(this,t),this.$log=e,this.anchorService=n,this.errorConstants=a,this.errorService=s,this.submitErrors=[]}return(0,a.default)(t,[{key:"resetSubmitErrors",value:function(){this.$log.debug("resetting submit errors"),this.submitErrors=[]}},{key:"showSubmitErrors",value:function(t){var e=this;return this.submitErrors=[],this.errorService.processError(t,this.errorConstants.AVAILABLE_EVENTS.REQUEST_ERROR).then((function(t){e.submitErrors.push(t.message),e.anchorService.scrollToPageContentTop(),e.anchorService.scrollToModalTop()}))}},{key:"hasSubmitErrors",get:function(){return this.submitErrors&&this.submitErrors.length>0}}]),t}();function o(t,e,n,i){return function(){return new r(t,e,n,i)}}o.$inject=["$log","AnchorService","errorConstants","ErrorService"],e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4528)),a=s(n(4532));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("tangerine.addressFormFields",[]).service("AddressFormFieldsService",a.default).component("tngAddressFormFields",i.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4529)),a=s(n(4530));function s(t){return t&&t.__esModule?t:{default:t}}n(4531);var r={template:a.default,controller:i.default,require:{form:"^form"},bindings:{addressObject:"=",addressChange:"&",addressChangeForm:"&",isRequired:"<",isReadOnly:"<",streetPerfect:"<",errors:"<",pageId:"@",showCoNumber:"<?",showStreetNumber:"<?",hideAddressLine2:"<?",addressLine1MaxLength:"<?",addressLine2MaxLength:"<?",hideSuiteField:"<?",suiteMaxLength:"<?",cityMaxLength:"<?",canadianAddressOnly:"<?",invalidCountryCodes:"<?",invalidForm:"&",showValidationOnLoad:"<?",useTpiAddressPattern:"<?",provinceOrStatePlaceholderCode:"@?",postalCodePlaceholderCode:"@?",validatePoBox:"<?",showPoBoxValidationOnLoad:"<?",showWarningBorder:"<?",isCifBusinessType:"<?",preventIncomplete:"<?",isNewClientEnrollment:"<?",selectCanadaOnly:"<?",compactFormat:"<?",validationOrder:"@?",isPostalCodeOptional:"<?",autofocusElementName:"@?",accessibilityOn:"<?"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(8)),a=c(n(0)),s=c(n(2)),r=n(67),o=c(n(268));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,i,s,o,c){(0,a.default)(this,t),this.$timeout=e,this.$log=n,this.ReferenceDataService=i,this.AddressFormFieldsService=s,this.usZipCodePatter=r.usZipCodePatter,this.alphanumericPattern=r.addressPattern,this.cadPostalCodePattern=r.cadAddressPattern,this.onCadAddressPattern=r.onCadAddressPattern,this.qcCadAddressPattern=r.qcCadAddressPattern,this.nsCadAddressPattern=r.nsCadAddressPattern,this.abCadAddressPattern=r.abCadAddressPattern,this.ytCadAddressPattern=r.ytCadAddressPattern,this.skCadAddressPattern=r.skCadAddressPattern,this.peCadAddressPattern=r.peCadAddressPattern,this.nuCadAddressPattern=r.nuCadAddressPattern,this.nlCadAddressPattern=r.nlCadAddressPattern,this.ntCadAddressPattern=r.ntCadAddressPattern,this.nbCadAddressPattern=r.nbCadAddressPattern,this.bcCadAddressPattern=r.bcCadAddressPattern,this.mbCadAddressPattern=r.mbCadAddressPattern,this.streetNumberPattern=r.streetNumberPattern,this.showError=r.showError,this.poBoxPattern=r.poBoxPattern,this.selectConstants=o,this.STAUTS_CODES=c.STATUS_CODES,this.showGenericaPostalCodeError=!1,this.tpiAddressPattern=r.tpiAddressPattern,this.countries=[],this.countryCodes={CA:"CA",US:"US"},this.canadaProvinceCodes={ON:"ON",QC:"QC",AB:"AB",BC:"BC",MB:"MB",NB:"NB",NL:"NL",NS:"NS",PE:"PE",SK:"SK",NT:"NT",YT:"YT",NU:"NU"},this.provinces=[],this.states=[],this.isLoading=!1,this.isCountriesSortAlphabetically=!0,this.showValidationOnLoad=void 0!==this.showValidationOnLoad&&this.showValidationOnLoad,this.isCountryNotCanadaNotAllowed=!1}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;this.MANUAL="MANUAL",this.cachedRequestData={},this.userRemovedStreetPerfect=!1,this.$timeout((function(){t.isNewClientEnrollment&&t.streetPerfect&&t.addressObject.postal_code&&t.onPostalCodeEntered()}),0),this.ReferenceDataService.getDataByType([this.ReferenceDataService.TYPES.PROVINCES,this.ReferenceDataService.TYPES.STATES,this.ReferenceDataService.TYPES.COUNTRIES]).then((function(e){t.provinces=e[t.ReferenceDataService.TYPES.PROVINCES],t.states=e[t.ReferenceDataService.TYPES.STATES],t.originalCountries=e[t.ReferenceDataService.TYPES.COUNTRIES],t.isCountriesSortAlphabetically&&(t.originalCountries=t.originalCountries.sort((function(t,e){var n=t.name.toLowerCase(),i=e.name.toLowerCase();return n.localeCompare(i)}))),t._filterCountries(),t._moveCanadaUSAOnTop(),t._setupSelectAutoCompleteData(),t.addressChange&&t.addressChange()})).finally((function(){t.streetPerfect&&t.onChangeStreetNumber(),t.onChangeAddressLine1(),t.onChangeAddressLine2(),t.onChangeSuiteNo(),t.updateCountry(),t.autofocusElement()}))}},{key:"autofocusElement",value:function(){this.autofocusElementName&&document.getElementById(this.autofocusElementName).focus()}},{key:"$onChanges",value:function(t){if(this.streetPerfect&&this.addressObject&&this.addressObject.address_line1&&this.addressObject.address_line1.length&&(!this.addressObject.street_number||0===this.addressObject.street_number.length)&&/^(\d+|P\.?O)/.test(this.addressObject.address_line1)&&this.addressObject.address_line1.indexOf(" ")>0){var e=o.default.extractAddressStreetNumber({street_name:this.addressObject.address_line1});this.addressObject.street_number=e.street_number,this.addressObject.address_line1=e.street_name}this.originalCountries&&((t.invalidCountryCodes||t.canadianAddressOnly)&&(this._filterCountries(),this._moveCanadaUSAOnTop(),this._setupSelectAutoCompleteData()),t.addressObject&&(this._filterCountries(),this._moveCanadaUSAOnTop(),this._setupSelectAutoCompleteData()))}},{key:"_moveCanadaUSAOnTop",value:function(){var t=this,e=[],n=[];this.countries.forEach((function(i){i.code===t.countryCodes.CA||i.code===t.countryCodes.US?e.push(i):n.push(i)})),this.countries=e.concat(n)}},{key:"_filterCountries",value:function(){var t=this;this.invalidCountryCodes&&this.invalidCountryCodes.length>0?this.countries=this.originalCountries.filter((function(e){return-1===t.invalidCountryCodes.indexOf(e.code)})):this.countries=this.originalCountries,this.addressObject&&this.addressObject.country&&(this.selectedCountryIndex=this.countries.findIndex((function(e){return e.code===t.addressObject.country})),-1===this.selectedCountryIndex&&(this.addressObject.country=null,this.selectedCountryIndex=null))}},{key:"getPCPattern",value:function(){if(this.showGenericaPostalCodeError=!1,this.addressObject)switch(this.addressObject.country){case this.countryCodes.CA:switch(this.addressObject.province){case this.canadaProvinceCodes.ON:return this.onCadAddressPattern;case this.canadaProvinceCodes.QC:return this.qcCadAddressPattern;case this.canadaProvinceCodes.AB:return this.abCadAddressPattern;case this.canadaProvinceCodes.BC:return this.bcCadAddressPattern;case this.canadaProvinceCodes.MB:return this.mbCadAddressPattern;case this.canadaProvinceCodes.NB:return this.nbCadAddressPattern;case this.canadaProvinceCodes.NL:return this.nlCadAddressPattern;case this.canadaProvinceCodes.NS:return this.nsCadAddressPattern;case this.canadaProvinceCodes.PE:return this.peCadAddressPattern;case this.canadaProvinceCodes.SK:return this.skCadAddressPattern;case this.canadaProvinceCodes.NT:return this.ntCadAddressPattern;case this.canadaProvinceCodes.YT:return this.ytCadAddressPattern;case this.canadaProvinceCodes.NU:return this.nuCadAddressPattern}break;case this.countryCodes.US:return this.usZipCodePatter;default:return this.alphanumericPattern}return this.showGenericaPostalCodeError=!0,this.cadPostalCodePattern}},{key:"selectAddressOption",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.MANUAL;this.isNewClientEnrollment&&document.getElementById(this.pageId+"_addressStreetNumber").focus(),this.selectedAddress=t,this._prefill(),this.onAddressChange()}},{key:"onPostalCodeEntered",value:function(){var t=this;if(this.onAddressChange(),this.form[this.pageId+"_postalCode"].$setValidity("invalidBackend",!0),this.form[this.pageId+"_postalCode"].$valid&&this.selectedAddress!==this.MANUAL){if(""===this.addressObject.postal_code)return;var e=this.addressObject.postal_code.replace(" ","");this.isLoading=!0,this.AddressFormFieldsService.getPossibleAddresses(e.toUpperCase()).then((function(e){t.$log.debug("AddressFormFieldsService.getPossibleAddresses Response:",e),e.addresses?(t.possibleAddresses=e.addresses,t.form[t.pageId+"_postalCode"].$setValidity("invalidBackend",!0)):(e.response_status&&e.response_status.status_code&&e.response_status.status_code===t.STAUTS_CODES.SYSTEM_ERROR?t.form[t.pageId+"_postalCode"].$setValidity("invalidBackend",!0):t.form[t.pageId+"_postalCode"].$setValidity("invalidBackend",!1),t.possibleAddresses=null,t.invalidForm({error:"postalCode"})),t.selectedAddress=null,t.isLoading=!1})).catch((function(e){t.$log.debug("AddressFormFieldsService.getPossibleAddresses - Fail to Lookup - Error:",e),t.form[t.pageId+"_postalCode"].$setValidity("invalidBackend",!0),t.possibleAddresses=null,t.selectedAddress=null,t.invalidForm({error:"postalCode"}),t.isLoading=!1}))}}},{key:"updateCountry",value:function(){var t="$ctrl."+this.pageId+"_country";this.form[t]&&(this.selectCanadaOnly&&this.addressObject.country&&this.addressObject.country!==this.countryCodes.CA?(this.isCountryNotCanadaNotAllowed=!0,this.form[t].$setValidity("countryNotCanadaNotAllowed",!1)):(this.isCountryNotCanadaNotAllowed=!1,this.form[t].$setValidity("countryNotCanadaNotAllowed",!0))),this.onAddressChange()}},{key:"updateProvince",value:function(){this.onAddressChange()}},{key:"onChangeStreetNumber",value:function(){this._validatePoBox(this.pageId+"_addressStreetNumber",this.addressObject.street_number),this.onAddressChange()}},{key:"onChangeAddressLine1",value:function(){this._validatePoBox(this.pageId+"_addressLine1",this.addressObject.address_line1),this.onAddressChange()}},{key:"onChangeAddressLine2",value:function(){this._validatePoBox(this.pageId+"_addressLine2",this.addressObject.address_line2),this.checkMinLength(),this.onAddressChange()}},{key:"onChangeSuiteNo",value:function(){this._validatePoBox(this.pageId+"_suiteNo",this.addressObject.suite),this.onAddressChange()}},{key:"_validatePoBox",value:function(t,e){this.form[t].$setValidity("poBoxNotAllowed",!this.validatePoBox||!e||!this.poBoxPattern.test(e.toLowerCase()))}},{key:"isInputFieldInvalid",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!!this.form[t]&&(this.form[t].$invalid&&(this.form[t].$touched||this.showValidationOnLoad||e&&this.showPoBoxValidationOnLoad))}},{key:"isPostalCodeInvalid",value:function(t){return!!this.form[t]&&(this.showError(this.form,t,"required",this.showValidationOnLoad)||this.showError(this.form,t,"pattern",this.showValidationOnLoad)&&this.showGenericaPostalCodeError||this.form[t].$error.pattern)}},{key:"onAddressChange",value:function(){var t=this;this.addressChange&&this.$timeout((function(){t.addressChange({addressObject:t.addressObject})}),0),this.addressChangeForm&&this.$timeout((function(){t.addressChangeForm({formObject:t.form})}),0)}},{key:"changeToUpperCase",value:function(){this.addressObject&&this.addressObject.postal_code&&(this.addressObject.postal_code=this.addressObject.postal_code.toUpperCase())}},{key:"_prefill",value:function(){var t=this,e=this.selectedAddress===this.MANUAL?{}:this.selectedAddress;["city","province","country","address_line1"].forEach((function(n){t.addressObject[n]=e[n]})),this._setupSelectAutoCompleteData()}},{key:"_setupSelectAutoCompleteData",value:function(){var t=this;if(this.addressObject||(this.addressObject={}),this.addressObject.country&&!this.canadianAddressOnly?this.selectedCountryIndex=this.countries.findIndex((function(e){return e.code===t.addressObject.country})):this.selectedCountryIndex=this.countries.findIndex((function(e){return e.code===t.countryCodes.CA})),this.selectedCountryIndex>-1?this.addressObject.country=this.countries[this.selectedCountryIndex].code:(this.selectedCountryIndex=null,this.addressObject.country=null),this.addressObject.province){var e=[];this.addressObject.country===this.countryCodes.CA?e=this.provinces:this.addressObject.country===this.countryCodes.US&&(e=this.states),e.length&&(this.selectedProvince=e.find((function(e){return e.code===t.addressObject.province})))}}},{key:"unselectStreetPerfectAddress",value:function(){this.selectedAddress=null,this.possibleAddresses=void 0,this.userRemovedStreetPerfect=!0,(0,i.default)(this.addressObject,{street_number:"",address_line1:"",address_line2:"",suite:"",city:"",province:void 0}),this.isNewClientEnrollment&&this.form.$setUntouched()}},{key:"checkMinLength",value:function(){this.addressObject.address_line2&&this.addressObject.address_line2.length>0?this.minLength=3:this.minLength=0}},{key:"_checkCountry",value:function(){this.selectCanadaOnly&&this.addressObject.country&&this.addressObject.country!==this.countryCodes.CA&&(this.isCountryNotCanadaNotAllowed=!0)}},{key:"autocompleteProvinces",get:function(){return this.countryCodes.CA===this.addressObject.country?this.provinces:this.states}},{key:"autocompletePlaceholder",get:function(){return this.provinceOrStatePlaceholderCode||(this.countryCodes.CA===this.addressObject.country?"global.addressFormFields.province":"global.addressFormFields.state")}},{key:"postalCodePlaceholder",get:function(){return this.postalCodePlaceholderCode||"global.addressFormFields.placeholders.postalCode"}},{key:"postalCodeValidationRequired",get:function(){return(void 0===this.isPostalCodeOptional||!this.isPostalCodeOptional)&&this.isFieldRequired}},{key:"isFieldRequired",get:function(){return this.isRequired||this.preventIncomplete&&this.isNonEmptyAddress}},{key:"isNonEmptyAddress",get:function(){return!(!this.addressObject||!(this.addressObject.street_number||this.addressObject.care_of||this.addressObject.address_line1||this.addressObject.address_line2||this.addressObject.suite||this.addressObject.city||this.addressObject.postal_code))}}]),t}();l.$inject=["$timeout","$log","ReferenceDataService","AddressFormFieldsService","tngSelectAutocompleteConstants","serviceConstants"],e.default=l,t.exports=e.default},function(t,e){t.exports='<div class="c-address-form-fields"> <div ng-if="$ctrl.isNewClientEnrollment"> <div class="field c-address-form-fields__postal-code top-margin-small"> <input actionable-id="{{::$ctrl.pageId}}_postalCode" validation-order="{{$ctrl.validationOrder}}_01" maxlength="7" class="input" ng-class="{ \'warning\':\n          !$ctrl.form.{{::$ctrl.pageId}}_postalCode.$valid &&\n          ($ctrl.form.{{::$ctrl.pageId}}_postalCode.$touched || $ctrl.showValidationOnLoad)\n        }" type="text" ng-model="$ctrl.addressObject.postal_code" ng-change="$ctrl.onPostalCodeEntered();$ctrl.onAddressChange()" ng-blur="$ctrl.changeToUpperCase();" placeholder="{{::\'global.addressFormFields.placeholders.postalCode\' | translate }}" ng-readonly="$ctrl.isReadOnly" ng-required="$ctrl.postalCodeValidationRequired" ng-pattern="$ctrl.getPCPattern()"/> <div class="field__error" ng-messages="$ctrl.form[$ctrl.pageId + \'_postalCode\'].$error" ng-show="$ctrl.form[$ctrl.pageId + \'_postalCode\'].$touched || $ctrl.showValidationOnLoad"> <p ng-message="required"> {{ ::\'global.validation.required\' | translate }} </p> <p ng-message="pattern"> <span ng-if="$ctrl.addressObject.province">{{ ::\'global.addressFormFields.postalCodeNonMatch\' | translate }}</span> <span ng-if="!$ctrl.addressObject.province">{{ ::\'clientOnboarding.tpiForm.errors.invalidPostalCode\' | translate }}</span> </p> <p ng-message="invalidBackend"> {{ ::\'global.addressFormFields.invalidPostalCode\' | translate }} </p> </div> </div> <div ng-if="$ctrl.streetPerfect && $ctrl.addressObject.postal_code && $ctrl.possibleAddresses"> <label ng-show="$ctrl.possibleAddresses && !$ctrl.selectedAddress" class="heading--sub3"> {{::\'global.addressFormFields.selectAnAddress\' | translate }} </label> <div ng-show="$ctrl.selectedAddress" class="panel c-address-form-fields__address-option--selected margin-bottom-small" ng-class="{ manual: $ctrl.selectedAddress === $ctrl.MANUAL }"> <div ng-if="$ctrl.selectedAddress !== $ctrl.MANUAL"> <div>{{ $ctrl.selectedAddress.address_line1 }}</div> <div>{{ $ctrl.selectedAddress.city }}, {{ $ctrl.selectedAddress.province }}</div> <div>{{ $ctrl.selectedAddress.postal_code }}</div> </div> <div class="c-address-form-fields__cancel-prefill" ng-click="$ctrl.unselectStreetPerfectAddress()"> <i class="icon-x large"></i> </div> </div> <tng-loading-spinner class="c-loading-spinner c-loading-spinner--xs" ng-if="$ctrl.isLoading"> </tng-loading-spinner> <div ng-show="$ctrl.possibleAddresses && !$ctrl.selectedAddress" id="{{::$ctrl.pageId}}_autoAddresses"> <div class="panel c-address-form-fields__address-option" ng-repeat="address in $ctrl.possibleAddresses" ng-click="$ctrl.selectAddressOption(address)"> <div>{{ address.address_line1 }}</div> <div>{{ address.city }}, {{ address.province }}</div> <div>{{ address.postal_code }}</div> </div> </div> </div> </div> <div ng-if="!$ctrl.isNewClientEnrollment"> <div ng-if="$ctrl.streetPerfect" class="field c-address-form-fields__postal-code top-margin-small"> <input actionable-id="{{::$ctrl.pageId}}_postalCode" validation-order="{{$ctrl.validationOrder}}_01" maxlength="7" class="input" ng-class="{ \'warning\':\n          !$ctrl.form.{{::$ctrl.pageId}}_postalCode.$valid &&\n          ($ctrl.form.{{::$ctrl.pageId}}_postalCode.$touched || $ctrl.showValidationOnLoad)\n        }" type="text" ng-model="$ctrl.addressObject.postal_code" ng-change="$ctrl.onPostalCodeEntered();$ctrl.onAddressChange()" ng-blur="$ctrl.changeToUpperCase();" placeholder="{{::\'global.addressFormFields.placeholders.postalCode\' | translate }}" ng-readonly="$ctrl.isReadOnly" ng-required="$ctrl.postalCodeValidationRequired" ng-pattern="$ctrl.getPCPattern()"/> <div class="field__error" ng-messages="$ctrl.form[$ctrl.pageId + \'_postalCode\'].$error" ng-show="$ctrl.form[$ctrl.pageId + \'_postalCode\'].$touched || $ctrl.showValidationOnLoad"> <p ng-message="required"> {{ ::\'global.validation.required\' | translate }} </p> <p ng-message="pattern"> <span ng-if="$ctrl.addressObject.province">{{ ::\'global.addressFormFields.postalCodeNonMatch\' | translate }}</span> <span ng-if="!$ctrl.addressObject.province">{{ ::\'clientOnboarding.tpiForm.errors.invalidPostalCode\' | translate }}</span> </p> <p ng-message="invalidBackend"> {{ ::\'global.addressFormFields.invalidPostalCode\' | translate }} </p> </div> </div> <div ng-if="$ctrl.streetPerfect"> <label ng-show="$ctrl.possibleAddresses && !$ctrl.selectedAddress"> {{::\'global.addressFormFields.selectAnAddress\' | translate }} </label> <div ng-show="$ctrl.selectedAddress" class="panel c-address-form-fields__address-option--selected margin-bottom-small" ng-class="{ manual: $ctrl.selectedAddress === $ctrl.MANUAL }"> <div ng-if="$ctrl.selectedAddress !== $ctrl.MANUAL"> <div>{{ $ctrl.selectedAddress.address_line1 }}</div> <div>{{ $ctrl.selectedAddress.city }}, {{ $ctrl.selectedAddress.province }}</div> <div>{{ $ctrl.selectedAddress.postal_code }}</div> </div> <div ng-if="$ctrl.selectedAddress === $ctrl.MANUAL" class="manual-tile"> {{::\'global.addressFormFields.enterManually\' | translate }} </div> <div class="c-address-form-fields__cancel-prefill" ng-click="$ctrl.selectedAddress = null"> <i class="icon-x large"></i> </div> </div> <tng-loading-spinner class="c-loading-spinner c-loading-spinner--xs" ng-if="$ctrl.isLoading"> </tng-loading-spinner> <div ng-show="$ctrl.possibleAddresses && !$ctrl.selectedAddress" id="{{::$ctrl.pageId}}_autoAddresses"> <div class="panel c-address-form-fields__address-option" ng-repeat="address in $ctrl.possibleAddresses" ng-click="$ctrl.selectAddressOption(address)"> <div>{{ address.address_line1 }}</div> <div>{{ address.city }}, {{ address.province }}</div> <div>{{ address.postal_code }}</div> </div> <div class="panel c-address-form-fields__address-option" ng-click="$ctrl.selectAddressOption()"> {{::\'global.addressFormFields.enterManually\' | translate }} </div> </div> </div> </div> <div ng-show="!$ctrl.isNewClientEnrollment || ($ctrl.isNewClientEnrollment &&\n    $ctrl.addressObject.postal_code && ($ctrl.form.{{::$ctrl.pageId}}_postalCode.$valid || $ctrl.possibleAddresses || $ctrl.userRemovedStreetPerfect)) ||\n    ($ctrl.isNewClientEnrollment && $ctrl.addressObject.province)" class="top-margin-small"> <div ng-if="$ctrl.showStreetNumber || ($ctrl.streetPerfect && !$ctrl.isReadOnly)" class="field top-margin-small"> <input actionable-id="{{::$ctrl.pageId}}_addressStreetNumber" validation-order="{{$ctrl.validationOrder}}_02" class="input" ng-class="{ \'warning\': $ctrl.isInputFieldInvalid($ctrl.pageId + \'_addressStreetNumber\', true) }" type="text" maxlength="8" ng-model="$ctrl.addressObject.street_number" ng-pattern="$ctrl.streetNumberPattern" ng-change="$ctrl.onChangeStreetNumber()" placeholder="{{::\'global.addressFormFields.placeholders.streetNumber\' | translate }}" ng-readonly="$ctrl.isReadOnly" ng-required="$ctrl.isFieldRequired"/> <div class="field__error" ng-messages="$ctrl.form[$ctrl.pageId + \'_addressStreetNumber\'].$error" ng-show="$ctrl.form[$ctrl.pageId + \'_addressStreetNumber\'].$touched || $ctrl.showValidationOnLoad || $ctrl.showPoBoxValidationOnLoad"> <p ng-message="required"> {{ ::\'global.validation.required\' | translate }} </p> <p ng-message="pattern"> {{ ::\'global.addressFormFields.errorCodes.invalidCharacters\' | translate }} </p> <p ng-message="poBoxNotAllowed" ng-if="!$ctrl.isCifBusinessType"> {{ ::\'global.addressFormFields.errorCodes.poBoxNotAllowed\' | translate }} </p> <p ng-message="poBoxNotAllowed" ng-if="$ctrl.isCifBusinessType"> {{ ::\'global.addressFormFields.errorCodes.poBoxNotAllowedBusiness\' | translate }} </p> </div> </div> <div class="field" ng-if="$ctrl.showCoNumber"> <input actionable-id="{{::$ctrl.pageId}}_coNo" validation-order="{{$ctrl.validationOrder}}_03" class="input top-margin-small" ng-class="{ \'warning\': $ctrl.isInputFieldInvalid($ctrl.pageId + \'_coNo\') }" type="text" maxlength="12" ng-model="$ctrl.addressObject.care_of" ng-change="$ctrl.onAddressChange()" placeholder="{{::\'global.addressFormFields.placeholders.coNumber\' | translate }}" ng-readonly="$ctrl.isReadOnly" ng-required="$ctrl.isFieldRequired"/> <div class="field__error" ng-messages="$ctrl.form[$ctrl.pageId + \'_coNo\'].$error" ng-show="$ctrl.form[$ctrl.pageId + \'_coNo\'].$touched || $ctrl.showValidationOnLoad"> <p ng-message="required"> {{ ::\'global.validation.required\' | translate }} </p> </div> </div> <div class="field"> <input actionable-id="{{::$ctrl.pageId}}_addressLine1" validation-order="{{$ctrl.validationOrder}}_04" class="input top-margin-none" ng-class="{ \'warning\': $ctrl.isInputFieldInvalid($ctrl.pageId + \'_addressLine1\', true), \'tangerine-accessible\': $ctrl.accessibilityOn }" type="text" maxlength="{{ $ctrl.addressLine1MaxLength || 27 }}" ng-model="$ctrl.addressObject.address_line1" ng-change="$ctrl.onChangeAddressLine1()" ng-pattern="$ctrl.tpiAddressPattern" placeholder="{{::\'global.addressFormFields.placeholders.addressLine1\' | translate }}" ng-readonly="$ctrl.isReadOnly" ng-required="$ctrl.isFieldRequired"/> <div class="field__error" ng-messages="$ctrl.form[$ctrl.pageId + \'_addressLine1\'].$error" ng-show="$ctrl.form[$ctrl.pageId + \'_addressLine1\'].$touched || $ctrl.showValidationOnLoad || $ctrl.showPoBoxValidationOnLoad"> <p ng-message="required"> {{ ::\'global.validation.required\' | translate }} </p> <p ng-message="pattern"> {{ ::\'global.errorCodes.44087\' | translate }} </p> <p ng-message="poBoxNotAllowed" ng-if="!$ctrl.isCifBusinessType"> {{ ::\'global.addressFormFields.errorCodes.poBoxNotAllowed\' | translate }} </p> <p ng-message="poBoxNotAllowed" ng-if="$ctrl.isCifBusinessType"> {{ ::\'global.addressFormFields.errorCodes.poBoxNotAllowedBusiness\' | translate }} </p> </div> </div> <div class="field" ng-if="!$ctrl.hideAddressLine2"> <input actionable-id="{{::$ctrl.pageId}}_addressLine2" validation-order="{{$ctrl.validationOrder}}_05" class="input top-margin-none" ng-class="{ \'warning\': $ctrl.isInputFieldInvalid($ctrl.pageId + \'_addressLine2\', true), \'tangerine-accessible\': $ctrl.accessibilityOn }" type="text" minlength="{{$ctrl.minLength}}" maxlength="{{ $ctrl.addressLine2MaxLength || 27 }}" ng-model="$ctrl.addressObject.address_line2" ng-change="$ctrl.onChangeAddressLine2()" ng-pattern="$ctrl.tpiAddressPattern" placeholder="{{::\'global.addressFormFields.placeholders.addressLine2\' | translate }}" ng-readonly="$ctrl.isReadOnly" ng-model-options="{ allowInvalid: true}"/> <div class="field__error" ng-messages="$ctrl.form[$ctrl.pageId + \'_addressLine2\'].$error" ng-show="$ctrl.form[$ctrl.pageId + \'_addressLine2\'].$touched || $ctrl.showValidationOnLoad || $ctrl.showPoBoxValidationOnLoad"> <p ng-message="minlength"> {{ ::\'clientOnboarding.tpiForm.errors.minlength3\' | translate }} </p> <p ng-message="pattern"> {{ ::\'global.errorCodes.44087\' | translate }} </p> <p ng-message="poBoxNotAllowed" ng-if="!$ctrl.isCifBusinessType"> {{ ::\'global.addressFormFields.errorCodes.poBoxNotAllowed\' | translate }} </p> <p ng-message="poBoxNotAllowed" ng-if="$ctrl.isCifBusinessType"> {{ ::\'global.addressFormFields.errorCodes.poBoxNotAllowedBusiness\' | translate }} </p> </div> </div> <div class="field" ng-if="!$ctrl.hideSuiteField && (!$ctrl.isReadOnly || $ctrl.addressObject.suite)"> <input actionable-id="{{::$ctrl.pageId}}_suiteNo" validation-order="{{$ctrl.validationOrder}}_06" class="input top-margin-none" ng-class="{ \'warning\': $ctrl.isInputFieldInvalid($ctrl.pageId + \'_suiteNo\', true), \'tangerine-accessible\': $ctrl.accessibilityOn}" type="text" maxlength="{{$ctrl.suiteMaxLength || 8}}" ng-maxlength="$ctrl.suiteMaxLength || 8" ng-pattern="$ctrl.useTpiAddressPattern ? $ctrl.tpiAddressPattern : $ctrl.alphanumericPattern" ng-model="$ctrl.addressObject.suite" ng-change="$ctrl.onChangeSuiteNo()" placeholder="{{::\'global.addressFormFields.placeholders.suiteNumber\' | translate }}" ng-readonly="$ctrl.isReadOnly"/> <div class="field__error" ng-messages="$ctrl.form[$ctrl.pageId + \'_suiteNo\'].$error" ng-show="$ctrl.form[$ctrl.pageId + \'_suiteNo\'].$touched || $ctrl.showValidationOnLoad || $ctrl.showPoBoxValidationOnLoad"> <p ng-message="pattern"> {{ ::\'global.errorCodes.102003\' | translate }} </p> <p ng-message="poBoxNotAllowed" ng-if="!$ctrl.isCifBusinessType"> {{ ::\'global.addressFormFields.errorCodes.poBoxNotAllowed\' | translate }} </p> <p ng-message="poBoxNotAllowed" ng-if="$ctrl.isCifBusinessType"> {{ ::\'global.addressFormFields.errorCodes.poBoxNotAllowedBusiness\' | translate }} </p> </div> </div> <div ng-class="{ \'horizontal-flex-container\': $ctrl.compactFormat }"> <div class="field city"> <input actionable-id="{{::$ctrl.pageId}}_city" validation-order="{{$ctrl.validationOrder}}_07" ng-pattern="$ctrl.tpiAddressPattern" class="input top-margin-none" ng-class="{ \'warning\': $ctrl.isInputFieldInvalid($ctrl.pageId + \'_city\'), \'tangerine-accessible\': $ctrl.accessibilityOn }" type="text" minlength="2" maxlength="{{ $ctrl.cityMaxLength || 32 }}" ng-model="$ctrl.addressObject.city" ng-change="$ctrl.onAddressChange()" placeholder="{{::\'global.addressFormFields.placeholders.city\' | translate }}" ng-readonly="$ctrl.isReadOnly" ng-required="$ctrl.isFieldRequired"/> <div class="field__error" ng-messages="$ctrl.form[$ctrl.pageId + \'_city\'].$error" ng-show="$ctrl.form[$ctrl.pageId + \'_city\'].$touched || $ctrl.showValidationOnLoad"> <p ng-message="required"> {{ ::\'global.validation.required\' | translate }} </p> <p ng-message="minlength"> {{ ::\'clientOnboarding.tpiForm.errors.minlength\' | translate }} </p> <p ng-message="pattern"> {{ ::\'global.errorCodes.615\' | translate }} </p> </div> </div> <div ng-if="!$ctrl.streetPerfect && !$ctrl.isNewClientEnrollment" id="{{::$ctrl.pageId}}_country_wrapper" class="field country top-margin-none tangerine-accessible" ng-class="{ \'tangerine-accessible\': $ctrl.accessibilityOn }"> <tng-select-autocomplete alternate-light="true" ng-if="$ctrl.countries" ng-model="$ctrl.addressObject.country" ng-readonly="$ctrl.isReadOnly || $ctrl.canadianAddressOnly" ng-required="$ctrl.isFieldRequired" ng-warning-border="$ctrl.showWarningBorder" show-default-warnings="$ctrl.showValidationOnLoad" on-select="$ctrl.updateCountry()" options="$ctrl.countries" option-label-key="name" placeholder="{{::\'global.addressFormFields.placeholders.country\' | translate }}" input-id="{{::$ctrl.pageId}}_country" validation-order="{{$ctrl.validationOrder}}_08" select-type="$ctrl.selectConstants.SELECT_TYPE.SIMPLE_FILTERED" enable-for-mobile="true" sort-alphabetically="false"> </tng-select-autocomplete> <div ng-show="$ctrl.showError($ctrl.form, \'{{::$ctrl.pageId}}_country\', \'required\', $ctrl.showValidationOnLoad)" class="field__error">{{ ::\'clientOnboarding.tpiForm.errors.required\' | translate }}</div> <div class="field__error" ng-if="$ctrl.isCountryNotCanadaNotAllowed">{{ ::\'global.addressFormFields.errorCodes.countryNotCanadaNotAllowed\' | translate }}</div> </div> <div ng-if="$ctrl.states && $ctrl.provinces" class="field province" id="{{::$ctrl.pageId}}_province_wrapper" ng-class="{ \'tangerine-accessible\': $ctrl.accessibilityOn }"> <tng-select-autocomplete alternate-light="true" ng-if="$ctrl.addressObject.country === $ctrl.countryCodes.CA || $ctrl.addressObject.country === $ctrl.countryCodes.US" ng-model="$ctrl.addressObject.province" ng-readonly="$ctrl.isReadOnly" ng-required="$ctrl.isFieldRequired" ng-warning-border="$ctrl.showWarningBorder" show-default-warnings="$ctrl.showValidationOnLoad" on-select="$ctrl.updateProvince()" options="$ctrl.autocompleteProvinces" option-label-key="name" placeholder="{{ $ctrl.autocompletePlaceholder }}" input-id="{{::$ctrl.pageId}}_province" validation-order="{{$ctrl.validationOrder}}_09" select-type="$ctrl.selectConstants.SELECT_TYPE.SIMPLE_FILTERED" enable-for-mobile="true" sort-alphabetically="true"> </tng-select-autocomplete> </div> <div class="field postal-code" ng-if="!$ctrl.streetPerfect && !$ctrl.isNewClientEnrollment"> <input actionable-id="{{::$ctrl.pageId}}_postalCode" validation-order="{{$ctrl.validationOrder}}_10" ng-pattern="$ctrl.getPCPattern()" maxlength="10" class="input" ng-class="{ \'warning\': $ctrl.isPostalCodeInvalid($ctrl.pageId + \'_postalCode\'), \'tangerine-accessible\': $ctrl.accessibilityOn }" type="text" ng-model="$ctrl.addressObject.postal_code" ng-change="$ctrl.onAddressChange()" ng-blur="$ctrl.changeToUpperCase();" placeholder="{{ $ctrl.postalCodePlaceholder | translate }}" ng-readonly="$ctrl.isReadOnly" ng-required="$ctrl.postalCodeValidationRequired"/> <div ng-show="$ctrl.errors.postal_code" class="field__error">{{ $ctrl.errors.postal_code }}</div> <div ng-show="$ctrl.showError($ctrl.form, \'{{::$ctrl.pageId}}_postalCode\', \'required\', $ctrl.showValidationOnLoad)" class="field__error">{{ ::\'clientOnboarding.tpiForm.errors.required\' | translate }}</div> <div class="field__error" ng-show="$ctrl.showError($ctrl.form, \'{{::$ctrl.pageId}}_postalCode\', \'pattern\', $ctrl.showValidationOnLoad) && !$ctrl.showGenericaPostalCodeError"> {{::\'clientOnboarding.tpiForm.errors.invalidProviceCode\' | translate }} </div> <div class="field__error" ng-show="$ctrl.form.{{::$ctrl.pageId}}_postalCode.$error.pattern && $ctrl.showGenericaPostalCodeError"> {{::\'clientOnboarding.tpiForm.errors.invalidPostalCode\' | translate }} </div> </div> </div> </div> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.RequesterService=e,this.serviceConstants=n}return(0,a.default)(t,[{key:"getPossibleAddresses",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ADDRESS_AUTOCOMPLETE,{data:{search_address:{postal_code:t}}})}}]),t}();r.$inject=["RequesterService","serviceConstants"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(4534)),a=r(n(4538)),s=r(n(4539));function r(t){return t&&t.__esModule?t:{default:t}}var o=angular.module("tangerine.amountInputModule",[]).component("tngAmountInput",i.default).directive("amountInput",s.default).constant("amountInputConstants",a.default);e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4535)),a=s(n(4536));function s(t){return t&&t.__esModule?t:{default:t}}n(4537);var r={template:i.default,controller:a.default,require:{ngModel:"?ngModel",form:"?^"},bindings:{inputType:"<",inputMaxLength:"<",resetOn:"<",showWarningBorder:"<?",showWarningMessage:"<?",onAmountChange:"&?",onAmountChangeInstant:"&?",setValue:"<?",selectedCurrency:"<?",baseCurrency:"<?",onFocus:"&",disableAutofocus:"<?",onBlur:"&",ngRequired:"<",isDisabled:"<?",nativeInputScrollOptions:"<?",focus:"<?",noDecimals:"<?",showLoader:"<?",maxAmount:"<?",minAmount:"<?",minAmountMessage:"<?",debounceDelay:"<?",actionableIdRoot:"@?",setPlaceholder:"@?",simpleHeader:"@?",simpleSubHeader:"@?",validationOrder:"@?",showCalculator:"@?",openCalculator:"&?",showBorder:"@?",tooltip:"@?",hasError:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-amount-input" input-type="$ctrl.inputType" bind-to="$ctrl.amountValue"> <div ng-if="$ctrl.simpleHeader || $ctrl.simpleSubHeader" class="tng-input-label-container"> <label ng-if="$ctrl.simpleHeader" id="{{$ctrl.actionableIdRoot}}_simple_label" class="header"> {{$ctrl.simpleHeader}} <tng-help-bubble ng-if="$ctrl.tooltip">{{$ctrl.tooltip | translate}}</tng-help-bubble> </label> <div ng-if="$ctrl.simpleSubHeader" class="sub-header"> {{$ctrl.simpleSubHeader}} </div> </div> <div class="c-amount-input__simple-inline" ng-if="$ctrl.isSimpleInputVisible"> <div ng-class="{\n      \'field--simple\': !$ctrl.inline,\n      \'field--inline\': $ctrl.inline,\n      \'calculator-container\': $ctrl.showCalculator}"> <input ng-if="!$ctrl.disableAutofocus" type="tel" class="input" actionable-id="{{$ctrl.actionableIdRoot}}_simple" validation-order="{{$ctrl.validationOrder}}_01" ng-model="$ctrl.amountValue" ng-change="$ctrl.handleAmountInput()" ng-class="{\'show-border\': $ctrl.showBorder,\'warning\': $ctrl.showWarningStyle}" ng-focus="$ctrl.onFocus()" ng-blur="$ctrl.blur($ctrl.amountValue)" autofocus autofocus-device="{{ $ctrl.autoFocusConstants.DESKTOP_ONLY }}" amount-input decimals="{{ $ctrl.noDecimals ? 0 : 2 }}" currency-symbol="$" placeholder="{{ $ctrl.setPlaceholder || $ctrl.placeholder }}" ng-disabled="$ctrl.isDisabled" maxlength="{{ ::$ctrl.maxLength }}" native-input-scroll="{{ $ctrl.nativeInputScrollOptions }}" tng-focus="$ctrl.focus"/> <input ng-if="$ctrl.disableAutofocus" type="tel" class="input" actionable-id="{{$ctrl.actionableIdRoot}}_simple" validation-order="{{$ctrl.validationOrder}}_01" ng-model="$ctrl.amountValue" ng-change="$ctrl.handleAmountInput()" ng-class="{\'show-border\': $ctrl.showBorder,\'warning\': $ctrl.showWarningStyle || $ctrl.hasError}" ng-required="$ctrl.ngRequired" ng-focus="$ctrl.onFocus()" ng-blur="$ctrl.blur($ctrl.amountValue)" amount-input decimals="{{ $ctrl.noDecimals ? 0 : 2 }}" currency-symbol="$" placeholder="{{ $ctrl.setPlaceholder || $ctrl.placeholder }}" ng-disabled="$ctrl.isDisabled" maxlength="{{ ::$ctrl.maxLength }}" native-input-scroll="{{ $ctrl.nativeInputScrollOptions }}" tng-focus="$ctrl.focus"/> <span ng-if="$ctrl.showCalculator" class="icon-calculator-dark x-large" ng-click="$ctrl.onCalculatorClicked()"></span> </div> </div> <div class="c-amount-input__standard-exchange" ng-if="$ctrl.isAmountExchangeInputVisible"> <div class="c-amount-input__currency-controls" ng-if="$ctrl.exchangeControls"> <div class="field__group--inline"> <div class="field"> <input id="CAD_radio" name="pills" ng-click="$ctrl.handleRadioToggle($event)" class="input input--pill" type="radio" ng-checked="$ctrl.activeRadioButtons.CAD" data-exchange-type="CAD"> <label for="CAD_radio">{{ ::\'global.currencies.controls.CAD\' | translate }}</label> </div> <div class="field"> <input id="USD_radio" name="pills" ng-click="$ctrl.handleRadioToggle($event)" class="input input--pill" type="radio" ng-checked="$ctrl.activeRadioButtons.USD" data-exchange-type="USD"/> <label for="USD_radio">{{ ::\'global.currencies.controls.USD\' | translate }}</label> </div> </div> </div> <div class="field--amount-input"> <span ng-if="$ctrl.locale === $ctrl.LOCALES.EN_CA" class="heading heading--currency">$</span> <input ng-if="!$ctrl.disableAutofocus" class="input currency-input" ng-class="::{\'currency-input-french\': $ctrl.locale === $ctrl.LOCALES.FR_CA}" type="tel" actionable-id="{{$ctrl.actionableIdRoot}}_amount-input" placeholder="{{$ctrl.placeHolder}}" ng-model="$ctrl.amountValue" amount-input decimals="{{ $ctrl.noDecimals ? 0 : 2 }}" autofocus autofocus-device="{{ $ctrl.autoFocusConstants.DESKTOP_ONLY }}" ng-change="$ctrl.handleAmountInput()" ng-blur="$ctrl.blur($ctrl.amountValue)" ng-focus="$ctrl.onFocus()" locale="$ctrl.locale" ng-disabled="$ctrl.isDisabled" minlength="{{ $ctrl.noDecimals ? 0 : 2 }}" maxlength="{{ ::$ctrl.maxLength }}" tng-focus="$ctrl.focus" pu-elastic-input pu-elastic-input-width-delta="{{$ctrl.inputWidthDelta}}" native-input-scroll="{{ $ctrl.nativeInputScrollOptions }}"/> <input ng-if="$ctrl.disableAutofocus" class="input currency-input" ng-class="::{\'currency-input-french\': $ctrl.locale === $ctrl.LOCALES.FR_CA}" type="tel" actionable-id="{{$ctrl.actionableIdRoot}}_amount-input" placeholder="{{$ctrl.placeHolder}}" ng-model="$ctrl.amountValue" amount-input decimals="{{ $ctrl.noDecimals ? 0 : 2 }}" ng-change="$ctrl.handleAmountInput()" ng-blur="$ctrl.blur($ctrl.amountValue)" ng-focus="$ctrl.onFocus()" locale="$ctrl.locale" ng-disabled="$ctrl.isDisabled" minlength="{{ $ctrl.noDecimals ? 0 : 2 }}" maxlength="{{ ::$ctrl.maxLength }}" tng-focus="$ctrl.focus" pu-elastic-input pu-elastic-input-width-delta="{{$ctrl.inputWidthDelta}}" native-input-scroll="{{ $ctrl.nativeInputScrollOptions }}"/> <span ng-if="$ctrl.locale === $ctrl.LOCALES.FR_CA" class="heading heading--currency">$</span> <span ng-if="$ctrl.exchangeControls || !$ctrl.isCurrentCurrencyCanadian" class="input input-currency"> {{$ctrl.currentCurrency | tngCurrencySign:true}} </span> <tng-loading-spinner class="c-loading-spinner c-loading-spinner--xs" ng-if="$ctrl.showLoader"> </tng-loading-spinner> </div> <div ng-if="$ctrl.exchangeControls" class="field--amount-conversion field--amount-conversion" ng-class="{ \'dirty\': $ctrl.isDirty }"> <span ng-show="$ctrl.locale === $ctrl.LOCALES.EN_CA" class="heading--currency" ng-class="::{\'heading--currency--ie-fix\': $ctrl.applyIEFix}"> $ </span> <input class="input" ng-class="::{ \'input--ie-fix\': $ctrl.applyIEFix }" type="text" actionable-id="{{$ctrl.actionableIdRoot}}_amount-input-conversion" placeholder="{{$ctrl.placeHolder}}" ng-model="$ctrl.convertedAmount" amount-input decimals="{{ $ctrl.noDecimals ? 0 : 2 }}" ng-readonly="true" pu-elastic-input pu-elastic-input-width-delta="{{$ctrl.inputWidthDelta}}"/> <span ng-if="$ctrl.locale === $ctrl.LOCALES.FR_CA" class="heading heading--currency" ng-class="::{ \'heading--currency--ie-fix\': $ctrl.applyIEFix }"> $ </span> <strong class="currency-type" ng-class="::{ \'currency-type--ie-fix\': $ctrl.applyIEFix }"> &nbsp;{{ $ctrl.currentExchangeCurrency | tngCurrencySign:true }} </strong> </div> </div> </div> <div ng-messages="$ctrl.form[$ctrl.actionableIdRoot + \'_simple\'].$error" ng-show="$ctrl.form[$ctrl.actionableIdRoot + \'_simple\'].$touched" ng-if="$ctrl.showWarningMessage && $ctrl.form[$ctrl.actionableIdRoot + \'_simple\'].$invalid" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> <p ng-message="min"> {{$ctrl.minAmountMessage | translate}} </p> </div> <div ng-messages="$ctrl.form[$ctrl.actionableIdRoot + \'_amount-input\'].$error" ng-show="$ctrl.form[$ctrl.actionableIdRoot + \'_amount-input\'].$touched" ng-if="$ctrl.showWarningMessage && $ctrl.form[$ctrl.actionableIdRoot + \'_amount-input\'].$invalid" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> </div> <div ng-messages="$ctrl.form[$ctrl.actionableIdRoot + \'_amount-input-conversion\'].$error" ng-show="$ctrl.form[$ctrl.actionableIdRoot + \'_amount-input-conversion\'].$touched" ng-if="$ctrl.showWarningMessage && $ctrl.form[$ctrl.actionableIdRoot + \'_amount-input-conversion\'].$invalid" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(15)),a=o(n(33)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,r,o,c,l,u,d,h,f,p,g){var m,_;(0,s.default)(this,t),this.$log=e,this.$translate=n,this.$element=i,this.$scope=r,this.$timeout=o,this.CurrencyExchangeService=h,this.CurrencyService=f,this.EnvironmentService=p,this.autoFocusConstants=g,this.CURRENCY_TYPES=l.CURRENCY_TYPES,this.AMOUNT_INPUT_TYPES=c.AMOUNT_INPUT_TYPES,this.LOCALES=u.LOCALES,this.exchangeControls=!0,this.amountValue="",this.placeHolder="",this.convertedAmount="",this.currentCurrency=this.CURRENCY_TYPES.CAD,this.currentExchangeCurrency=this.CURRENCY_TYPES.USD,this.locale=d.locale,this.isSimpleInputVisible=!1,this.inline=!1,this.isAmountExchangeInputVisible=!1,this.showAmountErr=!1,this._haveExchangeRates=!1,this.activeRadioButtons=(m={},(0,a.default)(m,this.CURRENCY_TYPES.CAD,!0),(0,a.default)(m,this.CURRENCY_TYPES.USD,!1),m),this.placeHolderFormats=(_={},(0,a.default)(_,this.LOCALES.EN_CA,"0.00"),(0,a.default)(_,this.LOCALES.FR_CA,"0,00"),_),this.isDirty=!1,this.maxLength=12,this.widthDelta=60}return(0,r.default)(t,[{key:"setPlaceHolderFormat",value:function(t){this.placeHolder=this.noDecimals?"0":this.placeHolderFormats[t]}},{key:"checkIfInline",value:function(t){var e=this;this.inline=t===this.AMOUNT_INPUT_TYPES.SIMPLE_INLINE,this.inline?this.$translate("global.amountInput").then((function(t){e.locale===e.LOCALES.FR_CA?e.placeholder=t+" $":e.placeholder="$ "+t})):this.placeholder="$"}},{key:"setComponentVisibility",value:function(t){t===this.AMOUNT_INPUT_TYPES.SIMPLE||t===this.AMOUNT_INPUT_TYPES.SIMPLE_INLINE?(this.isSimpleInputVisible=!0,this.isAmountExchangeInputVisible=!1):(this.isSimpleInputVisible=!1,this.isAmountExchangeInputVisible=!0),void 0===this.inputMaxLength?this.maxLength=12:this.maxLength=this.inputMaxLength,this.isSimpleInputVisible&&(this.maxLength+=1)}},{key:"setExchangeControls",value:function(t){this.exchangeControls=t===this.AMOUNT_INPUT_TYPES.STANDARD_EXCHANGE,this.exchangeControls&&!this._haveExchangeRates&&(this.CurrencyExchangeService.getExchangeRates(),this._haveExchangeRates=!0)}},{key:"_convertToUSD",value:function(t){return this.CurrencyExchangeService.calculateExchange(t,this.currentCurrency,this.CURRENCY_TYPES.USD)}},{key:"_convertToCAD",value:function(t){return this.CurrencyExchangeService.calculateExchange(t,this.currentCurrency,this.CURRENCY_TYPES.CAD)}},{key:"convertValue",value:function(t,e){var n=this,i=void 0;if(this._conversionRate)i=this.CurrencyService.isCanadian(e)?t/this._conversionRate:t*this._conversionRate;else switch(e){case this.CURRENCY_TYPES.USD:i=this._convertToCAD(t);break;case this.CURRENCY_TYPES.CAD:i=this._convertToUSD(t);break;default:return}this.convertedAmount=i,"function"==typeof this.onAmountChangeInstant&&this.onAmountChangeInstant({amount:t,currency:e}),"function"==typeof this.onAmountChange&&(this.debounceDelay?(this.onAmountChangeDebouncer&&this.$timeout.cancel(this.onAmountChangeDebouncer),this.onAmountChangeDebouncer=this.$timeout((function(){n.onAmountChange({amount:t,currency:e})}),parseInt(this.debounceDelay,10))):this.onAmountChange({amount:t,currency:e})),this._propagateNgModel(t)}},{key:"_propagateNgModel",value:function(t){var e=this;this.ngModel?(this.ngModel.$setViewValue(t),this.ngRequired&&this.ngModel.$setValidity("required",t>0)):this.amountValue=t,this.ngRequired&&t&&this.isSimpleInputVisible&&this.form&&this.$timeout((function(){var n=e.form[e.actionableIdRoot+"_simple"];n&&n.$setValidity&&n.$setValidity("required",t>0)}),250)}},{key:"blur",value:function(t){this.onBlur&&this.onBlur({amount:t})}},{key:"handleRadioToggle",value:function(t){var e=t.target.attributes["data-exchange-type"].value,n=this.activeRadioButtons,a=(0,i.default)(n);a.forEach((function(t){n[t]=!1})),n[e]=!0,this.currentCurrency=a.filter((function(t){return n[t]}))[0],this.currentExchangeCurrency=a.filter((function(t){return!n[t]}))[0],this.convertValue(this.amountValue,e);var s=this.$element[0].querySelector("#amountInput_exchange");s&&s.focus()}},{key:"checkIsDirty",value:function(){null!==this.amountValue&&""!==this.amountValue&&0!==this.amountValue?this.isDirty=!0:this.isDirty=!1}},{key:"handleAmountInput",value:function(){this.checkIsDirty();var t=this.amountValue;if(this.maxAmount){var e=Math.abs(t),n=Math.abs(this.maxAmount);e>n&&(t=n)}if(this._setMinAmountValidity(),this.EnvironmentService.isIE()&&(this.EnvironmentService.isNative()||"none"!==angular.element(".footer-native").css("display"))){var i=void 0!==angular.element(document.querySelector("tng-amount-input input"))[0]?angular.element(document.querySelector("tng-amount-input input"))[0].style.width:void 0,a=angular.element(document.querySelector("tng-amount-input input")).css("min-width");i&&a&&a!==i&&angular.element(document.querySelector("tng-amount-input input")).css("min-width",i)}this.convertValue(t,this.currentCurrency)}},{key:"onCalculatorClicked",value:function(){var t=this;this.openCalculator&&"function"==typeof this.openCalculator&&this.$timeout((function(){t.openCalculator()}))}},{key:"$onInit",value:function(){var t=this;this.setExchangeControls(this.inputType),this.setComponentVisibility(this.inputType),this.setPlaceHolderFormat(this.locale),this.nativeInputScrollOptions?this.nativeInputScrollOptions.enabled=!0:this.nativeInputScrollOptions={enabled:!1},this.ngModel&&(this.modelWatchDeregister=this.$scope.$watch((function(){return t.ngModel.$viewValue}),(function(e){t.amountValue=e,t.handleAmountInput()})))}},{key:"$onDestroy",value:function(){"function"==typeof this.modelWatchDeregister&&this.modelWatchDeregister()}},{key:"$onChanges",value:function(t){if("noDecimals"in t&&this.amountValue&&this.amountValue.length>0&&(t.noDecimals.currentValue?this.amountValue=Math.floor(this.amountValue).toString():this.amountValue=this.amountValue+".00",this.handleAmountInput()),"resetOn"in t&&(this.amountValue="",this.currentCurrency=this.CURRENCY_TYPES.CAD,this._propagateNgModel()),"selectedCurrency"in t&&t.selectedCurrency.currentValue){var e=t.selectedCurrency.currentValue;if(e in this.activeRadioButtons){var n={target:{attributes:{"data-exchange-type":{value:e}}}};this.handleRadioToggle(n)}}if("baseCurrency"in t&&t.baseCurrency.currentValue){var i=t.baseCurrency.currentValue,a=this.CurrencyService.isCanadian(i)?this.CURRENCY_TYPES.USD:this.CURRENCY_TYPES.CAD;this._conversionRate=this.CurrencyExchangeService.getDisplayRate(i,a),this.$log.debug("using following rate (pegged to baseCurrency):",this._conversionRate)}"setValue"in t&&t.setValue.currentValue&&(this.amountValue=t.setValue.currentValue,this.convertValue(this.amountValue,this.currentCurrency)),this.checkIfInline(this.inputType),this.setComponentVisibility(this.inputType),this.setExchangeControls(this.inputType),this.setPlaceHolderFormat(this.locale),this._setMinAmountValidity()}},{key:"_setMinAmountValidity",value:function(){var t=this;this.$timeout((function(){if(t.isSimpleInputVisible&&t.form){var e=t.form[t.actionableIdRoot+"_simple"],n=!0;if(t.minAmount){var i=parseFloat(t.amountValue);i&&(n=i>=t.minAmount)}e&&e.$setValidity("min",n)}}),250)}},{key:"inputWidthDelta",get:function(){return this.EnvironmentService.isIE()||this.EnvironmentService.isNative()?this.widthDelta:""}},{key:"isCurrentCurrencyCanadian",get:function(){return this.CurrencyService.isCanadian(this.currentCurrency)}},{key:"applyIEFix",get:function(){return this.EnvironmentService.isIE()}},{key:"showWarningStyle",get:function(){if(!this.form)return!1;var t=this.form[this.actionableIdRoot+"_simple"];return!!t&&(this.showWarningBorder&&!t.$valid&&t.$touched)}}]),t}();c.$inject=["$log","$translate","$element","$scope","$timeout","amountInputConstants","accountConstants","localeConstants","LocaleService","CurrencyExchangeService","CurrencyService","EnvironmentService","autoFocusConstants"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={AMOUNT_INPUT_TYPES:{STANDARD:"standard",STANDARD_EXCHANGE:"standard-exchange",SIMPLE:"simple",SIMPLE_INLINE:"simple-inline"}};e.default=i,t.exports=e.default},function(t,e,n){"use strict";(function(i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var a=n(1988);function s(t,e,n,s){return{require:"^ngModel",link:function(t,r,o,c){var l=o.currencySymbol||"",u=r&&r[0],d=void 0;function h(t){return c.$isEmpty(t)?t:e("currency")(t,l,o.decimals).trim()}d=new a.CaretPositioningHelper(r,n,(function(t){return(t||d.inputValue).split("").map((function(t){return i.isNumeric(t)}))}),!1),t.$on("$destroy",(function(){return d.$onDestroy()})),c.$formatters.unshift(h),c.$parsers.unshift((function(t){if(c.$isEmpty(t))return t;var e=t.toString().replace(/[^\d]+/g,"").replace(/^[0]+([1-9])/,"$1")||"0",n=Number(e)/Math.pow(10,o.decimals),i=h(n);return t!==i&&(c.$setViewValue(i),c.$render(),u&&u.required&&c.$setValidity&&s((function(){c.$setValidity("required",n>0)}),100)),n.toString()}))}}}s.$inject=["$locale","$filter","$log","$timeout"],t.exports=e.default}).call(this,n(93))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(4541)),a=o(n(4545)),s=o(n(4550)),r=o(n(4551));function o(t){return t&&t.__esModule?t:{default:t}}var c=angular.module("tangerine.app.core.components.activateOffer",[a.default.name]).service("ActivateOfferService",s.default).constant("activateOfferConstants",r.default).component("tngActivateOffer",i.default);e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4542)),a=s(n(4543));function s(t){return t&&t.__esModule?t:{default:t}}n(4544);var r={template:a.default,controller:i.default,bindings:{activationStatus:"<",params:"<",onClose:"&"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=r(n(1798));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,s,r,o,c,l,u){(0,i.default)(this,t),this.accountConstants=e,this.chooseAccountsFormService=n,this.serviceConstants=a,this.stateConstants=s,this.activateOfferConstants=r,this.$state=c,this.$log=l,this.$q=u,this.activateOfferService=o,this.showSuccess=!1,this.showError=!1,this.isLoading=!0,this.versionTwo=!1,this.accountTiles=[],this.availableProductTiles=[]}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.activateOfferService.activateOffersFromService(this.params.type,this.params.offerId).then((function(e){t.activationResponse=e,t.activationResponse.response_status.status_code===t.serviceConstants.STATUS_CODES.SUCCESS?(t.showSuccess=!0,t.getAllOffers().then((function(e){e.status===t.serviceConstants.STATUS_CODES.SUCCESS?t.getAccountDetails():t.isLoading=!1})).catch((function(e){t.$log.debug(e),t.errorActions()}))):t.errorActions()})).catch((function(e){t.$log.debug(e),t.errorActions()}))}},{key:"$postLink",value:function(){this.params.version===this.activateOfferConstants.VERSIONS.V2&&(this.versionTwo=!0)}},{key:"errorActions",value:function(){this.showSuccess=!1,this.showError=!0,this.isLoading=!1}},{key:"getAllOffers",value:function(){var t=this;this.profileProductTypes=[],this.allProfileProductTypes=[];var e=this.$q.defer();return this.activateOfferService.getAllPromos().then((function(n){n.offers&&n.offers.length>0&&(n.offers.forEach((function(e){t.activateOfferService.isValidOffer(e)&&e.rate_offer_details.rates.forEach((function(e){t.profileProductTypes.push(e.profile_product_type),t.allProfileProductTypes.push(e.profile_product_type)}))})),e.resolve({status:t.serviceConstants.STATUS_CODES.SUCCESS})),e.reject({status:t.serviceConstants.STATUS_CODES.NO_DATA})})).catch((function(){e.reject({status:t.serviceConstants.STATUS_CODES.NO_DATA})})),e.promise}},{key:"getAccountDetails",value:function(){var t=this;this.activateOfferService.getAccountDetails().then((function(e){e.status===t.serviceConstants.STATUS_CODES.SUCCESS?(e.accounts.forEach((function(e){t.profileProductTypes.indexOf(e.profile_product_type)>-1&&!0===e.is_primary_owner&&(t.accountTiles.push(e),(0,s.default)(t.allProfileProductTypes,(function(t){return t===e.profile_product_type})))})),t.allProfileProductTypes.length>0?t.getAvailableProducts():(t.isLoading=!1,t.$log.debug("Activate Offer Component: No qualified products to display"))):(t.isLoading=!1,t.$log.debug("Activate Offer Component: No account tiles to display"))})).catch((function(){t.isLoading=!1,t.$log.debug("Activate Offer Component: No accounts to display")}))}},{key:"getAvailableProducts",value:function(){var t=this;this.availableProductTiles=[],this.chooseAccountsFormService.getAccountsRates().then((function(e){e.rates&&e.rates.length>0?(t.allProfileProductTypes.forEach((function(n){var i=e.rates.find((function(t){return t.profile_product_type===n}));t.availableProductTiles.push({name:i.product_description,rate:n})})),t.availableProductTiles=t.availableProductTiles.filter((function(e){return e.rate===t.accountConstants.ACCOUNT_PPTS.USDSAVINGS})).concat(t.availableProductTiles.filter((function(e){return e.rate!==t.accountConstants.ACCOUNT_PPTS.USDSAVINGS}))),t.isLoading=!1):(t.isLoading=!1,t.$log.debug("Activate Offer Component: No account rates to display"))})).catch((function(){t.isLoading=!1,t.$log.debug("Activate Offer Component: No account rates to display")}))}},{key:"onModalClose",value:function(t){t&&"moveMoney"===t.type?this.showMoveMoney=!1:this.onClose()}},{key:"onNextStepButtonClick",value:function(t){switch(t){case this.activateOfferConstants.BUTTONS.MOVE_MONEY:this.showMoveMoney=!0;break;case this.activateOfferConstants.BUTTONS.OPEN_NEW_ACCOUNT:this.onModalClose(),this.$state.go(this.stateConstants.EXISTING_CLIENT_ONBOARDING)}}}]),t}();o.$inject=["accountConstants","ChooseAccountsFormService","serviceConstants","stateConstants","activateOfferConstants","ActivateOfferService","$state","$log","$q"],e.default=o,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose()" class="c-move-money"> <div ng-if="$ctrl.isLoading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <header class="c-activate-offer__title" ng-show="!$ctrl.isLoading && $ctrl.showSuccess && !$ctrl.versionTwo"> {{\'activateOffer.successfulOffer.title\'|translate}} </header> <header class="c-activate-offer__title" ng-show="!$ctrl.isLoading && $ctrl.showSuccess && $ctrl.versionTwo"> {{\'activateOffer.successfulOffer.title_v2\'|translate}} </header> <header class="c-activate-offer__title" ng-show="!$ctrl.isLoading && $ctrl.showError"> {{\'activateOffer.offerError.title\'|translate}} </header> <div ng-show="!$ctrl.isLoading && $ctrl.showSuccess"> <p class="margin__tb margin__tb--fix2" ng-show="!$ctrl.versionTwo" ng-bind-html="$ctrl.accountTiles.length > 0 ? \'activateOffer.successfulOffer.offerMessageWithAccounts\':\'activateOffer.successfulOffer.offerMessageNoAccounts\' | translate"></p> <p class="margin__tb margin__tb--fix2" ng-show="$ctrl.versionTwo" ng-bind-html="$ctrl.accountTiles.length > 0 ? \'activateOffer.successfulOffer.offerMessageWithAccounts_v2\':\'activateOffer.successfulOffer.offerMessageNoAccounts\' | translate"></p> <div ng-show="$ctrl.accountTiles.length > 0"> <p><b ng-bind-html="\'activateOffer.successfulOffer.accountsWithBonus\' | translate" class="c-activate-offer__paragraph" ng-show="!$ctrl.versionTwo"></b></p> <p><b ng-bind-html="\'activateOffer.successfulOffer.accountsWithBonus_v2\' | translate" class="c-activate-offer__paragraph" ng-show="$ctrl.versionTwo"></b></p> <div class="c-account-section__accounts c-activate-offer__item-container grid__container"> <div class="grid__column--1of2" ng-repeat="account in $ctrl.accountTiles"> <tng-activate-offer-item account="account" is-tile-view="true" class="c-account-section__grid-item c-activate-offer__account-card"></tng-activate-offer-item> </div> </div> </div> <div> <button class="btn btn--auto margin__r margin__r--fix2 margin__tb margin__tb--fix2" ng-show="$ctrl.accountTiles.length > 0" ng-click="$ctrl.onNextStepButtonClick($ctrl.activateOfferConstants.BUTTONS.MOVE_MONEY)">{{::\'activateOffer.buttons.moveMoney\'|translate}} </button> <button class="btn btn--auto margin__tb margin__tb--fix2" ng-class="$ctrl.accountTiles.length > 0 ? \'btn--edit\':\'margin__r margin__r--fix2\'" ng-show="!$ctrl.versionTwo && $ctrl.availableProductTiles.length <= 0" ng-click="$ctrl.onNextStepButtonClick($ctrl.activateOfferConstants.BUTTONS.OPEN_NEW_ACCOUNT)">{{::\'activateOffer.buttons.openAccount\'|translate}} </button> </div> </div> <div ng-if="!$ctrl.versionTwo && $ctrl.availableProductTiles.length > 0"> <p class="c-activate-offer__paragraph"><b ng-bind-html="\'activateOffer.successfulOffer.otherAccounts.title\' | translate"></b></p> <div class="c-account-section__accounts c-activate-offer__item-container grid__container"> <div class="grid__column--1of2" ng-repeat="product in $ctrl.availableProductTiles"> <tng-activate-offer-item account="product" is-tile-view="true" class="c-account-section__grid-item c-activate-offer__account-card"></tng-activate-offer-item> </div> </div> <div> <button class="btn btn--auto margin__r margin__r--fix2 margin__tb margin__tb--fix2" ng-class="{\n            \'btn--edit\': $ctrl.accountTiles.length > 0\n          }" ng-if="!$ctrl.versionTwo" ng-click="$ctrl.onNextStepButtonClick($ctrl.activateOfferConstants.BUTTONS.OPEN_NEW_ACCOUNT)">{{::\'activateOffer.buttons.openAccount\'|translate}} </button> </div> </div> <div ng-show="!$ctrl.isLoading && $ctrl.showError"> <p ng-bind-html="\'activateOffer.offerError.errorMessage\' | translate"></p> </div> <footer> <button class="btn btn--auto banner--internal-page__button margin__b--fix1" ng-click="$ctrl.onModalClose()"> {{::\'activateOffer.buttons.close\'|translate}} </button> </footer> </tng-modal-dialog> <tng-move-money ng-if="$ctrl.showMoveMoney" on-close="$ctrl.onModalClose({\n      type:\'moveMoney\'\n    })"></tng-move-money> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4546),s=(i=a)&&i.__esModule?i:{default:i};e.default=angular.module("tangerine.app.core.components.activateOffer.activateOfferItem",[]).component("tngActivateOfferItem",s.default),t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4547)),a=s(n(4548));function s(t){return t&&t.__esModule?t:{default:t}}n(4549),e.default={template:i.default,controller:a.default,bindings:{account:"<"}},t.exports=e.default},function(t,e){t.exports='<div class="c-activate-offer-item"> <p class="account-card__name"> <span class="account-card__nickname">{{ $ctrl.accountName }}</span> <span class="account-card__number">{{ $ctrl.account.display_name | maskNumber }}</span> </p> <p class="account-card__prod-name">{{ $ctrl.description }}</p> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.$translate=e,this.accountHelpersService=n}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.setDescription(),this.accountHelpersService.getDisplayName(this.account).then((function(e){t.accountName=e}))}},{key:"setDescription",value:function(){this.isRspPAL?this.description=this.account.description:this.account.description?this.description=this.$translate.instant(""+this.account.description):this.description=""}},{key:"isRspPAL",get:function(){return this.account.isRspLoanPostApproval}}]),t}();r.$inject=["$translate","AccountHelpersService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l){(0,i.default)(this,t),this.accountSummaryService=e,this.accountDetailsService=n,this.requesterService=a,this.serviceConstants=s,this.promoRateOfferConstants=r,this.accountConstants=o,this.$httpParamSerializer=c,this.offerStatus=r.OFFER_STATUS,this.$q=l,this.currentOfferId="",this.savingsAccounts=[],this.savingsDetails=[]}return(0,a.default)(t,[{key:"getAllPromos",value:function(){return this.requesterService.request(this.serviceConstants.AVAILABLE_SERVICES.CUSTOMER_OFFERS,{urlVars:{queryString:this.$httpParamSerializer({"fetch-all":!0})}})}},{key:"isValidOffer",value:function(t){return t.offer_id===this.currentOfferId&&t.offer_status===this.offerStatus.ACTIV}},{key:"activateOffersFromService",value:function(t,e){this.currentOfferId=e;var n={offerId:e},i={offer:{offer_type:t}};return this.requesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACTIVATE_CUSTOMER_OFFERS,{urlVars:n,data:i})}},{key:"getAccountDetails",value:function(){var t=this;this.savingsAccounts=[],this.savingsDetails=[];var e=this.$q.defer();return this.accountSummaryService.getAccounts().then((function(n){t.savingsAccounts=n.accounts.filter((function(e){return e.type===t.accountConstants.ACCOUNT_TYPES.SAVINGS})),t.savingsAccounts.length>0?t.savingsAccounts.forEach((function(n){t.accountDetailsService.getAccountDetails(n.number).then((function(i){i.response_status.status_code===t.serviceConstants.STATUS_CODES.SUCCESS?(angular.extend(i.account_summary,n),t.savingsDetails.push(i.account_summary),t.savingsDetails.length===t.savingsAccounts.length&&e.resolve({status:t.serviceConstants.STATUS_CODES.SUCCESS,accounts:t.savingsDetails})):e.reject({status:t.serviceConstants.STATUS_CODES.NO_DATA,accounts:[]})}))})):e.reject({status:t.serviceConstants.STATUS_CODES.NO_DATA,accounts:[]})})),e.promise}}]),t}();r.$inject=["AccountSummaryService","AccountDetailsService","RequesterService","serviceConstants","promoRateOfferConstants","accountConstants","$httpParamSerializer","$q"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={BUTTONS:{MOVE_MONEY:"MOVE_MONEY",OPEN_NEW_ACCOUNT:"OPEN_NEW_ACCOUNT"},VERSIONS:{V2:"V2"}},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4553),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("tangerine.app.core.components.checkboxInput",[]).component("tngCheckboxInput",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4554)),a=s(n(4555));function s(t){return t&&t.__esModule?t:{default:t}}n(4556);var r={template:i.default,controller:a.default,require:{form:"?^"},bindings:{inputId:"@?",requiredValidationMessage:"@?",simpleHeader:"@?",label:"@",tngChange:"&?",tngDisabled:"<?",tngModel:"=",tngRequired:"<?",validationOrder:"@?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<section class="c-checkbox-input"> <div class="field"> <label id="{{$ctrl.inputId}}_label" class="hidden" aria-hidden="true"></label> <section class="tng-input-label-container"> <label ng-if="$ctrl.simpleHeader"> <div class="header" ng-if="$ctrl.simpleHeader"> {{$ctrl.simpleHeader}} </div> </label> </section> <input actionable-id="{{::$ctrl.inputId}}" class="input" type="checkbox" ng-model="$ctrl.tngModel" validation-order="{{$ctrl.validationOrder}}" ng-change="$ctrl.onChangeHandler()" ng-disabled="$ctrl.tngDisabled" ng-required="$ctrl.tngRequired"/> <label for="{{::$ctrl.inputId}}" id="{{ $ctrl.inputId }}_labelAdjacent" ng-bind-html="$ctrl.label"> </label> <div ng-messages="$ctrl.form[$ctrl.inputId].$error" ng-show="$ctrl.form[$ctrl.inputId].$invalid && $ctrl.form[$ctrl.inputId].$dirty" class="field__error top-margin-small"> <p ng-message="required"> <span ng-if="$ctrl.requiredValidationMessage">{{$ctrl.requiredValidationMessage}}</span> <span ng-if="!$ctrl.requiredValidationMessage">{{::\'global.validation.required\' | translate }}</span> </p> </div> </div> </section> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.$timeout=e}return(0,a.default)(t,[{key:"onChangeHandler",value:function(){var t=this;"function"==typeof this.tngChange&&this.$timeout((function(){return t.tngChange()}),0)}}]),t}();r.$inject=["$timeout"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(4558)),a=l(n(4563)),s=l(n(4568)),r=l(n(4573)),o=l(n(4578)),c=l(n(4583));function l(t){return t&&t.__esModule?t:{default:t}}var u=angular.module("tangerine.app.core.components.creditCardDialogs",[]).service("CardDialogService",c.default).component("tngCreditCardActivateDialog",i.default).component("tngCreditCardActivateReplacementCardDialog",a.default).component("tngCreditCardChangePinDialog",s.default).component("tngCreditCardPauseDialog",r.default).component("tngCreditCardReactivateDialog",o.default);e.default=u,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(4559);Object.defineProperty(e,"default",{enumerable:!0,get:function(){return(t=i,t&&t.__esModule?t:{default:t}).default;var t}}),t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4560)),a=s(n(4561));function s(t){return t&&t.__esModule?t:{default:t}}n(4562);var r={template:i.default,controller:a.default,bindings:{cardNumber:"<?",card:"<?",onClose:"&",isCreditCardSettingsFlow:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose({})" class="c-credit-card-activate-dialog" analytics-id="credit-card-activate" hide-close="$ctrl.isLoading"> <header> <div ng-if="!$ctrl.isSuccess"> {{ ::(\'global.modals.activateCreditDialog.title\' | translate) }} </div> <div ng-if="$ctrl.isSuccess"> {{ ::(\'global.modals.activateCreditDialog.successTitle\' | translate) }} </div> </header> <div ng-if="$ctrl.isLoading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div ng-show="$ctrl.submitErrors.length > 0"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors"> {{error | translate : { cardName : $ctrl.card.description }}} </li> </ul> </tng-error-message> </div> <div ng-if="!$ctrl.isLoading"> <div ng-if="!$ctrl.isSuccess"> <div class="c-credit-card-activate-dialog__card-number-box"> <p class="body--4"> {{ ::(\'global.modals.activateCreditDialog.cardNumber\' | translate) }} </p> <span class="c-credit-card-activate-dialog__card-number"> {{$ctrl.card.displayName || $ctrl.card.display_name}} </span> </div> <form class="c-credit-card-activate-dialog__body" name="$ctrl.activateForm"> <div class="c-credit-card-activate-dialog__left-col"> <p ng-if="!$ctrl.card.reissue && !$ctrl.card.activateReplacement" class="c-credit-card-activate-dialog__intro body--2"> {{ ::(\'global.modals.activateCreditDialog.intro\' | translate) }} </p> <div class="c-credit-card-activate-dialog__field-label"> {{ ::(\'global.modals.activateCreditDialog.cvv\' | translate) }} </div> <div class="c-credit-card-activate-dialog__field"> <input actionable-id="ccdialog_activate_cvc" ng-model="$ctrl.cvc2" placeholder="{{ ::(\'global.placeholder.3digits\' | translate) }}" class="input" required minlength="3" maxlength="3" type="tel" ng-pattern="$ctrl.numbersOnlyPattern"/> </div> <div ng-messages="$ctrl.activateForm.ccdialog_activate_cvc.$error" ng-show="$ctrl.isFieldInvalid(\'ccdialog_activate_cvc\')" class="field__error"> <p ng-message="required"> {{ ::(\'global.validation.required\' | translate)}} </p> <p ng-message="pattern"> {{ ::(\'global.validation.onlyNumbers\' | translate)}} </p> <p ng-message="minlength"> {{ ::(\'global.validation.exact3digits\' | translate)}} </p> </div> <div ng-if="$ctrl.shouldShowPIN()"> <div class="c-credit-card-activate-dialog__field-label"> {{ ::(\'global.modals.activateCreditDialog.enterPin\' | translate) }} </div> <div class="c-credit-card-activate-dialog__field"> <input actionable-id="ccdialog_activate_pin" placeholder="{{ ::(\'global.modals.activateCreditDialog.4digits\' | translate) }}" class="input" ng-model="$ctrl.pin" ng-pattern="$ctrl.numbersOnlyPattern" minlength="4" maxlength="4" required pin-input/> </div> <div ng-messages="$ctrl.activateForm.ccdialog_activate_pin.$error" ng-show="$ctrl.isFieldInvalid(\'ccdialog_activate_pin\')" class="field__error"> <p ng-message="required"> {{ ::(\'global.validation.required\' | translate)}} </p> <p ng-message="pattern"> {{ ::(\'global.validation.onlyNumbers\' | translate)}} </p> <p ng-message="minlength"> {{ ::(\'global.validation.exact4digits\' | translate)}} </p> <p ng-message="pinSequential"> {{ ::(\'global.modals.activateCreditDialog.validation.pinSequential\' | translate)}} </p> </div> <div class="c-credit-card-activate-dialog__field-label"> {{ ::(\'global.modals.activateCreditDialog.confirmPin\' | translate) }} </div> <div class="c-credit-card-activate-dialog__field"> <input actionable-id="ccdialog_activate_confirmpin" placeholder="{{ ::(\'global.modals.activateCreditDialog.4digits\' | translate) }}" class="input" ng-model="$ctrl.pinConfirm" ng-pattern="$ctrl.numbersOnlyPattern" minlength="4" maxlength="4" required pin-input/> </div> <div ng-messages="$ctrl.activateForm.ccdialog_activate_confirmpin.$error" ng-show="$ctrl.isFieldInvalid(\'ccdialog_activate_confirmpin\')" class="field__error"> <p ng-message="required"> {{\'global.validation.required\' | translate}} </p> <p ng-message="pattern"> {{\'global.validation.onlyNumbers\' | translate}} </p> <p ng-message="minlength"> {{\'global.validation.exact4digits\' | translate}} </p> </div> <div ng-show="$ctrl.pinConfirm.length > 0 && !$ctrl.pinMatch()" class="c-credit-card-change-pin-dialog__field-warning"> {{ ::(\'global.modals.activateCreditDialog.validation.pin\' | translate) }} </div> </div> </div> <div class="c-credit-card-activate-dialog__right-col"> <div class="c-credit-card-activate-dialog__finding-cvv-box"> <h3 class="c-credit-card-activate-dialog__finding-cvv-title"> {{ ::(\'global.modals.activateCreditDialog.findingCvvTitle\' | translate) }} </h3> <p class="body--4"> {{ ::(\'global.modals.activateCreditDialog.findingCvvBody\' | translate) }} </p> <div class="c-credit-card-activate-dialog__finding-cvv-image"> <img ng-src="assets/images/credit_card_cvv.png" alt="{{ ::(\'global.modals.activateCreditDialog.findingCvvTitle\' | translate) }}"> </div> </div> </div> </form> </div> <div ng-if="$ctrl.isSuccess"> <p class="c-credit-card-activate-dialog__success-body" ng-bind-html="\'global.modals.activateCreditDialog.successIntro\' | translate : { \n          ccNumber: ($ctrl.card.displayName || $ctrl.card.display_name),\n          description: $ctrl.card.description\n        }"> </p> </div> </div> <footer> <div ng-if="!$ctrl.isSuccess"> <button actionable-id="activate-credit-dialog-cancel" class="btn--edit" ng-click="$ctrl.onClose({})"> {{ ::(\'global.modals.activateCreditDialog.cancel\' | translate) }} </button> <button actionable-id="activate-credit-dialog-activate" class="btn" ng-click="$ctrl.activate()" ng-disabled="!$ctrl.formValid() || !$ctrl.pinMatch() || $ctrl.isLoading"> {{ (\'global.modals.activateCreditDialog.activate\' | translate) }} </button> </div> <div ng-if="$ctrl.isSuccess"> <button actionable-id="activate-credit-dialog-done" class="btn" ng-click="$ctrl.onReloadAvailableActions()"> {{ ::(\'global.modals.activateCreditDialog.done\' | translate) }} </button> </div> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(8)),a=c(n(0)),s=c(n(2)),r=c(n(116)),o=n(67);function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,s,r,c,l,u,d,h){(0,a.default)(this,t),(0,i.default)(this,{$log:e,CardsService:n,STATUS_CODES:s.STATUS_CODES,CardDialogService:l,AccountDetailsService:u,accountConstants:d,$q:h}),this.isSuccess=!1,this.submitErrors=[],this.pin="",this.pinConfirm="",this.cvc2="",this.numbersOnlyPattern=o.numbersOnlyPattern,this.stateConstants=c,this.$state=r}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;return this.card?this.$q.resolve(this.card):(this.isLoading=!0,this._getAccountDetails(this.cardNumber).then((function(e){return t.card={accountDetails:e,reissue:(0,r.default)(e,"account_summary.credit_card.cc_account_details.card_details.reissue"),activateReplacement:(0,r.default)(e,"account_summary.credit_card.cc_account_details.card_details.activate_replacement"),displayName:(0,r.default)(e,"account_summary.credit_card.cc_account_details.card_details.card_number_display_name"),number:t.cardNumber,productType:(0,r.default)(e,"account_summary.credit_card.cc_account_details.product_info.product_type"),description:t.AccountDetailsService.getCCAccountNameByProductType((0,r.default)(e,"account_summary.credit_card.cc_account_details.product_info.product_type"))},t.card})).finally((function(){t.isLoading=!1})))}},{key:"_getAccountDetails",value:function(t){var e=this;return this.AccountDetailsService.getAccountDetails(t,this.accountConstants.ACCOUNT_TYPES.CREDIT_CARD).catch((function(t){throw e.$log.error("error occurred getting account details "+t),e.submitErrors.push(t),t}))}},{key:"activate",value:function(){var t=this;return this.submitErrors=[],this.isLoading=!0,this.CardsService.activateCard(this.card,this.cvc2,this.pin).then((function(e){t.$log.debug("activateCard response: ",e),e&&e.response_status.status_code===t.STATUS_CODES.SUCCESS?t.isSuccess=!0:t.submitErrors=t.CardsService.extractErrors(e),t.isLoading=!1})).catch((function(e){throw t.$log.error("Error occurred activating card "+e),t.submitErrors.push(e),t.isLoading=!1,e}))}},{key:"formValid",value:function(){return this.activateForm&&this.activateForm.$valid}},{key:"isFieldInvalid",value:function(t){return!!this.activateForm[t]&&(this.activateForm[t].$setValidity("pinSequential",!this.CardDialogService.doesPINHaveSequence(this.pin)),this.activateForm[t].$touched&&this.activateForm[t].$invalid&&this.activateForm[t].$dirty)}},{key:"onReloadAvailableActions",value:function(){return this.onClose&&this.onClose(),this.isCreditCardSettingsFlow?this.$state.go(this.stateConstants.USER_SETTINGS_GENERAL,{ignoreCache:!0},{reload:!0}):this.$state.go(this.stateConstants.ACCOUNT_DETAILS_CREDIT_CARD,{ignoreCache:!0},{reload:!0})}},{key:"pinMatch",value:function(){return this.pin===this.pinConfirm}},{key:"shouldShowPIN",value:function(){return!this.card.reissue&&!this.card.activateReplacement&&!this.card.productChanged}}]),t}();l.$inject=["$log","CardsService","serviceConstants","$state","stateConstants","CardDialogService","AccountDetailsService","accountConstants","$q"],e.default=l,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(4564);Object.defineProperty(e,"default",{enumerable:!0,get:function(){return(t=i,t&&t.__esModule?t:{default:t}).default;var t}}),t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4565)),a=s(n(4566));function s(t){return t&&t.__esModule?t:{default:t}}n(4567);var r={template:i.default,controller:a.default,bindings:{cardNumber:"<?",card:"<?",onClose:"&",isCreditCardSettingsFlow:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose({})" class="c-credit-card-activate-dialog" hide-close="$ctrl.isLoading"> <header> <div ng-if="!$ctrl.isSuccess"> {{ ::(\'global.modals.activateCreditDialog.replacementCard.title\' | translate) }} </div> <div ng-if="$ctrl.isSuccess"> {{ ::(\'global.modals.activateCreditDialog.successTitle\' | translate) }} </div> </header> <div ng-if="$ctrl.isLoading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div ng-show="$ctrl.submitErrors.length > 0"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> </div> <div ng-if="!$ctrl.isLoading"> <div ng-if="!$ctrl.isSuccess"> <div class="c-credit-card-activate-dialog__card-number-box"> <p class="body--4"> {{ ::(\'global.modals.activateCreditDialog.cardNumber\' | translate) }} </p> <span class="c-credit-card-activate-dialog__card-number"> {{$ctrl.card.displayName || $ctrl.card.display_name}} </span> </div> <form class="c-credit-card-activate-dialog__body" name="$ctrl.activateForm"> <div class="c-credit-card-activate-dialog__left-col"> <p class="c-credit-card-activate-dialog__intro body--2"> {{ ::(\'global.modals.activateCreditDialog.replacementCard.intro\' | translate) }} </p> <div class="c-credit-card-activate-dialog__field-label"> {{ ::(\'global.modals.activateCreditDialog.replacementCard.cvv\' | translate) }} </div> <div class="c-credit-card-activate-dialog__field"> <input actionable-id="ccdialog_activate_cvc" placeholder="{{ ::(\'global.modals.activateCreditDialog.3digits\' | translate) }}" class="input" maxlength="3" ng-model="$ctrl.cvc2" ng-pattern="/^[0-9]{3}$/" required type="tel" pattern="[0-9]"/> </div> <div class="c-credit-card-change-pin-dialog__field-warning" ng-show="$ctrl.isFieldInvalid(\'ccdialog_activate_cvc\')"> {{ ::(\'global.modals.activateCreditDialog.validation.cvc\' | translate) }} </div> </div> <div class="c-credit-card-activate-dialog__right-col"> <div class="c-credit-card-activate-dialog__finding-cvv-box"> <h3 class="c-credit-card-activate-dialog__finding-cvv-title"> {{ ::(\'global.modals.activateCreditDialog.findingCvvTitle\' | translate) }} </h3> <p class="body--4"> {{ ::(\'global.modals.activateCreditDialog.findingCvvBody\' | translate) }} </p> <div class="c-credit-card-activate-dialog__finding-cvv-image"> <img ng-src="assets/images/credit_card_cvv.png" alt="{{ ::(\'global.modals.activateCreditDialog.findingCvvTitle\' | translate) }}"> </div> </div> </div> </form> </div> <div ng-if="$ctrl.isSuccess"> <p class="c-credit-card-activate-dialog__success-body" ng-bind-html="\'global.modals.activateCreditDialog.replacementCard.successIntro\' | translate : { \n       cardName: $ctrl.getCCAccountName(),\n       ccNumber: $ctrl.displayCCNum\n    }"> </p> </div> </div> <footer> <div ng-if="!$ctrl.isSuccess"> <button actionable-id="activate-credit-dialog-replacement-cancel" class="btn--edit" ng-click="$ctrl.onClose({})"> {{ ::(\'global.modals.activateCreditDialog.replacementCard.cancel\' | translate) }} </button> <button actionable-id="activate-credit-dialog-replacement-activate" class="btn" ng-click="$ctrl.activate()" ng-disabled="!$ctrl.formValid() || $ctrl.isLoading"> {{ (\'global.modals.activateCreditDialog.replacementCard.activate\' | translate) }} </button> </div> <div ng-if="$ctrl.isSuccess"> <button actionable-id="activate-credit-dialog-replacement-done" class="btn" ng-click="$ctrl.onReloadAvailableActions()"> {{ ::(\'global.modals.activateCreditDialog.replacementCard.done\' | translate) }} </button> </div> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(8)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,s,r,o,c,l){(0,a.default)(this,t),(0,i.default)(this,{$log:e,CardsService:n,CustomersService:s,AccountDetailsService:r,STATUS_CODES:o.STATUS_CODES}),this.isSuccess=!1,this.submitErrors=[],this.cvc2="",this.displayCCNum="",this.$state=c,this.stateConstants=l}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;this.displayCCNum=this.card.displayName,this.card||this.CustomersService.getCustomerCreditCards().then((function(e){t.card=t._findCard(e.cards),t.displayCCNum=t.card.displayName})).catch((function(e){t.$log.error(e),t.submitErrors.push(e)}))}},{key:"_findCard",value:function(t){var e=this;return t.find((function(t){return e.cardNumber===t.number}))}},{key:"activate",value:function(){var t=this;this.submitErrors=[],this.isLoading=!0,this.CardsService.activateReplacementCard(this.card,this.cvc2).then((function(e){t.$log.debug("activateCard response: ",e),e&&e.response_status.status_code===t.STATUS_CODES.SUCCESS?t.isSuccess=!0:t.submitErrors=t.CardsService.extractErrors(e),t.isLoading=!1})).catch((function(e){t.$log.error(e),t.submitErrors.push(e),t.isLoading=!1}))}},{key:"formValid",value:function(){return this.activateForm&&this.activateForm.$valid}},{key:"onReloadAvailableActions",value:function(){this.onClose(),this.isCreditCardSettingsFlow?this.$state.go(this.stateConstants.USER_SETTINGS_GENERAL,{ignoreCache:!0},{reload:!0}):this.$state.go(this.stateConstants.ACCOUNT_DETAILS_CREDIT_CARD,{ignoreCache:!0},{reload:!0})}},{key:"isFieldInvalid",value:function(t){return!!this.activateForm[t]&&(this.activateForm[t].$invalid&&this.activateForm[t].$dirty)}},{key:"getCCAccountName",value:function(){return this.AccountDetailsService.getCCAccountNameByProductType(this.card.productType)}}]),t}();o.$inject=["$log","CardsService","CustomersService","AccountDetailsService","serviceConstants","$state","stateConstants"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(4569);Object.defineProperty(e,"default",{enumerable:!0,get:function(){return(t=i,t&&t.__esModule?t:{default:t}).default;var t}}),t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4570)),a=s(n(4571));function s(t){return t&&t.__esModule?t:{default:t}}n(4572);var r={template:i.default,controller:a.default,bindings:{card:"<",onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose({})" class="c-credit-card-change-pin-dialog" analytics-id="credit-card-change-pin" hide-close="$ctrl.isLoading"> <header> <div ng-if="!$ctrl.isSuccess"> {{ ::(\'userSettings.general.creditCard.changePinDialog.title\' | translate) }} </div> <div ng-if="$ctrl.isSuccess"> {{ ::(\'userSettings.general.creditCard.changePinDialog.successTitle\' | translate) }} </div> </header> <div ng-if="$ctrl.isLoading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div ng-if="!$ctrl.isLoading"> <div ng-show="$ctrl.submitErrors.length > 0" class="margin__b--fix2"> <tng-error-message> {{ $ctrl.submitErrors[0] }} </tng-error-message> </div> <div ng-if="!$ctrl.isSuccess"> <div class="c-credit-card-change-pin-dialog__card-number-box"> <p class="body--4"> {{ ::(\'userSettings.general.creditCard.changePinDialog.cardNumber\' | translate) }} </p> <span class="c-credit-card-change-pin-dialog__card-number"> {{$ctrl.card.displayName || $ctrl.card.display_name}} </span> </div> <p>{{ ::(\'userSettings.general.creditCard.changePinDialog.intro\' | translate) }}</p> <form class="c-credit-card-change-pin-dialog__body" name="$ctrl.changePinForm"> <div class="c-credit-card-change-pin-dialog__left-col"> <div class="c-credit-card-change-pin-dialog__field-label"> {{ ::(\'userSettings.general.creditCard.changePinDialog.cvv\' | translate) }} </div> <div class="c-credit-card-change-pin-dialog__field"> <input actionable-id="ccdialog_changepin_cvc" class="input" placeholder="{{ ::(\'userSettings.general.creditCard.changePinDialog.3digits\' | translate) }}" ng-model="$ctrl.cvc2" ng-pattern="$ctrl.numbersOnlyPattern" maxlength="3" minlength="3" type="tel" required/> </div> <div ng-messages="$ctrl.changePinForm.ccdialog_changepin_cvc.$error" ng-show="$ctrl.isFieldInvalid(\'ccdialog_changepin_cvc\')" class="field__error"> <p ng-message="required"> {{\'global.validation.required\' | translate}} </p> <p ng-message="pattern"> {{\'global.validation.onlyNumbers\' | translate}} </p> <p ng-message="minlength"> {{\'global.validation.exact3digits\' | translate}} </p> </div> <div class="c-credit-card-change-pin-dialog__field-label"> {{ ::(\'userSettings.general.creditCard.changePinDialog.enterPin\' | translate) }} </div> <div class="c-credit-card-change-pin-dialog__field"> <input actionable-id="ccdialog_changepin_pin" class="input" placeholder="{{ ::(\'userSettings.general.creditCard.changePinDialog.4digits\' | translate) }}" ng-model="$ctrl.pin" ng-pattern="$ctrl.numbersOnlyPattern" required maxlength="4" minlength="4" pin-input/> </div> <div ng-messages="$ctrl.changePinForm.ccdialog_changepin_pin.$error" ng-show="$ctrl.isFieldInvalid(\'ccdialog_changepin_pin\')" class="field__error"> <p ng-message="required"> {{\'global.validation.required\' | translate}} </p> <p ng-message="pattern"> {{\'global.validation.onlyNumbers\' | translate}} </p> <p ng-message="minlength"> {{\'global.validation.exact4digits\' | translate}} </p> <p ng-message="pinSequential"> {{ ::(\'userSettings.general.creditCard.changePinDialog.validation.pin.nosequential\' | translate)}} </p> </div> <div class="c-credit-card-change-pin-dialog__field-label"> {{ ::(\'userSettings.general.creditCard.changePinDialog.confirmPin\' | translate) }} </div> <div class="c-credit-card-change-pin-dialog__field"> <input actionable-id="ccdialog_changepin_pinconfirm" class="input" placeholder="{{ ::(\'userSettings.general.creditCard.changePinDialog.4digits\' | translate) }}" ng-model="$ctrl.pinConfirm" ng-pattern="$ctrl.numbersOnlyPattern" required maxlength="4" minlength="4" pin-input/> </div> <div ng-messages="$ctrl.changePinForm.ccdialog_changepin_pinconfirm.$error" ng-show="$ctrl.isFieldInvalid(\'ccdialog_changepin_pinconfirm\')" class="field__error"> <p ng-message="required"> {{\'global.validation.required\' | translate}} </p> <p ng-message="pattern"> {{\'global.validation.onlyNumbers\' | translate}} </p> <p ng-message="minlength"> {{\'global.validation.exact4digits\' | translate}} </p> </div> <div ng-show="$ctrl.pinConfirm.length > 0 && !$ctrl.pinMatch()" class="c-credit-card-change-pin-dialog__field-warning"> {{ ::(\'userSettings.general.creditCard.changePinDialog.validation.pin.notTheSame\' | translate) }} </div> </div> <div class="c-credit-card-change-pin-dialog__right-col"> <div class="c-credit-card-change-pin-dialog__finding-cvv-box"> <h3> {{ ::(\'userSettings.general.creditCard.changePinDialog.findingCvvTitle\' | translate) }} </h3> <p class="body--4"> {{ ::(\'userSettings.general.creditCard.changePinDialog.findingCvvBody\' | translate) }} </p> <div class="c-credit-card-change-pin-dialog__finding-cvv-image"> <img ng-src="assets/images/credit_card_cvv.png" alt="{{ ::(\'userSettings.general.creditCard.changePinDialog.findingCvvTitle\' | translate) }}"> </div> </div> </div> </form> </div> <div ng-if="$ctrl.isSuccess"> <p> {{ ::(\'userSettings.general.creditCard.changePinDialog.successIntro\' | translate) }} </p> </div> </div> <footer> <div ng-if="!$ctrl.isSuccess"> <button actionable-id="credit-card-dialog-btn-cancel" class="btn--edit" ng-click="$ctrl.onClose({})"> {{ ::(\'userSettings.general.creditCard.changePinDialog.cancel\' | translate) }} </button> <button actionable-id="credit-card-dialog-btn-submit" class="btn" ng-click="$ctrl.changePin()" ng-disabled="!$ctrl.formValid() || $ctrl.isLoading"> {{ ::(\'userSettings.general.creditCard.changePinDialog.submit\' | translate) }} </button> </div> <div ng-if="$ctrl.isSuccess"> <button actionable-id="credit-card-dialog-btn-done" class="btn" ng-click="$ctrl.onClose({})"> {{ ::(\'userSettings.general.creditCard.changePinDialog.done\' | translate) }} </button> </div> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(8)),a=o(n(0)),s=o(n(2)),r=n(67);function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,s,o,c){(0,a.default)(this,t),(0,i.default)(this,{$log:e,CardsService:n,STATUS_CODES:s.STATUS_CODES,$translate:o,CardDialogService:c}),this.isSuccess=!1,this.submitErrors=[],this.pin="",this.pinConfirm="",this.cvc2="",this.numbersOnlyPattern=r.numbersOnlyPattern}return(0,s.default)(t,[{key:"changePin",value:function(){var t=this;this.submitErrors=[],this.isLoading=!0,this.CardsService.changeCardPin(this.card,this.cvc2,this.pin).then((function(e){t.$log.debug("changeCardPin response: ",e),e&&e.response_status.status_code===t.STATUS_CODES.SUCCESS?t.isSuccess=!0:e&&e.response_status.status_code===t.STATUS_CODES.VALIDATION_ERROR?t.submitErrors.push(t.$translate.instant("global.modals.activateCreditDialog.validation.cvc2Invalid")):t.submitErrors.push(t.$translate.instant("global.errorCodes."+e.response_status.status_code,{cardName:t.card.description})),t.isLoading=!1})).catch((function(e){t.$log.error(e),t.submitErrors.push(e),t.isLoading=!1}))}},{key:"formValid",value:function(){return this.changePinForm.$valid&&this.pinMatch()}},{key:"isFieldInvalid",value:function(t){return this.changePinForm[t].$setValidity("pinSequential",!this.CardDialogService.doesPINHaveSequence(this.pin)),!!this.changePinForm[t]&&(this.changePinForm[t].$touched&&this.changePinForm[t].$invalid&&this.changePinForm[t].$dirty)}},{key:"pinMatch",value:function(){return this.pin===this.pinConfirm}}]),t}();c.$inject=["$log","CardsService","serviceConstants","$translate","CardDialogService"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(4574);Object.defineProperty(e,"default",{enumerable:!0,get:function(){return(t=i,t&&t.__esModule?t:{default:t}).default;var t}}),t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4575)),a=s(n(4576));function s(t){return t&&t.__esModule?t:{default:t}}n(4577);var r={template:i.default,controller:a.default,bindings:{card:"<",onClose:"&",reactivate:"&",isCreditCardSettingsFlow:"<?",pausePreviousCard:"<",reactivatePreviousCard:"="}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose({reload: $ctrl.isPaused})" class="c-credit-card-pause-dialog" analytics-id="credit-card-pause" hide-close="$ctrl.isLoading"> <header> <span ng-if="!$ctrl.isPaused"> {{ ::(\'userSettings.general.creditCard.pauseDialog.title\' | translate) }} </span> <span ng-if="$ctrl.isPaused"> {{ ::(\'userSettings.general.creditCard.pauseDialog.titlePaused\' | translate) }} </span> </header> <div ng-if="$ctrl.isLoading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div ng-if="!$ctrl.isLoading" class="c-credit-card-pause-dialog__body"> <div ng-show="$ctrl.submitErrors.length > 0"> <tng-error-message> {{ $ctrl.submitErrors[0] }} </tng-error-message> </div> <div ng-if="!$ctrl.isPaused"> <p ng-bind-html="\'userSettings.general.creditCard.pauseDialog.bodyIntro\' | translate: {cardNumber: $ctrl.getMaskedAccountNumber() }"> </p> <p ng-bind-html="\'userSettings.general.creditCard.pauseDialog.body\' | translate"> </p> </div> <div ng-if="$ctrl.isPaused"> <p ng-bind-html="\'userSettings.general.creditCard.pauseDialog.bodyPaused\' | translate: { date: ($ctrl.pauseExpiry | date: \'longDate\') }"> </p> <div class="c-credit-card-pause-dialog__info-panel"> <span class="c-credit-card-pause-dialog__info-panel-status"> {{ ::(\'userSettings.general.creditCard.pauseDialog.cardStatus\' | translate) }} <span class="c-credit-card-pause-dialog__info-panel-paused"> {{ ::(\'userSettings.general.cards.status.paused\' | translate) }} </span> </span> <span class="c-credit-card-pause-dialog__info-panel-right"> {{ ::(\'userSettings.general.creditCard.pauseDialog.pausedDate\' | translate) }} <span class="c-credit-card-pause-dialog__info-panel-date"> {{$ctrl.today | date:\'longDate\'}} </span> </span> <div class="clearfix"></div> </div> <div class="c-credit-card-pause-dialog__number-panel"> <span class="c-credit-card-pause-dialog__number-panel-label"> {{ ::(\'userSettings.general.creditCard.pauseDialog.cardNumber\' | translate) }} </span> <div class="c-credit-card-pause-dialog__number-panel-value"> {{ $ctrl.getMaskedAccountNumber() }} </div> </div> </div> </div> <footer> <div ng-if="!$ctrl.isPaused"> <button actionable-id="credit-card-dialog-btn-cancel" class="btn--edit" ng-click="$ctrl.onClose()"> {{ ::(\'userSettings.general.creditCard.pauseDialog.cancel\' | translate) }} </button> <button actionable-id="credit-card-dialog-btn-pause" class="btn--warn" ng-click="$ctrl.pauseCard()" ng-disabled="$ctrl.isLoading"> {{ ::(\'userSettings.general.creditCard.pauseDialog.pause\' | translate) }} </button> </div> <div ng-if="$ctrl.isPaused"> <button actionable-id="credit-card-dialog-btn-done" class="btn" ng-click="$ctrl.onReloadAvailableActions()"> {{ ::(\'userSettings.general.creditCard.pauseDialog.done\' | translate) }} </button> <button actionable-id="credit-card-dialog-btn-reactivate" class="btn" ng-click="$ctrl.reactivate({card: $ctrl.card})"> {{ ::(\'userSettings.general.creditCard.pauseDialog.reactivate\' | translate) }} </button> </div> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(8)),a=o(n(0)),s=o(n(2)),r=o(n(45));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,s,r,o,c){(0,a.default)(this,t),this.$log=e,(0,i.default)(this,{CardsService:n,AccountHelpersService:s,STATUS_CODES:r.STATUS_CODES}),this.submitErrors=[],this.$state=o,this.stateConstants=c}return(0,s.default)(t,[{key:"getMaskedAccountNumber",value:function(){var t=void 0;return t=this.pausePreviousCard?this.card.previousDisplayName:this.card.displayName||this.card.display_name||this.card.number,this.AccountHelpersService.getMaskedAccountNumber(t)}},{key:"pauseCard",value:function(){var t=this;this.isLoading=!0,this.submitErrors=[],this.today=(0,r.default)().format("YYYY-MM-DD"),this.CardsService.pauseCard(this.card).then((function(e){t.$log.debug("Pause Card Response: ",e),e&&e.response_status.status_code===t.STATUS_CODES.SUCCESS?(t.isPaused=!0,t.pauseExpiry=(0,r.default)().add(15,"days").format("YYYY-MM-DD"),t.reactivatePreviousCard=!!t.pausePreviousCard):t._raiseErrors(e),t.isLoading=!1})).catch((function(e){t._raiseErrors(e),t.isLoading=!1}))}},{key:"onReloadAvailableActions",value:function(){this.onClose(),this.isCreditCardSettingsFlow?this.$state.go(this.stateConstants.USER_SETTINGS_GENERAL,{ignoreCache:!0},{reload:!0}):this.$state.go(this.stateConstants.ACCOUNT_DETAILS_CREDIT_CARD,{ignoreCache:!0},{reload:!0})}},{key:"_raiseErrors",value:function(t){this.$log.error("Pause Card Error:",t),this.submitErrors.push(t)}}]),t}();c.$inject=["$log","CardsService","AccountHelpersService","serviceConstants","$state","stateConstants"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(4579);Object.defineProperty(e,"default",{enumerable:!0,get:function(){return(t=i,t&&t.__esModule?t:{default:t}).default;var t}}),t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4580)),a=s(n(4581));function s(t){return t&&t.__esModule?t:{default:t}}n(4582);var r={template:i.default,controller:a.default,bindings:{card:"<",onClose:"&",isCreditCardSettingsFlow:"<?",reactivatePreviousCard:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose({reload: $ctrl.isSuccess})" class="c-credit-card-reactivate-dialog" analytics-id="credit-card-reactivate" hide-close="$ctrl.isLoading"> <header> <div ng-if="!$ctrl.isSuccess"> {{ ::(\'userSettings.general.creditCard.reactivateDialog.title\' | translate) }} </div> <div ng-if="$ctrl.isSuccess"> {{ ::(\'userSettings.general.creditCard.reactivateDialog.successTitle\' | translate) }} </div> </header> <div ng-show="$ctrl.submitErrors.length > 0"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors"> {{error | translate : { cardName: $ctrl.getCCAccountName()} }} </li> </ul> </tng-error-message> <br> </div> <div ng-if="$ctrl.isLoading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div ng-if="!$ctrl.isLoading"> <div ng-if="!$ctrl.isSuccess"> <div class="c-credit-card-reactivate-dialog__card-number-box"> <p class="body--4"> {{ ::(\'userSettings.general.creditCard.reactivateDialog.cardNumber\' | translate) }} </p> <span class="c-credit-card-reactivate-dialog__card-number"> {{ $ctrl.getDisplayName() }} </span> </div> <form class="c-credit-card-reactivate-dialog__body" name="$ctrl.reactivateForm"> <div class="c-credit-card-reactivate-dialog__left-col"> <p class="c-credit-card-reactivate-dialog__intro body--2"> {{ ::(\'userSettings.general.creditCard.reactivateDialog.foundMisplacedCC\' | translate) }} </p> <p class="c-credit-card-reactivate-dialog__intro body--2"> {{ ::(\'userSettings.general.creditCard.reactivateDialog.intro\' | translate) }} </p> <div class="c-credit-card-reactivate-dialog__field-label"> {{ ::(\'userSettings.general.creditCard.reactivateDialog.cvv\' | translate) }} </div> <div class="c-credit-card-reactivate-dialog__field"> <input actionable-id="ccdialog_reactivate_cvc" ng-model="$ctrl.cvc2" id="cvcinput" placeholder="{{ ::(\'global.placeholder.3digits\' | translate) }}" class="input" required minlength="3" maxlength="3" type="tel" ng-pattern="$ctrl.numbersOnlyPattern" tng-focus="true"/> </div> <div ng-messages="$ctrl.reactivateForm.ccdialog_reactivate_cvc.$error" ng-show="$ctrl.isFieldInvalid(\'ccdialog_reactivate_cvc\')" class="field__error"> <p ng-message="required"> {{ ::(\'global.validation.required\' | translate)}} </p> <p ng-message="pattern"> {{ ::(\'global.validation.onlyNumbers\' | translate)}} </p> <p ng-message="minlength"> {{ ::(\'global.validation.exact3digits\' | translate)}} </p> </div> </div> <div class="c-credit-card-reactivate-dialog__right-col"> <div class="c-credit-card-reactivate-dialog__finding-cvv-box"> <h3 class="c-credit-card-reactivate-dialog__finding-cvv-title"> {{ ::(\'userSettings.general.creditCard.reactivateDialog.findingCvvTitle\' | translate) }} </h3> <p class="body--4"> {{ ::(\'userSettings.general.creditCard.reactivateDialog.findingCvvBody\' | translate) }} </p> <div class="c-credit-card-reactivate-dialog__finding-cvv-image"> <img ng-src="assets/images/credit_card_cvv.png" alt="{{ ::(\'userSettings.general.creditCard.reactivateDialog.findingCvvTitle\' | translate) }}"> </div> </div> </div> </form> </div> <div ng-if="$ctrl.isSuccess"> <p class="c-credit-card-reactivate-dialog__success-body" ng-bind-html="::\'userSettings.general.creditCard.reactivateDialog.successIntro\' | translate : {cardName: $ctrl.getCCAccountName()}"> </p> </div> </div> <footer> <div ng-if="!$ctrl.isSuccess"> <button actionable-id="credit-card-reactivate-btn-cancel" class="btn--edit" ng-click="$ctrl.onClose()"> {{ ::(\'userSettings.general.creditCard.reactivateDialog.cancel\' | translate) }} </button> <button actionable-id="credit-card-reactivate-btn-reactivate" class="btn" ng-click="$ctrl.reactivateCard()" ng-disabled="!$ctrl.formValid() || $ctrl.isLoading"> {{ ::(\'userSettings.general.creditCard.reactivateDialog.reactivate\' | translate) }} </button> </div> <div ng-if="$ctrl.isSuccess"> <button actionable-id="credit-card-reactivate-btn-done" class="btn" ng-click="$ctrl.onReloadAvailableActions()"> {{ ::(\'userSettings.general.creditCard.reactivateDialog.done\' | translate) }} </button> </div> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(8)),a=o(n(0)),s=o(n(2)),r=n(67);function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,s,o,c,l,u){(0,a.default)(this,t),(0,i.default)(this,{$log:e,CardsService:n,STATUS_CODES:s.STATUS_CODES,AccountDetailsService:l,accountConstants:u}),this.isSuccess=!1,this.submitErrors=[],this.cvc2="",this.numbersOnlyPattern=r.numbersOnlyPattern,this.$state=o,this.stateConstants=c,this.accountConstants=u}return(0,s.default)(t,[{key:"isFieldInvalid",value:function(t){return!!this.reactivateForm[t]&&(this.reactivateForm[t].$touched&&this.reactivateForm[t].$invalid&&this.reactivateForm[t].$dirty)}},{key:"reactivateCard",value:function(){var t=this;this.isLoading=!0,this.submitErrors=[],this.CardsService.reactivateCard(this.card,this.cvc2).then((function(e){t.$log.debug("reactivateCard response: ",e),e&&e.response_status.status_code===t.STATUS_CODES.SUCCESS?t.isSuccess=!0:t.submitErrors=t.CardsService.extractErrors(e),t.isLoading=!1})).catch((function(e){t.$log.error(e),t.submitErrors.push(e),t.isLoading=!1}))}},{key:"onReloadAvailableActions",value:function(){this.onClose(),this.isCreditCardSettingsFlow?this.$state.go(this.stateConstants.USER_SETTINGS_GENERAL,{ignoreCache:!0},{reload:!0}):this.$state.go(this.stateConstants.ACCOUNT_DETAILS_CREDIT_CARD,{ignoreCache:!0},{reload:!0})}},{key:"formValid",value:function(){return this.reactivateForm.$valid}},{key:"getDisplayName",value:function(){return this.reactivatePreviousCard?this.card.previousDisplayName:this.card.displayName||this.card.display_name}},{key:"getCCAccountName",value:function(){var t=void 0;return t=this.reactivatePreviousCard?this.accountConstants.CREDIT_CARD_PRODUCT_TYPES_CODE.CBK:this.card.productType,this.AccountDetailsService.getCCAccountNameByProductType(t)}}]),t}();c.$inject=["$log","CardsService","serviceConstants","$state","stateConstants","AccountDetailsService","accountConstants"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(){(0,i.default)(this,t)}return(0,a.default)(t,[{key:"doesPINHaveSequence",value:function(t){if(!t)return!1;var e=function(e,n,i,a){return i>=t.length-1?e:e&&+n+a===+t[i+1]},n=t.split("").reduce((function(t,n,i){return e(t,n,i,1)}),!0),i=t.split("").reduce((function(t,n,i){return e(t,n,i,-1)}),!0);return n||i}}]),t}();e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4585),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("tangerine.app.core.components.jointAccountForm",[]).component("tngJointAccountForm",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4586)),a=s(n(4587));function s(t){return t&&t.__esModule?t:{default:t}}n(4588);var r={template:i.default,controller:a.default,bindings:{account:"<?",consentContent:"@",jointContact:"=",jointContactUpdated:"&?",recipients:"<",showSharingConsent:"<?",sharingConsentHeader:"@?",sharingConsentLabel:"@?",sharingConsentTooltip:"@?",emtModalOpened:"&?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<section class="c-joint-account-form"> <ng-form name="$ctrl.form" no-validate> <section class="medium-width-section" ng-if="!$ctrl.jointContact && $ctrl.recipients.length > 0"> <h3 class="top-margin-medium">{{::\'mortgage.jointAccountForm.searchContacts.heading\' | translate}}</h3> <section class="top-margin-small"> <tng-select-autocomplete alternate-light="true" enable-for-mobile="true" input-id="{{::$ctrl.pageId}}_jointContact" ng-model="$ctrl.jointContact" ng-model-set-raw-object="true" ng-warning-border="true" on-select="$ctrl.onSelectHandler()" options="$ctrl.recipients" option-label-key="jointLabel" placeholder="{{::\'mortgage.jointAccountForm.searchContacts.placeholder\'}}" ng-required="true" select-autocomplete-validation-message="{{::\'mortgage.jointAccountForm.searchContacts.selectAutocompleteValidationMessage\' | translate}}" select-type="$ctrl.selectConstants.SELECT_TYPE.SIMPLE_FILTERED" simple-filtered="true" suggestions-search-filter="$ctrl.suggestionsSearchFilter(input, element)" sort-alphabetically="true" validation-order="_01"></tng-select-autocomplete> </section> </section> <section class="medium-width-section top-margin-small" ng-if="!$ctrl.jointContact"> <button class="btn btn--edit" ng-click="$ctrl.addRecipient()">{{::\'mortgage.jointAccountForm.searchContacts.addNew\' | translate}} </button> </section> <table class="top-margin-large" ng-if="$ctrl.jointContact"> <thead> <tr> <th>{{::\'mortgage.jointAccountForm.contacts.coApplicantName\' | translate}}</th> <th>{{::\'mortgage.jointAccountForm.contacts.email\' | translate}}</th> <th class="hide-mobile">{{::\'mortgage.jointAccountForm.contacts.preferredLanguage\' | translate}}</th> <th class="hide-mobile">{{::\'mortgage.jointAccountForm.contacts.securityQuestion\' | translate}}</th> <th class="hide-mobile"></th> </tr> </thead> <tbody> <tr> <td> <strong> {{$ctrl.jointContact.first_name}} {{$ctrl.jointContact.last_name}} </strong> </td> <td> <strong> {{$ctrl.jointContact.email_address}} </strong> </td> <td class="hide-mobile"> <strong> <span ng-if="$ctrl.jointContact.email_language === \'en\'">{{::\'global.language.english\' | translate}}</span> <span ng-if="$ctrl.jointContact.email_language === \'fr\'">{{::\'global.language.french\' | translate}}</span> </strong> </td> <td class="hide-mobile"> <strong>{{$ctrl.jointContact.email_question}}</strong> </td> <td class="hide-mobile"> <button actionable-id="{{::$ctrl.pageId}}_editRecipient" class="btn btn--edit" ng-click="$ctrl.editRecipient()" type="button">{{::\'global.components.buttons.edit\' | translate}} </button> </td> </tr> </tbody> </table> <button ng-if="$ctrl.jointContact" actionable-id="{{::$ctrl.pageId}}_editRecipient" class="btn btn--edit show-mobile margin__t--fix1" ng-click="$ctrl.editRecipient()" type="button"> {{::\'global.components.buttons.edit\' | translate}} </button> <section class="medium-width-section top-margin-large" ng-if="$ctrl.jointContact && $ctrl.showSharingConsent"> <tng-yes-no-toggle-input input-id="{{::$ctrl.pageId}}_sharingConsent" simple-header="{{$ctrl.sharingConsentHeader}}" simple-sub-header="{{$ctrl.sharingConsentLabel}}" tng-model="$ctrl.account.shareJointAssets" tng-required="true" simple-help-bubble="{{$ctrl.sharingConsentTooltip}}"></tng-yes-no-toggle-input> </section> <section ng-if="$ctrl.jointContact" class="medium-width-section top-margin-medium consent-section"> <div>{{$ctrl.consentContent}}</div> </section> </ng-form> </section> <send-emt-modal ng-if="$ctrl.showEMTModal" on-close="$ctrl.onModalClose(payload)" settings-recipient="$ctrl.recipientToEMTModal" go-to-step="$ctrl.sendEmtFlowService.STATES.EDIT_ADDRESS" transfer-contact-edit="true" is-selecting-joint-contact="true"> </send-emt-modal> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(58)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s){(0,a.default)(this,t),this.$scope=e,this.selectConstants=n,this.sendEmtFlowService=i,this.EventBusService=s}return(0,s.default)(t,[{key:"$onInit",value:function(){this.pageId="jointAccountForm",this.showEMTModal=!1,this._generateRecipientsLabels()}},{key:"_generateRecipientsLabels",value:function(){if(this.recipients){var t=!0,e=!1,n=void 0;try{for(var a,s=(0,i.default)(this.recipients);!(t=(a=s.next()).done);t=!0){var r=a.value;r.jointLabel=r.first_name+" "+r.last_name+" ("+r.email_address+")"}}catch(t){e=!0,n=t}finally{try{!t&&s.return&&s.return()}finally{if(e)throw n}}}}},{key:"suggestionsSearchFilter",value:function(t,e){return-1!==[e.first_name,e.last_name,e.email_address].map((function(t){return"string"==typeof t?t.toLocaleLowerCase():null})).join(" ").indexOf(t.toLocaleLowerCase())}},{key:"addRecipient",value:function(){this._showEMT({})}},{key:"editRecipient",value:function(){this._showEMT(this.jointContact)}},{key:"_showEMT",value:function(t){this.recipientToEMTModal=t,this.showEMTModal=!0,this.emtModalOpened&&this.emtModalOpened({opened:!0})}},{key:"onModalClose",value:function(t){var e=this;if(this.showEMTModal=!1,this.emtModalOpened&&this.emtModalOpened({opened:!1}),t&&t.isRemoved)this.jointContact=null,this.jointContactUpdated&&"function"==typeof this.jointContactUpdated&&this.jointContactUpdated({newModel:null});else if(t&&t.model){var n=this.jointContact?this.recipients.findIndex((function(t){return t.sequence_number===e.jointContact.sequence_number})):-1;this.jointContact=t.model,this.jointContactUpdated&&"function"==typeof this.jointContactUpdated&&this.jointContactUpdated({newModel:t.model}),-1===n?this.recipients.push(t.model):this.recipients[n]=t.model,this._generateRecipientsLabels()}else this.jointContact.email_question||(this.jointContact=null,this.jointContactUpdated&&"function"==typeof this.jointContactUpdated&&this.jointContactUpdated({newModel:null}))}},{key:"onSelectHandler",value:function(){this.jointContactUpdated&&"function"==typeof this.jointContactUpdated&&this.jointContactUpdated(),this.jointContact&&!this.jointContact.email_question&&this.editRecipient()}}]),t}();o.$inject=["$scope","tngSelectAutocompleteConstants","sendEmtFlowService","EventBusService"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(4590)),a=l(n(4594)),s=l(n(4595)),r=l(n(4596)),o=l(n(4599)),c=l(n(4601));function l(t){return t&&t.__esModule?t:{default:t}}var u=angular.module("tangerine.app.core.components.jointInviteManagerModal",[]).constant("jointInviteManagerModalConstants",a.default).service("jointInviteManagerModalFlowService",s.default).service("jointInviteManagerModalService",c.default).component("tngJointInviteManagerModalFormPage",r.default).component("tngJointInviteManagerModalSuccessPage",o.default).component("tngJointInviteManagerModal",i.default);e.default=u,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4591)),a=s(n(4592));function s(t){return t&&t.__esModule?t:{default:t}}n(4593);var r={template:i.default,controller:a.default,bindings:{dealOrAccountId:"<",isApplication:"<?",jointContact:"<",jointContactUpdated:"&?",onInviteSentSuccess:"&?",hasJointDeclined:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-joint-invite-manager-modal"> <tng-modal-dialog on-close="$ctrl.cancel()" class="c-move-money" size="large"> <header>{{$ctrl.jointInviteManagerModalFlowService.currentState.label | translate}}</header> <tng-loading-spinner class="c-loading-spinner" ng-if="$ctrl.isLoading"> </tng-loading-spinner> <section ng-if="$ctrl.jointInviteManagerModalFlowService.currentState === $ctrl.jointInviteManagerModalConstants.STATES.FORM\n      && !$ctrl.isLoading"> <tng-joint-invite-manager-modal-form-page joint-contact="$ctrl.jointInviteManagerModalService.jointContact" invitation="$ctrl.jointInviteManagerModalService.invitation" recipients="$ctrl.jointInviteManagerModalService.recipients"></tng-joint-invite-manager-modal-form-page> </section> <section ng-if="$ctrl.jointInviteManagerModalFlowService.currentState === $ctrl.jointInviteManagerModalConstants.STATES.SUCCESS\n      && !$ctrl.isLoading"> <tng-joint-invite-manager-modal-success-page email="$ctrl.jointInviteManagerModalService.jointContact.email_address"></tng-joint-invite-manager-modal-success-page> </section> <footer ng-show="!$ctrl.jointInviteManagerModalFlowService.emtModalOpened"> <button actionable-id="jointInviteManagerModalCancel" class="btn btn--prev" ng-click="$ctrl.cancel()" ng-disabled="$ctrl.isLoading" ng-if="$ctrl.jointInviteManagerModalFlowService.currentState === $ctrl.jointInviteManagerModalConstants.STATES.FORM">{{::\'global.components.buttons.cancel\' | translate}}</button> <button actionable-id="jointInviteManagerModalResend" class="btn btn--orange" ng-click="$ctrl.resendInvitation()" ng-disabled="$ctrl.isLoading" ng-if="$ctrl.jointInviteManagerModalFlowService.currentState === $ctrl.jointInviteManagerModalConstants.STATES.FORM\n          && $ctrl.jointInviteManagerModalService.jointContact">{{::\'global.components.buttons.resend\' | translate}}</button> <button actionable-id="jointInviteManagerModalDone" class="btn btn--orange" ng-click="$ctrl.done()" ng-disabled="$ctrl.isLoading" ng-if="$ctrl.jointInviteManagerModalFlowService.currentState === $ctrl.jointInviteManagerModalConstants.STATES.FORM\n          && !$ctrl.jointInviteManagerModalService.jointContact">{{::\'global.components.buttons.done\' | translate}}</button> <button actionable-id="jointInviteManagerModalClose" class="btn btn--prev" ng-click="$ctrl.cancel()" ng-disabled="$ctrl.isLoading" ng-if="$ctrl.jointInviteManagerModalFlowService.currentState === $ctrl.jointInviteManagerModalConstants.STATES.SUCCESS">{{::\'global.components.buttons.close\' | translate}}</button> </footer> </tng-modal-dialog> </div>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.jointInviteManagerModalConstants=e,this.jointInviteManagerModalService=n,this.jointInviteManagerModalFlowService=a}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;return this.pageId="jointInviteManagerModal",this.isLoading=!0,this.jointInviteManagerModalFlowService.activate(null),this.jointInviteManagerModalService.loadData(this.dealOrAccountId,this.jointContact).finally((function(){t.isLoading=!1}))}},{key:"cancel",value:function(){this.jointInviteManagerModalService.cancel()}},{key:"resendInvitation",value:function(){var t=this;this.isLoading=!0,this.jointInviteManagerModalService.resendInvitation(this.isApplication,this.dealOrAccountId,this.hasJointDeclined,this.jointContactUpdated,this.onInviteSentSuccess).then((function(){t.jointInviteManagerModalFlowService.gotoNextState()})).finally((function(){t.isLoading=!1}))}},{key:"done",value:function(){this.jointInviteManagerModalService.showWithoutACoapplicantError=!0}}]),t}();r.$inject=["jointInviteManagerModalConstants","jointInviteManagerModalService","jointInviteManagerModalFlowService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={STATES:{FORM:{_name:"form",label:"jointEnrollment.jointInviteManagerModal.form.title"},SUCCESS:{_name:"success",label:"jointEnrollment.jointInviteManagerModal.success.title"}}},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(177)),a=l(n(0)),s=l(n(2)),r=l(n(264)),o=l(n(266)),c=l(n(265));function l(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(t,n,s,o,c,l,u,d,h,f,p,g){(0,a.default)(this,e);var m=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,l,f,p));return m.$log=t,m.$window=c,m.AnchorService=g,m.BUTTON_TYPES=f.BUTTON_TYPES,m.globalModalsConstants=u,m.globalModalsService=d,m.jointInviteManagerModalConstants=h,m}return(0,c.default)(e,t),(0,s.default)(e,[{key:"gotoNextState",value:function(){switch(this.currentState){case this.STATES.FORM:this.moveTo(this.STATES.SUCCESS),this.hideWarningOnExit();break;case this.STATES.SUCCESS:this.globalModalsService.closeModal(this.globalModalsConstants.AVAILABLE_MODALS.JOINT_INVITE_MANAGER);break;default:this.$log.error("bad state")}}},{key:"_resetState",value:function(){this.STATES=this.jointInviteManagerModalConstants.STATES,this._initialState=this.STATES.FORM,(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this)}},{key:"_getAnalyticsID",value:function(){return"jointInviteManagerModal"}}]),e}(l(n(267)).default);u.$inject=["$log","$q","$transitions","$state","$window","$rootScope","globalModalsConstants","GlobalModalsService","jointInviteManagerModalConstants","pageFlowConstants","AnalyticsService","AnchorService"],e.default=u,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4597)),a=s(n(4598));function s(t){return t&&t.__esModule?t:{default:t}}var r={template:i.default,controller:a.default,bindings:{invitation:"<",jointContact:"=",recipients:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<section> <p translate="jointEnrollment.jointInviteManagerModal.form.description"></p> <tng-error-message ng-if="$ctrl.showMissingInvitationError" message-title="::\'jointEnrollment.jointInviteManagerModal.form.missingInvitation.header\'"> <span ng-bind-html="::\'jointEnrollment.jointInviteManagerModal.form.missingInvitation.description\' | translate"></span> </tng-error-message> <tng-error-message ng-if="$ctrl.showMissingEmtContactError" message-title="::\'jointEnrollment.jointInviteManagerModal.form.missingEmtContact.header\'"> {{::\'jointEnrollment.jointInviteManagerModal.form.missingEmtContact.description\' | translate: { email: $ctrl.invitation.to_email } }} </tng-error-message> <tng-error-message ng-if="$ctrl.showWithoutACoapplicantError" message-title="::\'jointEnrollment.jointInviteManagerModal.form.withoutACoapplicant.header\'"> <span ng-bind-html="::\'jointEnrollment.jointInviteManagerModal.form.withoutACoapplicant.description\' | translate"></span> </tng-error-message> <tng-error-message ng-if="$ctrl.jointInviteManagerModalService.submitErrors.length > 0"> <ul> <li ng-repeat="error in $ctrl.jointInviteManagerModalService.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> <section> <tng-joint-account-form consent-content="{{::\'jointEnrollment.jointInviteManagerModal.form.disclaimer\' | translate}}" joint-contact="$ctrl.jointContact" joint-contact-updated="$ctrl.jointAccountFormUpdated()" recipients="$ctrl.recipients" emt-modal-opened="$ctrl.emtModalOpened(opened)"> </tng-joint-account-form> </section> </section> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.jointInviteManagerModalService=e,this.flowService=n}return(0,a.default)(t,[{key:"jointAccountFormUpdated",value:function(){this.jointInviteManagerModalService.clearErrors()}},{key:"emtModalOpened",value:function(t){this.flowService.emtModalOpened=t}},{key:"showMissingEmtContactError",get:function(){return this.jointInviteManagerModalService.showMissingEmtContactError}},{key:"showMissingInvitationError",get:function(){return this.jointInviteManagerModalService.showMissingInvitationError}},{key:"showWithoutACoapplicantError",get:function(){return this.jointInviteManagerModalService.showWithoutACoapplicantError}}]),t}();r.$inject=["jointInviteManagerModalService","jointInviteManagerModalFlowService"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4600);var s={template:((i=a)&&i.__esModule?i:{default:i}).default,bindings:{email:"<"}};e.default=s,t.exports=e.default},function(t,e){t.exports="<p ng-bind-html=\"::'jointEnrollment.jointInviteManagerModal.success.description' | translate: { email: $ctrl.email }\"></p>"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l){(0,i.default)(this,t),this.$q=e,this.emtService=n,this.errorConstants=a,this.errorService=s,this.globalModalsConstants=r,this.globalModalsService=o,this.jointEnrollmentConstants=c,this.jointEnrollmentService=l}return(0,a.default)(t,[{key:"loadData",value:function(t,e){var n=this;return this.invitation=null,this.recipients=[],this.submitErrors=[],this._showMissingEmtContactError=!1,this._showMissingInvitationError=!1,this._showWithoutACoapplicantError=!1,this.jointContact=e,this.loadRecipients().then((function(){return n._loadInvitation(t)})).catch((function(t){throw n.showSubmitErrors(t),t}))}},{key:"showSubmitErrors",value:function(t){var e=this;this.submitErrors=[],this.errorService.processError(t,this.errorConstants.AVAILABLE_EVENTS.REQUEST_ERROR).then((function(t){e.submitErrors=[t.message]})).catch((function(t){e.$log.error("_showSubmitErrors error",t),e.submitErrors=[e.$translate.instant("global.errorCodes.generic")]}))}},{key:"loadRecipients",value:function(){var t=this;return this.emtService.getEmtRecipients().then((function(e){t.recipients=angular.copy(e.recipient||[])}))}},{key:"_loadInvitation",value:function(t){var e=this;return this.jointEnrollmentService.getPendingInvitations().then((function(n){e.invitation=(n.invitations||[]).find((function(e){return-1!==[e.invitation_details.deal_id,e.account_id].indexOf(t)})),e.invitation?e.jointContact||(e.jointContact=e.recipients.find((function(t){return t.email_address===e.invitation.to_email})),e._showMissingEmtContactError=!e.jointContact):e._showMissingInvitationError=!0}))}},{key:"cancel",value:function(){this.globalModalsService.closeModal(this.globalModalsConstants.AVAILABLE_MODALS.JOINT_INVITE_MANAGER)}},{key:"resendInvitation",value:function(t,e,n,i,a){var s=this;return(n||!this.invitation?this.$q.resolve():this.jointEnrollmentService.cancelJointInvitation(this.invitation.invitation_key)).then((function(){return t||s.invitation&&s.invitation.type===s.jointEnrollmentConstants.INVITATION_TYPES.APPLICATION?s.jointEnrollmentService.sendApplicationInvite(e,s.jointContact):s.jointEnrollmentService.sendInvite(e,s.jointContact)})).then((function(){i&&"function"==typeof i&&i({newModel:s.jointContact}),a&&"function"==typeof a&&a()})).catch((function(t){throw s.showSubmitErrors(t),t}))}},{key:"clearErrors",value:function(){this._showMissingEmtContactError=!1,this._showMissingInvitationError=!1,this._showWithoutACoapplicantError=!1}},{key:"showMissingInvitationError",get:function(){return this._showMissingInvitationError}},{key:"showMissingEmtContactError",get:function(){return this._showMissingEmtContactError}},{key:"showWithoutACoapplicantError",get:function(){return this._showWithoutACoapplicantError},set:function(t){this._showWithoutACoapplicantError=t}}]),t}();r.$inject=["$q","EmtService","errorConstants","ErrorService","globalModalsConstants","GlobalModalsService","JointEnrollmentConstants","JointEnrollmentService"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4603),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("tangerine.app.core.components.ltsDialogs",[]).component("tngLtsTurnoffDialog",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4604)),a=s(n(4605));function s(t){return t&&t.__esModule?t:{default:t}}n(4606);var r={template:i.default,controller:a.default,bindings:{onClose:"&",turnoffLts:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose({reload: $ctrl.isPaused})" class="c-lts-off-dialog" analytics-id="lts-off" hide-close="$ctrl.isLoading"> <header> <span> {{ ::(\'userSettings.general.lts.turnoffDialog.title\' | translate) }} </span> </header> <div ng-if="$ctrl.isLoading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div class="dialog-content"> <div> <p ng-bind-html="\'userSettings.general.lts.turnoffDialog.body\' | translate"> </p> </div> </div> <footer> <div> <button actionable-id="lts-off-dialog-btn-cancel" class="btn--edit" ng-click="$ctrl.onClose()"> {{ ::(\'userSettings.general.lts.turnoffDialog.cancel\' | translate) }} </button> <button actionable-id="lts-off-dialog-btn-off" class="btn--warn" ng-click="$ctrl.turnoffLts()" ng-disabled="$ctrl.isLoading"> {{ ::(\'userSettings.general.lts.turnoffDialog.turnOff\' | translate) }} </button> </div> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(0),s=(i=a)&&i.__esModule?i:{default:i};var r=function t(){(0,s.default)(this,t)};r.$inject=[],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4608),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("tangerine.app.core.components.radioInputList",[]).component("tngRadioInputList",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4609)),a=s(n(4610));function s(t){return t&&t.__esModule?t:{default:t}}n(4611);var r={template:i.default,controller:a.default,require:{form:"?^"},transclude:{tngRadioInputListLabel:"?tngRadioInputListLabel"},bindings:{hideDescription:"<?",inputId:"@?",isDisabled:"&?",isHorizontal:"<?",options:"<",optionLabelKey:"@?",requiredValidationMessage:"@?",simpleHeader:"@?",simpleSubHeader:"@?",tngBlur:"&?",tngChange:"&?",tngDisabled:"<?",tngModel:"=",tngRequired:"<",validationOrder:"@?",tooltip:"@?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<section class="c-radio-input-list"> <div class="field"> <section class="tng-input-label-container"> <label id="{{$ctrl.inputId}}_label" ng-if="$ctrl.simpleHeader || $ctrl.simpleSubHeader"> <div class="header" ng-if="$ctrl.simpleHeader"> {{$ctrl.simpleHeader}} <tng-help-bubble ng-if="$ctrl.tooltip">{{$ctrl.tooltip | translate}}</tng-help-bubble> </div> <div class="sub-header" ng-if="$ctrl.simpleSubHeader">{{$ctrl.simpleSubHeader}}</div> </label> </section> <input actionable-id="{{::$ctrl.inputId}}" ng-model="$ctrl.tngModel" ng-required="$ctrl.tngRequired" type="hidden" validation-order="{{$ctrl.validationOrder}}"/> <div class="c-radio-input-list__options" ng-class="{\n        \'c-radio-input-list__options--horizontal\': $ctrl.isHorizontal\n      }"> <div class="c-radio-input-list__option" ng-class="{\n          \'c-radio-input-list__option--horizontal\': $ctrl.isHorizontal\n        }" ng-repeat="option in $ctrl.options track by $index"> <input actionable-id="{{::$ctrl.inputId}}{{$index}}" class="input input--tangerine-radio" ng-blur="$ctrl.tngBlur({\n            newValue: $ctrl.tngModel\n          })" ng-change="$ctrl.onChangeHandler()" ng-disabled="$ctrl.tngDisabled\n            || $ctrl.isDisabled && $ctrl.isDisabled({\n              element: option,\n              index: $index\n            })" ng-model="$ctrl.tngModel" ng-value="option" type="radio"/> <label id="{{::$ctrl.inputId}}{{$index}}" for="{{::$ctrl.inputId}}{{$index}}"> <div ng-transclude="tngRadioInputListLabel"> <span ng-bind-html="option[$ctrl.optionLabelKey || \'label\'] | translate"></span> <span ng-if="option.description && !$ctrl.hideDescription" class="optional-text" ng-bind-html="option.description | translate"></span> </div> </label> </div> </div> <div ng-messages="$ctrl.form[$ctrl.inputId].$error" ng-show="$ctrl.form[$ctrl.inputId].$invalid && $ctrl.form[$ctrl.inputId].$touched" class="field__error top-margin-small"> <p ng-message="required"> <span ng-if="$ctrl.requiredValidationMessage">{{$ctrl.requiredValidationMessage}}</span> <span ng-if="!$ctrl.requiredValidationMessage">{{::\'global.validation.required\' | translate }}</span> </p> </div> </div> </section> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.$timeout=e}return(0,a.default)(t,[{key:"$onChanges",value:function(t){var e=this;if((t.tngModel||t.options)&&this.tngModel&&this.options){var n=this.options.find((function(t){return angular.equals(e.tngModel,t)}));n&&(this.tngModel=n)}}},{key:"onChangeHandler",value:function(){var t=this;"function"==typeof this.tngChange&&this.$timeout((function(){return t.tngChange()}),0)}}]),t}();r.$inject=["$timeout"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4613),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("tangerine.app.core.components.textInput",[]).component("tngTextInput",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4614)),a=s(n(4615));function s(t){return t&&t.__esModule?t:{default:t}}n(4616);var r={template:i.default,controller:a.default,require:{form:"?^"},bindings:{inputId:"@?",forceShowBorder:"<?",maxlengthValidationMessage:"@?",minlengthValidationMessage:"@?",placeholder:"@?",patternValidationMessage:"@?",requiredValidationMessage:"@?",simpleHeader:"@?",simpleSubHeader:"@?",tngChange:"&?",tngDisabled:"<?",tngHtmlMaxlength:"<?",tngMaxlength:"<?",tngMinlength:"<?",tngModel:"=",tngModelOptions:"<",tngPattern:"<?",tngRequired:"<",tngReadonly:"<?",validationOrder:"@?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<section class="c-text-input"> <section class="tng-input-label-container"> <label for="{{$ctrl.inputId}}" id="{{$ctrl.inputId}}_label" ng-if="$ctrl.simpleHeader || $ctrl.simpleSubHeader"> <div class="header" ng-if="$ctrl.simpleHeader">{{$ctrl.simpleHeader}}</div> <div class="sub-header" ng-if="$ctrl.simpleSubHeader">{{$ctrl.simpleSubHeader}}</div> </label> </section> <input actionable-id="{{::$ctrl.inputId}}" class="input" ng-class="{\n      \'warning\': $ctrl.showWarningStyle\n    }" ng-change="$ctrl.tngChange()" ng-disabled="$ctrl.tngDisabled" ng-maxlength="$ctrl.tngMaxlength" maxlength="{{$ctrl.tngHtmlMaxlength || 999999999 }}" ng-minlength="$ctrl.tngMinlength" ng-model="$ctrl.tngModel" ng-model-options="$ctrl.tngModelOptions || {}" ng-pattern="$ctrl.tngPattern" ng-required="$ctrl.tngRequired" ng-readonly="$ctrl.tngReadonly" placeholder="{{$ctrl.placeholder}}" type="text" validation-order="{{$ctrl.validationOrder}}"/> <div ng-messages="$ctrl.form[$ctrl.inputId].$error" ng-show="$ctrl.form[$ctrl.inputId].$invalid && $ctrl.form[$ctrl.inputId].$touched" class="field__error top-margin-small"> <p ng-message="maxlength"> <span ng-if="$ctrl.maxlengthValidationMessage">{{$ctrl.maxlengthValidationMessage}}</span> <span ng-if="!$ctrl.maxlengthValidationMessage">{{::\'global.validation.maxlength\' | translate: { max: $ctrl.tngMaxlength } }}</span> </p> <p ng-message="minlength"> <span ng-if="$ctrl.minlengthValidationMessage">{{$ctrl.minlengthValidationMessage}}</span> <span ng-if="!$ctrl.minlengthValidationMessage">{{::\'global.validation.minlength\' | translate: { min: $ctrl.tngMinlength } }}</span> </p> <p ng-message="pattern"> {{::$ctrl.patternValidationMessage | translate}} </p> <p ng-message="required"> <span ng-if="$ctrl.requiredValidationMessage">{{$ctrl.requiredValidationMessage}}</span> <span ng-if="!$ctrl.requiredValidationMessage">{{::\'global.validation.required\' | translate }}</span> </p> </div> </section> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.$log=e,this.$translate=n,this.$element=a,this.$scope=s,this.$timeout=r}return(0,a.default)(t,[{key:"showWarningStyle",get:function(){if(this.forceShowBorder)return!0;if(!this.form)return!1;var t=this.form[this.inputId];return!!t&&(!t.$valid&&t.$touched)}}]),t}();r.$inject=["$log","$translate","$element","$scope","$timeout","amountInputConstants","accountConstants","localeConstants","LocaleService","CurrencyExchangeService","CurrencyService","EnvironmentService","autoFocusConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4618),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("tangerine.app.core.components.yesNoToggleInput",[]).component("tngYesNoToggleInput",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4619)),a=s(n(4620));function s(t){return t&&t.__esModule?t:{default:t}}n(4621);var r={template:i.default,controller:a.default,require:{form:"?^"},bindings:{inputId:"@?",noLabel:"@?",noValue:"<?",requiredValidationMessage:"@?",simpleHeader:"@?",simpleSubHeader:"@?",simpleHelpBubble:"@?",tngBlur:"&?",tngChange:"&?",tngDisabled:"<?",tngModel:"=",tngRequired:"<",validationOrder:"@?",yesLabel:"@?",yesValue:"<?",requireYes:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports=' <section class="c-yes-no-toggle-input"> <section class="tng-input-label-container"> <label for="{{$ctrl.inputId}}Yes" id="{{$ctrl.inputId}}Yes_label" ng-if="$ctrl.simpleHeader || $ctrl.simpleSubHeader"> <div class="header" ng-if="$ctrl.simpleHeader">{{$ctrl.simpleHeader}} <tng-help-bubble ng-if="$ctrl.simpleHelpBubble"> {{$ctrl.simpleHelpBubble}} </tng-help-bubble> </div> <div class="sub-header" ng-if="$ctrl.simpleSubHeader" ng-bind-html="$ctrl.simpleSubHeader"> </div> </label> </section> <div class="field__group--inline top-margin-small"> <div class="field margin__r--fix1"> <input actionable-id="{{::$ctrl.inputId}}Yes" class="input input--pill CB_ReadOnly" ng-blur="$ctrl.tngBlur({ newValue: $ctrl.tngModel })" ng-change="$ctrl.preTngChange()" ng-disabled="$ctrl.tngDisabled" ng-model="$ctrl.tngModel" ng-required="$ctrl.tngRequired" ng-value="$ctrl.yesValue || true" type="radio" validation-order="{{$ctrl.validationOrder}}"/> <label for="{{::$ctrl.inputId}}Yes" class="c-client-onboarding__toggle-button"> <span ng-if="$ctrl.yesLabel">{{$ctrl.yesLabel | translate}}</span> <span ng-if="!$ctrl.yesLabel">{{::\'global.yes\' | translate}}</span> </label> </div> <div class="field"> <input actionable-id="{{::$ctrl.inputId}}No" class="input input--pill CB_ReadOnly" ng-blur="$ctrl.tngBlur({ newValue: $ctrl.tngModel })" ng-change="$ctrl.preTngChange()" ng-disabled="$ctrl.tngDisabled" ng-model="$ctrl.tngModel" ng-value="$ctrl.noValue || false" type="radio"/> <label for="{{::$ctrl.inputId}}No" class="c-client-onboarding__toggle-button"> <span ng-if="$ctrl.noLabel">{{$ctrl.noLabel | translate}}</span> <span ng-if="!$ctrl.noLabel">{{::\'global.no\' | translate}}</span> </label> </div> <div ng-messages="$ctrl.form[$ctrl.inputId + \'Yes\'].$error" ng-show="$ctrl.form[$ctrl.inputId + \'Yes\'].$invalid && ($ctrl.form[$ctrl.inputId + \'Yes\'].$touched || $ctrl.form[$ctrl.inputId + \'No\'].$dirty)" class="field__error top-margin-small"> <p ng-message="required || yesRequired"> <span ng-if="$ctrl.requiredValidationMessage">{{$ctrl.requiredValidationMessage}}</span> <span ng-if="!$ctrl.requiredValidationMessage">{{::\'global.validation.required\' | translate }}</span> </p> </div> </div> </section> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.$timeout=e}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.$timeout((function(){t._checkYesRequired()}))}},{key:"preTngChange",value:function(){var t=this;this.tngChange&&"function"==typeof this.tngChange&&this.$timeout((function(){t.tngChange(),t._checkYesRequired()}))}},{key:"_checkYesRequired",value:function(){var t=document.getElementById(this.inputId+"Yes"),e=this.form[this.inputId+"Yes"];e&&t&&this.requireYes&&e.$setValidity("yesRequired",t.checked)}}]),t}();r.$inject=["$timeout"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(4623)),a=u(n(4627)),s=u(n(4636)),r=u(n(4640)),o=u(n(4644)),c=u(n(559)),l=u(n(4648));function u(t){return t&&t.__esModule?t:{default:t}}var d=angular.module("tangerine.app.core.components.datePicker",[a.default.name,"vs-repeat"]).constant("tngDatePickerConstants",c.default).component("tngFrequencySelector",s.default).component("tngSelectionMode",r.default).component("tngCalendar",o.default).component("tngDatePicker",i.default).directive("dateFormat",l.default);e.default=d,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4624)),a=s(n(4625));function s(t){return t&&t.__esModule?t:{default:t}}n(4626);var r={template:i.default,controller:a.default,bindings:{selectedDate:"=?",startDate:"=?",startDateHeader:"@?",endDate:"=?",minDate:"<?",selectionMode:"=",frequency:"=?",frequencyExclude:"<?",onDateChange:"&?",scrollerId:"@?",fixedLowerRange:"<?",hideSelectionModeSelector:"=?",hideDateIncrementer:"=?",hideFrequencySelector:"=?",hideCalendar:"=?",hideStartDateIncrementer:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports=' <div class="c-date-picker margin__t--fix2"> <tng-frequency-selector ng-if="$ctrl.isReoccurring() && !$ctrl.hideFrequencySelector" selected-frequency="$ctrl.frequency" selected-frequency-stats="$ctrl.frequencyStats" frequency-change="$ctrl.datePickerChanged()" frequency-exclude="$ctrl.frequencyExclude"> </tng-frequency-selector> <tng-selection-mode ng-if="$ctrl.isReoccurring() && !$ctrl.hideSelectionModeSelector" selection-mode="$ctrl.selectionMode" selection-change="$ctrl.selectionModeChanged()"> </tng-selection-mode> <tng-date-incrementer ng-if="!$ctrl.hideDateIncrementer" selection-mode="$ctrl.selectionMode" selected-date="$ctrl.selectedDate" start-date="$ctrl.startDate" start-date-header="{{$ctrl.startDateHeader}}" end-date="$ctrl.endDate" on-start-date-change="$ctrl.dateIncrementerChange(true)" min-date="$ctrl.minDate" max-end-date="$ctrl.maxEndDate" on-end-date-change="$ctrl.dateIncrementerChange(false)" hide-start-date="$ctrl.hideStartDateIncrementer"> </tng-date-incrementer> <div ng-if="!$ctrl.hideCalendar" class="c-date-picker__calendar-scroller"> <button actionable-id="date-picker-general-left-arrow" class="c-date-picker__calendar-scroller__arrow" ng-click="$ctrl.scrollToMonth(true, -1)" ng-if="!$ctrl.fixedLowerRange"> <span class="icon-leftarrow large"></span> </button> <div class="c-date-picker__calendar-scroller__repeat"> <div vs-repeat vs-autoresize vs-excess="1" ng-attr-vs-horizontal="{{$ctrl.isHorizontal() || undefined}}" id="c-date-picker__calendar-scroller__repeat-scroll-{{$ctrl.scrollerId}}" class="c-date-picker__repeat-container"> <div ng-repeat="month in ::$ctrl.monthMapKeys" class="c-date-picker__calendar-container" ng-class="{\'c-date-picker__calendar-container--alternate\': $odd}"> <tng-calendar moment-date="::$ctrl.monthMap[month]" initial-data="$ctrl.initialRenderData"> </tng-calendar> </div> </div> </div> <button actionable-id="date-picker-general-right-arrow" class="c-date-picker__calendar-scroller__arrow" ng-click="$ctrl.scrollToMonth(true, 1)"> <span class="icon-rightarrow large"></span> </button> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(15)),a=c(n(0)),s=c(n(2)),r=c(n(541)),o=c(n(370));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,i){(0,a.default)(this,t),this.$log=e,this.$timeout=n,this.dateConstants=i,this.selectionMode||(this.selectionMode=this.dateConstants.DATE_SELECTION_MODE.range),this.frequencyStats={wasUndefined:angular.isUndefined(this.frequency),wasNull:null===this.frequency},this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.single||this.rangeType||(this.selectionMode!==this.dateConstants.DATE_SELECTION_MODE.indefinite?this.rangeType=this.dateConstants.DATE_PICKER_RANGE_TYPE.upper:this.rangeType=this.dateConstants.DATE_PICKER_RANGE_TYPE.lower),this.selectedDate||(this.selectedDate=this.dateConstants.TODAY),this.startDate||(this.startDate=this.selectedDate.clone()),this.endDate||(this.endDate=this.startDate.clone(),this.endDate.add(1,"days").startOf("day")),this.minDate||(this.minDate=this.dateConstants.DEFAULT_MIN_DATE.clone()),this.maxEndDate||(this.maxEndDate=this.dateConstants.DEFAULT_MAX_END_DATE.clone()),this.endOfTime=moment("30000101"),this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.indefinite&&(this.endDate=this.endOfTime.clone()),this.scrollerId||(this.scrollerId=Math.random().toString(36).substring(7)),this.highlightedDays={},this._getHighlightedDays(),this.rangeType=this.dateConstants.DATE_PICKER_RANGE_TYPE.upper,this.monthMap={},this.monthMapKeys=[],this._generateMonthMap(),this._changeListeners=[]}return(0,s.default)(t,[{key:"$onInit",value:function(){this.createCallbackData()}},{key:"$postLink",value:function(){var t=this;angular.element(document).ready((function(){t.scrollToMonth(!0)}))}},{key:"registerCallbackForChanges",value:function(t){var e=this;return this._changeListeners.push(t),function(){return(0,o.default)(e._changeListeners,t)}}},{key:"isHorizontal",value:function(){return window.innerWidth>=this.dateConstants.HORIZONTAL_WIDTH}},{key:"isReoccurring",value:function(){return this.selectionMode!==this.dateConstants.DATE_SELECTION_MODE.single}},{key:"isDayEnabled",value:function(t){return!!t&&(this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.range&&this.rangeEditMode===this.dateConstants.DATE_PICKER_RANGE_TYPE.upper&&(this.startDate.isAfter(this.minDate)||this.startDate.isSame(this.minDate)),t.moment.isAfter(this.minDate)||t.moment.isSame(this.minDate))}},{key:"isDaySelected",value:function(t){return!!t&&(!!this.isDayEnabled(t)&&(this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.single||this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.indefinite?t.moment.isSame(this.selectedDate,"day"):this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.range&&(t.moment.isSame(this.startDate,"day")||t.moment.isSame(this.endDate,"day"))))}},{key:"setDay",value:function(t){if(!t)return!1;if(this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.single||this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.indefinite){if(t.moment.isSame(this.selectedDate))return!1;this.selectedDate=t.moment,this.startDate=t.moment}return this.rangeType===this.dateConstants.DATE_PICKER_RANGE_TYPE.upper?t.moment.isSame(this.startDate,"day")?this.endDate?this.fixedLowerRange||(this.rangeType=this.dateConstants.DATE_PICKER_RANGE_TYPE.lower):this.rangeType=this.dateConstants.DATE_PICKER_RANGE_TYPE.upper:t.moment.isAfter(this.startDate,"day")?this.endDate=t.moment:!this.endDate&&t.moment.isBefore(this.startDate,"day")?(this.startDate=t.moment,this.selectedDate=this.startDate.clone()):t.moment.isBefore(this.minDate,"day")||(this.rangeType=this.dateConstants.DATE_PICKER_RANGE_TYPE.lower,this.endDate=t.moment,this.startDate=this.endDate.clone().subtract(1,"days"),this.selectedDate=this.startDate.clone()):this.rangeType===this.dateConstants.DATE_PICKER_RANGE_TYPE.lower&&(t.moment.isSame(this.endDate,"day")?this.startDate?this.rangeType=this.dateConstants.DATE_PICKER_RANGE_TYPE.upper:this.rangeType=this.dateConstants.DATE_PICKER_RANGE_TYPE.lower:t.moment.isBefore(this.endDate,"day")?(this.startDate=t.moment,this.selectedDate=this.startDate.clone()):!this.startDate&&t.moment.isAfter(this.endDate,"day")?this.endDate=t.moment:(this.rangeType=this.dateConstants.DATE_PICKER_RANGE_TYPE.upper,this.startDate=t.moment,this.selectedDate=this.startDate.clone(),this.endDate=this.startDate.clone().add(1,"days"))),this.datePickerChanged(),!0}},{key:"createCallbackData",value:function(){var t={selectedDays:[],highlightedDays:(0,r.default)(this.highlightedDays,(function(t){return t})),minDate:this.minDate};return this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.indefinite?(t.selectedDays.push(this.selectedDate),t.startDate=this.startDate,t.endDate=null):this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.range?(t.selectedDays.push(this.startDate,this.endDate),t.startDate=this.startDate,t.endDate=this.endDate,this.rangeType===this.dateConstants.DATE_PICKER_RANGE_TYPE.lower&&(t.dayWithHandle=this.startDate),this.rangeType===this.dateConstants.DATE_PICKER_RANGE_TYPE.upper&&(t.dayWithHandle=this.endDate)):t.selectedDays.push(this.selectedDate),this.initialRenderData=t,t}},{key:"datePickerChanged",value:function(){var t=this;if(this.selectionMode!==this.dateConstants.DATE_SELECTION_MODE.single&&this._getHighlightedDays(),this._changeListeners.length){var e=this.createCallbackData();this._changeListeners.forEach((function(t){t(e)}))}this.onDateChange&&(this.$log.debug("Datepicker Component: Calling onDateChange callback!"),this.$timeout((function(){var e=[];e=t.selectionMode!==t.dateConstants.DATE_SELECTION_MODE.single?t.highlightedDays:t.selectedDate,t.onDateChange({selectedDays:e})}),0))}},{key:"dateIncrementerChange",value:function(t,e){this.scrollToMonth(t,e),this.datePickerChanged()}},{key:"selectionModeChanged",value:function(){this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.range?this.rangeType=this.dateConstants.DATE_PICKER_RANGE_TYPE.upper:this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.indefinite&&(this.rangeType=this.dateConstants.DATE_PICKER_RANGE_TYPE.lower),this.endDate.isBefore(this.startDate)&&(this.endDate=this.startDate.clone().add(1,"days")),this.datePickerChanged()}},{key:"getScrollerElement",value:function(){var t="c-date-picker__calendar-scroller__repeat-scroll-"+this.scrollerId;return document.getElementById(t)}},{key:"scrollToMonth",value:function(t,e){var n=e,i=this.getScrollerElement(),a=i.scrollLeft;if(this.isHorizontal()||(a=i.scrollTop),n||(a=0,n=t?this.startDate.diff(this.minDate,"months"):this.endDate.diff(this.minDate,"months")),0!==n){var s=this.dateConstants.CALENDAR_MONTH_WIDTH,r=this.dateConstants.CALENDAR_MONTH_HEIGHT,o=void 0;(o=this.isHorizontal()?a+s*n:a+r*n)<=0&&(o=0),this.isHorizontal()?i.scrollLeft=o:i.scrollTop=o}}},{key:"isDayHighlighted",value:function(t){if(this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.single)return t.moment.isSame(this.selectedDate,"day");if(this.highlightedDays.daily){if(this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.indefinite)return t.moment.isAfter(this.startDate);if(this.startDate&&this.endDate)return t.moment.isAfter(this.startDate)&&t.moment.isBefore(this.endDate);if(this.startDate)return t.moment.isSame(this.startDate,"day")}return!!this.highlightedDays[t.moment.calendar()]}},{key:"isWithinRange",value:function(t){return this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.indefinite?t.moment.isAfter(this.selectedDate):this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.range&&(!(!this.startDate||!this.endDate)&&(t.moment.isAfter(this.startDate)&&t.moment.isBefore(this.endDate)))}},{key:"isRangeStart",value:function(t){return this.startDate&&this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.range?t.moment.isSame(this.startDate,"day"):!(!this.selectedDate||this.selectionMode!==this.dateConstants.DATE_SELECTION_MODE.indefinite)&&t.moment.isSame(this.selectedDate,"day")}},{key:"isRangeEnd",value:function(t){return this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.range&&(!!this.endDate&&t.moment.isSame(this.endDate,"day"))}},{key:"isDayCurrentRangeHandle",value:function(t){return!(!t||this.selectionMode!==this.dateConstants.DATE_SELECTION_MODE.range)&&(this.startDate&&this.startDate.isSame(t.moment,"day")&&this.rangeType===this.dateConstants.DATE_PICKER_RANGE_TYPE.lower||this.endDate&&this.endDate.isSame(t.moment,"day")&&this.rangeType===this.dateConstants.DATE_PICKER_RANGE_TYPE.upper)}},{key:"_generateMonthMap",value:function(){for(var t=this.minDate.clone().startOf("month");t.isBefore(this.endOfTime);)this.monthMap[t.calendar()]=t.clone(),t=t.add(1,"month");this.monthMapKeys=(0,i.default)(this.monthMap)}},{key:"_getHighlightedDays",value:function(){var t=this.frequency?this.frequency.value:this.dateConstants.DATE_PICKER_FREQUENCY.biWeekly.value;if(this.isReoccurring())if(t!==this.dateConstants.DATE_PICKER_FREQUENCY.daily.value){this.highlightedDays={};var e=this.endDate.clone();this.selectionMode===this.dateConstants.DATE_SELECTION_MODE.indefinite&&(e=this.endOfTime.clone());for(var n=this.startDate.clone();!n.isAfter(this.endOfTime)&&(n.isBefore(e)||n.isSame(e,"day"));)this.highlightedDays[n.calendar()]=n.clone(),t===this.dateConstants.DATE_PICKER_FREQUENCY.weekly.value&&n.add(1,"weeks"),t===this.dateConstants.DATE_PICKER_FREQUENCY.biWeekly.value&&n.add(2,"weeks"),t===this.dateConstants.DATE_PICKER_FREQUENCY.monthly.value&&n.add(1,"months"),t===this.dateConstants.DATE_PICKER_FREQUENCY.quarterly.value&&n.add(3,"months"),t===this.dateConstants.DATE_PICKER_FREQUENCY.yearly.value&&n.add(1,"years");this.$log.debug("num highlighed days:",(0,i.default)(this.highlightedDays).length)}else this.highlightedDays={daily:this.endDate.diff(this.startDate,"days")};else this.highlightedDaysMap={}}}]),t}();l.$inject=["$log","$timeout","tngDatePickerConstants"],e.default=l,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4628)),a=s(n(4632));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("tangerine.dateIncrementerModule",[]).component("tngDateIncrementerBlocks",i.default).component("tngDateIncrementer",a.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4629)),a=s(n(4630));function s(t){return t&&t.__esModule?t:{default:t}}n(4631);var r={template:i.default,controller:a.default,bindings:{date:"=",notBeforeDate:"<?",notAfterDate:"<?",onDateChange:"&?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-date-incrementer-blocks"> <div class="c-date-incrementer-blocks__repeat-container" ng-repeat="(key, val) in $ctrl.dateMap"> <div class="panel"> <button actionable-id="date-incrementer-blocks_{{key}}" class="c-date-incrementer-blocks__increment-arrow" ng-click="$ctrl.incrementDate(1, key)"> <span class="c-date-incrementer-blocks__increment-arrow__icon icon-uparrow x-large"></span> </button> <div class="body c-date-incrementer-blocks__title"> {{$ctrl.date.format(val.displayKey)}} </div> <button actionable-id="date-decrementer-blocks_{{key}}" class="c-date-incrementer-blocks__increment-arrow" ng-click="$ctrl.incrementDate(-1, key)"> <span class="c-date-incrementer-blocks__increment-arrow__icon icon-downarrow x-large"></span> </button> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.dateConstants=e,this.$timeout=n,this.dateMap={month:{incrementKey:"months",displayKey:"MMMM"},day:{incrementKey:"days",displayKey:"D"},year:{incrementKey:"years",displayKey:"YYYY"}}}return(0,a.default)(t,[{key:"incrementDate",value:function(t,e){var n=this;if(0!==t){var i=this.date.clone();i.add(t,this.dateMap[e].incrementKey),this.notAfterDate||(this.notAfterDate=this.dateConstants.DEFAULT_MAX_DATE),this.notAfterDate&&(i.isAfter(this.notAfterDate)||i.isSame(this.notAfterDate))||this.notBeforeDate&&(i.isBefore(this.notBeforeDate)||i.isSame(this.notBeforeDate))||(this.date=i,this.onDateChange&&this.$timeout((function(){n.onDateChange()}),0))}}}]),t}();r.$inject=["tngDatePickerConstants","$timeout"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4633)),a=s(n(4634));function s(t){return t&&t.__esModule?t:{default:t}}n(4635);var r={template:i.default,controller:a.default,bindings:{selectionMode:"<",selectedDate:"=",startDate:"=",startDateHeader:"@?",endDate:"=",minDate:"<",maxEndDate:"<",onStartDateChange:"&?",onEndDateChange:"&?",hideStartDate:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-date-incrementer"> <div class="c-date-incrementer__date-toggle" ng-if="$ctrl.selectionMode === $ctrl.dateConstants.DATE_SELECTION_MODE.range" ng-hide="$ctrl.hideStartDate"> <span> <button actionable-id="date-incrementer-btn-start-date" class="btn--view" ng-click="$ctrl.mobileShowStartDate = true" ng-class="{\'is-active\': $ctrl.mobileShowStartDate}"> {{ \'global.datePicker.startDate\' | translate }} </button> </span> <span> <button actionable-id="date-incrementer-btn-end-date" class="btn--view" ng-click="$ctrl.mobileShowStartDate = false" ng-class="{\'is-active\': !$ctrl.mobileShowStartDate}"> {{ \'global.datePicker.endDate\' | translate }} </button> </span> </div> <div class="c-date-incrementer__block-container" ng-class="{\'c-date-incrementer__block-container--hide\': !$ctrl.mobileShowStartDate}" ng-hide="$ctrl.hideStartDate"> <h2 class="c-date-incrementer__title" ng-if="$ctrl.selectionMode !== $ctrl.dateConstants.DATE_SELECTION_MODE.single"> {{ ($ctrl.startDateHeader || \'global.datePicker.startDate\') | translate }} </h2> <tng-date-incrementer-blocks ng-if="$ctrl.selectionMode === $ctrl.dateConstants.DATE_SELECTION_MODE.single" date="$ctrl.selectedDate" not-before-date="$ctrl.minDate" on-date-change="$ctrl.startDateChanged()"> </tng-date-incrementer-blocks> <tng-date-incrementer-blocks ng-if="$ctrl.selectionMode !== $ctrl.dateConstants.DATE_SELECTION_MODE.single" date="$ctrl.selectedDate" not-before-date="$ctrl.minDate" on-date-change="$ctrl.startDateChanged()"> </tng-date-incrementer-blocks> </div> <div class="c-date-incrementer__block-container" ng-class="{\'c-date-incrementer__block-container--hide\': $ctrl.mobileShowStartDate}" ng-if="$ctrl.selectionMode === $ctrl.dateConstants.DATE_SELECTION_MODE.range"> <h2 class="c-date-incrementer__title"> {{ \'global.datePicker.endDate\' | translate }} </h2> <tng-date-incrementer-blocks date="$ctrl.endDate" not-before-date="$ctrl.startDate" not-after-date="$ctrl.maxEndDate" on-date-change="$ctrl.endDateChanged()"> </tng-date-incrementer-blocks> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.dateConstants=e,this.$timeout=n,this.mobileShowStartDate=!0,this.hideStartDate=!!this.hideStartDate,this.hideStartDate&&(this.mobileShowStartDate=!1)}return(0,a.default)(t,[{key:"startDateChanged",value:function(){var t=this;this.startDate=this.selectedDate,this.onStartDateChange&&this.$timeout((function(){t.onStartDateChange()}),0)}},{key:"endDateChanged",value:function(){var t=this;this.onEndDateChange&&this.$timeout((function(){t.onEndDateChange()}),0)}}]),t}();r.$inject=["tngDatePickerConstants","$timeout"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4637)),a=s(n(4638));function s(t){return t&&t.__esModule?t:{default:t}}n(4639);var r={template:i.default,controller:a.default,bindings:{selectedFrequency:"=",selectedFrequencyStats:"<?",frequencyExclude:"<?",frequencyChange:"&?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-frequency-selector"> <label for="frequencySelect_calendar"> {{ \'global.datePicker.frequency\' | translate }} </label> <div class="c-frequency-selector__select-container"> <tng-select-autocomplete options="$ctrl.availableFrequencies" select-type="$ctrl.selectConstants.SELECT_TYPES.STATIC" option-label-key="name" selected-index="$ctrl.selectedFrequencyIndex" placeholder="{{ \'global.datePicker.selectFrequency\' | translate }}" actionable-id="frequencySelect_calendar" on-select="$ctrl.selectionChange(option)"> </tng-select-autocomplete> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(15)),a=o(n(8)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,a){(0,s.default)(this,t),this.dateConstants=e,this.selectConstants=n,this.$timeout=i,this.$log=a}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;(this.availableFrequencies=(0,a.default)({},this.dateConstants.DATE_PICKER_FREQUENCY),this.frequencyExclude)&&(Array.isArray(this.frequencyExclude)||(this.frequencyExclude=[this.frequencyExclude]),(0,i.default)(this.availableFrequencies).forEach((function(e){t.frequencyExclude.indexOf(t.availableFrequencies[e])>-1&&delete t.availableFrequencies[e]})));this._availFreqKeys=(0,i.default)(this.availableFrequencies).map((function(t){return t.toUpperCase()}))}},{key:"selectionChange",value:function(t){var e=this;this.selectedFrequency=t,this.frequencyChange&&this.$timeout((function(){e.frequencyChange()}))}},{key:"selectedFrequencyIndex",get:function(){var t=this;if(this.selectedFrequencyStats&&!this.selectedFrequencyStats.wasUndefined){var e=-1;return this.selectedFrequency&&!this.selectedFrequencyStats.wasNull&&(e=this._availFreqKeys.findIndex((function(e){return e===t.selectedFrequency.value}))),this.$log.debug("returning selectedFrequencyIndex:",e),e}return this.$log.debug("defaulting to 0 for selectedFrequencyIndex"),0}}]),t}();c.$inject=["tngDatePickerConstants","tngSelectAutocompleteConstants","$timeout","$log"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4641)),a=s(n(4642));function s(t){return t&&t.__esModule?t:{default:t}}n(4643);var r={template:i.default,controller:a.default,bindings:{selectionMode:"=",selectionChange:"&?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-selection-mode-selector"> <div class="field c-selection-mode-selector__continue-radio"> <input id="radio1" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.selectionMode === $ctrl.dateConstants.DATE_SELECTION_MODE.range" ng-click="$ctrl.changeSelection($ctrl.dateConstants.DATE_SELECTION_MODE.range)"/> <label class="c-selection-mode-selector__continue-radio__label" for="radio1"> {{ \'global.datePicker.continueUntil\' | translate }} </label> </div> <div class="field c-selection-mode-selector__continue-radio"> <input id="radio2" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.selectionMode === $ctrl.dateConstants.DATE_SELECTION_MODE.indefinite" ng-click="$ctrl.changeSelection($ctrl.dateConstants.DATE_SELECTION_MODE.indefinite)"/> <label class="c-selection-mode-selector__continue-radio__label" for="radio2"> {{ \'global.datePicker.continueIndefinitely\' | translate }} </label> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.dateConstants=e,this.$timeout=n}return(0,a.default)(t,[{key:"changeSelection",value:function(t){var e=this;this.selectionMode=t,this.$timeout((function(){e.selectionChange()}))}}]),t}();r.$inject=["tngDatePickerConstants","$timeout"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4645)),a=s(n(4646));function s(t){return t&&t.__esModule?t:{default:t}}n(4647);var r={template:i.default,controller:a.default,bindings:{momentDate:"<",initialData:"<"},require:{parentCtrl:"^^tngDatePicker"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-calendar"> <div class="c-calendar__title js-month"> </div> <table class="c-calendar__table"> <thead> <tr class="js-days-of-week"> </tr> </thead> <tbody class="c-calendar__calendar js-calendar"> </tbody> </table> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(8)),a=o(n(0)),s=o(n(2)),r=o(n(1816));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,s,r){(0,a.default)(this,t),(0,i.default)(this,{$scope:e,$element:n,$translate:s,$q:r}),this.momentDate||(this.momentDate=moment()),this.EXCLUDE_PREV_MONTH=-1,this.EXCLUDE_NEXT_MONTH=1,this._generateMonthDataset(),this.startOfMonth=moment(this.momentDate).date(1),this.endOfMonth=moment(this.momentDate).add(1,"months").date(0),this.endOfTime=moment("30000101")}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this,e=this.$element[0].querySelector(".js-month"),n=this.$element[0].querySelector(".js-days-of-week"),i=this.$element[0].querySelector(".js-calendar");this.domRefs={monthElement:e,daysOfWeekElement:n,calendarElement:i},e.textContent=this.momentDate.format("MMMM YYYY"),angular.element(i).on("click touchstart",(function(e){t.calendarClicked(e)})),this._fillWeekdayHeaders(),this.weeks.forEach((function(e){var n=document.createElement("TR");e.forEach((function(e){t._createWeekdayElement(e,n)})),i.appendChild(n)})),this._deregisterChangeListener=this.parentCtrl.registerCallbackForChanges((function(e){t.daysUpdate(e)})),this.daysUpdate(this.initialData)}},{key:"$onDestroy",value:function(){this._deregisterChangeListener()}},{key:"calendarClicked",value:function(t){for(var e=t.target;e;){if(e.classList.contains("js-day")){var n=moment(e.dataset.day);if(!this.lastUpdatedDates.minDate||n>=this.lastUpdatedDates.minDate){this.parentCtrl.setDay({moment:n}),this.$scope.$$phase||this.$scope.$apply();break}}if(e.classList.contains("js-calendar"))break;e=e.parentNode}}},{key:"_createWeekdayElement",value:function(t,e){var n=document.createElement("TD"),i=document.createElement("DIV"),a=document.createElement("DIV"),s=document.createElement("SPAN"),r=t.moment.format("YYYYMMDD");n.classList.add("js-day"),n.classList.add("js-day-"+r),n.dataset.day=r,i.classList.add("c-calendar__table__day"),s.textContent=t.dayOfMonth,n.appendChild(a),t.exclude?(t.exclude===this.EXCLUDE_NEXT_MONTH&&a.classList.add("js-indicator-next-month"),t.exclude===this.EXCLUDE_PREV_MONTH&&a.classList.add("js-indicator-prev-month")):(a.classList.add("js-indicator"),i.classList.add("js-content"),i.appendChild(s),n.appendChild(i)),e.appendChild(n)}},{key:"_fillWeekdayHeaders",value:function(){var t=this;this.$q.all(["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"].map((function(e){var n="global.daysOfWeek."+e;return t.$translate(n)}))).then((function(e){e.forEach((function(e){var n=document.createElement("TD");n.textContent=e[0],t.domRefs.daysOfWeekElement.appendChild(n)}))}))}},{key:"removeClassFromAllElements",value:function(t){var e=this.domRefs.calendarElement.querySelectorAll("."+t);(0,r.default)(e,(function(e){e.classList.remove(t)}))}},{key:"getDaysBetweenDates",value:function(t,e){for(var n=[],i=moment.min(moment(e),this.endOfMonth),a=moment.max(moment(t),this.startOfMonth);a<=i;)n.push(moment(a).format("YYYYMMDD")),a=moment(a).add(1,"days");return n}},{key:"getDayElement",value:function(t,e){return this.domRefs.calendarElement.querySelector(".js-day-"+t+" ."+e)}},{key:"addClassToDayContent",value:function(t,e){var n=this.domRefs.calendarElement.querySelector(".js-day-"+t+" .js-content");n&&n.classList&&n.classList.add(e)}},{key:"addClassToDayIndicator",value:function(t,e){var n=this.domRefs.calendarElement.querySelector(".js-day-"+t+" .js-indicator");n&&n.classList&&n.classList.add(e)}},{key:"daysUpdate",value:function(t){this.lastUpdatedDates=t,this.removeClassFromAllElements("c-calendar__table__day--selected"),this.removeClassFromAllElements("c-calendar__table__day--range-toggle"),this.removeClassFromAllElements("c-calendar__table__day--highlighted"),this.removeClassFromAllElements("c-calendar__table__range"),this.removeClassFromAllElements("c-calendar__table__range--start"),this.removeClassFromAllElements("c-calendar__table__range--end"),this.removeClassFromAllElements("c-calendar__table__day--enabled"),this.domRefs.calendarElement.classList.remove("c-calendar__calendar--start-before"),this.domRefs.calendarElement.classList.remove("c-calendar__calendar--end-after"),this._updateSelectedDaysClasses(t),this._updateFocusedDaysClasses(t),this._updateDateRangeClasses(t),this._updateHighlightedDaysClasses(t),this._updateEnabledDaysClasses(t)}},{key:"_updateSelectedDaysClasses",value:function(t){var e=this;t.selectedDays&&t.selectedDays.forEach((function(t){var n=moment(t).format("YYYYMMDD");e.addClassToDayContent(n,"c-calendar__table__day--selected")}))}},{key:"_updateFocusedDaysClasses",value:function(t){if(t.dayWithHandle){var e=t.dayWithHandle.format("YYYYMMDD");this.addClassToDayContent(e,"c-calendar__table__day--range-toggle")}}},{key:"_updateDateRangeClasses",value:function(t){var e=this;if(t.startDate){this.addClassToDayIndicator(t.startDate.format("YYYYMMDD"),"c-calendar__table__range--start");var n=void 0;t.endDate?(this.addClassToDayIndicator(t.endDate.format("YYYYMMDD"),"c-calendar__table__range--end"),n=this.getDaysBetweenDates(t.startDate,t.endDate)):n=this.getDaysBetweenDates(t.startDate,this.endOfTime),n.forEach((function(t){e.addClassToDayIndicator(t,"c-calendar__table__range")})),t.startDate<this.startOfMonth&&t.endDate>=this.startOfMonth&&this.domRefs.calendarElement.classList.add("c-calendar__calendar--start-before"),t.endDate>this.endOfMonth&&t.startDate<=this.endOfMonth&&this.domRefs.calendarElement.classList.add("c-calendar__calendar--end-after")}}},{key:"_updateHighlightedDaysClasses",value:function(t){var e=this;t.highlightedDays&&t.highlightedDays.map((function(t){return moment(t).format("YYYYMMDD")})).forEach((function(t){e.addClassToDayContent(t,"c-calendar__table__day--highlighted")}))}},{key:"_updateEnabledDaysClasses",value:function(t){var e=this;t.minDate&&this.getDaysBetweenDates(t.minDate,this.endOfTime).forEach((function(t){e.addClassToDayContent(t,"c-calendar__table__day--enabled")}))}},{key:"isDayEnabled",value:function(t){return t&&!t.exclude&&this.parentCtrl.isDayEnabled(t)}},{key:"isDaySelected",value:function(t){return t&&!t.exclude&&this.parentCtrl.isDaySelected(t)}},{key:"isDayHighlighted",value:function(t){return t&&!t.exclude&&this.parentCtrl.isDayHighlighted(t)}},{key:"isWithinRange",value:function(t){return!!t&&(!(t.exclude===this.EXCLUDE_PREV_MONTH&&this.parentCtrl.isRangeEnd(t)||t.exclude===this.EXCLUDE_NEXT_MONTH&&this.parentCtrl.isRangeStart(t))&&this.parentCtrl.isWithinRange(t))}},{key:"isRangeStart",value:function(t){return t&&!t.exclude&&this.parentCtrl.isRangeStart(t)}},{key:"isRangeEnd",value:function(t){return t&&!t.exclude&&this.parentCtrl.isRangeEnd(t)}},{key:"isDayCurrentRangeHandle",value:function(t){return t&&!t.exclude&&this.parentCtrl.isDayCurrentRangeHandle(t)}},{key:"selectDay",value:function(t){return!(t.exclude||!t.moment||!this.parentCtrl.isDayEnabled(t))&&this.parentCtrl.setDay(t)}},{key:"_generateMonthDataset",value:function(){var t=this.momentDate.clone();t.startOf("month").startOf("day");var e=new Array([]);e[0].push({moment:t.clone(),dayOfMonth:t.date(),startOfWeek:0===t.day(),endOfWeek:6===t.day(),enabled:!1});var n=t.clone();n.subtract(1,"day").valueOf();var i=t.clone();i.add(1,"month").valueOf();for(var a=t.day();a>0;)e[0].unshift({exclude:this.EXCLUDE_PREV_MONTH,moment:n}),a-=1;var s=0,r=e[0].length;7===r&&(s+=1);var o=t.clone();o.endOf("month");for(var c=1;c<o.date();c++){e[s]=e[s]||[];var l=e[s],u=t.clone();u.add(c,"day");var d={moment:u.clone(),dayOfMonth:u?u.date():void 0,startOfWeek:0===l.length,endOfWeek:6===l.length,enabled:!1};if(r=l.push(d),d.endOfWeek&&(s+=1),c===o.daysInMonth()-1&&r<7)for(;r<7;)e[s].push({exclude:this.EXCLUDE_NEXT_MONTH,moment:i}),r+=1}this.weeks=e}}]),t}();c.$inject=["$scope","$element","$translate","$q"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";function i(t){return{require:"^ngModel",restrict:"A",link:function(e,n,i,a){var s=t.moment,r=i.dateFormat,o=i.indicateToday&&JSON.parse(i.indicateToday);i.$observe("dateFormat",(function(t){r!==t&&a.$modelValue&&(r=t)})),a.$formatters.push((function(t){var e=s(t).format(r);return r&&t?(o&&s().isSame(t,"day")&&(e=s(t).format(r)+" (Today)"),e):""}))}}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i,i.$inject=["$window"],t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4650),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("tangerine.app.core.components.dateDisplay",[]).component("tngDate",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4651)),a=s(n(4652));function s(t){return t&&t.__esModule?t:{default:t}}n(4653);var r={controller:i.default,template:a.default,bindings:{date:"<",format:"<"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.$log=e,this.tngDateSelectorConstants=n}return(0,a.default)(t,[{key:"$onInit",value:function(){"string"==typeof this.date&&(this.format||(this.applyDefaultFilter=!0))}}]),t}();r.$inject=["$log","tngDateSelectorConstants"],e.default=r,t.exports=e.default},function(t,e){t.exports='<span ng-if="$ctrl.applyDefaultFilter" class="c-date-display" ng-bind-html="::$ctrl.date.trim() | date: \'longDate\' | firstDayOfMonth"> </span> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4655)),a=s(n(4656));function s(t){return t&&t.__esModule?t:{default:t}}n(4657);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose(result)" class="c-double-safe-confirm-modal" hide-close="$ctrl.flowService.inLoadingMode"> <header> <span>{{ ::\'doubleSafeConfirmModal.title\' | translate }}</span> </header> <div> <p ng-bind-html="::\'doubleSafeConfirmModal.description\' | translate"></p> <p ng-bind-html="::\'doubleSafeConfirmModal.prompt\' | translate"></p> </div> <footer> <button class="btn btn--edit" ng-click="$ctrl.onModalClose(result)">{{ ::\'global.no\' | translate }} </button> <button class="btn btn--orange CB_ReadOnly" ng-click="$ctrl.onAccept()">{{ ::\'global.yes\' | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.authService=e}return(0,a.default)(t,[{key:"onModalClose",value:function(t){this.onClose(t)}},{key:"onAccept",value:function(){this.authService.logout()}}]),t}();r.$inject=["AuthService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4659)),a=s(n(4663));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("tangerine.employmentSIO",[]).service("EmploymentSIOService",a.default).component("tngEmploymentSio",i.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4660)),a=s(n(4661));function s(t){return t&&t.__esModule?t:{default:t}}n(4662);var r={template:a.default,controller:i.default,require:{form:"^form"},bindings:{customer:"<",initialIndustry:"<",initialOccupation:"<",initialStatus:"<",maxIndustryYears:"<?",minIndustryYears:"<?",pageId:"@",requireIndustry:"<",requireOccupation:"<",requireStatus:"<",showIndustryYears:"<?",titleKey:"@",validationOrder:"@?",statusHeader:"@?",industryHeader:"@?",occupationHeader:"@?"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.$scope=n,this.employmentInfoService=a,this.referenceDataConstants=s,this.referenceDataService=r,this.employedStatusCodes=o.EMPLOYED_STATUS_CODES,this._resetModels()}return(0,a.default)(t,[{key:"_resetModels",value:function(){this.industryMap={},this.employmentStatusOptions=[],this.employmentIndustryOptions=[]}},{key:"$onInit",value:function(){var t=this;this.isLoading=!0;var e=this.referenceDataConstants.TYPES,n=e.EMPLOYMENT_STATUSES,i=e.INDUSTRY_OCCUPATIONS;return this.referenceDataService.getDataByType([n,i]).then((function(e){t.$log.debug("Reference Data Response: ",e);var a=e[n],s=e[i];return t.employmentInfoService.loadEmploymentStatus({employee:t.customer,employmentStatusResults:a,scope:t,statusOptionsKey:"employmentStatusOptions"}),t.employmentInfoService.loadIndustries(s,t.employmentIndustryOptions,t.industryMap).then((function(){return t.employmentInfoService.loadOccupations(s,t.industryMap)}))})).then((function(){!t.customer.employmentStatus&&t.initialStatus?t.customer.employmentStatus=(t.employmentStatusOptions||[]).find(t.employmentInfoService.findCodeFactory(t.initialStatus)):t.customer.employmentStatus&&t.customer.employmentStatus.code&&(t.customer.employmentStatus=(t.employmentStatusOptions||[]).find(t.employmentInfoService.findCodeFactory(t.customer.employmentStatus.code))),!t.customer.employmentIndustry&&t.initialIndustry?t.customer.employmentIndustry=(t.employmentIndustryOptions||[]).find(t.employmentInfoService.findCodeFactory(t.initialIndustry)):t.customer.employmentIndustry&&t.customer.employmentIndustry.code&&(t.customer.employmentIndustry=(t.employmentIndustryOptions||[]).find(t.employmentInfoService.findCodeFactory(t.customer.employmentIndustry.code))),t.customer.employmentIndustry&&!t.customer.employmentOccupation&&t.initialOccupation?t.customer.employmentOccupation=(t.industryMap[t.customer.employmentIndustry.code]||[]).find(t.employmentInfoService.findCodeFactory(t.initialOccupation)):t.customer.employmentOccupation&&t.customer.employmentOccupation.code&&(t.customer.employmentOccupation=(t.industryMap[t.customer.employmentIndustry.code]||[]).find(t.employmentInfoService.findCodeFactory(t.customer.employmentOccupation.code))),t.isLoading=!1})).catch((function(e){return t.$log.error(e)}))}},{key:"isShowingMainTitle",get:function(){return!this.statusHeader&&this.industryHeader&&!this.occupationHeader}}]),t}();r.$inject=["$log","$scope","EmploymentSIOService","referenceDataConstants","ReferenceDataService","UserSettingsConstants"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-employment-sio__field"> <div ng-if="$ctrl.isShowingMainTitle" class="c-employment-sio__field-label"> {{ ::(($ctrl.titleKey || \'global.employmentInfo.title\') | translate) }} </div> <div ng-if="!$ctrl.isLoading" class="c-employment-sio__field-container--m-b field"> <label ng-if="$ctrl.statusHeader" id="{{::$ctrl.pageId}}_employmentStatus_label">{{::$ctrl.statusHeader}} </label> <tng-select-autocomplete input-id="{{::$ctrl.pageId}}_employmentStatus" validation-order="{{$ctrl.validationOrder}}_1" ng-model="$ctrl.customer.employmentStatus" ng-model-set-raw-object="true" ng-required="$ctrl.requireStatus" options="$ctrl.employmentStatusOptions" option-label-key="name" is-static="true" placeholder="global.employmentInfo.employmentStatus"></tng-select-autocomplete> </div> <div ng-if="$ctrl.customer.employmentStatus && $ctrl.customer.employmentStatus.require_employment_details && !$ctrl.isLoading"> <div class="c-employment-sio__field-container--m-b field"> <label ng-if="$ctrl.industryHeader" id="{{::$ctrl.pageId}}_employmentIndustry_label">{{::$ctrl.industryHeader}} </label> <tng-select-autocomplete input-id="{{::$ctrl.pageId}}_employmentIndustry" validation-order="{{$ctrl.validationOrder}}_2" ng-model="$ctrl.customer.employmentIndustry" ng-model-set-raw-object="true" ng-required="$ctrl.requireIndustry" options="$ctrl.employmentIndustryOptions" option-label-key="name" is-static="true" placeholder="global.employmentInfo.employmentIndustry"></tng-select-autocomplete> </div> <div class="grid__container top-margin-medium"> <div class="grid__column--1of2"> <div class="field" ng-if="$ctrl.showIndustryYears"> <tng-numeric-input-field input-id="{{::$ctrl.pageId}}IndustryYears" max="$ctrl.maxIndustryYears" min="$ctrl.minIndustryYears" tng-model="$ctrl.customer.industryYears" tng-required="true" placeholder="{{::\'global.employmentInfo.industryYears.placeholder\' | translate}}" simple-header="{{::\'global.employmentInfo.industryYears.header\' | translate}}" validation-order="{{$ctrl.validationOrder}}_3"></tng-numeric-input-field> </div> </div> </div> <div class="c-employment-sio__field-container--m-b field" ng-if="$ctrl.customer.employmentIndustry"> <label ng-if="$ctrl.occupationHeader" id="{{::$ctrl.pageId}}_employmentOccupation_label">{{::$ctrl.occupationHeader}} </label> <tng-select-autocomplete input-id="{{::$ctrl.pageId}}_employmentOccupation" validation-order="{{$ctrl.validationOrder}}_4" ng-model="$ctrl.customer.employmentOccupation" ng-model-set-raw-object="true" ng-required="$ctrl.requireOccupation" options="$ctrl.industryMap[$ctrl.customer.employmentIndustry.code]" option-label-key="name" is-static="true" placeholder="global.employmentInfo.employmentOccupation"></tng-select-autocomplete> </div> </div> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.$q=n,this.referenceDataConstants=a,this.referenceDataService=s,this.requesterService=r,this.serviceConstants=o}return(0,a.default)(t,[{key:"findCodeFactory",value:function(t){return function(e){return e&&e.code===t}}},{key:"_loadOccupation",value:function(t,e){var n=this;return this.$q.when().then((function(){e.push({code:t.code,name:t.name})})).catch((function(e){n.$log.error("Missing occupation: "+t,e)}))}},{key:"loadOccupations",value:function(t,e){var n=this,i=t.map((function(t){var i=t.data.map((function(i){return n._loadOccupation(i,e[t.code])}));return n.$q.all(i)}));return this.$q.all(i)}},{key:"_loadIndustry",value:function(t,e,n){var i=this;return this.$q.when().then((function(){e.push({code:t.code,name:t.name}),n[t.code]||(n[t.code]=[])})).catch((function(e){i.$log.error("Missing occupation industry: "+t,e)}))}},{key:"loadIndustries",value:function(t,e,n){var i=this,a=t.map((function(t){return i._loadIndustry(t,e,n)}));return this.$q.all(a)}},{key:"loadEmploymentStatus",value:function(t){var e=t.employee,n=t.employmentStatusResults,i=t.scope,a=t.statusOptionsKey;i[a]=n,e&&e.employmentStatus&&(e.employmentStatus=(i[a]||[]).find(this.findCodeFactory(e.employmentStatus.code)))}}]),t}();r.$inject=["$log","$q","referenceDataConstants","ReferenceDataService","RequesterService","serviceConstants"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(4665)),a=u(n(4666)),s=u(n(4670)),r=u(n(4674)),o=u(n(4675)),c=u(n(2032)),l=u(n(1996));function u(t){return t&&t.__esModule?t:{default:t}}var d=angular.module("tangerine.app.core.components.pendingApplications",[c.default.name,l.default.name]).service("PendingApplicationsService",r.default).service("PendingApplicationsFlowService",o.default).component("tngPendingApplications",a.default).component("tngPendingApplicationsInfoModal",s.default).constant("pendingApplicationsConstants",i.default);e.default=d,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={T2033:"T2033",MORTGAGE:"MRTG_ENROLLMENT",CREDIT:"CREDIT",MUTUAL_FUND:"MUTUAL_FUND",DEPOSIT_ENROLLMENT:"DEPOSIT_ENROLLMENT",CC_ENROLLMENT:"CC_ENROLLMENT",RSP_LOAN:"RSPLOAN",RSPPAL:"RSPPAL"},a={INPROGRESS:"INPROGRESS",UNDER_REVIEW:"UNDER_REVIEW",APPROVED:"APPROVED",READY_TO_FUND:"READY_TO_FUND",FUNDED:"FUNDED",MISSING_INFO:"MISSING_INFO",DECISIONED:"DECISIONED",INCOMPLETE:"INCOMPLETE",EXPIRED:"EXPIRED",PA_APPROVED:"PA_APPROVED",NONFUND_APPROVED:"NONFUND_APPROVED"},s={AVAILABLE_ACTIONS:{VIEW:"VIEW",EDIT:"EDIT"},TYPES:i,QUERY_FILTERS:{PENDING_TRANSFERS:"type=T_2033&pending=true",PENDING_APPLICATIONS:"type=T_2033&type="+i.MORTGAGE+"&type="+i.MUTUAL_FUND+"&type="+i.RSP_LOAN+"&type="+i.CC_ENROLLMENT+"&type="+i.CREDIT+"&pending=true",PENDING_APPLICATIONS_ALL:"pending=true",PENDING_APPLICATIONS_MORTGAGE:"type="+i.MORTGAGE+"&pending=true"},STATUS:{COMPLETE:"COMPLETE",INCOMPLETE:"INCOMPLETE",SUBMITTED:"SUBMITTED",INCO:"INCO",SIG:"SIG",SIGO:"SIGO",NEW:"NEW",PENDING:"PENDING",REACTIVATED:"REACTIVATED",ACTION:"ACTION",FORWARDED:"FORWARDED",APPROVED:"APPROVED",INSTRUCT:"INSTRUCT",FULFILLMENT:"FULFILLMENT",FUNDED:"FUNDED",CONFIRMED_FUNDED:"CONFIRMED_FUNDED",REGISTERED:"REGISTERED",INCOMPLETE_RESUBMISSION:"INCOMPLETE_RESUBMISSION",MISSING_INFO:"MISSING_INFO",DECLINED:"DECLINED",FRAUD:"FRAUD",EXPIRED:"EXPIRED",ACTIVE:"ACTIVE",WAIT_FOR_SIGNED_FORM:"WAIT_FOR_SIGNED_FORM",SENT:"SENT",TOQA:"TOQA",WAIT:"WAIT",REVIEW:"REVIEW",PENA:"PENA",PENAR:"PENAR"},MORTGAGE_STATES:{ADJUDICATE:"ADJUDICATE",FULFILLMENT:"FULFILLMENT",REWORK:"REWORK",FUNDING:"FUNDING",SERVICING:"SERVICING"},MORTGAGE_TRACKER_STATUSES:[a.DECISIONED,a.APPROVED,a.READY_TO_FUND,a.UNDER_REVIEW,a.MISSING_INFO,a.PA_APPROVED,a.NONFUND_APPROVED],RSPLOAN_STATES:{ADJUDICATE:"ADJUDICATE",FULFILLMENT:"FULFILLMENT"},MORTGAGE_TRANSACTION_TYPES:{ASSUMPTION:"AS",PRE_APPROVAL:"PA",ADD_COVENANT_CHANGE:"AC",RELEASE_COVENANT_CHANGE:"RC",PURCHASE:"PU"},MORTGAGE_WEB_STATUS:a,RSP_LOAN_WEB_STATUS:{INPROGRESS:"INPROGRESS",UNDER_REVIEW:"UNDER_REVIEW",APPROVED:"APPROVED",FUNDED:"FUNDED",MISSING_INFO:"MISSING_INFO",DECISIONED:"DECISIONED",INCOMPLETE:"INCOMPLETE",EXPIRED:"EXPIRED",PA_APPROVED:"PA_APPROVED",NONFUND_APPROVED:"NONFUND_APPROVED",SUBMITTED:"SUBMITTED"},PLAN_TYPE:{RIF:"RIF"},MUTUAL_FUND_TRANSACTION_TYPE:{ENROLLMENT:{RSP:"RSP",RSPSP:"RSPSP",TFSA:"TFSA",NREGJ:"NREGJ",NREG:"NREG"},EXISTING_TRANSFER:{RSP:"RSPTX",TFSA:"TFTX"}},DATE_FORMAT:{DATE_MONTH_YEAR:"D MMM YYYY"},PENDING_APPLICATIONS_INFO_MODAL_TYPES:{RSP_PRE_APPROVAL_EXISTS:"rsp_pre_approval_exists",MOBILE_CANT_RESUME_APPLICATION:"mobile_cant_resume_application",MORTGAGE_ENROLLMENT_CALL_IN:"mortgage_enrollment_call_in"},KYC_APPLICATION_TYPES:{DEPOSIT_ENROLLMENT:"DEPOSIT_ENROLLMENT",CC_ENROLLMENT:"CC_ENROLLMENT",RSPLOAN:"RSPLOAN",MRTG_ENROLLMENT:"MRTG_ENROLLMENT",MUTUAL_FUND:"MUTUAL_FUND",T2033:"T2033",CREDIT:"CREDIT"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4667)),a=s(n(4668));function s(t){return t&&t.__esModule?t:{default:t}}n(4669);var r={template:a.default,controller:i.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(365)),a=l(n(68)),s=l(n(269)),r=l(n(0)),o=l(n(2)),c=l(n(45));function l(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(e,n,i,a,s,o,c,l,u,d,h,f,p,g,m,_,v,S,T,y,E,A,b){var C=this;(0,r.default)(this,t),this.$log=e,this.$state=n,this.$translate=i,this.$timeout=a,this.$window=s,this.$filter=o,this.$q=c,this.flowService=l,this.PendingApplicationsService=u,this.pageFlowConstants=d,this.pendingApplicationsConstants=h,this.serviceConstants=f,this.ErrorService=p,this.ERROR_EVENTS=g.AVAILABLE_EVENTS,this.stateConstants=m,this.buildConstants=_,this.apiUrl=_.CONFIG.apiUrl,this.MutualFundService=v,this.ChooseAccountsFormService=S,this.accountConstants=T,this.EnvironmentService=y,this.RspLoanService=E,this.mortgageConstants=A,this.AnalyticsService=b,this.AVAILABLE_EVENTS=b.availableEvents,this.TYPE_ALL_APPLICATIONS="all",this.MODAL_TYPES=this.pendingApplicationsConstants.PENDING_APPLICATIONS_INFO_MODAL_TYPES,this.isPendingApplicationsInfoModalVisible=!1,this.pendingApplicationsInfoModalData=null,this.pendingApplicationsInfoModalMode=null,this.filter=function(t){var e=C.pendingApplicationsConstants.TYPES,n=C.MutualFundService.magicSwitchFundsUpgraded;return!C.typeFilterSelectDropdown||(n&&C.typeFilterSelectDropdown===e.MUTUAL_FUND?t.type===C.typeFilterSelectDropdown&&!C._isMutualFundTransfer(t):n&&C.typeFilterSelectDropdown===e.T2033?t.type===C.typeFilterSelectDropdown||t.type===e.MUTUAL_FUND&&C._isMutualFundTransfer(t):t.type===C.typeFilterSelectDropdown)}}return(0,o.default)(t,[{key:"$onInit",value:function(){var t=this;this.isMagicSwitchModalVisible=!1;var e=this.flowService;this.isCantResumeApplicationModalVisible=!1,e.activate(this.registerFlow),this.pageId="pendingApplicationsForm",this.typeFilterSelectDropdown="",this.flowService.onButtonClickDone=function(){t.resetSubmitErrors(),t.onClose()},this.getAllPendingApplications(),this.flowService.returnToStart()}},{key:"onModalClose",value:function(){this.resetSubmitErrors(),this.onClose()}},{key:"_showPendingApplicationsInfoModal",value:function(t,e){this.pendingApplicationsInfoModalMode=t,this.pendingApplicationsInfoModalData=e,this.isPendingApplicationsInfoModalVisible=!0}},{key:"onClosePendingApplicationsInfoModal",value:function(t){this.isPendingApplicationsInfoModalVisible=!1,t&&t.closeParentModal&&this.onModalClose()}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"getAllPendingApplications",value:function(){var t=this;this.pendingApplications=[],this.applicationsCount=0,this.applicationTypeFilters=[],this.PendingApplicationsService.getPendingApplicationsForModal().then((function(e){t.$log.debug("response received"),e.forEach((function(e){e.display_last_update_date=e.status_update_date?t.convertDateFormat(e.status_update_date):""})),t.pendingApplications=e;var n=new s.default(e.map((function(t){return t.type})));t.applicationTypeFilters=[].concat((0,a.default)(n)).map((function(e){return{label:t.$translate.instant("pendingApplications.applicationTypes.applicationType_"+e),value:e}})),t.applicationTypeFilters.unshift({label:t.$translate.instant("pendingApplications.applicationTypes.applicationType_ALL"),value:t.TYPE_ALL_APPLICATIONS}),t.applicationsCount=t.pendingApplications.length}),(function(e){t.showSubmitErrors(e)}))}},{key:"convertDateFormat",value:function(t){return(0,c.default)(t,"YYYY-MM-DD").format(this.pendingApplicationsConstants.DATE_FORMAT.DATE_MONTH_YEAR)}},{key:"onTypeSelect",value:function(){this.selectedType===this.TYPE_ALL_APPLICATIONS?this.typeFilterSelectDropdown="":this.typeFilterSelectDropdown=this.selectedType}},{key:"onCloseCantResumeApplicationModal",value:function(){this.isCantResumeApplicationModalVisible=!1}},{key:"handleApplicationSelected",value:function(t){var e=this;if(t.cursor){var n=this.pendingApplicationsConstants;if(t.type===this.pendingApplicationsConstants.TYPES.CREDIT)t.status===this.pendingApplicationsConstants.STATUS.INCOMPLETE&&(this.onModalClose(),this.$state.go(this.stateConstants.EXISTING_CLIENT_ONBOARDING,{tlocApp:{isIncomplete:!0,dealId:t.dealId}}));else if(t.type===this.pendingApplicationsConstants.TYPES.T2033){var i=t.plan_type===n.PLAN_TYPE.RIF&&!t.to_account&&t.submit_date;t.to_account||i?(this.isApplicationSelected=!0,this.pendingAppsAccount=i?{type:this.accountConstants.ACCOUNT_TYPES.SAVINGS,description:this.$translate.instant("clientOnboarding.wrapUp.cc.toBeIssued")}:null,this.application=t,this.isMagicSwitchModalVisible=!0):this.addSubmitErrorFromText(this.$translate.instant("pendingApplications.errors.savingsMissingInfo"))}else if(t.type===this.pendingApplicationsConstants.TYPES.MORTGAGE)this._handleMortgageClick(t);else if(t.type===this.pendingApplicationsConstants.TYPES.MUTUAL_FUND)this._handleMutualFundClick(t);else if(t.type===this.pendingApplicationsConstants.TYPES.RSP_LOAN){if(t.status!==this.pendingApplicationsConstants.STATUS.INCOMPLETE)return;if(this.EnvironmentService.isNative())return void this._showPendingApplicationsInfoModal(this.MODAL_TYPES.MOBILE_CANT_RESUME_APPLICATION);this.RspLoanService.getAvailablePAL().then((function(n){n&&n.amount_requested>0?e._showPendingApplicationsInfoModal(e.MODAL_TYPES.RSP_PRE_APPROVAL_EXISTS,{remainingAmount:e.$filter("currency")(n.amount_requested)}):e._canResumeRspLoan(t).then((function(n){n&&(e.onModalClose(),e.$state.go(e.stateConstants.EXISTING_CLIENT_ONBOARDING,{rspLoan:{isIncomplete:!0,dealId:t.dealId,postApproval:!1,application:!0}}))}))}))}}}},{key:"_handleMortgageClick",value:function(t){var e=this.pendingApplicationsConstants.MORTGAGE_WEB_STATUS;this.EnvironmentService.isNative()&&t.status===this.pendingApplicationsConstants.STATUS.INCOMPLETE?this._showPendingApplicationsInfoModal(this.MODAL_TYPES.MOBILE_CANT_RESUME_APPLICATION):t.showMortgageTracker?(this.onModalClose(),this.$state.go(this.stateConstants.MORTGAGE_TRACKER,{dealId:t.dealId})):t.webstatus===e.PA_APPROVED?this.flowService.moveTo(this.flowService.STATES.PREAPPROVED_MORTGAGE):t.webstatus===e.INCOMPLETE&&(this.EnvironmentService.isNative()||(t.canResumeEnrollment?(this.onModalClose(),this.$state.go(this.stateConstants.EXISTING_CLIENT_ONBOARDING,{mortgage:{isIncomplete:!0,dealId:t.dealId,isHeloc:t.loan_type===this.mortgageConstants.LOAN_APPLICATION_TYPE.HELOC}})):(this.AnalyticsService.sendAction(this.AVAILABLE_EVENTS.MORTGAGE_APP_PENDING_RESUME_CALL_IN),this._showPendingApplicationsInfoModal(this.MODAL_TYPES.MORTGAGE_ENROLLMENT_CALL_IN))))}},{key:"_handleMutualFundClick",value:function(t){var e=this,n=this.PendingApplicationsService.isMutualFundApplicationIncomplete(t);if(this.MutualFundService.magicSwitchFundsUpgraded&&!n&&t.ms_deal_id){this.isApplicationSelected=!0;var i=this.pendingApplicationsConstants.MUTUAL_FUND_TRANSACTION_TYPE,a=-1!==[i.ENROLLMENT.RSP,i.ENROLLMENT.TFSA,i.ENROLLMENT.RSPSP].indexOf(t.transaction_type);this.pendingAppsAccount=a?{type:this.accountConstants.ACCOUNT_TYPES.MUTUAL_FUND,description:this.$translate.instant("clientOnboarding.wrapUp.cc.toBeIssued")}:null,this.pendingAppsMfDealId=t.dealId,this.application=t,this.PendingApplicationsService.isApplicationProcessed(t)?this.isMfAppInProgressModalVisible=!0:this.isMagicSwitchModalVisible=!0}else n?(this.flowService.enterLoadingMode(),this.MutualFundService.getMutualFundApplication(t.dealId).then((function(){e.flowService.exitLoadingMode(),e.onModalClose(),e.$state.go(e.stateConstants.EXISTING_CLIENT_ONBOARDING,{mutualFund:{isIncomplete:n,dealId:t.dealId,planType:t.transaction_type}})})).catch((function(t){e.flowService.exitLoadingMode(),t.response_status.status_code===e.serviceConstants.STATUS_CODES.VALIDATION_ERROR&&e.addSubmitErrorFromText(e.$translate.instant("pendingApplications.errors.mfMissingInfo"))}))):t.cursor&&(this.application=t,this.isApplicationSelected=!0,this.isMfAppInProgressModalVisible=!0)}},{key:"closeMfAccountInfoModal",value:function(){this.isMfAppInProgressModalVisible=!1,this.isApplicationSelected=!1,this.getAllPendingApplications()}},{key:"_canResumeRspLoan",value:function(t){var e=this,n=this.accountConstants.ACCOUNT_PPTS.RSP_LOAN;return this.ChooseAccountsFormService.getAvailableAccounts().then((function(t){var i=t.find((function(t){return t.profile_product_type===n}));return i?(i.isRspLoanPreApproval=!1,i.isRspLoanPostApproval=!1,e.ChooseAccountsFormService.getCustomerEligibilityForAccount(i).then((function(t){return t.isEligible||(e.$log.error("cannot resume rsp loan application: ",t),t.eligibilityError?e.addSubmitErrorFromText(e.$translate.instant(t.eligibilityError.message)):e.addSubmitErrorFromText(e.$translate.instant("global.errorCodes.generic"))),t.isEligible}))):(e.$log.error("cannot resume rsp loan application -- product not available"),e.addSubmitErrorFromText(e.$translate.instant("global.errorCodes.generic")),e.$q.resolve(!1))}))}},{key:"magicSwitchClosed",value:function(t){this.isMagicSwitchModalVisible=!1,this.isApplicationSelected=!1,t?this.getAllPendingApplications():this.onClose(),this.resetSubmitErrors()}},{key:"addSubmitErrorFromText",value:function(t){this.submitErrors=[],this.submitErrors.push(t),this.flowService.AnchorService.scrollToModalTop()}},{key:"showSubmitErrors",value:function(t){var e=this;return this.submitErrors=[],this.ErrorService.processError(t,this.ERROR_EVENTS.REQUEST_ERROR).then((function(t){e.submitErrors.push(t.message)}))}},{key:"resetSubmitErrors",value:function(){this.$log.debug("resetting submit errors"),this.submitErrors=[]}},{key:"getMutualFundTitle",value:function(t){return this._isMutualFundTransfer(t)?"pendingApplications.directTransferTransactionTypes."+t.transaction_type:"pendingApplications.applicationTypes.applicationTypeDisplay_MUTUAL_FUND"}},{key:"_isMutualFundTransfer",value:function(t){return-1!==(0,i.default)(this.pendingApplicationsConstants.MUTUAL_FUND_TRANSACTION_TYPE.EXISTING_TRANSFER).indexOf(t.transaction_type)}},{key:"hasSubmitErrors",get:function(){return this.submitErrors&&this.submitErrors.length>0}}]),t}();u.$inject=["$log","$state","$translate","$timeout","$window","$filter","$q","PendingApplicationsFlowService","PendingApplicationsService","pageFlowConstants","pendingApplicationsConstants","serviceConstants","ErrorService","errorConstants","stateConstants","buildConstants","MutualFundService","ChooseAccountsFormService","accountConstants","EnvironmentService","RspLoanService","mortgageConstants","AnalyticsService"],e.default=u,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog ng-hide="$ctrl.isApplicationSelected" on-close="$ctrl.onModalClose(result)" class="c-pending-applications" hide-close="$ctrl.flowService.isLoading" flow-service="$ctrl.flowService"> <header> {{$ctrl.flowService.currentState.titleKey | translate }} </header> <div ng-if="$ctrl.flowService.isLoading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div ng-if="$ctrl.flowService.isDoneLoading"> <tng-loading-done></tng-loading-done> </div> <div ng-hide="$ctrl.flowService.inLoadingMode"> <div class="c-move-money__error" ng-show="$ctrl.submitErrors"> <tng-error-message ng-if="$ctrl.hasSubmitErrors"> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DONE"> <p class="c-pending-applications__subheader" ng-bind-html="\'pendingApplications.intro.description\' | translate:{ applicationsCount: $ctrl.applicationsCount }"></p> <div class="c-pending-applications__select--widthauto"> <tng-select-autocomplete ng-model="$ctrl.selectedType" options="$ctrl.applicationTypeFilters" option-label-key="label" option-value-key="value" on-select="$ctrl.onTypeSelect()" is-static="true" placeholder="pendingApplications.applicationTypes.applicationType_ALL"></tng-select-autocomplete> </div> <table class="table table--full c-pending-applications__table c-pending-applications__hide-mobile"> <thead> <tr> <th>{{ \'pendingApplications.tableHeadings.application\' | translate}}</th> <th>{{ ::\'pendingApplications.tableHeadings.type\' | translate}}</th> <th>{{ ::\'pendingApplications.tableHeadings.date_modified\' | translate}}</th> <th>{{ ::\'pendingApplications.tableHeadings.status\' | translate}}</th> <th>{{ ::\'pendingApplications.tableHeadings.referenceNumber\' | translate}}</th> </tr> </thead> <tbody> <tr ng-class="{ \'c-pending-applications__cursor--pointer\' : application.cursor }" ng-repeat="application in $ctrl.pendingApplications | filter: $ctrl.filter | orderBy: \'-status_update_date\'" ng-click="$ctrl.handleApplicationSelected(application)"> <td> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.MORTGAGE" class="table__quiet"> <strong>{{ ::\'pendingApplications.applicationTypes.applicationTypeDisplay_\' + application.loan_type | blankIfNotFoundTranslate }}</strong> </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.MUTUAL_FUND" class="table__quiet"> <strong>{{ ::$ctrl.getMutualFundTitle(application) | translate }}</strong> </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.RSP_LOAN" class="table__quiet"> <strong>{{ ::\'pendingApplications.applicationTypes.applicationType_RSPLOAN\' | translate }}</strong> </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.T2033" class="table__quiet"> <strong>{{ ::\'pendingApplications.directTransferTransactionTypes.\' + application.plan_type | blankIfNotFoundTranslate }}</strong> </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.CC_ENROLLMENT" class="table__quiet"> <strong>{{ ::\'pendingApplications.applicationTypes.applicationType_CC_ENROLLMENT\' | translate }}</strong> </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.CREDIT" class="table__quiet"> <strong>{{ ::\'pendingApplications.applicationTypes.applicationType_CREDIT\' | translate }}</strong> </div> </td> <td> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.MORTGAGE" class="table__quiet"> {{ ::\'mortgage.transactionTypes.\' + application.transaction_type | blankIfNotFoundTranslate }} </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.MUTUAL_FUND" class="table__quiet"> {{ ::\'pendingApplications.investingTransactionTypes.\' + application.transaction_type | blankIfNotFoundTranslate }} </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.RSP_LOAN" class="table__quiet"> {{ ::\'pendingApplications.investingTransactionTypes.\' + application.transaction_type | blankIfNotFoundTranslate }} </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.T2033" class="table__quiet"> {{ ::application.financialInstitution.bank_name }} <div ng-if="application.financialInstitution.amount" class="table__quiet">{{ ::\'pendingApplications.text.approx\' | translate }} {{ ::application.financialInstitution.amount | currency }}</div> </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.CC_ENROLLMENT" class="table__quiet"> {{ ::\'pendingApplications.creditCardTransactionTypes.CC\' | blankIfNotFoundTranslate }} </div> </td> <td> <div class="table__quiet">{{application.display_last_update_date}}</div> </td> <td> <div class="table__quiet"> {{ ::\'pendingApplications.status.\' + application.type + \'.\' + application.webstatus | blankIfNotFoundTranslate }}</div> </td> <td> <div class="table__quiet" id="application_deal_id">{{::application.dealId}}</div> </td> </tr> </tbody> </table> <div class="c-pending-applications__show-mobile c-pending-applications__mobile"> <div class="c-pending-applications__table__header c-pending-applications__mobile__container"> <div class="c-pending-applications__mobile__header"> <span>{{ \'pendingApplications.tableHeadings.application\' | translate}}</span> <span>{{ ::\'pendingApplications.tableHeadings.status\' | translate}}/{{ ::\'pendingApplications.tableHeadings.referenceNumber\' | translate}}</span> </div> <div> <div class="c-pending-applications__mobile__tile" ng-class="{ \'c-pending-applications__cursor--pointer\' : application.cursor }" ng-repeat="application in $ctrl.pendingApplications | filter: $ctrl.filter | orderBy: \'-status_update_date\'" ng-click="$ctrl.handleApplicationSelected(application)"> <div class="c-pending-applications__mobile__tile__header">{{ ::\'pendingApplications.tableHeadings.date_modified\' | translate}} : {{application.display_last_update_date}}</div> <div class="c-pending-applications__mobile__tile__content"> <div class="c-pending-applications__mobile__tile__content__child"> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.MORTGAGE" class="table__quiet"> <strong>{{ ::\'pendingApplications.applicationTypes.applicationTypeDisplay_\' + application.loan_type | blankIfNotFoundTranslate }}</strong> </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.MUTUAL_FUND" class="table__quiet"> <strong>{{ ::$ctrl.getMutualFundTitle(application) | translate }}</strong> </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.RSP_LOAN" class="table__quiet"> <strong>{{ ::\'pendingApplications.applicationTypes.applicationType_RSPLOAN\' | translate }}</strong> </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.T2033" class="table__quiet"> <strong>{{ ::\'pendingApplications.directTransferTransactionTypes.\' + application.plan_type | blankIfNotFoundTranslate }}</strong> </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.CC_ENROLLMENT" class="table__quiet"> <strong>{{ ::\'pendingApplications.applicationTypes.applicationType_CC_ENROLLMENT\' | translate }}</strong> </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.CREDIT" class="table__quiet"> <strong>{{ ::\'pendingApplications.applicationTypes.applicationType_CREDIT\' | blankIfNotFoundTranslate }}</strong> </div> <div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.MORTGAGE" class="table__quiet"> {{ ::\'mortgage.transactionTypes.\' + application.transaction_type | blankIfNotFoundTranslate }} </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.MUTUAL_FUND" class="table__quiet"> {{ ::\'pendingApplications.investingTransactionTypes.\' + application.transaction_type | blankIfNotFoundTranslate }} </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.RSP_LOAN" class="table__quiet"> {{ ::\'pendingApplications.investingTransactionTypes.\' + application.transaction_type | blankIfNotFoundTranslate }} </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.T2033" class="table__quiet"> {{ ::application.financialInstitution.bank_name }} <div ng-if="application.financialInstitution.amount" class="table__quiet">{{ ::\'pendingApplications.text.approx\' | translate }} {{ ::application.financialInstitution.amount | currency }}</div> </div> <div ng-if="application.type === $ctrl.pendingApplicationsConstants.TYPES.CC_ENROLLMENT" class="table__quiet"> {{ ::\'pendingApplications.creditCardTransactionTypes.CC\' | blankIfNotFoundTranslate }} </div> </div> </div> <div class="c-pending-applications__mobile__tile__content__child"> <div> {{ ::\'pendingApplications.status.\' + application.type + \'.\' + application.webstatus | blankIfNotFoundTranslate }}<br/> </div> <div class="table__quiet" id="application_deal_id">{{::application.dealId}}</div> </div> </div> </div> </div> </div> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.PREAPPROVED_MORTGAGE"> <p ng-bind-html="\'pendingApplications.mortgage.preapproval_text1\' | translate"></p> </div> </div> <footer ng-hide="$ctrl.flowService.inLoadingMode || $ctrl.flowService.currentState === $ctrl.flowService.STATES.PREAPPROVED_MORTGAGE"> <button actionable-id="pending-actions-next" class="btn btn--orange" ng-class="{\'CB_ReadOnly\': $ctrl.flowService.CB_DISABLED_BUTTONS.includes($ctrl.flowService.BUTTONS.BTN_ORG.type)}" ng-show="$ctrl.flowService.BUTTONS.BTN_ORG.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_ORG.disable" ng-click="$ctrl.flowService.onButtonClick($ctrl.flowService.BUTTONS.BTN_ORG)"> {{ $ctrl.flowService.BUTTONS.BTN_ORG.type.label | translate }} </button> </footer> <footer ng-show="$ctrl.flowService.currentState === $ctrl.flowService.STATES.PREAPPROVED_MORTGAGE"> <button actionable-id="pending-actions-return-start" class="btn btn--edit" ng-click="$ctrl.flowService.returnToStart()"> {{ $ctrl.flowService.BUTTONS.BTN_GRY.type.label | translate }} </button> </footer> </tng-modal-dialog> <tng-magic-switch ng-if="$ctrl.isMagicSwitchModalVisible" on-close="$ctrl.magicSwitchClosed(isReloadPendingApplications)" is-on-boarding="false" account="$ctrl.pendingAppsAccount" mf-deal-id="$ctrl.pendingAppsMfDealId" application="$ctrl.application"> </tng-magic-switch> <tng-pending-applications-info-modal ng-if="$ctrl.isPendingApplicationsInfoModalVisible" mode="$ctrl.pendingApplicationsInfoModalMode" data="$ctrl.pendingApplicationsInfoModalData" on-close="$ctrl.onClosePendingApplicationsInfoModal({closeParentModal})"> </tng-pending-applications-info-modal> <tng-application-in-progress-modal ng-if="$ctrl.isMfAppInProgressModalVisible" on-close="$ctrl.closeMfAccountInfoModal()" on-done="$ctrl.onClose()" account="$ctrl.application"></tng-application-in-progress-modal> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4671)),a=s(n(4672));function s(t){return t&&t.__esModule?t:{default:t}}n(4673);var r={template:a.default,controller:i.default,bindings:{onClose:"&",mode:"<",data:"<?"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.$log=e,this.$state=n,this.pendingApplicationsConstants=a,this.stateConstants=s,this.EnvironmentService=r,this.MODAL_TYPES=this.pendingApplicationsConstants.PENDING_APPLICATIONS_INFO_MODAL_TYPES,this.baseUrl=this.EnvironmentService.getBaseUrl()}return(0,a.default)(t,[{key:"onNextClick",value:function(){this.$state.go(this.stateConstants.EXISTING_CLIENT_ONBOARDING,{products:5100}),this.onClose({closeParentModal:!0})}},{key:"isMobileCantResumeMode",get:function(){return this.mode===this.MODAL_TYPES.MOBILE_CANT_RESUME_APPLICATION}},{key:"isRspHasPreApprovalMode",get:function(){return this.mode===this.MODAL_TYPES.RSP_PRE_APPROVAL_EXISTS}},{key:"isMortgageCallInMode",get:function(){return this.mode===this.MODAL_TYPES.MORTGAGE_ENROLLMENT_CALL_IN}}]),t}();r.$inject=["$log","$state","pendingApplicationsConstants","stateConstants","EnvironmentService"],e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose()" class="c-pending-applications-info-modal"> <header ng-if="$ctrl.isMobileCantResumeMode"> {{ ::\'pendingApplications.infoModal.redirect.header\' | translate }} </header> <div ng-if="$ctrl.isMobileCantResumeMode"> <p class="medium" id="resumeApplicationMessage"> <span>{{ ::\'pendingApplications.infoModal.redirect.message\' | translate }}</span> </p> </div> <header ng-if="$ctrl.isRspHasPreApprovalMode"> {{ ::\'pendingApplications.infoModal.rspPreApprovalExists.header\' | translate }} </header> <div ng-if="$ctrl.isRspHasPreApprovalMode"> <p class="medium c-pending-applications-info-modal__subheader" ng-bind-html="::\'pendingApplications.infoModal.rspPreApprovalExists.body\' | translate : {\n      remainingAmount: $ctrl.data.remainingAmount\n    }"></p> <br> </div> <header ng-if="$ctrl.isMortgageCallInMode"> {{ ::\'pendingApplications.infoModal.mortgageCallIn.header\' | translate }} </header> <div ng-if="$ctrl.isMortgageCallInMode"> <p class="medium" id="resumeApplicationMessage"> <span>{{ ::\'pendingApplications.infoModal.mortgageCallIn.message\' | translate }}</span> </p> </div> <footer> <button class="btn btn--edit" ng-click="$ctrl.onClose()" actionable-id="c-pending-applications-info-modal_cancel"> {{ ::\'pendingApplications.buttons.back\' | translate }} </button> <button ng-if="$ctrl.isRspHasPreApprovalMode" class="btn" ng-click="$ctrl.onNextClick()" actionable-id="c-pending-applications-info-modal_next"> {{ ::\'pendingApplications.buttons.continue\' | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(539)),a=d(n(8)),s=d(n(33)),r=d(n(540)),o=d(n(198)),c=d(n(0)),l=d(n(2)),u=d(n(45));function d(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(e,n,i,a,s,r,o,l,u,d,h,f,p,g){(0,c.default)(this,t),this.$q=e,this.$log=n,this.EnvironmentService=i,this.RequesterService=a,this.AVAILABLE_SERVICES=s.AVAILABLE_SERVICES,this.STATUS_CODES=s.STATUS_CODES,this.serviceConstants=s,this.pendingApplicationsConstants=r,this.DateService=o,this.accountConstants=l,this.AccountService=u,this.buildConstants=d,this.mortgageConstants=h,this.CustomersService=f,this.KYCPendingService=p,this.ACCOUNT_CATEGORIES=l.ACCOUNT_CATEGORIES,this.locale=g.locale}var e;return(0,l.default)(t,[{key:"getPendingTransfers",value:function(){return this._getPendingApplications(this.pendingApplicationsConstants.QUERY_FILTERS.PENDING_TRANSFERS)}},{key:"getPendingApplicationsForModal",value:function(){var t=this;return this._getPendingApplications(this.pendingApplicationsConstants.QUERY_FILTERS.PENDING_APPLICATIONS).then((function(e){var n=[];if(e.service_requests){var i=t.filterOutExpiredApplication(e.service_requests),a=t.filterMfIncompleteApplications(i);i.forEach((function(e){var i=angular.copy(e);t.setCorrectApplicationStatus(i),t.shouldDisplayApplication(i)&&n.push(i)})),a.length>0&&t.getMfApplicationDetails(a)}return n}))}},{key:"getAllPendingApplications",value:function(){return this._getPendingApplications(this.pendingApplicationsConstants.QUERY_FILTERS.PENDING_APPLICATIONS_ALL)}},{key:"getMortgages",value:function(t){return this._getPendingApplications(this.pendingApplicationsConstants.QUERY_FILTERS.PENDING_APPLICATIONS_MORTGAGE,t)}},{key:"_getPendingApplications",value:function(t,e){var n=this,i={urlVars:{queryString:t=t+"&start-date="+this.DateService.momentToServerFormat((0,u.default)().subtract(180,"days"))}};return this.RequesterService.request(this.AVAILABLE_SERVICES.GET_PENDING_APPS,i,e).then((function(t){if(t.response_status.status_code===n.STATUS_CODES.SUCCESS)return t;throw t}))}},{key:"setCorrectApplicationStatus",value:function(t){if(t.cursor=!1,t.type===this.pendingApplicationsConstants.TYPES.T2033||t.type===this.pendingApplicationsConstants.TYPES.CC_ENROLLMENT)t.type!==this.pendingApplicationsConstants.TYPES.CC_ENROLLMENT&&(t.cursor=!0),t.status===this.pendingApplicationsConstants.STATUS.INCOMPLETE?t.webstatus=t.status:t.type===this.pendingApplicationsConstants.TYPES.CC_ENROLLMENT&&t.status===this.pendingApplicationsConstants.STATUS.NEW?t.webstatus=this.pendingApplicationsConstants.STATUS.SUBMITTED:t.webstatus=this.pendingApplicationsConstants.STATUS.PENDING;else if(t.type===this.pendingApplicationsConstants.TYPES.MUTUAL_FUND){t.cursor=!0;var e=this.isMutualFundApplicationIncomplete(t);t.webstatus=e?this.pendingApplicationsConstants.STATUS.INCOMPLETE:this.pendingApplicationsConstants.STATUS.PENDING,t.applicationDetail&&this.setInternalFundedMfAppStatus(t)}else t.type===this.pendingApplicationsConstants.TYPES.MORTGAGE?this.setMortgageStatus(t):t.type===this.pendingApplicationsConstants.TYPES.RSP_LOAN?(this.setRspLoanStatus(t),t.status===this.pendingApplicationsConstants.STATUS.INCOMPLETE&&(t.cursor=!0)):t.type===this.pendingApplicationsConstants.TYPES.RSPPAL?(t.webstatus=null,t.cursor=!0):t.type===this.pendingApplicationsConstants.TYPES.CREDIT&&(this.pendingApplicationsConstants.STATUS.PENA===t.status||this.pendingApplicationsConstants.STATUS.PENAR===t.status?(t.cursor=!0,t.webstatus=this.pendingApplicationsConstants.STATUS.INCOMPLETE,t.status=this.pendingApplicationsConstants.STATUS.INCOMPLETE):this.pendingApplicationsConstants.STATUS.REVIEW===t.status&&(t.webstatus=this.pendingApplicationsConstants.STATUS.PENDING,t.status=this.pendingApplicationsConstants.STATUS.PENDING))}},{key:"filterMfIncompleteApplications",value:function(t){var e=this;return t.filter((function(t){return t.type===e.pendingApplicationsConstants.TYPES.MUTUAL_FUND&&!e.isMutualFundApplicationIncomplete(t)}))}},{key:"getMfApplicationDetails",value:function(t){var e=this,n=t.map((function(t){return e.AccountService.getMutualFundDetails(t.dealId)}));return o.default.all(n)}},{key:"prepareMfApplicationDetail",value:function(t){var e=t.application,n=e.source_of_funds,i=e.investment_selection.fund_number,a=e.account_number||"",s=e.account_type;return{dealId:e.deal_id,accountNum:a,portfolioDisplayName:"investmentFund.recommendation."+i+".title",productDisplayName:"pendingApplications.investingTransactionTypes."+s,fundSource:n,applicationStatus:e.application_status}}},{key:"setInternalFundedMfAppStatus",value:function(t){var e=this.accountConstants.FUND_TYPE_CODES,n=[e.EFT,e.RISA,e.CTIF,e.TFISA,e.MFP],i=t.applicationDetail,a=i.fundSource,s=i.applicationStatus;-1!==n.indexOf(a.type_of_fund)&&s!==this.pendingApplicationsConstants.STATUS.WAIT&&(t.webstatus=this.pendingApplicationsConstants.STATUS.SUBMITTED)}},{key:"prepareKycPendingAccounts",value:(e=(0,r.default)(i.default.mark((function t(e,n){var o,c,l=this;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.sortedKycPendingAccounts=(o={},(0,s.default)(o,this.ACCOUNT_CATEGORIES.SPENDING,[]),(0,s.default)(o,this.ACCOUNT_CATEGORIES.SAVING,[]),(0,s.default)(o,this.ACCOUNT_CATEGORIES.INVESTING,[]),(0,s.default)(o,this.ACCOUNT_CATEGORIES.BORROWING,[]),o),t.prev=1,t.next=4,this._getProductCodeToDescriptionMapping();case 4:c=t.sent,e.forEach(function(){var t=(0,r.default)(i.default.mark((function t(e){var s,r,o,u,d,h,f,p,g,m,_,v,S,T;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s=l.pendingApplicationsConstants.KYC_APPLICATION_TYPES,r=s.DEPOSIT_ENROLLMENT,o=s.CC_ENROLLMENT,u=s.RSPLOAN,d=s.MRTG_ENROLLMENT,h=s.MUTUAL_FUND,f=s.T2033,p=s.CREDIT,g=void 0,m=void 0,_=void 0,v=void 0,S=void 0,t.t0=e.type,t.next=t.t0===r?9:t.t0===o?9:t.t0===u?16:t.t0===p?23:t.t0===d?30:t.t0===f?31:t.t0===h?47:67;break;case 9:return v=e.product_currency?""+e.product_code+e.product_currency:e.product_code+"CAD",S=l.accountConstants.PRODUCT_CODE_MAP[v],g="accountNicknames."+S,m=c[v].description,(0,a.default)(e,{applicationDetail:{primaryTitle:g,secondaryTitle:m}}),l._categorizeKycPendingAccount(e),t.abrupt("break",67);case 16:return v="5100CAD",S=l.accountConstants.PRODUCT_CODE_MAP[v],g="accountNicknames."+S,m=c[v].description,(0,a.default)(e,{applicationDetail:{primaryTitle:g,secondaryTitle:m}}),l._categorizeKycPendingAccount(e),t.abrupt("break",67);case 23:return v="6800CAD",S=l.accountConstants.PRODUCT_CODE_MAP[v],g="accountNicknames."+S,m=c[v].description,(0,a.default)(e,{applicationDetail:{primaryTitle:g,secondaryTitle:m}}),l._categorizeKycPendingAccount(e),t.abrupt("break",67);case 30:return t.abrupt("break",67);case 31:if(e.account_type!==l.accountConstants.ACCOUNT_TYPES.SAVINGS){t.next=41;break}t.t1=e.plan_type,t.next="RIF"===t.t1?35:"RSP"===t.t1?37:"TFSA"===t.t1?39:41;break;case 35:return v="3400CAD",t.abrupt("break",41);case 37:return v="3100CAD",t.abrupt("break",41);case 39:return v="3200CAD",t.abrupt("break",41);case 41:return S=l.accountConstants.PRODUCT_CODE_MAP[v],g="accountNicknames."+S,m=c[v].description,(0,a.default)(e,{applicationDetail:{primaryTitle:g,secondaryTitle:m}}),l._categorizeKycPendingAccount(e),t.abrupt("break",67);case 47:return t.prev=47,l.isPendingAccountsLoading=!0,t.next=51,l.AccountService.getMutualFundDetails(e.dealId);case 51:T=t.sent,_=l.prepareMfApplicationDetail(T),g=_.portfolioDisplayName,m=_.productDisplayName,(0,a.default)(e,{applicationDetail:{primaryTitle:g,secondaryTitle:m}}),l._categorizeKycPendingAccount(e),t.next=62;break;case 59:t.prev=59,t.t2=t.catch(47),l.$log.error("Error getting mutual fund application details with dealID: "+e.dealId,t.t2);case 62:return t.prev=62,l.isPendingAccountsLoading=!1,n(l.sortedKycPendingAccounts),t.finish(62);case 66:return t.abrupt("break",67);case 67:case"end":return t.stop()}}),t,l,[[47,59,62,66]])})));return function(e){return t.apply(this,arguments)}}()),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),this.$log.error("Error");case 11:return n(this.sortedKycPendingAccounts),t.abrupt("return",this.sortedKycPendingAccounts);case 13:case"end":return t.stop()}}),t,this,[[1,8]])}))),function(t,n){return e.apply(this,arguments)})},{key:"_categorizeKycPendingAccount",value:function(t){var e=this.pendingApplicationsConstants.KYC_APPLICATION_TYPES,n=e.RSPLOAN,i=e.MRTG_ENROLLMENT,a=e.MUTUAL_FUND,s=e.CC_ENROLLMENT,r=e.CREDIT,o=void 0;t.account_type?o=this.accountConstants.ACCOUNT_MAPS[t.account_type]:t.type===n?o=this.ACCOUNT_CATEGORIES.BORROWING:t.type===r?o=this.ACCOUNT_CATEGORIES.BORROWING:t.type===a?o=this.ACCOUNT_CATEGORIES.INVESTING:t.type===s?o=this.ACCOUNT_CATEGORIES.SPENDING:t.type===i||this.$log.warn("Application type and account group unrecognized."),this.sortedKycPendingAccounts[o].push(t)}},{key:"_getProductCodeToDescriptionMapping",value:function(){var t=this;return this._getAccountsRates().then((function(e){var n={};return e.rates.forEach((function(e){var i=""+e.profile_product_type+e.currency;n[i]={group:e.group||void 0,description:t._getProductDescription(e)}})),n}))}},{key:"_getAccountsRates",value:function(){var t={urlVars:{locale:this.locale}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNTS_RATES,t)}},{key:"_getProductDescription",value:function(t){return t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.RSP_LOAN?"rspLoan.tileTitle":this._isTlocRate(t)?t.product_description:t.product_description?t.product_description.replace(/^Tangerine\s|\sTangerine/,""):void 0}},{key:"_isTlocRate",value:function(t){return t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.TLOC_INTEREST||t.profile_product_type===this.accountConstants.ACCOUNT_PPTS.TLOC_INTEREST_BAL}},{key:"setApplicationProductType",value:function(t){var e,n=this.accountConstants.ACCOUNT_PPTS,i=this.pendingApplicationsConstants.MUTUAL_FUND_TRANSACTION_TYPE.ENROLLMENT,a=this.pendingApplicationsConstants.TYPES,r=(e={},(0,s.default)(e,i.RSP,n.MUTUAL_FUND_RSP),(0,s.default)(e,i.RSPSP,n.MUTUAL_FUND_RSP),(0,s.default)(e,i.TFSA,n.MUTUAL_FUND_TFSA),(0,s.default)(e,i.NREG,n.MUTUAL_FUND),e),o=void 0;switch(t.type){case a.MORTGAGE:o=t.loan_type===this.accountConstants.ACCOUNT_LOAN_TYPES.HELOC?n.HELOC:n.MORTGAGE;break;case a.RSP_LOAN:o=n.RSP_LOAN;break;case a.MUTUAL_FUND:o=r[t.transaction_type]}o&&(t.productCode=o)}},{key:"loadIncompleteResumableApplications",value:function(){var t=this,e=[];return this.getAllPendingApplications(this.pendingApplicationsConstants.QUERY_FILTERS.PENDING_APPLICATIONS).then((function(n){var i=n.service_requests.filter((function(e){return e.type!==t.pendingApplicationsConstants.TYPES.RSPPAL}));return t.filterOutExpiredApplication(i).forEach((function(n){var i=angular.copy(n);t.setCorrectApplicationStatus(i),t.isApplicationIncomplete(i)&&(t.setApplicationProductType(i),e.push(i))})),e}))}},{key:"isApplicationIncomplete",value:function(t){var e=this.pendingApplicationsConstants.TYPES;return t.type===e.MUTUAL_FUND?this.isMutualFundApplicationIncomplete(t):t.type===e.MORTGAGE?t.canResumeEnrollment:t.status===this.pendingApplicationsConstants.STATUS.INCOMPLETE}},{key:"isMutualFundApplicationIncomplete",value:function(t){return t.status===this.pendingApplicationsConstants.STATUS.INCOMPLETE||t.status===this.pendingApplicationsConstants.STATUS.INCO||t.status===this.pendingApplicationsConstants.STATUS.SIG||t.status===this.pendingApplicationsConstants.STATUS.SIGO}},{key:"setMortgageStatus",value:function(t){var e=null,n=this.pendingApplicationsConstants.MORTGAGE_STATES,i=this.pendingApplicationsConstants.STATUS,a=this.pendingApplicationsConstants.MORTGAGE_WEB_STATUS,s=this.pendingApplicationsConstants.MORTGAGE_TRANSACTION_TYPES,r=this.pendingApplicationsConstants.AVAILABLE_ACTIONS,o=t.stage||t.applicationStage,c=t.status||t.applicationStatus,l=t.transaction_type||t.transactionType;if(null!==o&&null!==c){o!==n.ADJUDICATE||c!==i.NEW&&c!==i.PENDING&&c!==i.REACTIVATED&&c!==i.ACTION?o!==n.ADJUDICATE||c!==i.FORWARDED&&c!==i.APPROVED?o===n.FULFILLMENT&&-1!==[i.FORWARDED,i.PENDING,i.ACTION,i.APPROVED,i.INSTRUCT,i.FULFILLMENT,i.REACTIVATED].indexOf(c)?e=a.APPROVED:o===n.FUNDING&&-1!==[i.FULFILLMENT,i.FORWARDED,i.APPROVED,i.PENDING,i.ACTION].indexOf(c)?e=a.READY_TO_FUND:o!==n.FUNDING||c!==i.FUNDED&&c!==i.CONFIRMED_FUNDED?o===n.SERVICING&&-1!==[i.FUNDED,i.REGISTERED,i.PENDING].indexOf(c)?e=a.FUNDED:-1!==[i.INCOMPLETE_RESUBMISSION,i.MISSING_INFO].indexOf(c)?e=a.MISSING_INFO:c===i.DECLINED||c===i.FRAUD?e=a.DECISIONED:c===i.INCOMPLETE?e=a.INCOMPLETE:c===i.EXPIRED?e=a.EXPIRED:c===i.SUBMITTED&&(e=a.UNDER_REVIEW):e=a.FUNDED:e=a.APPROVED:e=a.UNDER_REVIEW;var u=[s.ASSUMPTION,s.ADD_COVENANT_CHANGE,s.RELEASE_COVENANT_CHANGE];l===s.PRE_APPROVAL&&e===a.APPROVED?e=a.PA_APPROVED:-1===u.indexOf(l)||e!==a.APPROVED&&e!==a.READY_TO_FUND||(e=a.NONFUND_APPROVED)}t.webstatus=e||a.INPROGRESS;var d=!this.EnvironmentService.isNative(),h=this.EnvironmentService.get("mortgageTrackerNativeEnabled"),f=this.CustomersService.customerCIF,p=t.applicants&&f&&t.applicants.find((function(t){return t.cif===f||parseInt(t.cif,10)===parseInt(f,10)}))||{};t.isWaitingForJoint=(d||h)&&t.webstatus===a.INCOMPLETE&&t.available_action===r.EDIT&&p.type===this.mortgageConstants.APPLICANT_TYPE.PRIMARY&&p.status===this.mortgageConstants.APPLICANT_STATUS.COMPLETE;var g=this.pendingApplicationsConstants.MORTGAGE_TRACKER_STATUSES;t.showMortgageTracker=(d||h)&&(-1!==g.indexOf(t.webstatus)||t.isWaitingForJoint),t.showMortgageTrackerTile=t.showMortgageTracker&&l!==s.ADD_COVENANT_CHANGE&&l!==s.RELEASE_COVENANT_CHANGE&&l!==s.INCREASE&&t.webstatus!==a.DECISIONED,t.canResumeEnrollment=d&&!t.showMortgageTracker&&t.webstatus===a.INCOMPLETE&&t.available_action===r.EDIT,t.cursor=t.showMortgageTracker||e===a.INCOMPLETE||e===a.APPROVED&&l===s.PRE_APPROVAL}},{key:"setRspLoanStatus",value:function(t){var e=null,n=this.pendingApplicationsConstants.STATUS,i=this.pendingApplicationsConstants.RSP_LOAN_WEB_STATUS;t.stage===this.pendingApplicationsConstants.RSPLOAN_STATES.ADJUDICATE&&(t.status===n.NEW||t.status===n.PENDING||t.status===n.REACTIVATED||t.status===n.ACTION?e=i.UNDER_REVIEW:t.status===n.SUBMITTED?e=i.SUBMITTED:t.status===n.INCOMPLETE&&(e=i.INCOMPLETE)),t.webstatus=e}},{key:"shouldDisplayApplication",value:function(t){var e=!0,n=this.pendingApplicationsConstants.TYPES,i=this.pendingApplicationsConstants.STATUS;return t.type===n.RSPPAL?e=!1:t.type===n.RSP_LOAN?e=t.status===i.INCOMPLETE||t.status===i.NEW||t.status===i.SUBMITTED||t.status===i.PENDING:t.type===n.CC_ENROLLMENT?t.status!==i.APPROVED&&t.status!==i.ACTIVE||(e=!1):t.type===n.MUTUAL_FUND&&(e=t.transaction_type!==this.pendingApplicationsConstants.MUTUAL_FUND_TRANSACTION_TYPE.ENROLLMENT.NREGJ),e}},{key:"filterOutExpiredApplication",value:function(t){return t.filter((function(t){return!t.expiry_date||(0,u.default)(t.expiry_date,"YYYY-MM-DD").startOf("day").isAfter((0,u.default)().startOf("day"))}))}},{key:"isApplicationProcessed",value:function(t){return t.status===this.pendingApplicationsConstants.STATUS.TOQA}}]),t}();h.$inject=["$q","$log","EnvironmentService","RequesterService","serviceConstants","pendingApplicationsConstants","DateService","accountConstants","AccountService","buildConstants","mortgageConstants","CustomersService","KYCPendingService","LocaleService"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(177)),a=d(n(0)),s=d(n(2)),r=d(n(264)),o=d(n(266)),c=d(n(265)),l=d(n(267)),u=n(364);function d(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(t,n,s,o,c,l,u,d,h){(0,a.default)(this,e);var f=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,l,u,d));return f.BUTTON_TYPES=u.BUTTON_TYPES,f.$log=t,f.AnchorService=h,f.STATES={DONE:{titleKey:"pendingApplications.headings.done"},PREAPPROVED_MORTGAGE:{titleKey:"pendingApplications.headings.preapproved_mortgage"}},f}return(0,c.default)(e,t),(0,s.default)(e,[{key:"returnToStart",value:function(){this._resetState()}},{key:"_resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.currentState=this.STATES.DONE,this.BUTTONS={BTN_GRY:new u.ModalFooterButton(this.BUTTON_TYPES.BACK,!1,!1),BTN_ORG:new u.ModalFooterButton(this.BUTTON_TYPES.CLOSE,!0,!1)}}},{key:"onButtonClickDefault",value:function(t){t.label===this.BUTTON_TYPES.CLOSE.label&&this.onButtonClickDone()}},{key:"_getAnalyticsID",value:function(){return"pendingapplications"}}]),e}(l.default);h.$inject=["$log","$q","$transitions","$state","$window","$rootScope","pageFlowConstants","AnalyticsService","AnchorService"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4677),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("SalutationSelectModule",[]).component("tngSalutationSelect",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4678)),a=s(n(4679));function s(t){return t&&t.__esModule?t:{default:t}}n(4680);var r={template:i.default,controller:a.default,bindings:{initValue:"<",isRequired:"<",isReadOnly:"<",inputName:"@",onUpdate:"&",showValidationOnLoad:"<?",showWarningBorder:"<?",alternateLight:"<?",validationOrder:"@?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-select-autocomplete input-id="{{ ::$ctrl.inputName }}" ng-if="$ctrl.salutationSelectOptions" ng-model="$ctrl.modelValue" ng-readonly="$ctrl.isReadOnly" required="$ctrl.isRequired" ng-required="$ctrl.isRequired" on-select="$ctrl.onUpdate({ salutation: option.code })" options="$ctrl.salutationSelectOptions" option-label-key="name" placeholder="{{ ::\'global.salutationSelect.select\' | translate }}" select-type="$ctrl.COMPONENT_CONSTANTS.SELECT_TYPES.STATIC" show-default-warnings="$ctrl.showValidationOnLoad" ng-warning-border="$ctrl.showWarningBorder" alternate-light="$ctrl.alternateLight" validation-order="{{$ctrl.validationOrder}}_01"></tng-select-autocomplete> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.$translate=e,this.COMPONENT_CONSTANTS=n,this.$scope=a,this.modelValue=null,this.salutations=[{name:"Mr",code:"Mr."},{name:"Ms",code:"Ms"},{name:"Mrs",code:"Mrs."},{name:"Miss",code:"Miss"},{name:"Dr",code:"Dr."},{name:"Rev",code:"Rev."},{name:"Fr",code:"Fr."},{name:"M",code:"M."},{name:"Mlle",code:"Mlle."},{name:"Mme",code:"Mme."},{name:"Rv",code:"Rv."}]}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.stopWatch=this.$scope.$watch((function(){return t.initValue}),(function(){if(t.initValue){var e=t.salutations.find((function(e){return e.code.toLowerCase()===t.initValue.toLowerCase()||e.code.replace(/\./g,"").toLowerCase()===t.initValue.toLowerCase()}));e&&(t.modelValue=e.code,t.onUpdate({salutation:t.modelValue,express:!0})),t.stopWatch()}}),!0)}},{key:"salutationSelectOptions",get:function(){return this.salutations}}]),t}();r.$inject=["$translate","tngSelectAutocompleteConstants","$scope"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4682)),a=s(n(4687));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("tangerine.app.core.components.slider",[]).component("tngSlider",i.default).constant("sliderConstants",a.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4683)),a=s(n(4685));function s(t){return t&&t.__esModule?t:{default:t}}n(4686);var r={template:a.default,controller:i.default,bindings:{model:"=",options:"<"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=n(4684),o=function(){function t(e){(0,i.default)(this,t),this.$templateCache=e}return(0,a.default)(t,[{key:"$onInit",value:function(){this.$templateCache.get("TngSliderTemplate.html")||this.$templateCache.put("TngSliderTemplate.html",r)}}]),t}();o.$inject=["$templateCache"],e.default=o,t.exports=e.default},function(t,e){t.exports='<div class="rzslider">\n  <span class="rz-bar-wrapper"><span class="rz-bar"></span></span> \x3c!-- // 0 The slider bar --\x3e\n    <span class="rz-bar-wrapper">\n      <span class="rz-bar rz-selection" ng-style="barStyle"></span>\n    </span> \x3c!-- // 1 Highlight between two handles --\x3e\n  <span class="rz-pointer rz-pointer-min" ng-style=minPointerStyle></span> \x3c!-- // 2 Left slider handle --\x3e\n  <span class="rz-pointer rz-pointer-max" ng-style=maxPointerStyle></span> \x3c!-- // 3 Right slider handle --\x3e\n  <span class="rz-bubble rz-limit rz-floor"></span> \x3c!-- // 4 Floor label --\x3e\n  <span class="rz-bubble rz-limit rz-ceil"></span> \x3c!-- // 5 Ceiling label --\x3e\n  <span class="rz-bubble rz-bubble-model"></span> \x3c!-- // 6 Label above left slider handle --\x3e\n  <span class="rz-bubble no-label-injection"></span> \x3c!-- // 7 Label above right slider handle --\x3e\n  <span class="rz-bubble no-label-injection"></span> \x3c!-- // 8 Range label when the slider handles are close ex. 15 - 17 --\x3e\n  <ul ng-show="showTicks" class="rz-ticks"> \x3c!-- // 9 The ticks --\x3e\n    <li ng-repeat="t in ticks track by $index"\n        class="rz-tick"\n        ng-class="{\'rz-selected\': t.selected}"\n        ng-style="t.style" ng-attr-uib-tooltip="{{ t.tooltip }}"\n        ng-attr-tooltip-placement="{{t.tooltipPlacement}}"\n        ng-attr-tooltip-append-to-body="{{ t.tooltip ? true : undefined}}">\n      <span ng-if="t.value != null"\n            class="rz-tick-value"\n            ng-attr-uib-tooltip="{{ t.valueTooltip }}"\n            ng-attr-tooltip-placement="{{t.valueTooltipPlacement}}">{{ t.value }}</span>\n      <span ng-if="t.legend != null" class="rz-tick-legend">{{ t.legend }}</span>\n    </li>\n  </ul>\n</div>\n'},function(t,e){t.exports=' <rzslider class="tng-slider" rz-slider-model="$ctrl.model" rz-slider-options="$ctrl.options" rz-slider-tpl-url="TngSliderTemplate.html"></rzslider> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={TRANSLATE_LABELS:{MODEL:"model",HIGH:"high",FLOOR:"floor",CEIL:"ceil",TICK_VALUE:"tick-value"}},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4689),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("tangerine.app.core.components.stepSlider",[]).component("tngStepSlider",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4690)),a=s(n(4692));function s(t){return t&&t.__esModule?t:{default:t}}n(4693);var r={template:a.default,controller:i.default,bindings:{model:"=",options:"<"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=n(4691),o=function(){function t(e){(0,i.default)(this,t),this.$templateCache=e}return(0,a.default)(t,[{key:"$onInit",value:function(){this.$templateCache.get("TngStepSliderTemplate.html")||this.$templateCache.put("TngStepSliderTemplate.html",r)}}]),t}();o.$inject=["$templateCache"],e.default=o,t.exports=e.default},function(t,e){t.exports='<div class="rzslider">\n  <span class="rz-bar-wrapper"><span class="rz-bar"></span></span> \x3c!-- // 0 The slider bar --\x3e\n  <span class="rz-bar-wrapper">\n    <span class="rz-bar rz-selection" ng-style="barStyle"></span>\n  </span> \x3c!-- // 1 Highlight between two handles --\x3e\n  <span class="rz-pointer rz-pointer-min" ng-style=minPointerStyle></span> \x3c!-- // 2 Left slider handle --\x3e\n  <span class="rz-pointer rz-pointer-max" ng-style=maxPointerStyle></span> \x3c!-- // 3 Right slider handle --\x3e\n  <span class="rz-bubble rz-limit rz-floor"></span> \x3c!-- // 4 Floor label --\x3e\n  <span class="rz-bubble rz-limit rz-ceil"></span> \x3c!-- // 5 Ceiling label --\x3e\n  <span class="rz-bubble rz-bubble-model"></span> \x3c!-- // 6 Label above left slider handle --\x3e\n  <span class="rz-bubble no-label-injection"></span> \x3c!-- // 7 Label above right slider handle --\x3e\n  <span class="rz-bubble no-label-injection"></span> \x3c!-- // 8 Range label when the slider handles are close ex. 15 - 17 --\x3e\n  <div ng-show="showTicks" class="rz-ticks">\n    <div class="rz-tick"\n      ng-repeat="t in ticks track by $index"\n      ng-class="{\'rz-selected\': t.selected}"\n      ng-style="t.style" ng-attr-uib-tooltip="{{ t.tooltip }}"\n      ng-attr-tooltip-placement="{{t.tooltipPlacement}}"\n      ng-attr-tooltip-append-to-body="{{ t.tooltip ? true : undefined}}">\n      <div ng-if="t.value != null"\n        class="rz-tick-value"\n        ng-attr-uib-tooltip="{{ t.valueTooltip }}"\n        ng-attr-tooltip-placement="{{t.valueTooltipPlacement}}">{{ t.value }}</div>\n      <div ng-if="t.legend != null" class="rz-tick-legend" ng-bind-html="t.legend"></div>\n    </div>\n  </div>\n</div>\n'},function(t,e){t.exports='<rzslider class="tng-step-slider" rz-slider-model="$ctrl.model" rz-slider-options="$ctrl.options" rz-slider-tpl-url="TngStepSliderTemplate.html"></rzslider> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(4695)),a=o(n(4699)),s=o(n(4703)),r=o(n(4707));function o(t){return t&&t.__esModule?t:{default:t}}var c=angular.module("UncategorizedTransactionsModule",[]).component("tngRecategorizableTransactionsModal",i.default).component("tngUncategorizedTransactionsModal",a.default).component("tngUnconfirmedTransactionsModal",s.default).service("RecategorizableTransactionsService",r.default);e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4696)),a=s(n(4697));function s(t){return t&&t.__esModule?t:{default:t}}n(4698);var r={template:i.default,controller:a.default,bindings:{onClose:"&",type:"<",header:"<",subheader:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose()" class="c-recategorizable-transactions-modal" analytics-id="recategorizable-transactions"> <header> {{ $ctrl.header | translate }} <span class="c-recategorizable-transactions-modal__total-number">{{$ctrl.numberOfRecategorizableTransactions}}</span> </header> <section> <div class="grid__container"> <div class="c-recategorizable-transactions-modal__subheader-container"> <p class="body--2 margin__b--fix2" ng-if="$ctrl.subheader"> {{$ctrl.subheader | translate}} </p> </div> </div> <div class="grid__container"> <div class="c-error-message panel margin__tb--fix2" ng-if="$ctrl.APIErrorOccurred"> <span ng-bind-html="\'global.errorCodes.generic\' | translate"></span> </div> </div> <tng-transactions-list transactions="$ctrl.transactions" on-bubble-confirm="$ctrl.onConfirmCategory(category, transaction, options)" type="$ctrl.type"> </tng-transactions-list> </section> <footer> <button class="btn" type="button" ng-click="$ctrl.onClose()" actionable-id="{{$ctrl.type}}_TransactionsModal_done" translate="global.components.buttons.done"> </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.transactionConstants=e,this.RecategorizableTransactionsService=n,this.$log=a}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.APIErrorOccurred=!1,this.RecategorizableTransactionsService.getRecategorizableTransactions(this.type).then((function(e){t.transactions=e.transactions,t.numberOfRecategorizableTransactions=t.transactions.length}),(function(e){t.APIErrorOccurred=!0,t.$log.error("cannot fetch transactions",e)}))}},{key:"onConfirmCategory",value:function(){this.numberOfRecategorizableTransactions=this.numberOfRecategorizableTransactions-1}}]),t}();r.$inject=["transactionConstants","RecategorizableTransactionsService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4700)),a=s(n(4701));function s(t){return t&&t.__esModule?t:{default:t}}n(4702);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-recategorizable-transactions-modal type="$ctrl.type" on-close="$ctrl.onClose()" header="$ctrl.HEADER" subheader="$ctrl.SUBHEADER"> </tng-recategorizable-transactions-modal> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.transactionConstants=e,this.HEADER="global.uncategorizedTransactions.header",this.SUBHEADER="global.uncategorizedTransactions.subheader"}return(0,a.default)(t,[{key:"$onInit",value:function(){this.type=this.transactionConstants.TRANSACTION_VIEWS.UNCATEGORIZED_TRANSACTIONS}}]),t}();r.$inject=["transactionConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4704)),a=s(n(4705));function s(t){return t&&t.__esModule?t:{default:t}}n(4706);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-recategorizable-transactions-modal type="$ctrl.type" on-close="$ctrl.onClose()" header="$ctrl.HEADER" subheader="$ctrl.SUBHEADER"> </tng-recategorizable-transactions-modal> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.transactionConstants=e,this.HEADER="global.unconfirmedTransactions.header",this.SUBHEADER="global.unconfirmedTransactions.subheader"}return(0,a.default)(t,[{key:"$onInit",value:function(){this.type=this.transactionConstants.TRANSACTION_VIEWS.UNCONFIRMED_TRANSACTIONS}}]),t}();r.$inject=["transactionConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(92)),a=o(n(8)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,a,r){(0,s.default)(this,t),this.RequesterService=e,this.serviceConstants=n,this.transactionConstants=i,this.UNCATEGORIZED_CATEGORY_ID=a.UNCATEGORIZED_CATEGORY_ID,this.TransactionsEnhancer=r}return(0,r.default)(t,[{key:"getRecategorizableTransactions",value:function(t){var e=this;return this._getAccounts().then((function(n){return e._fetchTransactions(t).then((function(t){return(0,a.default)(t,{transactions:e.TransactionsEnhancer.extendTransactionsWithAccountDetails(t.transactions,n.accounts)})}))}))}},{key:"_getAccounts",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_SUMMARY)}},{key:"_fetchTransactions",value:function(t){return t===this.transactionConstants.TRANSACTION_VIEWS.UNCATEGORIZED_TRANSACTIONS?this.getUncategorizedTransactions():this.getUnconfirmedTransactions()}},{key:"getUncategorizedTransactions",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UNCATEGORIZED_TRANSACTIONS,this._buildParams({categoryIds:this.UNCATEGORIZED_CATEGORY_ID})).then((function(t){return(0,a.default)({},t,{transactions:t.transactions.filter((function(t){return!t.is_read}))})}))}},{key:"getUnconfirmedTransactions",value:function(){var t=this;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.UNCONFIRMED_TRANSACTIONS,this._buildParams()).then((function(e){return(0,a.default)({},e,{transactions:e.transactions.filter((function(e){return e.category_id!==t.UNCATEGORIZED_CATEGORY_ID&&!e.is_read}))})}))}},{key:"_buildParams",value:function(t){var e=moment(new Date).toISOString(),n=moment(new Date).subtract(1,"w").startOf("day").toISOString();return{urlVars:(0,i.default)({periodTo:e,periodFrom:n},t)}}}]),t}();c.$inject=["RequesterService","serviceConstants","transactionConstants","categoryConstants","TransactionsEnhancer"],e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(4709)),a=o(n(4713)),s=o(n(4714)),r=o(n(4715));function o(t){return t&&t.__esModule?t:{default:t}}var c=angular.module("tangerine.app.core.components.kba",[]).component("tngKba",i.default).service("KBAService",a.default).service("KBAFlowService",s.default).constant("kbaConstants",r.default);e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4710)),a=s(n(4711));function s(t){return t&&t.__esModule?t:{default:t}}n(4712);var r={template:i.default,controller:a.default,bindings:{kbaInfo:"<",onDecision:"&",registerFlow:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-kba c-cc-kba container"> <section class="c-cc-kba__upper-section medium-width-section" ng-if="$ctrl.currentQuestionIndex === 0"> <h1 class="heading heading--title2 c-kba__header">{{ ::\'clientOnboarding.newClientKBA.heading\' | translate }}</h1> <p class="medium margin-top-medium" translate>{{ ::\'clientOnboarding.newClientKBA.subheading\' }}</p> </section> <section class="c-cc-kba__main-section medium-width-section"> <h1 class="heading heading--title2 margin__b--fix2 c-kba__questions">{{ $ctrl.currentQuestion.question }}</h1> <span class="field__error" ng-show="$ctrl.showEmptySelectionError">{{ ::\'clientOnboarding.newClientKBA.selectionRequired\' | translate }}</span> <div class="narrow-width-section"> <div ng-repeat="option in $ctrl.currentQuestion.choices track by $index" class="btn__row top-margin-small"> <input id="kba_question_option{{$index + 1}}" name="kba_question_option" class="input input--tangerine-radio" type="radio" ng-value="option" ng-model="$ctrl.currentQuestion.chosen" ng-change="$ctrl.onSelect()"> <label for="kba_question_option{{$index + 1}}">{{ option.choice }}</label> </div> </div> </section> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s){(0,i.default)(this,t),this.$log=e,this.KBAService=n,this.flowService=a,this.KBA_ANSWER_DECISIONS=s.KBA_ANSWER_DECISIONS}return(0,a.default)(t,[{key:"$onInit",value:function(){this._productType=this.kbaInfo.productType,this._dealId=this.kbaInfo.dealId,this.flowService.activate(this.registerFlow),this.flowService.onButtonClickNext=this.onNext.bind(this),this.loadData()}},{key:"_endKBA",value:function(t,e){this.onDecision({passed:t,response:e}),this.flowService.flowIsDone()}},{key:"loadData",value:function(){var t=this;this.flowService.enterLoadingMode(),this.KBAService.getKBAQuestions(this._dealId,this._productType).then((function(e){e.kba_questions?(t.KBAresponse=e,t.flowService.BUTTONS.BTN_ORG.disable=!1,t._startQuestions(t.KBAresponse)):(t.$log.error("Unrecognized response:",e,t.kbaInfo),t._endKBA(!1,e))})).finally((function(){t.flowService.exitLoadingMode()}))}},{key:"_startQuestions",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.kbaData=t,this.questions=t.kba_questions.questions,this.answers=[],e?(this.questions[3]=this.questions[0],this.currentQuestionIndex=3,this.flowService.BUTTONS.BTN_ORG.disable=!1):this.currentQuestionIndex=0,this._onQuestionStarted()}},{key:"onNext",value:function(){this.currentQuestion&&this.currentQuestion.chosen?(this._onQuestionAnswered(),this.currentQuestionIndex===this.questions.length-1?this.updateKBAQuestions():(this.currentQuestionIndex+=1,this._onQuestionStarted())):this.showEmptySelectionError=!0}},{key:"updateKBAQuestions",value:function(){var t=this;this.flowService.enterLoadingMode(),this.flowService.BUTTONS.BTN_ORG.disable=!0,this.KBAService.updateKBAQuestions(this._dealId,this._productType,this.kbaData,this.answers).then((function(e){t.$log.debug("Update KBA Questions response:",e),e.decision===t.KBA_ANSWER_DECISIONS.PASS?t._endKBA(!0,e):e.decision===t.KBA_ANSWER_DECISIONS.FAIL?e.kba_questions.questions.length>0?(t.$log.debug("presenting fourth question:",e),t._startQuestions(e,!0)):(t.$log.debug("User failed KBA, ending KBA"),t._endKBA(!1,e)):(t.$log.error("Unrecognized decision:",e.decision),t._endKBA(!1,e))})).catch((function(e){t.$log.error("an error occurred while updating KBA questions:",e),t.flowService.BUTTONS.BTN_ORG.disable=!1})).finally((function(){t.flowService.exitLoadingMode()}))}},{key:"onSelect",value:function(){this.showEmptySelectionError=!1}},{key:"_onQuestionStarted",value:function(){this.currentQuestion.startTime=moment()}},{key:"_onQuestionAnswered",value:function(){var t=moment().diff(this.currentQuestion.startTime,"seconds");this.answers.push({questionId:this.currentQuestion.id,answer:this.currentQuestion.chosen.choice,actualTime:""+t})}},{key:"currentQuestion",get:function(){var t={};return this.questions&&(t=this.questions[this.currentQuestionIndex]),t}}]),t}();r.$inject=["$log","KBAService","KBAFlowService","kbaConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.$log=e,this.RequesterService=n,this.AVAILABLE_SERVICES=a.AVAILABLE_SERVICES,this.STATUS_CODES=a.STATUS_CODES}return(0,a.default)(t,[{key:"getKBAQuestions",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.$log.debug("getting kba questions:",t,e);var n={};return e?(n.data={product_type:e,dealid:t},this.RequesterService.request(this.AVAILABLE_SERVICES.CC_GET_KBA_QUESTIONS,n)):(n.data={},n.urlVars={id:t},this.RequesterService.request(this.AVAILABLE_SERVICES.ENROLL_GET_KBA_QUESTIONS,n))}},{key:"updateKBAQuestions",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments[2],i=arguments[3],a={data:{session_id:n.session_id,external_id:n.external_id,kba_answers:{answers:i}}};return e?(a.data.dealid=t,a.data.product_type=e,this.RequesterService.request(this.AVAILABLE_SERVICES.CC_UPDATE_KBA_QUESTIONS,a)):(a.urlVars={id:t},a.data.kba_answers.answers.forEach((function(t,e){a.data.kba_answers.answers[e]={question_id:t.questionId,answer:t.answer,actual_time:t.actualTime}})),this.RequesterService.request(this.AVAILABLE_SERVICES.ENROLL_UPDATE_KBA_QUESTIONS,a))}}]),t}();r.$inject=["$log","RequesterService","serviceConstants"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(177)),a=c(n(0)),s=c(n(2)),r=c(n(264)),o=c(n(265));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(t,n,s,o,c,l,u,d){(0,a.default)(this,e);var h=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,u,l,d));return h.BUTTON_TYPES=l.BUTTON_TYPES,h}return(0,o.default)(e,t),(0,s.default)(e,[{key:"_updateUI",value:function(){this.BUTTONS.BTN_GRY.show=!1,this.BUTTONS.BTN_ORG.disable=!0,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.NEXT}},{key:"_getAnalyticsID",value:function(){return"kba"}}]),e}(c(n(267)).default);l.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","$rootScope","AnalyticsService"],e.default=l,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={KBA_ANSWER_DECISIONS:{PASS:"PASS",FAIL:"FAIL"}},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(4717)),a=o(n(4721)),s=o(n(4725)),r=o(n(4726));function o(t){return t&&t.__esModule?t:{default:t}}var c=angular.module("tangerine.app.core.components.referFriendModals",[]).component("tngReferFriendShareKey",i.default).component("tngReferFriendReview",a.default).service("ReferFriendService",s.default).service("ShareKeyFlowService",r.default);e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4718)),a=s(n(4719));function s(t){return t&&t.__esModule?t:{default:t}}n(4720);var r={template:i.default,controller:a.default,bindings:{orangeKey:"@",userEmail:"@",onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose(result)" class="c-share-key-modal" analytics-id="referfriend/share" ng-class="{\'c-share-key-modal--start\': $ctrl.flowService.currentState === $ctrl.flowService.STATES.START}" hide-close="$ctrl.flowService.inLoadingMode"> <header> {{$ctrl.flowService.currentState.titleKey | translate}} <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.START"> <p class="orange-key">{{ ::\'referFriend.shareKey.start.orangeKeyTitle\' | translate}}</p> <p class="referral-code">{{$ctrl.orangeKey}}</p> <div class="btn__row"> <button actionable-id="share-key-twitter" class="btn--reversed" ng-click="$ctrl.shareTwitter()"> {{ ::\'global.twitter\' | translate}} </button> <tng-print-button button-class="btn--reversed"></tng-print-button> </div> </div> </header> <tng-loading-in-progress ng-if="$ctrl.flowService.inLoadingMode"></tng-loading-in-progress> <div ng-if="!$ctrl.flowService.inLoadingMode"> <div ng-if="$ctrl.submitErrors.length > 0"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error}}</li> </ul> </tng-error-message> </div> </div> <div class="dialog-content" ng-if="!$ctrl.flowService.inLoadingMode"> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.START"> <div class="c-share-key-modal--narrow print-hide"> <section> <h4 ng-bind-html="$ctrl.text"></h4> <p>{{ ::\'referFriend.shareKey.start.intro1\' | translate}}</p> <p ng-bind-html="::\'referFriend.shareKey.start.intro2\' | translate | absoluteHref"></p> </section> <section> <form name="$ctrl.shareKeyForm"> <div class="field"> <label for="shareKey_yourEmail"> {{ ::\'referFriend.shareKey.start.yourEmailLabel\' | translate}} </label> <input class="input" ng-class="{\'warning\': $ctrl.shareKeyForm.shareKey_yourEmail.$invalid && $ctrl.shareKeyForm.shareKey_yourEmail.$touched}" actionable-id="shareKey_yourEmail" type="email" ng-required="true" ng-model="$ctrl.flowService.referModel.referer_email" placeholder="{{ ::\'referFriend.shareKey.start.yourEmailPlaceholder\' | translate}}"> <div class="field__error" ng-messages="$ctrl.shareKeyForm.shareKey_yourEmail.$error" ng-if="$ctrl.shareKeyForm.shareKey_yourEmail.$touched"> <p ng-message="required"> {{ ::\'validation.isRequired\' | translate}} </p> <p ng-message="email"> {{ ::\'validation.email\' | translate}} </p> </div> </div> <div class="field"> <label for="shareKey_friendsName"> {{ ::\'referFriend.shareKey.start.friendsNameLabel\' | translate}} </label> <input class="input" ng-class="{\'warning\': $ctrl.shareKeyForm.shareKey_friendsName.$invalid && $ctrl.shareKeyForm.shareKey_friendsName.$touched}" actionable-id="shareKey_friendsName" type="text" ng-required="true" ng-pattern="$ctrl.namePattern" maxlength="32" ng-model="$ctrl.flowService.referModel.referee_name" placeholder="{{ ::\'referFriend.shareKey.start.friendsNamePlaceholder\' | translate}}"> <div class="field__error" ng-messages="$ctrl.shareKeyForm.shareKey_friendsName.$error" ng-if="$ctrl.shareKeyForm.shareKey_friendsName.$touched"> <p ng-message="required"> {{ ::\'validation.isRequired\' | translate}} </p> <p ng-message="maxlength"> {{ ::\'validation.tooLong\' | translate}} </p> <p ng-message="pattern"> {{ ::\'referFriend.validation.onlyLetters\' | translate }} </p> </div> </div> <div class="field"> <label for="shareKey_friendsEmail"> {{ ::\'referFriend.shareKey.start.friendsEmailLabel\' | translate}} </label> <input class="input" ng-class="{\'warning\': $ctrl.shareKeyForm.shareKey_friendsEmail.$invalid && $ctrl.shareKeyForm.shareKey_friendsEmail.$touched}" actionable-id="shareKey_friendsEmail" type="email" ng-required="true" ng-model="$ctrl.flowService.referModel.referee_email" placeholder="{{ ::\'referFriend.shareKey.start.friendsEmailPlaceholder\' | translate}}"> <div class="field__error" ng-messages="$ctrl.shareKeyForm.shareKey_friendsEmail.$error" ng-if="$ctrl.shareKeyForm.shareKey_friendsEmail.$touched"> <p ng-message="required"> {{ ::\'validation.isRequired\' | translate}} </p> <p ng-message="email"> {{ ::\'validation.wrongEmailFormat\' | translate}} </p> </div> </div> </form> </section> <section> <h4>{{ ::\'referFriend.shareKey.start.legalStuffTitle\' | translate}}</h4> <p ng-bind-html="::\'referFriend.shareKey.start.legalStuff1\' | translate"></p> <p>{{ ::\'referFriend.shareKey.start.legalStuff2\' | translate}}</p> <p>{{ ::\'referFriend.shareKey.start.legalStuff3\' | translate}}</p> <p>{{ ::\'referFriend.shareKey.start.legalStuff4\' | translate}}</p> </section> </div> <div id="raf_print_orange_key" class="c-share-key-modal print-only-block"> <div class="raf-card-holder"> <div class="orange-key-card"> <span>{{$ctrl.orangeKey}}</span> </div> <div class="raf-card"> <img ng-src="{{\'referFriend.shareKey.rafCard\' | translate}}"> </div> </div> <div class="raf-card-holder"> <div class="orange-key-card"> <span>{{$ctrl.orangeKey}}</span> </div> <div class="raf-card"> <img ng-src="{{\'referFriend.shareKey.rafCard\' | translate}}"> </div> </div> <div class="raf-card-holder"> <div class="orange-key-card"> <span>{{$ctrl.orangeKey}}</span> </div> <div class="raf-card"> <img ng-src="{{\'referFriend.shareKey.rafCard\' | translate}}"> </div> </div> <div class="raf-card-holder"> <div class="orange-key-card"> <span>{{$ctrl.orangeKey}}</span> </div> <div class="raf-card"> <img ng-src="{{\'referFriend.shareKey.rafCard\' | translate}}"> </div> </div> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.CONFIRM"> <p ng-bind-html="\'referFriend.shareKey.confirm.success\' | translate:{email: $ctrl.flowService.referModel.referee_email}"></p> </div> </div> <footer> <tng-page-flow-controls flow-service="$ctrl.flowService"></tng-page-flow-controls> </footer> </tng-modal-dialog> <tng-facebook></tng-facebook> <tng-twitter></tng-twitter> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=n(67);function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,r,o,c,l,u,d,h,f,p){(0,i.default)(this,t),this.$log=e,this.$scope=n,this.$translate=a,this.$httpParamSerializer=r,this.$window=h,this.STATUS_CODES=o.STATUS_CODES,this.flowService=c,this.ReferFriendService=l,this.FacebookService=u,this.UserService=f,this.referFriendConstants=d,this.isNative=p.isNative(),this.submitErrors=[],this.shareKeyForm={},this.clearWatcher=null,this.nameValidation=s.nameValidation,this.namePattern=s.namePattern}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.userEmail&&this.orangeKey?this._setupModal():this.UserService.getUserInfo().then((function(e){t.userEmail=e.customer.email,t.orangeKey=e.customer.orange_key,t._setupModal()})).catch((function(e){t.$log.error("Error getting customer info",e)}))}},{key:"$onDestroy",value:function(){this.clearWatcher()}},{key:"onModalClose",value:function(){this._close()}},{key:"_setupModal",value:function(){var t=this;this.flowService.activate(),this.flowService.referModel.referer_email=this.userEmail,this.flowService.onButtonClickEmail=function(){t._submitData()},this.flowService.onButtonClickCancel=function(){t._close()},this.flowService.onButtonClickDone=function(){t._close()},this._watchFormIsValid(),this._setTwitterShareUrl(),this._getContent()}},{key:"shareFacebook",value:function(){var t=this,e={method:"feed",name:this.$translate.instant("referFriend.shareKey.facebook.shareDialog.name",{orangeKey:this.orangeKey}),link:this.$translate.instant("referFriend.shareKey.facebook.shareDialog.link"),picture:this.referFriendConstants.SHARE_KEY.FACEBOOK.PICTURE,caption:this.referFriendConstants.SHARE_KEY.FACEBOOK.CAPTION,description:this.$translate.instant("referFriend.shareKey.facebook.shareDialog.description")};try{this.FacebookService.ui(e,(function(e){e&&e.post_id?t.$log.debug("Post was published."):t.$log.debug("Post was not published.")}))}catch(t){this.$log.error("ShareKeyController => shareFacebook error:",t)}}},{key:"shareTwitter",value:function(){var t="https://twitter.com/intent/tweet?"+this.twitterShareUrl;this.isNative?this.$window.open(t,"_system"):this.$window.location=t}},{key:"_setTwitterShareUrl",value:function(){var t={text:this.$translate.instant("referFriend.shareKey.twitter.shareDialog.text",{orangeKey:this.orangeKey}),link:this.$translate.instant("referFriend.shareKey.twitter.shareDialog.link"),via:this.$translate.instant("referFriend.shareKey.twitter.shareDialog.via"),related:this.$translate.instant("referFriend.shareKey.twitter.shareDialog.via"),hashtags:this.$translate.instant("referFriend.shareKey.twitter.shareDialog.hashtags")};this.twitterShareUrl=this.$httpParamSerializer(t)}},{key:"_close",value:function(){this.onClose()}},{key:"_watchFormIsValid",value:function(){var t=this,e=this.flowService,n=this.$scope;this.clearWatcher=n.$watchCollection((function(){return e.referModel}),(function(){e.enableNextState(t.shareKeyForm.$valid)}))}},{key:"_submitData",value:function(){var t=this;this.submitErrors=[],this.flowService.disableButtons(),this.flowService.enterLoadingMode(),this.ReferFriendService.referFriend(this.flowService.referModel).then((function(e){e.response_status&&e.response_status.status_code===t.STATUS_CODES.SUCCESS?(t.flowService.exitLoadingMode(),t.flowService.gotoNextState()):t._handleErrors(e)})).catch((function(e){t._handleErrors(e)}))}},{key:"_handleErrors",value:function(t){var e=this;t.response_status&&t.response_status.details?t.response_status.details.forEach((function(t){t.details_code&&"INVALID"===t.details_code&&t.field_name&&("referee_email"===t.field_name||"referer_email"===t.field_name)&&e.submitErrors.push(e.$translate.instant("global.errorCodes.1443"))})):"status_code"in t.response_status&&"return_code"in t.response_status&&-1===["CREATED","SUCCESS"].indexOf(t.response_status.status_code)&&("EMAIL_SENT"===t.response_status.return_code?this.submitErrors.push(this.$translate.instant("global.errorCodes.EMAIL_SENT",{email:this.flowService.referModel.referee_email})):this.submitErrors.push(t.response_status.technical_description)),this.flowService.enableButtons(),this.flowService.exitLoadingMode()}},{key:"_getContent",value:function(){var t=this,e=this.$translate.instant("referFriend.shareKey.start.messageTemplate");this.ReferFriendService.getContent(e).then((function(e){t.text=e}))}},{key:"print",value:function(){this.$window.print()}}]),t}();o.$inject=["$log","$scope","$translate","$httpParamSerializer","serviceConstants","ShareKeyFlowService","ReferFriendService","FacebookService","referFriendConstants","$window","UserService","EnvironmentService"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4722)),a=s(n(4723));function s(t){return t&&t.__esModule?t:{default:t}}n(4724);var r={template:i.default,controller:a.default,bindings:{orangeKey:"@",onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose(result)" analytics-id="referfriend/review" class="c-review-modal"> <header> {{ ::\'referFriend.review.header\' | translate }} </header> <div class="dialog-content"> <div class="c-review-modal__balance-grid c-balance-grid"> <div class="c-balance-grid__table"> <div class="c-balance-grid__table__table-column-top has-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> {{ ::\'referFriend.review.referredTitle\' | translate}} </p> <p class="c-balance-grid__value"> {{ $ctrl.referInfo.summary.friends_referred || 0}} </p> </div> </div> <div class="c-balance-grid__table__table-column-top has-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> {{ ::\'referFriend.review.earnedTitle\' | translate}} </p> <p class="c-balance-grid__value"> {{ $ctrl.referInfo.summary.total_earned || 0 | currency }} </p> </div> </div> </div> </div> <div class="c-review-modal--narrow"> <section> <p tng-bind-html="$ctrl.text"></p> </section> <section> <h4>{{ :: \'referFriend.review.legalStuffTitle\' | translate}}</h4> <p ng-bind-html="::\'referFriend.review.legalStuff1\' | translate"></p> <p>{{ :: \'referFriend.review.legalStuff2\' | translate}}</p> <p>{{ :: \'referFriend.review.legalStuff3\' | translate}}</p> <p>{{ :: \'referFriend.review.legalStuff4\' | translate}}</p> </section> </div> </div> <footer> <button class="btn btn--orange" actionable-id="review_closeModal" ng-click="$ctrl.onModalClose()"> {{::\'global.components.buttons.done\' | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s){(0,i.default)(this,t),this.$log=e,this.ReferFriendService=n,this.$translate=a,this.UrlService=s}return(0,a.default)(t,[{key:"$onInit",value:function(){this._getReferInfo(),this._getContent()}},{key:"_getReferInfo",value:function(){var t=this;this.ReferFriendService.getInfo().then((function(e){t.referInfo=e})).catch((function(e){t.$log.error("ReviewController => _getReferInfo error:",e)}))}},{key:"_getContent",value:function(){var t=this,e=this.$translate.instant("referFriend.review.messageTemplate");this.ReferFriendService.getContent(e).then((function(e){t.text=t.UrlService.fixTrustHtmlRelativeLinks(e)}))}},{key:"onModalClose",value:function(){this.onClose()}}]),t}();r.$inject=["$log","ReferFriendService","$translate","UrlService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c){(0,i.default)(this,t),this.$log=e,this.$http=s,this.$sce=r,this.RequesterService=n,this.LocaleService=o,this.serviceConstants=a,this.EnvironmentService=c,this.isMobileNative=c.isNative(),this.staticSiteUrl=c.getBaseUrl(),this.insightsConfig=c.get("insights")}return(0,a.default)(t,[{key:"getInfo",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_REFER_FRIEND_INFO)}},{key:"referFriend",value:function(t){var e={data:{referer_email:t.referer_email,referee_name:t.referee_name,referee_email:t.referee_email}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.REFER_FRIEND,e)}},{key:"getContent",value:function(t){var e=this,n=this.insightsConfig.staticBaseUrl+"/"+t;return this.$http({method:"GET",url:n}).then((function(t){var n="";if(e.isMobileNative){var i=e.staticSiteUrl+"/";n=t.data.replace("<!doctype html>","").trim().replace(/href="\//g,'href="'+("/"===e.staticSiteUrl.slice(-1)?e.staticSiteUrl:i)).replace(/href='\//g,"href='"+("/"===e.staticSiteUrl.slice(-1)?e.staticSiteUrl:i))}else n=t.data.replace("<!doctype html>","").trim();return e.$sce.trustAsHtml(n)}))}}]),t}();r.$inject=["$log","RequesterService","serviceConstants","$http","$sce","LocaleService","EnvironmentService"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(177)),a=d(n(0)),s=d(n(2)),r=d(n(264)),o=d(n(266)),c=d(n(265)),l=d(n(267)),u=n(364);function d(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(t,n,s,o,c,l,u,d){(0,a.default)(this,e);var h=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,l,u,d));return h.STATES={START:{titleKey:"referFriend.shareKey.start.header"},CONFIRM:{titleKey:"referFriend.shareKey.confirm.header"}},h.referModel={referer_email:null,referee_name:null,referee_email:null},h}return(0,c.default)(e,t),(0,s.default)(e,[{key:"_resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.currentState=this.STATES.START,this.BUTTONS={BTN_GRY:new u.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new u.ModalFooterButton(this.BUTTON_TYPES.EMAIL,!0,!0)},this.referModel={referee_name:null,referee_email:null}}},{key:"_updateUI",value:function(){switch(this.currentState){case this.STATES.START:this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.CANCEL,this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_ORG.show=!0;break;case this.STATES.CONFIRM:this.enableButtons(),this.hideWarning(),this.BUTTONS.BTN_GRY.show=!1,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.DONE,this.BUTTONS.BTN_ORG.disable=!1}}},{key:"gotoNextState",value:function(){switch(this.currentState){case this.STATES.START:this.moveTo(this.STATES.CONFIRM)}}},{key:"disableButtons",value:function(){this.BUTTONS.BTN_ORG.disable=!0,this.BUTTONS.BTN_GRY.disable=!0}},{key:"enableButtons",value:function(){this.BUTTONS.BTN_ORG.disable=!1,this.BUTTONS.BTN_GRY.disable=!1}},{key:"enableNextState",value:function(t){this.BUTTONS.BTN_ORG.disable=!t}},{key:"onButtonClick",value:function(t){switch(t.type){case this.BUTTON_TYPES.EMAIL:this.onButtonClickEmail();break;default:(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"onButtonClick",this).call(this,t)}}},{key:"_getAnalyticsID",value:function(){return"sharekey"}}]),e}(l.default);h.$inject=["$log","$q","$transitions","$state","$window","$rootScope","pageFlowConstants","AnalyticsService"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4728)),a=s(n(4731));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("tangerine.app.core.components.facebook",[]).component("tngFacebook",i.default).service("FacebookService",a.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(4729));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(4730)).default,controller:i.default};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.$log=e,this.FacebookService=n}return(0,a.default)(t,[{key:"$onInit",value:function(){this.$log.debug("Facebook component initialize ..."),this.FacebookService.init()}}]),t}();r.$inject=["$log","FacebookService"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div id="fb-root"></div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r={PARAMS:{status:!0,cookie:!0,xfbml:!1,version:"v2.4"},SDK:"//connect.facebook.net/en_US/sdk.js"},o=function(){function t(e,n,a){(0,i.default)(this,t),this.$log=e,this.$window=n,this.EnvironmentService=a}return(0,a.default)(t,[{key:"init",value:function(){this._setFacebookAppId(),this._loadAsyncFB(),this._loadSdk()}},{key:"_setFacebookAppId",value:function(){r.PARAMS.appId=this.EnvironmentService.get("facebookAppId")}},{key:"_loadSdk",value:function(){this.$log.debug("Facebook loading sdk ...");var t="facebook-jssdk",e=document.getElementsByTagName("script")[0];if(!document.getElementById(t)){var n=document.createElement("script");n.id=t,n.async=!0,n.src=r.SDK,e.parentNode.insertBefore(n,e),this.$log.debug("Facebook loaded sdk ...")}}},{key:"_loadAsyncFB",value:function(){var t=this,e=this.$window;this.$log.debug("Facebook async loading ..."),e.fbAsyncInit=function(){FB.init(r.PARAMS),t.$log.debug("Facebook async loaded ...",FB)}}},{key:"ui",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];if(angular.isUndefined(FB))throw new Error("FB not initilized !!!");FB.ui(t,(function(t){angular.isFunction(e)&&e(t)}))}}]),t}();o.$inject=["$log","$window","EnvironmentService"],e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4733)),a=s(n(4735));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("tangerine.app.core.components.twitter",[]).component("tngTwitter",i.default).service("TwitterService",a.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4734);var s={controller:((i=a)&&i.__esModule?i:{default:i}).default};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.$log=e,this.TwitterService=n}return(0,a.default)(t,[{key:"$onInit",value:function(){this.$log.debug("TwitterController component initialize ..."),this.TwitterService.init()}}]),t}();r.$inject=["$log","TwitterService"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r="https://platform.twitter.com/widgets.js",o=function(){function t(e,n){(0,i.default)(this,t),this.$log=e,this.$window=n}return(0,a.default)(t,[{key:"init",value:function(){this._loadScripts()}},{key:"_loadScripts",value:function(){var t=this;this.$log.debug("Twitter loading scripts ...");var e=this.$window;e.twttr=function(){var n="twitter-wjs",i=document.getElementsByTagName("script")[0],a=e.twttr||{};if(document.getElementById(n))return a;var s=document.createElement("script");return s.id=n,s.async=!0,s.src=r,i.parentNode.insertBefore(s,i),t.$log.debug("Twitter loaded scripts"),a.e=[],a.ready=function(t){a.e.push(t)},a}()}}]),t}();o.$inject=["$log","$window"],e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4737),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("CifSwitcherModule",[]).component("tngCifSwitcher",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4738)),a=s(n(4739));function s(t){return t&&t.__esModule?t:{default:t}}n(4740);var r={template:i.default,controller:a.default,bindings:{currentPage:"<",onCifSwitch:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-cif-switcher"> <tng-error-message ng-if="$ctrl.requestMonitor.errors.length >= 1"> <ul> <li ng-repeat="error in $ctrl.requestMonitor.errors track by $index">{{ error | translate }}</li> </ul> </tng-error-message> <div class="c-cif-switcher__header" ng-if="$ctrl.requestMonitor.errors.length < 1"> <h1 class="heading--title c-cif-switcher__header__title--desktop{{$ctrl.displayMobileModifier()}}"> {{ \'userSettings.header.profileAndSettings\' | translate }} </h1> <h1 class="c-cif-switcher__header__title--mobile"> {{ $ctrl.currentPage.LABEL | translate }} </h1> <div ng-if="$ctrl.cifTypeService.isParent()" class="c-cif-switcher__select" id="cif-switcher-select"> <tng-select-autocomplete ng-model="$ctrl.cifTypeService.cifModel" on-select="$ctrl.handleCifSelect(option)" ng-click="$ctrl.onManualSwitch()" options="$ctrl.cifTypeService.parentCifOptions" option-label-key="name" option-right-label-key="cif" option-value-key="cif" placeholder="{{ \'userSettings.header.cifSelectPlaceholder\' | translate }}" select-type="$ctrl.selectConstants.SELECT_TYPES.STATIC"> </tng-select-autocomplete> </div> <div ng-if="!$ctrl.cifTypeService.isParent()"> <div class="c-cif-switcher__header__number"> <b>{{$ctrl.customerInfo.first_name}} {{$ctrl.customerInfo.last_name}}</b> {{$ctrl.customerInfo.client_number}} </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(68)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s,r,o,c,l){(0,a.default)(this,t),this.$log=e,this.$q=n,this.settingsConstants=i,this.selectConstants=s,this.customersService=r,this.cifTypeService=o,this.ErrorService=c,this.errorConstants=l,this.requestMonitor=[],this.customerInfo={}}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;this._resetRequestMonitor(),this.$q.all({customerInfo:this._getCustomerInfo(),capabilities:this._getCapabilities()}).then((function(e){if(t.$log.debug("User Settings: GET Customers Info/Capabilities",e),t.customerInfo=e.customerInfo,t.capabilities=e.capabilities,t.cifTypeService.findCurrentCifType(t.customerInfo,t.capabilities),t.cifTypeService.isParent()){t.cifTypeService.parentCifOptions=[];var n=t.cifTypeService.createCifModel({isParent:!0,name:t.customerInfo.first_name+" "+t.customerInfo.last_name,cif:t.customerInfo.client_number,customerInfo:t.customerInfo});t.cifTypeService.cifModel||(t.cifTypeService.cifModel=n.cif),t.cifTypeService.parentCifOptions.push(n),t.onCifPopulationEvent(n),t.customerInfo.dependent_info.forEach((function(e){t.customersService.getCustomerDependent(e.client_id).then((function(n){t.$log.debug("User Settings, DependentInfo: ",n);var a=t.cifTypeService.createCifModel({isParent:!1,name:e.first_name+" "+e.last_name,cif:e.client_number,accountNumber:e.account_number,customerInfo:n});t.cifTypeService.parentCifOptions=[].concat((0,i.default)(t.cifTypeService.parentCifOptions),[a]),t.onCifPopulationEvent(a)})).catch((function(e){t.$log.error(e),t._requestError(e)}))}))}}))}},{key:"onCifPopulationEvent",value:function(t){t&&t.cif===this.cifTypeService.cifModel&&(this.cifTypeService.selectedCif=t)}},{key:"handleCifSelect",value:function(t){var e=this;this.isSwitching=!0,t&&this.cifTypeService.selectedCif.cif!==t.cif&&this.cifTypeService.switchSelectedCif(t),setTimeout((function(){e.isSwitching=!1}))}},{key:"onManualSwitch",value:function(){this.isSwitching&&this.onCifSwitch()}},{key:"_getCustomerInfo",value:function(){var t=this;return this.customersService.getCustomerInfo({include_servicing_systems:!0}).then((function(e){return t.$log.debug("Cif Switcher: GET Customers Info response: ",e),e.customer})).catch((function(e){t.$log.error(e),t._requestError(e)}))}},{key:"_getCapabilities",value:function(){var t=this;return this.customersService.getCapabilities().then((function(t){return t.capabilities})).catch((function(e){t.$log.error(e),t._requestError(e)}))}},{key:"_displayMobileHeader",value:function(){return!(this.currentPage&&this.currentPage.LABEL)}},{key:"displayMobileModifier",value:function(){return this._displayMobileHeader()?"--mobile":""}},{key:"_resetRequestMonitor",value:function(){this.requestMonitor={errors:[]}}},{key:"_requestError",value:function(t){var e=this;return this.ErrorService.processError(t,this.errorConstants.AVAILABLE_EVENTS.REQUEST_ERROR).then((function(){0===e.requestMonitor.errors.length&&e.requestMonitor.errors.push("global.errorCodes.GENERIC_ERROR")}))}}]),t}();o.$inject=["$log","$q","UserSettingsConstants","tngSelectAutocompleteConstants","CustomersService","CifTypeService","ErrorService","errorConstants"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(4742)),a=u(n(4743)),s=u(n(4746)),r=u(n(4749)),o=u(n(4753)),c=u(n(4756)),l=u(n(4759));function u(t){return t&&t.__esModule?t:{default:t}}var d=angular.module("tangerine.app.core.components.fundingDepositMoney",[]).service("DepositMoneyFlowService",i.default).component("tngFundAccount",r.default).component("tngNumberedList",o.default).component("tngEmailMoney",a.default).component("tngPhotoChequeDeposit",s.default).component("tngMobileAppStores",c.default).component("tngConfirmExitModal",l.default);e.default=d,d.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=f(n(92)),a=f(n(177)),s=f(n(0)),r=f(n(2)),o=f(n(264)),c=f(n(266)),l=f(n(265)),u=n(267),d=f(u),h=n(2024);function f(t){return t&&t.__esModule?t:{default:t}}var p=function(t){function e(t,n,i,r,c,l,u,d,h){(0,s.default)(this,e);var f=(0,o.default)(this,(e.__proto__||(0,a.default)(e)).call(this,t,n,i,r,c,l,u,h));return f.$log=t,f.BUTTON_TYPES=u.BUTTON_TYPES,f.isNative=d.isNative(),f}return(0,l.default)(e,t),(0,r.default)(e,[{key:"gotoNextState",value:function(){switch(this.currentState){case h.STATES.FUND_ACCOUNT:this.transaction.fundAccount&&this.transaction.fundAccount.nextState&&this.moveTo(this.transaction.fundAccount.nextState);break;case h.STATES.EMAIL_MONEY:case h.STATES.PHOTO_CHEQUE_DEPOSIT:this.moveTo(h.STATES.FUND_ACCOUNT)}}},{key:"returnToStart",value:function(){this._resetState()}},{key:"_resetState",value:function(){(0,c.default)(e.prototype.__proto__||(0,a.default)(e.prototype),"_resetState",this).call(this),this.currentState=h.STATES.FUND_ACCOUNT,this.transaction={fundAccount:{}},this.BUTTONS={BTN_GRY:new u.PageFlowButton(this.BUTTON_TYPES.BACK,!0,!0)}}},{key:"_updateUI",value:function(){this.BUTTONS={BTN_GRY:new u.PageFlowButton(this.BUTTON_TYPES.BACK,!0,!0),BTN_ORG:new u.PageFlowButton(this.BUTTON_TYPES.CANCEL,!1,!0)}}},{key:"_subFlowIsDone",value:function(t){this.transaction=(0,i.default)({},t),(0,c.default)(e.prototype.__proto__||(0,a.default)(e.prototype),"_subFlowIsDone",this).call(this,this.transaction)}},{key:"postMoveTo",value:function(){this.currentState===h.STATES.MOVE_MONEY?this.hideWarning():this.showWarning()}},{key:"_getAnalyticsID",value:function(){return"fundaccount"}}]),e}(d.default);p.$inject=["$log","$q","$transitions","$state","$window","$rootScope","pageFlowConstants","EnvironmentService","AnalyticsService"],e.default=p,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4744),s=(i=a)&&i.__esModule?i:{default:i};n(4745);var r={template:s.default,bindings:{onClose:"&",onBack:"&",onDone:"&",processList:"<",lang:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose()"> <header> <h5 class="large"> {{ ::\'depositMoney.modal.emailMoney.title\' | translate }} </h5> </header> <div class="email-money-content"> <p class="email-money-content__subtitle" translate="depositMoney.modal.emailMoney.subTitle"> </p> <p> <img ng-src="{{::\'assets/images/logo_interac_\' + $ctrl.lang  + \'.png\'}}" class="email-money-content__interac-logo" alt="Interac"> </p> <tng-numbered-list list="$ctrl.processList"></tng-numbered-list> </div> <footer> <button actionable-id="email-money-btn_back" class="btn btn--large btn--edit" ng-click="$ctrl.onBack()">{{ \'depositMoney.modal.fundAccount.back\' | translate }} </button> <button actionable-id="email-money-btn_done" class="btn btn--large btn--orange" ng-click="$ctrl.onDone()">{{ ::\'global.components.buttons.done\' | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4747),s=(i=a)&&i.__esModule?i:{default:i};n(4748);var r={template:s.default,bindings:{onClose:"&",onBack:"&",onDone:"&",processList:"<",lang:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose()"> <header> <h5 class="large"> {{ ::\'depositMoney.modal.photoChequeDeposit.title\' | translate }} </h5> </header> <div class="cheque-deposit-content"> <p class="cheque-deposit-content__subtitle" translate="depositMoney.modal.photoChequeDeposit.subTitle"> </p> <tng-numbered-list list="$ctrl.processList"></tng-numbered-list> </div> <footer> <button actionable-id="photo-cheque-deposit-btn-edit" class="btn btn--large btn--edit" ng-click="$ctrl.onBack()">{{ ::\'depositMoney.modal.photoChequeDeposit.buttons.back\' | translate }} </button> <button actionable-id="photo-cheque-deposit-btn-done" class="btn btn--large btn--orange" ng-click="$ctrl.onDone()">{{ ::\'global.components.buttons.done\' | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4750)),a=s(n(4751));function s(t){return t&&t.__esModule?t:{default:t}}n(4752);var r={controller:a.default,template:i.default,bindings:{account:"<?",transaction:"<",registerFlow:"&",onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog ng-if="$ctrl.currentState === $ctrl.STATES.FUND_ACCOUNT" on-close="$ctrl.onCloseFundAccountModal()" hide-close="$ctrl.isHideClose"> <header> <h5 class="large"> {{ \'depositMoney.modal.fundAccount.title\' | translate }} </h5> </header> <div class="fund-account-content"> <p ng-if="!!$ctrl.account" class="fund-account-content__subtitle" translate="depositMoney.modal.fundAccount.subTitle" translate-values="{ accountName: $ctrl.accountName }"> </p> <p ng-if="!$ctrl.account" class="fund-account-content__subtitle" translate="depositMoney.modal.fundAccount.subTitleNoAccount"> </p> <tng-tile-list class="fund-account-content__tile-list" tile-data="$ctrl.tiles" tile-type="$ctrl.TILE_TYPE.text" is-actionable="!$ctrl.isDisabled(tile, tileData)" is-disabled="$ctrl.isDisabled(tile, tileData)" on-tile-click="$ctrl.onTileClick(index, tileData)"> </tng-tile-list> </div> <footer> <button actionable-id="fund-account-btn-edit" class="btn btn--large btn--edit" ng-click="$ctrl.onBack()"> {{ \'depositMoney.modal.fundAccount.back\' | translate }} </button> </footer> </tng-modal-dialog> <tng-email-money ng-if="$ctrl.currentState === $ctrl.STATES.EMAIL_MONEY" on-close="$ctrl.onCloseEmailMoney()" on-back="$ctrl.gotoPreviousState()" on-done="$ctrl.onDoneEmailMoney()" process-list="$ctrl.processListEmailMoney" lang="$ctrl.shortHandLocale"></tng-email-money> <tng-photo-cheque-deposit ng-if="$ctrl.currentState === $ctrl.STATES.PHOTO_CHEQUE_DEPOSIT" on-close="$ctrl.onClosePhotoChequeDeposit()" on-back="$ctrl.gotoPreviousState()" on-done="$ctrl.onDonePhotoChequeDeposit()" process-list="$ctrl.processListPhotoDeposit" lang="$ctrl.shortHandLocale"></tng-photo-cheque-deposit> <tng-remote-deposit-capture ng-if="$ctrl.currentState === $ctrl.STATES.PHOTO_CHEQUE_DEPOSIT_NATIVE" on-close="$ctrl.onClosePhotoChequeDepositNative(result)" account="$ctrl.account" register-flow="$ctrl.setSubFlow(subFlow)"></tng-remote-deposit-capture> <tng-move-money ng-if="$ctrl.currentState === $ctrl.STATES.MOVE_MONEY" on-close="$ctrl.onCloseMoveMoney(result)" register-flow="$ctrl.setSubFlow(subFlow)"></tng-move-money> <tng-confirm-exit-modal ng-if="$ctrl.isConfirmExit" on-close="$ctrl.denyExit()" on-cancel="$ctrl.denyExit()" on-confirm="$ctrl.allowExit()"></tng-confirm-exit-modal> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(270)),a=o(n(92)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,a,r,o,c,l,u,d,h){(0,s.default)(this,t),this.$q=e,this.$log=n,this.TILE_TYPE=i.TILE_TYPE,this.BUTTON_TYPES=r.BUTTON_TYPES,this.flowService=a,this.shortHandLocale=o.localeDisplay.toLowerCase(),this.isNative=a.isNative,this.UserService=c,this.menuConstants=l,this.MoveMoneyAccountsService=u,this.moveMoneyConstants=d,this.STATES=h.STATES,this.fundAccountTiles=h.FUND_ACCOUNT_TILES,this.processListEmailMoney=h.PROCESS_LIST_EMAIL_MONEY,this.processListPhotoDeposit=h.PROCESS_LIST_PHOTO_DEPOSIT}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;this.flowService.activate(),this.flowService.transaction=(0,a.default)({},this.transaction,this.flowService.transaction),this.tiles=[this.fundAccountTiles.EMAIL_MONEY,this.fundAccountTiles.PHOTO_CHEQUE_DEPOSIT],this.account&&"3010"===this.account.profile_product_type&&(this.tiles=[this.fundAccountTiles.EMAIL_MONEY]),this.processListEmailMoney=this._copyProcessList(this.processListEmailMoney),this.processListPhotoDeposit=this._copyProcessList(this.processListPhotoDeposit),this.$q.all([this.UserService.getCapabilities(),this.MoveMoneyAccountsService.canMoveMoney()]).then((function(e){(t.$log.debug("User capabilities and move money accounts for Fund Your Account Modal returned",e),e[0].capabilities&&-1!==e[0].capabilities.indexOf(t.menuConstants.CAPABILITIES.DEPOSIT_TRANSACT))&&(e[1]&&t.tiles.push(t.fundAccountTiles.MOVE_MONEY))})).catch((function(e){t.$log.debug("CALL FAILED to User capabilities for Fund Your Account Modal returned",e)}))}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"onCloseFundAccountModal",value:function(){this._close()}},{key:"onBack",value:function(){angular.isFunction(this.onClose)&&this.onClose()}},{key:"onTileClick",value:function(t,e){this.flowService.transaction.fundAccount.nextState=this.isNative&&e.state===this.STATES.PHOTO_CHEQUE_DEPOSIT?this.STATES.PHOTO_CHEQUE_DEPOSIT_NATIVE:e.state,this.flowService.gotoNextState()}},{key:"onCloseEmailMoney",value:function(){this._close()}},{key:"onDoneEmailMoney",value:function(){this.gotoPreviousState()}},{key:"onClosePhotoChequeDeposit",value:function(){this._close()}},{key:"onClosePhotoChequeDepositNative",value:function(){this._close()}},{key:"onDonePhotoChequeDeposit",value:function(){this.gotoPreviousState()}},{key:"onCloseMoveMoney",value:function(){this._close()}},{key:"gotoPreviousState",value:function(){return this.flowService.gotoPreviousState()}},{key:"setSubFlow",value:function(t){return this.flowService.setSubFlow(t)}},{key:"allowExit",value:function(){return this.flowService.allowExit()}},{key:"denyExit",value:function(){return this.flowService.denyExit()}},{key:"_close",value:function(){angular.isFunction(this.onClose)&&this.onClose()}},{key:"_copyProcessList",value:function(t){var e={};return(0,i.default)(t).forEach((function(t){t[0]&&t[1].LABEL&&(e[t[0]]=t[1])})),e}},{key:"accountName",get:function(){return this.account.description||this.account.product_description}},{key:"currentState",get:function(){return this.flowService.currentState}},{key:"isHideClose",get:function(){return this.flowService.inLoadingMode}},{key:"isConfirmExit",get:function(){return this.flowService.showConfirmExitUI}}]),t}();c.$inject=["$q","$log","tngTileListConstants","DepositMoneyFlowService","pageFlowConstants","LocaleService","UserService","menuConstants","MoveMoneyAccountsService","moveMoneyConstants","depositMoneyConstants"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4754),s=(i=a)&&i.__esModule?i:{default:i};n(4755);var r={template:s.default,bindings:{list:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<ul class="numbered-list"> <li ng-repeat="(key, value) in $ctrl.list track by $index" ng-if="key && value && value.LABEL" class="numbered-list__item" translate-cloak> <span class="numbered-list__index">{{$index + 1}}</span> <span class="numbered-list__label" translate="{{value.LABEL}}"></span> </li> </ul> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4757),s=(i=a)&&i.__esModule?i:{default:i};n(4758);var r={template:s.default,bindings:{lang:"@"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<p class="stores-hrefs__imgs"> <a actionable-id="mobile-app-store-apple_link" ng-href="{{\'depositMoney.modal.photoChequeDeposit.appleAppLink\' | translate}}" target="_blank"> <img ng-src="assets/images/download_on_the_app_store_{{$ctrl.lang}}.svg" class="stores-hrefs__imgs--apple-badge" alt="Apple App Store"> </a> <a actionable-id="mobile-app-store-android_link" ng-href="https://play.google.com/store/apps/details?id=ca.tangerine.clients.banking.app&hl={{$ctrl.lang}}" target="_blank"> <img ng-src="assets/images/google_play_badge_{{$ctrl.lang}}.png" class="stores-hrefs__imgs--google-badge" alt="Google Play"> </a> </p> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4760),s=(i=a)&&i.__esModule?i:{default:i};n(4761);var r={template:s.default,bindings:{onClose:"&",onCancel:"&",onConfirm:"&",titleKey:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose()"> <header> <span>{{ ::($ctrl.titleKey || \'global.warning.title\') | translate }}</span> </header> <tng-confirm-exit></tng-confirm-exit> <footer> <button actionable-id="confirm-exit-global-modal-cancel" class="btn btn--edit" ng-click="$ctrl.onCancel()"> {{ ::\'global.pageFlow.buttons.cancel\' | translate }} </button> <button actionable-id="confirm-exit-global-modal-confirm" class="btn btn--tangerine" ng-click="$ctrl.onConfirm()"> {{ ::\'global.pageFlow.buttons.confirm\' | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(4763)),a=r(n(4764)),s=r(n(4768));function r(t){return t&&t.__esModule?t:{default:t}}var o=angular.module("tangerine.app.core.components.promoRateOffer",[]).service("PromoRateOfferService",i.default).component("tngPromoRateOffer",a.default).constant("promoRateOfferConstants",s.default);e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l){(0,i.default)(this,t),this.$q=e,this.RequesterService=n,this.serviceConstants=a,this.transactionConstants=s,this.accountConstants=r,this.$httpParamSerializer=c,this.validOffers=[],this.accountDetails=null,this.offerTypes=o.OFFER_TYPES,this.offerStatus=o.OFFER_STATUS,this.rateStatus=o.RATE_STATUS,this.productTypePrefix=o.PRODUCT_TYPE_PREFIX,this.$http=l}return(0,a.default)(t,[{key:"getPromoRateOfferData",value:function(t,e){return t&&(this.accountDetails=t.account_summary),this._getOffersFromService(e)}},{key:"_getOffersFromService",value:function(t){var e=this;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.CUSTOMER_OFFERS,{headers:{},urlVars:{queryString:this.$httpParamSerializer({"fetch-all":!0})}}).then((function(n){if(n.offers&&n.offers.length>0)return e.validOffers=n.offers,e._getPromoRateOfferData(n.offers,t)}))}},{key:"_getPromoRateOfferData",value:function(t,e){var n=this._getValidOffer(t);if(n)return this.flatAndMapMatchingOffer(n,e)}},{key:"_getValidOffer",value:function(t){var e=this,n=!1;return t.forEach((function(t){t.offer_type!==e.offerTypes.TRGOFF&&t.offer_type!==e.offerTypes.RTNOFF||t.offer_status!==e.offerStatus.ACTIV||(n=t)})),n}},{key:"validateRateFromMarketing",value:function(t){return this.$http({method:"GET",url:t})}},{key:"flatAndMapMatchingOffer",value:function(t,e){var n=this,i=this._getOfferFlatModel();return t.rate_offer_details.rates.forEach((function(a){var s="";switch(a.profile_product_type){case n.accountConstants.ACCOUNT_PPTS.SAVINGS:s=n.productTypePrefix.TSA;break;case n.accountConstants.ACCOUNT_PPTS.RSP:s=n.productTypePrefix.RSP;break;case n.accountConstants.ACCOUNT_PPTS.TFSA:s=n.productTypePrefix.TFSA;break;case n.accountConstants.ACCOUNT_PPTS.BUSINESS_SAVINGS:s=n.productTypePrefix.BISA;break;case n.accountConstants.ACCOUNT_PPTS.TGSA:s=n.productTypePrefix.TGSA;break;case n.accountConstants.ACCOUNT_PPTS.USDSAVINGS:s=n.productTypePrefix.USDTSA;break;case n.accountConstants.ACCOUNT_PPTS.RIF_ISA:s=n.productTypePrefix.RIF;break;default:s=n.productTypePrefix.NA}1===a.tier_sequence?(i[s+"PromoRate"]=a.max_interest_rate,i[s+"InterestSpread"]=a.interest_rate,i[s+"MaxBalance"]=a.max_rate_balance,i[s+"MinBalance"]=a.tier_min_balance):(i[s+"PromoRate"+a.tier_sequence]=a.max_interest_rate,i[s+"InterestSpread"+a.tier_sequence]=a.interest_rate,i[s+"MaxBalance"+a.tier_sequence]=a.max_rate_balance,i[s+"MinBalance"+a.tier_sequence]=a.tier_min_balance),i[s+"BonusableBalance"]=a.bonusable_balance,i[s+"NonBonusableBalance"]=a.non_bonusable_balance,a.rate_status===n.rateStatus.ACTIV&&(i[s+"ActivePromoRate"]=a.max_interest_rate),e?n.accountDetails&&n.accountDetails.is_primary_owner&&n.accountDetails.profile_product_type===a.profile_product_type&&a.rate_status!==n.rateStatus.IDLE&&(i.PromoRate=a.max_interest_rate,i.InterestSpread=a.interest_rate,i.campaignId=t.campaign_id,i.BonusableBalanceAsOfDate=a.bonusable_balance_as_of_date,i.MaxBalance=a.max_rate_balance,i.MinBalance=a.tier_min_balance,a.rate_status===n.rateStatus.DISQ&&(i.RateStatus=a.rate_status)):i.campaignId=t.campaign_id;var r=t.rate_offer_details;i.ActivateFromDate=r.activate_from_date,i.ActivateUntilDate=r.activate_until_date,i.CampaignEndDate=r.campaign_end_date,i.CampaignStartDate=r.campaign_start_date,i.ContributionEndDate=r.contribution_end_date,i.ContributionStartDate=r.contribution_start_date,i.ConstructStartDate=r.construct_start_date,i.Duration=t.exception_duration_in_days,i.EndDate=r.expiry_date,i.SnapshotBalanceDate=r.snapshot_balance_date,i.StartDate=r.start_date,i.DisqualificationDate=r.disqualification_date,i.DisqualificationCounter=r.disqualification_counter,i.LastUpdateDate=r.last_update_date})),i}},{key:"_getOfferFlatModel",value:function(){return{ActivateFromDate:null,ActivateUntilDate:null,CampaignEndDate:null,CampaignStartDate:null,ContributionEndDate:null,ContributionStartDate:null,ConstructStartDate:null,SnapshotBalanceDate:null,StartDate:null,EndDate:null,PromoRate:null,InterestSpread:null,TSAPromoRate:null,TSAInterestSpread:null,TSABonusableBalance:null,TSAMaxBalance:null,TSAMinBalance:null,RSPPromoRate:null,RSPInterestSpread:null,RSPBonusableBalance:null,RSPMaxBalance:null,RSPMinBalance:null,RIFPromoRate:null,RIFInterestSpread:null,RIFBonusableBalance:null,RIFMaxBalance:null,RIFMinBalance:null,TFSAPromoRate:null,TFSAInterestSpread:null,TFSABonusableBalance:null,TFSAMaxBalance:null,TFSAMinBalance:null,BISAPromoRate:null,BISAInterestSpread:null,BISABonusableBalance:null,BISAMaxBalance:null,BISAMinBalance:null,TGSAPromoRate:null,TGSAInterestSpread:null,TGSABonusableBalance:null,TGSAMaxBalance:null,TGSAMinBalance:null,USDTSAPromoRate:null,USDTSAInterestSpread:null,USDTSABonusableBalance:null,USDTSAMaxBalance:null,USDTSAMinBalance:null,BonusableBalanceAsOfDate:null,Duration:null,template:null,modalUrl:null,campaignId:null,RateStatus:null,MaxBalance:null,MinBalance:null,DisqualificationDate:null,DisqualificationCounter:null,LastUpdateDate:null}}}]),t}();r.$inject=["$q","RequesterService","serviceConstants","transactionConstants","accountConstants","promoRateOfferConstants","$httpParamSerializer","$http"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4765)),a=s(n(4766));function s(t){return t&&t.__esModule?t:{default:t}}n(4767);var r={bindings:{viewType:"@",modalType:"@",accountDetails:"<?",specialRateOffer:"<?"},template:a.default,controller:i.default,require:{eNotificationFPCtrl:"?^tngForwardPricingOffer"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d){(0,i.default)(this,t),this.$log=n,this.$sce=a,this.promoRateOfferService=s,this.LocaleService=r,this.accountConstants=o,this.InsightsEventService=l,this.InsightsEvents=u.EVENT_MAP,this.isModalOpen=!1,this.offer={},this.insight={},this.showCopyText=!1,this.showButton=!1,this.showLink=!1,this.isAccountDetails=!1,this.buttonLabel="global.components.buttons.moreInfo",this.viewTypes=c.VIEW_TYPES,this.rateStatus=c.RATE_STATUS,this.EnvironmentService=e,this.staticBaseUrl=null,this.GlobalModalsService=d}return(0,a.default)(t,[{key:"$onInit",value:function(){this.staticBaseUrl=this.EnvironmentService.get("insights").staticBaseUrl,this._initBindData()}},{key:"_initBindData",value:function(){switch(this.viewType){case this.viewTypes.RB:this._getPromoRateOfferData(!1);break;case this.viewTypes.AD:this.accountDetails.account_summary.is_primary_owner&&this._getPromoRateOfferData(!0);break;case this.viewTypes.CB:this._getCustomerBonusInfo()}}},{key:"_getPromoRateOfferData",value:function(t){var e=this;this.promoRateOfferService.getPromoRateOfferData(this.accountDetails,t).then((function(t){t&&t.campaignId&&(e._showComponents(),e._isRateDisqualified(t),e._bindData(t))})).catch((function(t){e.$log.error("GET Promo Rate Offer Data Error: ",t),e.serviceErrors.push(t)}))}},{key:"_getCustomerBonusInfo",value:function(){if(this.specialRateOffer){this._showComponents();var t=this.promoRateOfferService.flatAndMapMatchingOffer(this.specialRateOffer,!1);this._bindData(t)}}},{key:"_isRateDisqualified",value:function(t){this.viewType===this.viewTypes.AD&&t.RateStatus===this.rateStatus.DISQ&&(this.showOffer=!1,this.showButton=!1,this.showCopyText=!1)}},{key:"_bindData",value:function(t){var e=this;this.offer=t,this.insight.offer=this.offer,this.viewType!==this.viewTypes.AD&&this.viewType!==this.viewTypes.RB||(this.offer.templateUrl=this._getTemplateUrl(this.offer.campaignId,!1),this.promoRateOfferService.validateRateFromMarketing(this.$sce.valueOf(this.offer.templateUrl)).then((function(t){t.data.toString().match(/page not found/gi)||t.data.toString().match(/page introuvable/gi)?e.showOffer=!1:e.showOffer=!0}))),this.offer.modalUrl=this._getTemplateUrl(this.offer.campaignId,!0),this.promoRateOfferService.validateRateFromMarketing(this.$sce.valueOf(this.offer.modalUrl)).then((function(t){t.data.toString().match(/page not found/gi)||t.data.toString().match(/page introuvable/gi)?e.showOffer=!1:e.showOffer=!0})),this.insight.modalUrl=this.offer.modalUrl}},{key:"_getTemplateUrl",value:function(t,e){var i="/assets/landing/lp-",a=this.viewType,s=this.staticBaseUrl+"/"+this.LocaleService.localeDisplay.toLowerCase();e&&(a=this.modalType,i="/assets/modal/mp-");var r=n(1869).create();return r.update(t+"_"+this.LocaleService.localeDisplay+"_"+a),r.digest("hex"),this.$sce.trustAsResourceUrl(""+(s+i)+r+".html")}},{key:"onModalOpen",value:function(){this.isModalOpen=!0}},{key:"_onModalClose",value:function(){this.isModalOpen=!1}},{key:"_hideComponents",value:function(){this.showCopyText=!1,this.showButton=!1,this.showLink=!1,this.isAccountDetails=!1}},{key:"_showComponents",value:function(){switch(this.showButton=!0,this.viewType){case this.viewTypes.AD:this.isAccountDetails=!0,this.showCopyText=!0,this.buttonLabel="global.components.buttons.moreInfo";break;case this.viewTypes.RB:this.showCopyText=!0,this.showButton=!1,this.showLink=!0;break;case this.viewTypes.CB:this.showCopyText=!1,this.buttonLabel="global.components.buttons.offerTerms"}}},{key:"handleEvent",value:function(t,e,n){switch(t){case this.InsightsEvents.CLOSE_MODAL:this._onModalClose();break;case"moveMoney":this._onModalClose(),this.GlobalModalsService.showMoveMoney();break;default:this.InsightsEventService.sendEvent(n,t,e)}}}]),t}();r.$inject=["EnvironmentService","$log","$sce","PromoRateOfferService","LocaleService","accountConstants","promoRateOfferConstants","InsightsEventService","InsightsConstants","GlobalModalsService"],e.default=r,t.exports=e.default},function(t,e){t.exports=' <div class="c-promoRateOfferComponent"> <div ng-class="$ctrl.isAccountDetails ? \'c-promoRateOfferMessageContainer\' : \'c-promoRateOfferRoadblockContainer\' " ng-if="$ctrl.showCopyText"> <div ng-if="$ctrl.showOffer" ng-include="$ctrl.offer.templateUrl"></div> </div> <div ng-if="$ctrl.showButton" class="c-promoRateOfferButtonContainer"> <button actionable-id="promo-rate-offer-open" class="btn--edit btn--large c-savings-promoRate-landingPg-modal-button" ng-if="$ctrl.showOffer" ng-click="$ctrl.onModalOpen();">{{$ctrl.buttonLabel | translate }}</button> <div class="c-promoRateOfferModalContainer"> <tng-modal-insight ng-if="$ctrl.isModalOpen" insight="$ctrl.insight" on-event="$ctrl.handleEvent(action, properties, $ctrl.insight)"></tng-modal-insight> <tng-move-money ng-if="$ctrl.showMoveMoney" on-close="$ctrl.onModalClose(result)" modal-type="$ctrl.modalType" pending-transaction="$ctrl.pendingMoveMoneyTransaction" predefined-account="$ctrl.parentAccount"></tng-move-money> </div> </div> <div ng-if="$ctrl.showLink" class="c-promoRateOfferLinkContainer"> <div class="c-promoRateOfferLinkModalContainer"> <tng-modal-insight ng-if="$ctrl.isModalOpen" insight="$ctrl.insight" on-event="$ctrl.handleEvent(action, properties, $ctrl.insight)"></tng-modal-insight> </div> </div> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={VIEW_TYPES:{AD:"AD",CB:"CB",RB:"RB"},OFFER_TYPES:{TRGGIC:"TRGGIC",TRGOFF:"TRGOFF",RTNOFF:"RTNOFF"},OFFER_STATUS:{ACTIV:"ACTIV"},RATE_STATUS:{DISQ:"DISQ",IDLE:"IDLE",ACTIV:"ACTIV"},PRODUCT_TYPE_PREFIX:{TSA:"TSA",RSP:"RSP",RIF:"RIF",TFSA:"TFSA",BISA:"BISA",TGSA:"TGSA",USDTSA:"USDTSA",NA:"NA"}};e.default=i,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=h(n(4770)),a=h(n(4774)),s=h(n(4775)),r=h(n(4776)),o=h(n(4779)),c=h(n(4782)),l=h(n(4785)),u=h(n(4788)),d=h(n(4791));function h(t){return t&&t.__esModule?t:{default:t}}var f=angular.module("csa-conversion-modal",[]).component("tngCsaConversion",i.default).component("tngCsaConversionTypeSelect",r.default).component("tngCsaConversionTerms",o.default).component("tngCsaConversionTermsFooter",c.default).component("tngCsaConversionInfo",l.default).component("tngCsaConversionReview",u.default).component("tngCsaConversionFinished",d.default).service("CSAConversionFlowService",s.default).constant("CSAConversionConstants",a.default);e.default=f,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4771)),a=s(n(4772));function s(t){return t&&t.__esModule?t:{default:t}}n(4773);var r={controller:a.default,template:i.default,bindings:{onClose:"&",dealId:"<?",account:"<?",child:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose(result)" class="c-bill-pay" hide-close="$ctrl.flowService.isLoading" flow-service="$ctrl.flowService"> <header> <span ng-if="$ctrl.flowService.showMainUI"> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.TYPE_SELECT">{{ $ctrl.flowService.currentState.titleKey | translate }}</span> <span ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.TERMS_CONDITIONS" ng-bind-html="$ctrl.flowService.currentState.titleKey | translate : {\n        accountName: $ctrl.$translate.instant($ctrl.flowService.accountType.header),\n      }"></span> <span ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.TPI" ng-bind-html="$ctrl.flowService.currentState.titleKey | translate : {\n        accountName: $ctrl.$translate.instant($ctrl.flowService.accountType.header),\n      }"></span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.INFO">{{ $ctrl.flowService.currentState.titleKey | translate }}</span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW">{{ $ctrl.flowService.currentState.titleKey | translate }}</span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DONE">{{ $ctrl.flowService.currentState.titleKey | translate }}</span> </span> </header> <div ng-if="$ctrl.flowService.showMainUI"> <tng-csa-conversion-type-select account="$ctrl.account" child="$ctrl.child" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.TYPE_SELECT"></tng-csa-conversion-type-select> <tng-csa-conversion-terms account="$ctrl.account" child="$ctrl.child" csa-terms-footer-form="$ctrl.csaTermsFooterForm" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.TERMS_CONDITIONS" on-enable-next="$ctrl.onEnableNext(enable)"></tng-csa-conversion-terms> <tpi-form account="$ctrl.account" customer="$ctrl.child" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.TPI" on-enable-next="$ctrl.onEnableNext(enable)" on-update-next-button="$ctrl.flowService.onUpdateNext(isSubmit)"></tpi-form> <tng-csa-conversion-info account="$ctrl.account" child="$ctrl.child" on-enable-next="$ctrl.onEnableNext(enable)" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.INFO"> </tng-csa-conversion-info> <tng-csa-conversion-review account="$ctrl.account" child="$ctrl.child" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.REVIEW"> </tng-csa-conversion-review> <tng-csa-conversion-finished account="$ctrl.account" child="$ctrl.child" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.DONE"></tng-csa-conversion-finished> </div> <div ng-show="$ctrl.flowService.inLoadingMode" class="c-review-state"> <div ng-show="$ctrl.flowService.isLoading"> <tng-loading-in-progress></tng-loading-in-progress> </div> </div> <footer ng-hide="$ctrl.flowService.showConfirmExitUI"> <tng-csa-conversion-terms-footer form="$ctrl.csaTermsFooterForm" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.TERMS_CONDITIONS"></tng-csa-conversion-terms-footer> <div> <button class="btn btn--edit" actionable-id="csaConversion_grayButton" ng-show="$ctrl.flowService.BUTTONS.BTN_GRY.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_GRY.disable" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_GRY)"> {{ $ctrl.flowService.BUTTONS.BTN_GRY.type.label | translate }} </button> <button class="btn btn--orange" ng-class="{\'CB_ReadOnly\': $ctrl.flowService.CB_DISABLED_BUTTONS.includes($ctrl.flowService.BUTTONS.BTN_ORG.type)}" actionable-id="csaConversion_orangeButton" ng-show="$ctrl.flowService.BUTTONS.BTN_ORG.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_ORG.disable" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_ORG)"> {{ $ctrl.flowService.BUTTONS.BTN_ORG.type.label | translate }} </button> </div> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d){(0,i.default)(this,t),this.$log=e,this.$translate=n,this.flowService=a,this.UserService=s,this.AccountDetailsService=r,this.AccountSummaryService=o,this.RequesterService=c,this.serviceConstants=l,this.accountConstants=u,this.$q=d}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;return this.csaTermsFooterForm={},this.flowService.activate(null,!1),this.flowService.enterLoadingMode(),this.$q.when(!0).then((function(){if(t.dealId)return t._initAccountAndChildInfo().then((function(e){t.child=e.csaChild,t.account=e.csaAccount,t.account.isCsa=!0}))})).then((function(){t.child.deal_id=t.account.csa.deal_id,t.account.third_party_info={address:{},person_info:{birth_date:null},corporate_info:{}}})).catch((function(e){t.$log.error(e)})).finally((function(){t.flowService.exitLoadingMode()}))}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"onEnableNext",value:function(t){this.flowService.BUTTONS.BTN_ORG.disable=!t}},{key:"onButtonClick",value:function(t){var e=this.$log,n=this.flowService;switch(t.type){case n.BUTTON_TYPES.BACK:n.gotoPreviousState();break;case n.BUTTON_TYPES.CANCEL:this._close();break;case n.BUTTON_TYPES.NEXT:case n.BUTTON_TYPES.SUBMIT:n.gotoNextState(this.account,this.child,this.dealId);break;case n.BUTTON_TYPES.DONE:this._close();break;default:e.debug("default - NO ACTION")}}},{key:"_close",value:function(){var t=this;this.flowService.exitLoadingMode(),this.flowService.warn().then((function(){t.onClose()}))}},{key:"_initAccountAndChildInfo",value:function(){var t=this,e=void 0,n=void 0,i=void 0,a=void 0;return this._getCSAAccountInfo().then((function(n){var a=n.service_requests.find((function(e){return e.dealId===t.dealId}));return e=a.application_account_number,(i=a.applicants.find((function(t){return void 0!==t.date_of_birth}))).conversion_date=a.conversion_date,t.AccountSummaryService.getAccounts()})).then((function(n){var i=n.accounts.find((function(t){return t.display_name===e})),s=i.number;return a=i.account_balance,t.AccountDetailsService.getAccountDetails(s,t.accountConstants.ACCOUNT_TYPES.SAVINGS)})).then((function(t){return(n=t.account_summary).account_balance=a,{csaChild:i,csaAccount:n}}))}},{key:"_getCSAAccountInfo",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_CSA_CONVERSION_APPLICATION)}},{key:"onModalClose",value:function(){this._close()}}]),t}();r.$inject=["$log","$translate","CSAConversionFlowService","UserService","AccountDetailsService","AccountSummaryService","RequesterService","serviceConstants","accountConstants","$q"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(528)),a=s(n(272));function s(t){return t&&t.__esModule?t:{default:t}}var r={JOINT_SAVINGS:{header:"clientOnboarding.csa.conversion.typeSelect.jointSavingsTitle",subHeader:"clientOnboarding.csa.conversion.typeSelect.jointSavingsDesc",code:a.default.ACCOUNT_PPTS.SAVINGS},SINGLE_CHECKING:{header:"clientOnboarding.csa.conversion.typeSelect.singleCheckingTitle",subHeader:"clientOnboarding.csa.conversion.typeSelect.singleCheckingDesc",code:a.default.ACCOUNT_PPTS.CHEQUING},SINGLE_SAVINGS:{header:"clientOnboarding.csa.conversion.typeSelect.singleSavingsTitle",subHeader:"clientOnboarding.csa.conversion.typeSelect.singleSavingsDesc",code:a.default.ACCOUNT_PPTS.SAVINGS}},o={ACCOUNT_TYPES:r,ACCOUNT_TYPES_TO_SERVER_VALUE:new i.default([[r.JOINT_SAVINGS,"JointISA"],[r.SINGLE_CHECKING,"SingleTHRiVE"],[r.SINGLE_SAVINGS,"SingleISA"]]),INTENDED_USE_OPTIONS:[{name:"clientOnboarding.csa.conversion.terms.intendedUseOptions.select",code:""},{name:"clientOnboarding.csa.conversion.terms.intendedUseOptions.homePurchase",code:"HOMPU"},{name:"clientOnboarding.csa.conversion.terms.intendedUseOptions.retirement",code:"RETSA"},{name:"clientOnboarding.csa.conversion.terms.intendedUseOptions.personalSavings",code:"PERSA"},{name:"clientOnboarding.csa.conversion.terms.intendedUseOptions.dailyBanking",code:"DTOD"},{name:"clientOnboarding.csa.conversion.terms.intendedUseOptions.vehiclePurchase",code:"PURVE"},{name:"clientOnboarding.csa.conversion.terms.intendedUseOptions.vacation",code:"VACLE"},{name:"clientOnboarding.csa.conversion.terms.intendedUseOptions.education",code:"EDUCA"},{name:"clientOnboarding.csa.conversion.terms.intendedUseOptions.emergencyFund",code:"EMRGF"},{name:"clientOnboarding.csa.conversion.terms.intendedUseOptions.other",code:"OTHER"}],SINGLE_ACCOUNT_TYPES:[r.SINGLE_SAVINGS,r.SINGLE_CHECKING],STATES:{TYPE_SELECT:{titleKey:"clientOnboarding.csa.conversion.typeSelect.heading"},TERMS_CONDITIONS:{titleKey:"clientOnboarding.csa.conversion.terms.heading"},TPI:{titleKey:"clientOnboarding.csa.conversion.terms.heading"},INFO:{titleKey:"clientOnboarding.csa.conversion.info.heading"},REVIEW:{titleKey:"clientOnboarding.csa.conversion.review.heading"},DONE:{titleKey:"clientOnboarding.csa.conversion.done.heading"}}};e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=h(n(177)),a=h(n(0)),s=h(n(2)),r=h(n(264)),o=h(n(266)),c=h(n(265)),l=h(n(1896)),u=h(n(267)),d=n(364);function h(t){return t&&t.__esModule?t:{default:t}}var f=function(t){function e(t,n,s,o,c,u,d,h,f,p,g,m,_,v,S,T){(0,a.default)(this,e);var y=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,o,u,d,h,p,v,S));return y.$q=n,y.$log=t,y.$window=d,y.$filter=s,y.$translate=c,y.csaConversionConstants=g,y.eventBusService=f,y.RequesterService=m,y.serviceConstants=_,y.setupAccountFormService=S,y.tpiFormConstants=T,y.AVAILABLE_SERVICES=_.AVAILABLE_SERVICES,y.BUTTON_TYPES=p.BUTTON_TYPES,y.MODAL_TYPES=p.MODAL_TYPES,y.STATES=g.STATES,y.ACCOUNT_TYPES=g.ACCOUNT_TYPES,y.INTENDED_USE_OPTIONS=g.INTENDED_USE_OPTIONS,y.ACCOUNT_TYPES_TO_SERVER_VALUE=g.ACCOUNT_TYPES_TO_SERVER_VALUE,y.AccountPayloadHelper=new l.default(T),y.accountType=null,y.doneLoading=!1,y.electronicDocumentsSelected=!1,y.errorMessage=null,y.intended_account_use=null,y.isLoading=!1,y.termsAndConditionsAccepted=!1,y.third_party=void 0,y}return(0,c.default)(e,t),(0,s.default)(e,[{key:"gotoNextState",value:function(t,e){var n=this,i=this.currentState,a=this.STATES;switch(i){case a.TYPE_SELECT:-1!==this.csaConversionConstants.SINGLE_ACCOUNT_TYPES.indexOf(this.accountType)?this.moveTo(a.INFO):this.moveTo(a.TERMS_CONDITIONS);break;case a.TERMS_CONDITIONS:this.third_party?(t.third_party_info=this.AccountPayloadHelper.getThirdPartyInfo(t),this.moveTo(a.TPI)):this.moveTo(a.INFO);break;case a.TPI:this.moveTo(a.INFO);break;case a.INFO:this.moveTo(a.REVIEW),this.errorMessage=null;break;case a.REVIEW:this.errorMessage=null,this.submitCSAConversion(t,e).then((function(e){n.serviceConstants.RESPONSE_ERRORS.ERROR_MESSAGE in e||n.serviceConstants.RESPONSE_ERRORS.DETAILS in e.response_status||n.serviceConstants.RESPONSE_ERRORS.STATUS_CODE in e.response_status&&e.response_status.status_code===n.serviceConstants.STATUS_CODES.SYSTEM_ERROR||e.response_status.status_code&&e.response_status.status_code===n.serviceConstants.STATUS_CODES.INVALID_REQUEST_BODY?(n.serviceConstants.RESPONSE_ERRORS.ERROR_MESSAGE in e&&(n.errorMessage=e.errorMessage),n.serviceConstants.RESPONSE_ERRORS.DETAILS in e.response_status&&(e.response_status.details.forEach((function(t){n.errorMessage=t.technical_description})),n.errorMessage=n.submitErrors),n.serviceConstants.RESPONSE_ERRORS.STATUS_CODE in e.response_status&&e.response_status.status_code===n.serviceConstants.STATUS_CODES.SYSTEM_ERROR&&(n.errorMessage=n.$translate.instant("global.errorCodes.generic")),n.serviceConstants.RESPONSE_ERRORS.STATUS_CODE in e.response_status&&e.response_status.status_code===n.serviceConstants.STATUS_CODES.INVALID_REQUEST_BODY&&(n.errorMessage=e.response_status.technical_description),n.$log.error("SUBMIT CSA Conversion Error: ",e)):(t.csa.convertible=!1,n.eventBusService.publish(n.serviceConstants.DATA_INVALIDATED,n.serviceConstants.ROOT_ENDPOINTS.ACCOUNTS),n.$log.debug("SUBMIT CSA Conversion Response: ",e),n.moveTo(a.DONE))})).catch((function(t){n.$log.error("SUBMIT CSA Conversion Error: ",t)}));break;case a.DONE:this.moveTo(a.REVIEW);break;default:this.$log.debug("Unknown or unrecognized state")}}},{key:"showLoadingSpinner",value:function(){this.isLoading=!0,this.doneLoading=!1}},{key:"showLoadingDoneIcon",value:function(){this.isLoading=!1,this.doneLoading=!0}},{key:"enterLoadingMode",value:function(){this.showLoadingSpinner()}},{key:"exitLoadingMode",value:function(){this.isLoading=!1,this.doneLoading=!1}},{key:"submitCSAConversion",value:function(t,e){var n={data:this._convertDataObject(t,e),urlVars:{actionCode:"INSTRUCT",dealId:e.deal_id}};return this.RequesterService.request(this.AVAILABLE_SERVICES.CSA_CONVERSION,n)}},{key:"_resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.currentState=this.STATES.TYPE_SELECT,this.BUTTONS={BTN_GRY:new d.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new d.ModalFooterButton(this.BUTTON_TYPES.NEXT,!1,!0)}}},{key:"_updateUI",value:function(){var t=this.currentState,e=this.BUTTON_TYPES,n=this.BUTTONS,i=this.STATES;switch(n.BTN_GRY.show=!0,n.BTN_GRY.disable=!1,n.BTN_ORG.show=!1,n.BTN_ORG.disable=!1,t){case i.TYPE_SELECT:n.BTN_GRY.type=e.CANCEL,n.BTN_ORG.show=!1;break;case i.TERMS_CONDITIONS:case i.TPI:case i.INFO:n.BTN_GRY.type=e.BACK,n.BTN_ORG.type=e.NEXT,n.BTN_ORG.show=!0,n.BTN_ORG.disable=!0;break;case i.REVIEW:n.BTN_GRY.show=!1,n.BTN_ORG.type=e.SUBMIT,n.BTN_ORG.show=!0;break;case i.DONE:this.hideWarning(),n.BTN_GRY.show=!1,n.BTN_ORG.type=e.DONE,n.BTN_ORG.show=!0;break;default:this.$log.warn("Unrecognized state passed")}}},{key:"onUpdateNext",value:function(t){this.BUTTONS.BTN_ORG.type=t?this.BUTTON_TYPES.SUBMIT:this.BUTTON_TYPES.NEXT}},{key:"_convertDataObject",value:function(t,e){var n=this.ACCOUNT_TYPES_TO_SERVER_VALUE.get(this.accountType),i=angular.copy(t),a={conversion_instruction:{conversion_details:{child_email:angular.copy(e).email,from_account_number:i.display_name,to_product_type:n}}};-1!==this.csaConversionConstants.SINGLE_ACCOUNT_TYPES.indexOf(this.accountType)||(a.conversion_instruction.legal_instructions={electronic_documents_selected:this.electronicDocumentsSelected,terms_and_conditions_accepted:this.termsAndConditionsAccepted,third_party:this.third_party}),this.intended_account_use&&(a.conversion_instruction.legal_instructions.intended_account_use=this.intended_account_use,a.conversion_instruction.legal_instructions.other_intended_use=this.other_intended_use);var s=a.conversion_instruction.legal_instructions;if(this.third_party){var r=i.third_party_info;s.third_party_info=r,r.type===this.tpiFormConstants.TYPES.INDIVIDUAL?delete r.corporate_info:r.type===this.tpiFormConstants.TYPES.BUSINESS&&delete r.person_info}return a}},{key:"_getAnalyticsID",value:function(){return"csa/conversion"}},{key:"inLoadingMode",get:function(){return this.isLoading||this.doneLoading}}]),e}(u.default);f.$inject=["$log","$q","$filter","$transitions","$translate","$state","$window","$rootScope","EventBusService","pageFlowConstants","CSAConversionConstants","RequesterService","serviceConstants","AnalyticsService","SetupAccountFormService","tpiFormConstants"],e.default=f,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(4777));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(4778)).default,controller:i.default,bindings:{account:"<",child:"<"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=r(n(45));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,r,o){(0,i.default)(this,t),this.$log=e,this.TILE_TYPE=r.TILE_TYPE,this.accountHelpersService=n,this.flowService=a,this.$translate=o,this.moment=s.default}return(0,a.default)(t,[{key:"$onInit",value:function(){this.TILE_DATA=[this.flowService.ACCOUNT_TYPES.SINGLE_SAVINGS,this.flowService.ACCOUNT_TYPES.SINGLE_CHECKING,this.flowService.ACCOUNT_TYPES.JOINT_SAVINGS],this.name=this.accountHelpersService.getDisplayNameInstant(this.account);var t=this.moment().diff(this.moment(this.child.conversion_date),"months",!0);if(t<=1)this.timeline=this.$translate.instant("clientOnboarding.csa.conversion.typeSelect.descriptionDateSingular");else{var e=Math.ceil(t);this.timeline=this.$translate.instant("clientOnboarding.csa.conversion.typeSelect.descriptionDatePlural",{numberOfMonth:e})}}},{key:"selectAccount",value:function(t){this.flowService.accountType=t,this.flowService.gotoNextState()}}]),t}();o.$inject=["$log","AccountHelpersService","CSAConversionFlowService","tngTileListConstants","$translate"],e.default=o,t.exports=e.default},function(t,e){t.exports='<p ng-bind-html="\'clientOnboarding.csa.conversion.typeSelect.description\' | translate : {\n    timeline: $ctrl.timeline,\n    firstname: $ctrl.child.first_name\n  }"> </p> <div class="confirm__table"> <div class="confirm__table__row"> <div class="confirm__table__header cell__code"> <span class="confirmed--title"> <strong>{{ $ctrl.name }}</strong> - <span class="body--callout2">{{ $ctrl.account.display_name }}</span> </span> </div> </div> <div class="confirm__table__row"> <div class="confirm__table__cell cell__amount"> <span class="confirmed--title">{{ \'clientOnboarding.csa.conversion.typeSelect.currentBalance\' | translate }}</span> <br> <div class="amount--orange">{{ $ctrl.account.account_balance | currency }}</div> <div ng-if="$ctrl.data.isCrossCurrency" class="amount--grey"> {{ $ctrl.data.amountConverted | currency }} {{ $ctrl.data.currencyConverted }} </div> </div> <div class="confirm__table__cell cell__new-balance-from"> <span class="confirmed--title"> <span>{{ \'clientOnboarding.csa.conversion.typeSelect.childsName\' | translate }}</span> </span> <br> <span class="amount--orange">{{ $ctrl.child.first_name }} {{ $ctrl.child.last_name }}</span> </div> <div class="confirm__table__cell cell__new-balance-to"> <span class="confirmed--title">{{ \'clientOnboarding.csa.conversion.typeSelect.childsDob\' | translate }}</span> <br> <span class="amount--orange">{{ $ctrl.moment($ctrl.child.date_of_birth).format(\'YYYY-MM-DD\') | date:\'longDate\' }}</span> </div> </div> </div> <p><strong>{{ \'clientOnboarding.csa.conversion.typeSelect.convert\' | translate }}</strong></p> <tng-tile-list class="c-csa-conversion__tile-list" tile-data="$ctrl.TILE_DATA" tile-type="$ctrl.TILE_TYPE.text" is-actionable="true" single-select="true" selected-tiles="[$ctrl.flowService.accountType]" on-tile-click="$ctrl.selectAccount(tileData)"> </tng-tile-list> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(4780));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(4781)).default,controller:i.default,bindings:{account:"<",child:"<",csaTermsFooterForm:"<",onEnableNext:"&"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c){(0,i.default)(this,t),this.$anchorScroll=e,this.$location=n,this.$log=a,this.$scope=s,this.$translate=r,this.flowService=o,this.selectConstants=c}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.form={};var e=this.$location.hash();this.$location.hash("csa-conversion-terms"),this.$anchorScroll(),this.$location.hash(e),this.validateInputs(),this.$scope.$watch((function(){return t.flowService.third_party}),(function(){return t.validateInputs()})),this.$scope.$watch((function(){return t.form.$valid}),(function(){return t.validateInputs()})),this.$scope.$watch((function(){return t.csaTermsFooterForm.$valid}),(function(){return t.validateInputs()})),this.intendedUseOptions=this.flowService.INTENDED_USE_OPTIONS.map((function(e){return e.name=t.$translate.instant(e.name),e}))}},{key:"validateInputs",value:function(){var t=this.form.$valid&&this.flowService.termsAndConditionsAccepted;this.onEnableNext({enable:t})}}]),t}();r.$inject=["$anchorScroll","$location","$log","$scope","$translate","CSAConversionFlowService","tngSelectAutocompleteConstants"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="csa-conversion-terms" id="csa-conversion-terms"> <ng-form name="$ctrl.form"> <p>{{ ::\'clientOnboarding.csa.conversion.terms.description\' | translate }}</p> <h3>{{ ::\'clientOnboarding.csa.conversion.terms.thirdPartyAndUse\' | translate }}</h3> <p>{{ ::\'clientOnboarding.csa.conversion.terms.infoDescription\' | translate }}</p> <p> <strong>{{ ::\'clientOnboarding.csa.conversion.terms.personBenefit\' | translate }}</strong> <tng-help-bubble> {{ ::(\'clientOnboarding.csa.conversion.terms.personBenefitTooltip\' | translate) }} </tng-help-bubble> </p> <div class="btn__row top-margin-small"> <input ng-required="true" ng-model="$ctrl.flowService.third_party" ng-value="true" actionable-id="thirdPersonYes" class="input input--pill" type="radio" required/> <label for="thirdPersonYes"> {{ ::\'clientOnboarding.setupAccountForm.labels.yes\' | translate }} </label> <input actionable-id="thirdPersonNo" class="input input--pill" ng-model="$ctrl.flowService.third_party" ng-required="true" ng-value="false" type="radio"/> <label for="thirdPersonNo"> {{ ::\'clientOnboarding.setupAccountForm.labels.no\' | translate }} </label> <div ng-messages="$ctrl.form.thirdPersonYes.$error" ng-show="$ctrl.form.thirdPersonYes.$invalid && $ctrl.form.thirdPersonYes.$dirty && $ctrl.form.thirdPersonYes.$touched" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> </div> <div ng-messages="$ctrl.form.thirdPersonNo.$error" ng-show="$ctrl.form.thirdPersonNo.$invalid && $ctrl.form.thirdPersonNo.$dirty && $ctrl.form.thirdPersonNo.$touched" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> </div> </div> <p class="top-margin-small"><strong>{{ ::\'clientOnboarding.csa.conversion.terms.intendedUse\' | translate }}</strong></p> <tng-select-autocomplete class="csa-conversion-terms__select" input-id="intendeduseSelect" ng-model="$ctrl.flowService.intended_account_use" ng-required="true" option-label-key="name" options="$ctrl.intendedUseOptions" placeholder="{{ ::\'clientOnboarding.tpiForm.placeholders.select\' | translate }}" select-type="$ctrl.selectConstants.SELECT_TYPES.STATIC"></tng-select-autocomplete> <section class="csa-conversion-terms__other-section medium-width-section" ng-if="$ctrl.flowService.intended_account_use === \'OTHER\'"> <input actionable-id="other" class="input top-margin-small" ng-model="$ctrl.flowService.other_intended_use" placeholder="{{ ::\'mutualFund.setupPortfolio.intendedUse.other\' | translate }}" required type="text"/> <div ng-messages="$ctrl.form.other.$error" ng-show="$ctrl.form.other.$dirty" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> </div> </section> </ng-form> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(4783));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(4784)).default,controller:i.default,bindings:{form:"="}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(0),s=(i=a)&&i.__esModule?i:{default:i};var r=function t(e){(0,s.default)(this,t),this.flowService=e};r.$inject=["CSAConversionFlowService"],e.default=r,t.exports=e.default},function(t,e){t.exports='<ng-form name="$ctrl.form"> <section class="csa-conversion-terms__agreements"> <div class="container"> <div class="field csa-conversion-terms__footer-checkbox"> <input actionable-id="agreeTerms" class="input" ng-false-value="false" ng-model="$ctrl.flowService.termsAndConditionsAccepted" ng-required="true" ng-true-value="true" type="checkbox"/> <label class="csa-conversion-terms__footer-checkbox--label" for="agreeTerms" ng-bind-html="\'clientOnboarding.csa.conversion.terms.agreeToTerms\' | translate | absoluteHref"></label> <div class="csa-conversion__sub-footer--clear"></div> </div> <div class="field csa-conversion-terms__footer-checkbox"> <input actionable-id="agreeEDocs" class="input" ng-false-value="false" ng-model="$ctrl.flowService.electronicDocumentsSelected" ng-true-value="true" type="checkbox"/> <label class="csa-conversion-terms__footer-checkbox--label" for="agreeEDocs" ng-bind-html="\'clientOnboarding.csa.conversion.terms.agreeToEDocs\' | translate | absoluteHref"></label> <div class="csa-conversion__sub-footer--clear"></div> </div> </div> </section> </ng-form> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(4786));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(4787)).default,controller:i.default,bindings:{account:"<",child:"<",onEnableNext:"&"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=n(67);function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n){(0,i.default)(this,t),this.$log=e,this.$scope=n,this.nameValidation=s.nameValidation,this.emailValidation=s.emailValidation,this.userIdValidation=s.userIdValidation,this.emailRegexPattern=s.emailFullPattern,this.secretQuestionValidation=s.secretQuestionValidation}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.form={},this.validateInputs(),this.$scope.$watch((function(){return t.form.$valid}),(function(){return t.validateInputs()}))}},{key:"validateInputs",value:function(){var t=this.form.$valid&&this.emailValidation(this.child.email)&&this.userIdValidation(this.child.accountNumber);this.onEnableNext({enable:t})}}]),t}();o.$inject=["$log","$scope"],e.default=o,t.exports=e.default},function(t,e){t.exports='<div class="csa-conversion-info"> <ng-form name="$ctrl.form"> <section class="csa-conversion-info__section"> <p>{{ ::\'clientOnboarding.csa.conversion.info.description\' | translate }}</p> </section> <section class="csa-conversion-info__section"> <label for="firstName">{{ ::\'clientOnboarding.csa.conversion.info.childsName\' | translate }}</label> <div class="grid__container"> <div class="field styleguide-grid-unit grid__column--1of2 top-margin-small"> <input actionable-id="firstName" autocomplete="off" autofocus autofocus-device="{{ $ctrl.autoFocusConstants.ALL }}" class="input" name="firstName" ng-class="{\n              warning: $ctrl.form.firstName.$invalid || !$ctrl.nameValidation($ctrl.child.first_name)\n            }" ng-disabled="true" ng-model="$ctrl.child.first_name" ng-required="true" ng-trim="false" tabindex="0" translate-cloak type="text"/> </div> <div class="field styleguide-grid-unit grid__column--1of2 top-margin-small"> <input actionable-id="lastName" autocomplete="off" autofocus autofocus-device="{{ $ctrl.autoFocusConstants.ALL }}" class="input" ng-class="{\n              warning: $ctrl.form.lastName.$invalid || !$ctrl.nameValidation($ctrl.child.last_name)\n            }" ng-disabled="true" ng-model="$ctrl.child.last_name" ng-required="true" ng-trim="false" tabindex="1" translate-cloak type="text"/> </div> </div> <div ng-messages="$ctrl.form.firstName.$error || $ctrl.form.lastName.$error" ng-show="$ctrl.form.firstName.$invalid || $ctrl.form.lastName.$invalid" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> </div> </section> <section class="csa-conversion-info__section"> <label for="email">{{ ::\'clientOnboarding.csa.conversion.info.childsEmail\' | translate }}</label> <div class="grid__container"> <div class="field styleguide-grid-unit grid__column--1of1 top-margin-small"> <input actionable-id="email" autocomplete="off" autofocus autofocus-device="{{ $ctrl.autoFocusConstants.ALL }}" class="input" ng-change="$ctrl.validateInputs()" ng-class="{\n              warning: $ctrl.form.email.$dirty && $ctrl.form.email.$touched && ($ctrl.form.email.$invalid || !$ctrl.emailValidation($ctrl.child.email))\n            }" ng-model="$ctrl.child.email" ng-required="true" ng-pattern="$ctrl.emailRegexPattern" ng-trim="false" placeholder="{{ ::\'clientOnboarding.csa.conversion.info.childsEmail\' | translate }}" tabindex="3" translate-cloak type="text"/> </div> </div> <div ng-messages="$ctrl.form.email.$error" ng-show="$ctrl.form.email.$invalid && $ctrl.form.email.$dirty && $ctrl.form.email.$touched" class="field__error"> <p ng-message="required"> {{::\'global.validation.required\' | translate}} </p> <p ng-message="pattern"> {{ ::\'validation.wrongEmailFormat\' | translate}} </p> </div> <div class="field__error" ng-show="$ctrl.form.email.$valid && !$ctrl.emailValidation($ctrl.child.email)"> <p> {{ ::\'clientOnboarding.tpiForm.errors.required\' | translate }} </p> </div> </section> </ng-form> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(4789));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(4790)).default,controller:i.default,bindings:{account:"<",child:"<"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.$log=e,this.$translate=n,this.accountHelpersService=a,this.flowService=s,this.TILE_TYPE=r.TILE_TYPE}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this.accountHelpersService.getDisplayNameInstant(this.account);this.accounts={FROM:{tileDescription:"clientOnboarding.csa.conversion.review.convertFrom",accountName:t,accountNumber:this.account.display_name,amount:this.account.account_balance},INTO:{tileDescription:"clientOnboarding.csa.conversion.review.convertInto",accountName:this.$translate.instant(this.flowService.accountType.header),amount:this.account.account_balance}}}}]),t}();r.$inject=["$log","$translate","AccountHelpersService","CSAConversionFlowService","tngTileListConstants"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="csa-conversion-review"> <tng-error-message ng-if="$ctrl.flowService.errorMessage"> {{ $ctrl.flowService.errorMessage }} </tng-error-message> <p>{{ ::\'clientOnboarding.csa.conversion.review.description\' | translate }}</p> <tng-tile-list class="c-csa-conversion__tile-list fromAccount" tile-data="$ctrl.accounts.FROM" tile-type="$ctrl.TILE_TYPE.account" is-actionable="false" single-select="true" selected-tiles="[$ctrl.flowService.accountType]" on-tile-click="$ctrl.selectAccount(tileData)"> </tng-tile-list> <tng-tile-list class="c-csa-conversion__tile-list" tile-data="$ctrl.accounts.INTO" tile-type="$ctrl.TILE_TYPE.account" is-actionable="true" single-select="true" on-tile-click="$ctrl.flowService.moveBackTo($ctrl.flowService.STATES.TYPE_SELECT)"> </tng-tile-list> <h3>{{ ::\'clientOnboarding.csa.conversion.review.childsInfo\' | translate }}</h3> <div class="infoRow" ng-if="$ctrl.child.first_name"> <div class="label">{{ ::\'clientOnboarding.csa.conversion.review.childsName\' | translate }}</div> <div class="value">{{ $ctrl.child.first_name }} {{ $ctrl.child.last_name }}</div> </div> <div class="infoRow" ng-if="$ctrl.child.email"> <div class="label">{{ ::\'clientOnboarding.csa.conversion.review.childsEmail\' | translate }}</div> <div class="value">{{ $ctrl.child.email }}</div> </div> <button class="btn btn--edit" actionable-id="csaConversion_editInfo" ng-click="$ctrl.flowService.moveTo($ctrl.flowService.STATES.INFO)">{{ ::\'global.components.buttons.edit\' | translate }}</button> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(4792));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(4793)).default,controller:i.default,bindings:{account:"<",child:"<"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s){(0,i.default)(this,t),this.$log=e,this.$translate=s,this.flowService=a,this.ACCOUNT_TYPES=n.ACCOUNT_TYPES}return(0,a.default)(t,[{key:"$onInit",value:function(){this.headerTranslationId=this.$translate.instant(this.flowService.accountType.header)}}]),t}();r.$inject=["$log","CSAConversionConstants","CSAConversionFlowService","$translate"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="csa-conversion-finished"> <p ng-bind-html="\'clientOnboarding.csa.conversion.done.description\' | translate : {\n    accountName: $ctrl.headerTranslationId,\n    emailAddress: $ctrl.child.email,\n  }"></p> <section class="csa-conversion-finished__section csa-conversion-finished-info" ng-if="$ctrl.flowService.accountType == $ctrl.ACCOUNT_TYPES.JOINT_SAVINGS"> <h3>{{ ::\'clientOnboarding.csa.conversion.done.infoTitle\' | translate: { \'accountName\': $ctrl.$translate.instant($ctrl.flowService.accountType.header) } }}</h3> <div class="info-panel grid__container"> <div class="info-panel__row display-flex"> <div class="info-panel__column styleguide-grid-unit grid__column--1of1"> <p class="inline-block medium">{{ \'clientOnboarding.csa.conversion.done.accountNumber\' | translate }}</p> <div class="large tangerine"> <strong>{{ $ctrl.account.display_name }}</strong> </div> </div> </div> </div> </section> <section class="csa-conversion-finished__section"> <h3>{{ ::\'clientOnboarding.csa.conversion.done.nextSteps\' | translate }}</h3> <div class="csa-conversion-finished__nextSteps"> <div class="csa-conversion-finished__nextSteps--numberIcon">1</div> <div class="csa-conversion-finished__nextSteps--stepCopy">{{ ::\'clientOnboarding.csa.conversion.done.pinReset\' | translate }}</div> </div> <div class="csa-conversion-finished__nextSteps"> <div class="csa-conversion-finished__nextSteps--numberIcon">2</div> <div class="csa-conversion-finished__nextSteps--stepCopy">{{ ::\'clientOnboarding.csa.conversion.done.login\' | translate }}</div> </div> </section> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4795)),a=s(n(4796));function s(t){return t&&t.__esModule?t:{default:t}}n(4797);var r={template:i.default,controller:a.default,require:{form:"^form"},bindings:{onAfterReferenceDataLoaded:"&",onChange:"&",pageId:"@",prefillData:"<",prefillEmploymentStatuses:"<",showIndustryYears:"<?",hideIndustryYearsForEmplStatuses:"<?",showEmployerName:"<?",showEmployerNameTitle:"<?",preserveEmployerName:"<?",showValidationOnLoad:"<?",showWarningBorder:"<?",titleKey:"@?",industryYearsLabel:"<?",employerNameLabel:"<?",employmentInfoLabel:"<?",ngRequired:"<?",isNewClientEnrollment:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-employment-select"> <div class="field"> <label actionable-id="{{ ::$ctrl.pageId }}_employmentInfoLabel" class="top-margin-large heading--sub3"> <span class="heading--sub3" ng-if="!$ctrl.employmentInfoLabel">{{ ::(($ctrl.titleKey || \'global.employmentInfo.title\') | translate) }} </span> <span ng-if="$ctrl.employmentInfoLabel">{{ $ctrl.employmentInfoLabel | translate }} </span> <tng-help-bubble ng-if="$ctrl.isNewClientEnrollment"> {{::\'global.employmentInfo.employmentTooltip\' | translate}} </tng-help-bubble> </label> <div class="top-margin-small"> <tng-select-autocomplete ng-if="$ctrl.EMPLOYMENT_STATUSES" class="cciv-form__dropdown" ng-model="$ctrl.model.employment_status" input-id="{{ ::$ctrl.pageId }}_empStatus" options="$ctrl.EMPLOYMENT_STATUSES" option-label-key="name" placeholder="{{ ::\'global.employmentInfo.employmentStatus\' | translate }}" on-select="$ctrl.onSelectEmploymentStatus(option)" ng-required="$ctrl.ngRequired" select-type="$ctrl.selectConstants.SELECT_TYPES.STATIC" show-default-warnings="$ctrl.showValidationOnLoad" ng-warning-border="$ctrl.showWarningBorder"></tng-select-autocomplete> </div> </div> <div class="field top-margin-small" ng-if="$ctrl.industryRequired && ($ctrl.isNewClientEnrollment && !$ctrl.isNative)"> <label class="heading--sub3" actionable-id="OccupationtypeAheadLabel"> {{ ::\'global.employmentInfo.employmentTypeAheadLabel\' | translate }} </label> <p class="margin-subheader"> {{ ::\'global.employmentInfo.employmentTypeAheadDescription\' | translate }} </p> <tng-typeahead-search input-id="{{ ::$ctrl.pageId }}_empSearchForm" options="$ctrl.OCCUPATIONS_INDUSTRIES_LINKED" option-label-key="\'name\'" option-value-key="\'code\'" preselected-value="$ctrl.model.industry_occupation_code" ng-model="$ctrl.typeAheadStringValue" on-select="$ctrl.onSelectIndustryOccupation(option)" placeholder-text="{{ ::\'global.employmentInfo.employmentTypeAheadPlaceholder\' | translate }}" ng-required="true" no-selection-msg="{{ ::\'global.employmentInfo.employmentNoResults\' | translate }}"></tng-typeahead-search> </div> <div class="field top-margin-small" ng-if="$ctrl.industryRequired && (!$ctrl.isNewClientEnrollment || $ctrl.isNative)"> <tng-select-autocomplete class="cciv-form__dropdown" input-id="{{ ::$ctrl.pageId }}_empInfo2" ng-if="$ctrl.INDUSTRIES" ng-model="$ctrl.model.occupation.industry_code" ng-required="$ctrl.industryRequired && $ctrl.ngRequired" on-select="$ctrl.onSelectIndustry(option)" options="$ctrl.INDUSTRIES" option-label-key="name" placeholder="{{ ::\'global.employmentInfo.employmentIndustry\' | translate }}" select-type="$ctrl.selectConstants.SELECT_TYPES.STATIC" show-default-warnings="$ctrl.showValidationOnLoad" ng-warning-border="$ctrl.showWarningBorder"></tng-select-autocomplete> </div> <div class="field top-margin-small" ng-if="$ctrl.occupationRequired && (!$ctrl.isNewClientEnrollment || $ctrl.isNative)"> <tng-select-autocomplete class="cciv-form__dropdown cciv-form__dropdown--last" input-id="{{ ::$ctrl.pageId }}_empInfo3" ng-if="$ctrl.OCCUPATIONS" ng-model="$ctrl.model.occupation.occupation_code" ng-required="$ctrl.occupationRequired && $ctrl.ngRequired" on-select="$ctrl.onSelectOccupation(option)" options="$ctrl.OCCUPATIONS[$ctrl.model.occupation.industry_code]" option-label-key="name" placeholder="{{ ::\'global.employmentInfo.employmentOccupation\' | translate }}" select-type="$ctrl.selectConstants.SELECT_TYPES.STATIC" show-default-warnings="$ctrl.showValidationOnLoad" ng-warning-border="$ctrl.showWarningBorder"></tng-select-autocomplete> </div> <div class="field" ng-if="$ctrl.showIndustryYears && !$ctrl.hideIndYearsForEmploymentType"> <label class="top-margin-large" class="heading--sub3"> <span ng-if="!$ctrl.industryYearsLabel">{{ ::\'global.employmentInfo.industryYears.header\' | translate }}</span> <span ng-if="$ctrl.industryYearsLabel">{{$ctrl.industryYearsLabel | translate}}</span> </label> <div class="top-margin-medium"> <tng-select-autocomplete input-id="{{::$ctrl.pageId }}_industryYears" ng-model="$ctrl.model.occupation.industry_years" ng-model-set-raw-object="true" on-select="$ctrl.onChangeIndustryYears()" options="$ctrl.industryYearOptions" option-label-key="value" is-static="true" placeholder="{{ ::\'global.select\' | translate }}" ng-required="$ctrl.ngRequired"></tng-select-autocomplete> <div ng-show="$ctrl.showError($ctrl.form, \'{{::$ctrl.pageId}}_industryYears\', \'required\', $ctrl.showValidationOnLoad)" class="field__error"> {{ ::\'clientOnboarding.tpiForm.errors.required\' | translate }} </div> </div> </div> <ng-form name="$ctrl.employerName"> <div class="field top-margin-medium" ng-if="$ctrl.occupationRequired && $ctrl.showEmployerName"> <label actionable-id="{{::$ctrl.pageId }}_employerNameLabel" ng-if="$ctrl.showEmployerNameTitle" for="empInfoCoName" class="heading--sub3 top-margin-medium"> <span ng-if="!$ctrl.employerNameLabel">{{ \'clientOnboarding.ccIncomeVerification.input_emp_name\' | translate }}</span> <span ng-if="$ctrl.employerNameLabel">{{$ctrl.employerNameLabel | translate}}</span> </label> <input type="text" class="input bottom-margin-none" ng-class="{ \'warning\': !$ctrl.employerName.empInfoCoName.$valid && ($ctrl.employerName.empInfoCoName.$touched || $ctrl.showValidationOnLoad)}" name="empInfoCoName" maxlength="40" minlength="3" ng-change="$ctrl.onChangeCoName()" ng-model="$ctrl.data.employerName" ng-model-options="{ allowInvalid: true }" ng-pattern="$ctrl.employerNamePattern" placeholder="{{:: \'clientOnboarding.ccIncomeVerification.input_emp_name\' | translate }}" ng-required="$ctrl.ngRequired"> <div class="field__error" ng-messages="$ctrl.employerName.empInfoCoName.$error" ng-show="$ctrl.showError($ctrl.employerName, \'empInfoCoName\', [\'required\', \'minlength\', \'pattern\'], $ctrl.showValidationOnLoad)"> <p ng-message="required">{{:: \'global.validation.required\' | translate }}</p> <p ng-message="minlength">{{:: \'global.errorCodes.41104\' | translate }}</p> <p ng-message="pattern">{{:: \'global.errorCodes.41103\' | translate }}</p> </div> </div> </ng-form> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=n(67);function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,r,o,c,l,u){var d=this;(0,i.default)(this,t),this.$log=e,this.$translate=n,this.ReferenceDataService=r,this.employedStatusCodes=o.EMPLOYED_STATUS_CODES,this.selectConstants=c,this.$scope=l,this.EnvironmentService=u,this.REF_DATA_TYPES=r.TYPES,this.DEFAULT_EMPLOYMENT_STATUSES=a.EMPLOYMENT_STATUSES,this.EMPLOYMENT_STATUSES=[],this.REQUIRES_OCCUPATION=a.REQUIRES_OCCUPATION,this.INDUSTRIES=[],this.OCCUPATIONS={},this.showError=s.showError,this.employerNamePattern=s.notTwoConsecutiveAMLCharsPattern,this.data={employmentStatus:{},industry:null,occupation:null,employerName:"",industryYears:null},this.model={employment_status:"",occupation:{industry_code:"",occupation_code:"",industry_years:null},industry_occupation_code:""},this.industryYearOptions=Array(100).fill(0).map((function(t,e){var n=1===e?"global.year":"global.years";return{key:e,value:e+" "+d.$translate.instant(n)}})),this.ngRequired=void 0===this.ngRequired||this.ngRequired,this.showEmployerNameTitle=void 0===this.showEmployerNameTitle||this.showEmployerNameTitle,this.showValidationOnLoad=void 0!==this.showValidationOnLoad&&this.showValidationOnLoad,this.isNative=this.EnvironmentService.isNative()}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.stopWatch=this.$scope.$watch((function(){return t.prefillData}),(function(){t.prefillData&&(t.stopWatch(),t.model.employment_status=t.prefillData.employmentStatusCode,t.model.occupation={industry_code:t.prefillData.industryCode,occupation_code:t.prefillData.occupationCode,industry_years:t.industryYearOptions.find((function(e){return e.key===t.prefillData.industryYears}))},t.prefillData.industryCode&&t.prefillData.occupationCode&&(t.model.industry_occupation_code=t.prefillData.industryCode+"-"+t.prefillData.occupationCode),t.ReferenceDataService.getDataByType([t.REF_DATA_TYPES.EMPLOYMENT_STATUSES,t.REF_DATA_TYPES.INDUSTRY_OCCUPATIONS]).then((function(e){return t._afterReferenceDataLoaded(e)})).finally((function(){t.prefillData&&(t.prefillData.employmentStatusCode&&(t.data.employmentStatus=t.EMPLOYMENT_STATUSES.find((function(e){return e.code===t.prefillData.employmentStatusCode}))),t.prefillData.industryCode&&t.industryRequired&&(t.data.industry=t.INDUSTRIES.find((function(e){return e.code===t.prefillData.industryCode}))),t.prefillData.occupationCode&&t.data.industry&&t.occupationRequired&&(t.data.occupation=t.OCCUPATIONS[t.data.industry.code].find((function(e){return e.code===t.prefillData.occupationCode}))),t.data.employerName=t.prefillData.employerName,t.data.industryYears=t.prefillData.industryYears),t._onChange()})))}),!0)}},{key:"$onChanges",value:function(){this._setEmploymentStatus()}},{key:"_setEmploymentStatus",value:function(){this.prefillEmploymentStatuses&&(this.EMPLOYMENT_STATUSES=this.prefillEmploymentStatuses)}},{key:"_afterReferenceDataLoaded",value:function(t){var e=this;this.EMPLOYMENT_STATUSES=this.prefillEmploymentStatuses||t[this.REF_DATA_TYPES.EMPLOYMENT_STATUSES]||this.DEFAULT_EMPLOYMENT_STATUSES,this.INDUSTRIES=t[this.REF_DATA_TYPES.INDUSTRY_OCCUPATIONS],this.OCCUPATIONS={},this.OCCUPATIONS_INDUSTRIES_LINKED=[],this.INDUSTRIES.forEach((function(t){e.OCCUPATIONS[t.code]=t.data,t.data.forEach((function(n){var i={code:t.code+"-"+n.code,name:n.name+" - "+t.name};e.OCCUPATIONS_INDUSTRIES_LINKED.push(i)})),delete t.data})),this.onAfterReferenceDataLoaded&&this.onAfterReferenceDataLoaded({statuses:this.EMPLOYMENT_STATUSES,industries:this.INDUSTRIES,occupations:this.OCCUPATIONS})}},{key:"_onChange",value:function(t){!t&&this.industryRequired||(this.data.occupation=null,this.data.industry=null,this.typeAheadStringValue="",this.preserveEmployerName||(this.data.employerName=""),this.model.occupation||(this.model.occupation={}),this.model.occupation.occupation_code=null,this.model.occupation.industry_code=null),this.onChange({data:this.data})}},{key:"onSelectEmploymentStatus",value:function(t){this.data.employmentStatus=t,this._onChange(t&&-1!==this.employedStatusCodes.indexOf(t.code))}},{key:"onSelectIndustry",value:function(t){this.model.occupation.occupation_code="",this.data.occupation="",this.data.industry=t,this._onChange()}},{key:"onSelectOccupation",value:function(t){this.data.occupation=t,this._onChange()}},{key:"onSelectIndustryOccupation",value:function(t){var e=void 0,n=void 0;try{e=t.code.split("-"),n=t["sanitized-name"]?t["sanitized-name"].split("-"):t.name.split("-")}catch(t){return}this.data.occupation={name:n[0].trim(),code:e[1]},this.data.industry={name:n[1].trim(),code:e[0]},this._onChange()}},{key:"onChangeCoName",value:function(){this._onChange()}},{key:"onChangeIndustryYears",value:function(){this.data.industryYears=this.model.occupation.industry_years.key,this._onChange()}},{key:"industryRequired",get:function(){return!!this.model.employment_status&&this.REQUIRES_OCCUPATION[this.model.employment_status]}},{key:"occupationRequired",get:function(){return this.industryRequired}},{key:"hideIndYearsForEmploymentType",get:function(){return!!this.hideIndustryYearsForEmplStatuses&&this.hideIndustryYearsForEmplStatuses.length>0&&this.hideIndustryYearsForEmplStatuses.indexOf(this.model.employment_status)>=0}}]),t}();o.$inject=["$log","$translate","ccIncomeVerificationConstants","ReferenceDataService","UserSettingsConstants","tngSelectAutocompleteConstants","$scope","EnvironmentService"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(4799)),a=o(n(4803)),s=o(n(4804)),r=o(n(4805));function o(t){return t&&t.__esModule?t:{default:t}}var c=angular.module("tangerine.donations.module",[]).component("tngDonationModal",i.default).constant("DonationConstants",a.default).service("DonationService",s.default).service("DonationFlowService",r.default);e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4800)),a=s(n(4801));function s(t){return t&&t.__esModule?t:{default:t}}n(4802);var r={template:a.default,controller:i.default,bindings:{onClose:"&",donationCampaign:"<",flags:"<?"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(49)),a=c(n(68)),s=c(n(0)),r=c(n(2)),o=c(n(45));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,i,a,r,o,c,l,u,d,h){(0,s.default)(this,t),this.$translate=l,this.$log=e,this.$locale=i,this.$filter=n,this.$stateParams=h,this.donationService=a,this.flowService=r,this.UrlService=u,this.$location=d,this.TILE_TYPE=o.TILE_TYPE,this.TRANSACTION_DATE_FILTER=c.TRANSACTION_DATE_FILTER,this.TRANSACTION_FILTER_TYPES=c.TRANSACTION_FILTER_TYPES,this.FROM_ACCOUNTS=[],this.DONATIONS=[],this.donationsParams={filters:{},loading:!1}}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;this.pageId="donationModal",this.today=(0,o.default)(),this.campaignType=this.$stateParams.donationType,this.isLoading=!0,this.getContent(this.campaignType),this.flowService.activate(),this.donationCampaign||(this.donationCampaign=this.campaignType),this.donationCampaign?this.flowService.donation.transfers.donations_campaign=this.donationCampaign:this.$translate("donations.modal.defaultCampaign").then((function(e){t.flowService.donation.transfers.donations_campaign={name:e}})),this._getAccounts(),this.flowService.onButtonClickCancel=function(){t._close()},this.flowService.onButtonClickDone=function(){t._close()},this.flowService.onButtonClickConfirm=function(){t._submitData()},this.flowService.onButtonClickBack=function(){t.flowService.goBack()},this.flags&&this.flags.showHistory&&(this.goToHistory(),this.flowService.BUTTONS.BTN_GRY.show=!1)}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"_getAccounts",value:function(){var t=this;this.donationService.getAccounts().then((function(e){t.FROM_ACCOUNTS=e})).catch((function(e){t.$log.error("Donations -> getAccounts error message:",e)}))}},{key:"_getDonations",value:function(){var t=this;this.donationsParams.loading=!0,this.donationService.getDonations(this.donationsParams).then((function(e){t.DONATIONS=e,t.donationsParams.loading=!1})).catch((function(e){t.$log.error("Donations -> getDonations error message:",e),t.donationsParams.loading=!1}))}},{key:"_processDonations",value:function(){this.DONATIONS=[],this._getDonations()}},{key:"_buildParams",value:function(t){var e={amount:t.amount};return t.donations_campaign&&t.donations_campaign.type&&(e.donations_campaign=t.donations_campaign.type),{validate_only:!1,transfers:e}}},{key:"_prepareData",value:function(){return{urlVars:{accountHash:this.flowService.donation.selectedAccount.number},data:this._buildParams(this.flowService.donation.transfers)}}},{key:"_submitData",value:function(){var t=this;this.flowService.disableButtons(),this.flowService.resetSubmitErrors(),this.flowService.enterLoadingMode();var e=this._prepareData();this.donationService.createDonation(e).then((function(e){if("CREATED"!==e.response_status.status_code)return t.$log.error("Donation failed:",e),void t._handleErrors(e);t.$log.debug("Donation was accepted:",e),t.flowService.reviewData.confirmationCode=e.confirmation.confirmation_code,t.flowService.exitLoadingMode(),t.flowService.gotoNextState()})).catch((function(e){t.$log.error("Donation was rejected:",e),t._handleErrors(e)}))}},{key:"_handleErrors",value:function(t){this.flowService.enableButtons(),this.flowService.showSubmitErrors(t),this.flowService.exitLoadingMode()}},{key:"_prepareDateFilters",value:function(){var t=this,e=this.TRANSACTION_DATE_FILTER.map((function(e){return{key:e,label:t.$translate.instant("transactions.filters.date."+e)}})),n=new Date,i=[].concat((0,a.default)(new Array(11))).map((function(e,i){var a=(0,o.default)(n).subtract(i+1,"months").toDate();return{dateObject:a,label:t.$filter("date")(a,"MMMM yyyy")}}));return[].concat((0,a.default)(e.slice(0,e.length-1)),(0,a.default)(i),(0,a.default)(e.slice(-1)))}},{key:"_close",value:function(){var t=this;this.flowService.showConfirmExitUI?this.flowService.denyExit():this.flowService.warn().then((function(){t.onClose()}))}},{key:"_setFilter",value:function(t,e){this.donationsParams.filters[t]=e}},{key:"getContent",value:function(t){var e=this;if("STANDARD"===t){this.isLoading=!0;var n=this.$translate.instant("donations.modal.from.messageTemplate");this.donationService.getContent(n).then((function(t){e.text=e.UrlService.fixTrustHtmlRelativeLinks(t),e.isLoading=!1})).catch((function(t){e.$log.error("Unable to get standard content:",t),e.text=e.$translate.instant("donations.modal.from.description"),e.isLoading=!1}))}else if("ALTERNATE"===t){this.isLoading=!0;var i=this.$translate.instant("donations.modal.from.messageTemplateAlt");this.donationService.getContent(i).then((function(t){e.text=e.UrlService.fixTrustHtmlRelativeLinks(t),e.isLoading=!1})).catch((function(t){e.$log.error("Unable to get alternate content:",t),e.text=e.$translate.instant("donations.modal.from.description"),e.isLoading=!1}))}else this.text=this.$translate.instant("donations.modal.from.description"),this.isLoading=!1}},{key:"onModalClose",value:function(){this._close()}},{key:"onFilterChange",value:function(){var t=this.TRANSACTION_FILTER_TYPES.DATE,e=this.selectedTransactionDateFilter;if(angular.isDefined(e.dateObject)){var n=e.dateObject;e=(0,i.default)({dateObject:angular.copy(n)})}else e=e.key;this.$log.debug("changed transaction filters",t,e),this._setFilter(t,e),this._processDonations()}},{key:"goToHistory",value:function(){this.flowService.goToHistory(),this.transactionDateFilters=this._prepareDateFilters(),this.selectedTransactionDateFilter=this.transactionDateFilters[0],this.onFilterChange()}}]),t}();l.$inject=["$log","$filter","$locale","DonationService","DonationFlowService","tngTileListConstants","transactionConstants","$translate","UrlService","$location","$stateParams"],e.default=l,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose(result)" class="c-donation-modal" hide-close="$ctrl.flowService.isLoading" flow-service="$ctrl.flowService"> <div ng-if="$ctrl.isLoading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <header> <span ng-show="$ctrl.flowService.showMainUI">{{$ctrl.flowService.currentState.titleKey | translate}}</span> </header> <div ng-if="$ctrl.flowService.inLoadingMode"> <tng-loading-in-progress ng-if="$ctrl.flowService.isLoading" is-loading-key="donations.modal.loading.isLoading"> </tng-loading-in-progress> <tng-loading-in-progress ng-if="$ctrl.flowService.isDoneLoading" loading-done-key="donations.modal.loading.isDone"> </tng-loading-in-progress> </div> <div ng-if="$ctrl.flowService.showMainUI" class="c-donation-modal__container"> <div class="c-donation-modal__container--medium" ng-if="!$ctrl.isLoading && ($ctrl.flowService.currentState === $ctrl.flowService.STATES.FROM)"> <div ng-bind-html="$ctrl.text"></div> <div class="field" ng-if="!$ctrl.isLoading && $ctrl.FROM_ACCOUNTS.length"> <label>{{ ::(\'donations.modal.from.payFrom.label\' | translate)}}</label> <tng-select-autocomplete ng-if="$ctrl.FROM_ACCOUNTS.length" ng-model="$ctrl.selectedAccount" on-select="$ctrl.flowService.onAccountSelected(option)" options="$ctrl.FROM_ACCOUNTS" option-label-key="label" option-right-label-key="amount" option-value-key="number" placeholder="{{ \'donations.modal.from.payFrom.select\' | translate }}" is-static="true"></tng-select-autocomplete> </div> <div class="field" ng-if="!$ctrl.isLoading"> <label>{{ \'donations.modal.from.amount.label\' | translate}}</label> <tng-amount-input locale="$ctrl.locale" input-type="$ctrl.flowService.donation.amountType" set-value="$ctrl.flowService.donation.transfers.amount" on-amount-change="$ctrl.flowService.onAmountChange(amount);"> </tng-amount-input> </div> <p class="small" ng-if="!$ctrl.isLoading">{{(\'donations.modal.from.footer\' | translate)}}</p> </div> <div class="c-donation-modal__container--medium" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW"> <div ng-show="$ctrl.flowService.submitErrors.length"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.flowService.submitErrors">{{error}}</li> </ul> </tng-error-message> </div> <p ng-bind-html="(\'donations.modal.review.subHeader\' | translate: {amount: $ctrl.flowService.reviewData.amount.amount, paidTo: $ctrl.flowService.reviewData.donationCampaign.name})"></p> <tng-tile-list class="c-donation-modal__single-tile" tile-data="$ctrl.flowService.reviewData.amount" tile-type="$ctrl.TILE_TYPE.amount" is-actionable="true" on-tile-click="$ctrl.flowService.goToStart()"> </tng-tile-list> <tng-tile-list class="c-donation-modal__single-tile" tile-data="$ctrl.flowService.reviewData.account" tile-type="$ctrl.TILE_TYPE.account" is-actionable="true" on-tile-click="$ctrl.flowService.goToStart()"> </tng-tile-list> </div> <div class="c-donation-modal__container--wide" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.CONFIRM"> <p>{{::(\'donations.modal.confirm.subHeader\' | translate)}}</p> <p class="c-donation-modal__donations_campaign">{{$ctrl.flowService.reviewData.donationCampaign.name}}</p> <div class="c-donation-modal__balance-grid c-balance-grid"> <div class="c-balance-grid__table-column-top"> <span ng-bind-html="::\'donations.modal.confirm.confirmationNumber\' | translate : {confirmationNo : $ctrl.flowService.reviewData.confirmationCode}"></span> </div> <div class="c-balance-grid__table"> <div class="c-balance-grid__table__table-column-top"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> {{::\'donations.modal.confirm.amount\' | translate }} </p> <p class="c-balance-grid__value"> {{::$ctrl.flowService.reviewData.amount.amount | currency }} </p> </div> </div> <div class="c-balance-grid__table__table-column-top--has-border-left"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> {{::\'donations.modal.confirm.payFrom\' | translate}} </p> <p class="c-balance-grid__value"> <span class="c-donation-modal__summary-account-name" title="{{$ctrl.flowService.reviewData.account.accountName}}"> {{$ctrl.flowService.reviewData.account.accountName}} </span> {{$ctrl.flowService.reviewData.account.accountNumber | maskNumber}} </p> </div> </div> </div> </div> <p class="c-donation-modal__history-page-paragraph"> <span ng-bind="::(\'donations.modal.confirm.historyPageText1\' | translate)"></span> <strong ng-click="$ctrl.goToHistory()" class="c-donation-modal--link" ng-bind="::(\'donations.modal.confirm.historyPageText2\' | translate)"></strong> </p> <tng-print-button button-class="btn btn--orange c-donation-modal__print">{{ ::\'global.print\' | translate}}</tng-print-button> </div> <div class="c-donation-modal__container--wide" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.HISTORY"> <div class="c-donation-modal__filters"> <div class="field"> <tng-select-autocomplete input-id="{{::$ctrl.pageId}}_dateFilter" options="$ctrl.transactionDateFilters" ng-model="$ctrl.selectedTransactionDateFilter" ng-model-set-raw-object="true" option-label-key="label" on-select="$ctrl.onFilterChange()" is-static="true"></tng-select-autocomplete> </div> </div> <div class="c-transactions-list" ng-if="!$ctrl.donationsParams.loading"> <table class="table table--full" ng-if="$ctrl.DONATIONS.donations.length"> <thead> <tr> <th>{{::(\'donations.modal.history.date\' | translate) }}</th> <th>{{::(\'donations.modal.history.donationFor\' | translate) }}</th> <th class="align-right">{{::(\'donations.modal.history.amount\' | translate)}}</th> </tr> </thead> <tbody> <tr ng-repeat="transaction in $ctrl.DONATIONS.donations | orderBy: \'-date\' track by $index"> <td> <span ng-if="transaction.date === $ctrl.today.format(\'YYYY-MM-DD\')"> {{ ::(\'donations.modal.history.today\' | translate)}} </span> <span ng-if="transaction.date !== $ctrl.today.format(\'YYYY-MM-DD\')"> {{transaction.date}} </span> </td> <td>{{transaction.for}} <div class="table__quiet">{{transaction.to}}</div></td> <td class="align-right">{{transaction.amount | currency}}</td> </tr> </tbody> <tfoot> <tr> <th colspan="2">{{::(\'donations.modal.history.total\' | translate)}}</th> <td class="align-right">{{$ctrl.DONATIONS.total | currency}}</td> </tr> </tfoot> </table> <a actionable-id="donation-no_transaction" class="body--2" ng-show="!$ctrl.DONATIONS.donations.length"> {{ ::(\'donations.modal.history.noTransactions\' | translate)}} </a> </div> <tng-loading-in-progress ng-if="$ctrl.donationsParams.loading" is-loading-key="donations.modal.loading.isLoading"> </tng-loading-in-progress> </div> </div> <footer> <tng-page-flow-controls flow-service="$ctrl.flowService"></tng-page-flow-controls> </footer> </tng-modal-dialog> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={DONATIONS_CAMPAIGN_TYPE:{STANDARD:"STANDARD",ALTNERNATE:"ALTNERNATE"}};e.default=i,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(8)),a=o(n(0)),s=o(n(2)),r=o(n(45));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,s,r,o,c,l,u,d){(0,a.default)(this,t),this.$log=e,this.$q=n,this.$http=i,this.$sce=s,this.$translate=d,this.TransactionsFiltersService=l,this.RequesterService=r,this.serviceConstants=o,this.accountHelpersService=c,this.EnvironmentService=u,this.isMobileNative=u.isNative(),this.staticSiteUrl=u.getBaseUrl(),this.insightsConfig=u.get("insights")}return(0,s.default)(t,[{key:"getAccounts",value:function(){var t=this;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_DONATION_ACCOUNTS).then((function(e){var n=[];return(e.fromAccounts||[]).forEach((function(e){t.accountHelpersService.getDisplayName(e).then((function(a){var s=t.accountHelpersService.getMaskedAccountNumber(e.display_name);(0,i.default)(e,{label:a+" "+s,amount:t.accountHelpersService.getAmountDisplay(e.account_balance,e.currency_type)}),n.push(e)}))})),t.$q.resolve(n)}))}},{key:"getDonations",value:function(t){var e=this;return angular.isDefined(this.DONATIONS)?this.$q.resolve(this.filterDonations(t)):this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_DONATIONS).then((function(n){return e.DONATIONS=n,e.filterDonations(t)}))}},{key:"filterDonations",value:function(t){var e=this.TransactionsFiltersService.filtersToQueryObject(t),n=e.periodFrom,i=e.periodTo;n=(0,r.default)(n).format("YYYY-MM-DD"),i=(0,r.default)(i).format("YYYY-MM-DD");var a=angular.copy(this.DONATIONS)||{};return a.total=0,a.donations=a.donations.filter((function(t){return!!(0,r.default)(t.date).isBetween(n,i,null,"[]")&&(a.total+=parseFloat(t.amount),!0)})),a}},{key:"createDonation",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.CREATE_DONATION,t)}},{key:"getContent",value:function(t){var e=this,n=this.insightsConfig.staticBaseUrl+"/"+t;return this.$http({method:"GET",url:n}).then((function(t){var n="",i=t.data;if(-1===t.data.indexOf("Oops")&&-1===t.data.indexOf("Oups")||(i=e.$translate.instant("donations.modal.from.description")),e.isMobileNative){var a=e.staticSiteUrl+"/";n=i.replace("<!doctype html>","").trim().replace(/href="\//g,'href="'+("/"===e.staticSiteUrl.slice(-1)?e.staticSiteUrl:a)).replace(/href='\//g,"href='"+("/"===e.staticSiteUrl.slice(-1)?e.staticSiteUrl:a))}else n=i.replace("<!doctype html>","").trim();return e.$sce.trustAsHtml(n)})).catch((function(t){return e.$log.error("Unable to get cms content:",t),e.$translate.instant("donations.modal.from.description")}))}}]),t}();c.$inject=["$log","$q","$http","$sce","RequesterService","serviceConstants","AccountHelpersService","TransactionsFiltersService","EnvironmentService","$translate"],e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(177)),a=d(n(0)),s=d(n(2)),r=d(n(264)),o=d(n(266)),c=d(n(265)),l=d(n(267)),u=n(364);function d(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(t,n,s,o,c,l,u,d,h,f,p,g){(0,a.default)(this,e);var m=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,u,d,f));return m.$log=t,m.$translate=l,m.$filter=g,m.accountHelpersService=h,m.serviceConstants=p,m.STATES={FROM:{titleKey:"donations.modal.from.header"},REVIEW:{titleKey:"donations.modal.review.header"},CONFIRM:{titleKey:"donations.modal.confirm.header"},HISTORY:{titleKey:"donations.modal.history.header"}},m.submitErrors=[],m._resetData(),m}return(0,c.default)(e,t),(0,s.default)(e,[{key:"_resetData",value:function(){this.donation={transfers:{amount:{},donations_campaign:null},selectedAccount:null,amountType:"simple"},this.reviewData={amount:null,account:null,confirmationCode:null,donationCampaign:null}}},{key:"_resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.currentState=this.STATES.FROM,this.BUTTONS={BTN_GRY:new u.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new u.ModalFooterButton(this.BUTTON_TYPES.NEXT,!0,!0)},this._resetData()}},{key:"_updateUI",value:function(){switch(this.currentState){case this.STATES.FROM:this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.CANCEL,this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.NEXT,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!this._isFormValid();break;case this.STATES.REVIEW:this._onReviewEnter(),this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.CONFIRM,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!1;break;case this.STATES.CONFIRM:this.hideWarning(),this.BUTTONS.BTN_GRY.show=!1,this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.DONE,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!1;break;case this.STATES.HISTORY:this.hideWarning(),this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_GRY.disable=!1,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.DONE,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!1}}},{key:"onButtonClick",value:function(t){switch(this.$log.log("onButtonClick button:",t),t.type){case this.BUTTON_TYPES.CONFIRM:this.onButtonClickConfirm();break;default:(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"onButtonClick",this).call(this,t)}}},{key:"gotoNextState",value:function(){switch(this.currentState){case this.STATES.FROM:this.moveTo(this.STATES.REVIEW);break;case this.STATES.REVIEW:this.moveTo(this.STATES.CONFIRM)}}},{key:"goToStart",value:function(){this.moveTo(this.STATES.FROM)}},{key:"goToHistory",value:function(){this.moveTo(this.STATES.HISTORY)}},{key:"goBack",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"gotoPreviousState",this).call(this),this.resetSubmitErrors()}},{key:"disableButtons",value:function(){this.BUTTONS.BTN_ORG.disable=!0,this.BUTTONS.BTN_GRY.disable=!0}},{key:"enableButtons",value:function(){this.BUTTONS.BTN_ORG.disable=!1,this.BUTTONS.BTN_GRY.disable=!1}},{key:"_isFormValid",value:function(){return this.accountHelpersService.isAmountValid(this.donation.transfers.amount)&&angular.isObject(this.donation.selectedAccount)}},{key:"_prepareAccount",value:function(t,e){return this.accountHelpersService.getDisplayName(t).then((function(n){return{tileDescription:e,accountName:n,accountNumber:t.display_name,amount:t.account_balance,amountText:t.currency_type,availBalance:t.external_available_balance}}))}},{key:"_onReviewEnter",value:function(){var t=this;this.resetSubmitErrors(),this.reviewData.amount={header:"Amount",amount:this.donation.transfers.amount},this._prepareAccount(this.donation.selectedAccount,"donations.modal.review.transferFrom").then((function(e){t.reviewData.account=e,t.reviewData.availBalance=e.availBalance})),this.reviewData.donationCampaign=this.donation.transfers.donations_campaign}},{key:"onAccountSelected",value:function(t){this.donation.selectedAccount=t;var e=this._isFormValid();this.BUTTONS.BTN_ORG.disable=!e,e?this.showWarning():this.hideWarning()}},{key:"onAmountChange",value:function(t){this.donation.transfers.amount=t;var e=this._isFormValid();this.BUTTONS.BTN_ORG.disable=!e,e?this.showWarning():this.hideWarning()}},{key:"showSubmitErrors",value:function(t){var e=this;if("errorMessage"in t&&this.submitErrors.push(t.errorMessage),t.response_status){if("details"in t.response_status&&t.response_status.details.forEach((function(t){e.submitErrors.push(t)})),"status_code"in t.response_status&&t.response_status.status_code===this.serviceConstants.STATUS_CODES.AVLBALHLD){var n=this.$filter("tngCurrency")(this.reviewData.availBalance||0);this.submitErrors.push(this.$translate.instant("global.errorCodes."+t.response_status.return_code,{availAmount:n}))}else"status_code"in t.response_status&&"SUCCESS"!==t.response_status.status_code&&this.submitErrors.push(this.$translate.instant("global.errorCodes."+t.response_status.return_code));this.$log.debug("formatted error:",this.submitErrors)}}},{key:"resetSubmitErrors",value:function(){this.submitErrors=[]}},{key:"_getAnalyticsID",value:function(){return"donations"}}]),e}(l.default);h.$inject=["$log","$q","$transitions","$state","$window","$translate","$rootScope","pageFlowConstants","AccountHelpersService","AnalyticsService","serviceConstants","$filter"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(4807)),a=u(n(4811)),s=u(n(4815)),r=u(n(4819)),o=u(n(4823)),c=u(n(4824)),l=u(n(4825));function u(t){return t&&t.__esModule?t:{default:t}}var d=angular.module("tangerine.holds.module",[]).component("tngHoldsModal",i.default).component("tngLearnAboutHoldPolicy",a.default).component("tngHoldListContainer",s.default).component("tngDropDownTileHolds",r.default).constant("HoldsConstants",o.default).service("HoldsService",c.default).service("HoldsFlowService",l.default);e.default=d,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4808)),a=s(n(4809));function s(t){return t&&t.__esModule?t:{default:t}}n(4810);var r={template:a.default,controller:i.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f,p,g,m,_,v){(0,i.default)(this,t),this.$q=e,this.$state=n,this.$scope=a,this.$translate=c,this.$log=s,this.$locale=o,this.$filter=r,this.AccountDetailsService=l,this.$stateParams=u,this.HoldsService=d,this.FeedbackSurveyConstants=h,this.FeedbackSurveyService=f,this.flowService=p,this.$cookies=g,this.EnvironmentService=m,this.storageConstants=_,this.StorageService=v}return(0,a.default)(t,[{key:"$onInit",value:function(){this.isLoading=!0,this.accountHolds=[],this.pageId="holdsModal",this.getHolds(),this.HOLDS_MEDALLIA="HOLDS_MEDALLIA",this.cookieExpiration=moment().add(12,"months").toDate()}},{key:"getHolds",value:function(){var t=this;this.HoldsService.getHolds().then((function(e){t.accountHolds=e.holds,t.releaseAmount=e.release_amount,t.fund={hold_fund:e.total_holds_amount,avail_fund:e.total_available_amount},t.isLoading=!1})).catch((function(e){t.isLoading=!1,t._handleError(e)}))}},{key:"onModalClose",value:function(){var t=this;this.onClose(),this.StorageService.getItem(this.storageConstants.KEYS.HOLDS_SESSION).then((function(e){if(!e){t.StorageService.setItem(t.storageConstants.KEYS.HOLDS_SESSION,!0);var n=t.FeedbackSurveyConstants.MEDALLIA_FORM_IDS.HOLDS_DONE_FEEDBACK;t.FeedbackSurveyService.launchFeedbackSurvey(n)}}))}}]),t}();r.$inject=["$q","$state","$scope","$log","$filter","$locale","$translate","AccountDetailsService","$stateParams","HoldsService","FeedbackSurveyConstants","FeedbackSurveyService","HoldsFlowService","$cookies","EnvironmentService","storageConstants","StorageService"],e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose()" actionable-id="holds_modal_close" class="c-holds-modal" analytics-id="holdsModal"> <div ng-if="$ctrl.isLoading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <header ng-if="!$ctrl.isLoading"> <span>{{ ::\'holds.holdsModal.header\' | translate }}</span> </header> <div ng-if="!$ctrl.isLoading" class="medium grid__column--3of4 margin__b--fix2 clearfix"> {{ ::\'holds.holdsModal.description\' | translate }} </div> <section ng-if="!$ctrl.isLoading"> <tng-drop-down-tile-holds fund="$ctrl.fund" account-holds="$ctrl.accountHolds"> </tng-drop-down-tile-holds> </section> <tng-learn-about-hold-policy ng-if="!$ctrl.isLoading" release-amount="$ctrl.releaseAmount" on-close="$ctrl.onClose()"> </tng-learn-about-hold-policy> <footer ng-if="!$ctrl.isLoading"> <button actionable-id="holds_modal_done" class="btn btn--tangerine" ng-click="$ctrl.onModalClose()">{{ ::\'holds.holdsModal.done\' | translate }}</button> </footer> </tng-modal-dialog>'},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4812)),a=s(n(4813));function s(t){return t&&t.__esModule?t:{default:t}}n(4814);var r={template:i.default,controller:a.default,bindings:{releaseAmount:"<",onClose:"&"},transclude:{header:"?dropDownTileHeader",content:"?dropDownTileContent"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-learn-about-hold-policy"> <div class="c-learn-about-hold-policy__container"> <p class="heading--sub2 margin__b--fix2 clearfix"> {{ ::\'holds.learnAboutHoldPolicy.title\' | translate }}</p> <div class="c-learn-about-hold-policy__list-container"> <div class="c-drop-down-tile"> <div class="c-drop-down-tile__header"> <div class="c-drop-down-tile__header-content"> <drop-down-tile-header> {{ \'holds.learnAboutHoldPolicy.reason1.title\' | translate }} </drop-down-tile-header> </div> <span data="1" ng-class="($ctrl.collapseId==1) ? \'icon-uparrow\' : \'icon-downarrow\'" class="arrow" ng-click="$ctrl.dropDownClick($event)"></span> </div> <div class="c-drop-down-tile__content" ng-show="$ctrl.collapseId==1"> <drop-down-tile-content ng-if="!$ctrl.releaseAmount" ng-bind-html="\'holds.learnAboutHoldPolicy.reason1.content1\' | translate"> </drop-down-tile-content> <drop-down-tile-content ng-if="$ctrl.releaseAmount > 0" ng-bind-html="$ctrl.getHoldContentDescription()"> </drop-down-tile-content> </div> </div> <div class="c-drop-down-tile"> <div class="c-drop-down-tile__header"> <div class="c-drop-down-tile__header-content"> <drop-down-tile-header> {{ \'holds.learnAboutHoldPolicy.reason4.title\' | translate }} </drop-down-tile-header> </div> <span data="2" ng-class="($ctrl.collapseId==2) ? \'icon-uparrow\' : \'icon-downarrow\'" class="arrow" ng-click="$ctrl.dropDownClick($event)"></span> </div> <div class="c-drop-down-tile__content" ng-show="$ctrl.collapseId==2"> <drop-down-tile-content ng-bind-html="\'holds.learnAboutHoldPolicy.reason4.content\' | translate"> </drop-down-tile-content> </div> </div> <div class="c-drop-down-tile"> <div class="c-drop-down-tile__header"> <div class="c-drop-down-tile__header-content"> <drop-down-tile-header> {{ \'holds.learnAboutHoldPolicy.reason2.title\' | translate }} </drop-down-tile-header> </div> <span data="3" ng-class="($ctrl.collapseId==3) ? \'icon-uparrow\' : \'icon-downarrow\'" class="arrow" ng-click="$ctrl.dropDownClick($event)"></span> </div> <div class="c-drop-down-tile__content" ng-show="$ctrl.collapseId==3"> <drop-down-tile-content ng-bind-html="\'holds.learnAboutHoldPolicy.reason2.content\' | translate | absoluteHref"> </drop-down-tile-content> </div> </div> <div class="c-drop-down-tile"> <div class="c-drop-down-tile__header"> <div class="c-drop-down-tile__header-content"> <drop-down-tile-header> {{ \'holds.learnAboutHoldPolicy.reason3.title\' | translate }} </drop-down-tile-header> </div> <span data="4" ng-class="($ctrl.collapseId==4) ? \'icon-uparrow\' : \'icon-downarrow\'" class="arrow" ng-click="$ctrl.dropDownClick($event)"></span> </div> <div class="c-drop-down-tile__content" ng-show="$ctrl.collapseId==4"> <drop-down-tile-content> <div ng-bind-html="\'holds.learnAboutHoldPolicy.reason3.content\' | translate"></div> <div ng-bind-html="\'holds.learnAboutHoldPolicy.reason3.subReason1.item\' | translate"></div> <p ng-bind-html="\'holds.learnAboutHoldPolicy.reason3.subReason1.content\' | translate"></p> <div ng-bind-html="\'holds.learnAboutHoldPolicy.reason3.subReason2.item\' | translate"></div> <p ng-bind-html="\'holds.learnAboutHoldPolicy.reason3.subReason2.content\' | translate"></p> <p translate="holds.learnAboutHoldPolicy.reason3.subReason3.bulletItem"></p> </drop-down-tile-content> </div> </div> </div> </div> </div>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.EnvironmentService=e,this.$translate=n,this.stateConstants=a,this.accountConstants=s,this.$state=r}return(0,a.default)(t,[{key:"$onInit",value:function(){this.init=!0,this.tileIndex=0,this.releaseAmount=this.releaseAmount,this.marketingUrl=this.EnvironmentService.getBaseUrl(),this.taxFaqUrl=this.marketingUrl+this.$translate.instant("whyNoTaxReceipts.taxFaqUrl"),this.rspFaqUrl=this.marketingUrl+this.$translate.instant("whyNoTaxReceipts.rspFaqUrl")}},{key:"dropDownClick",value:function(t){this.collapseId=this.collapseId===t.target.attributes.data.value?-1:t.target.attributes.data.value}},{key:"getHoldContentDescription",value:function(){return this.$translate.instant("holds.learnAboutHoldPolicy.reason1.content2",{releaseAmount:this.releaseAmount})}},{key:"getHoldContent1Description",value:function(){return this.$translate.instant("holds.learnAboutHoldPolicy.reason1.content1")}},{key:"goToSavingsAccount",value:function(){this.onClose(),this.$state.go(this.stateConstants.EXISTING_CLIENT_ONBOARDING,{addAccount:this.accountConstants.ACCOUNT_TYPES.SAVINGS})}},{key:"numReasons",get:function(){return 3}}]),t}();r.$inject=["EnvironmentService","$translate","stateConstants","accountConstants","$state"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4816)),a=s(n(4817));function s(t){return t&&t.__esModule?t:{default:t}}n(4818);var r={template:i.default,controller:a.default,bindings:{accountHolds:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-hold-list-container"> <div class="c-hold-list-container__header" ng-show="$ctrl.accountHolds.length > 0"> <div class="c-hold-list-container__container--mobile"> <div class="c-hold-list-container__column heading--sub4"> {{ ::\'accountDetails.chequing.holdsAndOverdraft.availableDate\' | translate }}/<br> {{ ::\'accountDetails.chequing.holdsAndOverdraft.description\' | translate }} </div> <div class="c-hold-list-container__column heading--sub4"> {{ ::\'accountDetails.chequing.holdsAndOverdraft.amountOnHold\' | translate }}/<br> {{ ::\'accountDetails.chequing.holdsAndOverdraft.depositAmount\' | translate }} </div> </div> <div class="c-hold-list-container__container--tablet"> <div class="c-hold-list-container__column heading--sub4"> {{ ::\'accountDetails.chequing.holdsAndOverdraft.depositDate\' | translate }} </div> <div class="c-hold-list-container__column heading--sub4"> {{ ::\'accountDetails.chequing.holdsAndOverdraft.depositAmount\' | translate }} </div> <div class="c-hold-list-container__column heading--sub4"> {{ ::\'accountDetails.chequing.holdsAndOverdraft.amountOnHold\' | translate }} </div> <div class="c-hold-list-container__column heading--sub4"> {{ ::\'accountDetails.chequing.holdsAndOverdraft.availableDate\' | translate }} </div> <div class="c-hold-list-container__column heading--sub4"> {{ ::\'accountDetails.chequing.holdsAndOverdraft.description\' | translate }} </div> </div> </div> <ul class="c-holds-list" ng-show="$ctrl.accountHolds.length > 0"> <li ng-repeat="holds in $ctrl.accountHolds"> <div class="c-holds-list__container--mobile"> <div class="c-holds-list__mobile-row"> <strong> {{ ::\'accountDetails.chequing.holdsAndOverdraft.depositDate\' | translate }} {{ holds.start_date }} </strong> <span ng-show="holds.start_date === $ctrl.today.format(\'YYYY-MM-DD\')"> {{ ::\'accountDetails.chequing.holdsAndOverdraft.today\' | translate }} </span> </div> <div class="c-holds-list__tile"> <div class="c-holds-list__column"> <div><strong>{{ holds.expiry_date }}</strong></div> <div ng-if="holds.description"> {{ holds.description }} </div> </div> <div class="c-holds-list__column"> <div><strong>{{ holds.amount | tngCurrency:$ctrl.account.currency_type }}</strong></div> <div>{{ holds.deposit_amount | tngCurrency:$ctrl.account.currency_type }}</div> </div> </div> </div> <div class="c-holds-list__container--tablet"> <div class="c-holds-list__tile"> <div class="c-holds-list__column">{{ holds.start_date || \'-\' }}</div> <div class="c-holds-list__column">{{ holds.deposit_amount | tngCurrency:$ctrl.account.currency_type }}</div> <div class="c-holds-list__column">{{ holds.amount | tngCurrency:$ctrl.account.currency_type }}</div> <div class="c-holds-list__column">{{ holds.expiry_date || \'-\' }}</div> <div class="c-holds-list__column">{{ holds.description || \'-\' }}</div> </div> </div> </li> </ul> <p class="body--2" ng-if="$ctrl.accountHolds.length === 0"> {{ ::\'holds.holdsModal.noHolds\' | translate }} </p> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(){(0,i.default)(this,t)}return(0,a.default)(t,[{key:"constructorr",value:function(t,e,n,i){this.$translate=i,this.$log=t,this.$locale=n,this.$filter=e}},{key:"$onInit",value:function(){}}]),t}();r.$inject=["$log","$filter","$locale","$translate"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4820)),a=s(n(4821));function s(t){return t&&t.__esModule?t:{default:t}}n(4822);var r={template:i.default,controller:a.default,bindings:{fund:"<",accountHolds:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div ng-if="!$ctrl.isMobileView"> <section class="grid__container"> <div class="c-hold-grid-item"> <div class="c-drop-down-tile-holds"> <div class="c-drop-down-tile-holds__header"> <div class="c-drop-down-tile-holds__header-content"> <drop-down-tile-header> <span class="heading--sub2" ng-bind-html="\'holds.holdsModal.hold_funds\' | translate" translate-cloak> </span> <p class="heading--title2" translate-cloak> {{ ::$ctrl.fund.hold_fund | currency }} </p> </drop-down-tile-header> </div> <span ng-show="$ctrl.fund.hold_fund > 0" ng-class="$ctrl.isExpanded ? \'icon-uparrow\' : \'icon-downarrow\'" class="arrow" ng-click="$ctrl.leftClick()"></span> </div> </div> </div> <div class="c-hold-grid-item"> <div class="c-drop-down-tile-holds"> <div class="c-drop-down-tile-holds__header"> <div class="c-drop-down-tile-holds__header-content"> <drop-down-tile-header> <span class="heading--sub2" ng-bind-html="\'holds.holdsModal.avail_funds\' | translate" translate-cloak> </span> <p class="heading--title2" translate-cloak> {{ ::$ctrl.fund.avail_fund | currency }} </p> </drop-down-tile-header> </div> <span ng-class="$ctrl.isAvailExpanded ? \'icon-uparrow\' : \'icon-downarrow\'" class="arrow" ng-click="$ctrl.rightClick()"></span> </div> </div> </div> </section> <div class="c-drop-down-tile-holds__left-container" ng-show="$ctrl.isExpanded"> <tng-hold-list-container account-holds="$ctrl.accountHolds"> </tng-hold-list-container> </div> <div class="c-drop-down-tile-holds__right-container" ng-show="$ctrl.isAvailExpanded"> <p>{{ ::\'holds.totalAvailableFund.firstPara\' | translate }}</p> <p>{{ ::\'holds.totalAvailableFund.secondPara\' | translate }}</p> <p>{{ ::\'holds.totalAvailableFund.thirdPara\' | translate }}</p> </div> </div> <div ng-if="$ctrl.isMobileView"> <section class="grid__container"> <div class="c-hold-grid-item"> <div class="c-drop-down-tile-holds"> <div class="c-drop-down-tile-holds__header"> <div class="c-drop-down-tile-holds__header-content"> <drop-down-tile-header> <span class="heading--sub2" ng-bind-html="\'holds.holdsModal.hold_funds\' | translate" translate-cloak> </span> <p class="heading--title2" translate-cloak> {{ ::$ctrl.fund.hold_fund | currency }} </p> </drop-down-tile-header> </div> <span ng-show="$ctrl.fund.hold_fund > 0" ng-class="$ctrl.isExpanded ? \'icon-uparrow\' : \'icon-downarrow\'" class="arrow" ng-click="$ctrl.leftClick()"></span> </div> </div> </div> <div class="c-drop-down-tile-holds__left-container" ng-show="$ctrl.isExpanded"> <tng-hold-list-container account-holds="$ctrl.accountHolds"> </tng-hold-list-container> </div> <div class="c-hold-grid-item"> <div class="c-drop-down-tile-holds"> <div class="c-drop-down-tile-holds__header"> <div class="c-drop-down-tile-holds__header-content"> <drop-down-tile-header> <span class="heading--sub2" ng-bind-html="\'holds.holdsModal.avail_funds\' | translate" translate-cloak> </span> <p class="heading--title2" translate-cloak> {{ ::$ctrl.fund.avail_fund | currency }} </p> </drop-down-tile-header> </div> <span ng-class="$ctrl.isAvailExpanded ? \'icon-uparrow\' : \'icon-downarrow\'" class="arrow" ng-click="$ctrl.rightClick()"></span> </div> </div> </div> </section> <div class="c-drop-down-tile-holds__right-container" ng-show="$ctrl.isAvailExpanded"> <p>{{ ::\'holds.totalAvailableFund.firstPara\' | translate }}</p> <p>{{ ::\'holds.totalAvailableFund.secondPara\' | translate }}</p> <p>{{ ::\'holds.totalAvailableFund.thirdPara\' | translate }}</p> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(0)),a=o(n(2)),s=n(1797),r=n(1802);function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,a,s){(0,i.default)(this,t),this.$transclude=e,this.$scope=n,this.$window=a,this.EnvironmentService=s}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.isExpanded=!1,this.isAvailExpanded=!1,this.isMobileView=this.EnvironmentService.isPhoneWindowSize(),this.resizeEventHandler=this.resizeEventListener.bind(this),this.resize$=(0,s.fromEvent)(this.$window,"resize"),this.resizeSubscription=this.resize$.pipe((0,r.debounceTime)(200),(0,r.filter)((function(){return t.hasViewChanged()}))).subscribe(this.resizeEventHandler)}},{key:"resizeEventListener",value:function(){var t=this;this.$scope.$apply((function(){t.isMobileView=t.EnvironmentService.isPhoneWindowSize()}))}},{key:"$onDestroy",value:function(){this.resizeSubscription&&this.resizeSubscription.unsubscribe()}},{key:"hasViewChanged",value:function(){return this.EnvironmentService.isPhoneWindowSize()!==!!this.isMobileView}},{key:"leftClick",value:function(){this.isExpanded=!this.isExpanded,this.isExpanded&&(this.isAvailExpanded=!1)}},{key:"rightClick",value:function(){this.isAvailExpanded=!this.isAvailExpanded,this.isAvailExpanded&&(this.isExpanded=!1)}}]),t}();c.$inject=["$transclude","$scope","$window","EnvironmentService"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.$state=s,this.RequesterService=n,this.serviceConstants=a,this.stateConstants=r,this.flowService=o}return(0,a.default)(t,[{key:"getHolds",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_HOLDS)}}]),t}();r.$inject=["$log","RequesterService","serviceConstants","$state","stateConstants","HoldsFlowService"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(177)),a=c(n(0)),s=c(n(2)),r=c(n(264)),o=c(n(265));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(t,n,s,o,c,l,u,d,h,f){(0,a.default)(this,e);var p=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,u,l,d));return p.$timeout=h,p.EVENTS=l.EVENTS,p.stateConstants=f,p.holdLink=!1,p}return(0,o.default)(e,t),(0,s.default)(e,[{key:"setStates",value:function(t){this.STATES=t}},{key:"_getAnalyticsID",value:function(){return"holds"}}]),e}(c(n(267)).default);l.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","$rootScope","AnalyticsService","$timeout","stateConstants"],e.default=l,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(4827)),a=r(n(4831)),s=r(n(4832));function r(t){return t&&t.__esModule?t:{default:t}}var o=angular.module("tangerine.orderCheques.module",[]).component("tngOrderChequesModal",i.default).constant("OrderChequesModalConstants",a.default).service("OrderChequesFlowService",s.default);e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4828)),a=s(n(4829));function s(t){return t&&t.__esModule?t:{default:t}}n(4830);var r={controller:i.default,template:a.default,bindings:{onClose:"&",accountDetails:"<?",accountHash:"<?"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(104)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s,r,o,c,l,u,d,h,f,p){(0,a.default)(this,t),this.$log=e,this.$timeout=n,this.$translate=i,this.$window=s,this.flowService=r,this.accountDetailsService=o,this.userService=c,this.STATUS_CODES=l.STATUS_CODES,this.TILE_TYPE=u.TILE_TYPE,this.LANGUAGES=d.LANGUAGES,this.pageId=d.PAGE_ID,this.ADDRESS_TYPE=d.ADDRESS_TYPE,this.JOINT_ACCOUNT=d.JOINT_ACCOUNT,this.JOINT_ACCOUNT_FRENCH=d.JOINT_ACCOUNT_FRENCH,this.CHEQUE_ORDER_FEE=d.CHEQUE_ORDER_FEE_TYPE,this.STANDARD_FEE_TYPE=d.STANDARD_FEE_TYPE,this.DEAL_FEE_TYPE=d.DEAL_FEE_TYPE,this.VISIBILITY_TIMEOUT=h.MODAL_VISIBILITY_TIMEOUT,this.$state=f,this.settingsRoute=p.USER_SETTINGS}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;this.accountDetails?this._setupModal():this._getAccountDetails().then((function(){t._setupModal()}))}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"_getAccountDetails",value:function(){var t=this;return this.accountDetailsService.getAccountDetails(this.accountHash,this.ACCOUNT_TYPE).then((function(e){t.accountDetails=e}))}},{key:"_setupModal",value:function(){var t=this;this.customer=null,this.addressList=[],this.printAddress=null,this.confirmationCode=null,this.flowService.activate(),this.flowService.onButtonClickSubmit=function(){t._submitData()},this.flowService.onButtonClickCancel=function(){t._close()},this.flowService.onButtonClickDone=function(){t._close()},this._getUser(),this._getChequeCost()}},{key:"onModalClose",value:function(){this._close()}},{key:"edit",value:function(){this.flowService.moveBackTo(this.flowService.STATES.INFO)}},{key:"onPrintAddressChange",value:function(t){t&&(this.flowService.order.print_address=t,this.printAddress=t&&t.address_line1?[t]:null)}},{key:"_prepareAddressListArray",value:function(){var t=this;this.addressList=this.customer.address_list,this.addressList.forEach((function(e,n){e.uniqueKey="index_"+n,e.address_type===t.ADDRESS_TYPE.HOME?e.display_address_type=t.$translate.instant("accountDetails.chequing.orderCheques.homeAddress"):e.address_type===t.ADDRESS_TYPE.MAILING&&(e.display_address_type=t.$translate.instant("accountDetails.chequing.orderCheques.mailingAddress"))})),this.addressList.push({uniqueKey:"index_"+this.addressList.length,address_type:this.$translate.instant("accountDetails.chequing.orderCheques.doNotPrintMyAddress"),display_address_type:this.$translate.instant("accountDetails.chequing.orderCheques.doNotPrintMyAddress")}),this.selectedKey=this.addressList[0].uniqueKey}},{key:"_getUser",value:function(){var t=this;this.userService.getUserInfo().then((function(e){t.customer=e.customer,t.addressList=e.customer.address_list,t._prepareAddressListArray(),t._prepareData()}))}},{key:"_getChequeCost",value:function(){var t=this;this.accountDetailsService.getFees(this.accountDetails.account_summary.account_number).then((function(e){if(e.standard_fee&&e.standard_fee.length){var n=e.standard_fee.filter((function(e){return e.type===t.CHEQUE_ORDER_FEE}));n.length>0&&(t.ADDITIONAL_CHEQUE_COST=n[0].data.filter((function(e){return e.name===t.STANDARD_FEE_TYPE}))[0].fee,t.CHEQUE_COST=0===n[0].data.filter((function(e){return e.name===t.DEAL_FEE_TYPE}))[0].fee?n[0].data.filter((function(e){return e.name===t.DEAL_FEE_TYPE}))[0].fee:t.ADDITIONAL_CHEQUE_COST,0===t.CHEQUE_COST&&(t.ADDITIONAL_CHEQUE_COST=t.CHEQUE_COST))}"NSFCORD"===e.response_status.return_code&&(t.$log.error("Error in response - NSFCORD ",e.response_status),t.flowService.BUTTONS.BTN_ORG.disable=!0,t.flowService.showSubmitErrors(e))}))}},{key:"_prepareData",value:function(){var t=this.flowService,e=this.customer,n=this.accountDetails;t.order.accountHash=n.account_summary.account_number,t.order.name=this._removeSalutation(n.account_summary.primary_account_holder),n.account_summary.account_registration!==this.JOINT_ACCOUNT&&n.account_summary.account_registration!==this.JOINT_ACCOUNT_FRENCH||(t.order.joint_name=this._removeSalutation(n.account_summary.secondary_account_holder)),t.order.accountNumber=n.account_summary.display_name,t.order.language=e.langauge,this.homeAddress=this.getAddressByType(this.ADDRESS_TYPE.HOME);var a=(0,i.default)(this.homeAddress,1);t.order.print_address=a[0],this.printAddress=this.homeAddress,this.mailingAddress=this.getAddressByType(this.ADDRESS_TYPE.MAILING),this.onPrintAddressChange(t.order.print_address)}},{key:"_removeSalutation",value:function(t){var e=["Mr","Mr.","Ms","Mrs","Mrs.","Miss","Miss.","Dr","Dr.","Rev","Fr","M","Mlle","Mme.","Mme","Rv","or"];return t.split(" ").filter((function(t){return e.indexOf(t)<0})).join(" ")}},{key:"getAddressByType",value:function(t){return this.customer.address_list.filter((function(e){return e.address_type===t}))}},{key:"_submitData",value:function(){var t=this,e=this.flowService,n=this.$log;this.confirmationCode=null,e.BUTTONS.BTN_ORG.disable=!0,e.enterLoadingMode();var i=[this.STATUS_CODES.SUCCESS,this.STATUS_CODES.CREATED];e.order.print_address.address_type===this.$translate.instant("accountDetails.chequing.orderCheques.doNotPrintMyAddress")&&delete e.order.print_address,this.accountDetailsService.orderCheques(e.order).then((function(a){if(n.debug("order cheques request response: ",a),-1===i.indexOf(a.response_status.status_code))return n.error("Close account transaction failed",a),e.showSubmitErrors(a),void e.exitLoadingMode();e.showLoadingDoneIcon(),t.confirmationCode=a.confirmations.confirmation_code,t.feeAmount=a.confirmations.fee_amount,t.start_cheque_number=a.confirmations.start_cheque_number,t.$timeout((function(){e.exitLoadingMode(),e.gotoNextState()}),t.VISIBILITY_TIMEOUT)})).catch((function(t){n.error("order cheques error:",t),e.showSubmitErrors(t),e.exitLoadingMode()}))}},{key:"moveToSettings",value:function(){this.$state.go(this.settingsRoute)}},{key:"_close",value:function(){var t=this;this.flowService.showConfirmExitUI?this.flowService.denyExit():this.flowService.warn().then((function(){t.onClose()}))}}]),t}();o.$inject=["$log","$timeout","$translate","$window","OrderChequesFlowService","AccountDetailsService","UserService","serviceConstants","tngTileListConstants","OrderChequesModalConstants","pageFlowConstants","$state","stateConstants"],e.default=o,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog class="c-order-cheques" on-close="$ctrl.onModalClose()" hide-close="$ctrl.flowService.isLoading" flow-service="$ctrl.flowService"> <header> <span ng-show="$ctrl.flowService.showMainUI" id="chequing-orderCheques-title">{{ $ctrl.flowService.currentState.titleKey | translate }}</span> </header> <div ng-if="$ctrl.flowService.inLoadingMode"> <tng-loading-in-progress ng-show="$ctrl.flowService.isLoading"></tng-loading-in-progress> <tng-loading-done ng-show="$ctrl.flowService.isDoneLoading"></tng-loading-done> </div> <div ng-if="$ctrl.flowService.showMainUI"> <div ng-show="$ctrl.flowService.submitErrors.length"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.flowService.submitErrors">{{error}}</li> </ul> </tng-error-message> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.INFO"> <span ng-if="$ctrl.CHEQUE_COST === 0"> <p class="c-order-cheques__sub-header" id="chequing-orderCheques-infoDisclaimer1" ng-bind-html="\'accountDetails.chequing.orderCheques.infoDisclaimerFirstTime\' | translate"></p> </span> <span ng-if="$ctrl.CHEQUE_COST > 0"> <p class="c-order-cheques__sub-header" id="chequing-orderCheques-infoDisclaimer2" ng-bind-html="\'accountDetails.chequing.orderCheques.infoDisclaimerOngoing\' | translate : {\n                  amount: $ctrl.CHEQUE_COST,\n                  accountName: $ctrl.accountDetails.account_summary.account_nick_name,\n                  accountNumber: $ctrl.accountDetails.account_summary.display_name\n              }"></p> </span> <p class="c-order-cheques__sub-header" ng-bind-html="\'accountDetails.chequing.orderCheques.infoDisclaimer2\' | translate"></p> <div class="grid__column--1of2"> <div class="field"> <label> {{::\'accountDetails.chequing.orderCheques.namesOnCheque\' | translate}} </label> <input class="input c-order-cheques__names-on-cheque" type="text" actionable-id="{{::$ctrl.pageId}}_namesOnCheque" disabled="disabled" ng-model="$ctrl.flowService.order.name"> </div> <div class="field" ng-if="$ctrl.flowService.order.joint_name"> <input class="input c-order-cheques__names-on-cheque" type="text" disabled="disabled" actionable-id="{{::$ctrl.pageId}}_jointName" ng-model="$ctrl.flowService.order.joint_name"> </div> <div class="field"> <label> {{::\'accountDetails.chequing.orderCheques.mailChequeTo\' | translate}} </label> <tng-tile-list address-tile-id="chequing-orderCheques-mailingAddress" tile-data="$ctrl.mailingAddress" tile-type="$ctrl.TILE_TYPE.address"></tng-tile-list> </div> <div class="field"> <label> {{::\'accountDetails.chequing.orderCheques.chequeLanguage\' | translate}} </label> <div class="field__group--inline"> <div class="field"> <input actionable-id="{{::$ctrl.pageId}}_{{$ctrl.LANGUAGES.ENGLISH.KEY}}" value="{{ ::$ctrl.LANGUAGES.ENGLISH.KEY }}" name="language" class="input input--tangerine-radio" ng-model="$ctrl.flowService.order.language" type="radio"/> <label for="{{::$ctrl.pageId}}_{{$ctrl.LANGUAGES.ENGLISH.KEY}}" id="chequing-orderCheques-chequeLanguage-english"> {{::$ctrl.LANGUAGES.ENGLISH.TRANSLATION | translate}} </label> </div> <div class="field"> <input actionable-id="{{::$ctrl.pageId}}_{{$ctrl.LANGUAGES.FRENCH.KEY}}" value="{{ ::$ctrl.LANGUAGES.FRENCH.KEY }}" name="language" class="input input--tangerine-radio" ng-model="$ctrl.flowService.order.language" type="radio"/> <label for="{{::$ctrl.pageId}}_{{$ctrl.LANGUAGES.FRENCH.KEY}}" id="chequing-orderCheques-chequeLanguage-french"> {{::$ctrl.LANGUAGES.FRENCH.TRANSLATION | translate}} </label> </div> </div> </div> <div class="field"> <label> {{::\'accountDetails.chequing.orderCheques.selectPrintAddress\' | translate}} </label> <div class="field c-order-cheques__field-above-space"> <tng-select-autocomplete input-id="chequing-orderCheques-selectPrintAddress" ng-model="$ctrl.selectedKey" options="$ctrl.addressList" option-label-key="display_address_type" option-value-key="uniqueKey" on-select="$ctrl.onPrintAddressChange(option)"> </tng-select-autocomplete> </div> </div> <div class="field" ng-if="$ctrl.printAddress"> <tng-tile-list address-tile-id="chequing-orderCheques-printAddress" tile-data="$ctrl.printAddress" tile-type="$ctrl.TILE_TYPE.address"></tng-tile-list> </div> </div> <p class="c-order-cheques__footer"> <span translate="accountDetails.chequing.orderCheques.footer1"> </span> <span translate="global.commonWords.clickMe" class="c-order-cheques__footer__link body--callout" ng-click="$ctrl.moveToSettings()"> </span><span translate="accountDetails.chequing.orderCheques.footer2"> </span> </p> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW"> <div ng-show="$ctrl.flowService.submitErrors.length"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.flowService.submitErrors">{{error}}</li> </ul> </tng-error-message> </div> <span ng-if="$ctrl.CHEQUE_COST > 0"> <p class="c-order-cheques__sub-header" id="chequing-orderCheques-reviewSubHeader" ng-bind-html="\'accountDetails.chequing.orderCheques.reviewSubHeader\' | translate : {\n                  amount: $ctrl.CHEQUE_COST,\n                  accountName: $ctrl.accountDetails.account_summary.account_nick_name,\n                  accountNumber: $ctrl.accountDetails.account_summary.display_name\n              }"></p> </span> <div class="c-order-cheques__table-holder"> <table class="table table--full c-order-cheques__review-table"> <tbody> <tr> <td> <span class="c-order-cheques__review-table__header" id="chequing-orderCheques-account"> {{::\'accountDetails.chequing.orderCheques.account\'|translate}} </span> </td> <td> <span class="c-order-cheques__review-table__value"> {{$ctrl.accountDetails.account_summary.account_nick_name}} {{$ctrl.accountDetails.account_summary.display_name | maskNumber}} </span> </td> </tr> <tr> <td> <span class="c-order-cheques__review-table__header" id="chequing-orderCheques-namesOnCheque"> {{::\'accountDetails.chequing.orderCheques.namesOnCheque\'|translate}} </span> </td> <td> <span class="c-order-cheques__review-table__value"> {{$ctrl.flowService.order.name}} <span ng-if="$ctrl.flowService.order.joint_name"> , {{$ctrl.flowService.order.joint_name}} </span> </span> </td> </tr> <tr ng-if="$ctrl.flowService.order.print_address"> <td> <span class="c-order-cheques__review-table__header" id="chequing-orderCheques-selectedPrintAddress"> {{::\'accountDetails.chequing.orderCheques.selectedPrintAddress\'|translate}} </span> </td> <td> <div class="c-order-cheques__review-table__value"> <span ng-if="$ctrl.printAddress"> <span ng-if="$ctrl.printAddress[0].suite">{{ $ctrl.printAddress[0].suite }}-</span>{{$ctrl.printAddress[0].address_line1}}<br> <span ng-if="$ctrl.printAddress[0].address_line2">{{ $ctrl.printAddress[0].address_line2 }}<br></span> {{ $ctrl.printAddress[0].city }}, {{ $ctrl.printAddress[0].province }}<br> {{ $ctrl.printAddress[0].country}}, {{ $ctrl.printAddress[0].postal_code}} </span> </div> </td> </tr> <tr> <td> <span class="c-order-cheques__review-table__header" id="chequing-orderCheques-mailingChequeTo"> {{::\'accountDetails.chequing.orderCheques.mailingChequeTo\'|translate}} </span> </td> <td> <span class="c-order-cheques__review-table__value"> <span ng-if="$ctrl.mailingAddress[0].suite">{{ $ctrl.mailingAddress[0].suite }}-</span>{{$ctrl.mailingAddress[0].address_line1}}<br> <span ng-if="$ctrl.mailingAddress[0].address_line2">{{ $ctrl.mailingAddress[0].address_line2 }}<br></span> {{ $ctrl.mailingAddress[0].city }}, {{ $ctrl.mailingAddress[0].province }}<br> {{ $ctrl.mailingAddress[0].country}}, {{ $ctrl.mailingAddress[0].postal_code}} </span> </td> </tr> <tr> <td> <span class="c-order-cheques__review-table__header" id="chequing-orderCheques-printMyChequeIn"> {{::\'accountDetails.chequing.orderCheques.printMyChequeIn\'|translate}} </span> </td> <td> <span class="c-order-cheques__review-table__value"> {{\'global.language.\' + $ctrl.flowService.order.language | translate}} </span> </td> </tr> </tbody> </table> <button actionable-id="{{::$ctrl.pageId}}_editButton" class="btn--edit" ng-click="$ctrl.edit()">{{::\'global.components.buttons.edit\'|translate}} </button> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.CONFIRMATION" class="c-order-cheques__confirmation"> <p class="c-order-cheques__sub-header" ng-bind-html="\'accountDetails.chequing.orderCheques.confirmationSubHeader\' | translate : {\n                amount: $ctrl.feeAmount,\n                accountName: $ctrl.accountDetails.account_summary.account_nick_name,\n                accountNumber: $ctrl.accountDetails.account_summary.display_name\n            }"></p> <div class="c-balance-grid" id="printMe"> <div class="c-balance-grid__table-column-top"> <span id="chequing-orderCheques-confirmationNumber" ng-bind-html="::\'accountDetails.chequing.orderCheques.confirmationNumber\' | translate : {confirmationNo : $ctrl.confirmationCode}"></span> </div> <div class="c-balance-grid__table"> <div class="c-balance-grid__table__table-column-top"> <div class="c-balance-grid__section" id="chequing-orderCheques-confirmationPrintLanguage"> <p class="c-balance-grid__title"> {{::\'accountDetails.chequing.orderCheques.confirmationPrintLanguage\' | translate }} </p> <p class="c-balance-grid__value language"> {{::\'global.language.\'+$ctrl.flowService.order.language | translate }} </p> </div> </div> <div class="c-balance-grid__table__table-column-top has-left-border"> <div class="c-balance-grid__section" id="chequing-orderCheques-confirmationMailTo"> <p class="c-balance-grid__title"> {{::\'accountDetails.chequing.orderCheques.confirmationMailTo\' | translate}} </p> <p class="c-balance-grid__value address"> <span ng-if="$ctrl.mailingAddress[0].suite">{{ $ctrl.mailingAddress[0].suite }}-</span>{{$ctrl.mailingAddress[0].address_line1}}<br> <span ng-if="$ctrl.mailingAddress[0].address_line2">{{ $ctrl.mailingAddress[0].address_line2 }}<br></span> {{ $ctrl.mailingAddress[0].city }}, {{ $ctrl.mailingAddress[0].province }}<br> {{ $ctrl.mailingAddress[0].country}}, {{ $ctrl.mailingAddress[0].postal_code}} </p> </div> </div> </div> <div class="c-balance-grid__table cheque-preview"> <div class="c-balance-grid__table__table-column-top"> <div class="c-balance-grid__section" id="chequing-orderCheques-confirmationPreview"> <p class="c-balance-grid__title"> {{::\'accountDetails.chequing.orderCheques.confirmationPreview\' | translate}} </p> <div class="c-balance-grid__value c-order-cheques__cheque-preview"> <img class="c-order-cheques__cheque-preview__image" ng-src="assets/images/cheque_OrderCheque.svg"> <div class="c-order-cheques__cheque-preview__details"> <div class="c-order-cheques__cheque-preview__name">{{ $ctrl.flowService.order.name }}</div> <div class="c-order-cheques__cheque-preview__name" ng-if="$ctrl.flowService.order.joint_name"> {{ $ctrl.flowService.order.joint_name }} </div> <br ng-if="!$ctrl.flowService.order.joint_name"> <div class="c-order-cheques__cheque-preview__address" ng-if="$ctrl.printAddress"> <span ng-if="$ctrl.printAddress[0].suite">{{ $ctrl.printAddress[0].suite }}-</span>{{ $ctrl.printAddress[0].address_line1 }} <span ng-if="$ctrl.printAddress[0].address_line2">{{ $ctrl.printAddress[0].address_line2 }}</span><br> {{ $ctrl.printAddress[0].city }}, {{ $ctrl.printAddress[0].province }} {{ $ctrl.printAddress[0].postal_code }} </div> </div> <p class="c-order-cheques__cheque-preview__details-footer"> <span class="c-order-cheques__cheque-preview__number">{{::\'accountDetails.chequing.orderCheques.previewSerialNumber\' | translate }}</span> <span class="c-order-cheques__cheque-preview__number">{{::\'accountDetails.chequing.orderCheques.previewTransitNumber\' | translate }}</span> <span class="c-order-cheques__cheque-preview__number">{{::\'accountDetails.chequing.orderCheques.previewInstitutionNumber\' | translate }}</span> <span class="c-order-cheques__cheque-preview__number">{{ $ctrl.flowService.order.accountNumber }}</span> </p> </div> </div> </div> </div> <tng-print-button actionable-id="{{::$ctrl.pageId}}_printButton" button-class="btn btn--orange c-close-account-modal__print" only-element="\'printMe\'">{{ ::\'global.print\' | translate}} </tng-print-button> </div> </div> </div> <footer> <tng-page-flow-controls flow-service="$ctrl.flowService"></tng-page-flow-controls> </footer> </tng-modal-dialog> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(199),s=(i=a)&&i.__esModule?i:{default:i};var r={LANGUAGES:s.default.API.COMMUNICATION.LANGUAGES,ADDRESS_TYPE:s.default.API.ADDRESS_TYPE,JOINT_ACCOUNT:"Joint",JOINT_ACCOUNT_FRENCH:"Conjoint",PAGE_ID:"orderChequesModal",CHEQUE_ORDER_FEE_TYPE:"CHEQUE_ORDER",DEAL_FEE_TYPE:"Deal",STANDARD_FEE_TYPE:"Standard"};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(177)),a=d(n(0)),s=d(n(2)),r=d(n(264)),o=d(n(266)),c=d(n(265)),l=d(n(267)),u=n(364);function d(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(t,n,s,o,c,l,u,d,h,f,p){(0,a.default)(this,e);var g=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,u,d,p));return g.$translate=l,g.serviceConstants=f,g.WHEN=h.WHEN,g.FREQUENCY=h.FREQUENCY,g.STATES={INFO:{titleKey:"accountDetails.chequing.orderCheques.infoHeader"},REVIEW:{titleKey:"accountDetails.chequing.orderCheques.reviewHeader"},CONFIRMATION:{titleKey:"accountDetails.chequing.orderCheques.confirmationHeader"}},g}return(0,c.default)(e,t),(0,s.default)(e,[{key:"_resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.submitErrors=[],this.isLoading=!1,this.doneLoading=!1,this.currentState=this.STATES.INFO,this.order={accountHash:null,name:null,joint_name:null,language:null,mailing_address:null,print_address:null},this.BUTTONS={BTN_GRY:new u.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new u.ModalFooterButton(this.BUTTON_TYPES.NEXT,!0,!1)}}},{key:"_updateUI",value:function(){switch(this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_GRY.disable=!1,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!1,this.currentState){case this.STATES.INFO:this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.CANCEL,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.NEXT;break;case this.STATES.REVIEW:this.BUTTONS.BTN_GRY.show=!1,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.SUBMIT;break;case this.STATES.CONFIRMATION:this.hideWarning(),this.BUTTONS.BTN_GRY.show=!1,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!1,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.DONE}}},{key:"gotoNextState",value:function(){switch(this.currentState){case this.STATES.INFO:this.moveTo(this.STATES.REVIEW);break;case this.STATES.REVIEW:this.moveTo(this.STATES.CONFIRMATION)}}},{key:"showSubmitErrors",value:function(t){var e=this;this.serviceConstants.RESPONSE_ERRORS.ERROR_MESSAGE in t&&this.submitErrors.push(t.errorMessage),this.serviceConstants.RESPONSE_ERRORS.DETAILS in t.response_status&&t.response_status.details.forEach((function(t){e.submitErrors.push(t.technical_description)})),this.serviceConstants.RESPONSE_ERRORS.STATUS_CODE in t.response_status&&t.response_status.status_code!==this.serviceConstants.STATUS_CODES.SUCCESS&&this.submitErrors.push(this.$translate.instant("global.errorCodes."+t.response_status.return_code)),this.$log.debug("formatted error:",this.submitErrors)}},{key:"resetSubmitErrors",value:function(){this.submitErrors=[]}},{key:"moveBackTo",value:function(t){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"moveBackTo",this).call(this,t),this.resetSubmitErrors()}},{key:"_getAnalyticsID",value:function(){return"cheques/order"}}]),e}(l.default);h.$inject=["$log","$q","$transitions","$state","$window","$translate","$rootScope","pageFlowConstants","timeStateConstants","serviceConstants","AnalyticsService"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4834)),a=s(n(4838));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("tangerine.app.core.components.bankCardActivateDialog",[]).component("tngBankCardActivateDialog",i.default).service("BankCardActivateDialogFlowService",a.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4835)),a=s(n(4836));function s(t){return t&&t.__esModule?t:{default:t}}n(4837);var r={template:i.default,controller:a.default,bindings:{activateCard:"<?",onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose()" class="c-bank-card-activate-dialog" analytics-id="bank-card-activate" hide-close="$ctrl.flowService.isLoading"> <header> {{ $ctrl.flowService.currentState.titleKey | translate }} </header> <div ng-if="!$ctrl.flowService.showConfirmExitUI" class="c-security-settings"> <div ng-if="$ctrl.flowService.errors.length > 0"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.flowService.errors">{{error}}</li> </ul> </tng-error-message> </div> <div ng-show="$ctrl.flowService.isLoading"> <tng-settings-edit-modal-loading> </tng-settings-edit-modal-loading> </div> <div ng-hide="$ctrl.flowService.isLoading"> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.ENTRY"> <form name="$ctrl.activateForm" autocomplete="off"> <div class="c-bank-card-activate-dialog__body"> <p class="c-bank-card-activate-dialog__intro"> {{ \'global.modals.activateDebitDialog.intro\' | translate }} </p> <p class="c-bank-card-activate-dialog__last-digits"> {{ \'global.modals.activateDebitDialog.lastDigits\' | translate }} </p> <input class="c-bank-card-activate-dialog__input input" placeholder="{{ ::(\'global.modals.activateDebitDialog.placeholder\' | translate) }}" ng-model="$ctrl.lastDigits" ng-pattern="/[0-9]{2}/" ng-keypress="$ctrl.onKeyPress($event)" ng-change="$ctrl.onLastDigitsChange()" maxlength="2" minlength="2" name="lastDigits" type="tel" required/> </div> </form> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DONE"> <div class="c-bank-card-activate-dialog__body"> <p class="c-bank-card-activate-dialog__intro"> {{ \'global.modals.activateDebitDialog.successIntro\' | translate }} </p> </div> </div> </div> </div> <footer ng-show="!$ctrl.flowService.showConfirmExitUI"> <button actionable-id="bank-card-cancel-btn" class="btn btn--edit" ng-class="{\'CB_ReadOnly\': $ctrl.flowService.CB_DISABLED_BUTTONS.includes($ctrl.flowService.BUTTONS.BTN_ORG.type)}" ng-click="$ctrl.flowService.onButtonClick($ctrl.flowService.BUTTONS.BTN_GRY)" ng-show="$ctrl.flowService.BUTTONS.BTN_GRY.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_GRY.disable"> {{ $ctrl.flowService.BUTTONS.BTN_GRY.type.label | translate }} </button> <button actionable-id="bank-card-next-btn" class="btn btn--orange" ng-class="{\'CB_ReadOnly\': $ctrl.flowService.CB_DISABLED_BUTTONS.includes($ctrl.flowService.BUTTONS.BTN_ORG.type)}" ng-click="$ctrl.flowService.onButtonClick($ctrl.flowService.BUTTONS.BTN_ORG)" ng-show="$ctrl.flowService.BUTTONS.BTN_ORG.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_ORG.disable"> {{ $ctrl.flowService.BUTTONS.BTN_ORG.type.label | translate }} </button> </footer> <footer ng-show="$ctrl.flowService.showConfirmExitUI"> <button actionable-id="bank-card-cancel-btn" class="btn btn--edit" ng-click="$ctrl.flowService.denyExit()"> {{ \'global.pageFlow.buttons.cancel\' | translate }} </button> <button actionable-id="bank-card-exit-btn" class="btn btn--tangerine" ng-click="$ctrl.flowService.allowExit()"> {{ \'global.pageFlow.buttons.exit\' | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.$log=e,this.flowService=n,this.resetPinConstants=a,this.debitCardList=[],this.nonActivatedCardList=[],this.lastDigits=""}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.flowService.activate(),this.flowService.getCustomerCards(this.activateCard).then((function(){t.flowService.onButtonClickCancel=function(){t.onModalClose()},t.flowService.onButtonClickDone=function(){t.onModalClose()}}))}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"onModalClose",value:function(t){this.$log.debug("Activate bank card onModalClose:",t),this.onClose({cardActivated:this.flowService.cardActivated})}},{key:"onKeyPress",value:function(t){(t.charCode<this.resetPinConstants.ASCII_CHARS.DIGIT_0||t.charCode>this.resetPinConstants.ASCII_CHARS.DIGIT_9)&&t.keyCode!==this.resetPinConstants.ASCII_CHARS.BACKSPACE&&t.keyCode!==this.resetPinConstants.ASCII_CHARS.DELETE&&t.preventDefault()}},{key:"onLastDigitsChange",value:function(){this.flowService.findMatchingCard(this.lastDigits),this.flowService.BUTTONS.BTN_ORG.disable=this.twoDigitInputIsInvalid}},{key:"matchingCard",get:function(){return this.flowService.cardToActivate}},{key:"twoDigitInputIsInvalid",get:function(){return this.activateForm.lastDigits.$dirty&&(this.activateForm.lastDigits.$invalid||!this.matchingCard)}},{key:"cardNotFound",get:function(){return this.activateForm.lastDigits.$dirty&&this.activateForm.lastDigits.$valid&&!this.matchingCard}}]),t}();r.$inject=["$log","BankCardActivateDialogFlowService","resetPinConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(177)),a=u(n(0)),s=u(n(2)),r=u(n(264)),o=u(n(266)),c=u(n(265)),l=n(267);function u(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(t,n,s,o,c,l,u,d,h,f,p,g,m,_,v){(0,a.default)(this,e);var S=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,l,u,d));return S.$translate=h,S.CustomersService=f,S.CardsService=g,S.customerConstants=p,S.serviceConstants=m,S.UserSettingsConstants=_,S.EventBusService=v,S.STATES={ENTRY:{titleKey:"global.modals.activateDebitDialog.title"},DONE:{titleKey:"global.modals.activateDebitDialog.successTitle"}},S._initialState=S.STATES.ENTRY,S.errors=[],S.debitCardList=[],S.nonActivatedCardList=[],S.cardToActivate=null,S.ERROR_CODES={CRDCIFREST:"CRDCIFREST"},S.cardActivated=!1,S}return(0,c.default)(e,t),(0,s.default)(e,[{key:"_resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.BUTTONS={BTN_GRY:new l.PageFlowButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new l.PageFlowButton(this.BUTTON_TYPES.SUBMIT,!0,!0)},this.errors=[],this.debitCardList=[],this.nonActivatedCardList=[],this.cardToActivate=null,this.cardActivated=!1}},{key:"gotoNextState",value:function(){switch(this.currentState){case this.STATES.ENTRY:this.moveTo(this.STATES.DONE)}}},{key:"_updateUI",value:function(){switch(this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_GRY.disable=!1,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!0,this.currentState){case this.STATES.ENTRY:this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.CANCEL,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.SUBMIT;break;case this.STATES.DONE:this.BUTTONS.BTN_GRY.show=!1,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.DONE,this.BUTTONS.BTN_ORG.disable=!1}}},{key:"onButtonClickSubmit",value:function(){this._submitActivateCard()}},{key:"getCustomerCards",value:function(t){var e=this;return this.enterLoadingMode(),this.CustomersService.getCustomerCards().then((function(n){e.debitCardList=e.CardsService.extractDebitCards(n.cards),e.debitCardList.forEach((function(n){n.status!==e.customerConstants.API.CARD.STATUS.NOT_ACTIVATED.KEY||t&&t!==n.number||e.nonActivatedCardList.push(n)}))})).catch((function(t){e.$log.error(t),e.errors.push(t)})).finally((function(){e.exitLoadingMode()}))}},{key:"_submitActivateCard",value:function(){var t=this;this.errors=[],this.enterLoadingMode(),this.CardsService.activateDebitCard(this.cardToActivate,this.lastDigits).then((function(e){if(!t._isSuccessResponse(e)){if(e.response_status&&e.response_status.return_code===t.ERROR_CODES.CRDCIFREST)throw t.$translate.instant("global.errorCodes.generic");throw e.response_status&&e.response_status.return_code===t.serviceConstants.STATUS_CODES.INVALID&&"details"in e.response_status&&Array.isArray(e.response_status.details)&&e.response_status.details.forEach((function(e){if(e.field_name&&0===e.field_name.indexOf("last_digits_on_card"))throw t.$translate.instant("global.errorCodes.CRDVALFAIL")})),t.$translate.instant("global.errorCodes.CLIENT_CARD_ACTIVATION")}t.cardActivated=!0,t.gotoNextState(),t._updateCustomerData()})).catch((function(e){t._processError(e)})).finally((function(){t.exitLoadingMode()}))}},{key:"_updateCustomerData",value:function(){this.EventBusService.publish(this.UserSettingsConstants.EVENTS.CARD_REPLACEMENT_DATA_INVALIDATED,[this.UserSettingsConstants.DATA_TYPES.CUSTOMER_CARDS])}},{key:"_isSuccessResponse",value:function(t){return t.response_status&&["CREATED","SUCCESS"].indexOf(t.response_status.status_code)>=0}},{key:"_processError",value:function(t){this.$log.error(t),this.errors.push(t)}},{key:"findMatchingCard",value:function(t){this.lastDigits=t,this.cardToActivate=this.nonActivatedCardList.length>0?this.nonActivatedCardList[0]:void 0}},{key:"_hasLast2Digits",value:function(t,e){var n=t.display_name.slice(-2);return n||(n=t.number.substring(t.number.length-6,t.number.length-4)),n===e}}]),e}(u(l).default);d.$inject=["$log","$q","$transitions","$state","$window","$rootScope","pageFlowConstants","AnalyticsService","$translate","CustomersService","customerConstants","CardsService","serviceConstants","UserSettingsConstants","EventBusService"],e.default=d,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(1817);var i=s(n(4840)),a=s(n(4843));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("tangerine.phoneInputModule",["ui.utils.masks"]).component("tngPhoneInput",i.default).directive("phoneInput",a.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4841)),a=s(n(4842));function s(t){return t&&t.__esModule?t:{default:t}}var r={template:i.default,controller:a.default,require:{form:"?^form"},bindings:{onUpdate:"&",onViewValueChanged:"&?",ngRequired:"<?",ngDisabled:"<?",ngReadonly:"<?",ngModel:"=",customErrorMsg:"@",inputName:"@",onChangeEmptyAllowed:"&?",showValidationOnLoad:"<?",validationOrder:"@?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<ng-form name="phoneInputForm"> <div class="field"> <input class="input" type="tel" actionable-id="{{ $ctrl.inputName }}" validation-order="{{$ctrl.validationOrder}}_1" ng-model="$ctrl.ngModel" maxlength="14" phone-input ui-us-phone-number ng-disabled="$ctrl.ngDisabled" ng-required="$ctrl.ngRequired" ng-readonly="$ctrl.ngReadonly" ng-class="{ warning: phoneInputForm[$ctrl.inputName].$invalid && \n        (phoneInputForm[$ctrl.inputName].$touched || $ctrl.showValidationOnLoad) }" placeholder="{{::\'global.placeholder.phone\' | translate }}" ng-pattern="$ctrl.PHONE_PATTERN"/> <div class="field__error" ng-messages="phoneInputForm[$ctrl.inputName].$error" ng-show="phoneInputForm[$ctrl.inputName].$touched || $ctrl.showValidationOnLoad"> <span ng-message="required"> {{ ::\'global.validation.required\' | translate }} </span> <span ng-message="usPhoneNumber, pattern"> {{ $ctrl.customErrorMsg || \'global.phoneInput.errorInvalidNumber\' | translate }} </span> </div> </div> </ng-form> '},function(t,e,n){"use strict";(function(i){Object.defineProperty(e,"__esModule",{value:!0});var a=c(n(0)),s=c(n(2)),r=n(1988),o=n(67);function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,s){var c=this;(0,a.default)(this,t),this.$scope=e,this.getCaretMap=function(t){return(t||c.caretPositioningHelper.inputValue).split("").map((function(t){return i.isNumeric(t)}))},this.caretPositioningHelper=new r.CaretPositioningHelper(n.find("input"),s,this.getCaretMap,!0),this.PHONE_PATTERN=o.phoneViewPattern}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;this.deregisterWatch=this.$scope.$watch((function(){return t.ngModel}),(function(){t.onUpdate({$event:{key:"phoneNumber",phoneNumber:t.ngModel}})})),this.deregisterWatch2=this.$scope.$watch((function(){return t.inputName&&t.$scope&&t.$scope.phoneInputForm&&t.$scope.phoneInputForm[t.inputName]?t.$scope.phoneInputForm[t.inputName].$viewValue:null}),(function(e,n){t.onViewValueChanged&&e!==n&&t.onViewValueChanged({$event:{key:"viewValue",newValue:e,oldValue:n}})}))}},{key:"$onDestroy",value:function(){"function"==typeof this.deregisterWatch&&this.deregisterWatch(),"function"==typeof this.deregisterWatch2&&this.deregisterWatch2(),this.caretPositioningHelper.$onDestroy()}}]),t}();l.$inject=["$scope","$element","$log"],e.default=l,t.exports=e.default}).call(this,n(93))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var i,a=n(117),s=(i=a)&&i.__esModule?i:{default:i},r=n(67);function o(){var t=new s.default("000-000-0000"),e=new s.default("(000) 000-0000");return{require:"^ngModel",restrict:"A",link:function(n,i,a,s){s.$formatters.push((function(t){return s.$isEmpty(t)?t:e.apply(t.replace(/[^\d]/g,""))})),s.$parsers.push((function(e){var i="";s.$isEmpty(e)||(i=t.apply(e.replace(/[^\d]/g,"")));var a=(0,r.phoneNumberValidation)(i);return"function"==typeof n.$ctrl.onChangeEmptyAllowed&&(s.$isEmpty(e)&&s.$setValidity("pattern",!0),n.$ctrl.onChangeEmptyAllowed({$event:{key:"phoneNumber",phoneNumber:i}})),a?i:""}))}}}o.$inject=[],t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(1817);var i=s(n(4845)),a=s(n(4848));function s(t){return t&&t.__esModule?t:{default:t}}var r=angular.module("tangerine.phoneNumInputModule",["ui.utils.masks"]).component("tngPhoneNumInput",i.default).directive("phoneNumInput",a.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4846)),a=s(n(4847));function s(t){return t&&t.__esModule?t:{default:t}}var r={template:i.default,controller:a.default,require:{form:"^form"},bindings:{onUpdate:"&",onViewValueChanged:"&?",ngRequired:"<?",ngDisabled:"<?",ngReadonly:"<?",ngModel:"=",customErrorMsg:"@",inputName:"@",onChangeEmptyAllowed:"&?",showValidationOnLoad:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports=' <div class="field"> <input class="input" type="tel" actionable-id="{{ $ctrl.inputName }}" ng-model="$ctrl.ngModel" maxlength="14" phone-input ui-us-phone-number ng-disabled="$ctrl.ngDisabled" ng-required="$ctrl.ngRequired" ng-readonly="$ctrl.ngReadonly" ng-class="{ warning: $ctrl.form[$ctrl.inputName].$invalid && \n        ($ctrl.form[$ctrl.inputName].$touched || $ctrl.showValidationOnLoad) }" placeholder="{{::\'global.placeholder.phone\' | translate }}" ng-pattern="$ctrl.PHONE_PATTERN" autocomplete="off"/> <div class="field__error" ng-messages="$ctrl.form[$ctrl.inputName].$error" ng-show="$ctrl.form[$ctrl.inputName].$touched || $ctrl.showValidationOnLoad"> <span ng-message="required"> {{ ::\'global.phoneInput.required\' | translate }} </span> <span ng-message="pattern"> {{ $ctrl.customErrorMsg || \'global.phoneInput.errorInvalidNumber\' | translate }} </span> </div> </div> '},function(t,e,n){"use strict";(function(i){Object.defineProperty(e,"__esModule",{value:!0});var a=c(n(0)),s=c(n(2)),r=n(1988),o=n(67);function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,s){var c=this;(0,a.default)(this,t),this.$scope=e,this.getCaretMap=function(t){return(t||c.caretPositioningHelper.inputValue).split("").map((function(t){return i.isNumeric(t)}))},this.caretPositioningHelper=new r.CaretPositioningHelper(n.find("input"),s,this.getCaretMap,!0),this.PHONE_PATTERN=o.phoneViewPattern}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;this.deregisterWatch=this.$scope.$watch((function(){return t.ngModel}),(function(){t.onUpdate({$event:{key:"phoneNumber",phoneNumber:t.ngModel}})})),this.deregisterWatch2=this.$scope.$watch((function(){return t.form&&t.form[t.inputName]?t.form[t.inputName].$viewValue:null}),(function(e,n){t.onViewValueChanged&&e!==n&&t.onViewValueChanged({$event:{key:"viewValue",newValue:e,oldValue:n}})}))}},{key:"$onDestroy",value:function(){"function"==typeof this.deregisterWatch&&this.deregisterWatch(),"function"==typeof this.deregisterWatch2&&this.deregisterWatch2(),this.caretPositioningHelper.$onDestroy()}}]),t}();l.$inject=["$scope","$element","$log"],e.default=l,t.exports=e.default}).call(this,n(93))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var i,a=n(117),s=(i=a)&&i.__esModule?i:{default:i},r=n(67);function o(){var t=new s.default("000-000-0000"),e=new s.default("(000) 000-0000");return{require:"^ngModel",restrict:"A",link:function(n,i,a,s){s.$formatters.push((function(t){return s.$isEmpty(t)?t:e.apply(t.replace(/[^\d]/g,""))})),s.$parsers.push((function(e){var i="";s.$isEmpty(e)||(i=t.apply(e.replace(/[^\d]/g,"")));var a=(0,r.phoneNumberValidation)(i);return"function"==typeof n.$ctrl.onChangeEmptyAllowed&&(s.$isEmpty(e)&&s.$setValidity("pattern",!0),n.$ctrl.onChangeEmptyAllowed({$event:{key:"phoneNumber",phoneNumber:i}})),a?i:""}))}}}o.$inject=[],t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4850),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("tangerine.phoneListInputModule",[]).component("tngPhoneListInput",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4851)),a=s(n(4852));function s(t){return t&&t.__esModule?t:{default:t}}n(4853);var r={template:i.default,controller:a.default,require:{form:"^form"},bindings:{onPhoneUpdated:"&",ngRequired:"<?",showValidationOnLoad:"<?",showWarningBorder:"<?",phoneList:"<?",primaryPhoneType:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports=' <div class="c-phone-list-input"> <div class="field"> <label actionable-id="primaryPhoneLabel" class="heading--sub3 top-margin-large" ng-bind-html="::\'phoneListComponent.primaryPhone\' | translate"></label> <div class="top-margin-small c-phone-list-input__field-container"> <div class="c-phone-list-input__phone-drop-down"> <tng-select-autocomplete input-id="primaryPhoneTypeInput" ng-model="$ctrl.primaryPhoneType" ng-readonly="false" required="true" ng-required="true" on-select="$ctrl.onPhoneTypeChange()" options="$ctrl.phoneValues" option-label-key="name" is-static="true" placeholder="Select" show-default-warnings="$ctrl.showValidationOnLoad" ng-warning-border="true" alternate-light="true"></tng-select-autocomplete> </div> <div class="c-phone-list-input__phone-input"> <tng-phone-num-input actionable-id="primaryPhoneComp" input-name="primaryPhone" on-view-value-changed="$ctrl.onUpdate($event)" ng-model="$ctrl.primaryNumber" ng-required="true" custom-error-msg="{{ ::\'userSettings.general.basicInfo.validation.phonePattern\' | translate }}" show-validation-on-load="$ctrl.showValidationOnLoad"> </tng-phone-num-input> </div> </div> </div> <div ng-if="!$ctrl.showAdditionalPhone" ng-click="$ctrl.onShowAdditionalPhoneClicked()" class="c-phone-list-input__additional_phone"> <p><span class="c-phone-list-input__plus-sign">+ </span>{{::\'phoneListComponent.addAdditionalPhone\' | translate}}</p> </div> <div class="field" ng-if="$ctrl.showAdditionalPhone"> <label actionable-id="secondaryPhoneLabel" class="heading--sub3 top-margin-medium"> <span ng-bind-html="::\'phoneListComponent.additionalPhone\' | translate"></span> <span class="c-basic-info-form__optional-label">{{:: \'phoneListComponent.optional\' | translate}}</span> </label> <div class="top-margin-small c-phone-list-input__field-container"> <div class="c-phone-list-input__phone-drop-down"> <tng-select-autocomplete input-id="secondaryPhoneTypeInput" ng-model="$ctrl.secondaryPhoneType" required="false" ng-required="false" ng-readonly="true" options="$ctrl.phoneValues" option-label-key="name" placeholder="" is-static="true" show-default-warnings="$ctrl.showValidationOnLoad" ng-warning-border="$ctrl.showWarningBorder" alternate-light="true"></tng-select-autocomplete> </div> <div class="c-phone-list-input__phone-input"> <tng-phone-num-input actionable-id="secondaryPhoneComp" input-name="secondaryPhone" on-view-value-changed="$ctrl.onUpdate($event)" ng-model="$ctrl.secondaryNumber" ng-required="$ctrl.isMobileRequired" custom-error-msg="{{ ::\'userSettings.general.basicInfo.validation.phonePattern\' | translate }}" show-validation-on-load="$ctrl.showValidationOnLoad"> </tng-phone-num-input> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.$scope=e,this.$log=n,this.$translate=a,this.homePhoneType="HOME",this.mobilePhoneType="CELL",this.phoneValues=[{name:this.$translate.instant("phoneListComponent.mobile"),code:this.mobilePhoneType},{name:this.$translate.instant("phoneListComponent.home"),code:this.homePhoneType}],this.primaryNumber=null,this.secondaryNumber=null}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.stopWatch=this.$scope.$watch((function(){return t.phoneList}),(function(){if(t.phoneList){var e=t.phoneList.filter((function(t){return"CELL"===t.type||"HOME"===t.type||""===t.type})),n=e.find((function(e){return e.type===t.primaryPhoneType})),i=e.find((function(e){return e.type!==t.primaryPhoneType}));n&&(t.primaryNumber=n.number),i&&(t.secondaryPhoneType=i.type,t.secondaryNumber=i.number),null!==t.secondaryNumber&&void 0!==t.secondaryNumber&&(t.showAdditionalPhone=!0),t.stopWatch()}}),!0)}},{key:"onPhoneTypeChange",value:function(){this.secondaryPhoneType=this.primaryPhoneType===this.mobilePhoneType?this.homePhoneType:this.mobilePhoneType,this.onUpdate({})}},{key:"onShowAdditionalPhoneClicked",value:function(){this.onPhoneTypeChange(),this.showAdditionalPhone=!0}},{key:"onUpdate",value:function(t){var e={primaryPhoneType:this.primaryPhoneType,phone_list:[{type:this.primaryPhoneType,number:this.primaryNumber}]};(this.secondaryPhoneType||this.secondaryNumber)&&e.phone_list.push({type:this.secondaryPhoneType,number:this.secondaryNumber}),this.onPhoneUpdated({phones:e})}},{key:"$onDestroy",value:function(){}}]),t}();r.$inject=["$scope","$log","$translate"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(4855)),a=r(n(4859)),s=r(n(4860));function r(t){return t&&t.__esModule?t:{default:t}}var o=angular.module("tangerine.debitCardReplacement.module",[]).service("DebitCardReplacementModalFlowService",s.default).component("tngDebitCardReplacement",i.default).constant("DebitCardReplacementModalConstants",a.default);e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4856)),a=s(n(4857));function s(t){return t&&t.__esModule?t:{default:t}}n(4858);var r={controller:i.default,template:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(198)),a=o(n(8)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,r,o,c,l,u,d,h,f,p,g,m){(0,s.default)(this,t),(0,a.default)(this,{DebitCardReplacementModalConstants:n,stateConstants:r,UserSettingsConstants:o,serviceConstants:c,CustomersService:l,$translate:u,$log:d,$state:h,$scope:f,CardsService:p,ErrorService:g,EventBusService:m,tileListConstants:i,TYPE_DAMAGED:n.REPLACEMENT_TYPES.DAMAGED,TYPE_LOST:n.REPLACEMENT_TYPES.LOST_STOLEN,replacementStatuses:n.REPLACEMENT_STATUSES,replacementErrors:n.REPLACEMENT_ERRORS,flowService:e})}return(0,r.default)(t,[{key:"$onInit",value:function(){this.FROM_ACCOUNTS=[],this._getCardFeeAccounts(),this.typeSelectData=[{header:this.$translate.instant("debitCardReplacement.lostStolen.tileHeader"),subHeader:this.$translate.instant("debitCardReplacement.lostStolen.tileMsg"),type:this.TYPE_LOST},{header:this.$translate.instant("debitCardReplacement.damaged.tileHeader"),subHeader:this.$translate.instant("debitCardReplacement.damaged.tileMsg"),type:this.TYPE_DAMAGED}],this.NOCID={title:this.$translate.instant("debitCardReplacement.NOCID.header"),text:this.$translate.instant("debitCardReplacement.NOCID.msg")},this.addressData={header:this.$translate.instant("debitCardReplacement.lostStolen.allDone.mailing"),suite:"",address_line1:"",address_line2:"",city:"",province:"",postal_code:""},this.isLoading=!0,this._prepareData()}},{key:"_getCardFeeAccounts",value:function(){var t=this;return this.CustomersService.getCardFeeAccounts().then((function(e){t.FROM_ACCOUNTS=e.fromAccounts,t.selectedAccount=e.fromAccounts[0].number})).catch((function(e){t.$log.error("Statement -> getAccounts error message:",e)}))}},{key:"onPreferenceChange",value:function(){var t=this;return this.insufficientValidation=!1,this.CustomersService.getCustomerDebitCards(this.selectedAccount).then((function(e){return e.cards&&"SUCCESS"===e.response_status.status_code?(t.nsfFlag=e.nsf_flag,null):e})).catch((function(t){return t}))}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"onSelectType",value:function(t){this._getCardFeeAccounts(),this.insufficientValidation=!1;var e=t.type;this.flowService.setReplacementType(e),this.flowService.gotoNextState(this.cardReplacementFee)}},{key:"onModalClose",value:function(){var t=this;this.flowService.showConfirmExitUI?this.flowService.denyExit():this.flowService.warn().then((function(){t.flowService.resetState(),t.onClose()}))}},{key:"_updateCustomerData",value:function(){this.EventBusService.publish(this.UserSettingsConstants.EVENTS.CARD_REPLACEMENT_DATA_INVALIDATED,[this.UserSettingsConstants.DATA_TYPES.CUSTOMER_CARDS]),this.EventBusService.publish(this.serviceConstants.DATA_INVALIDATED,this.serviceConstants.ROOT_ENDPOINTS.ACCOUNTS)}},{key:"_prepareData",value:function(){var t=this;return i.default.all([this._getCustomerInfo().catch((function(t){return t})),this._getDebitCards().catch((function(t){return t}))]).then((function(e){var n=e[0],i=e[1];return t._handleCustomerInfo(n),t._handleDebitCards(i),e})).then((function(){t._configureModalFlow(),t.isLoading=!1,t.$scope.$apply()}))}},{key:"_getDebitCards",value:function(){var t=this;return this.CustomersService.getCustomerDebitCards(this.selectedAccount).then((function(e){return e.cards&&"SUCCESS"===e.response_status.status_code?(t.cardReplacementFee=e.card_replacement_fee,t.nsfFlag=e.nsf_flag,e.cards.filter((function(t){return"DEBIT"===t.type}))):e})).catch((function(t){return t}))}},{key:"_getCustomerInfo",value:function(){return this.CustomersService.getCustomerInfo().then((function(t){return t.customer&&"SUCCESS"===t.response_status.status_code?t.customer:t})).catch((function(t){return t}))}},{key:"_handleCustomerInfo",value:function(t){var e=t.address_list.filter((function(t){return"MAILING"===t.address_type}))[0];(0,a.default)(this.addressData,e),this.emailAddress=t.email}},{key:"_handleDebitCards",value:function(t){var e=t[0].replaceInfo;this.replacementStatus=e.replaceStatus,this.replacementSubmitDate=moment(e.orderDate).format("LL"),this.replacementStatus===this.replacementStatuses.ORDERED&&this.flowService.setReplacementType(e.orderType),this.replacementStatus||this.$log.error("Debit Card Replacement Error: Debit card's replacement status is missing.");var n=t.filter((function(t){return"OKAY"===t.status}))[0];n?(this.okayCard=n,this.connectedAccounts=n.linked_accounts):this.$log.log("Debit Card Replacement Error: No active client card found.")}},{key:"_configureModalFlow",value:function(){var t=this,e=this.flowService;e.onButtonClickSubmit=function(){return t._onSubmit()},e.onButtonClickNext=function(){return t._onNext()},e.onButtonClickCancel=function(){return t.onModalClose()},e.onButtonClickDone=function(){return t.onModalClose()},e.onButtonClickDefault=function(n){n===e.BUTTON_TYPES.CLOSE&&t.onModalClose()},this.replacementStatus===this.replacementStatuses.OKAY?(e.setInitialState(e.STATES.SELECT_TYPE),e.activate(),e.moveTo(e.STATES.SELECT_TYPE)):(e.setInitialState(e.STATES.ERROR),e.activate(),e.setErrorType(this.replacementStatus),e.moveTo(e.STATES.ERROR))}},{key:"_onNext",value:function(){var t=this,e=this.flowService;this.CustomersService.getCustomerDebitCards(this.selectedAccount).then((function(){!0===t.nsfFlag?t.insufficientValidation=!0:e.gotoNextState(t.cardReplacementFee)})).catch((function(e){t._processError(e)}))}},{key:"_onSubmit",value:function(){var t=this,e=this.flowService;this.isLoading=!0,this.CardsService.replaceDebitCard(this.okayCard.number,e.replacementType,this.selectedAccount).then((function(n){var i=n.response_status;if(!i||"SUCCESS"!==i.status_code){if(i.return_code===t.replacementErrors.NOCID)return e.setErrorType(t.replacementErrors.NOCID),void e.moveTo(e.STATES.ERROR);throw t.$translate.instant("debitCardReplacement.restrictionError")}e.gotoNextState(t.cardReplacementFee)})).catch((function(e){t._processError(e)})).finally((function(){t._updateCustomerData(),t.isLoading=!1}))}},{key:"goToProfileSetting",value:function(){this.$state.go(this.stateConstants.STATES.USER_SETTINGS)}},{key:"_processError",value:function(t){this.$log.error(t),-1===this.flowService.errors.indexOf(t)&&this.flowService.errors.push(t)}}]),t}();c.$inject=["DebitCardReplacementModalFlowService","DebitCardReplacementModalConstants","tngTileListConstants","stateConstants","UserSettingsConstants","serviceConstants","CustomersService","$translate","$log","$state","$scope","CardsService","ErrorService","EventBusService"],e.default=c,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose()" class="c-debit-card-replacement" hide-close="$ctrl.inLoadingMode" flow-service="$ctrl.flowService"> <div class="c-debit-card-replacement__spinner"> <tng-loading-in-progress ng-if="$ctrl.isLoading" class="c-loading-spinner"></tng-loading-in-progress> </div> <header ng-if="! ($ctrl.isLoading || $ctrl.flowService.isNOCID)"> <span ng-if="!$ctrl.flowService.showConfirmExitUI">{{ $ctrl.flowService.currentState.titleKey }}</span> </header> <div ng-if="!$ctrl.isLoading && !$ctrl.flowService.showConfirmExitUI" class="outer-container"> <div ng-if="$ctrl.flowService.errors.length > 0" class="c-debit-card-replacement__errors"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.flowService.errors">{{error}}</li> </ul> </tng-error-message> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.SELECT_TYPE" class="select-request-type"> <div class="c-debit-card-replacement__subheader" ng-bind-html="\'debitCardReplacement.message\' | translate"> </div> <tng-tile-list class="c-debit-card-replacement__tile-list" tile-data="$ctrl.typeSelectData" tile-type="$ctrl.tileListConstants.TILE_TYPE.text" all-actionable="true" single-select="true" on-tile-click="$ctrl.onSelectType(tileData)" short-tile=""></tng-tile-list> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.CARD_FEES" class="select-request-type"> <div class="c-debit-card-replacement__subheader" ng-bind-html="\'debitCardReplacement.cardFees.msg\' | translate | absoluteHref"> </div> <h4 class="heading--sub3 family-normal margin__b--fix1 account-select-heading"> {{ ::\'debitCardReplacement.cardFees.tileMsg\' | translate }} </h4> <div class="c-debit-card-replacement__paper-drop-down"> <tng-select-autocomplete ng-model="$ctrl.selectedAccount" options="$ctrl.FROM_ACCOUNTS" option-label-key="label" option-right-label-key="amount" option-value-key="number" is-static="true" alternate-light="true" on-select="$ctrl.onPreferenceChange()" show-warning-border="$ctrl.insufficientValidation" enable-for-mobile="true"></tng-select-autocomplete> </div> <p class="c-debit-card-replacement__warning-message" ng-if="$ctrl.insufficientValidation">{{ ::\'debitCardReplacement.cardFees.insufficientMsg\' | translate }}</p> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.CONFIRM" class="review-confirm"> <div ng-if="$ctrl.flowService.isLostStolen" class="c-debit-card-replacement__subheader review-confirm-lost-card" ng-bind-html="\'debitCardReplacement.lostStolen.review.msg\' | translate"></div> <div ng-if="$ctrl.flowService.isDamaged" class="c-debit-card-replacement__subheader review-confirm-damaged-card" ng-bind-html="\'debitCardReplacement.damaged.review.msg\' | translate"></div> <div class="c-debit-card-replacement__address-tile c-debit-card-replacement__tile"> <div class="c-debit-card-replacement__tile__header"> {{ ::\'debitCardReplacement.lostStolen.review.mailing\' | translate }} </div> <div class="c-debit-card-replacement__tile__body"> <div> <span ng-if="$ctrl.addressData.address_line1">{{$ctrl.addressData.address_line1}}, </span> <span ng-if="$ctrl.addressData.address_line2">{{$ctrl.addressData.address_line2}}, </span> <span ng-if="$ctrl.addressData.suite">{{$ctrl.addressData.suite}}</span></div> <div>{{$ctrl.addressData.city}}, {{$ctrl.addressData.province}} {{$ctrl.addressData.postal_code}}</div> </div> </div> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.DONE"> <div ng-if="$ctrl.flowService.isLostStolen" class="c-debit-card-replacement__subheaderfull" ng-bind-html="\'debitCardReplacement.lostStolen.allDone.msg\' | translate: { emailAddress: $ctrl.emailAddress }"></div> <div ng-if="$ctrl.flowService.isDamaged" class="c-debit-card-replacement__subheaderfull" ng-bind-html="\'debitCardReplacement.damaged.allDone.msg\' | translate: { emailAddress: $ctrl.emailAddress }"></div> <div class="c-debit-card-replacement__errors__tile card-on-the-way-lost-card-tile top-margin-small"> <div class="c-debit-card-replacement__errors__tile__header"> <span ng-if="$ctrl.flowService.isLostStolen">{{ ::\'debitCardReplacement.lostStolen.allDone.tileHeader\' | translate }}</span> <span ng-if="$ctrl.flowService.isDamaged">{{ ::\'debitCardReplacement.damaged.allDone.tileHeader\' | translate }}</span> </div> <div class="c-debit-card-replacement__errors__tile__bodyfull"> <span ng-if="$ctrl.flowService.isLostStolen">{{ ::\'debitCardReplacement.lostStolen.allDone.tileMsg\' | translate }}</span> <span ng-if="$ctrl.flowService.isDamaged">{{ ::\'debitCardReplacement.damaged.allDone.tileMsg\' | translate }}</span> </div> </div> <div class="c-debit-card-replacement__content-header"> {{ ::\'debitCardReplacement.lostStolen.allDone.cardInfo\' | translate }}</div> <div class="c-debit-card-replacement__all-done-tiles"> <div class="c-debit-card-replacement__address-tile c-debit-card-replacement__tile c-debit-card-replacement__flex-child"> <div class="c-debit-card-replacement__tile__header"> {{ ::\'debitCardReplacement.lostStolen.allDone.mailing\' | translate }} </div> <div class="c-debit-card-replacement__tile__body"> <div> <span ng-if="$ctrl.addressData.address_line1">{{$ctrl.addressData.address_line1}}, </span> <span ng-if="$ctrl.addressData.address_line2">{{$ctrl.addressData.address_line2}}, </span> <span ng-if="$ctrl.addressData.suite">{{$ctrl.addressData.suite}}</span></div> <div>{{$ctrl.addressData.city}}, {{$ctrl.addressData.province}} {{$ctrl.addressData.postal_code}}</div> </div> </div> <div class="c-debit-card-replacement__connected-accounts c-debit-card-replacement__tile c-debit-card-replacement__flex-child"> <div class="c-debit-card-replacement__tile__header"> <span>{{ ::\'debitCardReplacement.lostStolen.allDone.connectedAccounts\' | translate }}</span> <tng-help-bubble> <span ng-bind-html="\'debitCardReplacement.lostStolen.allDone.tooltip\' | translate"></span> </tng-help-bubble> </div> <div class="c-debit-card-replacement__tile__body"></div> <div ng-repeat="account in $ctrl.connectedAccounts">{{ account.type }} {{ account.account_number | maskNumber }}</div> </div> <div class="c-debit-card-replacement__card-fee-tile c-debit-card-replacement__tile c-debit-card-replacement__flex-child"> <div class="c-debit-card-replacement__tile__header"> <span>{{ ::\'debitCardReplacement.lostStolen.allDone.replacementFee\' | translate }}</span> </div> <div class="c-debit-card-replacement__tile__body"></div> <div ng-if="$ctrl.cardReplacementFee === 0">{{ ::\'debitCardReplacement.lostStolen.allDone.free\' | translate }} </div> <div ng-if="$ctrl.cardReplacementFee !== 0">{{ $ctrl.cardReplacementFee | currency }} </div> </div> </div> </div> <div class="c-debit-card-replacement__errors" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.ERROR"> <div ng-if="$ctrl.flowService.isOnTheWay" class="card-on-the-way"> <div ng-if="$ctrl.flowService.isLostStolen" class="card-on-the-way-lost-card"> <div class="c-debit-card-replacement__subheader" ng-bind-html="\'debitCardReplacement.lostStolen.cardOTW.msg\' | translate: { submitDate: $ctrl.replacementSubmitDate }"></div> <div class="c-debit-card-replacement__errors__tile card-on-the-way-lost-card-tile"> <div class="c-debit-card-replacement__errors__tile__header">{{ ::\'debitCardReplacement.lostStolen.cardOTW.tileHeader\' | translate }}</div> <div class="c-debit-card-replacement__errors__tile__body">{{ ::\'debitCardReplacement.lostStolen.cardOTW.tileMsg\' | translate }}</div> </div> </div> <div ng-if="$ctrl.flowService.isDamaged" class="card-on-the-way-damaged-card"> <div class="c-debit-card-replacement__subheader" ng-bind-html="\'debitCardReplacement.damaged.cardOTW.msg\' | translate: { submitDate: $ctrl.replacementSubmitDate }"></div> <div class="c-debit-card-replacement__errors__tile card-on-the-way-lost-card-tile"> <div class="c-debit-card-replacement__errors__tile__header">{{ ::\'debitCardReplacement.damaged.cardOTW.tileHeader\' | translate }}</div> <div class="c-debit-card-replacement__errors__tile__body">{{ ::\'debitCardReplacement.damaged.cardOTW.tileMsg\' | translate }}</div> </div> </div> </div> <div ng-if="$ctrl.flowService.isFraudulent" class="c-debit-card-replacement__subheader fraudulent-activity"> <div ng-bind-html="\'debitCardReplacement.fraudMsg\' | translate"></div> </div> <div ng-if="$ctrl.flowService.isMaxCards" class="c-debit-card-replacement__subheader maximum-cards"> <div ng-bind-html="\'debitCardReplacement.maxCardsMsg\' | translate"></div> </div> <div ng-if="$ctrl.flowService.isInvalidAddress" class="maximum-cards"> <div class="c-debit-card-replacement__subheader" ng-bind-html="\'debitCardReplacement.invalidAddress\' | translate"></div> <div class="c-debit-card-replacement__address-tile c-debit-card-replacement__tile"> <div class="c-debit-card-replacement__tile__header"> {{ ::\'debitCardReplacement.lostStolen.review.mailing\' | translate }} </div> <div class="c-debit-card-replacement__tile__body"> <div> <span ng-if="$ctrl.addressData.address_line1">{{$ctrl.addressData.address_line1}}, </span> <span ng-if="$ctrl.addressData.address_line2">{{$ctrl.addressData.address_line2}}, </span> <span ng-if="$ctrl.addressData.suite">{{$ctrl.addressData.suite}}</span></div> <div>{{$ctrl.addressData.city}}, {{$ctrl.addressData.province}} {{$ctrl.addressData.postal_code}}</div> </div> </div> </div> <tng-confirm-exit ng-if="$ctrl.flowService.isNOCID" confirm-delete-title="$ctrl.NOCID.title" confirm-delete-msg="$ctrl.NOCID.text" grey-icon="true"> </tng-confirm-exit> </div> </div> <footer> <tng-page-flow-controls flow-service="$ctrl.flowService"> </tng-page-flow-controls> </footer> </tng-modal-dialog> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={REPLACEMENT_TYPES:{LOST_STOLEN:"LOST_STOLEN",DAMAGED:"DAMAGED"},REPLACEMENT_STATUSES:{BLOCKED:"BLOCKED",ORDERED:"ORDERED",QUOTA_DEPLETED:"QUOTA_DEPLETED",NON_CA_MAILING_ADDRESS:"NON_CA_OR_US_MAILING_ADDRESS",OKAY:"OKAY"},REPLACEMENT_ERRORS:{NOCID:"NOCID"},REPLACEMENT_FEES:{CARD_FEES:"CARD_FEES"}},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(177)),a=d(n(0)),s=d(n(2)),r=d(n(264)),o=d(n(266)),c=d(n(265)),l=d(n(267)),u=n(364);function d(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(t,n,s,o,c,l,d,h,f,p){(0,a.default)(this,e);var g=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,d,l,h));return g.BUTTON_TYPES=l.BUTTON_TYPES,g.DebitCardReplacementModalConstants=f,g.TYPES=f.REPLACEMENT_TYPES,g.replacementStatuses=f.REPLACEMENT_STATUSES,g.replacementFees=f.REPLACEMENT_FEES,g.replacementErrors=f.REPLACEMENT_ERRORS,g.$translate=p,g.STATES={SELECT_TYPE:{titleKey:g.$translate.instant("debitCardReplacement.header")},CARD_FEES:{titleKey:g.$translate.instant("debitCardReplacement.cardFees.header")},CONFIRM:{titleKey:g.$translate.instant("debitCardReplacement.lostStolen.review.header")},DONE:{titleKey:g.$translate.instant("debitCardReplacement.lostStolen.allDone.header")},ERROR:{titleKey:g.$translate.instant("debitCardReplacement.header")}},g.BUTTONS={BTN_GRY:new u.ModalFooterButton(g.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new u.ModalFooterButton(g.BUTTON_TYPES.NEXT,!1,!1)},g}return(0,c.default)(e,t),(0,s.default)(e,[{key:"_updateUI",value:function(){switch(this.currentState){case this.STATES.SELECT_TYPE:this.resetState();break;case this.STATES.CARD_FEES:this.showWarning(),this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.NEXT,this.BUTTONS.BTN_ORG.show=!0;break;case this.STATES.CONFIRM:this.showWarning(),this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.SUBMIT,this.BUTTONS.BTN_ORG.show=!0;break;case this.STATES.DONE:this.hideWarning(),this.BUTTONS.BTN_GRY.show=!1,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.CLOSE;break;case this.STATES.ERROR:this.hideWarning(),this.BUTTONS.BTN_GRY.show=!1,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.CLOSE,this.BUTTONS.BTN_ORG.show=!0}}},{key:"gotoNextState",value:function(t){if(t&&0!==t){if(15===t)switch(this.currentState){case this.STATES.SELECT_TYPE:this.moveTo(this.STATES.CARD_FEES);break;case this.STATES.CARD_FEES:this.moveTo(this.STATES.CONFIRM);break;case this.STATES.CONFIRM:this.moveTo(this.STATES.DONE)}}else switch(this.currentState){case this.STATES.SELECT_TYPE:this.moveTo(this.STATES.CONFIRM);break;case this.STATES.CONFIRM:this.moveTo(this.STATES.DONE)}}},{key:"resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.errors=[],this.BUTTONS={BTN_GRY:new u.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new u.ModalFooterButton(this.BUTTON_TYPES.NEXT,!1,!1)},this.replacementType=void 0,this.currentState=this.STATES.SELECT_TYPE}},{key:"setReplacementType",value:function(t){this.replacementType=t}},{key:"setErrorType",value:function(t){this.errorType=t}},{key:"_getAnalyticsID",value:function(){return"debit-card-replacement"}},{key:"isCardFees",get:function(){return this.replacementType===this.replacementFees.CARD_FEES}},{key:"isLostStolen",get:function(){return this.replacementType===this.TYPES.LOST_STOLEN}},{key:"isDamaged",get:function(){return this.replacementType===this.TYPES.DAMAGED}},{key:"isOnTheWay",get:function(){return this.errorType===this.replacementStatuses.ORDERED}},{key:"isFraudulent",get:function(){return this.errorType===this.replacementStatuses.BLOCKED}},{key:"isMaxCards",get:function(){return this.errorType===this.replacementStatuses.QUOTA_DEPLETED}},{key:"isInvalidAddress",get:function(){return this.errorType===this.replacementStatuses.NON_CA_MAILING_ADDRESS}},{key:"isNOCID",get:function(){return this.errorType===this.replacementErrors.NOCID}}]),e}(l.default);h.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","$rootScope","AnalyticsService","DebitCardReplacementModalConstants","$translate"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(4862)),a=c(n(4866)),s=c(n(4870)),r=c(n(4871)),o=c(n(4873));function c(t){return t&&t.__esModule?t:{default:t}}var l=angular.module("tangerine.app.components.tourCards",[]).component("tngTourCardsContainer",i.default).component("tngTourCard",a.default).directive("tngTourCard",s.default).service("TourCardsConfigService",r.default).service("TourCardsFlowService",o.default);e.default=l,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4863)),a=s(n(4864));function s(t){return t&&t.__esModule?t:{default:t}}n(4865);var r={template:i.default,controller:a.default,bindings:{pageId:"@"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div id="{{$ctrl.pageId}}" class="tour-cards-container"> <p>{{ ::\'tour-cards.intro_slideOutPage.contentText\' | translate}}</p> <p> <a href="" ng-click="$ctrl.onShowMeLater()">{{ ::\'tour-cards.intro_slideOutPage.showMeLaterLabel\' | translate}}</a> <strong>|</strong> <a href="" ng-click="$ctrl.onDontShowMeAgain()">{{ ::\'tour-cards.intro_slideOutPage.dontShowMeAgainLabel\' | translate}}</a> </p> <p> <button actionable-id="tooltip-container-start" class="btn btn--orange" ng-click="$ctrl.onStartTour()"> {{ ::\'tour-cards.intro_slideOutPage.StartLabel\' | translate}} </button> </p> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f,p){(0,i.default)(this,t),this.InsightsService=e,this.InsightsEventService=n,this.InsightsConstants=a,this.EnvironmentService=s,this.InsightsEvents=a.EVENT_MAP,this.INTERACTION_EVENTS=a.INTERACTION_EVENTS,this.TourCardsConfigService=r,this.TourCardsFlowService=o,this.$window=c,this.$document=l,this.$element=u,this.$log=d,this.$timeout=h,this.$scope=f,this.$translate=p}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.isLoading=!0,this.isOpen=this.InsightsService.openCarouselOnLaunch,this.$log.debug("TourCardsContainer-onInit "+this.pageId);var e=this.TourCardsConfigService.getPageConfig(this.pageId),n=e&&e.campaign_name?e.campaign_name:this.pageId;this.$log.debug("TourCardsContainer-onInit interactionPoint="+n),this.InsightsService.getInsights({audience:this.InsightsConstants.SESSION.AUDIENCE_CUSTOMER,requireSession:!0,count:1,interactionPoint:n}).then((function(e,n){t.insights=e.insights,t.$log.debug("Insights call response:"+e),t.$log.debug("Insights call error response:"+n),t.insights&&t.insights.length?(t.TourCardsFlowService.init({pageId:t.pageId}),t.TourCardsConfigService.isDisplayIntroCard(t.pageId)?t._showDialog():t.onStartTour()):t.$log.error(t.$translate.instant("insights.noInsights"))})).catch((function(e){t.$log.error(t.$translate.instant("insights.serviceErrorShort")),t.$log.debug("Error response"+e)})).finally((function(){}))}},{key:"$onDestroy",value:function(){this.$log.debug("TourCardsContainer-onDestroy  pageId="+this.pageId),this.TourCardsFlowService.destroy()}},{key:"_showDialog",value:function(){this.InsightsEventService.sendEvent(this.insights[0],this.INTERACTION_EVENTS.VIEW),this.containerElement=angular.element(this.$document[0].querySelector("#"+this.pageId)),this.containerElement.css("display","inline-block")}},{key:"onStartTour",value:function(){this.insights[0].ic_act1_eventName&&this.insights[0].ic_act1_responsetype&&this.InsightsEventService.sendEvent(this.insights[0],this.InsightsEvents.INTERACT_EVENT,{eventType:this.insights[0].ic_act1_eventName,responseType:this.insights[0].ic_act1_responsetype}),this.containerElement&&this.containerElement.css("display","none"),this.TourCardsFlowService.startTour()}},{key:"onShowMeLater",value:function(){this.containerElement.css("display","none")}},{key:"onDontShowMeAgain",value:function(){this.InsightsEventService.sendEvent(this.insights[0],this.InsightsEvents.INTERACT_EVENT,{eventType:"evt_DontShowThisAgain",responseType:"DSTA"}),this.containerElement.css("display","none")}}]),t}();r.$inject=["InsightsService","InsightsEventService","InsightsConstants","EnvironmentService","TourCardsConfigService","TourCardsFlowService","$window","$document","$element","$log","$timeout","$scope","$translate"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4867)),a=s(n(4868));function s(t){return t&&t.__esModule?t:{default:t}}n(4869);var r={template:i.default,controller:a.default,bindings:{cardId:"@"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="outer"> <div id="{{$ctrl.cardId}}" class="tour-card"> <span id="{{$ctrl.cardId}}-anchor" class="tour-card-anchor"></span> <div class="wrapper"> <p class="page-num">{{$ctrl.getPageNum()}}</p> <p>{{$ctrl.getCopy()}}</p> <div class="control-container"> <div> <button actionable-id="tooltip-container-start" class="btn btn--orange" ng-click="$ctrl.onNext($event)"> {{$ctrl.getButtonName()}} </button> </div> <div class="dismiss" ng-if="!$ctrl.isLast()"> <a href="" ng-click="$ctrl.onDontShowMeAgain($event)">{{ ::\'tour-cards.intro_slideOutPage.DismissButtonLabel\' | translate}}</a> </div> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.TourCardsFlowService=e,this.$log=n,this.$translate=a}return(0,a.default)(t,[{key:"$onInit",value:function(){this.$log.debug("TourCard-onInit")}},{key:"isLast",value:function(){var t=this.TourCardsFlowService.getCurrentCard(this.cardId);return!!t&&t.card===t.cards}},{key:"getPageNum",value:function(){var t=this.TourCardsFlowService.getCurrentCard(this.cardId);return t?this.$translate.instant("tour-cards.page-num",t):""}},{key:"getCopy",value:function(){if(!this.copy){var t=this.TourCardsFlowService.getConfigById(this.cardId);t&&(this.copy=this.$translate.instant(t.displayText))}return this.copy}},{key:"onClickOutside",value:function(){this.TourCardsFlowService.resizeHandler()}},{key:"onNext",value:function(t){this.$log.debug("TourCard-OnNext"),t.stopPropagation(),this.TourCardsFlowService.navigateNext(this.cardId)}},{key:"onDontShowMeAgain",value:function(t){this.$log.debug("TourCard-onDontShowMeAgain"),t.stopPropagation(),this.TourCardsFlowService.dismiss(this.cardId)}},{key:"$onDestroy",value:function(){this.$log.debug("TourCard-onDestroy")}},{key:"getButtonName",value:function(){return this.TourCardsFlowService.hasNext(this.cardId)?this.$translate.instant("tour-cards.intro_slideOutPage.NextButtonLabel"):this.$translate.instant("tour-cards.intro_slideOutPage.CloseButtonLabel")}}]),t}();r.$inject=["TourCardsFlowService","$log","$translate"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return{restrict:"A",link:function(e,n,i){var a=i.tngTourCard;e.$watch(i.tngTourCard,(function(){n.append("<tng-tour-card card-id="+a+"></tng-tour-card>"),t(n.contents())(e)}))}}};i.$inject=["$compile"],e.default=i,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(8)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e){(0,a.default)(this,t),(0,i.default)(this,{$log:e}),this.configurations=n(4872)||[]}return(0,s.default)(t,[{key:"getCardsConfigurations",value:function(t){var e=this._searchPage(t);if(e)return e.length>1&&e.cards.sort((function(t,e){return t.order-e.order})),e.cards}},{key:"isDisplayIntroCard",value:function(t){var e=this._searchPage(t);return!!e&&"true"===e.display_intro}},{key:"isRequiredFilterOutCardsWhenElementNotIntheDOM",value:function(t){var e=this._searchPage(t);return e&&"true"===e.hide_if_element_not_found}},{key:"_searchPage",value:function(t){return this.configurations.pages.find((function(e){return e.name===t}))}},{key:"getPageConfig",value:function(t){return this._searchPage(t)}}]),t}();o.$inject=["$log"],e.default=o,t.exports=e.default},function(t){t.exports=JSON.parse('{"pages":[{"name":"ip_TT_TaxReceiptPage","display_intro":"true","cards":[{"element_id":"tax-receipts-action_btn","card_id":"delivery-preferences","position":"bottom-right","phone_position":"bottom-left","order":"0","displayText":"tour-cards.ip_TT_TaxReceiptPage.card1"},{"element_id":"c-why-no-tax-receipts-header","card_id":"contribution-receipts","position":"bottom-left","order":"1","displayText":"tour-cards.ip_TT_TaxReceiptPage.card2"}]},{"name":"ip_TT_RSPContributionPage","display_intro":"false","hide_if_element_not_found":"true","cards":[{"element_id":"total-contributions-total-0","card_id":"total-contributions-total-current","position":"bottom-left","order":"0","displayText":"tour-cards.ip_TT_RSPContributionPage.card1"},{"element_id":"plan-level-0","card_id":"plan-level-current","position":"bottom-left","order":"1","displayText":"tour-cards.ip_TT_RSPContributionPage.card2"},{"element_id":"total-contributions-1","card_id":"total-contributions-previous","position":"bottom-left","order":"2","displayText":"tour-cards.ip_TT_RSPContributionPage.card3"}]},{"name":"ip_TT_TFSAContributionPage","display_intro":"false","hide_if_element_not_found":"true","cards":[{"element_id":"total-contributions-total-0","card_id":"total-contributions-total-current","position":"bottom-left","order":"0","displayText":"tour-cards.ip_TT_TFSAContributionPage.card1"},{"element_id":"account-level-0","card_id":"account-level-current","position":"bottom-left","order":"1","displayText":"tour-cards.ip_TT_TFSAContributionPage.card2"},{"element_id":"total-contributions-1","card_id":"total-contributions-previous","position":"bottom-left","order":"2","displayText":"tour-cards.ip_TT_TFSAContributionPage.card3"}]},{"name":"ip_TT_RSPDetailPage-savings","campaign_name":"ip_TT_RSPDetailPage","display_intro":"true","cards":[{"element_id":"detailsControlButton_CONTRIBUTIONS","phone_element_id":"detailsControlButton_CONTRIBUTIONS-m","card_id":"rsp-account-detail-view-contributions","position":"bottom-left","order":"0","displayText":"tour-cards.ip_TT_RSPDetailPage.card1"}]},{"name":"ip_TT_RSPDetailPage-investment","campaign_name":"ip_TT_RSPDetailPage","display_intro":"true","cards":[{"element_id":"detailsControlButton_CONTRIBUTIONS","phone_element_id":"detailsControlButton_CONTRIBUTIONS-m","card_id":"rsp-account-detail-view-contributions","position":"bottom-left","phone_position":"bottom-right","order":"0","displayText":"tour-cards.ip_TT_RSPDetailPage.card1"}]},{"name":"ip_TT_TFSADetailPage-savings","campaign_name":"ip_TT_TFSADetailPage","display_intro":"true","cards":[{"element_id":"detailsControlButton_CONTRIBUTIONS","phone_element_id":"detailsControlButton_CONTRIBUTIONS-m","card_id":"tfsa-account-detail-view-contributions","position":"bottom-left","order":"0","displayText":"tour-cards.ip_TT_TFSADetailPage.card1"}]},{"name":"ip_TT_TFSADetailPage-investment","campaign_name":"ip_TT_TFSADetailPage","display_intro":"true","cards":[{"element_id":"detailsControlButton_CONTRIBUTIONS","phone_element_id":"detailsControlButton_CONTRIBUTIONS-m","card_id":"tfsa-account-detail-view-contributions","phone_position":"bottom-right","position":"bottom-left","order":"0","displayText":"tour-cards.ip_TT_TFSADetailPage.card1"}]},{"name":"ip_TT_PayBillPage","display_intro":"false","hide_if_element_not_found":"true","cards":[{"element_id":"bill-pay-add_bill_pay","card_id":"add-a-bill","position":"bottom-left","order":"0","displayText":"tour-cards.ip_TT_PayBillPage.card1"},{"element_id":"bill-pay-multiple_pay_bills","card_id":"manage-bill","position":"bottom-right","order":"1","displayText":"tour-cards.ip_TT_PayBillPage.card2"}]},{"name":"ip_TT_OverviewDefaultList","display_intro":"true","hide_if_element_not_found":"true","cards":[{"element_id":"submenu_openEmt","card_id":"email_money_card","position":"bottom-right","order":"0","displayText":"tour-cards.ip_TT_OverviewPage.card1","additionalXOffset":"-20"}]},{"name":"ip_TT_EmailMoney","display_intro":"false","hide_if_element_not_found":"true","cards":[{"element_id":"select_contact","card_id":"email_money_modal_sendto_card","position":"bottom-right","order":"0","displayText":"tour-cards.ip_TT_EmailMoneyModal.card1","additionalXOffset":"+80"},{"element_id":"limits-title","card_id":"email_money_modal_limit_card","position":"top-right","order":"1","displayText":"tour-cards.ip_TT_EmailMoneyModal.card2","additionalXOffset":"-30"}]},{"name":"ip_TT_OverviewClickList","display_intro":"false","hide_if_element_not_found":"true","cards":[{"element_id":"category-all-tab","card_id":"all-accounts-tab","position":"top-left","order":"0","displayText":"tour-cards.ip_TT_OverviewListView.card1","additionalXOffset":"-35"},{"element_id":"category-investing-tab","card_id":"investing-accounts-tab","position":"bottom-left","order":"1","displayText":"tour-cards.ip_TT_OverviewListView.card2","additionalXOffset":"-20"}]},{"name":"ip_TT_QuickBillPayPage","display_intro":"false","hide_if_element_not_found":"true","cards":[{"element_id":"biller-table","card_id":"payee-name","position":"top-right","order":"0","displayText":"tour-cards.ip_TT_QuickBillPayPage.card1"},{"element_id":"payee-mobile-checkbox-0","card_id":"payee-mobile-container","position":"bottom-right","order":"1","displayText":"tour-cards.ip_TT_QuickBillPayPage.card1"},{"element_id":"payee-checkbox-0","card_id":"payee-checkbox","position":"bottom-right","order":"2","displayText":"tour-cards.ip_TT_QuickBillPayPage.card2"},{"element_id":"payee-mobile-checkbox-0","card_id":"payee-mobile-checkbox","position":"bottom-right","order":"3","displayText":"tour-cards.ip_TT_QuickBillPayPage.card2"},{"element_id":"biller-date-selector-0","card_id":"payee-date","position":"top-right","order":"4","displayText":"tour-cards.ip_TT_QuickBillPayPage.card3"}]},{"name":"ip_TT_Holds","display_intro":"true","hide_if_element_not_found":"true","cards":[{"element_id":"details-tab-bar-tab_select__2","card_id":"overdraft-menu","position":"bottom-left","order":"0","displayText":"tour-cards.ip_TT_Holds.card1"},{"element_id":"menu_transactionsPage","card_id":"balance-amount","position":"bottom-right","order":"1","displayText":"tour-cards.ip_TT_Holds.card2"}]}]}')},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(49)),a=o(n(8)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,r,o,c,l){(0,s.default)(this,t),(0,a.default)(this,{$document:e,$window:n,$log:i,$timeout:r,TourCardsConfigService:o,AnchorService:c,EnvironmentService:l})}return(0,r.default)(t,[{key:"getCurrentCard",value:function(t){var e=this._getCardsConfig();if(e&&t){var n=e.findIndex((function(e){return e.card_id===t}));if(-1!==n)return{card:n+1,cards:e.length}}}},{key:"getConfigById",value:function(t){return this._getConfigById(t)}},{key:"_getConfigById",value:function(t){var e=this._getCardsConfig();if(e&&t)return e.find((function(e){return e.card_id===t}))}},{key:"_getCardsConfig",value:function(){var t=this;if(this.pageId){var e=this.TourCardsConfigService.getCardsConfigurations(this.pageId);return e&&this.TourCardsConfigService.isRequiredFilterOutCardsWhenElementNotIntheDOM(this.pageId)?e.filter((function(e){return t._getElement(e.element_id).length&&t._getElement(e.element_id).length>0})):e}}},{key:"_getNext",value:function(t){var e=this._getCardsConfig();if(e&&t){var n=e.findIndex((function(e){return e.card_id===t}));if(-1!==n&&n<e.length-1)return e[n+1]}}},{key:"init",value:function(t){t&&t.pageId&&(this.pageId&&this.destroy(),this.pageId=t.pageId,this.handlerFn||(this.handlerFn=this.resizeHandler.bind(this),angular.element(this.$window).resize(this.handlerFn)))}},{key:"destroy",value:function(){var t=this;this._getElement(this.pageId).css("display","none");var e=this._getCardsConfig();e&&e.forEach((function(e){t._getElement(e.card_id).removeClass("is-active")})),this.handlerFn&&(angular.element(this.$window).off("resize",this.handlerFn),this.handlerFn=null),this.pageId=void 0}},{key:"startTour",value:function(){this.navigateNext()}},{key:"hasNext",value:function(t){return void 0!==this._getNext(t)}},{key:"navigateNext",value:function(t){var e=this,n=void 0,i=this._getFormFactor();if(void 0===t){var a=this._getCardsConfig();n=a.length&&a[0]}else if(this._hideCard(t,i),!(n=this._getNext(t)))return void this.$log.debug("There is no next after "+t);if(n){n=this._decorateConfig(n,i);var s=this._getElement(n.card_id),r=this._getElement(n.element_id);s.addClass(this._getClass(n.position,this._determineAlignment(r.offset().left))),this.$timeout((function(){s.addClass("is-active"),e.$log.debug("Card outer height="+s.outerHeight());var i=n.position.startsWith("bottom");(i&&e.$window.innerHeight<r.offset().top+s.outerHeight()+r.outerHeight()+50||!i&&r.offset().top<s.outerHeight()+50)&&(e.$log.debug("scrolling to "+n.element_id),e.AnchorService.scroll(n.element_id)),n.scroll_anchor_id&&e.AnchorService.scroll(n.scroll_anchor_id),e._adjustPosition(s,r,n),e.$log.debug(t)}),10)}}},{key:"_getFormFactor",value:function(){return this.EnvironmentService.getWindowSize()<=640?"phone":"desktop"}},{key:"_decorateConfig",value:function(t,e){if(t){var n=JSON.parse((0,i.default)(t)),a=e||this._getFormFactor();if(this.$log.debug("_decorateConfig formFactor="+a),a){var s=t[a+"_element_id"];s&&(this.$log.debug("_decorateConfig alternativeId="+s),n.element_id=s);var r=t[a+"_position"];r&&(this.$log.debug("_decorateConfig alternatePosition="+r),n.position=r);var o=t[a+"_alignment"];o&&(this.$log.debug("_decorateConfig altAlignment="+o),n.alignment=o)}return t.alignment||(n.alignment="left"),n}return t}},{key:"_hideCard",value:function(t,e){var n=this._getConfigById(t);n&&(n=this._decorateConfig(n,e),this._getElement(n.card_id).removeClass("is-active"))}},{key:"dismiss",value:function(t){this._hideCard(t)}},{key:"_getClass",value:function(t,e){var n=[{position:"top",class:"position-top"},{position:"top-left",class:"position-top "+e},{position:"top-right",class:"position-top "+e},{position:"bottom",class:"position-bottom"},{position:"bottom-left",class:"position-bottom "+e},{position:"bottom-right",class:"position-bottom "+e}].find((function(e){return e.position===t}));return void 0===n?"position-bottom":n.class}},{key:"_adjustPosition",value:function(t,e,n){var i=e.offset(),a=n.position.split("-")[0],s=i.left;this.$log.debug("leftPosition="+s),"left"===this._determineAlignment(s)||(s=i.left+e.outerWidth()-t.outerWidth()),s+=n.additionalXOffset?Number(n.additionalXOffset):0,t.offset({left:s,top:"top"===a?i.top-t.outerHeight()-20:i.top+e.outerHeight()+20})}},{key:"_determineAlignment",value:function(t){return t<this.EnvironmentService.getWindowSize()/2?"left":"right"}},{key:"_readjustCards",value:function(){var t=this,e=this._getCardsConfig();this.$log.debug("readjusting"),e&&e.forEach((function(e){var n=t._getElement(e.card_id);if(n.hasClass("is-active")){var i=t.EnvironmentService.getFormFactorRealTime(),a=t._getElement(e.element_id),s=t._getClass(e.position,t._determineAlignment(a.offset().left));e=t._decorateConfig(e,i),a=t._getElement(e.element_id);var r=t._getClass(e.position,t._determineAlignment(a.offset().left));t.$log.debug("_readjust formFactor="+i+" orgClass= "+s+" newClass = "+r),n.hasClass("left")&&n.removeClass("left"),n.hasClass("right")&&n.removeClass("right"),s&&(n.removeClass(s),t.$log.debug("removeClass "+s)),r&&(n.addClass(r),t.$log.debug("addClass "+r)),a=t._getElement(e.element_id),t._adjustPosition(n,a,e)}}))}},{key:"resizeHandler",value:function(){var t=this;this.resizedFinished&&this.$timeout.cancel(this.resizedFinished),this.resizedFinished=this.$timeout((function(){t._readjustCards(),t.resizedFinished=null}),0)}},{key:"_getElement",value:function(t){return angular.element(this.$document[0].querySelector("#"+t))}}]),t}();c.$inject=["$document","$window","$log","$timeout","TourCardsConfigService","AnchorService","EnvironmentService"],e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4875)),a=s(n(4876));function s(t){return t&&t.__esModule?t:{default:t}}n(4877);var r={template:i.default,controller:a.default,bindings:{inputAccountDetails:"<",outputAccountDetails:"=?",enableAccountHeaders:"<?",isDisabled:"<?",headerAccount:"@?",headerIntendedUse:"@?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-intendedUse" ng-if="$ctrl.intendedUseAccount"> <table class="c-intendedUse-table--tableScale"> <tbody class="c-intendedUse-table__body"> <tr class="c-intendedUse-table__row" ng-if="$ctrl.enableAccountHeaders"> <th class="c-intendedUse-table--title"> <span ng-if="!$ctrl.headerAccount">{{ ::\'amlConfirmInfo.confirmAccountInfoModal.intendedUse.intendedUseItem.header\' | translate }}</span> <span ng-if="$ctrl.headerAccount">{{$ctrl.headerAccount}}</span> </th> <th class="c-intendedUse-table--title" ng-if="$ctrl.isDisabled || !$ctrl.isMobileView"> <span ng-if="!$ctrl.headerIntendedUse">{{ ::\'amlConfirmInfo.confirmAccountInfoModal.intendedUse.intendedUseItem.intendedUseDropdown\' | translate }}</span> <span ng-if="$ctrl.headerIntendedUse">{{$ctrl.headerIntendedUse}}</span> <tng-help-bubble> {{ ::\'clientOnboarding.setupAccountForm.labels.intendedUseToolTip\' | translate }} </tng-help-bubble> </th> </tr> <tr class="c-intendedUse-table__row" ng-if="$ctrl.isDisabled || !$ctrl.isMobileView"> <td class="c-intendedUse-table__row__text--header"> <span>{{$ctrl.accountDataPassed.displayAccountName}}</span> </td> <td class="c-intendedUse-table__row__text--select"> <div ng-if="$ctrl.isDisabled" class="c-intendedUse-table__row__text--select-disabled-iu-text"> <span>{{$ctrl.showOriginalIntendedUse()}}</span> </div> <div ng-if="!$ctrl.isDisabled"> <tng-select-autocomplete alternate-light="true" ng-required="true" ng-readonly="$ctrl.isDisabled" options="$ctrl.accountDataPassed.intendedUseList[0]" is-static="true" ng-model="$ctrl.account.intendedUseSelected" on-select="$ctrl.handleOptionSelect($ctrl.accountDataPassed.intendedUseList[0], index)" input-id="intendedUse_{{account.account_number}}" option-label-key="name" option-value-key="code" placeholder="{{:: \'global.select\' | translate}}"></tng-select-autocomplete> </div> <div ng-if="!$ctrl.isDisabled && $ctrl.account.intendedUseSelected === $ctrl.INTENDED_USE_OTHER"> <div class="field"> <label for="{{ ::$ctrl.pageId }}_otherIntendedUse" class="top-margin-small"> <div class="c-intendedUse-table--other"> {{ ::\'clientOnboarding.setupAccountForm.labels.otherIntendedUse\' | translate }} </div> </label> <input actionable-id="{{ ::$ctrl.pageId }}_otherIntendedUse" class="c-intendedUse-table--other-input input top-margin-small" type="text" ng-readonly="$ctrl.isDisabled" ng-model="$ctrl.account.otherIntendedUse" ng-blur="$ctrl.handleOtherIntendedUse()" maxlength="60" ng-required="true" ng-pattern="$ctrl.iuphoneNumberPattern" placeholder="{{ ::\'clientOnboarding.setupAccountForm.labels.otherIntendedUsePlaceHolder\' | translate }}"/> </div> </div> </td> </tr> <tr ng-if="!$ctrl.isDisabled && $ctrl.isMobileView"> <td colspan="2"> <div class="field"> <label class="top-margin-small"> {{$ctrl.accountDataPassed.displayAccountName}} </label> <label> <div class="top-margin-small"> {{ ::\'amlConfirmInfo.confirmAccountInfoModal.intendedUse.intendedUseItem.intendedUseDropdown\' | translate }} </div> </label> <div> <tng-select-autocomplete alternate-light="true" ng-required="true" ng-readonly="$ctrl.isDisabled" options="$ctrl.accountDataPassed.intendedUseList[0]" is-static="true" ng-model="$ctrl.account.intendedUseSelected" on-select="$ctrl.handleOptionSelect($ctrl.accountDataPassed.intendedUseList[0], index)" input-id="intendedUse_{{account.account_number}}" option-label-key="name" option-value-key="code" placeholder="select"></tng-select-autocomplete> </div> <div class="field" ng-if="$ctrl.account.intendedUseSelected === $ctrl.INTENDED_USE_OTHER"> <label for="{{ ::$ctrl.pageId }}_otherIntendedUse" class="top-margin-small"> <div class="top-margin-small"> {{ ::\'clientOnboarding.setupAccountForm.labels.otherIntendedUse\' | translate }} </div> </label> <input actionable-id="{{ ::$ctrl.pageId }}_otherIntendedUse" class="input top-margin-small" type="text" ng-readonly="$ctrl.isDisabled" ng-model="$ctrl.account.otherIntendedUse" ng-blur="$ctrl.handleOtherIntendedUse()" maxlength="60" ng-required="true" ng-pattern="$ctrl.iuphoneNumberPattern" placeholder="{{ ::\'clientOnboarding.setupAccountForm.labels.otherIntendedUse\' | translate }}"/> </div> </div> </td> </tr> </tbody> </table> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(33)),a=c(n(92)),s=c(n(0)),r=c(n(2)),o=n(67);function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,i,a,r,c,l){(0,s.default)(this,t),this.$rootScope=e,this.$log=n,this.ReferenceDataService=i,this.AccountHelpersService=a,this.INTENDED_USE_OTHER="OTHER",this.intendedUseAccount=this.inputAccountDetails,this.accountDataPassed={},this.account={},this.alphanumericPattern=o.addressPattern,this.EnvironmentService=r,this.EventBusService=c,this.AMLConfirmInfoConstants=l}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;this.enableAccountHeaders=this.enableAccountHeaders||!1,this.isDisabled=this.isDisabled||!1,this.getTpiDetails(),this.intendedUseAccount.account_number&&(this.accountDataPassed.accountNumber=this.intendedUseAccount.account_number),this.intendedUseAccount.legal_instructions&&(this.account.intendedUseSelected=this.intendedUseAccount.legal_instructions.intended_account_use,this.account.otherIntendedUse=this.intendedUseAccount.legal_instructions.other_intended_use,this.account.originalIntendedUseSelected=this.intendedUseAccount.legal_instructions.original_intended_account_use,this.account.originalOtherIntendedUse=this.intendedUseAccount.legal_instructions.original_other_intended_use),this.isMobileView=this.EnvironmentService.isMobileViewSize(),this.EventBusService.subscribe(this.$rootScope,this.AMLConfirmInfoConstants.USER_INTENDED_USE_FLAG,(function(e,n){t.revertSelectedList(n)}))}},{key:"revertSelectedList",value:function(t){!0===t&&this.intendedUseAccount.legal_instructions&&this.intendedUseAccount.legal_instructions.original_intended_account_use&&(this.account.intendedUseSelected=this.intendedUseAccount.legal_instructions.original_intended_account_use,this.account.otherIntendedUse=this.intendedUseAccount.legal_instructions.original_other_intended_use)}},{key:"showOriginalIntendedUse",value:function(){var t=this,e="";return this.isDisabled&&this.accountDataPassed.intendedUseList&&(e=this.accountDataPassed.intendedUseList[0].find((function(e){return e.code===t.account.originalIntendedUseSelected})).name,this.account.originalIntendedUseSelected===this.INTENDED_USE_OTHER&&(e+=": "+this.account.originalOtherIntendedUse)),e}},{key:"getTpiDetails",value:function(){var t=this;this._getAccountName(this.intendedUseAccount),this.ReferenceDataService.getDataByType(this.ReferenceDataService.TYPES.INTENDED_USE_ACCOUNT).then((function(e){var n=e[t.ReferenceDataService.TYPES.INTENDED_USE_ACCOUNT];t.allIntendedUsesMapped=n.reduce((function(t,e){return(0,a.default)({},t,(0,i.default)({},e.code,e.data))}),{}),t.getAccountDetails(t.intendedUseAccount,t.allIntendedUsesMapped)}))}},{key:"_getAccountName",value:function(t){var e=void 0!==t.account_nick_name&&""!==t.account_nick_name?t.account_nick_name:t.product_description,n=this.AccountHelpersService.getMaskedAccountNumber(t.account_number);this.accountDataPassed.displayAccountName=e+n}},{key:"handleOptionSelect",value:function(t,e){this.$log.debug("Selection Option Object: ",t,"Selected Option index: ",e),this.accountDataPassed.legal_instructions={intended_account_use:this.account.intendedUseSelected},this.updateAccountDetails()}},{key:"handleOtherIntendedUse",value:function(){this.accountDataPassed.legal_instructions={intended_account_use:this.account.intendedUseSelected,other_intended_use:this.account.otherIntendedUse},this.updateAccountDetails()}},{key:"getAccountDetails",value:function(t,e){this.intendedUseList=[],this.intendedUseList.push(e[t.account_type]),this.accountDataPassed.intendedUseList=this.intendedUseList}},{key:"updateAccountDetails",value:function(){this.outputAccountDetails=this.accountDataPassed}}]),t}();l.$inject=["$rootScope","$log","ReferenceDataService","AccountHelpersService","EnvironmentService","EventBusService","AMLConfirmInfoConstants"],e.default=l,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(2202)),a=o(n(4879)),s=o(n(4883)),r=o(n(4884));function o(t){return t&&t.__esModule?t:{default:t}}var c=angular.module("tangerine.amlConfirmInfoModule",[i.default.name]).component("tngAmlConfirmInfo",a.default).constant("AMLConfirmInfoConstants",s.default).service("AMLConfirmInfoFlowService",r.default);e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4880)),a=s(n(4881));function s(t){return t&&t.__esModule?t:{default:t}}n(4882);var r={template:i.default,controller:a.default,bindings:{customer:"<",isBusiness:"<",showCancelButton:"<",onClose:"&",eventType:"<",showSin:"<",isEmployerAddressMandatory:"<",showAsModal:"@"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog class="amlConfirmInfo-container" on-close="$ctrl.onModalClose(result)" hide-close="true" show-confirm-exit="$ctrl.showConfirmExitUI" on-allow-exit="$ctrl.allowExit()" on-deny-exit="$ctrl.denyExit()" is-notification="$ctrl.isNonModal" flow-service="$ctrl.flowService" analytics-id="amlConfirmInfo" show-header="false"> <div class="amlConfirmInfo-container__breadcrumb"> <tng-progress-bar-buttons ng-if="$ctrl.showBreadCrumbs" class="amlConfirmInfo-progress-bar-buttons" total-steps="$ctrl.totalSteps" current-state="$ctrl.currentBreadcrumbState" states="$ctrl.progressBarButtons"> </tng-progress-bar-buttons> </div> <div class="amlConfirmInfo-container__spinner" ng-show="$ctrl.isLoading"> <tng-loading-spinner></tng-loading-spinner> </div> <div class="amlConfirmInfo-container__greeting {{$ctrl.showBreadCrumbs === false ? \'top-margin-large\' : \'\'}}" ng-if="!$ctrl.showConfirmExitUI && !$ctrl.isLoading"> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.PERSONAL_INFO"> <span ng-show="!$ctrl.isBusiness" class="header">{{$ctrl.header}}</span> <p ng-show="!$ctrl.isBusiness" class="medium-width-section description">{{ ::\'amlConfirmInfo.confirmPersonalInfoModal.personal.description\' | translate }}</p> <span ng-show="$ctrl.isBusiness" class="header">{{ ::\'amlConfirmInfo.confirmPersonalInfoModal.business.header\' | translate }}</span> <p ng-show="$ctrl.isBusiness" class="medium-width-section description">{{ ::\'amlConfirmInfo.confirmPersonalInfoModal.business.description\' | translate }}</p> <div ng-show="$ctrl.hasErrors" ng-if="!$ctrl.showBreadCrumbs"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors track by $index">{{error}}</li> </ul> </tng-error-message> </div> <div class="c-basic-info medium-width-section" ng-if="!$ctrl.isLoading && !$ctrl.isBusiness"> <tng-basic-info-form disable-edit="true" customer="$ctrl.customer" on-input-change="$ctrl.onInputChange(data, isValid)" errors="$ctrl.formErrors" show-sin="$ctrl.showSin" show-email="true" sin-required="false" sin-data="$ctrl.customer.sinData" show-validation-on-load="true" show-mailing-address-validation-on-load="true" should-hide-use-legal-name-note="true" show-employer-address="true" show-date-of-birth="$ctrl.enableDateOfBirth()" show-mailing-address="true" show-business-phone="true" validate-po-box="true" show-po-box-validation-on-load="true" show-employment-info-validation-on-load="$ctrl.employerAddressMandatory" employer-address-mandatory="$ctrl.employerAddressMandatory"> </tng-basic-info-form></div> <div class="c-basic-info medium-width-section" ng-if="!$ctrl.isLoading && $ctrl.isBusiness"> <form name="$ctrl.businessConfirmForm" style="width:100%" novalidate="novalidate"> <div class="c-basic-info__edit__field__label"> <label class="heading--sub3">{{ ::\'clientOnboarding.tpiForm.labels.businessName\' | translate }}</label> </div> <input class="input c-basic-info__edit__field__input" type="text" name="businessName" id="businessName" maxlength="40" ng-model="$ctrl.customer.business_name" placeholder="{{ ::\'userSettings.general.basicInfo.editModal.username.label\' | translate }}" disabled="true"/> <div class="c-basic-info__edit__field__label top-margin-large"> <label class="heading--sub3">{{ ::\'amlConfirmInfo.review.tradeName\' | translate }}</label> </div> <input class="input c-basic-info__edit__field__input" type="text" name="tradeName" id="tradeName" maxlength="40" ng-model="$ctrl.customer.trade_name" placeholder="{{ ::\'amlConfirmInfo.review.tradeName\' | translate }}" disabled="true"/> <div class="c-basic-info__edit__field__work clearfix top-margin-large"> <div class="c-basic-info__edit__field__label heading--sub3"> {{ ::\'eNotification.userInfo.phoneNumberBusiness\' | translate }} </div> <tng-phone-num-input class="c-basic-info__edit__field__input--work-phone" actionable-id="businessClientPhone" input-name="businessClientPhone" ng-model="$ctrl.customer.phoneNumbers.BUSINESS.number" on-update="$ctrl.onBusinessInputChange()" ng-required="true" custom-error-msg="{{::\'userSettings.general.basicInfo.validation.phonePattern\' | translate}}" show-validation-on-load="true"> </tng-phone-num-input> <div class="field c-basic-info__edit__field__input--work-phone-ext"> <input class="input" type="tel" maxlength="5" ng-disabled="$ctrl.customer.phoneNumbers.BUSINESS.number === undefined" ng-model="$ctrl.customer.phoneNumbers.BUSINESS.extension" ng-change="$ctrl.onBusinessInputChange()" numeric-input placeholder="{{ ::\'userSettings.general.basicInfo.editModal.workPhone.extPlaceholder\' | translate }}"/> </div> </div> <div class="top-margin-large"> <div class="c-basic-info__edit__field__label heading--sub3"> {{ ::\'eNotification.userInfo.businessAddress\' | translate }} </div> <div class="c-basic-info__edit__field"> <tng-address-form-fields actionable-id="business-address" address-change-form="$ctrl.onBusinessInputChange()" address-line1-max-length="32" address-line2-max-length="32" address-object="$ctrl.customer.addresses.BUSINESS" is-required="true" page-id="confirmInfoBusinessAddress" street-perfect="false" validate-po-box="true" show-validation-on-load="true" show-po-box-validation-on-load="true" show-warning-border="true" is-cif-business-type="true" select-canada-only="true"> </tng-address-form-fields> </div> </div> <div ng-if="$ctrl.isBusinessCountriesVisiable" class="top-margin-large"> <div class="c-basic-info__edit__field__label heading--sub3"> {{ ::\'eNotification.AML_MISSING_INFO.COUNTRIES_OF_BUSINESS\' | translate }} </div> <div class="field" ng-if="$ctrl.isCountriesOperationVisible"> <tng-countries-of-business actionable-id="countriesOperation" country-question-key="eNotification.userInfo.countriesOperation" country-type="$ctrl.eNotificationConstants.BUSINESS_COUNTRY_TYPES.COUNTRIES_OPERATION" countries="$ctrl.countriesWithoutCanada" on-update="$ctrl.validateBusinessCountries(data)" countries-business="$ctrl.countriesOperation"> </tng-countries-of-business> </div> <div class="field" ng-if="$ctrl.isCountriesSuppliersVisible"> <tng-countries-of-business actionable-id="countriesSuppliers" country-question-key="eNotification.userInfo.countriesSuppliers" country-type="$ctrl.eNotificationConstants.BUSINESS_COUNTRY_TYPES.COUNTRIES_SUPPLIERS" countries="$ctrl.countriesWithoutCanada" on-update="$ctrl.validateBusinessCountries(data)" countries-business="$ctrl.countriesSuppliers"> </tng-countries-of-business> </div> <div class="field" ng-if="$ctrl.isCountriesCustomersVisible"> <tng-countries-of-business actionable-id="countriesCustomers" country-question-key="eNotification.userInfo.countriesCustomers" country-type="$ctrl.eNotificationConstants.BUSINESS_COUNTRY_TYPES.COUNTRIES_CUSTOMERS" countries="$ctrl.countriesWithoutCanada" on-update="$ctrl.validateBusinessCountries(data)" countries-business="$ctrl.countriesCustomers"> </tng-countries-of-business> </div> <div class="field" ng-if="$ctrl.isCountriesAffiliateVisible"> <tng-countries-of-business actionable-id="countriesAffiliate" country-question-key="eNotification.userInfo.countriesAffiliate" country-type="$ctrl.eNotificationConstants.BUSINESS_COUNTRY_TYPES.COUNTRIES_AFFILIATE" countries="$ctrl.countriesWithoutCanada" on-update="$ctrl.validateBusinessCountries(data)" countries-business="$ctrl.countriesAffiliate"> </tng-countries-of-business> </div> <div class="field" ng-if="$ctrl.isCountriesCharityServiceVisible"> <label>{{ :: \'eNotification.userInfo.charityService\' | translate }}</label> <tng-countries-of-business actionable-id="countriesCharityService" country-question-key="eNotification.userInfo.countriesCharityService" country-type="$ctrl.eNotificationConstants.BUSINESS_COUNTRY_TYPES.COUNTRIES_CHARITY_SERVICE" countries="$ctrl.countriesWithoutCanada" on-update="$ctrl.validateBusinessCountries (data)" countries-business="$ctrl.countriesCharityService"> </tng-countries-of-business> </div> </div> <div ng-if="$ctrl.customer.show_director" class="top-margin-large"> <div class="c-basic-info__edit__field__label heading--sub3"> {{ ::\'eNotification.AML_MISSING_INFO.DIRECTOR\' | translate }} </div> <div ng-if="$ctrl.customer.not_missing_business_director"> <tng-director-beneficial-owner actionable-id="section-business-director" type="$ctrl.customerConstants.BUSINESS_INVOLVED_PARTY_TYPE.DIRECTOR" data="$ctrl.customer.directors" on-update="$ctrl.validateDirectors(data)"> </tng-director-beneficial-owner> </div> <div ng-if="$ctrl.customer.missing_business_director"> <p>{{ ::\'eNotification.AML_MISSING_INFO.messages.directorOwner\' | translate }}</p> </div> <div ng-if="$ctrl.customer.missing_business_pending_director"> <p>{{ ::\'eNotification.AML_MISSING_INFO.messages.directorPR\' | translate }}</p> </div> </div> <div ng-if="$ctrl.customer.show_beneficial_owner" class="top-margin-large"> <div class="c-basic-info__edit__field__label heading--sub3"> {{ ::\'eNotification.AML_MISSING_INFO.BENEFICIAL_OWNER\' | translate }} </div> <div ng-if="$ctrl.customer.not_missing_business_beneficial_owner"> <p>{{ ::\'eNotification.AML_MISSING_INFO.messages.beneficialOwner1\' | translate }}</p> <p>{{ ::\'eNotification.AML_MISSING_INFO.messages.beneficialOwner2\' | translate }}</p> <div class="c-basic-info__edit__field__label heading--sub3"> <p>{{ ::\'eNotification.AML_MISSING_INFO.BENEFICIAL_OWNER_UBO\' | translate }}</p> </div> <div ng-if="!$ctrl.isUltimateBeneficialOwner">{{ ::\'eNotification.AML_MISSING_INFO.messages.noUltimateBeneficialOwner\' | translate }} </div> <tng-director-beneficial-owner ng-if="$ctrl.ultimateBeneficialOwnerList.length > 0" actionable-id="section-business-bo" type="$ctrl.customerConstants.BUSINESS_INVOLVED_PARTY_TYPE.BENEFICIAL_OWNER" data="$ctrl.ultimateBeneficialOwnerList" on-update="$ctrl.validateUltimateBeneficialOwners(data)"> </tng-director-beneficial-owner> <div class="c-basic-info__edit__field__label intermediary-owner heading--sub3"> <p>{{ ::\'eNotification.AML_MISSING_INFO.BENEFICIAL_OWNER_IO\' | translate }}</p> </div> <div ng-if="!$ctrl.isIntermediaryOwner">{{ ::\'eNotification.AML_MISSING_INFO.messages.noIntermediaryBeneficialOwner\' | translate }} </div> <tng-director-beneficial-owner ng-if="$ctrl.intermediaryOwnerList.length > 0" actionable-id="section-business-bo" type="$ctrl.customerConstants.BUSINESS_INVOLVED_PARTY_TYPE.BENEFICIAL_OWNER" data="$ctrl.intermediaryOwnerList" on-update="$ctrl.validateIntermediaryBeneficialOwners(data)"> </tng-director-beneficial-owner> </div> <div ng-if="$ctrl.customer.missing_business_beneficial_owner"> <p>{{ ::\'eNotification.AML_MISSING_INFO.messages.beneficialOwnerMissing\' | translate }}</p> </div> <div ng-if="$ctrl.customer.has_no_beneficial_owner"> <p>{{ ::\'eNotification.AML_MISSING_INFO.messages.noUltimateOwner\' | translate }}</p> </div> <div ng-if="$ctrl.customer.missing_business_pending_beneficial_owner"> <p ng-bind-html="::\'eNotification.AML_MISSING_INFO.messages.beneficialOwnerPending1\' | translate: { returnDate: $ctrl.customer.beneficial_owner_pending_attestation_return_date}"></p> <p>{{ ::\'eNotification.AML_MISSING_INFO.messages.beneficialOwnerPending2\' | translate }}</p> </div> </div> </form> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.ACCOUNT_INFO"> <span class="header">{{ ::\'amlConfirmInfo.confirmAccountInfoModal.header\' | translate }}</span> <div ng-if="$ctrl.isIntendedUseValid()"> <p class="description">{{ ::\'amlConfirmInfo.confirmAccountInfoModal.description\' | translate }}</p> </div> <div ng-repeat="item in $ctrl.intendedUseList track by $index"> <div class="amlConfirmInfo-container" ng-if="item.missing_intended_use === true"> <tng-iu-item index="$index" customer="$ctrl.customer" account="item" parent-ctrl="$ctrl" display-account-headers="item.isFirstMissingIU"></tng-iu-item> </div> <div class="c-basic-info medium-width-section" ng-if="item.missing_third_party === true"> <tng-tpi-item index="$index" customer="$ctrl.customer" account="item" parent-ctrl="$ctrl"></tng-tpi-item> </div> </div> <div class="amlConfirmInfo-container__allNonMissingTpiIuList-container" ng-if="$ctrl.allNonMissingTpiIuList.length > 0"> <span class="medium-width-section header">{{ ::\'amlConfirmInfo.confirmAccountInfoModal.intendedUse.accountsIU.title\' | translate }}</span> <p class="description">{{ ::\'amlConfirmInfo.confirmAccountInfoModal.intendedUse.accountsIU.description01\' | translate }}</p> <p class="description">{{ ::\'amlConfirmInfo.confirmAccountInfoModal.intendedUse.accountsIU.description02\' | translate }} </p> <div class="yesNoRadioButtons field__group--inline top-margin-medium"> <div class="field"> <tng-yes-no-toggle-input input-id="changeIUaccounts" tng-model="$ctrl.account.legal_instructions.intended_account_use" tng-required="true" tng-change="$ctrl.enableEditExistingIU()"></tng-yes-no-toggle-input> </div> </div> <div class="amlConfirmInfo-container__allNonMissingTpiIuList"> <div ng-repeat="item in $ctrl.allNonMissingTpiIuList track by $index"> <tng-iu-item index="$index" customer="$ctrl.customer" account="item" parent-ctrl="$ctrl" display-account-headers="($index === 0) ? true : false" edit-data="!$ctrl.enableEdit" simple-header-account="{{ ::\'amlConfirmInfo.confirmAccountInfoModal.intendedUse.headers.account\' | translate }}" simple-header-intended-use="{{ ::\'amlConfirmInfo.confirmAccountInfoModal.intendedUse.headers.intendedUse\' | translate }}"></tng-iu-item> </div> </div> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW"> <div ng-show="$ctrl.hasErrors" ng-if="$ctrl.showBreadCrumbs"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors track by $index">{{error}}</li> </ul> </tng-error-message> </div> <span class="header">{{ ::\'amlConfirmInfo.review.header\' | translate }}</span> <div class="amlConfirmInfo-container"> <tng-review-item customer="$ctrl.newCustomer" account="list" parent-ctrl="$ctrl" show-sin="$ctrl.showSin" user-type-business="$ctrl.isBusiness" customer-info-state="$ctrl.flowService.STATES.PERSONAL_INFO" iu-tpi-info-state="$ctrl.flowService.STATES.ACCOUNT_INFO"></tng-review-item> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DONE"> <span class="header">{{ ::\'amlConfirmInfo.done.header\' | translate }}</span> <p class="description">{{ ::\'amlConfirmInfo.done.description\' | translate }}</p> </div> </div> <footer ng-if="!$ctrl.isLoading"> <tng-page-flow-controls flow-service="$ctrl.flowService"></tng-page-flow-controls> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=p(n(528)),a=p(n(365)),s=p(n(8)),r=p(n(0)),o=p(n(2)),c=p(n(1800)),l=p(n(1801)),u=p(n(143)),d=p(n(534)),h=p(n(366)),f=p(n(367));function p(t){return t&&t.__esModule?t:{default:t}}var g=function(){function t(e,n,i,a,o,c,l,u,d,h,f,p,g,m,_,v,S,T,y){(0,r.default)(this,t),(0,s.default)(this,{$q:e,$log:n,$timeout:i,$translate:a,AccountDetailsService:o,accountConstants:c,SessionService:u,CustomerInfoService:d,UserSettingsConstants:h,customerConstants:f,eNotificationConstants:p,ReferenceDataService:g,AMLConfirmInfoConstants:l,AccountHelpersService:_,tpiFormConstants:v,$rootScope:S,EnvironmentService:T,eventConstants:y}),this.showConfirmExitUI=!1,this.amlConfirmInfoConstant=l,this.flowService=m,this.AccountHelpersService=_,this.changedIUdata={}}return(0,o.default)(t,[{key:"$onInit",value:function(){var t=this;this.intendedUseTpiReviewHelper=new d.default(this.$log,this.EnvironmentService,this.CustomerInfoService),this.isLoading=!0,this.flowService.activate(),this.verifyCurrentState(),this.flowService.onButtonClickCancel=function(){t.onCloseByClick()},this.flowService.onButtonClickBack=function(){t.onBackClick()},this.flowService.onButtonClickConfirm=function(){t.onConfirmInfo()},this.flowService.onButtonClickNext=function(){t.onNextClick()},this.flowService.onButtonClickSave=function(){t.onConfirmInfo()},this.flowService.onButtonClickDone=function(){t.onDoneClick()},this.flowService.onButtonClickSetState=function(){t.checkValidStateForAccountInfo()},this.isBusiness?this._initializeBusiness():(this.employerAddressMandatory=this.isEmployerAddressMandatory,this.isEmployerAddressMandatory||h.default.isEmployerAddressMandatory(this.AccountDetailsService,this.accountConstants).then((function(e){t.employerAddressMandatory=e})),this.missingDateOfBirth=void 0===this.customer.date_of_birth),this.originalCustomer=angular.copy(this.customer),h.default.prepareCustomerInfoConfirm(this.customer),this.isNonModal=!this.showAsModal||this.showAsModal,this.showConfirmExitUI=!1,this.intendedUseList={},this.showBreadCrumbs=!1,this._checkIntendedUseList(),this._prepareBreadCrumbs(),this.newCustomer={}}},{key:"_initializeBusiness",value:function(){this.isValidUBO(),this.isUltimateBeneficialOwner=!1,this.isBusinessCountriesVisiable=!0,this.countriesCharityService={},this.isIntermediaryOwner=!1,this.customer.business_countries&&this.customer.business_countries.length>0?this._prepareExistingCountries():(this.isCountriesSuppliersVisible=!0,this.isCountriesCustomersVisible=!0,this.isCountriesAffiliateVisible=!0,this.isCountriesOperationVisible=!0,this.countriesAffiliate={},this.countriesCustomers={},this.countriesSuppliers={},this.countriesOperation={},this._prepareCountriesCharityservice()),this.customer.not_missing_business_director&&this.customer.directors&&this.customer.directors.forEach((function(t){t.date_of_birth=moment(t.date_of_birth)})),this.customer.not_missing_business_beneficial_owner&&this.customer.beneficial_owners&&this.customer.beneficial_owners.forEach((function(t){t.date_of_birth=moment(t.date_of_birth)}))}},{key:"$onDestroy",value:function(){this.intendedUseTpiReviewHelper.resetAllItemsList(),this.flowService.deactivate()}},{key:"isIntendedUseValid",value:function(){return this.intendedUseTpiReviewHelper.isIntendedUseMissing||this.intendedUseTpiReviewHelper.isThirdPartyMissing}},{key:"_checkIntendedUseList",value:function(){if(this.missingIUList=[],this.missingTPIList=[],this.allNonMissingTpiIuList=[],this.customer&&this.customer.intended_use_list&&this.customer.intended_use_list.length>0){var t=h.default.populateIntendedUseList(this.customer.intended_use_list,this.AccountHelpersService);this.showBreadCrumbs=!0,this.intendedUseList=this.customer.intended_use_list,this.missingIUList=t.missingIUList,this.missingTPIList=t.missingTPIList,this.allNonMissingTpiIuList=t.allNonMissingTpiIuList,this.getAllIuItemValidObj=t.getAllIuItemValidObj,this.getAllTpiItemValidObj=t.getAllTpiItemValidObj,this.getAllNonMissingIUItemValidObj=t.getAllNonMissingIUItemValidObj,this.intendedUseTpiReviewHelper.allIntendedUseListData=this.intendedUseList,this.intendedUseTpiReviewHelper.missingIntendedUseList=this.missingIUList,this.intendedUseTpiReviewHelper.missingThirdPartyList=this.missingTPIList,this.intendedUseTpiReviewHelper.nonMissingIntendedUseList=this.allNonMissingTpiIuList,this.intendedUseTpiReviewHelper.getAllIuItemValidObj=this.getAllIuItemValidObj,this.intendedUseTpiReviewHelper.getAllTpiItemValidObj=this.getAllTpiItemValidObj,this.intendedUseTpiReviewHelper.getAllNonMissingIUItemValidObj=this.getAllNonMissingIUItemValidObj}this.flowService.isBusiness=this.isBusiness,this.flowService.showCancelButton=this.showCancelButton,this.flowService.showNextButton=this.showBreadCrumbs,this.flowService.showSaveButton=this.isBusiness&&!this.showBreadCrumbs,this.flowService.showConfirmButton=!this.isBusiness&&!this.showBreadCrumbs,this.flowService.reapplyUIState(),this.isLoading=!1}},{key:"_prepareBreadCrumbs",value:function(){var t=this;this.totalSteps=[],this.progressBarButtons=[],(this.isBusiness?this.amlConfirmInfoConstant.BREADCRUMB_BUSINESS_KEYS:this.amlConfirmInfoConstant.BREADCRUMB_PERSONAL_KEYS).forEach((function(e){t.totalSteps.push({stateKey:e}),t.progressBarButtons.push({stateKey:e,titleKey:t.$translate.instant("amlConfirmInfo.breadcrumb.progressBar."+e)})})),this.currentBreadcrumbState=this.currentBreadcrumb()}},{key:"currentBreadcrumb",value:function(){var t=this,e=void 0;return this.progressBarButtons.forEach((function(n){n.stateKey===t.flowService.currentState.key&&(e=n)})),e}},{key:"onEditClickFromReview",value:function(t){t&&(this.flowService.moveTo(t),this.currentBreadcrumbState=this.currentBreadcrumb())}},{key:"getAccountName",value:function(t){return(void 0!==t.account_nick_name&&""!==t.account_nick_name?t.account_nick_name:t.product_description)+this.AccountHelpersService.getMaskedAccountNumber(t.account_number)}},{key:"showExistingIU",value:function(){return this.intendedUseTpiReviewHelper.isIntendedUseMissing&&this.intendedUseTpiReviewHelper.isThirdPartyMissing}},{key:"enableEditExistingIU",value:function(){this.enableEdit=this.account.legal_instructions.intended_account_use,this.intendedUseTpiReviewHelper.isExistingIUchangedFlag=this.account.legal_instructions.intended_account_use,this.enableEdit||this._revertAllNonMissingTpiIuList()}},{key:"_revertAllNonMissingTpiIuList",value:function(){this.customer&&this.customer.intended_use_list&&this.customer.intended_use_list.length>0&&this.customer.intended_use_list.forEach((function(t){t.legal_instructions&&t.legal_instructions.original_intended_account_use&&(t.legal_instructions.intended_account_use=t.legal_instructions.original_intended_account_use,t.legal_instructions.other_intended_use=t.legal_instructions.original_other_intended_use)}))}},{key:"changeExistingIu",value:function(){return void 0!==this.changedIUdata.legal_instructions&&this.enableEdit&&(this.prepareIuData(this.changedIUdata),this.changedIuType=this.changedIUdata.legal_instructions.intended_account_use),this.changedIuType}},{key:"prepareIuData",value:function(t){var e=this.customer.intended_use_list.find((function(e){return e.account_number===t.accountNumber}));e.legal_instructions.intended_account_use=t.legal_instructions.intended_account_use,e.legal_instructions.other_intended_use=t.legal_instructions.other_intended_use}},{key:"onNextClick",value:function(){this.newCustomer=angular.copy(this.customer),this.isBusiness?this._prepareBusinessConfirmation(this.newCustomer):this._updateMailingAddress(this.newCustomer),this.flowService.gotoNextState(),this.currentBreadcrumbState=this.currentBreadcrumb(),this.resetSubmitErrors()}},{key:"_updateMailingAddress",value:function(t){t.extraData&&!t.extraData.mailingAddressDifferent&&(t.addresses.MAILING=(0,s.default)({},t.addresses.HOME),t.addresses.MAILING.address_type=this.customerConstants.API.ADDRESS_TYPE.MAILING),t.addresses.HOME.address_line2&&0!==t.addresses.HOME.address_line2.length||delete t.addresses.HOME.address_line2,t.addresses.MAILING.address_line2&&0!==t.addresses.MAILING.address_line2.length||delete t.addresses.MAILING.address_line2,t.address_list=(0,a.default)(t.addresses)}},{key:"_updateMobilePhoneNumber",value:function(t){var e=this;t.phone_list.forEach((function(n){t.mobilePhoneNumber=e.customer.phoneNumbers.CELL.number,n.type===e.amlConfirmInfoConstant.PHONE_TYPE.CELL&&(""!==n.number?t.mobilePhoneNumber=n.number:t.mobilePhoneNumber="")}))}},{key:"onBackClick",value:function(){this.flowService.goBack(),this.currentBreadcrumbState=this.currentBreadcrumb()}},{key:"saveExistingIUInfo",value:function(){this.flowService.currentState===this.amlConfirmInfoConstant.STATES.ACCOUNT_INFO&&this.changeExistingIu()}},{key:"enableDateOfBirth",value:function(){return this.missingDateOfBirth}},{key:"_prepareCountriesCharityservice",value:function(){this.isCountriesCharityServiceVisible=this.customer.show_charity_service_country}},{key:"validateDirectors",value:function(t){this.customer.directors=t,this.onBusinessInputChange()}},{key:"validateUltimateBeneficialOwners",value:function(t){var e=this._updateBeneficialOwner(!0);this.customer.beneficial_owners=e.concat(t),this.onBusinessInputChange(),this.isValidUBO()}},{key:"validateIntermediaryBeneficialOwners",value:function(t){var e=this._updateBeneficialOwner(!1);this.customer.beneficial_owners=e.concat(t),this.onBusinessInputChange(),this.isValidUBO()}},{key:"_updateBeneficialOwner",value:function(t){var e=angular.copy(this.customer.beneficial_owners),n=[];if(!0===t)for(var i=0;i<e.length;i++)e[i].beneficial_owner_type===this.customerConstants.BENEFICIAL_OWNER_TYPE.BUSINESS&&n.push(e[i]);else for(var a=0;a<e.length;a++)e[a].beneficial_owner_type===this.customerConstants.BENEFICIAL_OWNER_TYPE.PERSON&&n.push(e[a]);return n}},{key:"_validateDirectorsBO",value:function(){var t=this,e=!1;return this.$timeout((function(){t.not_missing_business_director&&(e=!(t.customer.directors&&0!==t.customer.directors.length)),!e&&t.not_missing_business_beneficial_owner&&(e=!(t.customer.beneficial_owners&&0!==t.customer.beneficial_owners.length))}),0),e}},{key:"_prepareExistingCountries",value:function(){var t=this,e=this.eNotificationConstants;this.ReferenceDataService.getDataByType(this.ReferenceDataService.TYPES.COUNTRIES).then((function(n){t.countriesWithoutCanada=n[t.ReferenceDataService.TYPES.COUNTRIES].filter((function(t){return"CA"!==t.code})),t.customer.business_countries.forEach((function(n){n.business_country_type===e.BUSINESS_COUNTRY_TYPES.COUNTRIES_OPERATION?(t.isCountriesOperationVisible=!0,t.countriesOperation={country_list:t._prepareCountryList(n.country_list),countries_other_than_canada:n.countries_other_than_canada,business_country_type:e.BUSINESS_COUNTRY_TYPES.COUNTRIES_OPERATION}):n.business_country_type===e.BUSINESS_COUNTRY_TYPES.COUNTRIES_CUSTOMERS?(t.isCountriesCustomersVisible=!0,t.countriesCustomers={country_list:t._prepareCountryList(n.country_list),countries_other_than_canada:n.countries_other_than_canada,business_country_type:e.BUSINESS_COUNTRY_TYPES.COUNTRIES_CUSTOMERS}):n.business_country_type===e.BUSINESS_COUNTRY_TYPES.COUNTRIES_SUPPLIERS?(t.isCountriesSuppliersVisible=!0,t.countriesSuppliers={country_list:t._prepareCountryList(n.country_list),countries_other_than_canada:n.countries_other_than_canada,business_country_type:e.BUSINESS_COUNTRY_TYPES.COUNTRIES_SUPPLIERS}):n.business_country_type===e.BUSINESS_COUNTRY_TYPES.COUNTRIES_AFFILIATE?(t.isCountriesAffiliateVisible=!0,t.countriesAffiliate={country_list:t._prepareCountryList(n.country_list),countries_other_than_canada:n.countries_other_than_canada,business_country_type:e.BUSINESS_COUNTRY_TYPES.COUNTRIES_AFFILIATE}):n.business_country_type===e.BUSINESS_COUNTRY_TYPES.COUNTRIES_CHARITY_SERVICE&&(t.isCountriesCharityServiceVisible=!0,t.countriesCharityService={country_list:t._prepareCountryList(n.country_list),countries_other_than_canada:n.countries_other_than_canada,business_country_type:e.BUSINESS_COUNTRY_TYPES.COUNTRIES_CHARITY_SERVICE}),t._prepareCountriesCharityservice()}))}))}},{key:"_prepareCountryList",value:function(t){var e=this,n=[];return t&&t.length>0&&t.forEach((function(t){n.push((0,u.default)(e.countriesWithoutCanada,{code:t}))})),n}},{key:"onInputChange",value:function(t,e){var n=this;this.customer=t,this.isInvalid=!e,e?this.$timeout((function(){n.isInvalid=h.default.isValidNonMandatoryEmployerAddress(n.customer,n._isEmployed(),n.employerAddressMandatory),n.flowService.onEnableNext(!n.isInvalid)}),0):this.flowService.onEnableNext(this.isValid)}},{key:"onBusinessInputChange",value:function(){var t=this;this.$timeout((function(){t.isInvalid=!t.businessConfirmForm||(t.businessConfirmForm.$invalid||t._validateBusinessCountries()||t._validateDirectorsBO()),t.flowService.onEnableNext(!t.isInvalid)}),0)}},{key:"validateBusinessCountries",value:function(t){var e=this.eNotificationConstants;this.isCountriesOperationVisible&&t.business_country_type===e.BUSINESS_COUNTRY_TYPES.COUNTRIES_OPERATION&&(this.countriesOperation=t),this.isCountriesSuppliersVisible&&t.business_country_type===e.BUSINESS_COUNTRY_TYPES.COUNTRIES_SUPPLIERS&&(this.countriesSuppliers=t),this.isCountriesCustomersVisible&&t.business_country_type===e.BUSINESS_COUNTRY_TYPES.COUNTRIES_CUSTOMERS&&(this.countriesCustomers=t),this.isCountriesAffiliateVisible&&t.business_country_type===e.BUSINESS_COUNTRY_TYPES.COUNTRIES_AFFILIATE&&(this.countriesAffiliate=t),this.isCountriesCharityServiceVisible&&t.business_country_type===e.BUSINESS_COUNTRY_TYPES.COUNTRIES_CHARITY_SERVICE&&(this.countriesCharityService=t),this.onBusinessInputChange()}},{key:"_validateBusinessCountries",value:function(){var t=!1;return this.countriesOperation&&(t=t||this._isInvalidCountriesOfBusiness(this.countriesOperation)),this.countriesSuppliers&&(t=t||this._isInvalidCountriesOfBusiness(this.countriesSuppliers)),this.countriesCustomers&&(t=t||this._isInvalidCountriesOfBusiness(this.countriesCustomers)),this.countriesAffiliate&&(t=t||this._isInvalidCountriesOfBusiness(this.countriesAffiliate)),this.isCountriesCharityServiceVisible&&(t=t||this._isInvalidCountriesOfBusiness(this.countriesCharityService)),t}},{key:"_isInvalidCountriesOfBusiness",value:function(t){var e=!0;return t&&t.business_country_type&&(!t.countries_other_than_canada||t.countries_other_than_canada&&t.country_list&&t.country_list.length>0)&&(e=!1),e}},{key:"verifyCurrentState",value:function(){if(this.header=this.$translate.instant("amlConfirmInfo.confirmInfoHeaders.header"),void 0!==this.eventType)switch(this.eventType){case this.eventConstants.OPEN_ACCOUNT_CONFIRM_INFO_EVENT:this.header=this.$translate.instant("amlConfirmInfo.confirmInfoHeaders.openAccount");break;case this.eventConstants.ADD_AUTHORIZED_USER_CONFIRM_INFO_EVENT:this.header=this.$translate.instant("amlConfirmInfo.confirmInfoHeaders.addAuthorized");break;case this.eventConstants.TAX_RESIDENCY_CONFIRM_INFO_EVENT:this.header=this.$translate.instant("amlConfirmInfo.confirmInfoHeaders.taxResidency");break;case this.eventConstants.CREDIT_CARD_REWARDS_OPEN_ACCOUNT_CONFIRM_INFO_EVENT:this.header=this.$translate.instant("amlConfirmInfo.confirmInfoHeaders.creditCard");break;case this.eventConstants.FUTURE_ADDRESS_CONFIRM_INFO_EVENT:this.header=this.$translate.instant("amlConfirmInfo.confirmInfoHeaders.futureAddress");break;default:this.header=this.$translate.instant("amlConfirmInfo.confirmInfoHeaders.header")}}},{key:"onConfirmInfo",value:function(){var t=this,e=h.default.updateCustomerObject(this.customer);this.isBusiness?this._prepareBusinessConfirmation(e):this._updateMailingAddress(e),this.resetSubmitErrors(),this.isLoading=!0,h.default.cleanCustomerDataBeforeSubmit(e.intended_use_list,this.tpiFormConstants,this.AMLConfirmInfoConstants),this.CustomerInfoService.update(e).then((function(){t.SessionService.amlEventConfirmed=!0,t.SessionService.showAMLConfirmInfo=!1,t.SessionService.saveSession(),t.showWarningOnExit=!1})).catch((function(e){t.showSubmitErrors(e),t.showBreadCrumbs&&t.flowService.moveTo(t.flowService.STATES.REVIEW)})).finally((function(){t.isLoading=!1,t.hasErrors||(t.showBreadCrumbs?(t.showBreadCrumbs=!1,t.flowService.moveTo(t.flowService.STATES.DONE)):t.onDoneClick())}))}},{key:"_prepareBusinessConfirmation",value:function(t){if((t.missing_business_beneficial_owner||t.missing_business_pending_beneficial_owner)&&(t.missing_business_beneficial_owner=!0),(t.missing_business_director||t.missing_business_pending_director)&&(t.missing_business_director=!0),this.isBusinessCountriesVisiable){var e=[];this.countriesOperation&&e.push(this._parseCountryList(this.countriesOperation)),this.countriesSuppliers&&e.push(this._parseCountryList(this.countriesSuppliers)),this.countriesCustomers&&e.push(this._parseCountryList(this.countriesCustomers)),this.countriesAffiliate&&e.push(this._parseCountryList(this.countriesAffiliate)),this.isCountriesCharityServiceVisible&&e.push(this._parseCountryList(this.countriesCharityService)),e.length>0&&(t.business_countries=e)}t.directors&&t.directors.forEach((function(t){t.date_of_birth=moment(t.date_of_birth).format("YYYY-MM-DD")})),t.beneficial_owners&&t.beneficial_owners.forEach((function(t){t.date_of_birth=moment(t.date_of_birth).format("YYYY-MM-DD")}))}},{key:"_parseCountryList",value:function(t){var e=angular.copy(t);if(e.countries_other_than_canada){if(e.country_list&&e.country_list.length>0){var n=[];e.country_list.forEach((function(t){n.push(t.code)})),e.country_list=n}}else delete e.country_list;return e}},{key:"_filterOutCanada",value:function(){return this.originalCountries.filter((function(t){return"CA"!==t.code}))}},{key:"onModalClose",value:function(){var t=this;this.$timeout((function(){t.showWarningOnExit=!0,t._warnOnExit().then((function(){t.resetSubmitErrors(),t.showWarningOnExit=!1,t._close()})).catch((function(){}))}))}},{key:"_close",value:function(){this.showWarningOnExit?this.resetSubmitErrors():this.onClose()}},{key:"onCloseByClick",value:function(){var t=this;this.$timeout((function(){t.showWarningOnExit=!0,t._warnOnExit().then((function(){t.intendedUseTpiReviewHelper.resetAllItemsList(),t.resetSubmitErrors(),t.showWarningOnExit=!1,t._close(),t.eventType&&t.eventType===t.eventConstants.CREDIT_CARD_REWARDS_OPEN_ACCOUNT_CONFIRM_INFO_EVENT&&t.$rootScope.$broadcast(t.eventConstants.CREDIT_CARD_REWARDS_OPEN_ACCOUNT_CONFIRM_INFO_CANCEL_EVENT)})).catch((function(){}))}))}},{key:"onDoneClick",value:function(){this._close(),this.eventType&&this.eventType.length>0&&this.$rootScope.$broadcast(this.eventType)}},{key:"_isEmployed",value:function(){return!!this.customer.employment_status&&-1!==this.UserSettingsConstants.EMPLOYED_STATUS_CODES.indexOf(this.customer.employment_status.code)}},{key:"resetSubmitErrors",value:function(){this.submitErrors=[],this.hasErrors=null}},{key:"showSubmitErrors",value:function(t){var e=this;this.resetSubmitErrors();var n=this.customerConstants.API.RESPONSE_CODES,a=n.VALIDATION_ERROR,s=n.UPDATE_FAILURE,r=n.INVALID_REQUEST_BODY,o=t.response_status.status_code;if(-1!==[a].indexOf(o))if("status_code"in t.response_status)if("details"in t.response_status){var c={profanity:new i.default([["legal_instructions.third_party_info.person_info.first_name","global.errorCodes.12008"],["legal_instructions.third_party_info.person_info.last_name","global.errorCodes.12013"],["legal_instructions.third_party_info.relationship_other","global.errorCodes.12004"],["legal_instructions.other_intended_use","global.errorCodes.41107"]])};t.response_status.details.forEach((function(n){var i=n.description||n.technical_description,a=c[i];if(a){var s=a.get(n.field_name);e.submitErrors.push(e.$translate.instant(s))}else{var r=f.default.getEmployerErrorCode(n);r?e.submitErrors.push(e.$translate.instant(r)):e.submitErrors.push(e.$translate.instant("global.errorCodes."+t.response_status.return_code))}}))}else this.submitErrors.push(this.$translate.instant("global.errorCodes."+t.response_status.return_code));else this.submitErrors.push(this.$translate.instant("global.errorCodes.VALIDATION_ERROR"));else-1!==[s,r].indexOf(o)&&this.submitErrors.push(this.$translate.instant("global.errorCodes.SYSTEM_ERROR"));this.submitErrors&&this.submitErrors.length>0&&(this.hasErrors=!0),this.$log.debug("formatted error:",this.submitErrors)}},{key:"_warnOnExit",value:function(){var t=this;this.showConfirmExitUI=!0;var e=this.$q((function(e,n){t.allowExit=function(){t.showConfirmExitUI=!1,e("user accepted navigation")},t.denyExit=function(){t.showConfirmExitUI=!1,n("user rejected navigation")}}));return this.showWarningOnExit||this.allowExit(),e}},{key:"isValidUBO",value:function(){var t=this;this.ultimateBeneficialOwnerList=[],this.intermediaryOwnerList=[],this.beneficialOwners=this.customer.beneficial_owners,this.beneficialOwners&&this.beneficialOwners.forEach((function(e){"PERSON"===e.beneficial_owner_type?(t.isUltimateBeneficialOwner=!0,t.ultimateBeneficialOwnerList.push(e)):"BUSINESS"===e.beneficial_owner_type&&(t.isIntermediaryOwner=!0,t.intermediaryOwnerList.push(e))}))}},{key:"_prepareConfirmInfoCustomer",value:function(){delete this.customer.dateOfBirth,this.customer.employer&&this.customer.employer.company_address&&(this.customer.employer.company_address=h.default.setEmployerAddressLine1(this.customer.employer.company_address))}},{key:"checkValidStateForAccountInfo",value:function(){this.checkIuTpiFormValid()}},{key:"checkIuTpiFormValid",value:function(){var t=(0,l.default)(this.intendedUseTpiReviewHelper.getAllIuItemValidObj,this.intendedUseTpiReviewHelper.getAllTpiItemValidObj,this.intendedUseTpiReviewHelper.getAllNonMissingIUItemValidObj);this.flowService.onEnableNext((0,c.default)(t,["enableNext",!0]))}}]),t}();g.$inject=["$q","$log","$timeout","$translate","AccountDetailsService","accountConstants","AMLConfirmInfoConstants","SessionService","CustomerInfoService","UserSettingsConstants","customerConstants","eNotificationConstants","ReferenceDataService","AMLConfirmInfoFlowService","AccountHelpersService","tpiFormConstants","$rootScope","EnvironmentService","eventConstants"],e.default=g,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={PERSONAL_INFO:{key:"PERSONAL_INFO",titleKey:"amlConfirmInfo.breadcrumb.progressBar.PERSONAL_INFO"},BUSINESS_INFO:{key:"BUSINESS_INFO",titleKey:"amlConfirmInfo.breadcrumb.progressBar.BUSINESS_INFO"},ACCOUNT_INFO:{key:"ACCOUNT_INFO",titleKey:"amlConfirmInfo.breadcrumb.progressBar.ACCOUNT_INFO"},REVIEW:{key:"REVIEW",titleKey:"amlConfirmInfo.breadcrumb.progressBar.REVIEW"},DONE:{key:"DONE",titleKey:"amlConfirmInfo.breadcrumb.progressBar.REVIEW"}},a=[i.PERSONAL_INFO.key,i.ACCOUNT_INFO.key,i.REVIEW.key],s=[i.BUSINESS_INFO.key,i.ACCOUNT_INFO.key,i.REVIEW.key];e.default={STATES:i,BREADCRUMB_PERSONAL_KEYS:a,BREADCRUMB_BUSINESS_KEYS:s,OTHER_INTENDED_USE:{TYPE:"OTHER"},PHONE_TYPE:{HOME:"HOME",CELL:"CELL",BUSINESS:"BUSINESS"},CORPORATION_BUSINESS:{CORPORATION:"CORPORATION"},BUSINESS_TYPE:{INDIVIDUAL:"INDIVIDUAL",BUSINESS:"BUSINESS",PERSON:"PERSON"},USER_INTENDED_USE_FLAG:"USER_INTENDED_USE_FLAG"},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(92)),a=d(n(177)),s=d(n(0)),r=d(n(2)),o=d(n(264)),c=d(n(266)),l=d(n(265)),u=n(267);function d(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(t,n,r,c,l,u,d,h,f,p,g,m,_,v){(0,s.default)(this,e);var S=(0,o.default)(this,(e.__proto__||(0,a.default)(e)).call(this,t,n,r,c,l,d,u,f));return S.$log=t,S.$state=c,S.BUTTON_TYPES=(0,i.default)({},u.BUTTON_TYPES),S.stateConstants=h,S.$timeout=p,S.intendedUseTpiReviewConstants=g,S.EnvironmentService=m,S.AccountHelpersService=_,S.AnchorService=v,S.STATES=S.intendedUseTpiReviewConstants.STATES,S._initialState=S.STATES.PERSONAL_INFO,S.isBusiness=!1,S}return(0,l.default)(e,t),(0,r.default)(e,[{key:"_resetState",value:function(){(0,c.default)(e.prototype.__proto__||(0,a.default)(e.prototype),"_resetState",this).call(this),this.BUTTONS={BTN_GRY:new u.PageFlowButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new u.PageFlowButton(this.BUTTON_TYPES.NEXT,!0,!0)}}},{key:"reapplyUIState",value:function(){this._updateUI()}},{key:"_updateUI",value:function(){this.BUTTONS.BTN_GRY.show=!1,this.BUTTONS.BTN_GRY.disable=!1,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!0,this.hideWarning(),this.currentState===this.STATES.ACCOUNT_INFO?(this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_GRY.disable=!1,this.BUTTONS.BTN_GRY.show=!0):this.showCancelButton&&(this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.CANCEL,this.BUTTONS.BTN_GRY.disable=!1,this.BUTTONS.BTN_GRY.show=!0),this.showNextButton?(this.BUTTONS.BTN_ORG.type=this.currentState===this.STATES.REVIEW?this._getSaveConfirmButton():this.BUTTON_TYPES.NEXT,this.BUTTONS.BTN_ORG.disable=this.currentState===this.STATES.ACCOUNT_INFO):this.showSaveButton?(this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.SAVE,this.BUTTONS.BTN_ORG.disable=!0):this.showConfirmButton&&(this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.CONFIRM,this.BUTTONS.BTN_ORG.disable=!1),this.currentState===this.STATES.DONE&&(this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.DONE,this.BUTTONS.BTN_ORG.disable=!1,this.BUTTONS.BTN_GRY.show=!1),this.onButtonClickSetState(),this._conditionalScrollToTop()}},{key:"_getSaveConfirmButton",value:function(){return this.isBusiness?this.BUTTON_TYPES.SAVE:this.BUTTON_TYPES.CONFIRM}},{key:"_conditionalScrollToTop",value:function(){this.AnchorService.scrollToPageContentTop()}},{key:"gotoNextState",value:function(){switch(this.currentState){case this.STATES.PERSONAL_INFO:this.moveTo(this.STATES.ACCOUNT_INFO),this._updateUI();break;case this.STATES.ACCOUNT_INFO:this.moveTo(this.STATES.REVIEW),this._updateUI();break;case this.STATES.REVIEW:this.moveTo(this.STATES.DONE),this._updateUI()}}},{key:"goBack",value:function(){(0,c.default)(e.prototype.__proto__||(0,a.default)(e.prototype),"gotoPreviousState",this).call(this),this._updateUI()}},{key:"onEnableNext",value:function(t){this.BUTTONS.BTN_ORG.disable=!t}},{key:"_getAnalyticsID",value:function(){return"amlConfirmationInfoFlow"}},{key:"onButtonClick",value:function(t){switch(t.type){case this.BUTTON_TYPES.CONFIRM:this.onButtonClickConfirm();break;default:(0,c.default)(e.prototype.__proto__||(0,a.default)(e.prototype),"onButtonClick",this).call(this,t)}}}]),e}(d(u).default);h.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","$rootScope","stateConstants","AnalyticsService","$timeout","intendedUseTpiReviewConstants","EnvironmentService","AccountHelpersService","AnchorService"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(4886)),a=o(n(4890)),s=o(n(4894)),r=o(n(4895));function o(t){return t&&t.__esModule?t:{default:t}}var c=angular.module("tangerine.app.core.components.gicPreview",["tangerine.insights.module","tangerine.app.core.services","tangerine.app.core.constants"]).directive("tngGicGraph",s.default).service("GicPreviewService",r.default).component("tngGicPreviewForm",a.default).component("tngGicPreview",i.default);e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4887)),a=s(n(4888));function s(t){return t&&t.__esModule?t:{default:t}}n(4889);var r={template:a.default,controller:i.default,bindings:{promoRate:"<",promoTerm:"<",productType:"<",accountTerm:"<"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.GicPreviewService=n,this.$log=e}return(0,a.default)(t,[{key:"$onInit",value:function(){this.validateInput(),this.selectedAmount=1e4,this.postedRate=2.5,this.term={},this.promoRate=this.promoRate.replace(",","."),this.termToDays={NINE_MONTHS:270,ONE_YEAR:365,TWO_YEARS:730,THREE_YEARS:1095,FOUR_YEARS:1460,FIVE_YEARS:1825,NINTY_DAYS:90,ONE_HUNDRED_EIGHTY_DAYS:180,ONE_AND_HALF_YEAR:547.5},this.getRate(),this.updateValues()}},{key:"validateInput",value:function(){var t=this;["promoRate","promoTerm","productType","accountTerm"].forEach((function(e){(angular.isUndefined(t[e])||null==t[e])&&t.$log.error(e+" property must be provided")}))}},{key:"getRate",value:function(){var t=this;this.GicPreviewService.getRate(this.productType,this.accountTerm).then((function(e){t.term=e,t.postedRate=t.term.interest_rate,t.updateValues()}))}},{key:"updateValues",value:function(){this.promoValue=this.getRateAmount(this.promoRate,this.selectedAmount).toFixed(2),this.postedValue=this.getRateAmount(this.postedRate,this.selectedAmount).toFixed(2)}},{key:"getRateAmount",value:function(t,e){var n=this.termToDays[this.accountTerm];return angular.isUndefined(n)&&(this.$log.warn("GICPreview: Account term does not exist, please check value or update map - defaults to 1 year"),n=365),t*e/365*n/100}},{key:"onSubmit",value:function(t){this.selectedAmount=t,this.updateValues()}}]),t}();r.$inject=["$log","GicPreviewService"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="gic-preview"> <tng-gic-preview-form class="gic-preview-form" amount="$ctrl.selectedAmount" posted-rate="$ctrl.postedRate" promo-rate="$ctrl.promoRate" on-submit="$ctrl.onSubmit(amount)"></tng-gic-preview-form> <div class="gic-preview-spacing"></div> <div class="gic-preview-graph" tng-gic-graph width="400" height="450" promo-amount="$ctrl.promoValue" posted-amount="$ctrl.postedValue" promo-term="$ctrl.promoTerm"></div> </div>'},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4891)),a=s(n(4892));function s(t){return t&&t.__esModule?t:{default:t}}n(4893);var r={template:i.default,controller:a.default,bindings:{onSubmit:"&?",postedRate:"<",promoRate:"<",amount:"="}};e.default=r,t.exports=e.default},function(t,e){t.exports='<form class="gic-preview-form" ng-submit="$ctrl._onSubmit()"> <div class="gic-preview-input-section amount-input"> <h3>{{ \'gicPreview.gicAmount\' | translate }}</h3> <span class="gic-preview-icon-dollar"></span> <input class="input amount-input" ng-focus="$ctrl.onFocus()" ng-blur="$ctrl.onBlur()" ng-keyup="$ctrl.onAmountChange($event, $ctrl.formattedAmount)" ng-model="$ctrl.formattedAmount"> </div> <div class="gic-preview-input-section posted-input"> <h3>{{ \'gicPreview.postedRate\' | translate }}</h3> <input class="input" disabled="disabled" type="text" ng-value="$ctrl.postedRateString"> </div> <div class="gic-preview-input-section promo-input"> <h3>{{ \'gicPreview.yourPromoRate\' | translate }}</h3> <input class="input" disabled="disabled" type="text" ng-value="$ctrl.promoRateString"> </div> <button type="submit" class="btn btn--large btn--edit">{{ \'gicPreview.showMe\' | translate }}</button> </form>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.locale=n.locale,this.$filter=e}return(0,a.default)(t,[{key:"$onInit",value:function(){this.amountFocused=!1,this.maxAmount=5e6,this.postedRateString=this.$filter("number")(this.postedRate,2)+"%",this.promoRateString=this.$filter("number")(this.promoRate,2)+"%",this.splitAmountBy="en_CA"===this.locale?".":",",this.formattedAmount=this.$filter("tngCurrency")(this.amount).split(this.splitAmountBy)[0],this.formattedAmount="en_CA"===this.locale?this.formattedAmount:this.formattedAmount+" $"}},{key:"$onChanges",value:function(t){t.postedRate&&(this.postedRateString=this.$filter("number")(this.postedRate,2)+"%")}},{key:"onAmountChange",value:function(t,e){if(this.amount=e.replace(/[\D\s_-]+/g,""),this.maxAmount){var n=Math.abs(this.amount),i=Math.abs(this.maxAmount);n>i&&(this.amount=i)}8!==t.keyCode&&(this.formattedAmount=this.$filter("tngCurrency")(this.amount).split(this.splitAmountBy)[0],this.formattedAmount="en_CA"===this.locale?this.formattedAmount:this.formattedAmount+" $")}},{key:"onFocus",value:function(){this.amountFocused=!0,this.formattedAmount="en_CA"===this.locale?this.formattedAmount:this.formattedAmount.replace(" $","")}},{key:"onBlur",value:function(){this.formattedAmount=this.$filter("tngCurrency")(this.amount).split(this.splitAmountBy)[0],this.formattedAmount="en_CA"===this.locale?this.formattedAmount:this.formattedAmount+" $"}},{key:"_onSubmit",value:function(){this.onSubmit({amount:this.amount})}},{key:"_propagateEvent",value:function(){return!0}}]),t}();r.$inject=["$filter","LocaleService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(104)),a=s(n(198));function s(t){return t&&t.__esModule?t:{default:t}}function r(t,e,n){return{restrict:"EA",template:"<canvas></canvas>",replace:!0,scope:{width:"=",height:"=",promoAmount:"=",postedAmount:"=",promoTerm:"<"},link:function(s,r){r.attr("width",s.width),r.attr("height",s.height),r[0].onmousemove=function(t){var e=this.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top;y=O(n,i,S),E=O(n,i,T),c.clearRect(0,0,s.width,s.height),C(c)};var o,c=r[0].getContext("2d"),l=10,u=10,d=5,h=20,f=s.width/s.height,p=s.width,g=s.height/u,m=s.promoAmount>s.postedAmount?s.promoAmount:s.postedAmount,_=Math.ceil(m/6),v=g+1,S=P(50+.45*s.width,b(s.promoAmount)-1),T=P(50+.01*s.width,b(s.postedAmount)-1),y=!1,E=!1,A={postedRate:"",yourPromoRate:"",postedRateMessage:"",promoRateMessage:""};function b(t){return u*g-(t/_+1)*g}function C(e){if(function(e){for(var n=7,i=0;n>0;n--,i++){var a="fr_CA"===t.use()?_*i+" $":"$"+_*i;w(e,s.height-v-i*g+d,a)}}(e),M(e,T,"grey",A.postedRate),M(e,S,"#f58426",A.yourPromoRate),E){var n=A.postedRateMessage.replace("{amount}",s.postedAmount);N(e,T,n)}if(y){var i=A.promoRateMessage.replace("{amount}",s.promoAmount);N(e,S,i)}}function $(t,e,n,i,a,s,r){s=s||0;var o=e.tr.x-e.tl.x;t.fillStyle=a,t.font="13px ProximaNova, Proxima Nova, Arial, Helvetica, sans-serif",t.beginPath(),t.moveTo(e.tl.x+5-s,e.tl.y-s),t.lineTo(e.tr.x-5+s,e.tr.y-s),t.quadraticCurveTo(e.tr.x+s,e.tr.y-s,e.tr.x+s,e.tr.y+5-s),t.lineTo(e.br.x+s,e.br.y-5+s),t.quadraticCurveTo(e.br.x+s,e.br.y+s,e.br.x-5+s,e.br.y+s),t.lineTo(e.bl.x+5-s,e.bl.y+s),t.quadraticCurveTo(e.bl.x-s,e.bl.y+s,e.bl.x-s,e.bl.y-5+s),t.lineTo(e.tl.x-s,e.tl.y+5-s),t.quadraticCurveTo(e.tl.x-s,e.tl.y-s,e.tl.x+5-s,e.tl.y-s),t.closePath(),t.fill(),t.beginPath(),t.moveTo(n+s,i+s),t.lineTo(n-10-1,i-10-1),t.lineTo(n+10+1,i-10-1),t.closePath(),t.fill(),r&&r.forEach((function(i,a){t.fillStyle="#000",t.textAlign="center";var s=13;t.font=s+"px ProximaNova, Proxima Nova, Arial, Helvetica, sans-serif";for(var r=t.measureText(i).width;r>o-2;)s-=1,t.font=s+"px ProximaNova, Proxima Nova, Arial, Helvetica, sans-serif",r=t.measureText(i).width;t.fillText(i,n,e.tl.y+18+15*a)}))}function N(t,e,n){var i=e.bl.x+(e.br.x-e.bl.x)/2,a=e.tl.y,r={tl:{x:e.tl.x-10,y:a-10-60},tr:{x:e.tr.x+10,y:a-10-60},bl:{x:e.bl.x-10,y:a-10},br:{x:e.br.x+10,y:a-10}};r.tr.x>=s.width&&(i-=10,r.tr.x-=10,r.tl.x-=10,r.bl.x-=10,r.br.x-=10),$(t,r,i,a,"#999999",1),$(t,r,i,a,"#fff",0,n.split("\n"))}function O(t,e,n){return t>=n.tl.x&&t<=n.tr.x&&e>=n.tl.y&&e<=n.bl.y}function I(){m=s.promoAmount>s.postedAmount?s.promoAmount:s.postedAmount,g=s.height/u,_=Math.ceil(m/6),v=g+1,S=P(50+.45*s.width,b(s.promoAmount)-1),T=P(50+.01*s.width,b(s.postedAmount)-1),y=!1,E=!1,c.clearRect(0,0,s.width,s.height),C(c)}function w(t,e,n){var i=e+l;t.lineWidth=1,t.fillStyle="#000",t.font="13px Tangerine Circular, Arial, Helvetica, sans-serif",t.textAlign="right",t.fillText(n,35+h,i+5),t.beginPath(),t.moveTo(40+h,i-1),t.lineTo(s.width,i-1),t.strokeStyle="rgba(153, 153, 153, 0.6)",t.stroke()}function P(t,e){var n=s.width/3;return t+n+h+20>s.width&&(t-=20),{bl:{x:t+h,y:s.height-v+l+d},tl:{x:t+h,y:e+l+d},tr:{x:t+n+h,y:e+l+d},br:{x:t+n+h,y:s.height-v+l+d}}}function M(t,e,n,i){t.fillStyle=n,t.beginPath(),t.moveTo(e.tl.x+5,e.tl.y),t.lineTo(e.tr.x-5,e.tr.y),t.quadraticCurveTo(e.tr.x,e.tr.y,e.tr.x,e.tr.y+5),t.lineTo(e.br.x,e.br.y-5),t.quadraticCurveTo(e.br.x,e.br.y,e.br.x-5,e.br.y),t.lineTo(e.bl.x+5,e.bl.y),t.quadraticCurveTo(e.bl.x,e.bl.y,e.bl.x,e.bl.y-5),t.lineTo(e.tl.x,e.tl.y+5),t.quadraticCurveTo(e.tl.x,e.tl.y,e.tl.x+5,e.tl.y),t.closePath(),t.fill(),t.fillStyle="#000",t.textAlign="center",t.font="14px ProximaNova, Proxima Nova, Arial, Helvetica, sans-serif",s.width<300?(t.font="10px ProximaNova, Proxima Nova, Arial, Helvetica, sans-serif",t.fillText(i,e.bl.x+(e.br.x-e.bl.x)/2,s.height-v/2+l/1.5+7)):t.fillText(i,e.bl.x+(e.br.x-e.bl.x)/2,s.height-v/2+l/1.5+d)}n((function(){e.innerWidth<p&&(c.clearRect(0,0,s.width,s.height),s.width=e.innerWidth-60,s.height=s.width/f,r.attr("width",s.width),r.attr("height",s.height),I())})),s.$watch("promoAmount",I),s.$watch("postedAmount",I),s.$watch("width",I),s.$watch("height",I),angular.element(e).bind("resize",(function(){e.innerWidth<p&&(c.clearRect(0,0,s.width,s.height),s.width=e.innerWidth-60,s.height=s.width/f,r.attr("width",s.width),r.attr("height",s.height),I())})),(o=[t("gicPreview.postedRate"),t("gicPreview.yourPromoRate"),t("gicPreview.postedRateMessage"),t("gicPreview.promoRateMessage")],a.default.all(o).then((function(t){var e=(0,i.default)(t,4),n=e[0],a=e[1],r=e[2],o=e[3];A.postedRate=n,A.yourPromoRate=a,A.postedRateMessage=r.replace("{term}",s.promoTerm),A.promoRateMessage=o.replace("{term}",s.promoTerm)}))).then((function(){C(c)}))}}}r.$inject=["$translate","$window","$timeout"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.locale=e.locale,this.RequesterService=n,this.serviceConstants=a}return(0,a.default)(t,[{key:"getRate",value:function(t,e){var n={urlVars:{locale:this.locale}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNTS_RATES,n).then((function(n){var i=n.rates.filter((function(n){return n.profile_product_type&&n.profile_product_type===t&&n.account_term&&n.account_term===e}));return i.length>0?i[0]:null}))}}]),t}();r.$inject=["LocaleService","RequesterService","serviceConstants"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4897)),a=s(n(4898));function s(t){return t&&t.__esModule?t:{default:t}}n(4899);var r={template:a.default,controller:i.default,bindings:{customer:"<",errors:"<",onInputChange:"&",showSin:"<?",showEmail:"<?",showDateOfBirth:"<?",sinRequired:"<?",sinData:"<?",showValidationOnLoad:"<?",showMailingAddressValidationOnLoad:"<?",showEmploymentInfoValidationOnLoad:"<?",disableEdit:"<?",shouldHideUseLegalNameNote:"<?",showEmployerAddress:"<?",employerAddressMandatory:"<?",showMailingAddress:"<?",showBusinessPhone:"<?",validatePoBox:"<?",showPoBoxValidationOnLoad:"<?",onFormSubmit:"&?",isFormValid:"<?",isNewClientEnrollmentPersonalInfo:"<?",isNewClientEnrollmentAddress:"<?",expressSignUp:"<?",expressSignUpOnEdit:"&?"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(8)),a=l(n(15)),s=l(n(0)),r=l(n(2)),o=l(n(268)),c=n(67);function l(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(e,n,i,a,r,o,l,u,d){(0,s.default)(this,t),this.$log=e,this.$timeout=n,this.$interval=i,this.$scope=a,this.$location=d,this.DateService=l,this.dateSelectorConstants=u,this.PHONE_TYPES=r.API.PHONE_TYPE,this.ADDRESS_TYPES=r.API.ADDRESS_TYPE,this.NAME_PATTERN=c.namePattern,this.emailRegexPattern=c.emailFullPattern,this.employedStatusCodes=o.EMPLOYED_STATUS_CODES,this.showMailingAddress=void 0===this.showMailingAddress||this.showMailingAddress,this.showBusinessPhone=void 0===this.showBusinessPhone||this.showBusinessPhone}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;this.$scope.$watch((function(){return t.data}),(function(e,n){t._onChange(),t.expressSignUp&&e.addresses.HOME.postal_code!==n.addresses.HOME.postal_code&&(t.expressSignUpEnableStreetPerfect=!0)}),!0),this.pageId="basicInfoForm",this.maxDateDOB=moment().add(-12,"years"),this.helpBubbleAnalyticsId=this.$location.url(),this.showValidationOnLoadEmployerAddress=!1,(this.employerAddressMandatory||this.customer&&this.customer.employment_status&&this.customer.employer&&this.customer.employer.company_address)&&(this.showValidationOnLoadEmployerAddress=!0),this.expressSignUp&&(this.isNewClientEnrollmentPersonalInfo&&this._handleExpressSignUpPersonalInfoPrefill(),this.isNewClientEnrollmentAddress&&!this.expressSignUp.address.edited&&this._handleExpressSignUpAddressPrefill())}},{key:"_handleExpressSignUpPersonalInfoPrefill",value:function(){if(this.expressSignUp.name.edited||(this.data.first_name=this.expressSignUp.name.first_name,this.data.last_name=this.expressSignUp.name.last_name),this.expressSignUp.birth_date.edited||(this.data.birth_date=this.expressSignUp.birth_date.value),!this.expressSignUp.phone.edited){var t=void 0;11===this.expressSignUp.phone.value.length&&"1"===this.expressSignUp.phone.value[0]?t=this.expressSignUp.phone.value.substring(1):12===this.expressSignUp.phone.value.length&&"+"===this.expressSignUp.phone.value[0]&&"1"===this.expressSignUp.phone.value[1]?t=this.expressSignUp.phone.value.substring(2):10===this.expressSignUp.phone.value.length&&(t=this.expressSignUp.phone.value),t&&(this.data.phone_list=[{type:"",number:t}],this.data.primaryPhoneType=""),this.expressSignUpOnEdit({field:"phone",noWarning:!0})}}},{key:"_handleExpressSignUpAddressPrefill",value:function(){if(this.expressSignUpAddressError=null,this.expressSignUp.address.address&&!this.expressSignUp.address.edited){if(this.expressSignUpEnableStreetPerfect=!1,this.expressSignUpAddressParsed=o.default.parseCanadaPostFormatSteetAddressWithUnit(this.expressSignUp.address.address),!this.expressSignUpAddressParsed||this.expressSignUpAddressParsed.poBox||"CA"!==this.expressSignUp.address.country)return this.expressSignUpAddressParsed?"CA"!==this.expressSignUp.address.country?this.expressSignUpAddressError="international":this.expressSignUpAddressParsed.poBox?this.expressSignUpAddressError="pobox":this.expressSignUpAddressError="invalid":this.expressSignUpAddressError="invalid",void this.expressSignUpOnEdit({field:"address",noWarning:!0});this.data.addresses.HOME.suite=this.expressSignUpAddressParsed.unit?this.expressSignUpAddressParsed.unit.trim():"",this.data.addresses.HOME.address_line1=this.expressSignUpAddressParsed.streetNum.trim()+" "+this.expressSignUpAddressParsed.streetName.trim(),this.data.addresses.HOME.city=this.expressSignUp.address.city,this.data.addresses.HOME.province=this.expressSignUp.address.province,this.data.addresses.HOME.postal_code=this.expressSignUp.address.postal_code}}},{key:"$onChanges",value:function(t){var e=this,n=t.customer,i=t.employerAddressMandatory;n&&n.currentValue&&(this.data=n.currentValue,this.data&&this.data.employment_status&&this.data.employer&&this.data.employer.company_address&&(this.showValidationOnLoadEmployerAddress=!0),this.setPrimaryPhoneType(this.data.phone_list),this.empInfoPrefill=this._generateEmpInfoPrefill(this.data),this.intervalPromise=this.$interval((function(){e._onChange()}),500,20)),i&&i.currentValue&&(this.showValidationOnLoadEmployerAddress=!0)}},{key:"setPrimaryPhoneType",value:function(t){!this.isNewClientEnrollmentPersonalInfo||t&&0!==t.length||(this.data.primaryPhoneType="CELL")}},{key:"onDobChange",value:function(t){this.isDobValid=t,this._onChange()}},{key:"onSalutationChange",value:function(t,e){!e&&this.expressSignUp&&this.expressSignUp.title&&!this.expressSignUp.title.edited&&this.expressSignUpOnEdit({field:"salutation",noWarning:!0}),this.data.title=t}},{key:"onPhoneUpdated",value:function(t){var e=this.data.phone_list;!this.data.primaryPhoneType&&t.primaryPhoneType&&e.splice(e.findIndex((function(e){return e.type===t.primaryPhoneType}))),this.data.primaryPhoneType=t.primaryPhoneType,t.phone_list.forEach((function(t){var n=e.find((function(e){return e.type===t.type}));n?n.number=t.number:e.push(t)}))}},{key:"$onDestroy",value:function(){this.intervalPromise&&this.$interval.cancel(this.intervalPromise)}},{key:"submit",value:function(){angular.isFunction(this.onFormSubmit)&&(this.onFormSubmit(),this.expressSignUpAddressError=null)}},{key:"_onChange",value:function(){var t=this;this.$timeout((function(){if(t.form){t.showMailingAddress&&t._checkIfMailingDifferentFromHomeAddress();var e=(t.data.first_name?t.data.first_name.length:0)+(t.data.last_name?t.data.last_name.length:0)<=39&&(!t.showDateOfBirth||t.isDobValid);t.isNewClientEnrollmentPersonalInfo?t.isFormValid=t.form.$valid&&e:t.isNewClientEnrollmentAddress?t.isFormValid=t.form.$valid&&!t.identicalMailingAddresses:t.isFormValid=t.form.$valid&&e&&!t.identicalMailingAddresses,t._findFirstError(),t.onInputChange({data:t.data,isValid:t.isFormValid})}}),50)}},{key:"_findFirstError",value:function(){if(!this.isNewClientEnrollmentPersonalInfo&&!this.isNewClientEnrollmentAddress||this.isNewClientEnrollmentPersonalInfo){var t=this.data.first_name?this.data.first_name.length:0,e=this.data.last_name?this.data.last_name.length:0;""===this.data.title||void 0===this.data.title?this.data.firstError="title":this.form.firstName&&this.form.lastName&&(this.form.firstName.$invalid||this.form.lastName.$invalid||t+e>39)?this.data.firstError="title":this.showDateOfBirth&&!this.isDobValid?this.data.firstError="dateOfBirth":this.showSin&&this.form.BasicInfoForm_sin.$invalid?this.data.firstError="sinNumber":this.form.homePhone&&this.form.homePhone.$invalid?this.data.firstError="homePhoneLabel":this.form.mobilePhone&&this.form.mobilePhone.$invalid?this.data.firstError="mobilePhoneLabel":this.form.primaryPhone&&this.form.primaryPhone.$invalid?this.data.firstError="primaryPhoneLabel":this.form.secondaryPhone&&this.form.secondaryPhone.$invalid?this.data.firstError="secondaryPhoneLabel":this.showBusinessPhone&&this.form.businessPhone&&this.form.businessPhone.$invalid?this.data.firstError="businessPhoneLabel":0===(0,a.default)(this.data.employment_status).length||-1!==this.employedStatusCodes.indexOf(this.data.employment_status.code)&&(!this.data.occupation.industryObject||!this.data.occupation.occupationObject)||this.form["$ctrl.BasicInfoForm_empSearchForm"]&&this.form["$ctrl.BasicInfoForm_empSearchForm"].$invalid?this.data.firstError="BasicInfoForm_employmentInfoLabel":this.form.employerName&&this.form.employerName.$invalid?this.data.firstError="BasicInfoForm_employerNameLabel":this.data.firstError="newClientEnrollment"}(!this.isNewClientEnrollmentPersonalInfo&&!this.isNewClientEnrollmentAddress||this.isNewClientEnrollmentAddress)&&(this.form.CurrentAddress_postalCode&&this.form.CurrentAddress_addressStreetNumber&&this.form.CurrentAddress_addressLine1&&this.form.CurrentAddress_addressLine2&&this.form.CurrentAddress_city&&this.form.CurrentAddress_suiteNo&&(this.form.CurrentAddress_postalCode.$invalid||this.form.CurrentAddress_addressStreetNumber&&this.form.CurrentAddress_addressStreetNumber.$invalid||this.form.CurrentAddress_addressLine1&&this.form.CurrentAddress_addressLine1.$invalid||this.form.CurrentAddress_addressLine2&&this.form.CurrentAddress_addressLine2.$invalid||this.form.CurrentAddress_city&&this.form.CurrentAddress_city.$invalid||this.form.CurrentAddress_suiteNo&&this.form.CurrentAddress_suiteNo.$invalid||void 0===this.data.addresses.HOME.province||!this.data.addresses.HOME.province.length)?this.data.firstError="homeAddressLabel":this.showMailingAddress&&this.data.extraData&&void 0===this.data.extraData.mailingAddressDifferent?this.data.firstError="mailingAddressDifferent_label":this.showMailingAddress&&this.data.extraData&&this.data.extraData.mailingAddressDifferent&&(this.identicalMailingAddresses||this.form.MailingAddress_postalCode.$invalid||this.form.MailingAddress_addressStreetNumber.$invalid||this.form.MailingAddress_addressLine1.$invalid||this.form.MailingAddress_addressLine2.$invalid||this.form.MailingAddress_city.$invalid||this.form.MailingAddress_suiteNo.$invalid||void 0===this.data.addresses.MAILING.province||!this.data.addresses.MAILING.province.length)?this.data.firstError="mailingAddressLabel":this.data.firstError="newClientEnrollment")}},{key:"_checkIfMailingDifferentFromHomeAddress",value:function(){this.data.extraData&&this.data.extraData.mailingAddressDifferent&&this._isAddressesSame(this.data.addresses.MAILING,this.data.addresses.HOME)?this.identicalMailingAddresses=!0:this.identicalMailingAddresses=!1}},{key:"_isAddressesSame",value:function(t,e){return!!(t.postal_code&&e.postal_code&&t.postal_code.replace(/\s/g,"").toLowerCase()===e.postal_code.replace(/\s/g,"").toLowerCase()&&t.street_number&&e.street_number&&t.street_number.replace(/\s/g,"").toLowerCase()===e.street_number.replace(/\s/g,"").toLowerCase()&&t.address_line1&&e.address_line1&&t.address_line1.replace(/\s/g,"").toLowerCase()===e.address_line1.replace(/\s/g,"").toLowerCase()&&(!(void 0!==t.address_line2&&t.address_line2.length||void 0!==e.address_line2&&e.address_line2.length)||t.address_line2&&e.address_line2&&t.address_line2.replace(/\s/g,"").toLowerCase()===e.address_line2.replace(/\s/g,"").toLowerCase())&&(!(void 0!==t.suite&&t.suite.length||void 0!==e.suite&&e.suite.length)||t.suite&&e.suite&&t.suite.replace(/\s/g,"").toLowerCase()===e.suite.replace(/\s/g,"").toLowerCase()))}},{key:"inputIsValid",value:function(t){return(0,c.inputIsValid)(this.form[t],this.showValidationOnLoad)}},{key:"_generateEmpInfoPrefill",value:function(t){var e={};return angular.isString(t.employment_status)?e.employmentStatusCode=t.employment_status:angular.isObject(t.employment_status)&&(e.employmentStatusCode=t.employment_status.code),t.occupation&&t.employer&&(e.employerName=t.employer.company_name,t.occupation.industryObject&&t.occupation.industryObject?(e.industryCode=t.occupation.industryObject.code,e.occupationCode=t.occupation.occupationObject.code):t.occupation.industry_code&&t.occupation.occupation_code&&(e.industryCode=t.occupation.industry_code,e.occupationCode=t.occupation.occupation_code)),e}},{key:"onEmpInfoChange",value:function(t){!this.isNewClientEnrollmentPersonalInfo||t.occupation||t.industry||(0,i.default)(this.data.phoneNumbers.BUSINESS,{number:"",extension:""});var e={occupationObject:t.occupation,industryObject:t.industry,industry_code:t.industry?t.industry.code:null,occupation_code:t.occupation?t.occupation.code:null};this.data.employment_status=t.employmentStatus,this.data.occupation=e,this.data.employer||(this.data.employer={}),this.data.employer.company_name=t.employerName,this._onChange()}},{key:"onAddressError",value:function(){this.onInputChange({data:this.data,isValid:!1})}},{key:"mobileViewValueChanged",value:function(t){t.newValue&&0!==t.newValue.length||(this.data.primaryPhoneType="HOME")}},{key:"employmentStatus",value:function(){if((this.showEmployerAddress||this.isNewClientEnrollmentPersonalInfo)&&this.data&&this.data.employment_status){var t=this.data.employment_status.code;return-1!==this.employedStatusCodes.indexOf(t)}return!1}},{key:"onMailingAddressDifferentClicked",value:function(){this.isNewClientEnrollmentAddress||(this.data.extraData.mailingAddressDifferent=!this.data.extraData.mailingAddressDifferent),this.data.addresses.MAILING={address_type:this.ADDRESS_TYPES.MAILING}}},{key:"expressSignUpShowError",get:function(){return this.expressSignUp&&this.expressSignUpAddressError}},{key:"expressSignUpShowName",get:function(){return this.expressSignUp&&this.expressSignUp.name&&!this.expressSignUp.name.edited}},{key:"expressSignUpShowDob",get:function(){return this.expressSignUp&&this.expressSignUp.birth_date&&!this.expressSignUp.birth_date.edited}},{key:"expressSignUpShowAddress",get:function(){return this.expressSignUp&&this.expressSignUp.address&&this.expressSignUp.address.address&&!this.expressSignUp.address.edited}},{key:"expressSignUpTitle",get:function(){return this.expressSignUp&&this.expressSignUp.title&&!this.expressSignUp.title.edited&&this.expressSignUp.title.value}},{key:"shouldEnableStreetPerfect",get:function(){return!this.expressSignUp||this.expressSignUpEnableStreetPerfect}},{key:"isMobileRequired",get:function(){return this.data&&this.data.primaryPhoneType&&"CELL"===this.data.primaryPhoneType}}]),t}();u.$inject=["$log","$timeout","$interval","$scope","customerConstants","UserSettingsConstants","DateService","tngDateSelectorConstants","$location"],e.default=u,t.exports=e.default},function(t,e){t.exports='<div class="c-basic-info-form"> <div class="c-basic-info-form__new-client__warning" ng-if="$ctrl.expressSignUpShowError"> <div class="c-basic-info-form__new-client__warning__header" ng-switch="$ctrl.expressSignUpAddressError"> <span ng-switch-when="international">Living outside Canada?</span> <span ng-switch-when="pobox">pobox header</span> <span ng-switch-default>invalid hdeader</span> </div> <div class="c-basic-info-form__new-client__warning__text" ng-switch on="$ctrl.expressSignUpAddressError"> <span ng-switch-when="international">We noticed that your address provided by other financial institution is outside Canada. In order to proceed you need to live in Canada!</span> <span ng-switch-when="pobox">pobox text</span> <span ng-switch-default>invalid text</span> </div> </div> <form name="$ctrl.form" novalidate ng-submit="$ctrl.submit()"> <div ng-if="$ctrl.isNewClientEnrollmentPersonalInfo" class="c-basic-info-form__new-client__personal-info narrow-width-section"> <div class="field"> <label ng-if="!$ctrl.expressSignUpShowName" actionable-id="title" class="heading--sub3 top-margin-none">{{ ::\'newClientEnrollment.basicInfo.name\' | translate }}</label> <label ng-if="$ctrl.expressSignUpShowName" actionable-id="title" class="heading--sub3 top-margin-none">Salutation</label> <div> <tng-salutation-select on-update="$ctrl.onSalutationChange(salutation)" input-name="title" init-value="$ctrl.expressSignUpTitle || $ctrl.data.title" is-required="true" show-validation-on-load="$ctrl.showValidationOnLoad" show-warning-border="true" alternate-light="true"> </tng-salutation-select> </div> </div> <div ng-if="$ctrl.expressSignUpShowName"> <div class="field c-basic-info-form__new-client__edit-label__container"> <label actionable-id="title" class="heading--sub3 c-basic-info-form__new-client__edit-label__label">Legal Name</label> <div class="c-basic-info-form__new-client__edit-label__text" ng-click="$ctrl.expressSignUpOnEdit({field: \'name\'})">Edit</div> </div> <div class="field styleguide-grid-unit c-basic-info-form__first-name"> <input class="input" type="text" ng-value="$ctrl.expressSignUp.name.first_name + \' \' + $ctrl.expressSignUp.name.last_name" disabled="disabled"> </div> </div> <div ng-if="!$ctrl.expressSignUpShowName" class="grid__container c-basic-info-form__name"> <div class="field styleguide-grid-unit c-basic-info-form__first-name"> <input actionable-id="firstName" class="input bottom-margin-none" ng-class="{ \'warning\':\n              ($ctrl.form.firstName.$touched || $ctrl.showValidationOnLoad) &&\n              (($ctrl.data.first_name.length + $ctrl.data.last_name.length) > 39 ||\n              !$ctrl.form.firstName.$valid)\n            }" maxlength="32" type="text" ng-disabled="$ctrl.disableEdit" ng-model="$ctrl.data.first_name" ng-pattern="$ctrl.NAME_PATTERN" placeholder="{{ ::\'newClientEnrollment.basicInfo.firstName\' | translate }}" ng-required="true"> </div> <div class="field styleguide-grid-unit c-basic-info-form__last-name"> <input actionable-id="lastName" class="input bottom-margin-none" ng-class="{ \'warning\':\n              ($ctrl.form.lastName.$touched || $ctrl.showValidationOnLoad) &&\n              (($ctrl.data.first_name.length + $ctrl.data.last_name.length) > 39 ||\n              !$ctrl.form.lastName.$valid)\n            }" maxlength="32" type="text" ng-pattern="$ctrl.NAME_PATTERN" ng-disabled="$ctrl.disableEdit" ng-model="$ctrl.data.last_name" placeholder="{{ ::\'newClientEnrollment.basicInfo.lastName\' | translate }}" ng-required="true"> </div> </div> <div class="field__error" ng-show="($ctrl.form.firstName.$error.required && ($ctrl.form.firstName.$touched || $ctrl.showValidationOnLoad)) ||\n          ($ctrl.form.lastName.$error.required && ($ctrl.form.lastName.$touched || $ctrl.showValidationOnLoad))"> {{ ::\'global.validation.required\' | translate }} </div> <div class="field__error" ng-show="$ctrl.form.firstName.$error.pattern && ($ctrl.form.firstName.$touched || $ctrl.showValidationOnLoad)"> {{ ::\'clientOnboarding.basicInfoForm.namePatternError\' | translate }} </div> <div class="field__error" ng-show="$ctrl.form.lastName.$error.pattern && ($ctrl.form.lastName.$touched || $ctrl.showValidationOnLoad)"> {{ ::\'clientOnboarding.basicInfoForm.lastNamePatternError\' | translate }} </div> <div class="field__error" ng-show="(($ctrl.form.firstName.$touched && $ctrl.form.lastName.$touched)  || $ctrl.showValidationOnLoad) &&\n          ($ctrl.data.first_name.length + $ctrl.data.last_name.length) > 39"> {{ ::\'clientOnboarding.basicInfoForm.fullNameLengthError\' | translate }} </div> <p class="small" ng-if="!$ctrl.shouldHideUseLegalNameNote"> {{ ::\'clientOnboarding.basicInfoForm.pleaseUseLegalName\' | translate }} </p> <div class="field top-margin-medium bottom-margin-medium" ng-if="$ctrl.showSin"> <label actionable-id="sinNumber" class="heading--sub3">{{ ::\'clientOnboarding.basicInfoForm.sin\' | translate }} <tng-help-bubble analytics-id="$ctrl.helpBubbleAnalyticsId"> {{::\'newClientEnrollment.identityInfo.sinRequirement\' | translate}} </tng-help-bubble> </label> <div class="top-margin-small"> <tng-sin-input ng-model="$ctrl.data.sin" ng-required="true" show-validation-on-load="$ctrl.showValidationOnLoad" ng-readonly="!$ctrl.sinData.editable" input-id="BasicInfoForm_sin"></tng-sin-input> </div> </div> <div class="field" ng-if="$ctrl.showDateOfBirth"> <div class="c-basic-info-form__new-client__edit-label__container"> <label actionable-id="dateOfBirth" class="top-margin-large heading--sub3 c-basic-info-form__new-client__edit-label__label"> {{ ::\'newClientEnrollment.basicInfo.dateOfBirth\' | translate }} </label> <div class="c-basic-info-form__new-client__edit-label__text" ng-click="$ctrl.expressSignUpOnEdit({field: \'dob\'})" ng-if="$ctrl.expressSignUpShowDob">Edit </div> </div> <tng-date-input input-id="dateOfBirth" is-date-of-birth="true" date-model="$ctrl.data.birth_date" on-change="$ctrl.onDobChange(isValid)" show-validation-on-load="$ctrl.showValidationOnLoad" is-required="true" is-disabled="$ctrl.expressSignUpShowDob"></tng-date-input> </div> <div class="field" ng-if="$ctrl.isNewClientEnrollmentPersonalInfo"> <tng-phone-list-input ng-required="true" , show-validation-on-load="$ctrl.showValidationOnLoad" on-phone-updated="$ctrl.onPhoneUpdated(phones)" phone-list="$ctrl.data.phone_list" primary-phone-type="$ctrl.data.primaryPhoneType"> </tng-phone-list-input> </div> <div class="field" ng-if="!$ctrl.isNewClientEnrollmentPersonalInfo"> <label actionable-id="homePhoneLabel" class="heading--sub3 top-margin-large" ng-bind-html="::\'newClientEnrollment.basicInfo.phoneNumberHome\' | translate"></label> <div class="top-margin-small"> <tng-phone-num-input actionable-id="homePhoneComp" input-name="homePhone" ng-model="$ctrl.data.phoneNumbers.HOME.number" ng-required="true" custom-error-msg="{{ ::\'userSettings.general.basicInfo.validation.phonePattern\' | translate }}" show-validation-on-load="$ctrl.showValidationOnLoad"> </tng-phone-num-input> </div> </div> <div class="field" ng-if="!$ctrl.isNewClientEnrollmentPersonalInfo"> <label actionable-id="mobilePhoneLabel" class="heading--sub3 top-margin-medium"> <span ng-bind-html="::\'newClientEnrollment.basicInfo.phoneNumberMobile\' | translate"></span> <span ng-if="!$ctrl.isMobileRequired" class="c-basic-info-form__optional-label">{{:: \'newClientEnrollment.basicInfo.phoneNumberOptional\' | translate}}</span> </label> <div class="top-margin-small"> <tng-phone-num-input actionable-id="mobilePhoneComp" input-name="mobilePhone" ng-model="$ctrl.data.phoneNumbers.CELL.number" ng-required="$ctrl.isMobileRequired" custom-error-msg="{{ ::\'userSettings.general.basicInfo.validation.phonePattern\' | translate }}" on-view-value-changed="$ctrl.mobileViewValueChanged($event)" show-validation-on-load="$ctrl.showValidationOnLoad"> </tng-phone-num-input> </div> </div> <div class="top-margin-medium" ng-if="$ctrl.data.phoneNumbers.HOME.number\n              && $ctrl.data.phoneNumbers.CELL.number\n              && !$ctrl.isNewClientEnrollmentPersonalInfo "> <label class="heading--sub3"> {{ ::\'newClientEnrollment.basicInfo.primaryPhoneNumber\' | translate }} </label> </div> <div class="c-basic-info-form__primary-phone-select-wrapper field__group--wrap top-margin-small" ng-if="$ctrl.data.phoneNumbers.HOME.number\n                && $ctrl.data.phoneNumbers.CELL.number\n                && !$ctrl.isNewClientEnrollmentPersonalInfo"> <div class="field"> <input type="radio" class="input input--tangerine-radio" actionable-id="BasicInfoForm_phonePrimaryHome" ng-model="$ctrl.data.primaryPhoneType" value="HOME" required> <label class="heading--sub3 top-margin-none" for="BasicInfoForm_phonePrimaryHome" id="label_BasicInfoForm_phonePrimaryHome"> {{ ::\'clientOnboarding.basicInfoForm.phonenumberType.home\' | translate }} </label> </div> <div class="field"> <input type="radio" class="input input--tangerine-radio" actionable-id="BasicInfoForm_phonePrimaryMobile" ng-model="$ctrl.data.primaryPhoneType" value="CELL" ng-disabled="!$ctrl.data.phoneNumbers.CELL.number" required> <label class="heading--sub3 top-margin-none" for="BasicInfoForm_phonePrimaryMobile" id="label_BasicInfoForm_phonePrimaryMobile"> {{ ::\'clientOnboarding.basicInfoForm.phonenumberType.mobile\' | translate }} </label> </div> </div> <div class="c-basic-info-form__emp-select"> <tng-employment-select prefill-data="$ctrl.empInfoPrefill" on-change="$ctrl.onEmpInfoChange(data)" page-id="BasicInfoForm" ng-required="true" show-employer-name="true" show-validation-on-load="$ctrl.showEmploymentInfoValidationOnLoad" show-warning-border="true" is-new-client-enrollment="true"> </tng-employment-select> </div> <div class="field clearfix bottom-margin-none" ng-if="$ctrl.showBusinessPhone && $ctrl.employmentStatus()"> <label actionable-id="businessPhoneLabel" class="heading--sub3 top-margin-small"> <span ng-bind-html="::\'newClientEnrollment.basicInfo.phoneNumberWork\' | translate"></span> <span class="c-basic-info-form__optional-label">{{:: \'newClientEnrollment.basicInfo.phoneNumberOptional\' | translate}}</span> </label> <div class="top-margin-small"> <tng-phone-num-input class="c-basic-info__edit__field__input--work-phone" actionable-id="businessPhoneComp" input-name="businessPhone" custom-error-msg="{{ ::\'userSettings.general.basicInfo.validation.phonePattern\' | translate }}" ng-model="$ctrl.data.phoneNumbers.BUSINESS.number" show-validation-on-load="$ctrl.showValidationOnLoad"> </tng-phone-num-input> <div class="field c-basic-info__edit__field__input--work-phone-ext"> <input class="input" type="tel" actionable-id="businessPhoneExt" maxlength="5" ng-model="$ctrl.data.phoneNumbers.BUSINESS.extension" numeric-input placeholder="{{ ::\'userSettings.general.basicInfo.editModal.workPhone.extPlaceholder\' | translate }}"/> </div> </div> </div> </div> <div ng-if="$ctrl.isNewClientEnrollmentAddress" class="c-basic-info-form__new-client__address"> <div class="field c-basic-info-form__express-address-form"> <div ng-if="!$ctrl.expressSignUpShowAddress"> <label actionable-id="homeAddressLabel" class="heading--sub3 top-margin-large">{{ ::\'clientOnboarding.basicInfoForm.homeAddress\' | translate }}</label> <div class="top-margin-small narrow-width-section"> <tng-address-form-fields page-id="CurrentAddress" address-object="$ctrl.data.addresses.HOME" street-perfect="$ctrl.shouldEnableStreetPerfect" is-required="true" invalid-form="$ctrl.onAddressError(error)" validate-po-box="$ctrl.validatePoBox" show-po-box-validation-on-load="$ctrl.showPoBoxValidationOnLoad" show-validation-on-load="$ctrl.showValidationOnLoad" show-warning-border="true" is-new-client-enrollment="true"> </tng-address-form-fields> </div> </div> <div ng-if="$ctrl.expressSignUpShowAddress" class="c-basic-info-form__new-client__address__express-signup"> <div class="c-basic-info-form__new-client__edit-label__container"> <label actionable-id="homeAddressLabel" class="c-basic-info-form__new-client__edit-label__label"> Home Address </label> <div class="c-basic-info-form__new-client__edit-label__text" ng-click="$ctrl.expressSignUpOnEdit({field: \'address\'})"> Edit </div> </div> <div class="table c-basic-info-form__new-client__address__express-signup__table"> <div class="c-basic-info-form__new-client__address__express-signup__table__row" ng-if="true"> <div class="c-basic-info-form__new-client__address__express-signup__table__header">Street Number</div> <div class="c-basic-info-form__new-client__address__express-signup__table__value">{{$ctrl.expressSignUpAddressParsed.streetNum}}</div> </div> <div class="c-basic-info-form__new-client__address__express-signup__table__row" ng-if="true"> <div class="c-basic-info-form__new-client__address__express-signup__table__header">Street Name</div> <div class="c-basic-info-form__new-client__address__express-signup__table__value">{{$ctrl.expressSignUpAddressParsed.streetName}}</div> </div> <div class="c-basic-info-form__new-client__address__express-signup__table__row" ng-if="true"> <div class="c-basic-info-form__new-client__address__express-signup__table__header">Suite/Unit/Apt</div> <div class="c-basic-info-form__new-client__address__express-signup__table__value">{{$ctrl.expressSignUpAddressParsed.unit}}</div> </div> <div class="c-basic-info-form__new-client__address__express-signup__table__row" ng-if="true"> <div class="c-basic-info-form__new-client__address__express-signup__table__header">City & Province</div> <div class="c-basic-info-form__new-client__address__express-signup__table__value">{{$ctrl.expressSignUp.address.city}}, {{$ctrl.expressSignUp.address.province}}</div> </div> <div class="c-basic-info-form__new-client__address__express-signup__table__row" ng-if="true"> <div class="c-basic-info-form__new-client__address__express-signup__table__header">Postal Code</div> <div class="c-basic-info-form__new-client__address__express-signup__table__value">{{$ctrl.expressSignUp.address.postal_code}}</div> </div> </div> </div> </div> <div class="c-basic-info-form__new-client__address__address-toggle field" ng-if="$ctrl.showMailingAddress" ng-click="$ctrl.onMailingAddressDifferentClicked()"> <label class="top-margin-large max-text-width" ng-bind-html="::\'clientOnboarding.basicInfoForm.mailingAddressCheckboxNewClient\' | translate"> </label> <div class="field__group--inline top-margin-medium"> <div class="field margin-bottom-0"> <input ng-model="$ctrl.data.extraData.mailingAddressDifferent" ng-value="false" actionable-id="mailingAddressDifferentNo" class="input input--pill" type="radio" name="clientOnboardingSetupAccountForm_thirdPartyYes" value="false" ng-required="true"> <label for="mailingAddressDifferentNo" id="mailingAddressDifferent_label" class="c-client-onboarding__toggle-button ng-binding">{{ \'clientOnboarding.basicInfoForm.labels.yes\' | translate }}</label> </div> <div class="field margin-bottom-0 margin__l--fix1"> <input ng-model="$ctrl.data.extraData.mailingAddressDifferent" ng-value="true" actionable-id="mailingAddressDifferentYes" class="input input--pill" type="radio" value="true" ng-required="true"> <label for="mailingAddressDifferentYes" id="clientOnboardingSetupAccountForm_thirdPartyNo_label" class="c-client-onboarding__toggle-button">{{ \'clientOnboarding.basicInfoForm.labels.no\' | translate }}</label> </div> </div> <div class="field__error" ng-if="($ctrl.data.extraData.mailingAddressDifferent === undefined && $ctrl.showValidationOnLoad)"> <p> {{ ::\'newClientEnrollment.review.consent.blogValidation\' | translate }} </p> </div> </div> <div class="field c-basic-info-form__address-form c-basic-info-form__new-client__address__address-toggle" ng-if="$ctrl.showMailingAddress && $ctrl.data.extraData.mailingAddressDifferent"> <label actionable-id="mailingAddressLabel" class="heading--sub3 top-margin-medium"> {{ ::\'clientOnboarding.basicInfoForm.mailingAddress\' | translate }} </label> <div class="field__error" ng-if="$ctrl.identicalMailingAddresses"> {{ ::\'clientOnboarding.basicInfoForm.identicalMailingAddresses\' | translate }} </div> <div class="top-margin-small"> <tng-address-form-fields page-id="MailingAddress" address-object="$ctrl.data.addresses.MAILING" street-perfect="true" is-required="true" invalid-form="$ctrl.onAddressError(error)" show-validation-on-load="$ctrl.showMailingAddressValidationOnLoad" show-warning-border="true" is-new-client-enrollment="true"> </tng-address-form-fields> </div> </div> </div> <div ng-if="!($ctrl.isNewClientEnrollmentPersonalInfo || $ctrl.isNewClientEnrollmentAddress)" class="narrow-width-section"> <div class="field"> <label actionable-id="title" class="heading--sub3 top-margin-none">{{ ::\'newClientEnrollment.basicInfo.name\' | translate }}</label> <div> <tng-salutation-select on-update="$ctrl.data.title = salutation" input-name="title" init-value="$ctrl.data.title" is-required="true" show-validation-on-load="$ctrl.showValidationOnLoad" show-warning-border="true"> </tng-salutation-select> </div> </div> <div class="grid__container c-basic-info-form__name"> <div class="field styleguide-grid-unit grid__column--1of2 c-basic-info-form__first-name"> <input actionable-id="firstName" class="input bottom-margin-none" ng-class="{ \'warning\':\n              ($ctrl.form.firstName.$touched || $ctrl.showValidationOnLoad) &&\n              (($ctrl.data.first_name.length + $ctrl.data.last_name.length) > 39 ||\n              !$ctrl.form.firstName.$valid)\n            }" maxlength="32" type="text" ng-disabled="$ctrl.disableEdit" ng-model="$ctrl.data.first_name" ng-pattern="$ctrl.NAME_PATTERN" placeholder="{{ ::\'newClientEnrollment.basicInfo.firstName\' | translate }}" ng-required="true"> </div> <div class="field styleguide-grid-unit grid__column--1of2 c-basic-info-form__last-name"> <input actionable-id="lastName" class="input bottom-margin-none" ng-class="{ \'warning\':\n              ($ctrl.form.lastName.$touched || $ctrl.showValidationOnLoad) &&\n              (($ctrl.data.first_name.length + $ctrl.data.last_name.length) > 39 ||\n              !$ctrl.form.lastName.$valid)\n            }" maxlength="32" type="text" ng-pattern="$ctrl.NAME_PATTERN" ng-disabled="$ctrl.disableEdit" ng-model="$ctrl.data.last_name" placeholder="{{ ::\'newClientEnrollment.basicInfo.lastName\' | translate }}" ng-required="true"> </div> </div> <div class="field__error" ng-show="($ctrl.form.firstName.$error.required && ($ctrl.form.firstName.$touched || $ctrl.showValidationOnLoad)) ||\n          ($ctrl.form.lastName.$error.required && ($ctrl.form.lastName.$touched || $ctrl.showValidationOnLoad))"> {{ ::\'global.validation.required\' | translate }} </div> <div class="field__error" ng-show="$ctrl.form.firstName.$error.pattern && ($ctrl.form.firstName.$touched || $ctrl.showValidationOnLoad)"> {{ ::\'clientOnboarding.basicInfoForm.namePatternError\' | translate }} </div> <div class="field__error" ng-show="$ctrl.form.lastName.$error.pattern && ($ctrl.form.lastName.$touched || $ctrl.showValidationOnLoad)"> {{ ::\'clientOnboarding.basicInfoForm.lastNamePatternError\' | translate }} </div> <div class="field__error" ng-show="(($ctrl.form.firstName.$touched && $ctrl.form.lastName.$touched)  || $ctrl.showValidationOnLoad) &&\n          ($ctrl.data.first_name.length + $ctrl.data.last_name.length) > 39"> {{ ::\'clientOnboarding.basicInfoForm.fullNameLengthError\' | translate }} </div> <p class="small" ng-if="!$ctrl.shouldHideUseLegalNameNote"> {{ ::\'clientOnboarding.basicInfoForm.pleaseUseLegalName\' | translate }} </p> <div class="field" ng-if="$ctrl.showEmail"> <label class="top-margin-large">{{ ::\'clientOnboarding.basicInfoForm.email\' | translate }}</label> <input actionable-id="BasicInfoForm_email" class="input" ng-model="$ctrl.data.email" ng-pattern="$ctrl.emailRegexPattern" ng-required="true" placeholder="{{ ::\'clientOnboarding.basicInfoForm.placeholders.email\' | translate }}" type="email"/> </div> <div class="field__error" ng-messages="$ctrl.form.BasicInfoForm_email.$error" ng-if="$ctrl.form.BasicInfoForm_email.$touched || $ctrl.showValidationOnLoad"> <p ng-message="email"> {{ ::\'validation.email\' | translate}} </p> <p ng-message="required"> {{ ::\'validation.isRequired\' | translate}} </p> <p ng-message="pattern"> {{ ::\'validation.email\' | translate}} </p> </div> <span class="error_msg" ng-show="$ctrl.form.BasicInfoForm_email.$valid && !$ctrl.inputIsValid(\'BasicInfoForm_email\')"> {{ ::\'clientOnboarding.tpiForm.errors.required\' | translate }} </span> <div class="field" ng-if="$ctrl.customer.dateOfBirth"> <label class="top-margin-large">{{ ::\'clientOnboarding.basicInfoForm.dateOfBirth\' | translate }}</label> <div class="field__icon icon-calendar"></div> <input type="text" class="input" disabled="true" date-format="DD/MMM/YYYY" ng-model="$ctrl.data.dateOfBirth" actionable-id="BasicInfoForm_dateOfBirth"/> </div> <div class="field" ng-if="$ctrl.showDateOfBirth"> <label actionable-id="dateOfBirth" class="top-margin-large"> {{ ::\'newClientEnrollment.basicInfo.dateOfBirth\' | translate }} </label> <tng-date-input input-id="dateOfBirth" is-date-of-birth="true" date-model="$ctrl.data.birth_date" on-change="$ctrl.onDobChange(isValid)" show-validation-on-load="$ctrl.showValidationOnLoad" is-required="true"></tng-date-input> </div> <div class="field" ng-if="$ctrl.showSin"> <label actionable-id="sinNumber" class="top-margin-large">{{ ::\'clientOnboarding.basicInfoForm.sin\' | translate }} <tng-help-bubble analytics-id="$ctrl.helpBubbleAnalyticsId" ng-if="$ctrl.sinData.editable"> {{::\'newClientEnrollment.identityInfo.sinRequirement\' | translate}} </tng-help-bubble> </label> <div class="top-margin-small"> <tng-sin-input ng-model="$ctrl.data.sin" ng-required="true" show-validation-on-load="$ctrl.showValidationOnLoad" ng-readonly="!$ctrl.sinData.editable" input-id="BasicInfoForm_sin"></tng-sin-input> </div> </div> <div class="field c-basic-info-form__address-form"> <label actionable-id="homeAddressLabel" class="heading--sub3 top-margin-large">{{ ::\'clientOnboarding.basicInfoForm.homeAddress\' | translate }}</label> <div class="top-margin-small"> <tng-address-form-fields page-id="CurrentAddress" address-object="$ctrl.data.addresses.HOME" street-perfect="true" is-required="true" invalid-form="$ctrl.onAddressError(error)" validate-po-box="$ctrl.validatePoBox" show-po-box-validation-on-load="$ctrl.showPoBoxValidationOnLoad" show-validation-on-load="$ctrl.showValidationOnLoad" show-warning-border="true"> </tng-address-form-fields> </div> </div> <div class="field top-margin-medium" ng-if="$ctrl.showMailingAddress" ng-click="$ctrl.onMailingAddressDifferentClicked()"> <input class="input" ng-checked="$ctrl.data.extraData.mailingAddressDifferent" type="checkbox" actionable-id="mailingAddressCheckbox"> <label for="checkbox"> <span> {{ ::\'clientOnboarding.basicInfoForm.mailingAddressCheckbox\' | translate }} </span> </label> </div> <div class="field c-basic-info-form__address-form" ng-if="$ctrl.showMailingAddress && $ctrl.data.extraData.mailingAddressDifferent"> <label actionable-id="mailingAddressLabel" class="heading--sub3 top-margin-medium"> {{ ::\'clientOnboarding.basicInfoForm.mailingAddress\' | translate }} </label> <div class="field__error" ng-if="$ctrl.identicalMailingAddresses"> {{ ::\'clientOnboarding.basicInfoForm.identicalMailingAddresses\' | translate }} </div> <div class="top-margin-small"> <tng-address-form-fields page-id="MailingAddress" address-object="$ctrl.data.addresses.MAILING" street-perfect="true" is-required="true" invalid-form="$ctrl.onAddressError(error)" show-validation-on-load="$ctrl.showMailingAddressValidationOnLoad" show-warning-border="true"> </tng-address-form-fields> </div> </div> <div class="field"> <label actionable-id="homePhoneLabel" class="heading--sub3 top-margin-large" ng-bind-html="::\'newClientEnrollment.basicInfo.phoneNumberHome\' | translate"></label> <div class="top-margin-small"> <tng-phone-num-input actionable-id="homePhoneComp" input-name="homePhone" ng-model="$ctrl.data.phoneNumbers.HOME.number" ng-required="true" custom-error-msg="{{ ::\'userSettings.general.basicInfo.validation.phonePattern\' | translate }}" show-validation-on-load="$ctrl.showValidationOnLoad"> </tng-phone-num-input> </div> </div> <div class="field"> <label actionable-id="mobilePhoneLabel" class="heading--sub3 top-margin-medium"> <span ng-bind-html="::\'newClientEnrollment.basicInfo.phoneNumberMobile\' | translate"></span> <span ng-if="!$ctrl.isMobileRequired">{{:: \'newClientEnrollment.basicInfo.phoneNumberOptional\' | translate}}</span> </label> <div class="top-margin-small"> <tng-phone-num-input actionable-id="mobilePhoneComp" input-name="mobilePhone" ng-model="$ctrl.data.phoneNumbers.CELL.number" ng-required="$ctrl.isMobileRequired" custom-error-msg="{{ ::\'userSettings.general.basicInfo.validation.phonePattern\' | translate }}" on-view-value-changed="$ctrl.mobileViewValueChanged($event)" show-validation-on-load="$ctrl.showValidationOnLoad"> </tng-phone-num-input> </div> </div> <div class="field clearfix bottom-margin-none" ng-if="$ctrl.showBusinessPhone"> <label actionable-id="businessPhoneLabel" class="heading--sub3 top-margin-small"> <span ng-bind-html="::\'newClientEnrollment.basicInfo.phoneNumberWork\' | translate"></span> <span>{{:: \'newClientEnrollment.basicInfo.phoneNumberOptional\' | translate}}</span> </label> <div class="top-margin-small"> <tng-phone-num-input class="c-basic-info__edit__field__input--work-phone" actionable-id="businessPhoneComp" input-name="businessPhone" custom-error-msg="{{ ::\'userSettings.general.basicInfo.validation.phonePattern\' | translate }}" ng-model="$ctrl.data.phoneNumbers.BUSINESS.number" show-validation-on-load="$ctrl.showValidationOnLoad"> </tng-phone-num-input> <div class="field c-basic-info__edit__field__input--work-phone-ext"> <input class="input" type="tel" actionable-id="businessPhoneExt" maxlength="5" ng-model="$ctrl.data.phoneNumbers.BUSINESS.extension" numeric-input placeholder="{{ ::\'userSettings.general.basicInfo.editModal.workPhone.extPlaceholder\' | translate }}"/> </div> </div> </div> <div class="top-margin-small"> <label class="heading--sub3"> {{ ::\'newClientEnrollment.basicInfo.primaryPhoneNumber\' | translate }} </label> </div> <div class="c-basic-info-form__primary-phone-select-wrapper field__group--wrap top-margin-small"> <div class="field"> <input type="radio" class="input input--tangerine-radio" actionable-id="BasicInfoForm_phonePrimaryHome" ng-model="$ctrl.data.primaryPhoneType" value="HOME" required> <label class="heading--sub3 top-margin-none" for="BasicInfoForm_phonePrimaryHome" id="label_BasicInfoForm_phonePrimaryHome"> {{ ::\'clientOnboarding.basicInfoForm.phonenumberType.home\' | translate }} </label> </div> <div class="field"> <input type="radio" class="input input--tangerine-radio" actionable-id="BasicInfoForm_phonePrimaryMobile" ng-model="$ctrl.data.primaryPhoneType" value="CELL" ng-disabled="!$ctrl.data.phoneNumbers.CELL.number" required> <label class="heading--sub3 top-margin-none" for="BasicInfoForm_phonePrimaryMobile" id="label_BasicInfoForm_phonePrimaryMobile"> {{ ::\'clientOnboarding.basicInfoForm.phonenumberType.mobile\' | translate }} </label> </div> </div> <div class="c-basic-info-form__emp-select"> <tng-employment-select prefill-data="$ctrl.empInfoPrefill" on-change="$ctrl.onEmpInfoChange(data)" page-id="BasicInfoForm" ng-required="true" show-employer-name="true" show-validation-on-load="$ctrl.showValidationOnLoad" show-warning-border="true"> </tng-employment-select> </div> <div class="c-basic-info-form__emp-address" ng-if="$ctrl.showEmployerAddress && $ctrl.employmentStatus()"> <div class="top-margin-medium"> <label ng-if="$ctrl.employerAddressMandatory" class="heading--sub3"> {{ ::\'userSettings.general.basicInfo.editModal.employerAddress\' | translate }} </label> <label ng-if="!$ctrl.employerAddressMandatory" class="heading--sub3"> {{ ::\'userSettings.general.basicInfo.editModal.employerAddressOptional\' | translate }} </label> </div> <div class="top-margin-small"> <tng-address-form-fields street-perfect="false" page-id="BasicInfoForm" address-object="$ctrl.data.employer.company_address" actionable-id="BasicInfoForm_employer-address" is-required="$ctrl.employerAddressMandatory" show-validation-on-load="$ctrl.showValidationOnLoadEmployerAddress" hide-address-line2="true"> </tng-address-form-fields> </div> </div> </div> <input type="submit" style="position:absolute;left:-9999px;width:1px;height:1px"/> </form> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4901),s=(i=a)&&i.__esModule?i:{default:i};n(4902);var r={template:s.default,controller:function(){},bindings:{title:"@",discount:"@",icon:"@",color:"@",size:"@",discountSize:"@"}};e.default=r,t.exports=e.default},function(t,e){t.exports="<div class=\"c-category-icon\" ng-style=\"{ maxWidth: $ctrl.size ? $ctrl.size + 'px' : ''}\"> <div class=\"c-category-icon__circle\" ng-style=\"{\n  backgroundColor: $ctrl.color,\n  width: $ctrl.size + 'px',\n  height: $ctrl.size + 'px',\n  fontSize: $ctrl.size ? $ctrl.size + 'px' : '',\n  }\"> <i class=\"{{$ctrl.icon}} c-category-icon__icon\"></i> <div class=\"c-category-icon__category-discount\" ng-if=\"::$ctrl.discount\" ng-style=\"{\n       color: $ctrl.color,\n       minWidth: $ctrl.discountSize + 'px',\n       minHeight: $ctrl.discountSize + 'px',\n       fontSize: (+$ctrl.discountSize - 8) + 'px',\n       borderRadius: $ctrl.discountSize + 'px',\n       border: '1px solid ' + $ctrl.color\n       }\">{{$ctrl.discount}}</div> </div> <h6 class=\"c-category-icon__category-title\" ng-if=\"::$ctrl.title\"> {{$ctrl.title}} </h6> </div> "},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4904)),a=s(n(4905));function s(t){return t&&t.__esModule?t:{default:t}}n(4906);var r={template:i.default,controller:a.default,bindings:{initialValue:"<?",onValueChanged:"&?",isRequired:"<",localizationPrefix:"<?",flowServiceOverride:"<?",borrowedMoneyFromConstOverride:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-leverage-section"> <section class="c-mutual-fund-amount__upper-section container c-mutual-fund-amount__section--top-margin-mid"> <div class="field c-leverage-section__tbGap"> <h2>{{ ::$ctrl.localizationPrefix.concat(\'.borrowedMoney.part1\') | translate }}</h2> <p>{{ ::$ctrl.localizationPrefix.concat(\'.borrowedMoney.part2\') | translate }}</p> <div class="field__group--inline margin__t--fix2"> <div class="field"> <input id="borrowedNo" name="borrowedNo" class="input input--pill" ng-click="$ctrl.handleToggle()" ng-model="$ctrl.internalModel" ng-value="false" ng-required="$ctrl.isRequired" type="radio"/> <label id="lblNo" class="c-leverage-section__borrowButton" for="borrowedNo">{{ ::$ctrl.localizationPrefix.concat(\'.borrowedMoney.borrowedMoneyNo\') | translate }}</label> </div> <div class="field"> <input id="borrowedYes" name="borrowedYes" class="input input--pill" ng-click="$ctrl.handleToggle()" ng-model="$ctrl.internalModel" ng-value="true" ng-required="$ctrl.isRequired" type="radio"/> <label id="lblYes" class="c-leverage-section__borrowButton" for="borrowedYes">{{ ::$ctrl.localizationPrefix.concat(\'.borrowedMoney.borrowedMoneyYes\') | translate }}</label> </div> </div> </div> <div ng-if="$ctrl.internalModel" class="margin__t--fix2 c-leverage-section__tbGap"> <div class="field c-move-money-borrowedMoney__tbGap"> <h4 class="heading--sub3 top-margin-medium"> {{ ::$ctrl.localizationPrefix.concat(\'.borrowedMoney.borrowedMoneyLoanType.title\') | translate }} </h4> <input id="{{ ::$ctrl.pageId }}_loc" actionable-id="{{ ::$ctrl.pageId }}_loc" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.borrowedMoneyFromConst.LINE_OF_CREDIT" ng-click="$ctrl.radioSelectionChanged($ctrl.borrowedMoneyFromConst.LINE_OF_CREDIT)"/> <label for="{{ ::$ctrl.pageId }}_loc"> {{ ::$ctrl.localizationPrefix.concat(\'.borrowedMoney.borrowedMoneyLoanType.loc\') | translate }} </label> <input id="{{ ::$ctrl.pageId }}_cc" actionable-id="{{ ::$ctrl.pageId }}_cc" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.borrowedMoneyFromConst.CREDIT_CARD" ng-click="$ctrl.radioSelectionChanged($ctrl.borrowedMoneyFromConst.CREDIT_CARD)"/> <label for="{{ ::$ctrl.pageId }}_cc"> {{ ::$ctrl.localizationPrefix.concat(\'.borrowedMoney.borrowedMoneyLoanType.cc\') | translate }} </label> <input id="{{ ::$ctrl.pageId }}_mortgageLoan" actionable-id="{{ ::$ctrl.pageId }}_mortgageLoan" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.borrowedMoneyFromConst.MORTGAGE_TERM_LOAN" ng-click="$ctrl.radioSelectionChanged($ctrl.borrowedMoneyFromConst.MORTGAGE_TERM_LOAN)"/> <label for="{{ ::$ctrl.pageId }}_mortgageLoan"> {{ ::$ctrl.localizationPrefix.concat(\'.borrowedMoney.borrowedMoneyLoanType.mortgageTermLoan\') | translate }} </label> <input id="{{ ::$ctrl.pageId }}_rrspLoan" actionable-id="{{ ::$ctrl.pageId }}_rrspLoan" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.borrowedMoneyFromConst.RRSP_LOAN" ng-click="$ctrl.radioSelectionChanged($ctrl.borrowedMoneyFromConst.RRSP_LOAN)"/> <label for="{{ ::$ctrl.pageId }}_rrspLoan"> {{ ::$ctrl.localizationPrefix.concat(\'.borrowedMoney.borrowedMoneyLoanType.rrsp\') | translate }} </label> <input id="{{ ::$ctrl.pageId }}_borrowedFromFF" actionable-id="{{ ::$ctrl.pageId }}_borrowedFromFF" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.borrowedMoneyFromConst.BORROWED_FROM_FAMILY_FRIENDS" ng-click="$ctrl.radioSelectionChanged($ctrl.borrowedMoneyFromConst.BORROWED_FROM_FAMILY_FRIENDS)"/> <label for="{{ ::$ctrl.pageId }}_borrowedFromFF"> {{ ::$ctrl.localizationPrefix.concat(\'.borrowedMoney.borrowedMoneyLoanType.borrowedFromFamilyFriend\') | translate }} </label> </div> <div class="field c-move-money-borrowedMoney__tbGap"> <h4 class="heading--sub3 top-margin-medium"> {{ ::$ctrl.localizationPrefix.concat(\'.borrowedMoney.borrowedMoneyAgreementTitle\') | translate }} </h4> <input id="{{ ::$ctrl.pageId }}_agreement" actionable-id="{{ ::$ctrl.pageId }}_agreement" name="checkbox" class="input input--tangerine-checkbox" type="checkbox" ng-checked="$ctrl.flowService.borrowedMoneyAgreement" ng-click="$ctrl.isAgreementSelected()" ng-model="$ctrl.agreementSelectionMode" ng-change="$ctrl.flowService.setBorrowedMoneyAgreement($ctrl.agreementSelectionMode)"/> <label for="{{ ::$ctrl.pageId }}_agreement"> {{ ::$ctrl.localizationPrefix.concat(\'.borrowedMoney.borrowedMoneyAgreement\') | translate }} <a actionable-id="{{ ::$ctrl.pageId }}_agreementPDFLink" ng-href="{{ ::$ctrl.localizationPrefix.concat(\'.borrowedMoney.borrowedMoneyAgreementPDFhref\') | translate | absoluteHref:\'url\' }}" target="_blank"> {{ ::$ctrl.localizationPrefix.concat(\'.borrowedMoney.borrowedMoneyAgreementPDFlink\') | translate }} </a> </label> </div> </div> </section> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.$log=e,this.flowService=n,this.borrowedMoneyFromConst=a.borrowedMoneyFrom,this.pageId="leverageSectionBorrowedMoney"}return(0,a.default)(t,[{key:"$onInit",value:function(){this.localizationPrefix||(this.localizationPrefix="mutualFund"),this.flowServiceOverride&&(this.flowService=this.flowServiceOverride),this.borrowedMoneyFromConstOverride&&(this.borrowedMoneyFromConst=this.borrowedMoneyFromConstOverride),this.isAllBorrowedMoneyFormsSelected?(this.internalModel=!0,this.radioSelectionMode=this.flowService.borrowedMoneyFrom,this.agreementSelectionMode=!0,this.flowService.BUTTONS.BTN_ORG.disable=!1):void 0!==this.flowService.buyFundsHasBorrowedMoney?(this.internalModel=this.initialValue||!1,this.flowService.BUTTONS.BTN_ORG.disable=!(this.isAllBorrowedMoneyFormsSelected||!this.internalModel)):(this.internalModel=this.initialValue=void 0,this.flowService.setBuyFundsHasBorrowedMoney(void 0))}},{key:"handleToggle",value:function(){this.onValueChanged&&this.onValueChanged({leverage:this.internalModel}),this.radioSelectionMode=void 0,this.agreementSelectionMode=!1,this.flowService.setBuyFundsHasBorrowedMoney(this.internalModel),this.flowService.setBorrowedMoneyFrom(void 0),this.flowService.setBorrowedMoneyAgreement(!1),this.flowService.BUTTONS.BTN_ORG.disable=!(this.isAllBorrowedMoneyFormsSelected||!this.internalModel)}},{key:"radioSelectionChanged",value:function(t){this.flowService.setBorrowedMoneyFrom(t),this.radioSelectionMode=t,this.isAllBorrowedMoneyFormsSelected&&(this.flowService.BUTTONS.BTN_ORG.disable=!1)}},{key:"isAgreementSelected",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=!this.isAllBorrowedMoneyFormsSelected}},{key:"isAllBorrowedMoneyFormsSelected",get:function(){return Boolean(this.flowService.borrowedMoneyFrom&&this.flowService.borrowedMoneyAgreement)}}]),t}();r.$inject=["$log","MutualFundFlowService","mutualFundConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(4908));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(4909)).default,controller:i.default};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(8)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s,r,o,c,l,u,d,h,f,p,g,m){(0,a.default)(this,t),this.$log=e,this.$scope=n,this.$state=i,this.GlobalModalsService=r,this.EventBusService=o,this.BackButtonService=c,this.gmConstants=l,this.stateConstants=u,this.accountConstants=d,this.backButtonConstants=h,this.accountDetailsService=f,this.StepUpService=p,this.stepUpConstants=g,this.BundleService=m,this.MOVEMONEY_TYPES=s.MODAL_TYPES,this.modalType=this.MOVEMONEY_TYPES.DEFAULT,this.stateModalMap=this._buildStateMap(),this.parentAccount={},this.currentModal=null}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;this.GlobalModalsService.subscribe(this.$scope,(function(e,n){t._handleShowModal(n)})),this.GlobalModalsService.subscribeToClose(this.$scope,(function(e,n){n===t.gmConstants.AVAILABLE_MODALS.MOBILE_STEP_UP?t.showMobileStepUp=!1:n===t.gmConstants.AVAILABLE_MODALS.DOCUMENT_PROOF_INSTRUCTION?t.showDocumentProofInstruction=!1:n===t.gmConstants.AVAILABLE_MODALS.DOCUMENT_PROOF_UPLOAD?t.showDocumentProofUpload=!1:t.closeModal()})),this.EventBusService.subscribe(this.$scope,"$stateChangeSuccess",(function(e,n,i){n.data&&n.data.isModal&&(e.currentScope&&e.currentScope.previousStateName&&(t.previousStateName=e.currentScope.previousStateName),t._handleShowModalFromStateChange(n,i))})),this.BackButtonService.addBackButtonListener(this.$scope,this.backButtonConstants.PRIORITY.IS_MODAL,(function(){return null!=t.currentModal&&t.currentModal!==t.gmConstants.AVAILABLE_MODALS.E_NOTIFICATION&&(t.$log.debug("backButtonListener onModalClose"),!0)})),this.closeModal()}},{key:"_handleShowModal",value:function(t){var e=this;this.BundleService.ensureModalBundling(t.modal).then((function(){t.state?e._handleShowModalFromStateChange(t.state,t.params):e._checkAuthorization(t)}))}},{key:"_handleShowModalFromStateChange",value:function(t,e){var n=angular.extend({},e);n.modal=this.stateModalMap[t.name],n.modal&&this._checkAuthorization(n,t)}},{key:"_showModal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(this.closeModal(),this._addDialogBodyClass(),this.currentState=e,this.$state.kvp_current=this.$state.current.url+"?modal="+t.modal,this.$state.kvp_previous=this.$state.current.url,this.currentModal=t.modal,this.currentData=t,t.modal){case this.gmConstants.AVAILABLE_MODALS.MOVE_MONEY:this.currentModal=this.gmConstants.AVAILABLE_MODALS.MOVE_MONEY,this.modalType=this.MOVEMONEY_TYPES.DEFAULT;break;case this.gmConstants.AVAILABLE_MODALS.MOVE_MONEY_SELECTED_ACCOUNT:this.currentModal=this.gmConstants.AVAILABLE_MODALS.MOVE_MONEY,this.modalType=t.modalType,this.currentData.parentAccount=t.account;break;case this.gmConstants.AVAILABLE_MODALS.MOVE_MONEY_CC:this.currentModal=this.gmConstants.AVAILABLE_MODALS.MOVE_MONEY,this.modalType=this.MOVEMONEY_TYPES.CCFULLPAY;break;case this.gmConstants.AVAILABLE_MODALS.MOVE_MONEY_EDIT:this.currentModal=this.gmConstants.AVAILABLE_MODALS.MOVE_MONEY,this.modalType=this.MOVEMONEY_TYPES.EDIT,this.currentData.transaction=t.transaction,this.currentData.parentAccount=t.transaction.from_account;break;case this.gmConstants.AVAILABLE_MODALS.E_NOTIFICATION:this.roadblockType=t.roadblockType,this.roadblockData=t.roadblockData,this.notificationData=t.data,this.notificationTemplateId=t.templateId,this.highRiskClient=t.highRiskClient,this.nextState=t.nextState,this.nextParams=t.nextStateParams,this.amlEventInProgressFlow=t.amlEventInProgressFlow;break;case this.gmConstants.AVAILABLE_MODALS.AML_CONFIRM_INFO:this.currentModal=this.gmConstants.AVAILABLE_MODALS.AML_CONFIRM_INFO,this.modalObj=t,this.customer=t.customer,this.isBusiness=t.isBusiness,this.showCancelButton=t.showCancelButton,this.eventType=t.eventType,this.showSin=void 0!==t.showSin&&t.showSin,this.isEmployerAddressMandatory=void 0!==t.isEmployerAddressMandatory&&t.isEmployerAddressMandatory;break;case this.gmConstants.AVAILABLE_MODALS.OTHER_COMMUNICATIONS:this.currentModal=this.gmConstants.AVAILABLE_MODALS.OTHER_COMMUNICATIONS,this.userData=t.userData,this.accounts=t.accounts,this.capabilities=t.capabilities,this.behaviors=t.behaviors;break;case this.gmConstants.AVAILABLE_MODALS.SHOW_DOUBLE_SAFE_MODAL:this.currentModal=this.gmConstants.AVAILABLE_MODALS.SHOW_DOUBLE_SAFE_MODAL;break;case this.gmConstants.AVAILABLE_MODALS.UNCATEGORIZED_TRANSACTIONS:case this.gmConstants.AVAILABLE_MODALS.UNCONFIRMED_TRANSACTIONS:case this.gmConstants.AVAILABLE_MODALS.PAY_BILL:case this.gmConstants.AVAILABLE_MODALS.PAY_BILL_V2:case this.gmConstants.AVAILABLE_MODALS.ADD_BILLER_V2:case this.gmConstants.AVAILABLE_MODALS.ADD_BILL:case this.gmConstants.AVAILABLE_MODALS.CREDIT_CARD_BALANCE_TRANSFER:case this.gmConstants.AVAILABLE_MODALS.CREDIT_LIMIT_CHANGE:case this.gmConstants.AVAILABLE_MODALS.ACTIVATE_CREDIT_CARD:case this.gmConstants.AVAILABLE_MODALS.ACTIVATE_DEBIT_CARD:case this.gmConstants.AVAILABLE_MODALS.RDC:case this.gmConstants.AVAILABLE_MODALS.DIRECT_DEPOSIT_FORM:case this.gmConstants.AVAILABLE_MODALS.ASP:case this.gmConstants.AVAILABLE_MODALS.CSA_CONVERSION:case this.gmConstants.AVAILABLE_MODALS.REFER_FRIEND:case this.gmConstants.AVAILABLE_MODALS.ORDER_CHEQUES:case this.gmConstants.AVAILABLE_MODALS.PENDING_APPLICATIONS:case this.gmConstants.AVAILABLE_MODALS.MAGIC_SWITCH_MODAL:case this.gmConstants.AVAILABLE_MODALS.PEOPLE_LIKE_YOU:case this.gmConstants.AVAILABLE_MODALS.REACH_GOAL_SOONER:case this.gmConstants.AVAILABLE_MODALS.KYC_ROADBLOCK_MODAL:break;case this.gmConstants.AVAILABLE_MODALS.SEND_ETRANSFER_MODAL:case this.gmConstants.AVAILABLE_MODALS.EMT:case this.gmConstants.AVAILABLE_MODALS.UPDATE_EMAIL_MODAL:case this.gmConstants.AVAILABLE_MODALS.MORTGAGE_RENEWAL_MODAL:case this.gmConstants.AVAILABLE_MODALS.MAKE_INITIAL_DEPOSIT_MODAL:case this.gmConstants.AVAILABLE_MODALS.EMT_RECLAIM:case this.gmConstants.AVAILABLE_MODALS.ACCOUNT_CONTRIBUTION_DETAILS_MODAL:case this.gmConstants.AVAILABLE_MODALS.MANUAL_REVIEW_TLOC_APPLICATION_MODAL:case this.gmConstants.AVAILABLE_MODALS.TLOC_APP_VERIFY_METHOD_MODAL:this.modalObj=t;break;case this.gmConstants.AVAILABLE_MODALS.DONATIONS:t.flags?this.donationFlags=t.flags:this.donationFlags=null;break;case this.gmConstants.AVAILABLE_MODALS.HOLDS:this.modalObj=t;break;case this.gmConstants.AVAILABLE_MODALS.REWARDS:this.currentState&&this.currentState.data&&(this.currentState.data.baseState=null),this.currentStep=t.currentStep,this.modalObj=t.modalObj;break;case this.gmConstants.AVAILABLE_MODALS.GIC_MATURITY_OPTIONS:this.modalObj=t.modalObj;break;case this.gmConstants.AVAILABLE_MODALS.OVERDRAFT_CHANGE_LIMIT:case this.gmConstants.AVAILABLE_MODALS.OVERDRAFT_PROTECTION_APPLY:this.modalObj=t;break;case this.gmConstants.AVAILABLE_MODALS.OVERDRAFT_CONSENT_MODAL:this.currentModal=this.gmConstants.AVAILABLE_MODALS.OVERDRAFT_CONSENT_MODAL,this.modalObj=t;break;case this.gmConstants.AVAILABLE_MODALS.RIF_SUMMARY_MODAL:this.currentModal=this.gmConstants.AVAILABLE_MODALS.RIF_SUMMARY_MODAL,this.modalObj=t;break;case this.gmConstants.AVAILABLE_MODALS.GOALS:this.currentModal=this.gmConstants.AVAILABLE_MODALS.GOALS,this.modalObj=t;break;case this.gmConstants.AVAILABLE_MODALS.ACCOUNT_AGGREGATION:this.currentModal=this.gmConstants.AVAILABLE_MODALS.ACCOUNT_AGGREGATION,this.modalObj=t;break;case this.gmConstants.AVAILABLE_MODALS.ACTIVATE_OFFER_MODAL:this.currentModal=this.gmConstants.AVAILABLE_MODALS.ACTIVATE_OFFER_MODAL,this.modalObj=t;break;case this.gmConstants.AVAILABLE_MODALS.BENEFICIARIES_MODAL:this.modalObj=t,t.params&&t.params.accountNumber&&(this.modalObj.accountNumber=t.params.accountNumber);break;case this.gmConstants.AVAILABLE_MODALS.DEBIT_CARD_REPLACEMENT:case this.gmConstants.AVAILABLE_MODALS.CREDIT_CARD_CONVERSION:break;case this.gmConstants.AVAILABLE_MODALS.JOINT_INVITE_MANAGER:this.currentModal=this.gmConstants.AVAILABLE_MODALS.JOINT_INVITE_MANAGER,this.modalObj=t;break;default:this.currentModal=null}}},{key:"_checkAuthorization",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.gmConstants.AVAILABLE_MODALS.MOBILE_STEP_UP===t.modal?this.showMobileStepUp=!0:this.gmConstants.AVAILABLE_MODALS.DOCUMENT_PROOF_INSTRUCTION===t.modal?(this.showDocumentProofInstruction=!0,this.documentProofData=t):this.gmConstants.AVAILABLE_MODALS.DOCUMENT_PROOF_UPLOAD===t.modal?(this.showDocumentProofUpload=!0,this.documentProofData=t):this.gmConstants.LEVEL2_REQUIRED_MODALS.indexOf(t.modal)<0?this._showModal(t,n):this.StepUpService.requestLevel2().then((function(){e.$log.info("Step Up succeeded, dismiss Step Up and show target modal"),e._showModal(t,n)}))}},{key:"closeModal",value:function(t){this.currentModal&&(this.$state.kvp_previous=this.$state.current.url+"?modal="+this.currentModal,this.$state.kvp_current=this.$state.current.url),this.GlobalModalsService.lastModalClosed=this.currentModal,this.currentModal&&this.EventBusService.publish(this.gmConstants.GLOBAL_EVENTS.GLOBAL_MODAL_CLOSE,(0,i.default)({modalType:this.currentModal},t)),this.currentModal=null,this._removeDialogBodyClass();var e=this.currentState&&this.currentState.data?this.currentState.data.baseState:null;e&&(this.previousStateName===this.stateConstants.INSIGHTS?this.$state.go(this.stateConstants.INSIGHTS):this.$state.go(e))}},{key:"closeDocumentProofInstructionModal",value:function(){this.showDocumentProofInstruction=!1}},{key:"closeDocumentProofUploadModal",value:function(){this.showDocumentProofUpload=!1}},{key:"closeStepUpModal",value:function(){this.showMobileStepUp=!1}},{key:"_buildStateMap",value:function(){var t={};return t[this.stateConstants.MOVE_MONEY_MODAL]=this.gmConstants.AVAILABLE_MODALS.MOVE_MONEY,t[this.stateConstants.PAY_BILLS_MODAL]=this.gmConstants.AVAILABLE_MODALS.PAY_BILL,t[this.stateConstants.PAY_BILLS_MODAL_V2]=this.gmConstants.AVAILABLE_MODALS.PAY_BILL_V2,t[this.stateConstants.ADD_BILLER_MODAL_V2]=this.gmConstants.AVAILABLE_MODALS.ADD_BILLER_V2,t[this.stateConstants.SEND_ETRANSFER_MODAL]=this.gmConstants.AVAILABLE_MODALS.SEND_ETRANSFER_MODAL,t[this.stateConstants.EMT_MODAL]=this.gmConstants.AVAILABLE_MODALS.SEND_ETRANSFER_MODAL,t[this.stateConstants.EMT_RECLAIM_MODAL]=this.gmConstants.AVAILABLE_MODALS.EMT_RECLAIM,t[this.stateConstants.UNCATEGORIZED_TRANSACTIONS_MODAL]=this.gmConstants.AVAILABLE_MODALS.UNCATEGORIZED_TRANSACTIONS,t[this.stateConstants.UNCONFIRMED_TRANSACTIONS_MODAL]=this.gmConstants.AVAILABLE_MODALS.UNCONFIRMED_TRANSACTIONS,t[this.stateConstants.CREDIT_CARD_BALANCE_TRANSFER_MODAL]=this.gmConstants.AVAILABLE_MODALS.CREDIT_CARD_BALANCE_TRANSFER,t[this.stateConstants.CREDIT_LIMIT_CHANGE_MODAL]=this.gmConstants.AVAILABLE_MODALS.CREDIT_LIMIT_CHANGE,t[this.stateConstants.CREDIT_CARD_ACTIVATION_MODAL]=this.gmConstants.AVAILABLE_MODALS.ACTIVATE_CREDIT_CARD,t[this.stateConstants.DEBIT_CARD_ACTIVATION_MODAL]=this.gmConstants.AVAILABLE_MODALS.ACTIVATE_DEBIT_CARD,t[this.stateConstants.ASP_MODAL]=this.gmConstants.AVAILABLE_MODALS.ASP,t[this.stateConstants.ADD_BILL_MODAL]=this.gmConstants.AVAILABLE_MODALS.ADD_BILL,t[this.stateConstants.DIRECT_DEPOSIT_FORM_MODAL]=this.gmConstants.AVAILABLE_MODALS.DIRECT_DEPOSIT_FORM,t[this.stateConstants.E_NOTIFICATION_MODAL]=this.gmConstants.AVAILABLE_MODALS.E_NOTIFICATION,t[this.stateConstants.CSA_CONVERSION_MODAL]=this.gmConstants.AVAILABLE_MODALS.CSA_CONVERSION,t[this.stateConstants.REFER_FRIEND_MODAL]=this.gmConstants.AVAILABLE_MODALS.REFER_FRIEND,t[this.stateConstants.DONATIONS_MODAL]=this.gmConstants.AVAILABLE_MODALS.DONATIONS,t[this.stateConstants.HOLDS_MODAL]=this.gmConstants.AVAILABLE_MODALS.HOLDS,t[this.stateConstants.ORDER_CHEQUES_MODAL]=this.gmConstants.AVAILABLE_MODALS.ORDER_CHEQUES,t[this.stateConstants.REWARDS]=this.gmConstants.AVAILABLE_MODALS.REWARDS,t[this.stateConstants.PENDING_APPLICATIONS]=this.gmConstants.AVAILABLE_MODALS.PENDING_APPLICATIONS,t[this.stateConstants.OTHER_COMMUNICATIONS]=this.gmConstants.AVAILABLE_MODALS.OTHER_COMMUNICATIONS,t[this.stateConstants.OVERDRAFT_PROTECTION_APPLY]=this.gmConstants.AVAILABLE_MODALS.OVERDRAFT_PROTECTION_APPLY,t[this.stateConstants.OVERDRAFT_CONSENT_MODAL]=this.gmConstants.AVAILABLE_MODALS.OVERDRAFT_CONSENT_MODAL,t[this.stateConstants.RIF_SUMMARY_MODAL]=this.gmConstants.AVAILABLE_MODALS.RIF_SUMMARY_MODAL,t[this.stateConstants.SHOW_DOUBLE_SAFE_MODAL]=this.gmConstants.AVAILABLE_MODALS.SHOW_DOUBLE_SAFE_MODAL,t[this.stateConstants.ACTIVATE_OFFER_MODAL]=this.gmConstants.AVAILABLE_MODALS.ACTIVATE_OFFER_MODAL,t[this.stateConstants.BENEFICIARIES_MODAL]=this.gmConstants.AVAILABLE_MODALS.BENEFICIARIES_MODAL,t[this.stateConstants.GOAL_MODAL]=this.gmConstants.AVAILABLE_MODALS.GOALS,t[this.stateConstants.ACCOUNT_AGGREGATION_MODAL]=this.gmConstants.AVAILABLE_MODALS.ACCOUNT_AGGREGATION_MODAL,t[this.stateConstants.MAGIC_SWITCH_MODAL]=this.gmConstants.AVAILABLE_MODALS.MAGIC_SWITCH_MODAL,t[this.stateConstants.UPDATE_EMAIL_MODAL]=this.gmConstants.AVAILABLE_MODALS.UPDATE_EMAIL_MODAL,t[this.stateConstants.MORTGAGE_RENEWAL_MODAL]=this.gmConstants.AVAILABLE_MODALS.MORTGAGE_RENEWAL_MODAL,t[this.stateConstants.MAKE_INITIAL_DEPOSIT_MODAL]=this.gmConstants.AVAILABLE_MODALS.MAKE_INITIAL_DEPOSIT_MODAL,t[this.stateConstants.RDC]=this.gmConstants.AVAILABLE_MODALS.RDC,t[this.stateConstants.PEOPLE_LIKE_YOU]=this.gmConstants.AVAILABLE_MODALS.PEOPLE_LIKE_YOU,t[this.stateConstants.REACH_GOAL_SOONER]=this.gmConstants.AVAILABLE_MODALS.REACH_GOAL_SOONER,t[this.stateConstants.ACCOUNT_CONTRIBUTION_DETAILS_MODAL]=this.gmConstants.AVAILABLE_MODALS.ACCOUNT_CONTRIBUTION_DETAILS_MODAL,t[this.stateConstants.DEBIT_CARD_REPLACEMENT]=this.gmConstants.AVAILABLE_MODALS.DEBIT_CARD_REPLACEMENT,t[this.stateConstants.JOINT_INVITE_MANAGER]=this.gmConstants.AVAILABLE_MODALS.JOINT_INVITE_MANAGER,t[this.stateConstants.AML_CONFIRM_INFO_MODAL]=this.gmConstants.AVAILABLE_MODALS.AML_CONFIRM_INFO,t[this.stateConstants.KYC_ROADBLOCK_MODAL]=this.gmConstants.AVAILABLE_MODALS.KYC_ROADBLOCK_MODAL,t[this.stateConstants.CREDIT_CARD_CONVERSION_MODAL]=this.gmConstants.AVAILABLE_MODALS.CREDIT_CARD_CONVERSION,t[this.stateConstants.MANUAL_REVIEW_TLOC_APPLICATION_MODAL]=this.gmConstants.AVAILABLE_MODALS.MANUAL_REVIEW_TLOC_APPLICATION_MODAL,t}},{key:"_addDialogBodyClass",value:function(){document.querySelector("body").classList.add("global-dialog-open")}},{key:"_removeDialogBodyClass",value:function(){document.querySelector("body").classList.remove("global-dialog-open")}},{key:"showMoveMoney",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.MOVE_MONEY}},{key:"showAddBill",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.ADD_BILL}},{key:"showEMTModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.EMT}},{key:"showEtransferModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.SEND_ETRANSFER_MODAL}},{key:"showEMTReclaimModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.EMT_RECLAIM}},{key:"showAccountContributionDetailsModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.ACCOUNT_CONTRIBUTION_DETAILS_MODAL}},{key:"showMultipleBPModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.PAY_BILL}},{key:"showBillPayModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.PAY_BILL_V2}},{key:"showAddBillerModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.ADD_BILLER_V2}},{key:"showUncategorizedTransactions",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.UNCATEGORIZED_TRANSACTIONS}},{key:"showUnconfirmedTransactions",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.UNCONFIRMED_TRANSACTIONS}},{key:"showBalanceTransfer",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.CREDIT_CARD_BALANCE_TRANSFER}},{key:"showCreditLimitChange",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.CREDIT_LIMIT_CHANGE}},{key:"showCreditCardConversionModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.CREDIT_CARD_CONVERSION}},{key:"showOpenCommunicationsModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.OTHER_COMMUNICATIONS}},{key:"showCreditCardActivate",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.ACTIVATE_CREDIT_CARD}},{key:"showDebitCardActivate",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.ACTIVATE_DEBIT_CARD}},{key:"showRemoteChequeDeposit",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.RDC}},{key:"showDirectDepositFormModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.DIRECT_DEPOSIT_FORM}},{key:"showCSAConversionModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.CSA_CONVERSION}},{key:"showAspModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.ASP}},{key:"showENotificationModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.E_NOTIFICATION}},{key:"showAMLConfirmInfoModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.AML_CONFIRM_INFO}},{key:"showRewardsModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.REWARDS}},{key:"showGicMaturityOptionsModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.GIC_MATURITY_OPTIONS}},{key:"showReferFriend",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.REFER_FRIEND}},{key:"showDonations",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.DONATIONS}},{key:"showHolds",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.HOLDS}},{key:"showOrderCheques",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.ORDER_CHEQUES}},{key:"showPendingApplications",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.PENDING_APPLICATIONS}},{key:"showOtherCommunicationsModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.OTHER_COMMUNICATIONS}},{key:"showOverdraftChangeLimitModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.OVERDRAFT_CHANGE_LIMIT}},{key:"showOverdraftProtectionApplyInfoModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.OVERDRAFT_PROTECTION_APPLY}},{key:"showOverdraftConsentModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.OVERDRAFT_CONSENT_MODAL}},{key:"showBeneficiariesModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.BENEFICIARIES_MODAL}},{key:"showMagicSwitchModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.MAGIC_SWITCH_MODAL}},{key:"isApplyConsentWaiting",get:function(){return this.accountDetailsService.isActionAvailable(this.modalObj.accountDetails,this.accountConstants.AVAILABLE_ACTIONS.ACCEPT_OD_INVITATION)}},{key:"showRifSummaryModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.RIF_SUMMARY_MODAL}},{key:"isIncreaseConsentWaiting",get:function(){return this.accountDetailsService.isActionAvailable(this.modalObj.accountDetails,this.accountConstants.AVAILABLE_ACTIONS.ACCEPT_OD_INCREASE_INVITATION)}},{key:"showGoalsModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.GOALS}},{key:"showAccountAggregationModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.ACCOUNT_AGGREGATION}},{key:"showDoubleSafeModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.SHOW_DOUBLE_SAFE_MODAL}},{key:"showActivateOfferModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.ACTIVATE_OFFER_MODAL}},{key:"showUpdateEmailModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.UPDATE_EMAIL_MODAL}},{key:"showMortgageRenewalModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.MORTGAGE_RENEWAL_MODAL}},{key:"showMakeInitialDepositModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.MAKE_INITIAL_DEPOSIT_MODAL}},{key:"showPeopleLikeYouModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.PEOPLE_LIKE_YOU}},{key:"showReachGoalSoonerModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.REACH_GOAL_SOONER}},{key:"showDebitCardReplacementModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.DEBIT_CARD_REPLACEMENT}},{key:"showKYCRoadblockModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.KYC_ROADBLOCK_MODAL}},{key:"showJointInviteManager",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.JOINT_INVITE_MANAGER}},{key:"showManualReviewTlocApplicationModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.MANUAL_REVIEW_TLOC_APPLICATION_MODAL}},{key:"showTlocVerifyMethodModal",get:function(){return this.currentModal===this.gmConstants.AVAILABLE_MODALS.TLOC_APP_VERIFY_METHOD_MODAL}}]),t}();o.$inject=["$log","$scope","$state","moveMoneyConstants","GlobalModalsService","EventBusService","BackButtonService","globalModalsConstants","stateConstants","accountConstants","backButtonConstants","AccountDetailsService","StepUpService","stepUpConstants","BundleService"],e.default=o,t.exports=e.default},function(t,e){t.exports='<tng-move-money ng-if="$ctrl.showMoveMoney" on-close="$ctrl.closeModal(payload)" modal-type="$ctrl.modalType" pending-transaction="$ctrl.currentData.transaction" predefined-account="$ctrl.currentData.parentAccount"></tng-move-money> <tng-send-etransfer-dialog ng-if="$ctrl.showEtransferModal" on-close="$ctrl.closeModal(payload)"> </tng-send-etransfer-dialog> <send-emt-modal ng-if="$ctrl.showEMTModal" on-close="$ctrl.closeModal(payload)" settings-recipient="$ctrl.modalObj.params.recipient" go-to-step="$ctrl.modalObj.params.goToStep" transfer-contact-edit="$ctrl.modalObj.params.transferContactEdit" is-selecting-joint-contact="$ctrl.modalObj.params.isSelectingJointContact"> </send-emt-modal> <tng-reclaim-emt-transaction-modal ng-if="$ctrl.showEMTReclaimModal" additional-transaction-details="$ctrl.modalObj" on-close="$ctrl.closeModal()" selected-transaction="$ctrl.modalObj" on-save="$ctrl.closeModal()"> </tng-reclaim-emt-transaction-modal> <tng-account-contribution-detail-modal ng-if="$ctrl.showAccountContributionDetailsModal" account-id="$ctrl.modalObj.content.accountId" account-type="$ctrl.modalObj.accountType || $ctrl.modalObj.content.accountType" on-close="$ctrl.closeModal()"> </tng-account-contribution-detail-modal> <multiple-bill-pay-modal ng-if="$ctrl.showMultipleBPModal" on-close="$ctrl.closeModal()"> </multiple-bill-pay-modal> <tng-pay-bills-dialog ng-if="$ctrl.showBillPayModal" on-close="$ctrl.closeModal()"> </tng-pay-bills-dialog> <tng-add-biller-dialog ng-if="$ctrl.showAddBillerModal" on-close="$ctrl.closeModal()"> </tng-add-biller-dialog> <tng-uncategorized-transactions-modal ng-if="$ctrl.showUncategorizedTransactions" on-close="$ctrl.closeModal()"> </tng-uncategorized-transactions-modal> <tng-unconfirmed-transactions-modal ng-if="$ctrl.showUnconfirmedTransactions" on-close="$ctrl.closeModal()"> </tng-unconfirmed-transactions-modal> <tng-balance-transfer-dialog ng-if="$ctrl.showBalanceTransfer" account-hash="$ctrl.currentData.accountHash" account-details="$ctrl.currentData.accountDetails" on-close="$ctrl.closeModal()"></tng-balance-transfer-dialog> <tng-credit-card-change-limit-dialog ng-if="$ctrl.showCreditLimitChange" account-hash="$ctrl.currentData.accountHash" account-details="$ctrl.currentData.accountDetails" starting-state="$ctrl.currentData.startingState" combined="$ctrl.currentData.combined" campaign="$ctrl.currentData.campaign" on-close="$ctrl.closeModal()"></tng-credit-card-change-limit-dialog> <tng-credit-card-conversion-dialog ng-if="$ctrl.showCreditCardConversionModal" account-hash="$ctrl.currentData.accountHash" account-details="$ctrl.currentData.accountDetails" starting-state="$ctrl.currentData.startingState" combined="$ctrl.currentData.combined" campaign="$ctrl.currentData.campaign" on-close="$ctrl.closeModal()"></tng-credit-card-conversion-dialog> <tng-credit-card-activate-dialog ng-if="$ctrl.showCreditCardActivate" on-close="$ctrl.closeModal()" card-number="$ctrl.currentData.card"> </tng-credit-card-activate-dialog> <tng-bank-card-activate-dialog ng-if="$ctrl.showDebitCardActivate" on-close="$ctrl.closeModal()" activate-card="$ctrl.currentData.card"> </tng-bank-card-activate-dialog> <tng-remote-deposit-capture ng-if="$ctrl.showRemoteChequeDeposit" on-close="$ctrl.closeModal()"> </tng-remote-deposit-capture> <tng-asp ng-if="$ctrl.showAspModal" on-close="$ctrl.closeModal(result)"></tng-asp> <tng-direct-deposit-form ng-if="$ctrl.showDirectDepositFormModal" on-close="$ctrl.closeModal()"> </tng-direct-deposit-form> <tng-other-communications-modal ng-if="$ctrl.showOtherCommunicationsModal" on-close="$ctrl.closeModal()" user-data="$ctrl.userData" accounts="$ctrl.accounts" capabilities="$ctrl.capabilities" behaviors="$ctrl.behaviors" is-statement-flag="true"> </tng-other-communications-modal> <tng-people-like-you ng-if="$ctrl.showPeopleLikeYouModal" on-close="$ctrl.closeModal()"> </tng-people-like-you> <tng-reach-goal-sooner ng-if="$ctrl.showReachGoalSoonerModal" on-close="$ctrl.closeModal()"> </tng-reach-goal-sooner> <tng-csa-conversion ng-if="$ctrl.showCSAConversionModal" on-close="$ctrl.closeModal()" deal-id="$ctrl.currentData.dealId"> </tng-csa-conversion> <add-bill-pay-modal ng-if="$ctrl.showAddBill" on-close="$ctrl.closeModal()"> </add-bill-pay-modal> <tng-e-notification roadblock-type="$ctrl.roadblockType" roadblock-data="$ctrl.roadblockData" template-id="$ctrl.notificationTemplateId" notification-data="$ctrl.notificationData" high-risk-client="$ctrl.highRiskClient" aml-event-in-progress-flow="$ctrl.amlEventInProgressFlow" next-state="$ctrl.nextState" next-params="$ctrl.nextParams" on-close="$ctrl.closeModal()" ng-if="$ctrl.showENotificationModal"> </tng-e-notification> <tng-aml-confirm-info customer="$ctrl.customer" is-business="$ctrl.isBusiness" show-cancel-button="$ctrl.showCancelButton" event-type="$ctrl.eventType" is-employer-address-mandatory="$ctrl.isEmployerAddressMandatory" show-sin="$ctrl.showSin" ng-if="$ctrl.showAMLConfirmInfoModal" on-close="$ctrl.closeModal()"> </tng-aml-confirm-info> <tng-call-us></tng-call-us> <tng-call-you></tng-call-you> <tng-chat-with-us></tng-chat-with-us> <tng-pending-applications ng-if="$ctrl.showPendingApplications" on-close="$ctrl.closeModal()"> </tng-pending-applications> <tng-refer-friend-share-key ng-if="$ctrl.showReferFriend" on-close="$ctrl.closeModal()"> </tng-refer-friend-share-key> <tng-donation-modal ng-if="$ctrl.showDonations" on-close="$ctrl.closeModal()" donation-campaign="$ctrl.donationCampaign" flags="$ctrl.donationFlags"></tng-donation-modal> <tng-holds-modal ng-if="$ctrl.showHolds" on-close="$ctrl.closeModal()"></tng-holds-modal> <tng-order-cheques-modal ng-if="$ctrl.showOrderCheques" on-close="$ctrl.closeModal()" account-hash="$ctrl.currentData.accountHash"> </tng-order-cheques-modal> <tng-rewards-modal ng-if="$ctrl.showRewardsModal" current-step="$ctrl.currentStep" account-hash="$ctrl.modalObj.accountHash || $ctrl.currentData.accountHash" account="$ctrl.modalObj.account" rewards-preference="$ctrl.modalObj.rewardsPreference" reward="$ctrl.modalObj.reward" categories="$ctrl.modalObj.categories" account-details="$ctrl.modalObj.accountDetails" additional-info="$ctrl.modalObj.additionalInfo" on-change-rewards-categories="$ctrl.modalObj.onChangeRewardsCategories()" on-close="$ctrl.closeModal()"> </tng-rewards-modal> <tng-gic-options-modal ng-if="$ctrl.showGicMaturityOptionsModal" account-details="$ctrl.modalObj.accountDetails" account="$ctrl.modalObj.account" account-type="$ctrl.modalObj.accountType" resuming-model="$ctrl.modalObj.resumingModel" , resuming-state="$ctrl.modalObj.resumingState" on-close="$ctrl.closeModal()"> </tng-gic-options-modal> <tng-account-details-tab-confirm-modal ng-if="$ctrl.showOverdraftConsentModal" on-close="$ctrl.closeModal()" account-details="$ctrl.modalObj.accountDetails" is-apply-mode="$ctrl.isApplyConsentWaiting" is-increase-mode="$ctrl.isIncreaseConsentWaiting"></tng-account-details-tab-confirm-modal> <tng-holds-and-overdraft-apply-modal ng-if="$ctrl.showOverdraftProtectionApplyInfoModal" account-details="$ctrl.modalObj.accountDetails" on-close="$ctrl.closeModal()"> </tng-holds-and-overdraft-apply-modal> <tng-holds-and-overdraft-change-limit-modal ng-if="$ctrl.showOverdraftChangeLimitModal" on-close="$ctrl.closeModal()" account-details="$ctrl.modalObj.accountDetails"></tng-holds-and-overdraft-change-limit-modal> <tng-rif-payment-summary-modal ng-if="$ctrl.showRifSummaryModal" account-id="$ctrl.modalObj.accountNumber" on-close="$ctrl.closeModal()"> </tng-rif-payment-summary-modal> <tng-document-proof-instruction data="$ctrl.documentProofData" ng-if="$ctrl.showDocumentProofInstruction" on-close="$ctrl.closeDocumentProofInstructionModal()"> </tng-document-proof-instruction> <tng-document-proof-upload data="$ctrl.documentProofData" ng-if="$ctrl.showDocumentProofUpload" on-close="$ctrl.closeDocumentProofUploadModal()"> </tng-document-proof-upload> <tng-goals ng-if="$ctrl.showGoalsModal" transient-goal-data="$ctrl.modalObj.transientGoalData" on-close="$ctrl.closeModal()"> </tng-goals> <tng-account-aggregation ng-if="$ctrl.showAccountAggregationModal" basket="$ctrl.modalObj.aaBasket" add-other-bank="$ctrl.isOtherBank" caller="$ctrl.modalObj.caller" is-modal="true" on-close="$ctrl.closeModal()" card-tile-accounts="$ctrl.modalObj.cardTileAccounts"> </tng-account-aggregation> <tng-mobile-step-up ng-if="$ctrl.showMobileStepUp" on-close="$ctrl.closeStepUpModal()"> </tng-mobile-step-up> <tng-double-safe-confirm-modal ng-if="$ctrl.showDoubleSafeModal" on-close="$ctrl.closeModal()"> </tng-double-safe-confirm-modal> <tng-activate-offer activation-status="$ctrl.activationResponse" class="c-activate-offer" on-close="$ctrl.closeModal()" params="$ctrl.modalObj" ng-if="$ctrl.showActivateOfferModal"> </tng-activate-offer> <tng-beneficiaries-modal ng-if="$ctrl.showBeneficiariesModal" on-close="$ctrl.closeModal()" account-number="$ctrl.modalObj.accountNumber"></tng-beneficiaries-modal> <tng-magic-switch ng-if="$ctrl.showMagicSwitchModal" on-close="$ctrl.closeModal()" is-on-boarding="false" account-hash="$ctrl.currentData.accountHash"> </tng-magic-switch> <tng-update-email-modal ng-if="$ctrl.showUpdateEmailModal" on-close="$ctrl.closeModal()"> </tng-update-email-modal> <tng-mortgage-renewal-modal ng-if="$ctrl.showMortgageRenewalModal" on-close="$ctrl.closeModal()"> </tng-mortgage-renewal-modal> <tng-make-initial-deposit-modal account-hash="$ctrl.currentData.accountHash" ng-if="$ctrl.showMakeInitialDepositModal" on-close="$ctrl.closeModal()"> </tng-make-initial-deposit-modal> <tng-debit-card-replacement ng-if="$ctrl.showDebitCardReplacementModal" on-close="$ctrl.closeModal()"> </tng-debit-card-replacement> <tng-kyc-roadblock-modal ng-if="$ctrl.showKYCRoadblockModal" next-state="$ctrl.currentData.content.nextState" next-params="$ctrl.currentData.content.nextParams" mortgage-deal-id="$ctrl.currentData.content.mortgageDealId" on-close="$ctrl.closeModal()"> </tng-kyc-roadblock-modal> <tng-joint-invite-manager-modal ng-if="$ctrl.showJointInviteManager" is-application="$ctrl.modalObj.content.isApplication" deal-or-account-id="$ctrl.modalObj.content.dealOrAccountId" has-joint-declined="$ctrl.modalObj.content.hasJointDeclined" joint-contact="$ctrl.modalObj.content.jointContact" joint-contact-updated="$ctrl.modalObj.content.jointContactUpdated(newModel)" on-invite-sent-success="$ctrl.modalObj.content.onInviteSentSuccess()" on-close="$ctrl.closeModal()"></tng-joint-invite-manager-modal> <tng-manual-review-tloc-modal ng-if="$ctrl.showManualReviewTlocApplicationModal" application="$ctrl.modalObj.application" on-close="$ctrl.closeModal()"> </tng-manual-review-tloc-modal> <tloc-app-verify-method-modal ng-if="$ctrl.showTlocVerifyMethodModal" instruction="$ctrl.modalObj.instruction" on-close="$ctrl.closeModal()"> </tloc-app-verify-method-modal> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(4911));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(4912)).default,controller:i.default,bindings:{account:"<",maxLen:"@",productChangeDetails:"<",transactionDate:"<"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.AccountHelpersService=e,this.accountName="",this.dateService=n,this.$filter=a,this.accountConstants=s,this.AccountDetailsService=r}return(0,a.default)(t,[{key:"$onChanges",value:function(){var t=this;if(this.productChangeDetails&&this.account.type===this.accountConstants.ACCOUNT_TYPES.CREDIT_CARD){var e=this.$filter("date")(this.transactionDate,"yyyy-MM-dd");this.getDescriptionForConversions(e),this.accountName=this.AccountHelpersService.sanitizeAccountDescription(this.description),this.maxLen&&this.accountName.length>this.maxLen&&(this.accountName=this.AccountHelpersService.getCardDescriptionEqualToLength(this.accountName,this.maxLen))}else this.account&&this.AccountHelpersService.getDisplayName(this.account).then((function(e){t.maxLen&&e.length>t.maxLen?t.accountName=t.AccountHelpersService.getCardDescriptionEqualToLength(e,t.maxLen):t.accountName=e}))}},{key:"getDescriptionForConversions",value:function(t){for(var e=0;e<this.productChangeDetails.length;e++)if(this.dateService.isDateBefore(t,this.productChangeDetails[e].product_change_date)&&!this.dateService.isDateSameOrAfter(t,this.productChangeDetails[e].product_change_date)){this.description=this.AccountDetailsService.getCCAccountNameByProductType(this.accountConstants.CREDIT_CARD_PRODUCT_TYPES_CODE[this.productChangeDetails[e].client_product_change.from]);break}void 0===this.description&&(this.description=this.AccountDetailsService.getCCAccountNameByProductType(this.accountConstants.CREDIT_CARD_PRODUCT_TYPES_CODE[this.productChangeDetails[this.productChangeDetails.length-1].client_product_change.to]))}}]),t}();r.$inject=["AccountHelpersService","DateService","$filter","accountConstants","AccountDetailsService"],e.default=r,t.exports=e.default},function(t,e){t.exports='<span ng-bind-html="$ctrl.accountName "></span> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4914)),a=s(n(4915));function s(t){return t&&t.__esModule?t:{default:t}}n(4916);var r={template:i.default,controller:a.default,transclude:!0,bindings:{documentName:"<?",buttonClass:"@",ngDisabled:"=?",onlyElement:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<button ng-if="$ctrl.isWeb" ng-class="$ctrl.buttonClass ? $ctrl.buttonClass : \'btn btn--orange\'" class="" ng-click="$ctrl.print()" ng-disabled="$ctrl.ngDisabled" actionable-id="printButton" ng-transclude> {{::\'global.print\' | translate}} </button> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.$window=e,this.isWeb=!n.isNative(),this.EnvironmentService=n,this.$timeout=a}return(0,a.default)(t,[{key:"print",value:function(){var t=this;this.onlyElement?this.$timeout((function(){t._printSpecificContent()}),250):this.$timeout((function(){t.$window.print()}),250)}},{key:"_printSpecificContent",value:function(){var t=document.getElementById(this.onlyElement).innerHTML,e=void 0,n=angular.element(document.querySelector("head")).clone();n.querySelectorAll("script").remove(),this.documentName&&n.querySelectorAll("title").text(this.documentName);var i=n.html();this.EnvironmentService.isChromium()?((e=this.$window.open("","_blank","width=700,height=700,scrollbars=yes,menubar=no,toolbar=no,location=no,status=no,titlebar=no")).window.focus(),e.document.write("<!DOCTYPE html><html><head>\n        "+i+'\n        </head><body onload="window.print()">\n        <div class="reward-body">\n        '+t+"\n        </div></html>"),e.onbeforeunload=function(){return e.close(),".\n"},e.onabort=function(){e.document.close(),e.close()},e.document.close()):this.EnvironmentService.isIE()&&11===this.EnvironmentService.getPlatformVersionNumber()?((e=this.$window.open("","_blank","width=700,height=700,scrollbars=yes")).document.open(),e.document.write('<html><head>\n        </head><body onload="window.print()">\n        '+t+"\n        </html>"),e.document.close()):((e=this.$window.open("","_blank","width=700,height=700,scrollbars=yes")).document.open(),e.document.write("<html><head>\n        "+i+'\n        </head><body onload="window.print()">\n        '+t+"\n        </html>"),e.document.close())}}]),t}();r.$inject=["$window","EnvironmentService","$timeout"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4918)),a=s(n(4919));function s(t){return t&&t.__esModule?t:{default:t}}n(4920);var r={controller:i.default,template:a.default,bindings:{transaction:"<",isDynamic:"<",type:"<"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(8)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,s,r,o,c,l){(0,a.default)(this,t),(0,i.default)(this,{categoryConstants:e,transactionConstants:n,EventBusService:s,ID_TO_CATEGORY:e.ID_TO_CATEGORY,$translate:r,$element:o,$scope:c,$timeout:l})}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;this.AVERAGE_LETTER_WIDTH=this.calculateAverageLetterWidth(),this.recalculateLayout(),this.shouldDisplayPlainCategoryName()||this.EventBusService.subscribe(this.$scope,this.transactionConstants.TRANSACTION_LIST_EVENTS.RELAYOUT,(function(){return t.recalculateLayout()}))}},{key:"calculateAverageLetterWidth",value:function(){return this.type===this.categoryConstants.FOLDABLE_CATEGORY_LIST_STYLES.LARGE?this.transactionFieldWidth>1024?7.5:6.3:this.transactionFieldWidth>1024?6:5}},{key:"shouldDisplayPlainCategoryName",value:function(){return!this.transaction.categoriesFromSplit||1===this.transaction.categoriesFromSplit.length}},{key:"isSingleCategoryOnly",value:function(){return!this.transaction.categoriesFromSplit||0===this.transaction.categoriesFromSplit.length||1===this.transaction.categoriesFromSplit.length}},{key:"recalculateLayout",value:function(){var t=this;this.$timeout((function(){t.transactionFieldWidth=t.$element[0].parentNode.getBoundingClientRect().width,t.numberOfVisibleCategories=t.calculateNumberOfVisibleCategories(t.transaction)}),0)}},{key:"calculateNumberOfVisibleCategories",value:function(){if(this.shouldDisplayPlainCategoryName())return 1;for(var t=0,e=0;t<=this.transactionFieldWidth&&e<this.transaction.categoriesFromSplit.length;)t+=this.AVERAGE_LETTER_WIDTH*this.$translate.instant("global.transactionsCategories."+this.ID_TO_CATEGORY[this.transaction.categoriesFromSplit[e]]).length,e+=1;return e}}]),t}();o.$inject=["categoryConstants","transactionConstants","EventBusService","$translate","$element","$scope","$timeout"],e.default=o,t.exports=e.default},function(t,e){t.exports='<div ng-if="(!!$ctrl.transaction.category_id || !!$ctrl.transaction.category_id || !!$category.categoriesFromSplit)" class="{{:: (\'c-foldable-category-list \' + ($ctrl.type === \'LARGE\' ? \'c-foldable-category-list--LARGE\' : \'\') )}}"> <span class="c-foldable-category-list__subtitle" ng-if="::$ctrl.isSingleCategoryOnly() && !($ctrl.type === $ctrl.transactionConstants.TRANSACTION_VIEWS.REWARDS)"> {{::$ctrl.ID_TO_CATEGORY[$ctrl.transaction.category_id || $ctrl.transaction.categoriesFromSplit[0]] ? (\'global.transactionsCategories.\' + $ctrl.ID_TO_CATEGORY[$ctrl.transaction.category_id].key | translate) : (\'global.transactionsCategories.uncategorized\' | translate )}} </span> <span class="c-foldable-category-list__subtitle" ng-if="$ctrl.type === $ctrl.transactionConstants.TRANSACTION_VIEWS.REWARDS"> {{$ctrl.transaction.category_id ? (\'accountDetails.creditCard.rewardsTabModal.CATEGORIES.\' + $ctrl.categoryConstants.MENIGA_TO_TSYS_CATEGORIES_MAP[$ctrl.transaction.category_id] | translate) : \'\'}} </span> <span class="c-foldable-category-list__subtitle" ng-if="::($ctrl.isDynamic)" ng-show="$ctrl.isSingleCategoryOnly()"> {{::$ctrl.ID_TO_CATEGORY[$ctrl.transaction.category_id || $ctrl.transaction.categoriesFromSplit[0]] ? (\'global.transactionsCategories.\' + $ctrl.ID_TO_CATEGORY[$ctrl.transaction.category_id].key | translate) : (\'global.transactionsCategories.uncategorized\' | translate )}} </span> <div class="c-foldable-category-list__subtitle" ng-if="::($ctrl.transaction.categoriesFromSplit)"> <div class="c-foldable-category-list__foldable-categories" ng-if="!$ctrl.shouldDisplayPlainCategoryName()"> <div class="c-foldable-category-list__category-split-list-items-wrapper" ng-class="{\'c-foldable-category-list__category-split-list-items-wrapper--more-button-not-displayed\': !($ctrl.transaction.categoriesFromSplit.length > $ctrl.numberOfVisibleCategories)}"> <span class="c-foldable-category-list__category-split-list-items"> <span ng-repeat="cId in $ctrl.transaction.categoriesFromSplit track by $index" ng-if="$index < $ctrl.numberOfVisibleCategories" class="c-foldable-category-list__category-split-list-item"> {{::$ctrl.ID_TO_CATEGORY[cId] ? (\'global.transactionsCategories.\' + $ctrl.ID_TO_CATEGORY[cId].key | translate) : \'\'}}</span> </span> </div> <span ng-click="$event.stopPropagation();" class="c-foldable-category-list__category-split-list-item-more" ng-if="$ctrl.transaction.categoriesFromSplit.length > $ctrl.numberOfVisibleCategories"> {{$ctrl.transaction.categoriesFromSplit.length - $ctrl.numberOfVisibleCategories + \' \' + (\'transactions.more\' | translate ) }} <tng-help-bubble class="c-foldable-category-list__extra-categories-bubble"> <ul class="c-edit-transaction-modal__extra-categories-item"> <li ng-repeat="cId in $ctrl.transaction.categoriesFromSplit track by $index" ng-if="$index > $ctrl.numberOfVisibleCategories - 1"> {{::cId ? (\'global.transactionsCategories.\' + $ctrl.ID_TO_CATEGORY[cId].key | translate) : (\'global.transactionsCategories.uncategorized\' | translate ) }} </li> </ul> </tng-help-bubble> </span> </div> </div> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4922)),a=s(n(4923));function s(t){return t&&t.__esModule?t:{default:t}}n(4924);var r={template:i.default,controller:a.default,bindings:{onCategorySelect:"&",selectedCategories:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-browse-categories-widget__browse-categories"> <h3>{{ ::\'transactions.editTransactionModal.browseCategories\' | translate }}</h3> <div class="c-browse-categories-widget__filters"> <div class="c-browse-categories-widget__input-filter field"> <input type="text" name="categoryFilter" class="input" actionable-id="browseCategoriesWidget_categoryFilter" ng-model-options="{debounce: 250}" ng-model="$ctrl.searchCategoryName" placeholder="{{:: \'transactions.editTransactionModal.search\' | translate }}"> </div> <div class="c-browse-categories-widget__select-filter field"> <tng-select-autocomplete input-id="categoryList_categoryType" ng-model="$ctrl.parentCategoryIdSelect" options="$ctrl.topLevelCategories" option-label-key="label" option-value-key="id" is-static="true" placeholder="{{ ::\'transactions.editTransactionModal.allCategories\' | translate }}"></tng-select-autocomplete> </div> </div> <div class="c-browse-categories-widget__category-tiles"> <a actionable-id="browser-categories-widget-link_{{$index}}" href="" ng-repeat="c in $ctrl.categoriesArray | filter: {name: $ctrl.searchCategoryName, parentCategoryId: $ctrl.parentCategoryIdSelect}" ng-click="$ctrl.onCategorySelect({c: c})" ng-class="\'c-browse-categories-widget__category-tile\' + ($ctrl.isCategorySelected(c) ? \'--selected\' : \'\')"> <i class="c-browse-categories-widget__category-tile-icon {{::c.icon}}"></i> <h5 title="{{:: global.transactionsCategories.name }}" class="c-browse-categories-widget__category-tile-name"> {{:: c.name }} </h5> </a> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(8)),a=o(n(15)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n){(0,s.default)(this,t),this.$translate=e,this.categoryConstants=n,this.ID_TO_CATEGORY=n.ID_TO_CATEGORY,this.TOP_LEVEL_ID_TO_CATEGORY=n.TOP_LEVEL_ID_TO_CATEGORY,this.LOW_LEVEL_ID_TO_CATEGORY=n.LOW_LEVEL_ID_TO_CATEGORY}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;this.topLevelCategories=(0,a.default)(this.categoryConstants.TOP_LEVEL_ID_TO_CATEGORY).filter((function(e){return+e!==t.categoryConstants.UNCATEGORIZED_CATEGORY_ID})).map((function(e){var n=t.categoryConstants.TOP_LEVEL_ID_TO_CATEGORY[e];return n.label=t.$translate.instant("global.transactionsCategories."+n.key),n})),this.categoriesArray=(0,a.default)(this.ID_TO_CATEGORY).filter((function(e){return+e!==t.categoryConstants.UNCATEGORIZED_CATEGORY_ID})).map((function(e){return(0,i.default)({},t.ID_TO_CATEGORY[e],{parentCategoryId:t.ID_TO_CATEGORY[e].parentCategoryId||e,name:t.$translate.instant("global.transactionsCategories."+t.ID_TO_CATEGORY[e].key)})}))}},{key:"isCategorySelected",value:function(t){return Array.isArray(this.selectedCategories)&&!!this.selectedCategories.find((function(e){return e.id===t.id}))}}]),t}();c.$inject=["$translate","categoryConstants"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4926),s=(i=a)&&i.__esModule?i:{default:i};n(4927);var r={template:s.default,controller:function(){},bindings:{name:"<",additionalData:"@"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<section class="c-printheader"> <div class="c-printheader__brand"> <img ng-src="assets/images/tangerine-logo-orange.svg" alt="Tangerine" class="print-only-inline"/> </div> <div class="c-printheader__info"> <p class="c-printheader__info-name"><strong>{{$ctrl.name}}</strong></p> <p class="c-printheader__info-additionaldata">{{$ctrl.additionalData}}</p> </div> </section> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4929)),a=s(n(4930));function s(t){return t&&t.__esModule?t:{default:t}}n(4931);var r={template:a.default,controller:i.default,bindings:{accounts:"<",onSelect:"&",subTitleKey:"@",subTitleParam:"@?",isDisabled:"&",isNotVisible:"&?",selectedAccounts:"<?",hideFooterCopy:"<?",onAway:"&?",showContact:"@?",shortTile:"<?",hideArrow:"<?"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c){(0,i.default)(this,t),this.$log=e,this.TILE_TYPE=n.TILE_TYPE,this.stateConstants=a,this.ACTION_CODES=s.ACTION_CODES,this.$state=r,this.cifTypeService=o,this.EventBusService=c}return(0,a.default)(t,[{key:"$onInit",value:function(){this.isUserChild=this.cifTypeService.isChild(),this.$log.info("AccountSelectController bound selected items",this.selectedAccounts),this.externalAccountsText=[{header:"moveMoney.externalAccountLinkHeader",subHeader:"moveMoney.externalAccountLinkSubHeader"}]}},{key:"onAccountSelect",value:function(t,e,n){this.onSelect({account:n})}},{key:"isTileDisabled",value:function(t,e){return this.isDisabled({index:t,tile:e})}},{key:"isTileNotVisible",value:function(t,e){return!!this.isNotVisible&&this.isNotVisible({index:t,tile:e})}},{key:"goToExternalAccounts",value:function(){var t=this;this.EventBusService.publish(this.ACTION_CODES.EXTERNAL_ACCOUNTS),this.onAway?this.onAway().then((function(){t.$state.go(t.stateConstants.USER_SETTINGS_EXTERNAL_ACCOUNTS)})).catch((function(e){t.$log.error("Error navigating to external accounts: "+e)})):this.$state.go(this.stateConstants.USER_SETTINGS_EXTERNAL_ACCOUNTS)}}]),t}();r.$inject=["$log","tngTileListConstants","stateConstants","moveMoneyConstants","$state","CifTypeService","EventBusService"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-account-select"> <p ng-if="$ctrl.subTitleKey" ng-bind-html="$ctrl.subTitleKey | translate : {param: $ctrl.subTitleParam}"></p> <tng-tile-list class="c-account-select__tile-list" tile-data="$ctrl.accounts" tile-type="$ctrl.TILE_TYPE.account" all-actionable="true" is-disabled="$ctrl.isTileDisabled(index, tileData)" is-hidden="$ctrl.isTileNotVisible(index, tileData)" single-select="true" on-tile-click="$ctrl.onAccountSelect(index, tileData, selectedTiles)" selected-tiles="$ctrl.selectedAccounts" short-tile="$ctrl.shortTile" hide-arrow="$ctrl.hideArrow"> </tng-tile-list> <p ng-if="$ctrl.hideFooterCopy && !$ctrl.isUserChild" class="c-account-select__space-below"></p> <div ng-if="!$ctrl.hideFooterCopy && !$ctrl.isUserChild" class="c-account-select__small-copy"> <p class="subTitle" ng-if="$ctrl.subTitleKey == \'moveMoney.topCopy.chooseWithdrawalFrom\'">{{ ::\'moveMoney.externalAccountLinkDescriptionFrom\' | translate }}</p> <p class="subTitle" ng-if="$ctrl.subTitleKey == \'moveMoney.topCopy.chooseTo\'">{{ ::\'moveMoney.externalAccountLinkDescriptionTo\' | translate }}</p> <p class="subTitle" ng-if="$ctrl.subTitleKey !== \'moveMoney.topCopy.chooseTo\' && $ctrl.subTitleKey !== \'moveMoney.topCopy.chooseWithdrawalFrom\'">{{ ::\'moveMoney.externalAccountLinkDescription\' | translate }}</p> <tng-tile-list class="c-account-select__tile-list" tile-data="$ctrl.externalAccountsText" tile-type="$ctrl.TILE_TYPE.text" all-actionable="true" single-select="true" on-tile-click="$ctrl.goToExternalAccounts()"> </tng-tile-list> </div> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4933)),a=s(n(4934));function s(t){return t&&t.__esModule?t:{default:t}}n(4935);var r={template:i.default,controller:a.default,bindings:{onClose:"&",userData:"<?",accounts:"<?",capabilities:"<?",behaviors:"<?",isStatementFlag:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose(result)" class="c-basic-info__modal" analytics-id="other-communication" hide-close="$ctrl.editModalFlowService.currentState === $ctrl.editModalFlowService.STATES.LOADING" flow-service="$ctrl.editModalFlowService"> <header> <span id="otherCommunication-editModal-title" ng-if="$ctrl.editModalFlowService.showMainUI" translate-cloak> {{ $ctrl.dialogTitle }} </span> </header> <div ng-show="!$ctrl.editModalFlowService.showConfirmExitUI &&\n    $ctrl.editModalFlowService.currentState\n    === $ctrl.editModalFlowService.STATES.LOADING"> <tng-settings-edit-modal-loading> </tng-settings-edit-modal-loading> </div> <div ng-if="$ctrl.editModalFlowService.showMainUI" class="c-other-communication__edit"> <div class="c-other-communication__edit__section" ng-if="$ctrl.language.allowDisplay"> <h5 id="otherCommunication-editModal-language-label" class="heading--sub3" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.language.label\' | translate }}</h5> <p translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.language.description\' | translate }}</p> <div class="field__group--inline"> <div class="field"> <input actionable-id="language_english" ng-model="$ctrl.selected[$ctrl.communicationConstants.USER_DATA.LANGUAGE.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{ $ctrl.communicationConstants.LANGUAGES.ENGLISH.KEY }}" name="language" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-language-english" for="language_english" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.language.english\' | translate }}</label> </div> <div class="field"> <input actionable-id="language_french" ng-model="$ctrl.selected[$ctrl.communicationConstants.USER_DATA.LANGUAGE.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{ $ctrl.communicationConstants.LANGUAGES.FRENCH.KEY }}" name="language" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-language-french" for="language_french" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.language.french\' | translate }}</label> </div> </div> </div> <div class="c-other-communication__edit__section" ng-if="$ctrl.edocument.allowDisplay"> <h5 id="otherCommunication-editModal-eDocuments-label" class="heading--sub3" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.eDocuments.label\' | translate }}</h5> <p ng-bind-html="\'userSettings.general.otherCommunication.editModal.eDocuments.description1Paragraph\' | translate:{ url: $ctrl.eDocumentUrl} | absoluteHref"></p> <p translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.eDocuments.description2Paragraph\' | translate}}</p> <p id="otherCommunication-editModal-eDocument-description3Paragraph" translate-cloak ng-bind-html="\'userSettings.general.otherCommunication.editModal.eDocuments.description3Paragraph\' | translate | absoluteHref"></p> <div class="field__group--inline"> <div class="field CB_ReadOnly"> <input actionable-id="eDocuments_yes" ng-disabled="$ctrl.edocument.disableSelect" ng-model="$ctrl.selected[$ctrl.communicationConstants.USER_DATA.EDOCUMENT.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{ $ctrl.communicationConstants.STATES.YES.KEY }}" name="eDocuments" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-eDocument-yes" for="eDocuments_yes" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.eDocuments.yes\' | translate }}</label> </div> <div class="field"> <input actionable-id="eDocuments_no" ng-disabled="$ctrl.edocument.disableSelect" ng-model="$ctrl.selected[$ctrl.communicationConstants.USER_DATA.EDOCUMENT.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{ $ctrl.communicationConstants.STATES.NO.KEY }}" name="eDocuments" class="input input--pill" type="radio"/> <label id="otherCommunication-editModal-eDocument-no" for="eDocuments_no" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.eDocuments.no\' | translate}}</label> </div> </div> </div> <div class="c-other-communication__edit__section" ng-if="$ctrl.statement.allowDisplay"> <h5 id="otherCommunication-editModal-statement-label" class="heading--sub3" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.statement.label\' | translate }}</h5> <p translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.statement.descriptionUp\' | translate}}</p> <div data-ng-if="$ctrl.selected.savings[$ctrl.communicationConstants.USER_DATA.STATEMENT.KEY] && $ctrl.statement.savings.allowSelect"> <h6 class="body--3" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.types.savingAccounts\' | translate}}</h6> <div class="field__group--inline"> <div class="field"> <input actionable-id="statement_paper" ng-model="$ctrl.selected.savings[$ctrl.communicationConstants.USER_DATA.STATEMENT.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{$ctrl.communicationConstants.OPTIONS.PAPER}}" name="statement" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-statement-statement_paper" for="statement_paper" id="label_statement_paper" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.statement.paper\' | translate }}</label> </div> <div class="field"> <input actionable-id="statement_electronic" ng-model="$ctrl.selected.savings[$ctrl.communicationConstants.USER_DATA.STATEMENT.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{$ctrl.communicationConstants.OPTIONS.ELECTRONIC}}" name="statement" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-statement-statement_electronic" for="statement_electronic" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.statement.electronic\' | translate }}</label> </div> </div> </div> <div ng-if="$ctrl.selected.savings[$ctrl.communicationConstants.USER_DATA.STATEMENT.KEY] === \'PAPER\' && $ctrl.statement.savings.allowSelect" class="c-other-communication__paper-statement"> <div class="c-other-communication__first-row"> <div class="c-other-communication__step-title"> <tng-category-icon icon="icon-trust-fund" size="32" class="c-other-communication__category-icon"> </tng-category-icon> </div> <p ng-if="$ctrl.wihtoutAccount === false" ng-bind-html="::\'userSettings.general.otherCommunication.editModal.statement.paperOptions.descAccounts\' | translate "></p> <p ng-if="$ctrl.wihtoutAccount === true" ng-bind-html="::\'userSettings.general.otherCommunication.editModal.statement.paperOptions.descNoAccounts\' | translate "></p> </div> <div ng-if="$ctrl.wihtoutAccount === false"> <h6 class="c-other-communication__drop-title">{{ \'userSettings.general.otherCommunication.editModal.statement.paperOptions.title\' | translate }}</h6> <div class="c-other-communication__paper-drop-down"> <tng-select-autocomplete ng-model="$ctrl.selected.savings.selected_account" options="$ctrl.FROM_ACCOUNTS" option-label-key="label" option-right-label-key="amount" option-value-key="number" placeholder="{{ \'userSettings.general.otherCommunication.editModal.statement.paperOptions.select\' | translate }}" is-static="true" on-select="$ctrl.onPreferenceChange()" enable-for-mobile="true"></tng-select-autocomplete> </div> <p class="c-other-communication__warning-message" ng-if="$ctrl.accountValidation">{{ \'userSettings.general.otherCommunication.editModal.statement.paperOptions.errorMessage1\' | translate }}</p> </div> </div> <div data-ng-if="$ctrl.selected.mutual_funds[$ctrl.communicationConstants.USER_DATA.STATEMENT.KEY] && $ctrl.statement.mutual_funds.allowSelect"> <h6 class="body--3" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.types.investmentFunds\' | translate}}</h6> <div class="field__group--inline"> <div class="field"> <input actionable-id="statement_paper_mf" ng-model="$ctrl.selected.mutual_funds[$ctrl.communicationConstants.USER_DATA.STATEMENT.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{$ctrl.communicationConstants.OPTIONS.PAPER}}" name="statement_mf" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-statement-statement_paper_mf" for="statement_paper_mf" id="label_statement_paper_mf" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.statement.paper\' | translate }}</label> </div> <div class="field"> <input actionable-id="statement_electronic_mf" ng-model="$ctrl.selected.mutual_funds[$ctrl.communicationConstants.USER_DATA.STATEMENT.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{$ctrl.communicationConstants.OPTIONS.ELECTRONIC}}" name="statement_mf" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-statement-statement_electronic_mf" for="statement_electronic_mf" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.statement.electronic\' | translate }}</label> </div> </div> </div> <div data-ng-if="$ctrl.selected.credit_card[$ctrl.communicationConstants.USER_DATA.STATEMENT.KEY] && $ctrl.statement.credit_card.allowSelect"> <h6 class="body--3" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.types.creditCard\' | translate}}</h6> <div class="field__group--inline"> <div class="field"> <input actionable-id="statement_paper_cc" ng-model="$ctrl.selected.credit_card[$ctrl.communicationConstants.USER_DATA.STATEMENT.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{$ctrl.communicationConstants.OPTIONS.PAPER}}" name="statement_cc" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-statement-statement_paper_cc" for="statement_paper_cc" id="label_statement_paper_cc" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.statement.paper\' | translate }}</label> </div> <div class="field"> <input actionable-id="statement_electronic_cc" ng-model="$ctrl.selected.credit_card[$ctrl.communicationConstants.USER_DATA.STATEMENT.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{$ctrl.communicationConstants.OPTIONS.ELECTRONIC}}" name="statement_cc" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-statement-statement_electronic_cc" for="statement_electronic_cc" id="label_statement_electronic_cc" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.statement.electronic\' | translate }}</label> </div> </div> </div> <p><span ng-bind-html="\'userSettings.general.otherCommunication.editModal.statement.descriptionDown1\' | translate"></span> <span class="orangeAlertsRedirect" ng-click="$ctrl.gotoOrangeAlertPage()">{{ \'userSettings.general.otherCommunication.editModal.statement.orangeAlerts\' | translate}}</span> <span>{{ \'userSettings.general.otherCommunication.editModal.statement.descriptionDown2\' | translate}}</span> </p> </div> <div class="c-other-communication__edit__section" ng-if="!$ctrl.isBusinessClient && $ctrl.taxReceipt.allowDisplay"> <h5 ng-if="$ctrl.taxReceipt.displayHeader" id="otherCommunication-editModal-taxReceipt-label" class="heading--sub3" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.taxReceipt.label\' | translate }}</h5> <div data-ng-if="$ctrl.selected.savings[$ctrl.communicationConstants.USER_DATA.TAX_RECEIPT.KEY]"> <h6 class="heading--sub3 subheader" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.types.savingAndChequingAccounts\' | translate}}</h6> <p class="text-margin" ng-bind-html="\'userSettings.general.otherCommunication.editModal.taxReceipt.descriptionDeposit\' | translate"></p> <div class="field__group--inline"> <div class="field"> <input actionable-id="taxReceipt_paper" ng-disabled="!$ctrl.taxReceipt.savings.allowSelect" ng-model="$ctrl.selected.savings[$ctrl.communicationConstants.USER_DATA.TAX_RECEIPT.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{$ctrl.communicationConstants.OPTIONS.PAPER}}" name="taxReceipt" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-taxReceipt-taxReceipt_paper" for="taxReceipt_paper" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.taxReceipt.paper\' | translate }}</label> </div> <div class="field"> <input actionable-id="taxReceipt_electronic" ng-disabled="!$ctrl.taxReceipt.savings.allowSelect" ng-model="$ctrl.selected.savings[$ctrl.communicationConstants.USER_DATA.TAX_RECEIPT.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{$ctrl.communicationConstants.OPTIONS.ELECTRONIC}}" name="taxReceipt" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-taxReceipt-taxReceipt_electronic" for="taxReceipt_electronic" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.taxReceipt.electronic\' | translate }}</label> </div> </div> </div> <div data-ng-if="$ctrl.selected.mutual_funds[$ctrl.communicationConstants.USER_DATA.TAX_RECEIPT.KEY] && $ctrl.taxReceipt.mutual_funds.allowSelect"> <h6 class="heading--sub3 text-margin" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.types.investmentFunds\' | translate}}</h6> <p class="text-margin" ng-bind-html="\'userSettings.general.otherCommunication.editModal.taxReceipt.descriptionInvestment\' | translate"></p> <div class="field__group--inline"> <div class="field"> <input actionable-id="taxReceipt_paper_mf" ng-model="$ctrl.selected.mutual_funds[$ctrl.communicationConstants.USER_DATA.TAX_RECEIPT.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{$ctrl.communicationConstants.OPTIONS.PAPER}}" name="taxReceipt_mf" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-taxReceipt-taxReceipt_paper_mf" for="taxReceipt_paper_mf" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.taxReceipt.paper\' | translate }}</label> </div> <div class="field"> <input actionable-id="taxReceipt_electronic_mf" ng-model="$ctrl.selected.mutual_funds[$ctrl.communicationConstants.USER_DATA.TAX_RECEIPT.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{$ctrl.communicationConstants.OPTIONS.ELECTRONIC}}" name="taxReceipt_mf" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-taxReceipt-taxReceipt_electronic_mf" for="taxReceipt_electronic_mf" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.taxReceipt.electronic\' | translate }}</label> </div> </div> <p class="note text-margin" ng-bind-html="\'userSettings.general.otherCommunication.editModal.taxReceipt.descriptionDown\' | translate:{ url: $ctrl.orangeAlertsUrl }"></p> </div> </div> <div class="c-other-communication__edit__section" ng-if="$ctrl.trade.allowDisplay && $ctrl.selected.mutual_funds[$ctrl.communicationConstants.USER_DATA.TRADE_CONFIRMATION.KEY] && $ctrl.trade.mutual_funds.allowSelect"> <h5 id="otherCommunication-editModal-trade-label" class="heading--sub3" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.trade.label\' | translate }}</h5> <p translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.trade.description1Paragraph\' | translate }}</p> <p translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.trade.description2Paragraph\' | translate }}</p> <p translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.trade.description3Paragraph\' | translate }}</p> <h6 class="body--3" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.types.investmentFunds\' | translate }}</h6> <div class="field__group--inline"> <div class="field"> <input actionable-id="trade_paper_mf" ng-model="$ctrl.selected.mutual_funds[$ctrl.communicationConstants.USER_DATA.TRADE_CONFIRMATION.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{ $ctrl.communicationConstants.OPTIONS.PAPER }}" name="trade_mf" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-trade-trade_paper_mf" for="trade_paper_mf" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.trade.paper\' | translate }}</label> </div> <div class="field"> <input actionable-id="trade_electronic_mf" ng-model="$ctrl.selected.mutual_funds[$ctrl.communicationConstants.USER_DATA.TRADE_CONFIRMATION.KEY]" ng-change="$ctrl.onPreferenceChange()" value="{{ $ctrl.communicationConstants.OPTIONS.ELECTRONIC }}" name="trade_mf" class="input input--pill" type="radio"> <label id="otherCommunication-editModal-trade-trade_electronic_mf" for="trade_electronic_mf" translate-cloak>{{ \'userSettings.general.otherCommunication.editModal.trade.electronic\' | translate }}</label> </div> </div> </div> </div> <div ng-show="!$ctrl.editModalFlowService.showConfirmExitUI &&\n    $ctrl.editModalFlowService.currentState\n    === $ctrl.editModalFlowService.STATES.DONE"> <tng-settings-edit-modal-done errors="$ctrl.requestMonitor.errors"> </tng-settings-edit-modal-done> </div> <footer> <div class="footer-agreement m-send-emt__footer-agreement m-send-emt__ignore-modal-footer-padding" ng-if="!$ctrl.agreementConfirmationFromServer && $ctrl.showAgreement()" ng-hide="$ctrl.editModalFlowService.currentState === $ctrl.editModalFlowService.STATES.LOADING ||\n            $ctrl.editModalFlowService.currentState === $ctrl.editModalFlowService.STATES.DONE ||\n            $ctrl.editModalFlowService.showConfirmExitUI"> <input actionable-id="{{ ::$ctrl.pageId }}_confirmed_e_docs" class="input CB_ReadOnly" ng-model="$ctrl.agreementConfirmation" ng-change="$ctrl.updateNextButtonStatus()" type="checkbox"/> <label for="{{ ::$ctrl.pageId }}_confirmed_e_docs" class="max-text-width"> <span> {{ ::\'mutualFund.intro.agreements.part1d1\' | translate }} </span> <a actionable-id="mutual-fund-intro-link1" ng-href="{{ ::\'mutualFund.intro.agreements.link1\' | translate }}"> {{ ::\'mutualFund.intro.agreements.part1d2\' | translate }} </a> <span> {{ ::\'mutualFund.intro.agreements.part1d4\' | translate }} </span> </label> </div> <tng-page-flow-controls flow-service="$ctrl.editModalFlowService"></tng-page-flow-controls> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(15)),a=u(n(177)),s=u(n(0)),r=u(n(2)),o=u(n(264)),c=u(n(266)),l=u(n(265));function u(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(t,n,i,r,c,l,u,d,h,f,p,g,m,_,v,S,T,y,E){(0,s.default)(this,e);var A=(0,o.default)(this,(e.__proto__||(0,a.default)(e)).call(this,t,r,l,u,d,m));return A.$translate=c,A.$state=n,A.stateConstants=i,A.cifTypeService=h,A.$timeout=g,A.ACCOUNT_TYPES=p.ACCOUNT_TYPES,A.menuConstants=v,A.CAPABILITIES=v.CAPABILITIES,A.GlobalModalsService=_,A.communicationConstants=f,A.settingsConstants=m,A.requesterService=T,A.$q=y,A.serviceConstants=E,A.selected={},A.selectedOriginalData=null,A.customerHasOnlyCC=!1,A.customerHasOnlyMortage=!1,A.checkedPreferencesAccountTypes={},A.checkedAccountTypes={},A.isBusinessClient=!1,A.language={allowDisplay:!1},A.edocument={allowDisplay:!1,disableSelect:!1},A.statement={allowDisplay:!1,savings:{allowSelect:!1},mutual_funds:{allowSelect:!1},credit_card:{allowSelect:!1}},A.taxReceipt={allowDisplay:!1,displayHeader:!0,savings:{allowSelect:!1},mutual_funds:{allowSelect:!1}},A.trade={allowDisplay:!1,mutual_funds:{allowSelect:!1}},A.location=S,A}return(0,l.default)(e,t),(0,r.default)(e,[{key:"$onInit",value:function(){var t=this;this.pageId="otherCommunicationModal",this.accountValidation=!1,this.wihtoutAccount=!1,this.FROM_ACCOUNTS=[],this._getStatementAccounts(),this.editModalFlowService.activate(),this.orangeAlertsUrl="#"+this.settingsConstants.URL_PATH+this.settingsConstants.COMPONENT.ORANGE_ALERTS.URL,this.editModalFlowService.onButtonClickCancel=function(){t._close()},this.editModalFlowService.onButtonClickDone=function(){t._close()},this.editModalFlowService.onButtonClickSave=function(){t._submitData()},this.editModalFlowService.onButtonClickAmlRefreshKycDone=function(){t.onDoneButtonClicked()},this.editModalFlowService.denyExit=function(){t.editModalFlowService.showConfirmExitUI=!1},this.editModalFlowService.allowExit=function(){t._close()},this._prepareData(),this.editModalFlowService.moveTo(this.editModalFlowService.STATES.SHOW)}},{key:"_getStatementAccounts",value:function(){var t=this;return this.customersService.getStatementAccounts().then((function(e){0===e.fromAccounts.length&&(t.wihtoutAccount=!0,t.accountValidation=!1),t.FROM_ACCOUNTS=e.fromAccounts;var n=e.fromAccounts.filter((function(t){return t.number===e.selected_account}));n&&n.length>0?(t.selected.savings.selected_account=e.selected_account,t.selectedOriginalData.savings.selected_account=e.selected_account):(t.selected.savings.selected_account="",t.selectedOriginalData.savings.selected_account="")})).catch((function(e){t.$log.error("Statement -> getAccounts error message:",e)}))}},{key:"onDoneButtonClicked",value:function(){this.isStatementFlag&&this.statement.savings.allowSelect&&!this.selected.savings.selected_account&&"PAPER"===this.selected.savings[this.communicationConstants.USER_DATA.STATEMENT.KEY]&&!1===this.wihtoutAccount?this.accountValidation=!0:(this.editModalFlowService.exitLoadingMode(),this.editModalFlowService.flowServiceReset(),this.onClose())}},{key:"_close",value:function(){this.editModalFlowService.currentState===this.editModalFlowService.STATES.DONE||this.editModalFlowService.currentState===this.editModalFlowService.STATES.SHOW?(this.editModalFlowService.hideWarning(),this.onClose()):this.editModalFlowService.showConfirmExitUI?(this.userData=this.selectedOriginalData,this._createUserSettings(),this.onClose()):this.editModalFlowService.showConfirmExitUI=!0}},{key:"_createEmailPreferenceCategoryList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.email_preference_categories&&t.email_preference_categories.forEach((function(t){t.selected||(t.selected="N")}))}},{key:"_createUserSettings",value:function(){this.selected=angular.copy(this.userData),this._createEmailPreferenceCategoryList(this.selected)}},{key:"_prepareRestrictions",value:function(){this.checkedPreferencesAccountTypes=this._userPreferencesContainsAccountTypes([this.customerConstants.API.COMMUNICATION.PREFERENCES_KEYS.SAVINGS.KEY,this.customerConstants.API.COMMUNICATION.PREFERENCES_KEYS.MUTUAL_FUNDS.KEY,this.customerConstants.API.COMMUNICATION.PREFERENCES_KEYS.CREDIT_CARD.KEY]),this.checkedAccountTypes=this._accountTypesContainsOtherTypes([this.ACCOUNT_TYPES.CHEQUING,this.ACCOUNT_TYPES.SAVINGS]),this.customerHasOnlyCC=this._accountTypesHasOnlyType(this.ACCOUNT_TYPES.CREDIT_CARD),this.customerHasOnlyMortage=this._accountTypesHasOnlyType(this.ACCOUNT_TYPES.MORTGAGE),this._prepareEdocumentRestrictions(),this._prepareStatementRestrictions(),this._prepareTaxReceiptRestrictions(),this._prepareTradeRestrictions(),this._prepareBehaviors()}},{key:"_prepareEdocumentRestrictions",value:function(){var t=-1!==this.capabilities.indexOf(this.menuConstants.CAPABILITIES.EDOCS_PREFERENCE_DISPLAY),e=-1!==this.capabilities.indexOf(this.menuConstants.CAPABILITIES.EDOCS_PREFERENCE_UPDATE),n=-1!==this.capabilities.indexOf(this.menuConstants.CAPABILITIES.BUSINESS_UPDATE_FULL),i=t&&!e,a=!t&&!e;this.edocument.allowDisplay=!a||n,this.edocument.disableSelect=i&&this.checkedAccountTypes[this.ACCOUNT_TYPES.CHEQUING]}},{key:"_prepareStatementRestrictions",value:function(){var t=this.customerConstants.API.COMMUNICATION.PREFERENCES_KEYS;this.statement.allowDisplay=this.checkedPreferencesAccountTypes[t.SAVINGS.KEY]||this.checkedPreferencesAccountTypes[t.MUTUAL_FUNDS.KEY]||this.checkedPreferencesAccountTypes[t.CREDIT_CARD.KEY],this.statement.allowDisplay&&(this.statement.savings.allowSelect=!(this.customerHasOnlyCC||this.customerHasOnlyMortage),this.statement.mutual_funds.allowSelect=this.checkedPreferencesAccountTypes[t.MUTUAL_FUNDS.KEY],this.statement.credit_card.allowSelect=this.checkedPreferencesAccountTypes[t.CREDIT_CARD.KEY])}},{key:"_prepareTaxReceiptRestrictions",value:function(){var t=this.customerConstants.API.COMMUNICATION.PREFERENCES_KEYS;this.taxReceipt.allowDisplay=this.checkedPreferencesAccountTypes[t.SAVINGS.KEY]||this.checkedPreferencesAccountTypes[t.MUTUAL_FUNDS.KEY],this.taxReceipt.allowDisplay&&(this.taxReceipt.savings.allowSelect=!(this.customerHasOnlyCC||this.customerHasOnlyMortage)&&this._hasDepositAccounts(),this.taxReceipt.mutual_funds.allowSelect=this.checkedPreferencesAccountTypes[t.MUTUAL_FUNDS.KEY])}},{key:"_prepareTradeRestrictions",value:function(){var t=this.customerConstants.API.COMMUNICATION.PREFERENCES_KEYS;this.trade.allowDisplay=this.checkedPreferencesAccountTypes[t.MUTUAL_FUNDS.KEY],this.trade.mutual_funds.allowSelect=this.checkedPreferencesAccountTypes[t.MUTUAL_FUNDS.KEY]}},{key:"_prepareBehaviors",value:function(){var t=this;this.behaviors?this.behaviors.forEach((function(e){e===t.communicationConstants.BEHAVIORS.TAX_RECEIPTS_DELIVERY_PREFERENCES&&(t.dialogTitle=t.$translate.instant("userSettings.general.otherCommunication.editModal.taxReceipt.label"),t.edocument.allowDisplay=!1,t.statement.allowDisplay=!1,t.trade.allowDisplay=!1,t.taxReceipt.displayHeader=!1)})):(this.language.allowDisplay=!0,this.dialogTitle=this.$translate.instant("userSettings.general.otherCommunication.editModal.title"))}},{key:"_saveOriginalData",value:function(){this.selectedOriginalData=angular.copy(this.selected)}},{key:"_userPreferencesContainsAccountTypes",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n={};return e.forEach((function(e){n[e]=void 0!==t.userData[e]})),n}},{key:"_accountTypesContainsOtherTypes",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n={};return e.forEach((function(e){n[e]=t.accounts.filter((function(t){return t.type===e})).length>0})),n}},{key:"_accountTypesHasOnlyType",value:function(t){var e=this.accounts.filter((function(e){return e.type===t}));return this.accounts.length===e.length}},{key:"_getAccountsForPreferences",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.length)return{};var n={},a=this.customerConstants.API.COMMUNICATION.PREFERENCES_KEYS,s="",r="";return(0,i.default)(a).forEach((function(i){var o=a[i].KEY;t.userData[o]&&e.forEach((function(e){if(t.userData[o][e]){switch(n[e]||(n[e]=[]),o){case a.SAVINGS.KEY:s=a.SAVINGS.TRANSLATION;break;case a.MUTUAL_FUNDS.KEY:s=a.MUTUAL_FUNDS.TRANSLATION;break;case a.CREDIT_CARD.KEY:s=a.CREDIT_CARD.TRANSLATION}if(t.userData[o][e]===t.customerConstants.API.COMMUNICATION.OTHER_TYPES.ELECTRONIC.KEY?r=t.customerConstants.API.COMMUNICATION.OTHER_TYPES.ELECTRONIC.TRANSLATION:t.userData[o][e]===t.customerConstants.API.COMMUNICATION.OTHER_TYPES.PAPER.KEY&&(r=t.customerConstants.API.COMMUNICATION.OTHER_TYPES.PAPER.TRANSLATION),s&&r){var i={label:s,text:r};n[e].push(i)}}}))})),n}},{key:"_prepareDisplayInfo",value:function(){var t=this,e={order:0,label:this.customerConstants.API.COMMUNICATION.USER_DATA.LANGUAGE.TRANSLATION};if(this.userData.language&&(this.userData.language===this.customerConstants.API.COMMUNICATION.LANGUAGES.ENGLISH.KEY?e.text=this.customerConstants.API.COMMUNICATION.LANGUAGES.ENGLISH.TRANSLATION:this.userData.language===this.customerConstants.API.COMMUNICATION.LANGUAGES.FRENCH.KEY&&(e.text=this.customerConstants.API.COMMUNICATION.LANGUAGES.FRENCH.TRANSLATION)),this.userData.langauge&&(this.userData.langauge===this.customerConstants.API.COMMUNICATION.LANGUAGES.ENGLISH.KEY?e.text=this.customerConstants.API.COMMUNICATION.LANGUAGES.ENGLISH.TRANSLATION:this.userData.langauge===this.customerConstants.API.COMMUNICATION.LANGUAGES.FRENCH.KEY&&(e.text=this.customerConstants.API.COMMUNICATION.LANGUAGES.FRENCH.TRANSLATION)),e.text&&this.displayedInfo.push(e),this.edocument.allowDisplay){var n={order:1,label:this.customerConstants.API.COMMUNICATION.USER_DATA.EDOCUMENT.TRANSLATION};this.userData.edocument===this.customerConstants.API.COMMUNICATION.STATES.YES.KEY?n.text=this.customerConstants.API.COMMUNICATION.STATES.YES.TRANSLATION:n.text=this.customerConstants.API.COMMUNICATION.STATES.NO.TRANSLATION,this.displayedInfo.push(n)}var a=[];this.statement.allowDisplay&&a.push(this.customerConstants.API.COMMUNICATION.USER_DATA.STATEMENT.KEY),this.taxReceipt.allowDisplay&&a.push(this.customerConstants.API.COMMUNICATION.USER_DATA.TAX_RECEIPT.KEY),this.trade.allowDisplay&&a.push(this.customerConstants.API.COMMUNICATION.USER_DATA.TRADE_CONFIRMATION.KEY);var s=this._getAccountsForPreferences(a),r=this.customerConstants.API.COMMUNICATION.USER_DATA;(0,i.default)(s).forEach((function(e){var n=s[e];if(n.length>0)if(e===r.STATEMENT.KEY){var i={order:2,label:t.customerConstants.API.COMMUNICATION.USER_DATA.STATEMENT.TRANSLATION,texts:n};t.displayedInfo.push(i)}else if(e!==r.TAX_RECEIPT.KEY||t.cifTypeService.isBusiness()){if(e===r.TRADE_CONFIRMATION.KEY){var a={order:4,label:t.customerConstants.API.COMMUNICATION.USER_DATA.TRADE_CONFIRMATION.TRANSLATION,texts:n};t.displayedInfo.push(a)}}else{var o={order:3,label:t.customerConstants.API.COMMUNICATION.USER_DATA.TAX_RECEIPT.TRANSLATION,texts:n};t.displayedInfo.push(o)}})),this.GlobalModalsService.displayedInfoOtherCommunication=this.displayedInfo}},{key:"_prepareData",value:function(){this.userData?(this._createUserSettings(),this._prepareRestrictions(),this._saveOriginalData(),this._getCustomerConsents(),this.isBusinessClient=this._determineBusinessClient()):this._getData()}},{key:"_determineBusinessClient",value:function(){return this.capabilities.indexOf(this.CAPABILITIES.BUSINESS_UPDATE_FULL)>=0}},{key:"_hasDepositAccounts",value:function(){return this.checkedAccountTypes[this.ACCOUNT_TYPES.CHEQUING]||this.checkedAccountTypes[this.ACCOUNT_TYPES.SAVINGS]}},{key:"_getData",value:function(){var t=this;return this.$q.all({preferences:this._getCustomerPreferences(),accounts:this._getAccounts(),capabilities:this._getCapabilities()}).then((function(e){t.userData=e.preferences,t.accounts=e.accounts,t.capabilities=e.capabilities,t._createUserSettings(),t._prepareRestrictions(),t._saveOriginalData(),t._getCustomerConsents(),t.isBusinessClient=t._determineBusinessClient()}))}},{key:"_getCustomerPreferences",value:function(){var t=this;return this.customersService.getCustomerPreferences().then((function(e){return t.$log.debug("GET Customers Preferences response: ",e),e.communication})).catch((function(e){t.$log.error(e),t._requestError(e)}))}},{key:"_getAccounts",value:function(){var t=this;return this.requesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_SUMMARY,{},{}).then((function(t){return t.accounts})).catch((function(e){t.$log.error(e),t._requestError(e)}))}},{key:"_getCapabilities",value:function(){var t=this;return this.requesterService.request(this.serviceConstants.AVAILABLE_SERVICES.USER_CAPABILITIES_NO_QUERY).then((function(t){return t.capabilities})).catch((function(e){t.$log.error(e),t._requestError(e)}))}},{key:"_submitData",value:function(){var t=this;if(!(this.isStatementFlag&&this.statement.savings.allowSelect&&this.selected.savings)||this.selected.savings.selected_account||"PAPER"!==this.selected.savings[this.communicationConstants.USER_DATA.STATEMENT.KEY]||!1!==this.wihtoutAccount){this.editModalFlowService.enterLoadingMode(),!this.agreementConfirmationFromServer&&this.agreementChecked()&&(this.selected.mutual_funds[this.communicationConstants.USER_DATA.STATEMENTS_CONSENT.KEY]=!0);var n=this.userData?angular.copy(this.userData):{},i=this.selected;return i.mutual_funds&&!i.mutual_funds.statements&&(i.mutual_funds.statements="PAPER"),this.taxReceipt.savings.allowSelect||delete i.savings.tax_receipts,(0,c.default)(e.prototype.__proto__||(0,a.default)(e.prototype),"prepareRequest",this).call(this),this.customersService.putCustomerPreferences(i).then((function(i){if(t.$log.debug("Response after update other communication"),i.response_status.status_code!==t.customerConstants.API.RESPONSE_CODES.SUCCESS)throw t.$log.error("Update other communication failed validation:",i),new Error(i);angular.merge(t.userData,t.selected),t._saveOriginalData(),t.$log.debug("Update other communication has been accepted:",i);var s={userData:{currentValue:t.userData,previousValue:n}};(0,c.default)(e.prototype.__proto__||(0,a.default)(e.prototype),"finishRequest",t).call(t),t.editModalFlowService.showLoadingDoneIcon(),t.$onChanges(s),t.displayedInfo=[],t._prepareDisplayInfo(),t.$timeout((function(){t.editModalFlowService.exitLoadingMode(),t.onModalClose(),t.editModalFlowService.flowServiceReset()}),t.editModalFlowService.MODAL_VISIBILITY_TIMEOUT)})).catch((function(e){t.$log.error("Update other communication rejected: ",e),t.editModalFlowService.exitLoadingMode(),t.editModalFlowService.gotoPreviousState()}))}this.accountValidation=!0}},{key:"onModalClose",value:function(){this._close()}},{key:"gotoOrangeAlertPage",value:function(){var t=""+this.settingsConstants.URL_PATH+this.settingsConstants.COMPONENT.ORANGE_ALERTS.URL;this.onClose(),this.location.path(t)}},{key:"onPreferenceChange",value:function(){this.accountValidation=!1,angular.equals(this.selectedOriginalData,this.selected)?(this.editModalFlowService.flowServiceReset(),this.editModalFlowService.moveTo(this.editModalFlowService.STATES.SHOW)):this.editModalFlowService.moveTo(this.editModalFlowService.STATES.EDIT),this.showAgreement()&&this.updateNextButtonStatus()}},{key:"updateInfo",value:function(t){(0,c.default)(e.prototype.__proto__||(0,a.default)(e.prototype),"updateInfo",this).call(this,t)&&(this._prepareData(),this.userData&&this._prepareDisplayInfo())}},{key:"showAgreement",value:function(){return this.selected.mutual_funds&&(this.selected.mutual_funds[this.communicationConstants.USER_DATA.STATEMENT.KEY]===this.communicationConstants.OPTIONS.ELECTRONIC||this.selected.mutual_funds[this.communicationConstants.USER_DATA.TAX_RECEIPT.KEY]===this.communicationConstants.OPTIONS.ELECTRONIC||this.selected.mutual_funds[this.communicationConstants.USER_DATA.TRADE_CONFIRMATION.KEY]===this.communicationConstants.OPTIONS.ELECTRONIC)}},{key:"agreementNotChecked",value:function(){return this.showAgreement()&&!this.agreementConfirmation}},{key:"agreementChecked",value:function(){return this.showAgreement()&&this.agreementConfirmation}},{key:"updateNextButtonStatus",value:function(){this.editModalFlowService.currentFlow.BUTTONS.BTN_ORG.disable=this.agreementNotChecked()}},{key:"_getCustomerConsents",value:function(){this.agreementConfirmationFromServer=!1,this.selected.mutual_funds&&this.selected.mutual_funds[this.communicationConstants.USER_DATA.STATEMENTS_CONSENT.KEY]&&(this.agreementConfirmationFromServer=this.selected.mutual_funds[this.communicationConstants.USER_DATA.STATEMENTS_CONSENT.KEY]),this.agreementConfirmation=this.agreementConfirmationFromServer}}]),e}(u(n(1897)).default);d.$inject=["$log","$state","stateConstants","$filter","$translate","customerConstants","CustomersService","EditModalFlowService","CifTypeService","OtherCommunicationConstants","accountConstants","$timeout","UserSettingsConstants","GlobalModalsService","menuConstants","$location","RequesterService","$q","serviceConstants"],e.default=d,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4937)),a=s(n(4938));function s(t){return t&&t.__esModule?t:{default:t}}n(4939);var r={controller:i.default,template:a.default,bindings:{id:"@",name:"@",header:"@?",ngChange:"&",ngModel:"="}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.$log=e,this.options=[{name:"yes",value:!0},{name:"no",value:!1}]}return(0,a.default)(t,[{key:"$onInit",value:function(){this.$log.debug("ConditionPicker initialized for "+this.name)}},{key:"generateId",value:function(t){return this.id+"_"+t}},{key:"generateTranslationKey",value:function(t){return"accountDetails.creditCard.balanceProtectionInsurance."+t}}]),t}();r.$inject=["$log"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-condition-picker__edit__section"> <h5 class="heading--sub3"> {{ ::$ctrl.header | translate }} </h5> <div class="field__group--inline"> <div class="field" ng-repeat="option in $ctrl.options"> <input actionable-id="{{ ::$ctrl.generateId(option.name) }}" ng-model="$ctrl.ngModel" ng-click="$ctrl.ngChange({value: option.value})" class="input input--pill" type="radio" ng-value="{{option.value}}"/> <label for="{{ ::$ctrl.generateId(option.name) }}">{{ ::$ctrl.generateTranslationKey(option.name) | translate }}</label> </div> </div> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4941),s=(i=a)&&i.__esModule?i:{default:i};n(4942);var r={template:s.default,controller:function(){},bindings:{title:"@",value:"@",disabled:"<",fontColor:"@?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-small-card"> <span class="c-small-card__title" ng-class="{ \'c-small-card__title--grayed\': $ctrl.disabled }" ng-style="{ \'color\': $ctrl.fontColor || \'\' }"> {{$ctrl.title}} </span> <span class="c-small-card__value" ng-class="{\'c-small-card__value--grayed\': $ctrl.disabled }" ng-style="{ \'color\': $ctrl.fontColor || \'\' }"> {{$ctrl.value | currency}} </span> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4944),s=(i=a)&&i.__esModule?i:{default:i};n(4945);var r={template:s.default,controller:function(){},transclude:{tngContent:"?tngContent",tngHeader:"?tngHeader"},bindings:{transcludeMode:"<?",transcludeExpanded:"<?",rows:"<",name:"@",excludeNumbers:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<section class="c-accordion"> <div ng-if="!$ctrl.transcludeMode" ng-repeat="(key, row) in $ctrl.rows"> <input id="{{$ctrl.name}}-{{key}}" type="checkbox" ng-model="row.expanded"/> <label for="{{$ctrl.name}}-{{key}}"> <div> {{$ctrl.rows.length > 1 && !$ctrl.excludeNumbers ? (key + 1) + ". " : ""}}{{row.header | translate:row.headerValues }} </div> <i class="c-accordion__chevron large" ng-class="row.expanded ? \'icon-uparrow\' : \'icon-downarrow\'"></i> </label> <article class="c-accordion__body"> <p ng-bind-html="row.body | translate:row.bodyValues | absoluteHref"></p> </article> </div> <div ng-if="$ctrl.transcludeMode"> <input id="{{$ctrl.name}}-{{key}}" type="checkbox" ng-model="$ctrl.transcludeExpanded"/> <label for="{{$ctrl.name}}-{{key}}"> <div ng-transclude="tngHeader"> </div> <i class="c-accordion__chevron large" ng-class="$ctrl.transcludeExpanded ? \'icon-uparrow\' : \'icon-downarrow\'"></i> </label> <article class="c-accordion__body"> <div ng-transclude="tngContent"> </div> </article> </div> </section> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(4947),s=(i=a)&&i.__esModule?i:{default:i};n(4948);var r={template:s.default,controller:angular.noop,bindings:{hideCloseButton:"<?",onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog analytics-id="areyouaclient" class="c-user-check-modal" hide-close="$ctrl.hideCloseButton" on-close="$ctrl.onClose({})"> <header> {{ ::\'global.userCheck.question\' | translate }} </header> <p>{{ ::\'global.userCheck.description\' | translate }}</p> <footer> <button actionable-id="user-check-modal-no" class="btn btn--edit" ng-click="$ctrl.onClose({ isUser: false })"> {{ ::\'global.userCheck.no\' | translate}} </button> <button actionable-id="user-check-modal-yes" class="btn" ng-click="$ctrl.onClose({ isUser: true })"> {{ ::\'global.userCheck.yes\' | translate}} </button> </footer> </tng-modal-dialog> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4950)),a=s(n(4951));function s(t){return t&&t.__esModule?t:{default:t}}n(4952);var r={template:i.default,controller:a.default,require:{form:"^form"},bindings:{ngModel:"=",ngReadonly:"<",ngRequired:"<?",inputId:"@",onChange:"&?",showValidationOnLoad:"<?",hasValidSin:"=?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="field c-sin-input"> <input type="tel" class="input" ng-class="{ \'warning\': !$ctrl.form[$ctrl.inputId].$valid && ($ctrl.form[$ctrl.inputId].$touched || $ctrl.showValidationOnLoad)}" actionable-id="{{ ::$ctrl.inputId }}" placeholder="{{ ::\'newClientEnrollment.identityInfo.sinPlaceholder\' | translate }}" ng-model="$ctrl.displaySin" ng-model-options="{ allowInvalid: true }" ng-required="$ctrl.ngRequired" ng-disabled="$ctrl.readOnly" ng-focus="$ctrl.unformatSIN()" ng-change="$ctrl.onSinChange()" ng-blur="$ctrl.formatSIN()" ng-trim="false" autocomplete="off"/> <div class="field__error" ng-messages="$ctrl.form[$ctrl.inputId].$error" ng-show="$ctrl.form[$ctrl.inputId].$touched || $ctrl.showValidationOnLoad"> <span ng-message="required"> {{ ::\'validation.isRequired\' | translate }} </span> <span ng-message="pattern"> {{ ::\'newClientEnrollment.identityInfo.invalidSIN\' | translate }} </span> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(0)),a=o(n(2)),s=o(n(1818)),r=n(67);function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,a){(0,i.default)(this,t),this.DUMMY_SIN_NUMBERS=e.DUMMY_SIN_NUMBERS,this.SIN_LENGTH=9,this.$timeout=n,this.$scope=a,this.sinPattern=r.sinPattern}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.readOnly=!!this.ngReadonly,this.stopWatch=this.$scope.$watch((function(){return t.ngModel}),(function(){t.ngModel&&t.ngModel.length&&t.stopWatch(),t.ngModel=t.ngModel?t.ngModel:"",t.displaySin=t.ngModel,t._validateSin(),t.formatSIN()}),!0)}},{key:"formatSIN",value:function(){this.ngModel&&(this.displaySin=this.ngModel.replace(/^(\d{3})(\d{3})(\d{3})$/,"***-***-$3"))}},{key:"unformatSIN",value:function(){this.readOnly||(this.displaySin=this.ngModel)}},{key:"onSinChange",value:function(){this.ngModel=this.displaySin,this._validateSin(),this.onChange&&this.onChange()}},{key:"_validateSin",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.readOnly&&this.form&&this.form[this.inputId]){this.ngModel=this.ngModel.replace(/[^0-9]+/g,""),this.ngModel.length>this.SIN_LENGTH&&(this.ngModel=this.ngModel.substring(0,this.SIN_LENGTH)),t||(this.displaySin=this.ngModel);var e=!(-1!==this.DUMMY_SIN_NUMBERS.indexOf(this.ngModel)),n=new RegExp(this.sinPattern).test(this.ngModel);this.ngRequired||this.ngModel||(n=!0);var i=s.default.validate(this.ngModel);this.form[this.inputId].$setValidity("pattern",e&&n&&i)}}}]),t}();c.$inject=["customerConstants","$timeout","$scope"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4954)),a=s(n(4955));function s(t){return t&&t.__esModule?t:{default:t}}n(4956);var r={template:i.default,controller:a.default,bindings:{firstWidth:"<",progressBarColor:"<",ltsPreview:"<",saveAvailable:"<",warnings:"<",showMoveMoneyButton:"<",amountExceed:"<",showLearnMore:"<",isDailyView:"<",changeToTransaction:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports=' <div ng-if="$ctrl._showWarnings()"> <div class="lts-message__message"> <div ng-repeat="warning in $ctrl.warnings">{{ ::\'budget.budgetSummary.warnings.\' + warning | translate}}</div> </div> </div> <div ng-if="!$ctrl._showWarnings()"> <div class="lts-message__message" ng-if="!$ctrl.saveAvailable && !$ctrl.showLearnMore"> {{$ctrl.getLtsMessage()}} </div> <div ng-if="!$ctrl.saveAvailable && $ctrl.showLearnMore" class="lts-message__message-table"> <div id="Lts-message" class="lts-message__message-save"> {{$ctrl.getLtsMessage()}} </div> <div class="lts-message__button-movemoney"> <button id="Lts-fixIt" class="c-budget-navigation-footer__controls btn__row btn btn--warn btn--auto btn--medium btn--right" actionable-id="fixIt" ng-click="$ctrl.enterFixItDialog()"> {{::\'budget.budgetSummary.fixIt\' | translate }} </button> </div> </div> <div ng-if="$ctrl.saveAvailable" class="lts-message__message-table"> <div id="Lts-message" class="lts-message__message-save"> {{ ::\'budget.budgetSummary.message1\' | translate }} <span class="lts-message__excess-amount">{{ $ctrl.amountExceed | currency }}</span> {{ ::\'budget.budgetSummary.message2\' | translate }} </div> <div class="lts-message__button-movemoney"> <button id="Lts-moveMoney" class="c-budget-navigation-footer__controls btn__row btn btn--done btn--medium btn--auto btn--right" actionable-id="move_money" ng-click="$ctrl.onClickShowMoveMoney()"> {{::\'budget.budgetSummary.saveIt\' | translate }} </button> </div> </div> <tng-lts-fix-it-dialog on-close="$ctrl.onClose()" see-lts-detail="$ctrl.seeLtsDetails()" ng-if="$ctrl.showFixItDialog"> </tng-lts-fix-it-dialog> <tng-lts-move-money-dialog on-close="$ctrl.onClose()" ng-if="$ctrl.showMoveMoneyDialog"> </tng-lts-move-money-dialog> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l){(0,i.default)(this,t),this.$log=e,this.colorConstants=n,this.$translate=a,this.stateConstants=s,this.$state=r,this.$location=o,this.$anchorScroll=c,this.ltsMessage="",this.GlobalModalsService=l}return(0,a.default)(t,[{key:"$onInit",value:function(){this.showFixItDialog=!1,this.showMoveMoneyDialog=!1}},{key:"changeStyle",value:function(t){this.changeColor=t}},{key:"getLtsMessage",value:function(){return!0===this.ltsPreview?this.ltsMessage=this.$translate.instant("budget.budgetSummary.preview_message"):!1===this.ltsPreview&&this.progressBarColor===this.colorConstants.COLOR_DUSTY_ORANGE&&this.firstWidth<=15?this.ltsMessage=this.$translate.instant("budget.budgetSummary.fifteen_percent_message"):!1===this.ltsPreview&&this.progressBarColor===this.colorConstants.COLOR_DUSTY_ORANGE&&this.firstWidth>15?this.ltsMessage=this.$translate.instant("budget.budgetSummary.orange_message"):!1===this.ltsPreview&&this.progressBarColor===this.colorConstants.COLOR_GREY?this.ltsMessage=this.$translate.instant("budget.budgetSummary.grey_message"):!1===this.ltsPreview&&this.progressBarColor===this.colorConstants.COLOR_WARNING&&(this.ltsMessage=this.$translate.instant("budget.budgetSummary.red_message")),this.ltsMessage}},{key:"_showWarnings",value:function(){return!!(this.warnings&&this.warnings.length>0)}},{key:"onClickShowMoveMoney",value:function(){this.showMoveMoneyDialog=!0}},{key:"enterFixItDialog",value:function(){this.showFixItDialog=!0}},{key:"onClose",value:function(){this.showFixItDialog=!1,this.showMoveMoneyDialog=!1}},{key:"seeLtsDetails",value:function(){this.changeToTransaction(),this.showFixItDialog=!1,this.$location.hash("ltsDetailsContentArea"),this.$anchorScroll()}}]),t}();r.$inject=["$log","colorConstants","$translate","stateConstants","$state","$location","$anchorScroll","GlobalModalsService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4958)),a=s(n(4959));function s(t){return t&&t.__esModule?t:{default:t}}n(4960);var r={template:i.default,controller:a.default,bindings:{onClose:"&",seeLtsDetail:"&",showFixItDialog:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose()" class="c-move-money"> <header> <span> {{ ::\'budget.fixDialog.header\' | translate }} </span> </header> <div class="dialog-content"> <div> <span> {{ ::\'budget.fixDialog.text1\' | translate }} </span> <div class="c-lts-transaction-list__clearfix-lts"></div> <h3 class="medium"> <p ng-bind-html="\'budget.fixDialog.text3\' | translate"> </p> </h3> </div> <div class="c-account-tile"> <tng-tile-list class="c-account-select__tile-list" tile-data="$ctrl.tileData" tile-type="$ctrl.TILE_TYPE.text" all-actionable="true" single-select="true" on-tile-click="$ctrl.onSelect(index)" selected-tiles="$ctrl.selectedTile"> </tng-tile-list> </div> </div> <footer> <div> <button actionable-id="lts-fix-dialog" class="btn--done" ng-click="$ctrl.onClose()"> {{::\'budget.budgetSummary.done\' | translate }} </button> </div> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d){(0,i.default)(this,t),this.$log=e,this.$window=n,this.$translate=a,this.$state=s,this.budgetToolConstants=r,this.localeService=o,this.stateConstants=c,this.menuConstants=l,this.UrlService=u,this.EnvironmentService=d}return(0,a.default)(t,[{key:"$onInit",value:function(){this.tileData=this.budgetToolConstants.BudgetToolConstants.FIX_DIALOG}},{key:"onSelect",value:function(t){0===t?this.$state.go(this.stateConstants.BUDGET_TOOL,{currentState:"INCOME"}):1===t?this.seeLtsDetail():2===t&&this.$window.open(this.UrlService.fixRelativeLink(this.$translate.instant("global.menu.header.spendingBlogLink")),this.EnvironmentService.isNative()?"_system":void 0),this.onClose()}}]),t}();r.$inject=["$log","$window","$translate","$state","budgetToolConstants","LocaleService","stateConstants","menuConstants","UrlService","EnvironmentService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4962)),a=s(n(4963));function s(t){return t&&t.__esModule?t:{default:t}}n(4964);var r={template:i.default,controller:a.default,bindings:{onClose:"&",showMoveMoneyDialog:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose()" class="c-move-money" ng-if="!$ctrl.isFetching"> <header> <span> {{ ::\'budget.moveMoneyDialog.header\' | translate }} </span> </header> <div class="dialog-content"> <div> <span> {{ ::\'budget.moveMoneyDialog.text1\' | translate }} </span> <div class="c-lts-transaction-list__clearfix-lts"></div> <h3 class="medium"> <p ng-bind-html="\'budget.moveMoneyDialog.text3\' | translate"> </p> </h3> </div> <div class="c-account-tile"> <tng-tile-list id="nextStepsTiles" class="c-account-select__tile-list" tile-data="$ctrl.tileData" tile-type="$ctrl.TILE_TYPE.text" all-actionable="true" single-select="true" on-tile-click="$ctrl.onSelect(index,selectedTiles)" selected-tiles="$ctrl.selectedTile"> </tng-tile-list> </div> </div> <footer> <div> <button actionable-id="lts-moveMoney-dialog" class="btn--done" ng-click="$ctrl.onClose()"> {{::\'budget.budgetSummary.done\' | translate }} </button> </div> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f,p,g,m,_){(0,i.default)(this,t),this.$log=e,this.$window=n,this.$translate=a,this.$state=s,this.$q=r,this.budgetToolConstants=o,this.ACCOUNT_TYPES=c,this.accountConstants=l,this.stateConstants=u,this.menuConstants=d,this.ConfirmWindowUnloadService=h,this.GlobalModalsService=f,this.AccountSummaryService=p,this.UrlService=g,this.EnvironmentService=m,this.TimerService=_}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.isFetching=!0,this.accounts=null,this.tileData=[],this.$q.resolve([this._fetchAccounts()]).then((function(){})).catch((function(){t.isFetching=!0})),this.accNumber=null,this.showMoveMoneyOption=!1}},{key:"_fetchAccounts",value:function(){var t=this;this.isFetching=!0;this.AccountSummaryService.getAccounts({urlVars:{includeAuthorizedUsers:!0},queries:{includeAuthorizedUsers:!0}}).then((function(e){var n=e.accounts;t.accounts=n,t.isFetching=!1,t._getTileData()})).finally((function(){}))}},{key:"_getTileData",value:function(){var t=this;this.accountCount=0,this.ACCOUNT_TYPE=this.ACCOUNT_TYPES.SAVINGS,this.isFetching||(this.accounts&&this.accounts.forEach((function(e){e.type===t.ACCOUNT_TYPE&&(t.accountCount+=1),e.type===t.ACCOUNT_TYPE&&!1===e.goal_account&&(t.hasSavingsAccount=!0)})),this.accountCount>0&&this.tileData.push(this.budgetToolConstants.BudgetToolConstants.MOVE_MONEY_DIALOG[0]),!this.hasSavingsAccount&&this.accountCount<10&&this.tileData.push(this.budgetToolConstants.BudgetToolConstants.MOVE_MONEY_DIALOG[1]),this.accountCount<10&&this.tileData.push(this.budgetToolConstants.BudgetToolConstants.MOVE_MONEY_DIALOG[2]),this.tileData.push(this.budgetToolConstants.BudgetToolConstants.MOVE_MONEY_DIALOG[3]))}},{key:"onSelect",value:function(t,e){this.selectedTiles=e,this.$translate.instant(this.selectedTiles[0].header)===this.$translate.instant("budget.moveMoneyDialog.moveMoney")?this.GlobalModalsService.showMoveMoney():this.$translate.instant(this.selectedTiles[0].header)===this.$translate.instant("budget.moveMoneyDialog.setUpGoal")?this.GlobalModalsService.showGoalModal():this.$translate.instant(this.selectedTiles[0].header)===this.$translate.instant("budget.moveMoneyDialog.blog")?this.$window.open(this.UrlService.fixRelativeLink(this.$translate.instant("global.menu.header.moveMoneyBlogLink")),this.EnvironmentService.isNative()?"_system":void 0):this.$translate.instant(this.selectedTiles[0].header)===this.$translate.instant("budget.moveMoneyDialog.openSavingsAccount")&&this.$state.go(this.stateConstants.EXISTING_CLIENT_ONBOARDING,{addAccount:this.accountConstants.ACCOUNT_TYPES.SAVINGS}),this.onClose()}}]),t}();r.$inject=["$log","$window","$translate","$state","$q","budgetToolConstants","ACCOUNT_TYPES","accountConstants","stateConstants","menuConstants","ConfirmWindowUnloadService","GlobalModalsService","AccountSummaryService","UrlService","EnvironmentService","TimerService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4966)),a=s(n(4967));function s(t){return t&&t.__esModule?t:{default:t}}n(4968);var r={controller:i.default,template:a.default,bindings:{id:"@",name:"@",ngModel:"=",translationKeyPrefix:"@",options:"=",ngChange:"&",header:"@?"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.$log=e}return(0,a.default)(t,[{key:"$onInit",value:function(){this.options&&this.translationKeyPrefix||(this.options=[{name:"yes",value:!0},{name:"no",value:!1}],this.translationKeyPrefix="global"),this.$log.debug("RadioButtonPicker initialized for "+this.name)}},{key:"generateId",value:function(t){return this.id+"_"+t}},{key:"generateTranslationKey",value:function(t){return this.translationKeyPrefix+"."+t}}]),t}();r.$inject=["$log"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-radio-button-picker"> <h5 class="heading--sub3" ng-if="$ctrl.header"> {{ ::$ctrl.header | translate }} </h5> <div class="field__group--inline"> <span class="field" ng-repeat="option in $ctrl.options" ng-class="{\'margin__r--fix1\':!$last}"> <input actionable-id="{{ ::$ctrl.generateId(option.name) }}" ng-model="$ctrl.ngModel" ng-click="$ctrl.ngChange({value: option.value})" class="input input--pill" type="radio" ng-value="option.value"/> <label for="{{ ::$ctrl.generateId(option.name) }}">{{ ::$ctrl.generateTranslationKey(option.name) | translate }}</label> </span> </div> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(4970);var i,a=n(4971),s=(i=a)&&i.__esModule?i:{default:i};function r(t,e,n){return{restrict:"E",transclude:!0,template:s.default,scope:{backgroundImageUrl:"=",backgroundImageMobileUrl:"=",gradient:"="},link:function(i,a){var s=e.SHORTHAND_LOCALE[t.locale],r=a.children().first();if(i.backgroundImageUrl){var o=n(i.backgroundImageUrl)({locale:s});r.css({"background-image":"url("+o+")"})}if(i.backgroundImageMobileUrl){var c=n(i.backgroundImageMobileUrl)({locale:s});r.find(".mobile-bg").css({"background-image":"url("+c+")"})}i.gradient&&r.find(".gradient").removeClass("gradient--hide")}}}r.$inject=["LocaleService","localeConstants","$interpolate"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e){t.exports='<div class="c-empty-state-splash desktop-bg"> <div class="gradient gradient--hide"></div> <div class="c-empty-state-splash mobile-bg"></div> <ng-transclude></ng-transclude> </div>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4973)),a=s(n(4974));function s(t){return t&&t.__esModule?t:{default:t}}n(4975);var r={template:i.default,controller:a.default,require:{form:"^form"},bindings:{dateModel:"=",inputId:"@",isDateOfBirth:"<",minAge:"<?",maxAge:"<?",minDate:"<?",maxDate:"<?",onChange:"&?",prefillDay:"<?",prefillMonth:"<?",prefillYear:"<?",showValidationOnLoad:"<?",isRequired:"<?",personDescriptor:"<?",dateDescriptor:"<?",validationOrder:"@?",header:"@?",hideDay:"<?",businessDayOnly:"<?",businessDayErrorMessage:"<?",tooltip:"@?",errorMessage:"@?",isDisabled:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div> <h3 class="dobInputHeaderTooltip" ng-if="$ctrl.header"> {{:: $ctrl.header}} <tng-help-bubble class="dobInputHeaderTooltip" ng-if="$ctrl.tooltip"> {{ $ctrl.tooltip | translate}} </tng-help-bubble> </h3> </div> <div class="c-dob-input"> <span actionable-id="{{::$ctrl.inputId}}_anyErrors_label"></span> <span actionable-id="{{::$ctrl.inputId}}_isRunningBusinessDayCheck_label"></span> <span actionable-id="{{::$ctrl.inputId}}_day_label"></span> <span actionable-id="{{::$ctrl.inputId}}_month_label"></span> <span actionable-id="{{::$ctrl.inputId}}_year_label"></span> <div class="grid__container"> <div ng-if="!$ctrl.hideDay" class="field styleguide-grid-unit grid__column--1of3"> <input actionable-id="{{::$ctrl.inputId}}_day" class="input" ng-class="{ \'warning\': $ctrl.showingAnyError }" maxlength="2" type="text" ng-model="$ctrl.day" ng-blur="$ctrl.onDateModelChange()" placeholder="{{ \'global.dateInput.placeholders.dayLowerCase\' | translate }}" ng-change="$ctrl.clearErrors()" ng-required="$ctrl.isFieldRequired" autocomplete="off" validation-order="{{$ctrl.validationOrder}}_01" ng-disabled="$ctrl.isDisabled"/> </div> <div class="field styleguide-grid-unit grid__column--1of3" ng-class="{\'disable-select-input-like\': $ctrl.isDisabled}"> <tng-select-autocomplete input-id="{{::$ctrl.inputId}}_month" ng-model="$ctrl.month" on-select="$ctrl.onDateModelChange()" options="$ctrl.monthList" option-label-key="monthLabel" option-value-key="monthValue" placeholder="{{ \'global.dateInput.placeholders.monthLowerCase\' | translate }}" select-type="$ctrl.selectAutocompleteConstants.SELECT_TYPES.STATIC" ng-required="$ctrl.isFieldRequired" ng-warning-border="false" show-warning-border="$ctrl.showingAnyError" show-default-warnings="false" sort-alphabetically="false" alternate-light="true" validation-order="{{$ctrl.validationOrder}}_02" is-disabled="$ctrl.isDisabled"></tng-select-autocomplete> </div> <div class="field last-input-field styleguide-grid-unit grid__column--1of3"> <input actionable-id="{{::$ctrl.inputId}}_year" class="input" ng-class="{ \'warning\': $ctrl.showingAnyError }" maxlength="4" type="text" ng-model="$ctrl.year" ng-blur="$ctrl.onDateModelChange()" placeholder="{{ \'global.dateInput.placeholders.yearLowerCase\' | translate }}" ng-change="$ctrl.clearErrors()" ng-required="$ctrl.isFieldRequired" autocomplete="off" validation-order="{{$ctrl.validationOrder}}_03" ng-disabled="$ctrl.isDisabled"/> </div> </div> <input actionable-id="{{::$ctrl.inputId}}_anyErrors" type="hidden" ng-model="$ctrl.showingAnyError" ng-pattern="/^false$/" validation-order="{{$ctrl.validationOrder}}_05"/> <input actionable-id="{{::$ctrl.inputId}}_isRunningBusinessDayCheck" type="hidden" ng-model="$ctrl.isRunningBusinessDayCheck" ng-pattern="/^false$/" validation-order="{{$ctrl.validationOrder}}_06"/> <div ng-messages="$ctrl.form[$ctrl.inputId+\'_isRunningBusinessDayCheck\'].$error" ng-show="$ctrl.form[$ctrl.inputId+\'_isRunningBusinessDayCheck\'].$touched" class="field__error"> <p ng-message="pattern"> {{ ::\'global.validation.dateBusinessCheckRunning\' | translate }} </p> </div> <div class="field__error" ng-show="$ctrl.showRequiredError"> {{ ::\'global.validation.required\' | translate }} </div> <div class="field__error" ng-show="$ctrl.showInvalidError && $ctrl.isDateOfBirth"> {{ ::\'global.validation.dobInvalid\' | translate }} </div> <div class="field__error" ng-show="$ctrl.showInvalidError && !$ctrl.isDateOfBirth"> {{ ::\'global.validation.dateInvalid\' | translate }} </div> <div class="field__error" ng-show="$ctrl.showOutOfRangeError && $ctrl.isDateOfBirth"> {{ ::\'global.validation.dobOutOfRange\' | translate: { descriptor: $ctrl.personDescriptor, min: $ctrl.minAge, max: $ctrl.maxAge } }} </div> <div class="field__error" ng-show="$ctrl.showOutOfRangeError && !$ctrl.isDateOfBirth"> {{ $ctrl.invalidDateRangeMessage }} </div> <div class="field__error" ng-show="$ctrl.showBusinessDayError"> {{ $ctrl.businessDayErrorMessage | translate }} </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u){(0,i.default)(this,t),this.$locale=e,this.selectAutocompleteConstants=n,this.$timeout=a,this.$translate=s,this.EventBusService=r,this.$scope=o,this.dateSelectorConstants=c,this.dobSelectPrefillKey="dobSelectPrefill",this.DateService=l,this.$q=u,this.monthList=this.$locale.DATETIME_FORMATS.MONTH.map((function(t,e){return{monthLabel:t,monthValue:e+1}})),this.minAge=void 0===this.minAge?12:this.minAge,this.maxAge=void 0===this.maxAge?120:this.maxAge}return(0,a.default)(t,[{key:"$onInit",value:function(){this.monthName=this.inputId+"_month",this.isValid=!1,this.dateWithinRange=!0,this.dateModel&&this.parseDateModel(this.dateModel),this.isRequired||this.monthList.unshift({monthLabel:this.$translate.instant("global.dateInput.placeholders.month"),monthValue:0}),!this.personDescriptor&&this.isDateOfBirth&&(this.personDescriptor=this.$translate.instant("global.validation.Clients")),this.dateDescriptor||this.isDateOfBirth||(this.dateDescriptor=this.$translate.instant("global.validation.Date")),this.hideDay&&(this.day="1"),this.onDateModelChange(),this.setUpPrefilOnSelect(),angular.isNumber(this.prefillDay)&&(this.day=this.prefillDay),angular.isNumber(this.prefillMonth)&&(this.month=this.prefillMonth),!this.dateModel&&angular.isNumber(this.prefillYear)&&(this.year=this.prefillYear),this.isRunningBusinessDayCheck=!1}},{key:"parseDateModel",value:function(t){var e=this;this.dateModelMoment=moment(t,this.dateSelectorConstants.DATE_FORMATS.numericYearMonthDayWithDashes),this.day=this.dateModelMoment.date().toString(),this.month=this.dateModelMoment.month()+1,this.year=this.dateModelMoment.year().toString(),this.$timeout((function(){e.hideDay||(e.form[e.inputId+"_day"].$touched=!0),e.form["$ctrl."+e.monthName]&&(e.form["$ctrl."+e.monthName][e.monthName].$touched=!0),e.form[e.inputId+"_year"].$touched=!0}),0)}},{key:"setUpPrefilOnSelect",value:function(){var t=this;this.EventBusService.subscribe(this.$scope,this.dobSelectPrefillKey,(function(e,n){t.parseDateModel(n)}))}},{key:"onDateModelChange",value:function(){var t=this;this._validateDateModel().then((function(){t.onChange&&t.onChange({isValid:t.isValid})}))}},{key:"_validateDateModel",value:function(){var t=this;if(this.form)if(this.day&&this.month&&this.year){angular.isNumber(this.day)||(this.day=this.day.replace(/\D/g,"")),angular.isNumber(this.year)||(this.year=this.year.replace(/\D/g,""));var e=moment(this.year+"-"+this.month+"-"+this.day,this.dateSelectorConstants.DATE_FORMATS.numericYearMonthDayWithDashes);if(!e.isValid())return this.isValid=!1,this.invalidError=!0,this.dateWithinRange=!0,this.$q.resolve();if(this.isDateOfBirth){var n=moment().add(-this.minAge,"years"),i=moment().add(-this.maxAge,"years");if(e.isAfter(n)||e.isBefore(i))return this.isValid=!1,this.invalidError=!1,this.dateWithinRange=!1,this.$q.resolve()}else{var a=moment(this.minDate),s=moment(this.maxDate);if(this.minDate&&e.isBefore(a)||this.maxDate&&e.isAfter(s))return this.isValid=!1,this.invalidError=!1,this.dateWithinRange=!1,this.$q.resolve()}if(this.isValid=!0,this.invalidError=!1,this.dateWithinRange=!0,this.businessDayOnly){this.isRunningBusinessDayCheck=!0;var r=this.form[this.inputId+"_isRunningBusinessDayCheck"];return r&&r.$setUntouched(),this.DateService.getDateProperties(e).then((function(n){n.is_business_day?(t.businessDayError=!1,t.dateModel=moment(e).format(t.dateSelectorConstants.DATE_FORMATS.numericYearMonthDayWithDashes)):(t.isValid=!1,t.businessDayError=!0)})).catch((function(){t.businessDayError=!1,t.dateModel=moment(e).format(t.dateSelectorConstants.DATE_FORMATS.numericYearMonthDayWithDashes)})).finally((function(){t.isRunningBusinessDayCheck=!1}))}this.dateModel=moment(e).format(this.dateSelectorConstants.DATE_FORMATS.numericYearMonthDayWithDashes)}else this.isRequired||this.day||this.month||this.year?(this.isValid=!1,this.invalidError=!1,this.dateWithinRange=!0):this.dateModel=null;return this.$q.resolve()}},{key:"clearErrors",value:function(){this.invalidError=!1,this.dateWithinRange=!0,this.businessDayError=!1}},{key:"showErrors",get:function(){if(!this.form)return!1;var t=this.hideDay||this.form[this.inputId+"_day"]&&this.form[this.inputId+"_day"].$touched,e=this.form["$ctrl."+this.monthName]&&this.form["$ctrl."+this.monthName][this.monthName]&&this.form["$ctrl."+this.monthName][this.monthName].$touched,n=this.form[this.inputId+"_year"]&&(void 0!==this.form[this.inputId+"_year"].$modelValue||this.form[this.inputId+"_year"].$touched),i=t&&e&&n;return this.showValidationOnLoad||i||this.day&&this.month&&this.year}},{key:"requiredError",get:function(){return this.form&&this.isFieldRequired&&(this.form[this.inputId+"_day"]&&this.form[this.inputId+"_day"].$error.required||this.form["$ctrl."+this.monthName]&&this.form["$ctrl."+this.monthName][this.monthName]&&this.form["$ctrl."+this.monthName][this.monthName].$error.required||this.form[this.inputId+"_year"]&&this.form[this.inputId+"_year"].$error.required)}},{key:"showRequiredError",get:function(){return this.requiredError&&this.showErrors}},{key:"showInvalidError",get:function(){return!this.requiredError&&this.invalidError&&this.showErrors}},{key:"showOutOfRangeError",get:function(){return!this.requiredError&&!this.dateWithinRange&&this.showErrors}},{key:"showBusinessDayError",get:function(){return this.businessDayOnly&&!this.isRunningBusinessDayCheck&&!this.requiredError&&!this.invalidError&&this.dateWithinRange&&this.businessDayError&&this.showErrors}},{key:"showingAnyError",get:function(){return this.showRequiredError||this.showInvalidError||this.showOutOfRangeError||this.showBusinessDayError}},{key:"isFieldRequired",get:function(){return this.isRequired||this.isNonEmpty}},{key:"isNonEmpty",get:function(){return this.day&&!this.hideDay||this.month||this.year}},{key:"invalidDateRangeMessage",get:function(){if(this.errorMessage)return this.errorMessage;var t=null;return this.hideDay?this.minDate&&this.maxDate?t="global.validation.dateOutOfRangeHideDay":this.maxDate?t="global.validation.dateTooYoungHideDay":this.minDate&&(t="global.validation.dateTooOldHideDay"):this.minDate&&this.maxDate?t="global.validation.dateOutOfRange":this.maxDate?t="global.validation.dateTooYoung":this.minDate&&(t="global.validation.dateTooOld"),this.$translate.instant(t,{descriptor:this.dateDescriptor,min:this.minDate,max:this.maxDate})}}]),t}();r.$inject=["$locale","tngSelectAutocompleteConstants","$timeout","$translate","EventBusService","$scope","tngDateSelectorConstants","DateService","$q"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(4977)),a=r(n(4981)),s=r(n(4982));function r(t){return t&&t.__esModule?t:{default:t}}var o=angular.module("tangerine.updateEmailModal.module",[]).component("tngUpdateEmailModal",i.default).service("UpdateEmailModalService",a.default).service("UpdateEmailModalFlowService",s.default);e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4978)),a=s(n(4979));function s(t){return t&&t.__esModule?t:{default:t}}n(4980);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog class="c-update-email-modal" on-close="$ctrl.onModalClose()" flow-service="$ctrl.flowService"> <header> <div ng-if="!$ctrl.flowService.showConfirmExitUI"> {{ $ctrl.flowService.currentState.titleKey | translate }} </div> </header> <div class="c-update-email-modal__error" ng-show="$ctrl.hasSubmitErrors"> <tng-error-message ng-if="$ctrl.hasSubmitErrors"> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> </div> <div class="c-update-email-modal__width60" ng-show="!$ctrl.isLoading" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT && !$ctrl.flowService.showConfirmExitUI"> <p>{{ ::\'userSettings.updateEmailModal.info\' | translate }}</p> <p ng-if="$ctrl.customerInfo.email" ng-bind-html="\'userSettings.updateEmailModal.hasExistingEmail\' | translate: {existingEmail: $ctrl.customerInfo.email}"></p> <form name="$ctrl.updateEmailForm" novalidate="novalidate"> <div class="c-update-email-modal__edit__field top-margin-large" ng-if="$ctrl.cifTypeService.isNormal() || $ctrl.editEmail"> <div class="c-update-email-modal__edit__field__label"> <strong>{{ ::\'userSettings.updateEmailModal.newEmail\' | translate }}</strong> </div> <div class="field"> <input class="input c-update-email-modal__edit__field__input--show-invalid" type="email" name="emailAddress" ng-required="true" ng-model="$ctrl.editEmail.email" ng-change="$ctrl.editEmailCheck()" ng-class="{\'warning\':\n                    ($ctrl.updateEmailForm.emailAddress.$touched) &&\n                    $ctrl.updateEmailForm.emailAddress.$invalid\n                  }" placeholder="{{ ::\'userSettings.updateEmailModal.newEmail\' | translate }}" autocomplete="off"/> <div class="field__error" ng-messages="$ctrl.updateEmailForm.emailAddress.$error" ng-show="($ctrl.updateEmailForm.emailAddress.$touched)"> <p ng-message="required"> {{ ::\'userSettings.general.basicInfo.validation.required\' | translate }} </p> <p ng-message="email"> {{ ::\'userSettings.general.basicInfo.validation.emailFormat\' | translate }} </p> </div> </div> </div> <div class="c-update-email-modal__edit__field"> <div class="c-update-email-modal__edit__field__label"> <strong>{{ ::\'userSettings.updateEmailModal.confirmNewEmail\' | translate }}</strong> </div> <div class="field"> <input class="input" type="email" name="emailAddressConfirm" ng-required="true" ng-model="$ctrl.editEmail.emailConfirm" ng-paste="$event.preventDefault()" ng-change="$ctrl.editEmailCheck()" ng-class="{\'warning\':\n                    ($ctrl.updateEmailForm.emailAddressConfirm.$touched) &&\n                    ($ctrl.updateEmailForm.emailAddressConfirm.$invalid || $ctrl.isEmailAddressConfirmMatch)\n                  }" placeholder="{{ ::\'userSettings.updateEmailModal.confirmNewEmail\' | translate }}" autocomplete="off"/> <div class="field__error" ng-messages="$ctrl.updateEmailForm.emailAddressConfirm.$error" ng-show="($ctrl.updateEmailForm.emailAddress.$touched)"> <p ng-message="required"> {{ ::\'userSettings.general.basicInfo.validation.required\' | translate }} </p> <p ng-message="email"> {{ ::\'userSettings.general.basicInfo.validation.emailFormat\' | translate }} </p> <p ng-if="$ctrl.updateEmailForm.emailAddressConfirm.$valid && $ctrl.isEmailAddressConfirmMatch"> {{ ::\'userSettings.general.basicInfo.validation.emailMatch\' | translate }} </p> </div> </div> </div> </form> </div> <div class="c-update-email-modal__width60" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DONE && !$ctrl.flowService.showConfirmExitUI" ng-show="!$ctrl.isLoading"> <p ng-bind-html="\'userSettings.updateEmailModal.confirmation\' | translate: {newEmail: $ctrl.newEmail}"></p> </div> <div ng-show="$ctrl.isLoading" class="c-update-email-modal__loading-container"> <tng-loading-spinner>{{ :: \'global.pageFlow.loading.isLoading\' | translate }}</tng-loading-spinner> </div> <footer> <tng-page-flow-controls flow-service="$ctrl.flowService"> </tng-page-flow-controls> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c){(0,i.default)(this,t),this.$log=e,this.$q=n,this.$translate=a,this.customerConstants=s,this.modalErrorHandlerService=r,this.updateEmailModalService=o,this.flowService=c}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.flowService.activate(),this.flowService.onButtonClickCancel=function(){t.onModalClose()},this.flowService.onButtonClickDone=function(){t._close()},this.flowService.onButtonClickSave=function(){t.submitEditEmail()},this.resetSubmitErrors(),this.flowService.currentState=this.flowService.STATES.EDIT,this.editEmail={email:"",emailConfirm:""},this.enableSubmit=!1,this._getCustomerInfo()}},{key:"_getCustomerInfo",value:function(){var t=this;this.isLoading=!0,this.$q.all({customerInfo:this.updateEmailModalService.getCustomerInfo()}).then((function(e){t.customerInfo=e.customerInfo,t.isLoading=!1}),(function(){t.isLoading=!1}))}},{key:"editEmailCheck",value:function(){this.updateEmailForm.emailAddress&&this.updateEmailForm.emailAddress.$valid&&this.updateEmailForm.emailAddressConfirm&&this.updateEmailForm.emailAddressConfirm.$valid&&this.editEmail.email===this.editEmail.emailConfirm?(this.isEmailAddressConfirmMatch=!1,this.flowService.BUTTONS.BTN_ORG.disable=!1,this.enableSubmit=!0):(this.flowService.BUTTONS.BTN_ORG.disable=!0,this.enableSubmit=!1,this.isEmailAddressConfirmMatch=!0)}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"_close",value:function(){var t=this;return this.flowService.showConfirmExitUI?(this.flowService.denyExit(),this.$q.resolve()):this.flowService.warn().then((function(){t.onClose&&t.onClose(),t.flowService.resetState()}))}},{key:"onModalClose",value:function(t){this.$log.debug("moveMoney onModalClose:",t),this.flowService.currentState!==this.flowService.STATES.EDIT||this.updateEmailForm.emailAddress.$touched||this.updateEmailForm.emailAddressConfirm.$touched||0!==this.editEmail.email.length||0!==this.editEmail.emailConfirm.length?this.flowService.currentState===this.flowService.STATES.DONE?this.flowService.hideWarningOnExit():this.flowService.showWarningOnExit():this.flowService.hideWarningOnExit(),this.resetSubmitErrors(),this._close()}},{key:"resetSubmitErrors",value:function(){this.$log.debug("resetting submit errors"),this.submitErrors=[]}},{key:"submitEditEmail",value:function(){var t=this;if(this.enableSubmit){var e={customer:{email:this.editEmail.email,is_email_update_only:!0}};this.isLoading=!0,this.updateEmailModalService.editCustomerInfo(e).then((function(e){if(t.$log.debug("PUT Customer Info response: ",e),t.isLoading=!1,e.response_status.status_code===t.customerConstants.API.RESPONSE_CODES.SUCCESS)t.newEmail=t.editEmail.email,t.resetSubmitErrors(),t.flowService.gotoNextState();else if(e.response_status.status_code===t.customerConstants.API.RESPONSE_CODES.VALIDATION_ERROR){var n=t.$translate.instant("global.errorCodes.INVEMAIL");t.submitErrors.push(n)}else t.modalErrorHandlerService.showSubmitErrors(e),t.modalErrorHandlerService.submitErrors&&t.modalErrorHandlerService.submitErrors.length>0&&(t.submitErrors=t.modalErrorHandlerService.submitErrors)}))}}},{key:"hasSubmitErrors",get:function(){return this.submitErrors&&this.submitErrors.length>0}}]),t}();r.$inject=["$log","$q","$translate","customerConstants","ModalErrorHandlerService","UpdateEmailModalService","UpdateEmailModalFlowService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.$log=e,this.customersService=n}return(0,a.default)(t,[{key:"getCustomerInfo",value:function(){var t=this;return this.customersService.getCustomerInfo({include_servicing_systems:!0}).then((function(e){return t.$log.debug("GET Customers Info response: ",e),e.customer})).catch((function(e){t.$log.error(e)}))}},{key:"editCustomerInfo",value:function(t){return this.customersService.putCustomerInfo(t)}}]),t}();r.$inject=["$log","CustomersService"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(177)),a=d(n(0)),s=d(n(2)),r=d(n(264)),o=d(n(266)),c=d(n(265)),l=d(n(267)),u=n(364);function d(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(t,n,s,o,c,l,d,h){(0,a.default)(this,e);var f=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,d,l,h));return f.BUTTON_TYPES=l.BUTTON_TYPES,f.$log=t,f.STATES={EDIT:{titleKey:"userSettings.updateEmailModal.header.edit"},DONE:{titleKey:"userSettings.updateEmailModal.header.done"}},f.BUTTONS={BTN_GRY:new u.ModalFooterButton(f.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new u.ModalFooterButton(f.BUTTON_TYPES.SAVE,!0,!0)},f}return(0,c.default)(e,t),(0,s.default)(e,[{key:"gotoNextState",value:function(){var t=this.currentState,e=this.STATES;switch(t){case e.EDIT:this.moveTo(e.DONE),this.hideWarningOnExit();break;default:this.$log.error("bad state")}}},{key:"_updateUI",value:function(){switch(this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_GRY.disable=!1,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!0,this.currentState){case this.STATES.EDIT:this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.SAVE,this.BUTTONS.BTN_GRY.show=!0;break;case this.STATES.DONE:this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.DONE,this.BUTTONS.BTN_ORG.disable=!1,this.BUTTONS.BTN_GRY.show=!1}}},{key:"resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.BUTTONS={BTN_GRY:new u.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new u.ModalFooterButton(this.BUTTON_TYPES.SAVE,!0,!0)}}}]),e}(l.default);h.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","$rootScope","AnalyticsService"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(4984)),a=c(n(4988)),s=c(n(4989)),r=c(n(4990)),o=c(n(4991));function c(t){return t&&t.__esModule?t:{default:t}}var l=angular.module("tangerine.mortgageRenewalModal.module",[]).component("tngMortgageRenewalModal",i.default).service("MortgageRenewalModalService",a.default).service("MortgageRenewalModalFlowService",s.default).constant("MortgageRenewalModalConstants",r.default).directive("rateInput",o.default);e.default=l,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4985)),a=s(n(4986));function s(t){return t&&t.__esModule?t:{default:t}}n(4987);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.closeModal(result)" class="c-mortgage-renewal-modal" hide-close="$ctrl.flowService.inLoadingMode" flow-service="$ctrl.flowService"> <header> <span ng-show="!$ctrl.flowService.showConfirmExitUI">{{ $ctrl.flowService.currentState.titleKey | translate }}</span> </header> <div class="c-mortgage-renewal-modal__error" ng-show="$ctrl.hasSubmitErrors"> <tng-error-message ng-if="$ctrl.hasSubmitErrors"> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> </div> <form name="$ctrl.form" novalidate ng-if="!$ctrl.flowService.showConfirmExitUI && $ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT"> <div>{{ ::\'mortgage.renewalModal.subHeader\' | translate }}</div> <div class="c-mortgage-renewal-modal__content"> <div class="field"> <label>{{ ::\'mortgage.renewalModal.financialInstitutions\' | translate }}</label> <tng-select-autocomplete input-id="select-mortgage" simple-filtered="true" ng-required="true" on-select="$ctrl.onInputChange()" ng-model="$ctrl.data.selectedFinancialInstitution" options="$ctrl.availableFinancialInstitutions" option-label-key="name" option-value-key="code" autocomplete="\'off\'" show-warning-border="$ctrl.isFiInvalid && $ctrl.showValidation" show-default-warnings="$ctrl.isFiInvalid && $ctrl.showValidation" placeholder="{{ ::\'mortgage.renewalModal.placeholder.financialInstitutions\' | translate }}"></tng-select-autocomplete> <div class="field__error" ng-show="$ctrl.isFiInvalid && $ctrl.showValidation" aria-hidden="false" style=""> {{ ::\'global.validation.required\' | translate }} </div> </div> <div class="field_group_of_2"> <div class="field"> <label for="_simple">{{ ::\'mortgage.renewalModal.outstandingMortgageAmount\' | translate }}</label> <input id="mortgage_renewal_modal_outstandingMortgageAmount" type="tel" class="input" autocomplete="off" ng-change="$ctrl.onInputChange()" ng-model="$ctrl.data.outstandingMortgageAmount" amount-input currency-symbol="$" decimals="2" ng-required="true" ng-class="{\'invalid\': $ctrl.isMortgageAmountInvalid && $ctrl.showValidation}" maxlength="15" placeholder="{{ ::\'mortgage.renewalModal.placeholder.outstandingMortgageAmount\' | translate }}"> <div class="field__error" ng-show="$ctrl.isMortgageAmountInvalid && $ctrl.showValidation" aria-hidden="false" style=""> {{ ::\'global.validation.required\' | translate }} </div> </div> <div class="field"> <label for="mortgage_renewal_modal_currentInterestRate">{{ ::\'mortgage.renewalModal.currentInterestRate\' | translate }}</label> <input id="mortgage_renewal_modal_currentInterestRate" type="tel" class="input" autocomplete="off" ng-change="$ctrl.onInputChange()" ng-model="$ctrl.data.currentInterestRate" rate-input ratesymbol="%" decimals="2" ng-required="true" ng-class="{\'invalid\': $ctrl.isCurrentRateInvalid && $ctrl.showValidation}" maxlength="6" placeholder="{{ ::\'mortgage.renewalModal.placeholder.currentInterestRate\' | translate }}"> <div class="field__error" ng-show="$ctrl.isCurrentRateInvalid && $ctrl.showValidation" aria-hidden="false" style=""> {{ ::\'global.validation.required\' | translate }} </div> </div> </div> <div class="field"> <label actionable-id="maturityDate" class="top-margin-large heading--sub3 c-basic-info-form__new-client__edit-label__label"> {{ ::\'mortgage.renewalModal.maturityDate\' | translate }} </label> <tng-date-input input-id="maturityDate" is-date-of-birth="false" date-model="$ctrl.data.maturityDate" on-change="$ctrl.onMaturityDateChange(isValid)" min-date="$ctrl.yesterday" show-validation-on-load="$ctrl.showValidation" is-required="true" is-disabled="false"></tng-date-input> </div> <div ng-if="false"> <div class="terms-and-conditions-container" ng-bind-html="\'mortgage.renewalModal.termsAndConditions\' | translate"> </div> <div class="drop-down-title" ng-click="$ctrl.showDropDownContent = !$ctrl.showDropDownContent"> {{ ::\'mortgage.renewalModal.dropDownTitle\' | translate }} <span ng-class="$ctrl.showDropDownContent ? \'icon-uparrow\' : \'icon-downarrow\'"> </span> </div> <div ng-show="$ctrl.showDropDownContent" class="drop-down-content"> {{ ::\'mortgage.renewalModal.dropDownContent\' | translate }} </div> </div> </div> </form> <div ng-if="!$ctrl.flowService.showConfirmExitUI && $ctrl.flowService.currentState === $ctrl.flowService.STATES.DONE" class="done-message"> {{ ::\'mortgage.renewalModal.thankYouMessage\' | translate }} <br/> <br/> {{ ::\'mortgage.renewalModal.enteredCompetitionMessage\' | translate }} </div> <div ng-show="$ctrl.flowService.inLoadingMode" class="c-mortgage-renewal-modal__loading-container"> <tng-loading-spinner>{{ :: \'global.pageFlow.loading.isLoading\' | translate }}</tng-loading-spinner> </div> <footer> <tng-page-flow-controls flow-service="$ctrl.flowService"> </tng-page-flow-controls> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=r(n(45));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.$q=n,this.mortgageRenewalModalService=s,this.flowService=r,this.INSTITUTIONS=o.INSTITUTIONS,this.availableFinancialInstitutions=[],this.YESTERDAY_IN_EST=a.YESTERDAY_IN_EST,this.yesterday=this.YESTERDAY_IN_EST.clone(),this.isFiInvalid=!1,this.isMortgageAmountInvalid=!1,this.isMaturityDateInvalid=!1,this.showDropDownContent=!1}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.flowService.activate(),this.flowService.onButtonClickCancel=function(){t.closeModal()},this.flowService.onButtonClickDone=function(){t.closeModal()},this.flowService.onButtonClickSubmit=function(){t._submit()},this.flowService.currentState=this.flowService.STATES.EDIT,this.flowService.hideWarningOnExit(),this.getInstitutionOptions(),this.data={selectedFinancialInstitution:null,outstandingMortgageAmount:null,maturityDate:null,currentInterestRate:null}}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"getInstitutionOptions",value:function(){var t=this;this.mortgageRenewalModalService.getFinancialInstitutions().then((function(e){t.availableFinancialInstitutions=e.financial_institutions.filter((function(e){return-1!==t.INSTITUTIONS.indexOf(e.code)}))})).catch((function(e){t.$log.error("GET FINANCIAL INSTITUTIONS ERROR: ",e)}))}},{key:"closeModal",value:function(){var t=this;return this.flowService.showConfirmExitUI?(this.flowService.denyExit(),this.$q.resolve()):this.flowService.warn().then((function(){t.onClose&&t.onClose(),t.flowService.resetState()}))}},{key:"onInputChange",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=!1,this.form.$dirty&&this.flowService.showWarningOnExit(),this.isFiInvalid=!this.data.selectedFinancialInstitution,this.isMortgageAmountInvalid=!this.data.outstandingMortgageAmount||"0"===this.data.outstandingMortgageAmount,this.isValid=!this.isMortgageAmountInvalid&&!this.isMaturityDateInvalid&&!this.isFiInvalid}},{key:"_submit",value:function(){var t=this;if(this.isValid){var e=(0,s.default)(this.data.maturityDate).format("YYYY-MM-DD"),n=null;"string"==typeof this.data.currentInterestRate&&"0"!==this.data.currentInterestRate&&(n=this.data.currentInterestRate);var i={data:{mortgage_details:[{financial_institution:this.data.selectedFinancialInstitution,current_balance:Number(this.data.outstandingMortgageAmount),maturity_date:e,interest_rate:n}]}};this.mortgageRenewalModalService.putMortgageRenewalInfo(i).then((function(){t.flowService.gotoNextState()})).catch((function(e){t.$log.error("PUT MORTGAGE RENEWAL INFO ERROR: ",e)}))}else this.showValidation=!0}},{key:"onMaturityDateChange",value:function(t){this.isMaturityDateInvalid=!t,this.onInputChange()}}]),t}();o.$inject=["$log","$q","tngDateSelectorConstants","MortgageRenewalModalService","MortgageRenewalModalFlowService","MortgageRenewalModalConstants"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$q=e,this.$log=n,this.RequesterService=a,this.AVAILABLE_SERVICES=s.AVAILABLE_SERVICES,this.STATUS_CODES=s.STATUS_CODES,this.referenceDataService=r,this.referenceDataConstants=o}return(0,a.default)(t,[{key:"getFinancialInstitutions",value:function(){return this.referenceDataService.getDataByType(this.referenceDataConstants.TYPES.FINANCIAL_INSTITUTIONS)}},{key:"putMortgageRenewalInfo",value:function(t){var e=this.$q.defer(),n=[this.STATUS_CODES.SUCCESS];return this.RequesterService.request(this.AVAILABLE_SERVICES.PUT_MORTGAGE_INFO,t).then((function(t){-1!==n.indexOf(t.response_status.status_code)?e.resolve(t):e.reject(t)})).catch((function(t){e.reject(t)})),e.promise}}]),t}();r.$inject=["$q","$log","RequesterService","serviceConstants","ReferenceDataService","referenceDataConstants"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(177)),a=d(n(0)),s=d(n(2)),r=d(n(264)),o=d(n(266)),c=d(n(265)),l=d(n(267)),u=n(364);function d(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(t,n,s,o,c,l,d,h){(0,a.default)(this,e);var f=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,d,l,h));return f.BUTTON_TYPES=l.BUTTON_TYPES,f.$log=t,f.STATES={EDIT:{titleKey:"mortgage.renewalModal.header"},DONE:{titleKey:"mortgage.renewalModal.allDone"}},f.BUTTONS={BTN_GRY:new u.ModalFooterButton(f.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new u.ModalFooterButton(f.BUTTON_TYPES.SUBMIT,!0,!1)},f}return(0,c.default)(e,t),(0,s.default)(e,[{key:"gotoNextState",value:function(){var t=this.currentState,e=this.STATES;switch(t){case e.EDIT:this.moveTo(e.DONE),this.hideWarningOnExit();break;default:this.$log.error("bad state")}}},{key:"_updateUI",value:function(){switch(this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_GRY.disable=!1,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!1,this.currentState){case this.STATES.EDIT:this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.SUBMIT,this.BUTTONS.BTN_GRY.show=!0;break;case this.STATES.DONE:this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.DONE,this.BUTTONS.BTN_ORG.disable=!1,this.BUTTONS.BTN_GRY.show=!1}}},{key:"resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.BUTTONS={BTN_GRY:new u.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new u.ModalFooterButton(this.BUTTON_TYPES.SUBMIT,!0,!0)}}}]),e}(l.default);h.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","$rootScope","AnalyticsService"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={INSTITUTIONS:["003","004","010","001","002","XXX"]};e.default=i,t.exports=e.default},function(t,e,n){"use strict";(function(i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var a=n(1988);function s(t,e,n){return{require:"^ngModel",link:function(t,s,r,o){var c=r.rateSymbol||"%",l=void 0;function u(t){return o.$isEmpty(t)?t:(e("number")(t,r.decimals)+c).trim()}l=new a.CaretPositioningHelper(s,n,(function(t){return(t||l.inputValue).split("").map((function(t){return i.isNumeric(t)}))}),!1),t.$on("$destroy",(function(){return l.$onDestroy()})),o.$formatters.unshift(u),o.$parsers.unshift((function(t){if(o.$isEmpty(t))return t;var e=t.toString().replace(/[^\d]+/g,"").replace(/^[0]+([1-9])/,"$1")||"0",n=Number(e)/Math.pow(10,r.decimals),i=u(n);return t!==i&&(o.$setViewValue(i),o.$render()),n.toString()}))}}}s.$inject=["$locale","$filter","$log"],t.exports=e.default}).call(this,n(93))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(4993)),a=c(n(4997)),s=c(n(4998)),r=c(n(2190)),o=c(n(1902));function c(t){return t&&t.__esModule?t:{default:t}}var l=angular.module("tangerine.makeInitialDepositModal.module",[r.default.name]).constant("MakeInitialDepositModalConstants",a.default).service("AddExternalAccountFlowService",o.default).service("MakeInitialDepositModalFlow",s.default).component("tngMakeInitialDepositModal",i.default);e.default=l,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(4994)),a=s(n(4995));function s(t){return t&&t.__esModule?t:{default:t}}n(4996);var r={template:i.default,controller:a.default,bindings:{accountHash:"<",onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog class="c-make-initial-deposit-modal" on-close="$ctrl.onClose()"> <header> <div ng-if="!$ctrl.flowService.showConfirmExitUI"> {{ ::\'depositMoney.modal.makeInitialDeposit.title\' | translate }} </div> </header> <div class="make-initial-deposit-content"> <section> <p ng-bind-html="\'depositMoney.modal.makeInitialDeposit.subTitle\' | translate"></p> </section> <section> <div class="c-enrollment-confirmation__tiles"> <tng-tile-list all-actionable="true" tile-data="$ctrl.nextStepsTiles" on-tile-click="$ctrl.onTileClick(index, tileData)" tile-type="$ctrl.TILE_TYPE.text"> </tng-tile-list> </div> </section> <section> <br/> <p ng-bind-html="\'depositMoney.modal.makeInitialDeposit.info\' | translate"></p> <p ng-bind-html="\'depositMoney.modal.makeInitialDeposit.note\' | translate | absoluteHref"></p> </section> </div> <footer> <button actionable-id="fund-account-btn-edit" class="btn btn--large btn--edit" ng-click="$ctrl.onClose()"> {{ \'depositMoney.modal.makeInitialDeposit.cancel\' | translate }} </button> </footer> </tng-modal-dialog> <tng-email-money ng-if="$ctrl.currentState === $ctrl.STATES.EMAIL_MONEY" on-close="$ctrl.onCloseEmailMoney()" on-back="$ctrl.gotoPreviousState()" on-done="$ctrl.onDoneEmailMoney()" process-list="$ctrl.processListEmailMoney" lang="$ctrl.shortHandLocale"></tng-email-money> <tng-photo-cheque-deposit ng-if="$ctrl.currentState === $ctrl.STATES.PHOTO_CHEQUE_DEPOSIT" on-close="$ctrl.onClosePhotoChequeDeposit()" on-back="$ctrl.gotoPreviousState()" on-done="$ctrl.onDonePhotoChequeDeposit()" process-list="$ctrl.processListPhotoDeposit" lang="$ctrl.shortHandLocale"></tng-photo-cheque-deposit> <tng-remote-deposit-capture ng-if="$ctrl.currentState === $ctrl.STATES.PHOTO_CHEQUE_DEPOSIT_NATIVE" on-close="$ctrl.onClosePhotoChequeDepositNative(result)" account="$ctrl.account" register-flow="$ctrl.setSubFlow(subFlow)"></tng-remote-deposit-capture> <tng-add-external-account-modal ng-if="$ctrl.currentState === $ctrl.STATES.LINK_EXTERNAL_ACCOUNT" on-close="$ctrl.onCloseAddExternalAccount()"></tng-add-external-account-modal> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(270)),a=o(n(92)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,a,r){(0,s.default)(this,t),this.TILE_TYPE=e.TILE_TYPE,this.AccountService=i,this.shortHandLocale=n.localeDisplay.toLowerCase(),this.makeInitialDepositConstants=a,this.STATES=a.STATES,this.processListEmailMoney=a.PROCESS_LIST_EMAIL_MONEY,this.processListPhotoDeposit=a.PROCESS_LIST_PHOTO_DEPOSIT,this.flowService=r}return(0,r.default)(t,[{key:"$onInit",value:function(){this.flowService.activate(),this._getAccountFromHash(this.accountHash),this.flowService.transaction=(0,a.default)({},this.transaction,this.flowService.transaction),this.nextStepsTiles=[this.makeInitialDepositConstants.NEXT_STEP_TILES.EMAIL_MONEY,this.makeInitialDepositConstants.NEXT_STEP_TILES.PHOTO_CHEQUE_DEPOSIT,this.makeInitialDepositConstants.NEXT_STEP_TILES.LINK_EXTERNAL_ACCOUNT],this.processListEmailMoney=this._copyProcessList(this.processListEmailMoney),this.processListPhotoDeposit=this._copyProcessList(this.processListPhotoDeposit)}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"onTileClick",value:function(t,e){this.flowService.transaction.fundAccount.nextState=this.isNative&&e.state===this.STATES.PHOTO_CHEQUE_DEPOSIT?this.STATES.PHOTO_CHEQUE_DEPOSIT_NATIVE:e.state,this.flowService.gotoNextState()}},{key:"onCloseEmailMoney",value:function(){this.gotoPreviousState()}},{key:"onDoneEmailMoney",value:function(){this.gotoPreviousState()}},{key:"onClosePhotoChequeDeposit",value:function(){this.gotoPreviousState()}},{key:"onClosePhotoChequeDepositNative",value:function(){this.gotoPreviousState()}},{key:"onCloseAddExternalAccount",value:function(){this.gotoPreviousState()}},{key:"onDonePhotoChequeDeposit",value:function(){this.gotoPreviousState()}},{key:"gotoPreviousState",value:function(){return this.flowService.gotoPreviousState()}},{key:"setSubFlow",value:function(t){return this.flowService.setSubFlow(t)}},{key:"_getAccountFromHash",value:function(t){var e=this;return this.AccountService.getGenericAccountDetails(t).then((function(t){e.account=t.account_summary,e.accountName=e.account.description||e.account.product_description}))}},{key:"_close",value:function(){angular.isFunction(this.onClose)&&this.onClose()}},{key:"_copyProcessList",value:function(t){var e={};return(0,i.default)(t).forEach((function(t){t[0]&&t[1].LABEL&&(e[t[0]]=t[1])})),e}},{key:"currentState",get:function(){return this.flowService.currentState}}]),t}();c.$inject=["tngTileListConstants","LocaleService","AccountService","MakeInitialDepositModalConstants","MakeInitialDepositModalFlow"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=e.STATES={MAKE_INITIAL_DEPOSIT:{name:"makeInitialDeposit"},EMAIL_MONEY:{name:"emailMoney"},PHOTO_CHEQUE_DEPOSIT:{name:"photoChequeDeposit"},PHOTO_CHEQUE_DEPOSIT_NATIVE:{name:"photoChequeDepositNative"},LINK_EXTERNAL_ACCOUNT:{name:"linkExternalAccount"}},a={EMAIL_MONEY:{header:"depositMoney.modal.makeInitialDeposit.tiles.emailMoney.header",subHeader:"depositMoney.modal.makeInitialDeposit.tiles.emailMoney.subHeader",state:i.EMAIL_MONEY},PHOTO_CHEQUE_DEPOSIT:{header:"depositMoney.modal.makeInitialDeposit.tiles.photoChequeDeposit.header",subHeader:"depositMoney.modal.makeInitialDeposit.tiles.photoChequeDeposit.subHeader",state:i.PHOTO_CHEQUE_DEPOSIT},LINK_EXTERNAL_ACCOUNT:{header:"depositMoney.modal.makeInitialDeposit.tiles.linkExternalAccount.header",subHeader:"depositMoney.modal.makeInitialDeposit.tiles.linkExternalAccount.subHeader",state:i.LINK_EXTERNAL_ACCOUNT}},s=e.PROCESS_LIST_EMAIL_MONEY={E_TRANSFER_FUNCTION:{LABEL:"depositMoney.modal.emailMoney.processList.eTransferFunction"},ENTER_AMOUNT:{LABEL:"depositMoney.modal.emailMoney.processList.enterAmount"},RECEIVE_EMAIL:{LABEL:"depositMoney.modal.emailMoney.processList.receiveEmail"}},r=e.PROCESS_LIST_PHOTO_DEPOSIT={DOWNLOAD_APP:{LABEL:"depositMoney.modal.photoChequeDeposit.processList.downloadApp"},LOGIN_TO_ACCOUNT:{LABEL:"depositMoney.modal.photoChequeDeposit.processList.loginToAccount"},FOLLOW_INSTRUCTIONS:{LABEL:"depositMoney.modal.photoChequeDeposit.processList.followInstructions"}};e.default={STATES:i,NEXT_STEP_TILES:a,PROCESS_LIST_EMAIL_MONEY:s,PROCESS_LIST_PHOTO_DEPOSIT:r}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(92)),a=d(n(177)),s=d(n(0)),r=d(n(2)),o=d(n(264)),c=d(n(266)),l=d(n(265)),u=n(267);function d(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(t,n,i,r,c,l,u,d,h){(0,s.default)(this,e);var f=(0,o.default)(this,(e.__proto__||(0,a.default)(e)).call(this,t,n,i,r,c,l,u,h));return f.$log=t,f.BUTTON_TYPES=u.BUTTON_TYPES,f.isNative=d.isNative(),f.STATES={MAKE_INITIAL_DEPOSIT:{name:"makeInitialDeposit"},EMAIL_MONEY:{name:"emailMoney"},PHOTO_CHEQUE_DEPOSIT:{name:"photoChequeDeposit"},PHOTO_CHEQUE_DEPOSIT_NATIVE:{name:"photoChequeDepositNative"},LINK_EXTERNAL_ACCOUNT:{name:"linkExternalAccount"}},f}return(0,l.default)(e,t),(0,r.default)(e,[{key:"gotoNextState",value:function(){switch(this.currentState){case this.STATES.MAKE_INITIAL_DEPOSIT:this.transaction.fundAccount&&this.transaction.fundAccount.nextState&&this.moveTo(this.transaction.fundAccount.nextState);break;case this.STATES.EMAIL_MONEY:case this.STATES.PHOTO_CHEQUE_DEPOSIT:case this.STATES.LINK_EXTERNAL_ACCOUNT:this.moveTo(this.STATES.MAKE_INITIAL_DEPOSIT)}}},{key:"returnToStart",value:function(){this._resetState()}},{key:"_resetState",value:function(){(0,c.default)(e.prototype.__proto__||(0,a.default)(e.prototype),"_resetState",this).call(this),this.currentState=this.STATES.MAKE_INITIAL_DEPOSIT,this.transaction={fundAccount:{}},this.BUTTONS={BTN_GRY:new u.PageFlowButton(this.BUTTON_TYPES.BACK,!0,!0)}}},{key:"_updateUI",value:function(){this.BUTTONS={BTN_GRY:new u.PageFlowButton(this.BUTTON_TYPES.BACK,!0,!0),BTN_ORG:new u.PageFlowButton(this.BUTTON_TYPES.CANCEL,!1,!0)}}},{key:"_subFlowIsDone",value:function(t){this.transaction=(0,i.default)({},t),(0,c.default)(e.prototype.__proto__||(0,a.default)(e.prototype),"_subFlowIsDone",this).call(this,this.transaction)}}]),e}(d(u).default);h.$inject=["$log","$q","$transitions","$state","$window","$rootScope","pageFlowConstants","EnvironmentService","AnalyticsService"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5e3)),a=s(n(5001));function s(t){return t&&t.__esModule?t:{default:t}}n(5002);var r={controller:a.default,template:i.default,bindings:{buttons:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-action-buttons-mobile" ng-if="$ctrl.primaryButton"> <button class="c-action-buttons-mobile__button btn btn--medium c-action-buttons-mobile__primary" ng-class="{ \'c-action-buttons-mobile__one-button\' : $ctrl.noSecondaryButtons }" ng-disabled="!!$ctrl.primaryButton.disabled" tng-click="$ctrl.primaryButton.onSuccess()" level2-auth="{{!!$ctrl.primaryButton.level2authRequired}}"> {{$ctrl.primaryButton.modalSuccessText}} </button> <button class="c-action-buttons-mobile__button btn btn--medium btn--edit c-action-buttons-mobile__more" ng-if="!$ctrl.secondaryButton && !$ctrl.noSecondaryButtons" ng-click="$ctrl.showMoreOptions()"> {{ \'actionButtonsMobile.moreActions\' | translate }} </button> <button class="c-action-buttons-mobile__button btn btn--medium btn--edit c-action-buttons-mobile__more" ng-if="$ctrl.secondaryButton" ng-disabled="!!$ctrl.secondaryButton.disabled" tng-click="$ctrl.secondaryButton.onSuccess()" level2-auth="{{!!$ctrl.secondaryButton.level2authRequired}}"> {{$ctrl.secondaryButton.modalSuccessText}} </button> </div> <tng-modal-confirmation ng-if="$ctrl.showMoreOptionModal" modal-title="{{\'actionButtonsMobile.moreActions\' | translate }}" modal-description="{{ \'actionButtonsMobile.description\' | translate }}" modal-cancel-text="{{ \'actionButtonsMobile.cancel\' | translate }}" success-button-array="$ctrl.moreActionButtons" on-cancel="$ctrl.dismissMoreOptions()" on-action-executed="$ctrl.dismissMoreOptions()"> </tng-modal-confirmation>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(){(0,i.default)(this,t)}return(0,a.default)(t,[{key:"$onInit",value:function(){this._reset(),this.moreActionButtons=angular.copy(this.buttons),this.moreActionButtons&&this.moreActionButtons.length>0&&this._setButtons()}},{key:"$onChanges",value:function(){this.$onInit()}},{key:"dismissMoreOptions",value:function(){this.showMoreOptionModal=!1}},{key:"showMoreOptions",value:function(){this.showMoreOptionModal=!0}},{key:"_reset",value:function(){this.primaryButton=null,this.moreActionButtons=[],this.noSecondaryButtons=!1,this.secondaryButton=null}},{key:"_setButtons",value:function(){switch(this.primaryButton=this.moreActionButtons.shift(),this.moreActionButtons.length){case 0:this.noSecondaryButtons=!0;break;case 1:this.secondaryButton=this.moreActionButtons[0]}}}]),t}();r.$inject=[],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5004)),a=s(n(5005));function s(t){return t&&t.__esModule?t:{default:t}}n(5006);var r={template:i.default,controller:a.default,transclude:{header:"?dropDownTileHeader",subHeader:"?dropDownTileSubHeader",content:"?dropDownTileContent"},bindings:{isExpanded:"<?",isTextOverflow:"<?",onClickChevron:"&?",hideContent:"<?",tileName:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-drop-down-tile"> <button class="unstyled c-drop-down-tile__header" ng-click="$ctrl.onChevronClicked()" id="{{ $ctrl.tileName+\'-tile\' }}" aria-expanded="{{ $ctrl.isExpanded }}"> <div ng-class="{\'c-drop-down-tile__header-content-ellipsis\': $ctrl.isTextOverflow && !$ctrl.isExpanded}" class="c-drop-down-tile__header-content" ng-transclude="header"></div> <span ng-class="$ctrl.isExpanded ? \'icon-uparrow\' : \'icon-downarrow\'" class="arrow" aria-hidden="true"></span> </button> <div ng-if="$ctrl.$transclude.isSlotFilled(\'subHeader\')" class="c-drop-down-tile__sub-header-content" ng-transclude="subHeader"> </div> <div ng-class="{\'c-drop-down-tile__hide-content\': $ctrl.hideContent}" class="c-drop-down-tile__content" ng-transclude="content" ng-show="$ctrl.isExpanded"> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.$transclude=e}return(0,a.default)(t,[{key:"$onInit",value:function(){this.isExpanded=!!this.isExpanded&&this.isExpanded}},{key:"onChevronClicked",value:function(){this.isExpanded=!this.isExpanded,"function"==typeof this.onClickChevron&&this.onClickChevron()}}]),t}();r.$inject=["$transclude"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5008)),a=s(n(5009));function s(t){return t&&t.__esModule?t:{default:t}}n(5010);var r={template:a.default,controller:i.default,bindings:{nextState:"<?",nextParams:"<?",onClose:"&",mortgageDealId:"<?"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.$log=e,this.$state=n,this.stateConstants=a}return(0,a.default)(t,[{key:"seeInstructions",value:function(){this.$state.go(this.stateConstants.KYC,{nextState:this.nextState,nextParams:this.nextParams}),this.onClose()}},{key:"onNext",value:function(){this.mortgageDealId&&this.$state.go(this.stateConstants.MORTGAGE_TRACKER,{dealId:this.mortgageDealId}),this.onClose()}}]),t}();r.$inject=["$log","$state","stateConstants"],e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose()" class="c-kyc-roadblock-modal"> <div class="c-kyc-roadblock-modal__container"> <div class="icon--warning"> <span class="icon-warning"></span> </div> <div class="c-kyc-roadblock-modal__header c-kyc-roadblock-modal__text-center"> {{::\'kyc.roadblockModal.header\' | translate }} </div> <div class="c-kyc-roadblock-modal__msg c-kyc-roadblock-modal__text-center"> {{::\'kyc.roadblockModal.message\' | translate }} </div> </div> <footer> <button class="btn btn--edit" ng-click="$ctrl.seeInstructions()">{{::\'kyc.roadblockModal.seeInstructions\' | translate }}</button> <button class="btn btn--next" ng-click="$ctrl.onNext()">{{::\'kyc.roadblockModal.gotIt\' | translate }}</button> </footer> </tng-modal-dialog>'},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(5012)),a=c(n(5016)),s=c(n(5019)),r=c(n(5021)),o=c(n(5023));function c(t){return t&&t.__esModule?t:{default:t}}var l=angular.module("tangerine.app.core.components.mortgageApplicationInfoTile",[]).component("tngMortgageApplicationInfoTileAppType",r.default).component("tngMortgageApplicationInfoTileAmortizationPeriod",s.default).component("tngMortgageApplicationInfoTilePaymentDetails",o.default).component("tngMortgageApplicationInfoTileClosingDate",a.default).component("tngMortgageApplicationInfoTile",i.default);e.default=l,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5013)),a=s(n(5014));function s(t){return t&&t.__esModule?t:{default:t}}n(5015);var r={template:i.default,controller:a.default,bindings:{account:"<",disclaimer:"@?",referenceNumber:"<",showClosingDateProgress:"<",transactionType:"<",propertyAddress:"<",mortgageAmount:"<",interestRate:"<",closingDate:"<",submitDate:"<?",termDisplay:"<",hideClosingDate:"<?",paymentDetails:"<?",amortizationPeriod:"<?",hasHeloc:"<?",helocLimit:"<?",helocInterestRate:"<?",isJoint:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-mortgage-application-info-tile"> <div ng-if="$ctrl.isHelocOnly" class="info-panel grid__container"> <div class="info-panel__row"> <div class="info-panel__column first-row grid__column--1of2"> <span><strong>{{ ::\'mortgage.confirmation.property\' | translate }}</strong></span> <span><strong class="medium tangerine" ng-bind-html="$ctrl.propertyAddress"></strong></span> </div> <div class="info-panel__column first-row grid__column--1of2 has-no-borders"> <span><strong>{{ ::\'mortgage.confirmation.referenceNumber\' | translate }}</strong></span> <strong class="medium tangerine">{{ $ctrl.referenceNumber }}</strong> </div> </div> <div class="info-panel__row"> <div class="info-panel__column grid__column--1of2"> <div><strong>{{ :: \'mortgage.confirmation.heloc.limit\' | translate }}</strong></div> <div><strong class="large tangerine">{{ $ctrl.helocLimit | currency}}</strong></div> </div> <div class="info-panel__column grid__column--1of2"> <div><strong>{{ :: \'mortgage.confirmation.heloc.interestRate\' | translate }}</strong></div> <div><strong class="large tangerine" ng-bind-html="$ctrl.helocInterestRate | numberPercentage"></strong></div> </div> </div> <div class="info-panel__row"> <div class="info-panel__column grid__column--1of2"> <tng-mortgage-application-info-tile-app-type is-joint="$ctrl.isJoint"></tng-mortgage-application-info-tile-app-type> </div> <div ng-if="!$ctrl.hideClosingDate" class="info-panel__column grid__column--1of2"> <tng-mortgage-application-info-tile-closing-date show-closing-date-progress="$ctrl.showClosingDateProgress" closing-date="$ctrl.closingDate" submit-date="$ctrl.submitDate"> </tng-mortgage-application-info-tile-closing-date> </div> </div> </div> <div ng-if="$ctrl.isMortgageAndHeloc" class="info-panel grid__container"> <div class="info-panel__row"> <div class="info-panel__column first-row grid__column--1of2"> <span><strong>{{ ::\'mortgage.confirmation.property\' | translate }}</strong></span> <span><strong class="medium tangerine" ng-bind-html="$ctrl.propertyAddress"></strong></span> </div> <div class="info-panel__column first-row grid__column--1of2 has-no-borders"> <span><strong>{{ ::\'mortgage.confirmation.referenceNumber\' | translate }}</strong></span> <strong class="medium tangerine">{{ $ctrl.referenceNumber }}</strong> </div> </div> <div class="info-panel__row"> <div class="info-panel__column grid__column--1of2"> <div><strong>{{ :: \'mortgage.confirmation.mortgageAmount\' | translate }}</strong></div> <div><strong class="large tangerine">{{ $ctrl.mortgageAmount | currency}}</strong></div> </div> <div class="info-panel__column grid__column--1of2"> <div><strong>{{ :: \'mortgage.confirmation.yourInterestRate\' | translate }}</strong></div> <div><strong class="large tangerine" ng-bind-html="$ctrl.interestRate | numberPercentage"></strong></div> </div> </div> <div class="info-panel__row"> <div class="info-panel__column grid__column--1of2"> <div><strong>{{ :: \'mortgage.confirmation.term\' | translate }}</strong></div> <div><strong class="large tangerine">{{ $ctrl.termDisplay }}</strong></div> </div> <div ng-if="!$ctrl.hideClosingDate" class="info-panel__column grid__column--1of2"> <tng-mortgage-application-info-tile-closing-date show-closing-date-progress="$ctrl.showClosingDateProgress" closing-date="$ctrl.closingDate" submit-date="$ctrl.submitDate"> </tng-mortgage-application-info-tile-closing-date> </div> <div ng-if="$ctrl.showPaymentDetails" class="info-panel__column grid__column--1of2"> <tng-mortgage-application-info-tile-payment-details payment-details="$ctrl.paymentDetails"> </tng-mortgage-application-info-tile-payment-details> </div> <div ng-if="$ctrl.hideClosingDate && !$ctrl.paymentDetails && $ctrl.amortizationPeriod" class="info-panel__column grid__column--1of2"> <tng-mortgage-application-info-tile-amortization-period amortization-period="$ctrl.amortizationPeriod"> </tng-mortgage-application-info-tile-amortization-period> </div> </div> <div class="info-panel__row"> <div class="info-panel__column grid__column--1of2"> <div><strong>{{ ::\'mortgage.confirmation.heloc.limit\' | translate }}</strong></div> <div><strong class="large tangerine">{{ $ctrl.helocLimit | currency}}</strong></div> </div> <div class="info-panel__column grid__column--1of2"> <div><strong>{{ ::\'mortgage.confirmation.heloc.interestRate\' | translate }}</strong></div> <div><strong class="large tangerine" ng-bind-html="$ctrl.helocInterestRate | numberPercentage"></strong></div> </div> </div> </div> <div ng-if="$ctrl.isMortgageOnly" class="info-panel grid__container"> <div class="info-panel__row"> <div ng-if="!$ctrl.isPreapproval" class="info-panel__column first-row grid__column--1of2"> <span><strong>{{ ::\'mortgage.confirmation.property\' | translate }}</strong></span> <span><strong class="medium tangerine" ng-bind-html="$ctrl.propertyAddress"></strong></span> </div> <div class="info-panel__column first-row grid__column--1of2 has-no-borders"> <span><strong>{{ ::\'mortgage.confirmation.referenceNumber\' | translate }}</strong></span> <strong class="medium tangerine">{{ $ctrl.referenceNumber }}</strong> </div> </div> <div class="info-panel__row"> <div class="info-panel__column grid__column--1of2"> <div><strong>{{ :: \'mortgage.confirmation.mortgageAmount\' | translate }}</strong></div> <div><strong class="large tangerine">{{ $ctrl.mortgageAmount | currency}}</strong></div> </div> <div class="info-panel__column grid__column--1of2"> <div><strong>{{ :: \'mortgage.confirmation.yourInterestRate\' | translate }}</strong></div> <div><strong class="large tangerine" ng-bind-html="$ctrl.interestRate | numberPercentage"></strong></div> </div> </div> <div class="info-panel__row"> <div class="info-panel__column grid__column--1of2"> <div><strong>{{ :: \'mortgage.confirmation.term\' | translate }}</strong></div> <div><strong class="large tangerine">{{ $ctrl.termDisplay }}</strong></div> </div> <div ng-if="$ctrl.isPreapproval" class="info-panel__column grid__column--1of2"> <tng-mortgage-application-info-tile-app-type is-joint="$ctrl.isJoint"></tng-mortgage-application-info-tile-app-type> </div> <div ng-if="!$ctrl.isPreapproval && !$ctrl.hideClosingDate" class="info-panel__column grid__column--1of2"> <tng-mortgage-application-info-tile-closing-date show-closing-date-progress="$ctrl.showClosingDateProgress" closing-date="$ctrl.closingDate" submit-date="$ctrl.submitDate"> </tng-mortgage-application-info-tile-closing-date> </div> <div ng-if="$ctrl.showPaymentDetails" class="info-panel__column grid__column--1of2"> <tng-mortgage-application-info-tile-payment-details payment-details="$ctrl.paymentDetails"> </tng-mortgage-application-info-tile-payment-details> </div> <div ng-if="!$ctrl.isPreapproval && $ctrl.hideClosingDate && !$ctrl.paymentDetails && $ctrl.amortizationPeriod" class="info-panel__column grid__column--1of2"> <tng-mortgage-application-info-tile-amortization-period amortization-period="$ctrl.amortizationPeriod"> </tng-mortgage-application-info-tile-amortization-period> </div> </div> </div> <section ng-if="$ctrl.isMortgageAndHeloc || $ctrl.isHelocOnly" class="small medium-width-section"> {{:: \'mortgage.confirmation.heloc.interestRateNote\' | translate }} </section> <section ng-if="$ctrl.disclaimer" class="small medium-width-section" ng-class="{\'top-margin-small\' : $ctrl.isMortgageAndHeloc || $ctrl.isHelocOnly }"> {{:: $ctrl.disclaimer | translate }} </section> <section ng-if="$ctrl.showPaymentDetails" class="small medium-width-section" ng-class="{\'top-margin-small\' : $ctrl.isMortgageAndHeloc || $ctrl.isHelocOnly || $ctrl.disclaimer }"> {{:: \'mortgage.confirmation.paymentDetailsNote\' | translate }} </section> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(8)),a=o(n(0)),s=o(n(2)),r=o(n(268));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,s){(0,a.default)(this,t),this.translateFilter=e("translate"),this.DateService=n,this.momentConstants=i,this.mortgageConstants=s,this.insights=[]}return(0,s.default)(t,[{key:"$onInit",value:function(){this.hideClosingDate=this.hideClosingDate||!1,this.paymentDetails=this.paymentDetails||!1,this.amortizationPeriod=this.amortizationPeriod||!1,this.propertyAddress&&this.propertyAddress.state&&!this.propertyAddress.province&&(this.propertyAddress.province=this.propertyAddress.state,delete this.propertyAddress.state),(0,i.default)(this,{propertyAddress:r.default.getHTMLAddress(this.propertyAddress,!0)})}},{key:"isPreapproval",get:function(){return Boolean(this.transactionType===this.mortgageConstants.TRANSACTION_TYPE.PRE_APPROVAL)}},{key:"isMortgageOnly",get:function(){return Boolean(this.mortgageAmount&&this.interestRate&&!this.hasHeloc)}},{key:"isHelocOnly",get:function(){return Boolean(!(this.mortgageAmount&&this.interestRate)&&this.hasHeloc)}},{key:"isMortgageAndHeloc",get:function(){return Boolean(this.mortgageAmount&&this.interestRate&&this.hasHeloc)}},{key:"showPaymentDetails",get:function(){return Boolean(this.isMortgageAndHeloc&&this.hideClosingDate&&this.paymentDetails||this.isMortgageOnly&&!this.isPreapproval&&this.hideClosingDate&&this.paymentDetails)}}]),t}();c.$inject=["$filter","DateService","momentConstants","mortgageConstants"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5017)),a=s(n(5018));function s(t){return t&&t.__esModule?t:{default:t}}var r={template:i.default,controller:a.default,bindings:{showClosingDateProgress:"<",closingDate:"<",submitDate:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div> <div><strong>{{ ::$ctrl.closingDateTitle | translate }}</strong></div> <strong ng-if="!$ctrl.showClosingDateProgress" class="large tangerine"> {{$ctrl.closingDate | date: \'longDate\'}} </strong> <div ng-if="$ctrl.showClosingDateProgress" class="progress-bar-wrapper"> <div class="entry small tangerine">{{$ctrl.closingDate | date: \'longDate\'}}</div> <tng-progress-bar aria-hidden="true" class="entry" width="$ctrl.closingDatePercentage"> </tng-progress-bar> <div class="entry small">{{$ctrl.closingDateRemainingDays}}</div> </div> </div>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=r(n(45));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,s){(0,i.default)(this,t),this.translateFilter=e("translate"),this.DateService=n,this.momentConstants=a,this.mortgageConstants=s}return(0,a.default)(t,[{key:"$onInit",value:function(){this.initClosingDateProgressBar()}},{key:"initClosingDateProgressBar",value:function(){if(this.showClosingDateProgress&&this.closingDate&&this.submitDate){var t=(0,s.default)((0,s.default)()).diff((0,s.default)(this.submitDate),this.momentConstants.DATE_MANIPULATION.DAYS),e=(0,s.default)(this.closingDate).diff((0,s.default)(this.submitDate),this.momentConstants.DATE_MANIPULATION.DAYS),n=e-t;n<0&&(n=0),this.closingDatePercentage=100*t/e,this.closingDateRemainingDays=this.translateFilter("mortgage.confirmation.closingDate.remaining."+(1===n?"singular":"plural"),{days:n})}}},{key:"closingDateTitle",get:function(){var t=this.mortgageConstants.TRANSACTION_TYPE,e=-1!==[t.ASSUMPTION,t.ADD_COVENANT,t.RELEASE_COVENANT].indexOf(this.transactionType);return this.transactionType===this.mortgageConstants.TRANSACTION_TYPE.PURCHASE?"mortgage.confirmation.closingDate.title.closingDate":e?"mortgage.confirmation.closingDate.title.closingDateNonFundable":"mortgage.confirmation.closingDate.title.fundingDate"}}]),t}();o.$inject=["$filter","DateService","momentConstants","mortgageConstants"],e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(5020);var s={template:((i=a)&&i.__esModule?i:{default:i}).default,bindings:{amortizationPeriod:"<"}};e.default=s,t.exports=e.default},function(t,e){t.exports="<div> <div> <strong> <span>{{ ::'mortgage.confirmation.amortizationPeriod' | translate }}</span> </strong> </div> <strong class=\"large tangerine\">{{$ctrl.amortizationPeriod | yearsAndMonths}}</strong> </div>"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(5022);var s={template:((i=a)&&i.__esModule?i:{default:i}).default,bindings:{isJoint:"<"}};e.default=s,t.exports=e.default},function(t,e){t.exports="<div><strong>{{ ::'mortgage.confirmation.singleOrJointLabel' | translate }}</strong></div> <div> <strong class=\"large tangerine\"> {{ ($ctrl.isJoint ? 'mortgage.confirmation.joint' : 'mortgage.confirmation.single') | translate}} </strong> </div>"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(5024);var s={template:((i=a)&&i.__esModule?i:{default:i}).default,bindings:{paymentDetails:"<"}};e.default=s,t.exports=e.default},function(t,e){t.exports='<div> <strong> <span>{{ ::\'mortgage.confirmation.paymentDetails\' | translate : { type : ($ctrl.paymentDetails.type | translate).toLowerCase() } }}</span> </strong> </div> <strong class="large tangerine">{{ $ctrl.paymentDetails.amount | currency:"$":2 }}</strong>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5026)),a=s(n(5027));function s(t){return t&&t.__esModule?t:{default:t}}n(5028);var r={template:i.default,controller:a.default,bindings:{mortgageSpecialist:"<",showHeader:"<?",showMamNote:"<?",helocOnly:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-mortgage-application-mam-tile"> <section> <h2 ng-if="$ctrl.showHeader" class="medium-width-section"> {{ ::\'mortgage.confirmation.specialist.header\' | translate: { firstName: $ctrl.mortgageSpecialist.firstName, } }} </h2> <div class="info-panel grid__container"> <div class="info-panel__row"> <div class="info-panel__column"> <section> <p class="medium-width-section"> {{ :: $ctrl.helocOnly ? \'mortgage.confirmation.specialist.subHeaderDetailsHeloc\' : \'mortgage.confirmation.specialist.subHeaderDetails\' | translate }}</p> </section> <section class="top-margin-medium"> <p class="first-and-last-name font large"><strong>{{ $ctrl.mortgageSpecialist.firstName }} {{ $ctrl.mortgageSpecialist.lastName }}</strong></p> <p class="mam-title grey top-margin-none"> <span class="small"> {{ ::\'mortgage.confirmation.specialist.title\' | translate }} </span> </p> </section> </div> </div> <div class="info-panel__row"> <div class="info-panel__column grid__column--1of2"> <span class="grey small email-label">{{ ::\'mortgage.confirmation.specialist.emailAddress\' | translate }}</span> <span class="small"><strong>{{$ctrl.mortgageSpecialist.emailAddress}}</strong></span> </div> <div class="info-panel__column grid__column--1of2 no-border" x-ms-format-detection="none"> <span class="grey small phone-label">{{ ::\'mortgage.confirmation.specialist.phoneHeader\' | translate }}</span> <span class="small"> <strong> {{::\'mortgage.confirmation.specialist.phoneNumber\' | translate}} &nbsp; {{ ::\'mortgage.confirmation.specialist.ext\' | translate: { ext: $ctrl.mortgageSpecialist.ext } }} </strong> </span> </div> </div> <div ng-if="$ctrl.showMamNote" class="info-panel__row"> <div class="info-panel__column"> <section> <p class="medium-width-section">{{ ::\'mortgage.confirmation.specialist.note\' | translate }}</p> </section> </div> </div> </div> </section> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(0),s=(i=a)&&i.__esModule?i:{default:i};var r=function t(){(0,s.default)(this,t)};r.$inject=[],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5030)),a=s(n(5031));function s(t){return t&&t.__esModule?t:{default:t}}n(5032);var r={controller:i.default,template:a.default,bindings:{description:"<",orangeKey:"<",referralCode:"<",title:"<"},transclude:{tngQuickAccessTileButtons:"?tngQuickAccessTileButtons"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(0),s=(i=a)&&i.__esModule?i:{default:i};var r=function t(){(0,s.default)(this,t)};r.$inject=[],e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-quick-access-tile panel"> <h3>{{$ctrl.title}}</h3> <p ng-if="$ctrl.description">{{$ctrl.description}}</p> <p ng-if="$ctrl.orangeKey" class="orange-key">{{$ctrl.orangeKey}}</p> <p ng-if="$ctrl.referralCode" class="referral-code">{{ $ctrl.referralCode }}</p> <div class="bottom" ng-transclude="tngQuickAccessTileButtons"></div> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5034)),a=s(n(5035));function s(t){return t&&t.__esModule?t:{default:t}}n(5036);var r={template:i.default,controller:a.default,bindings:{header:"<",items:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-condition-checklist"> <h2 ng-if="$ctrl.header">{{$ctrl.header}}</h2> <div class="segments-container"> <div class="segments-scroll top-margin-small"> <div class="segments"> <div class="segment" ng-repeat="item in $ctrl.items"> <div class="text-and-icons js-button"> <div class="text font" aria-describedby="condition-checklist-tooltip{{$index}}">{{item.name}}</div> <i ng-if="item.status" class="font large icon-complete" aria-hidden="true"></i> <span ng-if="item.status" class="visually-hidden">{{ \'global.commonWords.complete\' | translate }}</span> <i ng-if="!item.status" class="font large icon-unfulfilled" aria-hidden="true"></i> <span ng-if="!item.status" class="visually-hidden">{{ \'global.commonWords.incomplete\' | translate }}</span> <span class="visually-hidden" role="tooltip" id="condition-checklist-tooltip{{$index}}">{{item.tooltip}}</span> </div> <div class="c-tool-tip js-tooltip" aria-hidden="true"> <div class="c-tool-tip__arrow js-arrow"></div> <div class="c-tool-tip__wrapper js-wrapper"> {{item.tooltip}} </div> </div> </div> </div> <div class="segments-overlay-left"></div> <div class="segments-overlay-right"></div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(58)),a=o(n(8)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,r,o,c){(0,s.default)(this,t),(0,a.default)(this,{$element:e,$scope:n,$timeout:i,$window:r,EnvironmentService:o,ToolTipService:c,leftDom:null,rightDom:null,segments:[],scrollDom:null})}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;this.scrollDom=this.$element.querySelectorAll(".segments-scroll").get(0),this.leftDom=this.$element.querySelectorAll(".segments-overlay-left").get(0),this.rightDom=this.$element.querySelectorAll(".segments-overlay-right").get(0),this.$timeout((function(){if(t.segments=t.$element.querySelectorAll(".c-condition-checklist").querySelectorAll(".segments").querySelectorAll(".segment"),t.segments){var e=!0,n=!1,a=void 0;try{for(var s,r=(0,i.default)(t.segments);!(e=(s=r.next()).done);e=!0){var o=s.value,c=o.querySelector(".js-button"),l=o.querySelector(".js-tooltip"),u=angular.element(c).closest(".dialog__content");t.ToolTipService.createToolTip(t.$scope,c,l,null,u)}}catch(t){n=!0,a=t}finally{try{!e&&r.return&&r.return()}finally{if(n)throw a}}}t.EnvironmentService.isNative()||(angular.element(t.leftDom).css("height",t.scrollDom.clientHeight),angular.element(t.rightDom).css("height",t.scrollDom.clientHeight),t.updateOverlays(),angular.element(t.$window).on("resize",(function(){return t.onScroll()})),angular.element(t.scrollDom).on("scroll",(function(){return t.onScroll()})))}))}},{key:"onScroll",value:function(){this.updateOverlays()}},{key:"updateOverlays",value:function(){var t="none",e="none";if(this.scrollDom.scrollWidth<=this.scrollDom.clientWidth)return angular.element(this.leftDom).css("display",t),void angular.element(this.rightDom).css("display",e);var n=100*Math.ceil(this.scrollDom.scrollLeft)/Math.ceil(this.scrollDom.scrollWidth-this.scrollDom.clientWidth);n<100&&(e="block"),n>0&&(t="block"),angular.element(this.leftDom).css("display",t),angular.element(this.rightDom).css("display",e)}}]),t}();c.$inject=["$element","$scope","$timeout","$window","EnvironmentService","ToolTipService"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5038)),a=s(n(5039));function s(t){return t&&t.__esModule?t:{default:t}}n(5040),e.default={template:i.default,controller:a.default,bindings:{index:"<",customer:"<",account:"<",parentCtrl:"<"}},t.exports=e.default},function(t,e){t.exports='<div class="c-tpiItem"> <div class="c-tpiItem--account-name-container" ng-if="!$ctrl.missingIU"> <div class="c-tpiItem--account-name-container__title">{{ ::\'amlConfirmInfo.confirmAccountInfoModal.tpiItem.accounts\' | translate }}</div> <div class="c-tpiItem--account-name-container__name">{{$ctrl.account.masked_account_name}}</div> </div> <p ng-if="$ctrl.missingThirdParty" class="c-tpiItem__description"> {{ ::\'amlConfirmInfo.confirmAccountInfoModal.tpiItem.description\' | translate }} <tng-help-bubble> {{ ::\'clientOnboarding.setupAccountForm.labels.thirdPartyBenefactorToolTip\' | translate }} </tng-help-bubble> </p> <tpi-form-component class="c-tpiItem--tpiIFormComponent" repeat-index="$ctrl.index" flow-service="$ctrl.flowService" customer="$ctrl.customer" account="$ctrl.account.legal_instructions" show-have-third-party="true" on-enable-next="$ctrl.onEnableNext(enable)"></tpi-form-component> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=r(n(143));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a){(0,i.default)(this,t),this.$log=e,this.$translate=n,this.intendedUseTpiReviewConstants=a}return(0,a.default)(t,[{key:"$onInit",value:function(){this.missingThirdParty=!(void 0===this.account.missing_third_party||!this.account.missing_third_party),this.missingIU=!(void 0===this.account.missing_intended_use||!this.account.missing_intended_use),(this.missingThirdParty||this.missingIU)&&void 0===this.account.legal_instructions&&(this.account.legal_instructions={})}},{key:"onEnableNext",value:function(t){var e=this;(0,s.default)(this.parentCtrl.intendedUseTpiReviewHelper.getAllTpiItemValidObj,(function(n){n.account_number===e.account.account_number&&n.missing_third_party&&(n.enableNext=t)})),this.parentCtrl.checkIuTpiFormValid()}}]),t}();o.$inject=["$log","$translate","intendedUseTpiReviewConstants"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5042)),a=s(n(5043));function s(t){return t&&t.__esModule?t:{default:t}}n(5044),e.default={template:i.default,controller:a.default,require:{},bindings:{customer:"<",account:"<",parentCtrl:"<",showSin:"<",userTypeBusiness:"<",customerInfoState:"<",iuTpiInfoState:"<",isCreditLimit:"<?"}},t.exports=e.default},function(t,e){t.exports=' <div class="field" ng-if="!$ctrl.userTypeBusiness"> <label class="review-item--table-header">{{ ::\'amlConfirmInfo.review.personal\' | translate }}</label> <tng-settings-table settings="$ctrl.displayPersonalInfoModel"></tng-settings-table> <div>&nbsp;</div> <button actionable-id="amlConfirmInfo_edit_personal" class="btn btn--edit" ng-click="$ctrl.parentCtrl.onEditClickFromReview($ctrl.customerInfoState)">{{ ::\'global.components.buttons.edit\' | translate }}</button> </div> <div class="field" ng-if="$ctrl.userTypeBusiness"> <label class="review-item--table-header">{{ ::\'amlConfirmInfo.review.businessInfo\' | translate }}</label> <tng-settings-table settings="$ctrl.displayBusinessInfo"></tng-settings-table> <div>&nbsp;</div> <button actionable-id="amlConfirmInfo_edit_personal" class="btn btn--edit" ng-click="$ctrl.parentCtrl.onEditClickFromReview($ctrl.customerInfoState)">{{ ::\'global.components.buttons.edit\' | translate }}</button> </div> <div ng-if="$ctrl.businessRegistrationDetails.length > 0" class="field" ng-if="$ctrl.userTypeBusiness"> <label class="review-item--table-header">{{ ::\'amlConfirmInfo.review.outsideCanadaReg\' | translate }}</label> <tng-settings-table settings="$ctrl.businessRegistrationDetails"></tng-settings-table> <div>&nbsp;</div> <button actionable-id="amlConfirmInfo_edit_personal" class="btn btn--edit" ng-click="$ctrl.parentCtrl.onEditClickFromReview($ctrl.customerInfoState)">{{ ::\'global.components.buttons.edit\' | translate }}</button> </div> <div class="field" ng-if=""> <label class="review-item--table-header">{{ ::\'amlConfirmInfo.review.accountIndendedUse\' | translate }}</label> <div> <tng-settings-table settings="$ctrl.displayBusinessInfo"></tng-settings-table> </div> <div>&nbsp;</div> </div> <div> <div class="field" ng-if="$ctrl.customer.show_director"> <label class="review-item--table-header">{{ ::\'amlConfirmInfo.review.directors\' | translate }}</label> <div> <tng-settings-table ng-if="$ctrl.displayDirectors.length > 0" settings="$ctrl.displayDirectors"></tng-settings-table> <div>&nbsp;</div> <div ng-if="$ctrl.customer.missing_business_director"> <p>{{ ::\'eNotification.AML_MISSING_INFO.messages.directorOwner\' | translate }}</p> </div> <div ng-if="$ctrl.customer.missing_business_pending_director"> <p>{{ ::\'eNotification.AML_MISSING_INFO.messages.directorPR\' | translate }}</p> </div> <button actionable-id="amlConfirmInfo_edit_thirdPartyInfo" class="btn btn--edit" ng-click="$ctrl.parentCtrl.onEditClickFromReview($ctrl.customerInfoState)">{{ ::\'global.components.buttons.edit\' | translate }}</button> <div>&nbsp;</div> </div> </div> <div class="field beneficial-owners--details" ng-if="$ctrl.customer.show_beneficial_owner"> <div class="field"> <label class="review-item--table-header">{{ ::\'eNotification.AML_MISSING_INFO.BENEFICIAL_OWNER\' | translate }}</label> <label ng-if="$ctrl.displayBeneficialOwner.length> 0" class="review-item--table-header">{{ ::\'eNotification.AML_MISSING_INFO.BENEFICIAL_OWNER_UBO\' | translate }}</label> <tng-settings-table ng-if="$ctrl.displayBeneficialOwner.length> 0" settings="$ctrl.displayBeneficialOwner"></tng-settings-table> <div ng-if="$ctrl.displayBeneficialOwner.length < 0"> <p>{{ ::\'eNotification.AML_MISSING_INFO.messages.noUltimateBeneficialOwner\' | translate }} </p> </div> </div> <div class="field"> <div> <label ng-if="$ctrl.intermediaryBeneOwners.length> 0" class="review-item--table-header">{{ ::\'eNotification.AML_MISSING_INFO.BENEFICIAL_OWNER_IO\' | translate }}</label> <div ng-if="$ctrl.intermediaryBeneOwners.length < 0"> <p>{{ ::\'eNotification.AML_MISSING_INFO.messages.noIntermediaryBeneficialOwner\' | translate }}</p> </div> <tng-settings-table ng-if="$ctrl.intermediaryBeneOwners.length> 0" settings="$ctrl.intermediaryBeneOwners"></tng-settings-table> </div> <div ng-if="$ctrl.customer.missing_business_beneficial_owner"> {{ ::\'eNotification.AML_MISSING_INFO.messages.beneficialOwnerMissing\' | translate }} </div> <div ng-if="$ctrl.customer.has_no_beneficial_owner"> <p>{{ ::\'eNotification.AML_MISSING_INFO.messages.noUltimateOwner\' | translate }}</p> </div> <div ng-if="$ctrl.customer.missing_business_pending_beneficial_owner"> <p ng-bind-html="::\'eNotification.AML_MISSING_INFO.messages.beneficialOwnerPending1\' | translate: { returnDate: $ctrl.customer.beneficial_owner_pending_attestation_return_date}"></p> <p>{{ ::\'eNotification.AML_MISSING_INFO.messages.beneficialOwnerPending2\' | translate }}</p> </div> <button actionable-id="amlConfirmInfo_edit_thirdPartyInfo" class="btn btn--edit beneficial-owners--editBene" ng-click="$ctrl.parentCtrl.onEditClickFromReview($ctrl.customerInfoState)">{{ ::\'global.components.buttons.edit\' | translate }}</button> </div> </div> </div> <div class="field" ng-if="$ctrl.hasIntendedUse"> <label class="review-item--table-header">{{ ::\'amlConfirmInfo.review.accountIndendedUse\' | translate }}</label> <div> <tng-settings-table settings="$ctrl.displayIntendedUseInfoModel"></tng-settings-table> </div> <div>&nbsp;</div> <button actionable-id="amlConfirmInfo_edit_accountIndendedUse" class="btn btn--edit" ng-click="$ctrl.parentCtrl.onEditClickFromReview($ctrl.iuTpiInfoState)">{{ ::\'global.components.buttons.edit\' | translate }}</button> </div> <div ng-if="$ctrl.displayThirdPartyInfoList.length > 0" class="field"> <div ng-repeat="displayThirdPartyInfo in $ctrl.displayThirdPartyInfoList track by $index"> <label class="review-item--table-header">{{ ::\'amlConfirmInfo.review.thirdPartyInfo\' | translate }}</label> <div> <tng-settings-table settings="displayThirdPartyInfo"></tng-settings-table> </div> <div>&nbsp;</div> </div> <button actionable-id="amlConfirmInfo_edit_thirdPartyInfo" class="btn btn--edit" ng-click="$ctrl.parentCtrl.onEditClickFromReview($ctrl.iuTpiInfoState)">{{ ::\'global.components.buttons.edit\' | translate }}</button> </div> <div ng-if="$ctrl.displayThirdPartyInfoNoList.length > 0" class="field third-party-noInfo"> <div ng-repeat="displayThirdPartyNoInfo in $ctrl.displayThirdPartyInfoNoList track by $index"> <label class="review-item--table-header">{{ ::\'amlConfirmInfo.review.thirdPartyInfo\' | translate }}</label> <div> <tng-settings-table settings="displayThirdPartyNoInfo"></tng-settings-table> </div> <div>&nbsp;</div> <div class="third-party-noInfo--error">{{ ::\'amlConfirmInfo.review.noThirdParty\' | translate }}</div> <div>&nbsp;</div> </div> <button actionable-id="amlConfirmInfo_edit_thirdPartyInfo" class="btn btn--edit" ng-click="$ctrl.parentCtrl.onEditClickFromReview($ctrl.iuTpiInfoState)">{{ ::\'global.components.buttons.edit\' | translate }}</button> </div>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(33)),a=d(n(92)),s=d(n(15)),r=d(n(0)),o=d(n(2)),c=d(n(45)),l=d(n(268)),u=d(n(367));function d(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(e,n,i,a,s,o,c,l,u,d,h,f){(0,r.default)(this,t),this.$log=e,this.$translate=n,this.AccountHelpersService=i,this.customerConstants=a,this.UserSettingsConstants=s,this.referenceDataConstants=o,this.eNotificationConstants=c,this.AMLConfirmInfoConstants=l,this.ReferenceDataService=u,this.AccountDetailsService=d,this.DateService=h,this.displayPersonalInfo=[],this.displayBusinessInfo=[],this.displayIntendedUseInfo=[],this.displayThirdPartyInfo=[],this.businessRegistrationDetails=[],this.displayThirdPartyInfoList=[],this.intendedUseTpiReviewConstants=f}return(0,o.default)(t,[{key:"$onInit",value:function(){var t=this;this.countries=[],this._getReferenceData().then((function(){t.userTypeBusiness?t._getBusinessInfo():t._getPersonalInfoDetails(),t._getIntendedUseDetails(),t._getThirdPartyInfo()}))}},{key:"_getPersonalInfoDetails",value:function(){var t=this;this.displayPersonalInfo=[],this.displayPersonalInfoModel=[],this.displayPersonalInfo.push({label:"userSettings.general.basicInfo.name",text:this.customer.title+" "+this.customer.first_name+" "+this.customer.last_name});var e=angular.copy(this.customer);if(this.customer.date_of_birth?this.displayPersonalInfo=this.displayPersonalInfo.concat([{label:"amlConfirmInfo.review.dob",text:this.DateService.convertToFormattedDayMonthYear((0,c.default)(e.date_of_birth),"/")}]):this.customer.birth_date&&(this.displayPersonalInfo=this.displayPersonalInfo.concat([{label:"amlConfirmInfo.review.dob",text:this.DateService.convertToFormattedDayMonthYear((0,c.default)(e.birth_date),"/")}])),!this.isCreditLimit&&this.customer.email&&(this.displayPersonalInfo=this.displayPersonalInfo.concat([{label:"amlConfirmInfo.review.email",text:this.customer.email}])),this.showSin&&this.customer.sin&&(this.displayPersonalInfo=this.displayPersonalInfo.concat([{label:"amlConfirmInfo.review.sin",text:this.customer.sin}])),this.customer.address_list&&this.customer.address_list.length>0&&u.default.findObjectType(this.customer,"address_list",this.customerConstants.API.ADDRESS_TYPE.HOME,(function(e){"US"!==e.country&&"CA"!==e.country&&delete e.province,t.personalHomeAddressHtml=l.default.getHTMLAddress(e),t.displayPersonalInfo=t.displayPersonalInfo.concat([{label:"userSettings.general.basicInfo.homeAddress",text:t.personalHomeAddressHtml}])})),this._getMailingAddress(this.customer),this.customer.phoneNumbers&&(this.customer.phoneNumbers.HOME&&void 0!==this.customer.phoneNumbers.HOME.number&&this.customer.phoneNumbers.HOME.number.length>0&&this._pushPreferredPhoneNumber(this.AMLConfirmInfoConstants.PHONE_TYPE.HOME),this.customer.phoneNumbers.CELL&&void 0!==this.customer.phoneNumbers.CELL.number&&this.customer.phoneNumbers.CELL.number.length>0?this._pushPreferredPhoneNumber(this.AMLConfirmInfoConstants.PHONE_TYPE.CELL):this.customer.mobilePhoneNumber&&(this.displayPersonalInfo=this.displayPersonalInfo.concat([{label:"userSettings.general.basicInfo.mobilePhoneNumber",text:this.customer.mobilePhoneNumber}])),!this.isCreditLimit&&this.customer.phoneNumbers.BUSINESS&&void 0!==this.customer.phoneNumbers.BUSINESS.number&&this.customer.phoneNumbers.BUSINESS.number.length>0)){var n="";n=this.customer.phoneNumbers.BUSINESS.extension?this.customer.phoneNumbers.BUSINESS.number+"  "+this.$translate.instant("amlConfirmInfo.review.extension")+".  "+this.customer.phoneNumbers.BUSINESS.extension:""+this.customer.phoneNumbers.BUSINESS.number,this.displayPersonalInfo=this.displayPersonalInfo.concat([{label:"userSettings.general.basicInfo.workPhoneNumber",text:n}])}if(this.customer.employment_status){var i="",a=this.customer.employment_status.code?this.customer.employment_status.code:this.customer.employment_status;(0,s.default)(this.customerConstants.API.EMPLOYMENT_STATUS).some((function(e){return a===t.customerConstants.API.EMPLOYMENT_STATUS[e].KEY&&(i=t.$translate.instant(t.customerConstants.API.EMPLOYMENT_STATUS[e].TRANSLATION),!0)}));var r=-1!==this.UserSettingsConstants.EMPLOYED_STATUS_CODES.indexOf(a);if(r&&this.customer.occupation){var o=this._getIndustry(this.customer.occupation.industry_code).name,d=this._getOccupation(this.customer.occupation.occupation_code).name;i+="\n"+o+"\n"+d+"\n"}if(this.displayPersonalInfo=this.displayPersonalInfo.concat([{label:"amlConfirmInfo.review.occupation",text:i}]),r&&this.customer.employer&&(this.customer.employer.company_name&&(this.displayPersonalInfo=this.displayPersonalInfo.concat([{label:"userSettings.general.basicInfo.employerName",text:this.customer.employer.company_name}])),this.customer.employer.company_address)){var h=angular.copy(this.customer.employer.company_address);if(void 0===h.address_line1&&(h.address_line1="",h.street_number?(h.address_line1+=angular.copy(h.street_number)+" ",delete h.street_number,h.street_name&&(h.address_line1+=angular.copy(h.street_name),delete h.street_name)):h.street_name&&(h.address_line1+=angular.copy(h.street_name),delete h.street_name)),h.address_line1.length>0){var f=l.default.getHTMLAddress(h);this.displayPersonalInfo=this.displayPersonalInfo.concat([{label:"userSettings.general.basicInfo.employerAddress",text:f}])}}}this.displayPersonalInfoModel=this.displayPersonalInfo.map((function(t,e){return t.order=e,t}))}},{key:"_pushPreferredPhoneNumber",value:function(t){var e=this.$translate.instant("userSettings.general.basicInfo.preferred"),n=this.customer.primaryPhoneType?this.customer.primaryPhoneType:this._getPreferred(t);switch(t){case this.AMLConfirmInfoConstants.PHONE_TYPE.HOME:this.displayPersonalInfo=this.displayPersonalInfo.concat([this._displayPreferredText(this.AMLConfirmInfoConstants.PHONE_TYPE.HOME,"userSettings.general.basicInfo.homePhoneNumber",e,n=n===this.AMLConfirmInfoConstants.PHONE_TYPE.HOME&&t===n)]);break;case this.AMLConfirmInfoConstants.PHONE_TYPE.CELL:this.displayPersonalInfo=this.displayPersonalInfo.concat([this._displayPreferredText(this.AMLConfirmInfoConstants.PHONE_TYPE.CELL,"userSettings.general.basicInfo.mobilePhoneNumber",e,n=n===this.AMLConfirmInfoConstants.PHONE_TYPE.CELL&&t===n)])}}},{key:"_displayPreferredText",value:function(t,e,n,i){return{label:e,text:!this.isCreditLimit&&i?this.customer.phoneNumbers[t].number+' <span class="aml-settings-table">'+n+"</span>":""+this.customer.phoneNumbers[t].number}}},{key:"_getPreferred",value:function(t){var e=this.customer.phoneNumbers[t];return e.preferred?e.type:""}},{key:"_getIndustry",value:function(t){return this.individualIndustries.find((function(e){return e.code===t}))}},{key:"_getOccupation",value:function(t){var e=this._getIndustry(this.customer.occupation.industry_code);return e?e.data.find((function(e){return e.code===t})):null}},{key:"_getMailingAddress",value:function(t){var e=null;t.addresses&&t.addresses.MAILING.address_line1?e=l.default.getHTMLAddress(t.addresses.MAILING):this.customer.address_list&&this.customer.address_list.length>0&&u.default.findObjectType(this.customer,"address_list",this.customerConstants.API.ADDRESS_TYPE.MAILING,(function(t){"US"!==t.country&&"CA"!==t.country&&delete t.province,e=l.default.getHTMLAddress(t)})),this.displayPersonalInfo=this.displayPersonalInfo.concat([{label:"clientOnboarding.basicInfoForm.mailingAddress",text:e}])}},{key:"_getBusinessInfo",value:function(){if(this.phoneNumbersDetails=this._getPhoneNumbers(),void 0!==this.customer.business_name&&this.displayBusinessInfo.push({label:"clientOnboarding.tpiForm.labels.businessName ",text:this.customer.business_name}),void 0!==this.customer.trade_name&&this.displayBusinessInfo.push({label:"amlConfirmInfo.review.tradeName ",text:this.customer.trade_name}),this.phoneNumbersDetails){var t="";t=this.phoneNumbersDetails.extension?this.phoneNumbersDetails.business+"  "+this.$translate.instant("amlConfirmInfo.review.extension")+". "+this.phoneNumbersDetails.extension:""+this.phoneNumbersDetails.business,this.displayBusinessInfo=this.displayBusinessInfo.concat([{label:"userSettings.general.basicInfo.workPhoneNumber",text:t}])}this._getBusinessAddress(),this._getBusinessRegistration(),this._getOwners()}},{key:"_getPhoneNumbers",value:function(){var t=this,e={};return!!this.customer.phone_list&&(this.customer.phone_list.forEach((function(n){n.type===t.AMLConfirmInfoConstants.PHONE_TYPE.HOME&&(e.home=n.number),n.type===t.AMLConfirmInfoConstants.PHONE_TYPE.CELL&&(e.cell=n.number),n.type===t.AMLConfirmInfoConstants.PHONE_TYPE.BUSINESS&&(n.extension&&(e.extension=n.extension),e.business=n.number)})),e)}},{key:"_getBusinessAddress",value:function(){var t=this;this.customer.address_list&&u.default.findObjectType(this.customer,"address_list",this.customerConstants.API.ADDRESS_TYPE.BUSINESS,(function(e){var n=l.default.getHTMLAddress(e);t.displayBusinessInfo=t.displayBusinessInfo.concat([{label:"userSettings.general.basicInfo.businessAddress",text:n}])}))}},{key:"_getBusinessRegistration",value:function(){var t=this;this.customer.business_countries&&this.customer.business_countries.forEach((function(e){e.business_country_type===t.eNotificationConstants.BUSINESS_COUNTRY_TYPES.COUNTRIES_OPERATION&&(t.countryOperation=t._getRegistration(e),t.businessRegistrationDetails=t.businessRegistrationDetails.concat([{label:"amlConfirmInfo.businessRegistration.operations",text:t.countryOperation}])),e.business_country_type===t.eNotificationConstants.BUSINESS_COUNTRY_TYPES.COUNTRIES_SUPPLIERS&&(t.countrySuppliers=t._getRegistration(e),t.businessRegistrationDetails=t.businessRegistrationDetails.concat([{label:"amlConfirmInfo.businessRegistration.suppliers",text:t.countrySuppliers}])),e.business_country_type===t.eNotificationConstants.BUSINESS_COUNTRY_TYPES.COUNTRIES_CUSTOMERS&&(t.countryCustomer=t._getRegistration(e),t.businessRegistrationDetails=t.businessRegistrationDetails.concat([{label:"amlConfirmInfo.businessRegistration.customerCountries",text:t.countryCustomer}])),e.business_country_type===t.eNotificationConstants.BUSINESS_COUNTRY_TYPES.COUNTRIES_AFFILIATE&&(t.countryAffliate=t._getRegistration(e),t.businessRegistrationDetails=t.businessRegistrationDetails.concat([{label:"amlConfirmInfo.businessRegistration.affiliates",text:t.countryAffliate}])),e.business_country_type===t.eNotificationConstants.BUSINESS_COUNTRY_TYPES.COUNTRIES_CHARITY_SERVICE&&(t.countryCharityService=t._getRegistration(e),t.businessRegistrationDetails=t.businessRegistrationDetails.concat([{label:"amlConfirmInfo.businessRegistration.charityService",text:t.countryCharityService}]))}))}},{key:"_getCountries",value:function(){var t=this;this.ReferenceDataService.getDataByType(this.ReferenceDataService.TYPES.COUNTRIES).then((function(e){t.countries=e[t.ReferenceDataService.TYPES.COUNTRIES],t.countryList=t.countries}))}},{key:"_getRegistration",value:function(t){var e=this,n="",i="";return!1===t.countries_other_than_canada?n=this.$translate.instant("eNotification.setupAccountForm.labels.no"):(n=this.$translate.instant("eNotification.setupAccountForm.labels.yes"),t.country_list.forEach((function(t,n){i+=0===n?e.countries.find((function(e){return e.code===t})).name+" ":", "+e.countries.find((function(e){return e.code===t})).name})),n=n+" : "+i),n}},{key:"_getIntendedUseDetails",value:function(){var t=this;this.displayIntendedUseInfo=[],this.displayIntendedUseInfoModel=[],this.hasIntendedUse=!1,this.customer.intended_use_list&&this.customer.intended_use_list.length>0&&(this.customer.intended_use_list.forEach((function(e){if(e.legal_instructions&&e.legal_instructions.intended_account_use){var n=t._getIntendedUseInfo(e);e.legal_instructions.intended_account_use===t.intendedUseTpiReviewConstants.OTHER_INTENDED_USE.TYPE&&(n+=": "+e.legal_instructions.other_intended_use),t.displayIntendedUseInfo.push({label:e.masked_account_name,text:n}),t.hasIntendedUse=!0}})),this.hasIntendedUse&&(this.displayIntendedUseInfoModel=this.displayIntendedUseInfo.map((function(t,e){return t.order=e,t}))))}},{key:"_getIntendedUseInfo",value:function(t){return this.allIntendedUsesMapped[t.account_type].find((function(e){return e.code===t.legal_instructions.intended_account_use})).name}},{key:"_getThirdPartyInfo",value:function(){var t=this;this.displayThirdPartyInfoList=[],this.displayThirdPartyInfoNoList=[],angular.copy(this.customer).intended_use_list.forEach((function(e){t.displayThirdPartyInfo=[],t.displayThirdPartyNoInfo=[],e.legal_instructions&&(e.legal_instructions.third_party?(t.isTypeBusiness(e.legal_instructions.third_party_info.type)?(t._getAccountNameInfo(e),t.getThirdPartyInfo(e),t._getRelationshipInfo(e),t._getBusinessName(e),t._getBusinessIndustryInfo(e),t.getCorporationDetails(e),t._getCurrentAddress(e)):(t._getAccountNameInfo(e),t.getThirdPartyInfo(e),t._getRelationshipInfo(e),t._getName(e),t.getDateOfBirth(e),t._getCurrentAddress(e),t._getPersonalIndustry(e),t._getOccupationInfo(e)),t.displayThirdPartyInfoList.push(t.displayThirdPartyInfo)):!1===e.legal_instructions.third_party&&(t._getAccountNameInfoNone(e),t.displayThirdPartyInfoNoList.push(t.displayThirdPartyNoInfo)))}))}},{key:"_getAccountNameInfo",value:function(t){var e=this.parentCtrl.getAccountName(t);e&&(this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"userSettings.general.basicInfo.account",text:e}]))}},{key:"_getAccountNameInfoNone",value:function(t){var e=this.parentCtrl.getAccountName(t);e&&(this.displayThirdPartyNoInfo=this.displayThirdPartyNoInfo.concat([{label:"userSettings.general.basicInfo.account",text:e}]))}},{key:"getThirdPartyInfo",value:function(t){var e=t.legal_instructions.third_party_info.type;void 0!==(e=this.$translate.instant("amlConfirmInfo.review."+e))&&(this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"amlConfirmInfo.review.thirdPartyType",text:e}]))}},{key:"_getRelationshipInfo",value:function(t){var e=this._getRelationship(t.legal_instructions.third_party_info.type);e=e.find((function(e){return e.code===t.legal_instructions.third_party_info.relationship})).name,t.legal_instructions.third_party_info.relationship===this.AMLConfirmInfoConstants.OTHER_INTENDED_USE.TYPE?this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"userSettings.general.basicInfo.relationship",text:e+" : "+t.legal_instructions.third_party_info.relationship_other}]):this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"userSettings.general.basicInfo.relationship",text:""+e}])}},{key:"_getBusinessName",value:function(t){t.business_name&&(this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"userSettings.general.basicInfo.relationship",text:""+t.business_name}]))}},{key:"_getName",value:function(t){t.legal_instructions.third_party_info.person_info&&(this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"userSettings.general.basicInfo.name",text:t.legal_instructions.third_party_info.person_info.title+" "+t.legal_instructions.third_party_info.person_info.first_name+" "+t.legal_instructions.third_party_info.person_info.last_name}]))}},{key:"_getBusinessIndustryInfo",value:function(t){var e=this;this.businessIndustriesByCode={},this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"clientOnboarding.tpiForm.labels.businessName",text:t.legal_instructions.third_party_info.corporate_info.name}]);var n=t.legal_instructions.third_party_info.corporate_info.industry;n=this.businessIndustries.find((function(t){return t.code===n})).name,this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"amlConfirmInfo.review.industry",text:n}]),this.businessIndustries.forEach((function(t){e.businessIndustriesByCode[t.code]=t}));var i=this.businessIndustriesByCode[t.legal_instructions.third_party_info.corporate_info.industry].data.find((function(e){return e.code===t.legal_instructions.third_party_info.corporate_info.nature_of_business})).name;this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"clientOnboarding.tpiForm.labels.natureOfBusiness",text:i}])}},{key:"getDateOfBirth",value:function(t){t.legal_instructions.third_party_info.person_info&&(this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"amlConfirmInfo.review.dob",text:this.DateService.convertToFormattedDayMonthYear((0,c.default)(t.legal_instructions.third_party_info.person_info.birth_date),"/")}]))}},{key:"_getOccupationInfo",value:function(t){var e=this._getIndustry(t.legal_instructions.third_party_info.person_info.industry);e.data.forEach((function(n){n.code===t.legal_instructions.third_party_info.person_info.occupation&&(e=n.name)})),this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"amlConfirmInfo.review.occupation",text:e}])}},{key:"getCorporationDetails",value:function(t){if(t.legal_instructions.third_party_info.corporate_info){var e=t.legal_instructions.third_party_info.corporate_info;this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"clientOnboarding.tpiForm.labels.businessType",text:""+this.corporationTypes.find((function(t){return t.code===e.type})).name}]),e.type===this.AMLConfirmInfoConstants.CORPORATION_BUSINESS.CORPORATION&&(this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"amlConfirmInfo.review.corporation.corpnumber",text:e.incorporation_number}]),e.incorporation_place===this.AMLConfirmInfoConstants.OTHER_INTENDED_USE.TYPE?this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"amlConfirmInfo.review.corporation.poc",text:this.incorporationPlaces.find((function(t){return t.code===e.incorporation_place})).name+":"+this.countries.find((function(t){return t.code===e.incorporation_place_other})).name}]):this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"amlConfirmInfo.review.corporation.poc",text:this.incorporationPlaces.find((function(t){return t.code===e.incorporation_place})).name}]))}}},{key:"_getPersonalIndustry",value:function(t){this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"amlConfirmInfo.review.industry",text:this.individualIndustries.find((function(e){return e.code===t.legal_instructions.third_party_info.person_info.industry})).name}])}},{key:"_getCurrentAddress",value:function(t){if(t.legal_instructions.third_party_info.address){var e=l.default.getHTMLAddress(t.legal_instructions.third_party_info.address);this.displayThirdPartyInfo=this.displayThirdPartyInfo.concat([{label:"amlConfirmInfo.review.currentAddress",text:e}])}}},{key:"isTypeBusiness",value:function(t){return t===this.AMLConfirmInfoConstants.BUSINESS_TYPE.BUSINESS||t!==this.AMLConfirmInfoConstants.BUSINESS_TYPE.INDIVIDUAL&&void 0}},{key:"_addDetailsToTable",value:function(t,e,n){return void 0!==e&&n.push({label:t,html:e}),n}},{key:"_getRelationship",value:function(t){return t===this.AMLConfirmInfoConstants.BUSINESS_TYPE.INDIVIDUAL?this.relationships.INDIVIDUAL:t===this.AMLConfirmInfoConstants.BUSINESS_TYPE.BUSINESS?this.relationships.BUSINESS:null}},{key:"_getReferenceData",value:function(){var t=this,e=this.ReferenceDataService.TYPES;return this.relationships={},this.ReferenceDataService.getDataByType([e.TPI_INDIVIDUAL_RELATIONSHIPS,e.TPI_BUSINESS_RELATIONSHIPS,e.TPI_INDIVIDUAL_INDUSTRIES,e.TPI_BUSINESS_INDUSTRIES,e.TPI_BUSINESS_TYPES,e.TPI_INCORPORATION_PLACES,e.COUNTRIES,e.INTENDED_USE_ACCOUNT]).then((function(n){t.relationships.INDIVIDUAL=n[e.TPI_INDIVIDUAL_RELATIONSHIPS],t.relationships.BUSINESS=n[e.TPI_BUSINESS_RELATIONSHIPS],t.individualIndustries=n[e.TPI_INDIVIDUAL_INDUSTRIES],t.businessIndustries=n[e.TPI_BUSINESS_INDUSTRIES],t.corporationTypes=n[e.TPI_BUSINESS_TYPES],t.incorporationPlaces=n[e.TPI_INCORPORATION_PLACES],t.countries=n[t.ReferenceDataService.TYPES.COUNTRIES];var s=n[t.ReferenceDataService.TYPES.INTENDED_USE_ACCOUNT];t.allIntendedUsesMapped=s.reduce((function(t,e){return(0,a.default)({},t,(0,i.default)({},e.code,e.data))}),{})}))}},{key:"_getOwners",value:function(){var t=this;this.displayDirectors=[],this.displayBeneficialOwner=[],this.intermediaryBeneOwners=[],this.customer.directors&&this.customer.directors.forEach((function(e){t.displayDirectors=t.displayDirectors.concat([{label:"userSettings.general.basicInfo.name",text:e.name.prefix+" "+e.name.first_name+" "+e.name.last_name}])})),this.customer.beneficial_owners&&this.customer.beneficial_owners.forEach((function(e){e.beneficial_owner_type===t.AMLConfirmInfoConstants.BUSINESS_TYPE.PERSON&&(t.displayBeneficialOwner.length<1&&t.displayBeneficialOwner.push({label:"userSettings.general.basicInfo.name",text:t.$translate.instant("amlConfirmInfo.review.ownership")}),t.displayBeneficialOwner=t.displayBeneficialOwner.concat([{label:e.name.prefix+" "+e.name.first_name+" "+e.name.last_name,text:e.percentage_of_ownership}])),e.beneficial_owner_type===t.AMLConfirmInfoConstants.BUSINESS_TYPE.BUSINESS&&(t.intermediaryBeneOwners.length<1&&t.intermediaryBeneOwners.push({label:"userSettings.general.basicInfo.name",text:t.$translate.instant("amlConfirmInfo.review.ownership")}),t.intermediaryBeneOwners=t.intermediaryBeneOwners.concat([{label:""+e.name.business_name,text:e.percentage_of_ownership}]))}))}}]),t}();h.$inject=["$log","$translate","AccountHelpersService","customerConstants","UserSettingsConstants","referenceDataConstants","eNotificationConstants","AMLConfirmInfoConstants","ReferenceDataService","AccountDetailsService","DateService","intendedUseTpiReviewConstants"],e.default=h,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5046)),a=s(n(5047));function s(t){return t&&t.__esModule?t:{default:t}}n(5048),e.default={template:i.default,controller:a.default,bindings:{index:"<",customer:"<",account:"<",parentCtrl:"<",displayAccountHeaders:"<?",editData:"<?",simpleHeaderAccount:"@?",simpleHeaderIntendedUse:"@?"}},t.exports=e.default},function(t,e){t.exports='<div class="iuItem"> <tng-intended-use class="c-iuItem--container" actionable-id="{{ ::$ctrl.account.account_number }}_iuItemType_{{ $ctrl.iuTyoe() }}" input-account-details="$ctrl.account" output-account-details="$ctrl.outputAccount" enable-account-headers="$ctrl.displayAccountHeaders" is-disabled="$ctrl.editData" header-account="{{ ::$ctrl.simpleHeaderAccount }}" header-intended-use="{{ ::$ctrl.simpleHeaderIntendedUse }}"></tng-intended-use> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=r(n(143));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.$log=e,this.$translate=n,this.outputAccount={},this.intendedUseTpiReviewConstants=a,this.EventBusService=s,this.AMLConfirmInfoConstants=r}return(0,a.default)(t,[{key:"$onInit",value:function(){}},{key:"iuTyoe",value:function(){return void 0!==this.outputAccount.legal_instructions&&(this.account.missing_intended_use?this.parentCtrl.intendedUseTpiReviewHelper.providedMissingIuData(this.outputAccount):this.parentCtrl.intendedUseTpiReviewHelper.providedNonMissingIuData(this.outputAccount),this.setEnableNext(),void 0!==this.editData&&this.editData?void 0!==this.editData&&this.editData&&(this.outputAccount.legal_instructions.intended_account_use=this.account.legal_instructions.original_intended_account_use,this.iuType=this.account.legal_instructions.original_intended_account_use):this.iuType=this.outputAccount.legal_instructions.intended_account_use),this.EventBusService.publish(this.AMLConfirmInfoConstants.USER_INTENDED_USE_FLAG,this.editData),this.iuType}},{key:"setEnableNext",value:function(){var t=this,e=this.account.missing_intended_use?this.parentCtrl.intendedUseTpiReviewHelper.allIuItemValid:this.parentCtrl.intendedUseTpiReviewHelper.allNonMissingIUItemValid;(0,s.default)(e,(function(e){e.account_number===t.outputAccount.accountNumber&&(void 0!==t.editData&&t.editData?void 0!==t.editData&&t.editData&&(e.enableNext=!0):(e.enableNext=!!t.outputAccount.legal_instructions.intended_account_use,t.outputAccount.legal_instructions.intended_account_use===t.intendedUseTpiReviewConstants.OTHER_INTENDED_USE.TYPE&&(e.enableNext=!!t.outputAccount.legal_instructions.other_intended_use)))})),this.parentCtrl.checkIuTpiFormValid()}}]),t}();o.$inject=["$log","$translate","intendedUseTpiReviewConstants","EventBusService","AMLConfirmInfoConstants"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(142),s=(i=a)&&i.__esModule?i:{default:i};var r=function(){return{restrict:"A",scope:{onImageSelect:"&?"},link:function(t,e){e.bind("change",(function(){if(e[0].files&&e[0].files.length){var n=(0,s.default)(e[0].files);t.onImageSelect&&t.$apply((function(){t.onImageSelect({files:n}),e[0].value=""}))}}))}}};r.$inject=[],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5051)),a=s(n(5052));function s(t){return t&&t.__esModule?t:{default:t}}n(5053);var r={template:i.default,controller:a.default,bindings:{actionableIdRoot:"@",titleInfo:"<",summaries:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="accordion-container"> <div class="accordion-title-container" ng-if="$ctrl.titleInfo"> <div ng-class="$ctrl.accordionIsExpanded ? \'accordion-tile tile-top accordion-is-expanded\' : \'accordion-tile tile-top-bottom\'" ng-click="$ctrl.toggleAccordion()" tng-click-outside="$ctrl.collapseAccordion()" tng-click-outside-ignore-id="{{ $ctrl.actionableIdRoot }}-accordion-summaries"> <div actionable-id="{{ $ctrl.actionableIdRoot }}-accordion-title-tile" class="accordion-title-tile"> <span actionable-id="{{ $ctrl.actionableIdRoot }}-accordion-title-tile-text" class="title-text"> {{ ::$ctrl.titleInfo.text }} </span> <span class="value-and-toggle"> <span actionable-id="{{ $ctrl.actionableIdRoot }}-accordion-title-tile-value" class="title-value"> {{ ::$ctrl.titleInfo.value }} </span> <button actionable-id="{{ $ctrl.actionableIdRoot }}-accordion-toggle-button" ng-if="$ctrl.summaries && $ctrl.summaries.length > 0"> <span class="toggle-arrow" ng-class="$ctrl.accordionIsExpanded ? \'icon-uparrow\' : \'icon-downarrow\'"></span> </button> </span> <span actionable-id="{{ $ctrl.actionableIdRoot }}-accordion-title-tile-text-value-mobile" class="text-value-mobile"> <div class="title-text-mobile">{{ ::$ctrl.titleInfo.text }}</div> <div class="title-value" ng-if="$ctrl.titleInfo.value">{{ ::$ctrl.titleInfo.value }}</div> </span> <span class="toggle-mobile"> <button actionable-id="{{ $ctrl.actionableIdRoot }}-accordion-toggle-button-mobile" ng-if="$ctrl.summaries && $ctrl.summaries.length > 0"> <span class="toggle-arrow" ng-class="$ctrl.accordionIsExpanded ? \'icon-uparrow\' : \'icon-downarrow\'"></span> </button> </span> </div> </div> </div> <div class="accordion-summaries-container" ng-if="$ctrl.summaries && $ctrl.summaries.length > 0 && $ctrl.accordionIsExpanded" ng-attr-id="{{ $ctrl.actionableIdRoot }}-accordion-summaries"> <div ng-class="$ctrl.summaries.length === $index + 1 ? \'accordion-tile tile-bottom\' : \'accordion-tile\'" ng-repeat="summary in $ctrl.summaries track by $index"> <div actionable-id="{{ $ctrl.actionableIdRoot }}-accordion-summary-tile-{{ $index }}"> <span actionable-id="{{ $ctrl.actionableIdRoot }}-accordion-summary-tile-{{ $index }}-text" class="summary-text"> {{ ::summary.text }} </span> <span class="value-and-toggle"> <span actionable-id="{{ $ctrl.actionableIdRoot }}-accordion-summary-tile-{{ $index }}-value" class="summary-value"> {{ ::summary.value }} </span> </span> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.$log=e}return(0,a.default)(t,[{key:"$onInit",value:function(){}},{key:"toggleAccordion",value:function(){this.accordionIsExpanded=!this.accordionIsExpanded}},{key:"collapseAccordion",value:function(){this.accordionIsExpanded=!1}}]),t}();r.$inject=["$log"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={DIRECT_DEPOSIT:{TYPE_OPTIONS:{PAY_CHEQUE:{KEY:"paycheque",TRANSLATION:"forms.directDepositForm.type.options.paycheque"},INVESTMENT:{KEY:"investment",TRANSLATION:"forms.directDepositForm.type.options.investment"},TAX:{KEY:"tax",TRANSLATION:"forms.directDepositForm.type.options.tax"},OTHER:{KEY:"other",TRANSLATION:"forms.directDepositForm.type.options.other"}}}};e.default=i,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(5056),s=(i=a)&&i.__esModule?i:{default:i};n(5057);var r={template:s.default,controller:angular.noop};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="g-tertiary-page c-forms"> <div class="container"> <h1 class="heading--title">{{ \'forms.title\' | translate }}</h1> </div> <tng-tertiary-nav></tng-tertiary-nav> <div class="container"> <ui-view></ui-view> </div> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5059));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(5060)).default,controller:i.default};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(177)),a=l(n(0)),s=l(n(2)),r=l(n(264)),o=l(n(266)),c=l(n(265));function l(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(t,n,s,o,c,l,u,d,h,f,p,g,m){(0,a.default)(this,e);var _=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,n,s,o,l,d,h,f,p,g,m));return _.$log=t,_.serviceConstants=c,_.BeneficiariesService=p,_.stateConstants=o,_.$state=u,_.buildConstants=f,_}return(0,c.default)(e,t),(0,s.default)(e,[{key:"$onInit",value:function(){this.pageId="bankingForms",(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"$onInit",this).call(this)}}]),e}(l(n(2348)).default);u.$inject=["$log","MenuService","menuConstants","stateConstants","serviceConstants","$translate","$state","GlobalModalsService","CustomersService","buildConstants","BeneficiariesService","EnvironmentService","$q"],e.default=u,t.exports=e.default},function(t,e){t.exports='<div class="g-tertiary-page__view fb2"> <div class="c-forms__table-wrap"> <div class="c-tile c-tile--flat-design c-tile--margin-top-lg"> <div class="c-tile__header c-tile__header--flex"> <div class="c-tile__header-title">{{ ::\'forms.banking.table.headers.name\' | translate }}/{{ ::\'forms.banking.table.headers.description\' | translate }}</div> <div class="c-tile__header-title">{{ ::\'forms.title\' | translate }}</div> </div> <tng-tile-item class="c-tile c-tile--baseline"> <div class="tile-section"> <h1>{{ ::\'forms.banking.table.directDeposit.name\' | translate }}</h1> <button class="btn--primary margin-top-sm" ng-click="$ctrl.handleButtonClick($ctrl.menuConstants.LINK_TYPES.METHOD, $ctrl.menuConstants.ACTION_METHODS.OPEN_DDF)" actionable-id="{{::$ctrl.pageId}}_directDeposit">{{ ::\'forms.buttons.view\' | translate }} </button> </div> </tng-tile-item> <tng-tile-item class="c-tile c-tile--baseline"> <div class="tile-section"> <h1>{{ ::\'forms.banking.table.boat.name\' | translate }}</h1> <button class="btn--edit margin-top-sm" ng-click="$ctrl.handleButtonClick($ctrl.menuConstants.LINK_TYPES.EXTERNAL_LINK, null, \'forms.banking.table.boat.link\')" actionable-id="{{::$ctrl.pageId}}_boatLink"> {{ ::\'forms.buttons.download\' | translate }} </button> </div> <div class="tile-section align-right">{{ ::\'forms.banking.table.boat.form\' | translate }}</div> </tng-tile-item> <tng-tile-item class="c-tile c-tile--baseline"> <div class="tile-section"> <h1>{{ ::\'forms.banking.table.DPSP.name\' | translate }}</h1> <p>{{ ::\'forms.banking.table.DPSP.description\' | translate }}</p> <button class="btn--edit margin-top-sm" ng-click="$ctrl.handleButtonClick($ctrl.menuConstants.LINK_TYPES.EXTERNAL_LINK, null, \'forms.banking.table.DPSP.link\')" actionable-id="{{::$ctrl.pageId}}_dpspForm"> {{ ::\'forms.buttons.download\' | translate }} </button> </div> <div class="tile-section align-right">{{ ::\'forms.banking.table.DPSP.form\' | translate }}</div> </tng-tile-item> <tng-tile-item class="c-tile c-tile--baseline"> <div class="tile-section"> <h1>{{ ::\'forms.banking.table.FTHB.name\' | translate }}</h1> <p>{{ ::\'forms.banking.table.FTHB.description\' | translate }}</p> <button class="btn--primary margin-top-sm" ng-click="$ctrl.handleButtonClick($ctrl.menuConstants.LINK_TYPES.EXTERNAL_LINK, null, \'forms.banking.table.FTHB.link\')" actionable-id="{{::$ctrl.pageId}}_fthbForm"> {{ ::\'forms.buttons.view\' | translate }} </button> </div> <div class="tile-section align-right">{{ ::\'forms.banking.table.FTHB.form\' | translate }}</div> </tng-tile-item> <tng-tile-item class="c-tile c-tile--baseline"> <div class="tile-section"> <h1>{{ ::\'forms.banking.table.LLP.name\' | translate }}</h1> <p>{{ ::\'forms.banking.table.LLP.description\' | translate }}</p> <button class="btn--primary margin-top-sm" ng-click="$ctrl.handleButtonClick($ctrl.menuConstants.LINK_TYPES.EXTERNAL_LINK, null, \'forms.banking.table.LLP.link\')" actionable-id="{{::$ctrl.pageId}}_llpForm"> {{ ::\'forms.buttons.view\' | translate }} </button> </div> <div class="tile-section align-right">{{ ::\'forms.banking.table.LLP.form\' | translate }}</div> </tng-tile-item> <tng-tile-item ng-if="!($ctrl.isLoading || $ctrl.isQuebecResident || $ctrl.isNonResident) && $ctrl.hasRegisteredBankingProducts" class="c-tile c-tile--baseline"> <div class="tile-section--long"> <h1>{{ ::\'forms.banking.table.BDF.name\' | translate }}</h1> <p ng-bind-html="\'forms.banking.table.BDF.description\' | translate"></p> <button class="btn--primary margin-top-sm" ng-click="$ctrl.showBeneficiariesModal()" actionable-id="{{::$ctrl.pageId}}_bdf"> {{ :: \'forms.buttons.createForm\' | translate }} </button> </div> </tng-tile-item> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5062));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(5063)).default,controller:i.default};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(177)),a=l(n(0)),s=l(n(2)),r=l(n(264)),o=l(n(266)),c=l(n(265));function l(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(t,n,s,o,c,l,u,d,h,f){return(0,a.default)(this,e),(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,l,u,d,h,f))}return(0,c.default)(e,t),(0,s.default)(e,[{key:"$onInit",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"$onInit",this).call(this)}}]),e}(l(n(2348)).default);u.$inject=["MenuService","menuConstants","stateConstants","$translate","GlobalModalsService","CustomersService","buildConstants","BeneficiariesService","EnvironmentService","$q"],e.default=u,t.exports=e.default},function(t,e){t.exports='<div class="g-tertiary-page__view fb2"> <div class="c-forms__table-wrap"> <div class="c-tile c-tile--flat-design c-tile--margin-top-lg"> <div class="c-tile__header c-tile__header--flex"> <div class="c-tile__header-title">{{ ::\'forms.banking.table.headers.name\' | translate }}/{{ ::\'forms.banking.table.headers.description\' | translate }}</div> </div> <tng-tile-item ng-if="!$ctrl.buildConstants.CONFIG.magicSwitchFundsUpgraded" class="c-tile c-tile--baseline"> <div class="tile-section"> <h1>{{ ::\'forms.investment.table.transfer.name\' | translate }}</h1> <button class="btn--edit margin-top-sm" ng-click="$ctrl.handleButtonClick($ctrl.menuConstants.LINK_TYPES.EXTERNAL_LINK, null, \'forms.investment.table.transfer.link\')" actionable-id="investment_transfer"> {{ ::\'forms.buttons.download\' | translate }} </button> </div> </tng-tile-item> <tng-tile-item ng-if="!($ctrl.isLoading || $ctrl.isNonResident || $ctrl.isQuebecResident) && \n          $ctrl.hasRegisteredInvestmentProducts" class="c-tile c-tile--baseline"> <div class="tile-section"> <h1>{{ ::\'forms.banking.table.BDF.name\' | translate }}</h1> <p ng-bind-html="\'forms.banking.table.BDF.description\' | translate"></p> <button class="btn--primary margin-top-sm" ng-click="$ctrl.showBeneficiariesModal()" actionable-id="investment_beneficiary"> {{ ::\'forms.buttons.createForm\' | translate }} </button> </div> </tng-tile-item> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5065)),a=s(n(5066));function s(t){return t&&t.__esModule?t:{default:t}}n(5067);var r={template:a.default,controller:i.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(15)),a=c(n(8)),s=c(n(104)),r=c(n(0)),o=c(n(2));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,i,a,s,o,c,l,u,d){(0,r.default)(this,t),this.$log=e,this.$window=n,this.formsConstants=l,this.selectConstants=u,this.accountService=i,this.accountHelpersService=a,this.accountDetailsService=s,this.serviceConstants=o,this.requesterService=c,this.accounts=null,this.depositTypes=[],this.showConfirmExitUI=!1,this.EnvironmentService=d}return(0,o.default)(t,[{key:"$onInit",value:function(){var t=this;this.pageId="directDepositForm",this.deposit={form:{},fields:{address:{}}},this._getDepositAccounts(),this._getDepositTypes(),this.accountDetailsService.getBankInfo().then((function(e){var n=(0,s.default)(e,1)[0],i=(0,s.default)(n.data,2);t.bankNumber=i[0],t.transitNumber=i[1]})),this.requesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_CUSTOMER_INFO).then((function(e){t.customer=e.customer}))}},{key:"isFormValid",value:function(){var t=this.deposit.fields.type===this.formsConstants.DIRECT_DEPOSIT.TYPE_OPTIONS.OTHER.KEY;return t?t&&!!this.deposit.fields.type&&!!this.deposit.fields.typeInput&&!!this.deposit.fields.account:!!this.deposit.fields.type&&!!this.deposit.fields.account}},{key:"onModalClose",value:function(){this.showConfirmExitUI=this.deposit.form.$dirty,this.showConfirmExitUI||this.onClose()}},{key:"cancel",value:function(){this.onModalClose()}},{key:"cancelClose",value:function(){this.showConfirmExitUI=!1}},{key:"confirmClose",value:function(){this.onClose()}},{key:"print",value:function(){this.$window.print()}},{key:"_getDepositAccounts",value:function(){var t=this;return this.accountService.getDirectDepositAccounts().then((function(e){t.accounts=e.toAccounts.map((function(e){return(0,a.default)({},e,{shortNumber:t.accountHelpersService.getMaskedAccountNumber(e.display_name)})}))})).catch((function(e){t.$log.error(e)}))}},{key:"_getDepositTypes",value:function(){var t=this,e=this.formsConstants.DIRECT_DEPOSIT.TYPE_OPTIONS;(0,i.default)(e).forEach((function(n){t.depositTypes.push(e[n])}))}},{key:"setAccountSelected",value:function(t){this.deposit.fields.account=t}},{key:"setDepositType",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.KEY&&(this.deposit.fields.type=t.KEY)}},{key:"isMobile",get:function(){return this.EnvironmentService.isMobile()||this.EnvironmentService.isNative()}}]),t}();l.$inject=["$log","$window","AccountService","AccountHelpersService","AccountDetailsService","serviceConstants","RequesterService","formsConstants","tngSelectAutocompleteConstants","EnvironmentService"],e.default=l,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose(result)" class="c-direct-deposit" show-confirm-exit="$ctrl.showConfirmExitUI" on-allow-exit="$ctrl.confirmClose()" on-deny-exit="$ctrl.cancelClose()"> <header class="hide-for-print"> <span ng-hide="$ctrl.showConfirmExitUI">{{ \'forms.directDepositForm.header\' | translate }}</span> </header> <div ng-if="!$ctrl.showConfirmExitUI"> <div ng-if="$ctrl.isMobile"> {{\'forms.directDepositForm.mobileContent\' | translate}} </div> <form ng-if="!$ctrl.isMobile" class="c-direct-deposit__form hide-for-print" name="$ctrl.deposit.form"> <p>{{ \'forms.directDepositForm.subHeader\' | translate }}</p> <section> <h5 class="heading--sub3">{{ \'forms.directDepositForm.depositInformation\' | translate }}</h5> <div class="field"> <label>{{ \'forms.directDepositForm.type.label\' | translate}} <tng-help-bubble>{{\'forms.directDepositForm.type.tooltip\' | translate}}</tng-help-bubble> </label> <tng-select-autocomplete ng-model="$ctrl.selectedDepositType" on-select="$ctrl.setDepositType(option)" options="$ctrl.depositTypes" option-label-key="TRANSLATION" option-value-key="KEY" placeholder="{{ ::\'forms.directDepositForm.type.select\' | translate }}" select-type="$ctrl.selectConstants.SELECT_TYPES.STATIC"> </tng-select-autocomplete> <div ng-if="$ctrl.deposit.form[$ctrl.pageId+\'_type\'].$error.required && $ctrl.deposit.form[$ctrl.pageId + \'_type\'].$touched" class="field__error"> {{\'forms.errors.required\' | translate}} </div> <div class="margin__t--fix1 margin__b--fix1" ng-if="$ctrl.deposit.fields.type === $ctrl.formsConstants.DIRECT_DEPOSIT.TYPE_OPTIONS.OTHER.KEY"> <input type="text" actionable-id="{{ ::$ctrl.pageId }}_typeInput" class="input" ng-class="{\'warning\': $ctrl.deposit.form[$ctrl.pageId + \'_typeInput\'].$error.required && $ctrl.deposit.form[$ctrl.pageId + \'_typeInput\'].$touched}" ng-model="$ctrl.deposit.fields.typeInput" required translate-attr="{placeholder: \'forms.directDepositForm.type.specify\'}"> <div ng-if="$ctrl.deposit.form[$ctrl.pageId + \'_typeInput\'].$error.required && $ctrl.deposit.form[$ctrl.pageId + \'_typeInput\'].$touched" class="field__error"> {{\'forms.errors.required\' | translate}} </div> </div> </div> <div class="field"> <label>{{ \'forms.directDepositForm.account.label\' | translate}}</label> <tng-select-autocomplete ng-if="$ctrl.accounts.length" ng-model="$ctrl.selectedToAccount" on-select="$ctrl.setAccountSelected(option)" options="$ctrl.accounts" option-label-key="description" option-right-label-key="shortNumber" option-value-key="number" placeholder="{{ ::\'forms.directDepositForm.account.select\' | translate }}" select-type="$ctrl.selectConstants.SELECT_TYPES.STATIC"> </tng-select-autocomplete> <div ng-if="$ctrl.deposit.form[$ctrl.pageId + \'_account\'].$error.required && $ctrl.deposit.form[$ctrl.pageId + \'_account\'].$touched" class="field__error"> {{\'forms.errors.required\' | translate}} </div> </div> <div class="field"> <label>{{\'forms.directDepositForm.amount\' | translate}} <span class="normal">({{\'forms.directDepositForm.optional\' | translate}})</span></label> <input type="tel" class="input" actionable-id="{{ ::$ctrl.pageId }}_amount" name="amount" ng-model="$ctrl.deposit.fields.amount"> </div> </section> <section> <h5 class="heading--sub3">{{ \'forms.directDepositForm.depositorInformation\' | translate }}</h5> <p> {{\'forms.directDepositForm.depositorSubHeader\' | translate}}</p> <div class="field"> <label>{{\'forms.directDepositForm.company\' | translate}}</label> <input type="text" class="input" actionable-id="{{ ::$ctrl.pageId }}_company" name="company" ng-model="$ctrl.deposit.fields.company"> </div> <div class="field"> <label for="{{ ::$ctrl.pageId }}_accountPolicy">{{\'forms.directDepositForm.accountPolicy\' | translate}}</label> <input type="text" class="input" actionable-id="{{ ::$ctrl.pageId }}_accountPolicy" name="accountPolicy" ng-model="$ctrl.deposit.fields.accountPolicy"> </div> <div class="field"> <label>{{\'forms.directDepositForm.address\' | translate}}</label> <tng-address-form-fields page-id="{{ ::$ctrl.pageId }}" is-required="true" errors="$ctrl.deposit.fields.address.errors" address-object="$ctrl.deposit.fields.address"></tng-address-form-fields> </div> </section> </form> </div> <footer class="hide-for-print"> <div ng-if="!$ctrl.showConfirmExitUI"> <button actionable-id="direct-deposit-cancel_btn" class="btn btn--edit" ng-click="$ctrl.cancel()"> {{ \'forms.directDepositForm.cancel\' | translate }} </button> <tng-print-button only-element="\'printMe\'" button-class="btn btn--orange" ng-disabled="!$ctrl.isFormValid()"> {{ ::\'global.print\' | translate}} </tng-print-button> </div> </footer> </tng-modal-dialog> <div class="show-for-print"> <div id="printMe" class="c-direct-deposit"> <div class="c-direct-deposit__printable-content"> <div class="info-block"> <table> <tr> <td> <h1>{{ \'forms.directDepositForm.printable.header\' | translate }}</h1> </td> <td><img class="brand-image-cell" height="60%" width="60%" ng-src="assets/images/tangerine-logo-orange.svg"/></td> </tr> </table> <p>{{ \'forms.directDepositForm.printable.subheader\' | translate }}</p> </div> <div class="info-block"> <h2>{{ \'forms.directDepositForm.printable.personalDetailsHeader\' | translate }}</h2> <table> <tr> <td>{{ \'forms.directDepositForm.printable.name\' | translate }}</td><td>{{ $ctrl.customer.first_name }} {{ $ctrl.customer.last_name }}</td> </tr> <tr><td>{{ \'forms.directDepositForm.printable.address\' | translate }}</td> <td> {{ $ctrl.customer.address_list[0].address_line1 }} <br/> <span ng-if="$ctrl.customer.address_list[0].address_line2">{{ $ctrl.customer.address_list[0].address_line2 }} <br/></span> <span ng-if="$ctrl.customer.address_list[0].suite">{{ $ctrl.customer.address_list[0].suite }} <br/></span> {{ $ctrl.customer.address_list[0].city }} <br/> {{ $ctrl.customer.address_list[0].province}} {{ $ctrl.customer.address_list[0].postal_code}} <br/> {{ $ctrl.customer.address_list[0].country}} </td> </tr> </table> </div> <div class="info-block"> <h2>{{ \'forms.directDepositForm.printable.depositDetailsHeader\' | translate }}</h2> <table> <tr><td>{{ \'forms.directDepositForm.printable.companyOrOrganization\' | translate }}</td><td>{{ $ctrl.deposit.fields.company }}</td></tr> <tr><td>{{ \'forms.directDepositForm.printable.accountOrPolicyNumber\' | translate }}</td><td>{{ $ctrl.deposit.fields.accountPolicy }}</td></tr> <tr><td>{{ \'forms.directDepositForm.printable.address\' | translate }}</td> <td> {{ $ctrl.deposit.fields.address.address_line1 }} <br/> <span ng-if="$ctrl.deposit.fields.address.address_line2">{{ $ctrl.deposit.fields.address.address_line2 }} <br/></span> <span ng-if="$ctrl.deposit.fields.address.suite">{{ $ctrl.deposit.fields.address.suite }} <br/></span> {{ $ctrl.deposit.fields.address.city }} {{ $ctrl.deposit.fields.address.province }} {{ $ctrl.deposit.fields.address.postal_code }} <br/> {{ $ctrl.deposit.fields.address.country }} </td> </tr> <tr> <td>{{ \'forms.directDepositForm.printable.depositType\' | translate }}</td> <td>{{ $ctrl.deposit.fields.type }}<span ng-if="$ctrl.deposit.fields.typeInput">({{ $ctrl.deposit.fields.typeInput }})</span></td> </tr> <tr><td>{{ \'forms.directDepositForm.printable.amount\' | translate }}</td><td>{{ $ctrl.deposit.fields.amount }}</td></tr> </table> </div> <div class="info-block"> <h2>{{ \'forms.directDepositForm.printable.bankAccountDetailsHeader\' | translate }}</h2> <table> <tr><td><span ng-bind-html="\'forms.directDepositForm.printable.tangerineAccountNumber\' | translate"></span></td><td>{{ $ctrl.deposit.fields.account.display_name }}</td></tr> <tr><td><span ng-bind-html="\'forms.directDepositForm.printable.institutionNumber\' | translate"></span></td><td>{{ $ctrl.bankNumber.code }}</td></tr> <tr><td><span ng-bind-html="\'forms.directDepositForm.printable.transitNumber\' | translate"></span></td><td>{{ $ctrl.transitNumber.code }}</td></tr> </table> </div> <div class="info-block"> <br/> <br/> <p>{{ \'forms.directDepositForm.printable.signingStatement\' | translate }}</p> <p>{{ \'forms.directDepositForm.printable.signature\' | translate }} ________________________________ {{ \'forms.directDepositForm.printable.date\' | translate }} ____________________</p> </div> </div> </div> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=h(n(5069)),a=h(n(5073)),s=h(n(5077)),r=h(n(5081)),o=h(n(5085)),c=h(n(5089)),l=h(n(5090)),u=h(n(5094)),d=h(n(5095));function h(t){return t&&t.__esModule?t:{default:t}}var f=angular.module("BeneficiariesModalModule",[]).constant("BeneficiariesModalConstants",u.default).component("tngBeneficiariesModal",i.default).component("tngBeneficiariesProductType",a.default).component("tngBeneficiariesPlans",s.default).component("tngBeneficiariesConfirmation",r.default).component("tngBeneficiaryForm",o.default).component("tngBeneficiariesSetup",l.default).component("tngBeneficiaryUpdateModal",d.default).service("BeneficiariesFlowService",c.default);e.default=f,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5070)),a=s(n(5071));function s(t){return t&&t.__esModule?t:{default:t}}n(5072);var r={template:i.default,controller:a.default,bindings:{onClose:"&",accountNumber:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog class="c-beneficiaries-modal" hide-close="$ctrl.hideClose" on-close="$ctrl.onModalClose(result)" flow-service="$ctrl.flowService"> <header> <div ng-if="!$ctrl.flowService.showConfirmExitUI"> {{ $ctrl.flowService.currentState.titleKey | translate }} </div> </header> <div ng-if="$ctrl.flowService.isLoading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div ng-if="$ctrl.flowService.isDoneLoading"> <tng-loading-done></tng-loading-done> </div> <div ng-hide="$ctrl.flowService.showConfirmExitUI || $ctrl.flowService.inLoadingMode"> <tng-error-message ng-if="$ctrl.hasSubmitErrors"> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> <div ng-if="!$ctrl.fatalInitError"> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.PRODUCT_TYPE"> <tng-beneficiaries-product-type plan-list="$ctrl.plans" on-enable-next="$ctrl.onEnableNext(enable)" products="$ctrl.products" selected-products="$ctrl.selectedProducts"> </tng-beneficiaries-product-type> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.PLANS"> <tng-beneficiaries-plans plan-list="$ctrl.plansFiltered" on-enable-next="$ctrl.onEnableNext(enable)" selected-plans="$ctrl.selectedPlans"> </tng-beneficiaries-plans> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.FORM"> <tng-beneficiary-form product="$ctrl.currentProduct" marital-status-options="$ctrl.calculatedMaritalStatusOptions" on-enable-next="$ctrl.onEnableNext(enable)" on-add-or-edit="$ctrl.resetSubmitErrors()" relationship-status-options="$ctrl.relationshipStatusOptions" customer-info="$ctrl.customerInfo"> </tng-beneficiary-form> </div> <div class="c-beneficiaries-modal__address" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.CONFIRMATION"> <tng-beneficiaries-confirmation plan-name="$ctrl.planName" plan-id="$ctrl.planId" printed-payload="$ctrl.printedPayload"> </tng-beneficiaries-confirmation> </div> </div> </div> <footer ng-hide="$ctrl.flowService.showConfirmExitUI || $ctrl.flowService.inLoadingMode"> <button actionable-id="{{$ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_GRY.type.label)}}" legacy-actionable-id="beneficiaries-cancel_btn" watch-actionable-id="true" class="btn btn--edit" ng-show="$ctrl.flowService.BUTTONS.BTN_GRY.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_GRY.disable" ng-click="$ctrl.flowService.onButtonClick($ctrl.flowService.BUTTONS.BTN_GRY)"> {{ $ctrl.flowService.BUTTONS.BTN_GRY.type.label | translate }} </button> <button actionable-id="{{$ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_ORG.type.label)}}" legacy-actionable-id="beneficiaries-next_btn" watch-actionable-id="true" class="btn btn--orange" ng-class="{\'CB_ReadOnly\': $ctrl.flowService.CB_DISABLED_BUTTONS.includes($ctrl.flowService.BUTTONS.BTN_ORG.type)}" ng-show="$ctrl.flowService.BUTTONS.BTN_ORG.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_ORG.disable" ng-click="$ctrl.flowService.onButtonClick($ctrl.flowService.BUTTONS.BTN_ORG)"> {{ $ctrl.flowService.BUTTONS.BTN_ORG.type.label | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(8)),a=u(n(15)),s=u(n(269)),r=u(n(365)),o=u(n(68)),c=u(n(0)),l=u(n(2));function u(t){return t&&t.__esModule?t:{default:t}}var d=function(){function t(e,n,i,a,s,r,o,l,u,d,h,f,p,g,m,_,v,S,T){(0,c.default)(this,t),this.$q=e,this.$log=n,this.$timeout=i,this.$translate=s,this.maskNumberFilter=a("maskNumber"),this.BeneficiariesService=r,this.flowService=o,this.BeneficiariesModalConstants=l,this.PRODUCT_TYPES=this.BeneficiariesModalConstants.PRODUCT_TYPES,this.TILE_TYPE=u.TILE_TYPE,this.LocaleService=d,this.PDFRequestService=h,this.ErrorService=f,this.ERROR_EVENTS=p.AVAILABLE_EVENTS,this.accountConstants=g,this.$stateParams=m,this.ReferenceDataService=_,this.referenceDataConstants=v,this.pageFlowConstants=S,this.CustomersService=T}return(0,l.default)(t,[{key:"$onInit",value:function(){var t=this;this.fatalInitError=!1,this.flowService.onButtonClickCancel=function(){t._cancel()},this.flowService.onButtonClickBack=function(){t._goBackState()},this.flowService.onButtonClickDone=function(){t._done()},this.flowService.onButtonClickPrint=function(){t._print()},this.flowService.onButtonClickContinue=function(){t._gotoNextState()},this.flowService._updateUI=function(){t._updateUI()},this.flowService.gotoNextState=function(){t._gotoNextState()},this.flowService.setInitialState(this.flowService.STATES.INIT_STATE),this._resetModel(),this.flowService.activate();var e=[this._loadRegisteredPlans(),this._getReferenceData(),this._getCustomerInfo()];this.flowService.enterLoadingMode(),this.$q.all(e).then((function(){t._getProductsFromPlans(),t.accountNumber&&t._preSelectProductByAccountNumber(),t.flowService.moveTo(t.flowService.STATES.PRODUCT_TYPE)})).catch((function(e){t.$log.error("Beneficiaries modal init setup error",e),t.showSubmitErrors(e),t.fatalInitError=!0})).finally((function(){t._updateUI(),t.flowService.exitLoadingMode()}))}},{key:"_getCustomerInfo",value:function(){var t=this;return this.CustomersService.getCustomerInfo({include_servicing_systems:!0}).then((function(e){t.$log.debug("Beneficiary Update Modal: GET Customers Info response: ",e),t.customerInfo=e.customer})).catch((function(e){throw t.$log.error(e),e}))}},{key:"_loadRegisteredPlans",value:function(){var t=this;return this.BeneficiariesService.getRegisteredPlans().then((function(e){(e.registered_plans&&(t.plans=[].concat((0,o.default)(e.registered_plans))),e.investment_plans)&&e.investment_plans.forEach((function(e){t.plans.push({isMutualFund:!0,productType:e.registered_product_type,planDescription:e.nickname,planMaskedMFAccountNumber:"# "+t.maskNumberFilter(e.display_name),accounts:[e]})}));t.plans.forEach((function(t){t.planDescription&&(t.planDescription=t.planDescription.trim())})),t.plans.sort((function(e,n){var i=t.referenceDataConstants.PRODUCT_TYPE_SORT_ORDER;return i[t.getProductTypeByPlan(e)]-i[t.getProductTypeByPlan(n)]}))}))}},{key:"_getReferenceData",value:function(){var t=this;return this.ReferenceDataService.getDataByType([this.referenceDataConstants.TYPES.MARITAL_STATUS,this.referenceDataConstants.TYPES.BENEFICIARY_RELATIONSHIP_STATUS]).then((function(e){var n=t.referenceDataConstants.MARITAL_STATUS_CODES,i=(0,r.default)(t.referenceDataConstants.MARITAL_STATUS_CODES).filter((function(t){return-1!==[n.SINGLE,n.MARRIED,n.COMMON_LAW,n.UNKNOWN].indexOf(t)}));t._maritalStatusOptions=e[t.referenceDataConstants.TYPES.MARITAL_STATUS].filter((function(t){return-1!==i.indexOf(t.code)})).sort((function(e,n){var i=t.referenceDataConstants.MARITAL_STATUS_CODES_SORT_ORDER;return i[e.code]-i[n.code]})),t.LocaleService.isFrench()||(t._maritalStatusOptions.find((function(t){return t.code===n.UNKNOWN})).name=t.$translate.instant("forms.banking.beneficiary.modal.form.maritalStatusOther")),t.relationshipStatusOptions=e[t.referenceDataConstants.TYPES.BENEFICIARY_RELATIONSHIP_STATUS].sort((function(e,n){var i=t.referenceDataConstants.BENEFICIARY_RELATIONSHIP_STATUS_SORT_ORDER;return i[e.code]-i[n.code]}))})).catch((function(e){throw t.$log.error("Beneficiary Form - get reference data error:",e),e}))}},{key:"_getProductsFromPlans",value:function(){var t=this,e=this.BeneficiariesModalConstants.PLAN_TYPES,n=this.plans.reduce((function(e,n){return e.add(t.getProductTypeByPlan(n)),e}),new s.default);this.products=(0,a.default)(e).reduce((function(t,e){return n.has(e)?[].concat((0,o.default)(t),[{productType:e,header:"forms.banking.beneficiary.modal.productType."+e}]):t}),[])}},{key:"getProductTypeByPlan",value:function(t){var e=this.BeneficiariesModalConstants.PLAN_TYPES,n=(0,a.default)(e).reduce((function(t,n){return t[e[n]]=n,t}),{});return t.isMutualFund?t.productType:n[t.planType]}},{key:"_preSelectProductByAccountNumber",value:function(){var t=this;if(this.accountNumber&&this.plans){var e=this.plans.find((function(e){return Array.isArray(e.accounts)&&e.accounts.find((function(e){return e.display_name===t.accountNumber}))}));e?(this.selectedPlans=[e],this.selectedProducts=this.products.filter((function(n){return n.productType===t.getProductTypeByPlan(e)})),this._filterPlansBySelectedProducts()):this.selectedProducts=[].concat((0,o.default)(this.products))}}},{key:"_resetModel",value:function(){this._currentProductIndex=0,this.selectedPlans=[],this.plans=[],this.plansFiltered=null,this.products=[],this.selectedProducts=[]}},{key:"_close",value:function(){var t=this;this.flowService.showConfirmExitUI?this.flowService.denyExit():this.flowService.warn().then((function(){t.onClose&&t.onClose()}))}},{key:"onModalClose",value:function(){this._close()}},{key:"_cancel",value:function(){this.$log.debug("CANCEL ACTION"),this._close()}},{key:"_done",value:function(){this.$log.debug("DONE ACTION"),this.flowService.hideWarning(),this._close()}},{key:"_getPayload",value:function(t,e){var n=this,i=e?[this.currentProduct]:this.activeSelectedProducts;return{version:2,language:this.LocaleService.language,validate_only:t,designations:i.map((function(t){return n._getProductPayload(t)}))}}},{key:"_getProductPayload",value:function(t){var e=this,n=t.planList,a=t.planList.reduce((function(t,e){return e.accounts.forEach((function(e){t.push(e)})),t}),[]),s=[].concat((0,o.default)(t.beneficiaries));Array.isArray(t.successors)&&t.successors.length>0&&s.push.apply(s,(0,o.default)(t.successors));var r=s.map((function(t,n){var a=(0,i.default)({sequence:""+(n+1)},t);return e.BeneficiariesService.sanitizeBeneficiary(a),a})),c={RSP:t.productType===this.PRODUCT_TYPES.RSP,plan_numbers:n.map((function(t){return t.isMutualFund?t.accounts[0].display_name:t.planId})),account_numbers:a.map((function(t){return t.display_name})),beneficiaries:r};return c.RSP||(c.marital_status=this._mapMaritalStatusCode(t.maritalStatus)),c}},{key:"_print",value:function(){var t=this,e=this._getPayload(!0,!0);this.flowService.enterLoadingMode(),this.BeneficiariesService.beneficiaryFormValidation(e).then((function(){t.flowService.showLoadingDoneIcon(),t.$timeout((function(){t.printedPayload=t._getPayload(!1,!1),t.flowService.moveTo(t.flowService.STATES.CONFIRMATION),t.flowService.exitLoadingMode()}),t.pageFlowConstants.MODAL_VISIBILITY_TIMEOUT)})).catch((function(e){t.flowService.exitLoadingMode(),t.showSubmitErrors(e)}))}},{key:"_mapMaritalStatusCode",value:function(t){var e=this.referenceDataConstants.MARITAL_STATUS_CODES;switch(t){case e.MARRIED:return"2";case e.COMMON_LAW:return"3";default:return"1"}}},{key:"_goBackState",value:function(){var t=this.flowService;switch(t.currentState){case t.STATES.FORM:this._currentProductIndex>0?(this._currentProductIndex=this._currentProductIndex-1,this._updateUI()):this.flowService.gotoPreviousState();break;default:this.flowService.gotoPreviousState()}}},{key:"_gotoNextState",value:function(){var t=this,e=this.flowService,n=e.currentState,i=e.STATES;switch(n){case i.PRODUCT_TYPE:this._onProductsSelected(),this.flowService.moveTo(this.flowService.STATES.PLANS);break;case i.PLANS:this._groupPlansByProduct(),this.flowService.moveTo(this.flowService.STATES.FORM);break;case i.FORM:var a=this._getPayload(!0,!0);return this.flowService.enterLoadingMode(),this.BeneficiariesService.beneficiaryFormValidation(a).then((function(){t.flowService.exitLoadingMode(),t._currentProductIndex=t._currentProductIndex+1,t._updateUI()})).catch((function(e){t.flowService.exitLoadingMode(),t.showSubmitErrors(e)}))}return this.$q.resolve()}},{key:"onEnableNext",value:function(t){this.flowService.BUTTONS.BTN_ORG.disable=this.fatalInitError||!t}},{key:"_onProductsSelected",value:function(){this.$log.debug("beneficiariesModal - selected products",this.selectedProducts),this._filterPlansBySelectedProducts()}},{key:"_filterPlansBySelectedProducts",value:function(){var t=this,e=this.BeneficiariesModalConstants,n=e.PLAN_TYPES,i=e.PRODUCT_TYPES;this.plansFiltered=this.plans.filter((function(e){return!e.isMutualFund&&t.selectedProducts.find((function(t){return e.planType===n[t.productType]}))||e.isMutualFund&&t.selectedProducts.find((function(t){return e.productType===i[t.productType]}))})),this.selectedPlans.length>0&&(this.selectedPlans=this.selectedPlans.filter((function(e){return t.selectedProducts.some((function(n){return n.productType===t.getProductTypeByPlan(e)}))})))}},{key:"_groupPlansByProduct",value:function(){var t=this,e=this.BeneficiariesModalConstants.PRODUCT_TYPES,n=this.selectedPlans.filter((function(n){return t.getProductTypeByPlan(n)===e.RSP})),i=this.selectedPlans.filter((function(n){return t.getProductTypeByPlan(n)!==e.RSP}));this.selectedProducts.forEach((function(t){t.planList=t.productType===e.RSP?n:i,t.beneficiaries||(t.beneficiaries=[]),t.successors||(t.successors=[])})),this._currentProductIndex=0}},{key:"_resetCalculatedMaritalStatusOptions",value:function(){var t=this.referenceDataConstants.MARITAL_STATUS_CODES,e=this.BeneficiariesModalConstants.RELATIONSHIP;if(this._calculatedMaritalStatusOptions=this._maritalStatusOptions,1===this._currentProductIndex){var n=this.activeSelectedProducts[0].beneficiaries.find((function(t){return-1!==[e.SPOUSE,e.COMMON_LAW].indexOf(t.relationship)}));n&&(this._calculatedMaritalStatusOptions=this._maritalStatusOptions.filter((function(i){return i.code===(n.relationship===e.SPOUSE?t.MARRIED:t.COMMON_LAW)})))}}},{key:"_updateUI",value:function(){var t=this.flowService,e=t.currentState,n=t.BUTTON_TYPES,i=t.BUTTONS,a=t.STATES;if(i.BTN_GRY.show=!0,i.BTN_GRY.disable=!1,i.BTN_ORG.show=!0,i.BTN_ORG.disable=!1,this.fatalInitError)return i.BTN_ORG.show=!1,void(i.BTN_GRY.type=n.CANCEL);switch(this.resetSubmitErrors(),e){case a.PRODUCT_TYPE:i.BTN_GRY.type=n.CANCEL,i.BTN_ORG.type=n.NEXT,this._hasAnyBeneficiaries||this.flowService.hideWarningOnExit();break;case a.PLANS:i.BTN_GRY.type=n.BACK,i.BTN_ORG.type=n.NEXT,this._hasAnyBeneficiaries||this.flowService.hideWarningOnExit();break;case a.FORM:i.BTN_GRY.type=n.BACK,i.BTN_ORG.type=this._currentProductIndex===this.activeSelectedProducts.length-1?n.PRINT:n.NEXT,i.BTN_ORG.show=!0,i.BTN_ORG.disable=!0,this._resetCalculatedMaritalStatusOptions();break;case a.CONFIRMATION:i.BTN_GRY.type=n.BACK,i.BTN_ORG.type=n.DONE,i.BTN_GRY.show=!0,i.BTN_ORG.show=!0;break;default:this.$log.warn("Unrecognized state passed")}}},{key:"showSubmitErrors",value:function(t){var e=this;return this.submitErrors=[],this.ErrorService.processError(t,this.ERROR_EVENTS.REQUEST_ERROR).then((function(t){e.submitErrors.push(t.message),e.flowService.AnchorService.scrollToModalTop()}))}},{key:"resetSubmitErrors",value:function(){this.$log.debug("resetting submit errors"),this.submitErrors=[]}},{key:"activeSelectedProducts",get:function(){var t=this.BeneficiariesModalConstants.PRODUCT_TYPES,e=this.selectedProducts.filter((function(t){return t&&t.planList&&t.planList.length>0})).sort((function(e){return e.productType===t.RSP?-1:1}));return e.some((function(e){return e.productType===t.TFSA}))&&e.some((function(e){return e.productType===t.RIF}))&&e.pop(),e}},{key:"currentProduct",get:function(){return this.activeSelectedProducts[this._currentProductIndex]}},{key:"isRSP",get:function(){return this.currentProduct.productType===this.PRODUCT_TYPES.RSP}},{key:"isRIF",get:function(){return this.currentProduct.productType===this.PRODUCT_TYPES.RIF}},{key:"isTFSA",get:function(){return this.currentProduct.productType===this.PRODUCT_TYPES.TFSA}},{key:"calculatedMaritalStatusOptions",get:function(){return this._calculatedMaritalStatusOptions}},{key:"_hasAnyBeneficiaries",get:function(){return this.activeSelectedProducts&&this.activeSelectedProducts.some((function(t){return t.beneficiaries.length>0||t.successors.length>0}))}},{key:"hasSubmitErrors",get:function(){return this.submitErrors&&this.submitErrors.length>0}}]),t}();d.$inject=["$q","$log","$timeout","$filter","$translate","BeneficiariesService","BeneficiariesFlowService","BeneficiariesModalConstants","tngTileListConstants","LocaleService","PDFRequestService","ErrorService","errorConstants","accountConstants","$stateParams","ReferenceDataService","referenceDataConstants","pageFlowConstants","CustomersService"],e.default=d,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5074)),a=s(n(5075));function s(t){return t&&t.__esModule?t:{default:t}}n(5076);var r={template:i.default,controller:a.default,bindings:{planList:"<",onEnableNext:"&",products:"<",selectedProducts:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-beneficiaries-product-type"> <p>{{ ::\'forms.banking.beneficiary.modal.productType.desc\' | translate }}</p> <tng-tile-list tile-data="$ctrl.products" tile-type="$ctrl.TILE_TYPE.text" all-actionable="true" multi-select="true" selected-tiles="$ctrl.selectedProducts" on-tile-click="$ctrl.onTileSelect(index, tileData, selectedTiles)" hide-arrow="$ctrl.isArrowDisabled"> </tng-tile-list> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.$log=e}return(0,a.default)(t,[{key:"$onInit",value:function(){this._nextEnabled(),this.isArrowDisabled=!0}},{key:"_nextEnabled",value:function(){var t=Array.isArray(this.selectedProducts)&&this.selectedProducts.length>0;this.onEnableNext({enable:t})}},{key:"onTileSelect",value:function(t,e,n){this.$log.debug("beneficiariesProductType - selected product",t,e,n),this._nextEnabled()}}]),t}();r.$inject=["$log"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5078)),a=s(n(5079));function s(t){return t&&t.__esModule?t:{default:t}}n(5080);var r={template:i.default,controller:a.default,bindings:{planList:"<",selectedPlans:"<",onEnableNext:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-beneficiaries-plans"> <p>{{ ::\'forms.banking.beneficiary.modal.desc\' | translate }}</p> <tng-tile-list tile-data="$ctrl.planList" tile-type="$ctrl.TILE_TYPE.accountBeneficiary" all-actionable="true" multi-select="true" selected-tiles="$ctrl.selectedPlans" on-tile-click="$ctrl.onTileSelect(index, tileData, selectedTiles)" hide-arrow="$ctrl.isArrowDisabled"> </tng-tile-list> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.$log=e,this.TILE_TYPE=n.TILE_TYPE}return(0,a.default)(t,[{key:"$onInit",value:function(){this._nextEnabled(),this.isArrowDisabled=!0}},{key:"_nextEnabled",value:function(){var t=Array.isArray(this.selectedPlans)&&this.selectedPlans.length>0;this.onEnableNext({enable:t})}},{key:"onTileSelect",value:function(t,e,n){this.$log.info("beneficiariesPlans - selected plan",t,e,n),this._nextEnabled()}}]),t}();r.$inject=["$log","tngTileListConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5082)),a=s(n(5083));function s(t){return t&&t.__esModule?t:{default:t}}n(5084);var r={template:i.default,controller:a.default,bindings:{printedPayload:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports=" <div class=\"c-beneficiaries-confirmation\"> <p> {{ ::'forms.banking.beneficiary.confirmation.desc' | translate }} </p> <div> <strong> {{ ::'forms.banking.beneficiary.confirmation.address.tangerine' | translate }} </strong> <strong> {{ ::'forms.banking.beneficiary.confirmation.address.street' | translate }} </strong> <strong> <span ng-bind-html=\"::'forms.banking.beneficiary.confirmation.address.city' | translate\"> </span> </strong> </div> <div class=\"c-beneficiaries-modal note-margin\"> <p>{{ ::'forms.banking.beneficiary.confirmation.note' | translate }}</p> </div> <div> <p>{{ ::'forms.banking.beneficiary.confirmation.manualPrint.description' | translate }}</p> </div> <button actionable-id=\"beneficiaries-confirm-print-again\" class=\"btn\" ng-click=\"$ctrl.print()\"> {{ ::'forms.banking.beneficiary.confirmation.manualPrint.button' | translate }} </button> </div> "},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.PDFRequestService=e}return(0,a.default)(t,[{key:"$onInit",value:function(){this.print()}},{key:"print",value:function(){this.PDFRequestService.viewBeneficiaryForm(this.printedPayload)}}]),t}();r.$inject=["PDFRequestService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5086)),a=s(n(5087));function s(t){return t&&t.__esModule?t:{default:t}}n(5088);var r={template:i.default,controller:a.default,bindings:{product:"<",maritalStatusOptions:"<",onEnableNext:"&",onAddOrEdit:"&?",relationshipStatusOptions:"<",customerInfo:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<ng-form name="$ctrl.beneficiaryForm" class="c-beneficiaries-modal-form" novalidate> <div> <p ng-if="$ctrl.isRSP" class="botton-margin-small" ng-bind-html="\'forms.banking.beneficiary.modal.form.desc1_RSP\' | translate: {\n      planName: $ctrl.planNames,\n      numOfAccounts: $ctrl.accounts.length}"> </p> <p ng-if="!$ctrl.isRSP" class="botton-margin-small" ng-bind-html="\'forms.banking.beneficiary.modal.form.desc1_RIF_TFSA\' | translate: {\n      planName: $ctrl.planNames,\n      numOfAccounts: $ctrl.accounts.length}"> </p> <div class="account-section"> <div class="grid__container"> <account-card class="account-card-grid-item" account="account" is-tile-view="true" ng-repeat="account in $ctrl.accountsWithBalance"> </account-card> </div> </div> </div> <div class="field" ng-if="!$ctrl.isRSP"> <label>{{ ::\'forms.banking.beneficiary.modal.form.maritalStatusTitle\' | translate }}</label> <p ng-if="$ctrl.showMaritalStatusMessage"> {{ ::\'forms.banking.beneficiary.modal.form.maritalStatusMessage\' | translate }} </p> <tng-select-autocomplete input-id="benef_form_marital_status" ng-model="$ctrl.product.maritalStatus" ng-required="true" on-select="$ctrl.maritalStatusChanged()" options="$ctrl.maritalStatusOptions" option-label-key="name" placeholder="{{ ::\'forms.banking.beneficiary.modal.form.pleaseSelect\' | translate }}" select-type="$ctrl.COMPONENT_CONSTANTS.SELECT_TYPES.STATIC"></tng-select-autocomplete> </div> <div class="successors-section" ng-if="$ctrl.showSuccessorSection"> <div> <h2 class="section-title-bar"> <span> {{ ::\'forms.banking.beneficiary.modal.form.successors.title\' | translate }} </span> <tng-help-bubble> {{ ::\'forms.banking.beneficiary.modal.form.successors.titleTooltip\' | translate }} </tng-help-bubble> </h2> </div> <tng-beneficiaries-setup beneficiaries="$ctrl.product.successors" is-successor="true" relationship-status-options="$ctrl.relationshipStatusOptions" customer-info="$ctrl.customerInfo" marital-status-code="$ctrl.product.maritalStatus" can-add="true" disable-add="$ctrl.hasSpouseOrCommonLawBeneficiary" disable-modal-animation="true" max-amount="1" on-enable-next="$ctrl.successorsUpdated()" on-add-or-edit="$ctrl.onAddOrEdit()"> </tng-beneficiaries-setup> </div> <div class="medium-top-margin c-beneficiaries-modal-form__beneficiaries"> <div> <h2 class="section-title-bar"> <span> {{ ::\'forms.banking.beneficiary.modal.form.beneficiaries.title\' | translate }} </span> <tng-help-bubble> {{ ::\'forms.banking.beneficiary.modal.form.beneficiaries.titleTooltip\' | translate }} </tng-help-bubble> </h2> </div> <tng-beneficiaries-setup beneficiaries="$ctrl.product.beneficiaries" is-successor="false" relationship-status-options="$ctrl.relationshipStatusOptions" customer-info="$ctrl.customerInfo" marital-status-code="$ctrl.product.maritalStatus" product-has-successor="$ctrl.hasSuccessor" is-percentage-editable="true" disable-modal-animation="true" can-add="true" on-enable-next="$ctrl.beneficiariesUpdated(enableNext)" on-add-or-edit="$ctrl.onAddOrEdit()" max-amount="$ctrl.BeneficiariesModalConstants.SETUP_CONST.MAX_BENEFICIARIES"> </tng-beneficiaries-setup> </div>  </ng-form>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(8)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s,r){(0,a.default)(this,t),this.$log=e,this.flowService=n,this.referenceDataConstants=i,this.BeneficiariesModalConstants=s,this.AccountService=r,this.beneficiaryForm={}}return(0,s.default)(t,[{key:"$onChanges",value:function(){this.accounts=this.product.planList.reduce((function(t,e){return e.accounts.forEach((function(e){t.push(e)})),t}),[]),this.updateAccountsAmount(this.accounts),this.beneficiariesValid=!0,1===this.maritalStatusOptions.length?(this.product.maritalStatus=this.maritalStatusOptions[0].code,this.showMaritalStatusMessage=!0):this.showMaritalStatusMessage=!1,this.isRSP?this.flowService.STATES.FORM.titleKey="forms.banking.beneficiary.modal.form.title_RSP":this.flowService.STATES.FORM.titleKey="forms.banking.beneficiary.modal.form.title_RIF_TFSA"}},{key:"successorsUpdated",value:function(){this._checkNextPrintEnablement()}},{key:"beneficiariesUpdated",value:function(t){this.beneficiariesValid=t,this._checkNextPrintEnablement()}},{key:"_checkNextPrintEnablement",value:function(){var t=(this.product.successors.length>0||this.product.beneficiaries.length>0)&&this.beneficiariesValid&&this.beneficiaryForm.$valid;this.onEnableNext({enable:t})}},{key:"maritalStatusChanged",value:function(){var t=this.referenceDataConstants.MARITAL_STATUS_CODES,e=this.BeneficiariesModalConstants.RELATIONSHIP,n=this.product.maritalStatus===t.MARRIED?e.SPOUSE:e.COMMON_LAW;if(this.product.successors.length>0&&(this.product.successors[0].relationship=n),this.product.beneficiaries.length>0){var i=this.product.beneficiaries.find((function(t){return t.relationship===e.SPOUSE||t.relationship===e.COMMON_LAW}));i&&(i.relationship=n)}this.flowService.showWarningOnExit()}},{key:"updateAccountsAmount",value:function(t){var e=this;this.AccountService.getAccountBalances().then((function(n){e.$log.log("Latest accounts with amounts:",n),e.accountsWithBalance=t.map((function(t){var e=n.accounts.filter((function(e){return e.display_name===t.display_name}))[0].account_balance;return(0,i.default)({},t,{account_balance:e})}))})).catch((function(t){e.$log.error(t)}))}},{key:"planNames",get:function(){return this.product.planList.map((function(t){return t.isMutualFund?t.planDescription+" "+t.planMaskedMFAccountNumber:""+t.planDescription+t.planId})).join(", ")}},{key:"isRSP",get:function(){return this.product.productType===this.BeneficiariesModalConstants.PRODUCT_TYPES.RSP}},{key:"showSuccessorSection",get:function(){var t=this.BeneficiariesModalConstants.PRODUCT_TYPES;return-1!==[this.referenceDataConstants.MARITAL_STATUS_CODES.MARRIED,this.referenceDataConstants.MARITAL_STATUS_CODES.COMMON_LAW].indexOf(this.product.maritalStatus)&&this.product.productType!==t.RSP}},{key:"hasSpouseOrCommonLawBeneficiary",get:function(){var t=this.BeneficiariesModalConstants.RELATIONSHIP;return!!this.product.beneficiaries.find((function(e){return e.relationship===t.SPOUSE||e.relationship===t.COMMON_LAW}))}},{key:"hasSuccessor",get:function(){return this.product.successors.length>0}}]),t}();o.$inject=["$log","BeneficiariesFlowService","referenceDataConstants","BeneficiariesModalConstants","AccountService"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(177)),a=u(n(0)),s=u(n(2)),r=u(n(264)),o=u(n(265)),c=u(n(267)),l=n(364);function u(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(t,n,s,o,c,u,d,h,f,p){(0,a.default)(this,e);var g=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,u,f,d));return g.$log=t,g.$translate=h,g.BUTTON_TYPES=f.BUTTON_TYPES,g.AnchorService=p,g.STATES={INIT_STATE:{titleKey:"forms.banking.beneficiary.modal.productType.title"},PRODUCT_TYPE:{titleKey:"forms.banking.beneficiary.modal.productType.title"},PLANS:{titleKey:"forms.banking.beneficiary.modal.title"},FORM:{titleKey:""},CONFIRMATION:{titleKey:"forms.banking.beneficiary.confirmation.title"}},g._initialState=g.STATES.INIT_STATE,g.BUTTONS={BTN_GRY:new l.ModalFooterButton(g.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new l.ModalFooterButton(g.BUTTON_TYPES.CANCEL,!1,!0)},g}return(0,o.default)(e,t),(0,s.default)(e,[{key:"_getAnalyticsID",value:function(){return"beneficiaries"}},{key:"_conditionalScrollToTop",value:function(){this.AnchorService.scrollToModalTop()}}]),e}(c.default);d.$inject=["$log","$q","$transitions","$state","$window","$rootScope","AnalyticsService","$translate","pageFlowConstants","AnchorService"],e.default=d,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5091)),a=s(n(5092));function s(t){return t&&t.__esModule?t:{default:t}}n(5093);var r={template:i.default,controller:a.default,bindings:{beneficiaries:"<",productType:"<",isSuccessor:"<",productHasSuccessor:"<",isAccountDetails:"<",customerInfo:"<",relationshipStatusOptions:"<",isPercentageEditable:"<",onEnableNext:"&",onAddOrEdit:"&?",disableModalAnimation:"<?",canAdd:"<",disableAdd:"<?",maxAmount:"<",maritalStatusCode:"<?",planNumber:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-beneficiaries-setup"> <div> <div ng-if="!$ctrl.hasBeneficiaries && !$ctrl.isAccountDetails" class="empty-text"> <strong> {{ :: (!$ctrl.isSuccessor ? \'forms.banking.beneficiary.modal.form.beneficiaries.emptyText\' : \'forms.banking.beneficiary.modal.form.successors.emptyText\') | translate}}</strong> </div> <div ng-if="$ctrl.hasBeneficiaries && $ctrl.relationshipStatusOptions" class="c-beneficiaries-setup__table--beneficiaries" ng-class="{\'successor\': $ctrl.isSuccessor}"> <table class="table table--full table--nopaddingOnMobile" ng-class="{\'entitlement-error\': $ctrl.showingEntitlementError}"> <thead> <tr> <th class="name"> <div>{{ :: \'accountDetails.savings.beneficiaries.name\' | translate }} <span>/</span> </div> <div> {{ :: \'accountDetails.savings.beneficiaries.relationship\' | translate }} </div> </th> <th ng-if="!$ctrl.isSuccessor" class="entitlement">{{ ::\'accountDetails.savings.beneficiaries.entitlement\' | translate }}&nbsp;%</th> </tr> </thead> <tbody> <tr class="body-row" ng-if="$ctrl.beneficiaries.length > 0" ng-repeat="person in $ctrl.beneficiaries"> <td> <div class="c-beneficiaries-setup__td-name"> <div class="c-beneficiaries-setup__td-name__container"> <div class="c-beneficiaries-setup__td-name__text">{{ $ctrl.getName(person)}}</div> <div ng-if="person.relationship" class="c-beneficiaries-setup__relationship"> {{$ctrl.getRelationshipName(person)}} </div> </div> <div class="benefEdit"> <button class="btn beneficiaries edit" actionable-id="beneficiariesSetup_editButton" ng-click="$ctrl.onEditClick($index)">{{ ::\'global.components.buttons.edit\' | translate }} </button> </div> </div> </td> <td class="percentage"> <div ng-if="!$ctrl.isSuccessor"> <input class="input1" ng-class="{\'input1-readonly\': !$ctrl.isPercentageEditable}" type="tel" actionable-id="{{ ::$ctrl.pageId }}_percentage_{{$index}}" ng-model="person.percentage" ng-change="$ctrl.updatePercentage($index)" ng-pattern="$ctrl.numbersOnlyPattern" minlength="1" maxlength="3" ng-disabled="!$ctrl.isPercentageEditable" required autofocus ng-blur="$ctrl.onEntitlementLostFocus()"> <span class="percent-sign" ng-class="{\'placeholder-color\':!(person.percentage || person.percentage==\'0\')}">%</span> </div> </td> </tr> </tbody> </table> </div> <div ng-if="!$ctrl.isSuccessor && $ctrl.hasBeneficiaries && !$ctrl.isAccountDetails" class="c-beneficiaries-setup__total"> <table class="table table--full"> <tfoot> <tr class="c-beneficiaries-setup__total-row"> <td class="c-beneficiaries-setup align-left"> {{::(\'accountDetails.savings.beneficiaries.beneficiaryPercentageTotal\' | translate)}} </td> <td class="c-beneficiaries-setup align-right"> <div class="footer-total"> <span class="c-beneficiaries-setup__total__amount">{{$ctrl.totalEntitlement}}</span> <span class="c-beneficiaries-setup__total__percent">%</span> </div> </td> </tr> </tfoot> </table> </div> <p ng-if="$ctrl.showingEntitlementError" class="c-beneficiaries-setup__entitleErr"> {{ ::\'accountDetails.savings.beneficiaries.invalidBeneficiaryPercentageTotal\' | translate }} </p> <div ng-if="$ctrl.isAddButtonVisible" class="c-beneficiaries-setup__addButtonSection"> <button class="btn beneficiaries add" actionable-id="beneficiariesSetup_addButton" ng-click="$ctrl.onAddClick()" ng-disabled="$ctrl.disableAdd"> {{ :: $ctrl.isSuccessor ? \'forms.banking.beneficiary.modal.form.successors.addButton\': \'accountDetails.savings.beneficiaries.addBeneficiary\' | translate }} </button> </div> </div> <tng-beneficiary-update-modal ng-if="$ctrl.showEditModal || $ctrl.showAddModal" person-original="$ctrl.personToUpdate" is-successor="$ctrl.isSuccessor" is-account-details="$ctrl.isAccountDetails" relationship-status-options="$ctrl.filteredRelationshipStatusOptions" customer-info="$ctrl.customerInfo" on-add="$ctrl.onAdded(person)" on-update="$ctrl.onUpdated(person)" on-delete="$ctrl.onDeleted(person)" show-warning-on-exit="true" on-close="$ctrl.closeModal()" disable-modal-animation="$ctrl.disableModalAnimation" plan-number="$ctrl.planNumber"></tng-beneficiary-update-modal> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=n(67);function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,r,o,c,l,u,d){(0,i.default)(this,t),this.$scope=e,this.$log=n,this.$translate=o,this.$q=a,this.$timeout=r,this.numbersOnlyPattern=s.numbersOnlyPattern,this.SETUP_CONST=c.SETUP_CONST,this.BENEFICIARY_TYPES=c.BENEFICIARY_TYPES,this.BeneficiariesModalConstants=c,this.buildConstants=l,this.referenceDataConstants=u,this.EnvironmentService=d}return(0,a.default)(t,[{key:"$onInit",value:function(){this.pageId="beneficiarySetup",this.enableNext()}},{key:"$onChanges",value:function(){this.isAccountDetails||this.calculateTotalEntitlement(),this._canShowEntitlementError=!1}},{key:"getRelationshipName",value:function(t){return this.relationshipStatusOptions.find((function(e){return e.code===t.relationship})).name}},{key:"getName",value:function(t){return t.beneficiary_type!==this.BENEFICIARY_TYPES.CHARITY?t.first_name+" "+t.last_name:t.business_name}},{key:"_calculateFilteredRelationships",value:function(){var t=this.BeneficiariesModalConstants.RELATIONSHIP,e=this.referenceDataConstants.MARITAL_STATUS_CODES;if(this.isSuccessor)this.maritalStatusCode===e.MARRIED?this._filteredRelationshipStatusOptions=this.relationshipStatusOptions.filter((function(e){return e.code===t.SPOUSE})):this.maritalStatusCode===e.COMMON_LAW&&(this._filteredRelationshipStatusOptions=this.relationshipStatusOptions.filter((function(e){return e.code===t.COMMON_LAW})));else{var n=[],i=this.beneficiaries.find((function(e){return-1!==[t.SPOUSE,t.COMMON_LAW].indexOf(e.relationship)}));i&&i!==this.personToUpdate||this.productHasSuccessor||this.maritalStatusCode===e.UNKNOWN?n=[t.SPOUSE,t.COMMON_LAW]:this.maritalStatusCode===e.COMMON_LAW?n=[t.SPOUSE]:this.maritalStatusCode===e.MARRIED&&(n=[t.COMMON_LAW]),this._filteredRelationshipStatusOptions=this.relationshipStatusOptions.filter((function(t){return!(-1!==n.indexOf(t.code))}))}}},{key:"onAddClick",value:function(){this.showAddModal=!0,this.personToUpdate=null,this._calculateFilteredRelationships(),this.onAddOrEdit&&this.onAddOrEdit()}},{key:"onEditClick",value:function(t){this.showEditModal=!0,this.personToUpdate=this.beneficiaries[t],this.personToUpdateIndex=t,this._calculateFilteredRelationships(),this.onAddOrEdit&&this.onAddOrEdit()}},{key:"onAdded",value:function(t){this.$log.debug("new beneficiary/successor added: ",t),this.beneficiaries.push(t),this.calculateTotalEntitlement(),this._canShowEntitlementError=!1}},{key:"onUpdated",value:function(t){this.$log.debug("beneficiary/successor updated: ",t),this.beneficiaries[this.personToUpdateIndex]=t,this.enableNext()}},{key:"onDeleted",value:function(t){this.$log.debug("beneficiary/successor deleted: ",t);var e=this.beneficiaries.findIndex((function(e){return e.sequence===t.sequence}));this.beneficiaries.splice(e,1),this.calculateTotalEntitlement(),this._canShowEntitlementError=!0}},{key:"closeModal",value:function(){this.showAddModal=!1,this.showEditModal=!1}},{key:"enableNext",value:function(){var t=this.isEntitlementValid;this.onEnableNext({enableNext:t})}},{key:"updatePercentage",value:function(t){void 0===this.beneficiaries[t].percentage&&(this.beneficiaries[t].percentage=0);var e=parseInt(this.beneficiaries[t].percentage,10);e>this.SETUP_CONST.MAX_PERCENTAGE&&(e=0),this.beneficiaries[t].percentage=e,this.calculateTotalEntitlement()}},{key:"calculateTotalEntitlement",value:function(){var t=this;this.totalEntitlement=0,this.beneficiaries.forEach((function(e){e.percentage&&(t.totalEntitlement=t.totalEntitlement+parseInt(e.percentage,10))})),this.enableNext()}},{key:"onEntitlementLostFocus",value:function(){var t=this;this.$timeout((function(){t._canShowEntitlementError=!0}),200)}},{key:"hasBeneficiaries",get:function(){return this.beneficiaries&&this.beneficiaries.length>0}},{key:"filteredRelationshipStatusOptions",get:function(){return this._filteredRelationshipStatusOptions||this.relationshipStatusOptions}},{key:"showingEntitlementError",get:function(){return this._canShowEntitlementError&&!this.isEntitlementValid}},{key:"isEntitlementValid",get:function(){return this.isAccountDetails||this.isSuccessor||0===this.beneficiaries.length||this.totalEntitlement===this.SETUP_CONST.MAX_PERCENTAGE&&this.beneficiaries.every((function(t){return 0!==t.percentage}))}},{key:"isAddButtonVisible",get:function(){return this.canAdd&&this.beneficiaries.length<this.maxAmount&&(this.isSuccessor||this.totalEntitlement<this.SETUP_CONST.MAX_PERCENTAGE)}}]),t}();o.$inject=["$scope","$log","$q","$timeout","$translate","BeneficiariesModalConstants","buildConstants","referenceDataConstants","EnvironmentService"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a,s=n(33),r=(i=s)&&i.__esModule?i:{default:i};var o={COMMON_LAW:"CL",DAUGHTER:"D",NO_RELATION:"NR",OTHER:"OTH",PARENT:"P",ESTATE:"EST",SIBLING:"SB",SON:"S",SPOUSE:"SP"},c=[o.SON,o.DAUGHTER],l={RSP:"RSP",TFSA:"TFSA",RIF:"RIF"},u=(a={},(0,r.default)(a,l.RSP,"5"),(0,r.default)(a,l.TFSA,"90"),(0,r.default)(a,l.RIF,"6"),a);e.default={SETUP_CONST:{MAX_BENEFICIARIES:4,MAX_PERCENTAGE:100},BENEFICIARY_TYPES:{SUCCESSOR:"Successor",BENEFICIARY:"Beneficiary",CHARITY:"Charity"},PLAN_TYPES:u,PRODUCT_TYPES:l,RELATIONSHIP:o,CHILDREN_RELATION_CODES:c,ADDRESS_TYPE:"HOME",PHONE_TYPE:"HOME"},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5096)),a=s(n(5097));function s(t){return t&&t.__esModule?t:{default:t}}n(5098);var r={template:i.default,controller:a.default,require:{beneficiariesModalController:"?^tngBeneficiariesModal"},bindings:{personOriginal:"<",isSuccessor:"<",relationshipStatusOptions:"<",isAccountDetails:"<",onAdd:"&",onUpdate:"&",onDelete:"&",showWarningOnExit:"<?",onClose:"&",disableModalAnimation:"<?",planNumber:"<?",customerInfo:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose()" class="c-beneficiary-update-modal" ng-class="{ \'is-french\': $ctrl.isFrench}" disable-animation="$ctrl.disableModalAnimation"> <header> <span ng-show="!$ctrl.showConfirmExitUI && !ctrl.isLoading && !$ctrl.isDoneLoading" translate-cloak> <span ng-if="$ctrl.isSuccessor && $ctrl.isUpdate" class="c-beneficiary-update-modal__ctitle"> {{::\'forms.banking.beneficiary.modal.edit.editSuccessorTitle\' | translate }} </span> <span ng-if="$ctrl.isSuccessor && $ctrl.isAdd" class="c-beneficiary-update-modal__ctitle"> {{::\'forms.banking.beneficiary.modal.edit.addSuccessorTitle\' | translate }} </span> <span ng-if="!$ctrl.isSuccessor && $ctrl.isUpdate" class="c-beneficiary-update-modal__ctitle"> {{::\'forms.banking.beneficiary.modal.edit.editBenefTitle\' | translate }} </span> <span ng-if="!$ctrl.isSuccessor && $ctrl.isAdd" class="c-beneficiary-update-modal__ctitle"> {{::\'forms.banking.beneficiary.modal.edit.addBenefTitle\' | translate }} </span> <span ng-if="$ctrl.showConfirmExitUI" translate-cloak>{{ \'global.warning.title\' | translate }}</span> </span> </header> <p class="c-beneficiary-update-modal__info" ng-if="!$ctrl.showConfirmExitUI && !ctrl.isLoading && !$ctrl.isDoneLoading"> <span ng-if="!$ctrl.isSuccessor">{{::\'forms.banking.beneficiary.modal.edit.completeInfoBene\' | translate }}</span> <span ng-if="$ctrl.isSuccessor">{{::\'forms.banking.beneficiary.modal.edit.completeInfoSuccessor\' | translate }}</span> </p> <header> <span ng-show="!$ctrl.showConfirmExitUI" translate-cloak> {{ $ctrl.title | translate }} </span> <span ng-if="$ctrl.showConfirmExitUI && $ctrl.showWarningOnExit && !$ctrl.showWarningOnDelete" translate-cloak> {{ \'global.warning.title\' | translate }}</span> </header> <div ng-if="$ctrl.showConfirmExitUI"> <tng-confirm-exit ng-if="!$ctrl.showWarningOnDelete"></tng-confirm-exit> <tng-confirm-exit ng-if="$ctrl.showWarningOnDelete" confirm-delete-title="$ctrl.deleteWarningTitle" confirm-delete-msg="$ctrl.deleteWarnvalidateingMsg"></tng-confirm-exit> </div> <div ng-if="$ctrl.isLoading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div ng-if="$ctrl.isDoneLoading"> <tng-loading-done></tng-loading-done> </div> <form novalidate name="$ctrl.updateForm" class="narrow-width-section" autocomplete="off"> <div ng-hide="$ctrl.showConfirmExitUI || ctrl.isLoading || $ctrl.isDoneLoading"> <div class="c-move-money__error container" ng-show="$ctrl.submitErrors"> <tng-error-message ng-if="$ctrl.hasSubmitErrors"> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> </div> <section class="bottom-margin-medium narrow-width-section" ng-if="$ctrl.isAdd && $ctrl.candidates.length"> <p ng-if="$ctrl.isSuccessor">{{::\'forms.banking.beneficiary.modal.edit.preFillTitleSuccessor\' | translate}}</p> <p ng-if="!$ctrl.isSuccessor">{{::\'forms.banking.beneficiary.modal.edit.preFillTitleBeneficiary\' | translate}}</p> <div class="c-basic-info-form__primary-phone-select-wrapper top-margin-small"> <tng-select-autocomplete input-id="preFillCandidate_select" ng-model="$ctrl.candidateIndex" ng-required="false" on-select="$ctrl.onPrefillSelect()" options="$ctrl.candidates" option-label-key="name" option-value-key="listIndex" placeholder="{{ ::\'forms.banking.beneficiary.modal.form.pleaseSelect\' | translate }}" select-type="$ctrl.autoselectConstants.SELECT_TYPES.STATIC"></tng-select-autocomplete> </div> </section> <section ng-if="!$ctrl.isSuccessor" class="bottom-margin-medium narrow-width-section"> <div class="field"> <label>{{::\'forms.banking.beneficiary.modal.edit.benefType\' | translate}} </label> </div> <div ng-if="!$ctrl.isSuccessor" class="c-basic-info-form__primary-phone-select-wrapper field__group--wrap top-margin-small"> <div class="field"> <input type="radio" ng-required="true" class="input input--tangerine-radio" actionable-id="{{ ::$ctrl.pageId }}_individual" ng-model="$ctrl.person.beneficiary_type" value="{{$ctrl.BeneficiariesModalConstants.BENEFICIARY_TYPES.BENEFICIARY}}" ng-change="$ctrl.onBeneficiaryTypeSelected()" ng-disabled="$ctrl.isAccountDetails"> <label class="heading--sub3 top-margin-none" for="{{ ::$ctrl.pageId }}_individual" id="{{ ::$ctrl.pageId }}_individual"> {{ ::\'forms.banking.beneficiary.modal.edit.individual\' | translate }} </label> </div> <div class="field"> <input type="radio" ng-required="true" class="input input--tangerine-radio" actionable-id="{{ ::$ctrl.pageId }}_charity" ng-model="$ctrl.person.beneficiary_type" value="{{$ctrl.BeneficiariesModalConstants.BENEFICIARY_TYPES.CHARITY}}" ng-change="$ctrl.onBeneficiaryTypeSelected()" ng-disabled="$ctrl.isAccountDetails"> <label for="{{ ::$ctrl.pageId }}_charity" id="label_{{ ::$ctrl.pageId }}_charity"> {{ ::\'forms.banking.beneficiary.modal.edit.charity\' | translate }} </label> </div> </div> </section> <section ng-if="$ctrl.isCharity" class="bottom-margin-medium narrow-width-section"> <div class="field"> <label> {{ ::\'forms.banking.beneficiary.modal.edit.nameCharity\' | translate }} </label> <input actionable-id="{{ ::$ctrl.pageId }}_business_name" class="input" ng-class="{ \'warning\':\n                   ($ctrl.updateForm.benefUpdateModal_business_name.$touched  &&\n                   !$ctrl.updateForm.benefUpdateModal_business_name.$valid)}" type="text" ng-model="$ctrl.person.business_name" maxlength="40" minlength="3" name="business_name" ng-required="!$ctrl.isAccountDetails" ng-pattern="$ctrl.BUSINESS_NUMBER_OR_NAME_PATTERN" ng-class="{ \'warning\':\n            ($ctrl.updateForm.benefUpdateModal_business_name.$touched &&\n             !$ctrl.updateForm.benefUpdateModal_business_name.$valid)}" placeholder="{{::(\'forms.banking.beneficiary.modal.edit.orgName\' | translate)}}" ng-change="$ctrl.validateForm()" ng-disabled="$ctrl.isAccountDetails"/> <div ng-messages="$ctrl.updateForm.benefUpdateModal_business_name.$error" ng-show="$ctrl.updateForm.benefUpdateModal_business_name.$touched" class="c-beneficiary-update-modal__field-warning"> <p ng-message="required"> {{ ::(\'global.validation.required\' | translate) }} </p> <p ng-message="minlength"> {{ ::(\'global.validation.minThreeChars\' | translate) }} </p><p ng-message="pattern"> {{ ::(\'forms.banking.beneficiary.modal.edit.businessNumberValidationError\' | translate) }} </p> </div> </div> <div class="c-beneficiary-update-modal__legal-name"> {{::\'forms.banking.beneficiary.modal.edit.legalNameCharity\' | translate }} </div> </section> <section ng-if="$ctrl.isCharity" class="bottom-margin-medium narrow-width-section"> <div class="field"> <div class="c-optional-bottom"> <strong class="c-optional-right">{{ ::\'forms.banking.beneficiary.modal.edit.charityEntityNumber\' | translate }} </strong> {{::\'forms.banking.beneficiary.modal.edit.optional\' | translate}} </div> <input actionable-id="{{ ::$ctrl.pageId }}_business_number" ng-change="$ctrl.onCharityEntityNoUpdate()" class="input" ng-class="{ \'warning\':\n                   ($ctrl.updateForm.benefUpdateModal_business_number.$touched  &&\n                   !$ctrl.updateForm.benefUpdateModal_business_number.$valid)}" type="text" ng-model="$ctrl.person.business_number" maxlength="20" minlength="3" placeholder="(123-456-789)" ng-pattern="$ctrl.BUSINESS_NUMBER_OR_NAME_PATTERN"/> <div ng-messages="$ctrl.updateForm.benefUpdateModal_business_number.$error" ng-show="$ctrl.updateForm.benefUpdateModal_business_number.$touched" class="c-beneficiary-update-modal__field-warning"> <p ng-message="minlength"> {{ ::(\'global.validation.minThreeChars\' | translate) }} </p><p ng-message="pattern"> {{ ::(\'forms.banking.beneficiary.modal.edit.businessNumberValidationError\' | translate) }} </p> </div> </div> </section> <section ng-if="$ctrl.isIndividual" class="bottom-margin-medium narrow-width-section"> <div class="field"> <label> {{ ::\'forms.banking.beneficiary.modal.edit.nameIndividual\' | translate }} </label> <div class="grid__container"> <div class="grid__column--1of2 first-name-column"> <input actionable-id="{{ ::$ctrl.pageId }}_firstName" class="input" type="text" ng-model="$ctrl.person.first_name" ng-class="{ \'warning\':\n             $ctrl.updateForm.benefUpdateModal_firstName.$touched &&\n             !$ctrl.updateForm.benefUpdateModal_firstName.$valid}" maxlength="17" minlength="2" name="first_name" ng-required="!$ctrl.isAccountDetails" ng-pattern="$ctrl.BUSINESS_NUMBER_OR_NAME_PATTERN" placeholder="{{::(\'forms.banking.beneficiary.modal.edit.firstNamePlaceholder\' | translate)}}" ng-change="$ctrl.validateForm()" ng-disabled="$ctrl.isAccountDetails"/> <div class="c-beneficiary-update-modal__field-warning" ng-show="$ctrl.updateForm.benefUpdateModal_firstName.$touched &&\n            (!$ctrl.updateForm.benefUpdateModal_firstName.$valid && !$ctrl.updateForm.benefUpdateModal_firstName.$error.pattern)"> {{ ::(\'global.validation.required\' | translate) }} </div> <div class="c-beneficiary-update-modal__field-warning" ng-show="$ctrl.updateForm.benefUpdateModal_firstName.$touched &&\n            (!$ctrl.updateForm.benefUpdateModal_firstName.$valid && $ctrl.updateForm.benefUpdateModal_firstName.$error.pattern)"> {{ ::(\'global.validation.onlyLetters\' | translate) }} </div> </div> <div class="grid__column--1of2"> <input actionable-id="{{ ::$ctrl.pageId }}_lastName" class="input" ng-class="{ \'warning\':\n             $ctrl.updateForm.benefUpdateModal_lastName.$touched &&\n            (($ctrl.person.first_name.length + $ctrl.person.last_name.length) > 39 ||\n            !$ctrl.updateForm.benefUpdateModal_lastName.$valid)\n          }" type="text" ng-model="$ctrl.person.last_name" maxlength="20" minlength="2" name="last_name" ng-required="!$ctrl.isAccountDetails" ng-pattern="$ctrl.BUSINESS_NUMBER_OR_NAME_PATTERN" placeholder="{{::(\'forms.banking.beneficiary.modal.edit.lastNamePlaceholder\' | translate)}}" ng-change="$ctrl.validateForm()" ng-disabled="$ctrl.isAccountDetails"/> <div class="c-beneficiary-update-modal__field-warning" ng-show="$ctrl.updateForm.benefUpdateModal_lastName.$touched &&\n            (!$ctrl.updateForm.benefUpdateModal_lastName.$valid && !$ctrl.updateForm.benefUpdateModal_lastName.$error.pattern)"> {{ ::(\'global.validation.required\' | translate) }} </div> <div class="c-beneficiary-update-modal__field-warning" ng-show="$ctrl.updateForm.benefUpdateModal_lastName.$touched &&\n            (!$ctrl.updateForm.benefUpdateModal_lastName.$valid && $ctrl.updateForm.benefUpdateModal_lastName.$error.pattern)"> {{ ::(\'global.validation.onlyLetters\' | translate) }} </div> </div> </div> </div> <div class="c-beneficiary-update-modal__legal-name"> {{::\'forms.banking.beneficiary.modal.edit.legalNameIndividual\' | translate }} </div> </section> <section ng-if="$ctrl.isIndividual || $ctrl.isCharity" class="bottom-margin-medium narrow-width-section"> <div class="field"> <label ng-bind-html="::\'forms.banking.beneficiary.modal.edit.relation\' | translate"> </label> <tng-select-autocomplete input-id="{{ ::$ctrl.pageId }}_relationship" ng-model="$ctrl.person.relationship" ng-required="!$ctrl.isAccountDetails" on-select="$ctrl.validateForm()" options="$ctrl.relOptions" option-label-key="name" placeholder="{{ ::\'forms.banking.beneficiary.modal.form.pleaseSelect\' | translate }}" select-type="$ctrl.autoselectConstants.SELECT_TYPES.STATIC" ng-readonly="$ctrl.isAccountDetails"> </tng-select-autocomplete> </div> <div class="field" ng-if="!$ctrl.isCharity && $ctrl.person.relationship === $ctrl.RELATIONSHIP.OTHER"> <label> {{ ::\'forms.banking.beneficiary.modal.edit.pleaseSpecify\' | translate }} </label> <input actionable-id="{{ ::$ctrl.pageId }}_relationship_other" ng-change="$ctrl.validateForm()" class="input" ng-class="{ \'warning\':\n                   ($ctrl.updateForm.benefUpdateModal_relationship_other.$touched  &&\n                   !$ctrl.updateForm.benefUpdateModal_relationship_other.$valid)}" type="text" ng-model="$ctrl.person.relationship_other" maxlength="40" minlength="1" name="relationship_other" ng-pattern="$ctrl.BUSINESS_NUMBER_OR_NAME_PATTERN" ng-required="!$ctrl.isAccountDetails" ng-disabled="$ctrl.isAccountDetails"/> <div class="c-beneficiary-update-modal__field-warning" ng-show="$ctrl.updateForm.benefUpdateModal_relationship_other.$touched &&\n            (!$ctrl.updateForm.benefUpdateModal_relationship_other.$valid && !$ctrl.updateForm.benefUpdateModal_relationship_other.$error.pattern)"> {{ ::(\'global.validation.required\' | translate) }} </div> <div class="c-beneficiary-update-modal__field-warning" ng-show="$ctrl.updateForm.benefUpdateModal_relationship_other.$touched &&\n            (!$ctrl.updateForm.benefUpdateModal_relationship_other.$valid && $ctrl.updateForm.benefUpdateModal_relationship_other.$error.pattern)"> {{ ::(\'global.validation.onlyLetters\' | translate) }} </div> </div> </section> <section ng-if="$ctrl.isIndividual" class="bottom-margin-medium narrow-width-section"> <div class="field dob"> <span> <span class="c-optional-right"> <strong>{{::\'forms.banking.beneficiary.modal.edit.birthdate\' | translate}}</strong> </span> {{::\'forms.banking.beneficiary.modal.edit.optional\' | translate}} </span> <tng-date-input input-id="dateOfBirth" is-date-of-birth="true" min-age="0" date-model="$ctrl.person.date_of_birth" on-change="$ctrl.validateForm()" person-descriptor="$ctrl.getItemTypeName(false, true)"></tng-date-input> </div> </section> <section ng-if="$ctrl.isIndividual" class="bottom-margin-medium narrow-width-section"> <div class="field"> <span> <span class="c-optional-right"> <strong>{{::\'forms.banking.beneficiary.modal.edit.SIN\' | translate}}</strong> </span> {{::\'forms.banking.beneficiary.modal.edit.optional\' | translate}} </span> <tng-sin-input ng-model="$ctrl.person.sin" input-id="{{ ::$ctrl.pageId }}_sin" on-change="$ctrl.validateForm()" show-validation-on-load="$ctrl.isUpdate"></tng-sin-input> </div> </section> <section class="bottom-margin-medium narrow-width-section"> <div class="field"> <div class="c-optional-bottom"> <strong class="c-optional-right">{{::\'forms.banking.beneficiary.modal.edit.address\' | translate}} </strong> {{::\'forms.banking.beneficiary.modal.edit.optional\' | translate}} </div> <tng-address-form-fields street-perfect="false" page-id="{{ ::$ctrl.pageId }}_address" address-object="$ctrl.person.address_list[0]" actionable-id="benef_edit_address" is-required="false" prevent-incomplete="true" address-line1-max-length="$ctrl.isAccountDetails ? 32 : 27" address-line2-max-length="$ctrl.isAccountDetails ? 32 : 27" canadianaddressonly="false" suite-max-length="$ctrl.isAccountDetails ? 32 : 8" city-max-length="32" address-change="$ctrl.validateForm()" postal-code-placeholder-code="forms.banking.beneficiary.modal.edit.postalPlaceholder" show-validation-on-load="$ctrl.isUpdate"> </tng-address-form-fields> </div> </section> <section class="bottom-margin-medium narrow-width-section"> <div class="field"> <div class="c-optional-bottom"> <strong class="c-optional-right">{{::\'forms.banking.beneficiary.modal.edit.phone\' | translate}} </strong> {{::\'forms.banking.beneficiary.modal.edit.optional\' | translate}} </div> <tng-phone-input input-name="benefUpdateModal_phoneHome" ng-model="$ctrl.person.phone_list[0].number" on-view-value-changed="$ctrl.validateForm()" show-validation-on-load="$ctrl.isUpdate"> </tng-phone-input> </div> </section> <section ng-if="$ctrl.isIndividual" class="bottom-margin-medium narrow-width-section"> <div class="field"> <span class="c-optional-bottom"> <span class="c-optional-right"><strong>{{::\'forms.banking.beneficiary.modal.edit.emailAddress\' | translate}}</strong></span> {{::\'forms.banking.beneficiary.modal.edit.optional\' | translate}} </span> <input class="input top" actionable-id="{{ ::$ctrl.pageId }}_email" maxlength="60" type="email" name="email" ng-model="$ctrl.person.email" ng-change="$ctrl.validateForm()" ng-model-options="{ allowInvalid: true }" ng-class="{\'warning\': $ctrl.updateForm.benefUpdateModal_email.$invalid &&\n                            ($ctrl.updateForm.benefUpdateModal_email.$touched || $ctrl.isUpdate)}" autocomplete="off" ng-pattern="$ctrl.emailRegexPattern" placeholder="{{::(\'forms.banking.beneficiary.modal.edit.emailAddressGhostText\' | translate)}}"/> <div ng-messages="$ctrl.updateForm.benefUpdateModal_email.$error" ng-show="$ctrl.updateForm.benefUpdateModal_email.$touched || $ctrl.isUpdate" class="field__error"> <p ng-message="email"> {{ ::\'validation.email\' | translate}} </p> <p ng-message="pattern"> {{ ::\'validation.email\' | translate}} </p> </div> </div> </section> <section ng-if="$ctrl.isIndividual" class="bottom-margin-medium narrow-width-section"> <div class="field"> <span class="c-optional-bottom"> <span class="c-optional-right"><strong>{{ ::\'forms.banking.beneficiary.modal.edit.clientNo\' | translate }} </strong></span> {{::\'forms.banking.beneficiary.modal.edit.optional\' | translate}} </span> <input actionable-id="{{ ::$ctrl.pageId }}_client_number" class="input top" ng-change="$ctrl.onClientNoUpdate()" ng-model-options="{ allowInvalid: true }" type="text" ng-model="$ctrl.person.client_number" maxlength="8" minlength="2" name="client_number" placeholder="123456789" ng-pattern="/^[0-9]+$/" ng-class="{ \'warning\':\n            (($ctrl.updateForm.benefUpdateModal_client_number.$touched || $ctrl.isUpdate) &&\n             !$ctrl.updateForm.benefUpdateModal_client_number.$valid)}"/> <div class="c-beneficiary-update-modal__field-warning" ng-show="($ctrl.updateForm.benefUpdateModal_client_number.$touched || $ctrl.isUpdate) &&\n            (!$ctrl.updateForm.benefUpdateModal_client_number.$valid && !$ctrl.updateForm.benefUpdateModal_client_number.$error.pattern)"> {{ ::(\'global.validation.required\' | translate) }} </div> <div class="c-beneficiary-update-modal__field-warning" ng-show="($ctrl.updateForm.benefUpdateModal_client_number.$touched || $ctrl.isUpdate) &&\n            (!$ctrl.updateForm.benefUpdateModal_client_number.$valid && $ctrl.updateForm.benefUpdateModal_client_number.$error.pattern)"> {{ ::(\'global.validation.onlyNumbers\' | translate) }} </div> </div> </section> <div ng-hide="$ctrl.isAccountDetails"> <button type="button" ng-show="!$ctrl.isAdd" actionable-id="{{::ctrl.pageId}}-benefUpdateModal-delete_btn" class="btn btn--warn" ng-click="$ctrl.onDeleteClick()" translate-cloak> {{::\'global.components.buttons.delete\' | translate }} </button> </div> </div> </form> <footer ng-show="!$ctrl.showConfirmExitUI && !ctrl.isLoading && !$ctrl.isDoneLoading"> <button type="button" actionable-id="{{$ctrl.pageId}}-edit-modal-cancel_btn" class="btn btn--prev" ng-click="$ctrl.onModalClose()" translate-cloak> {{ ::\'global.pageFlow.buttons.cancel\' | translate }} </button> <button ng-attr-id="{{$ctrl.pageId}}-edit-modal-{{$ctrl.isAdd ? \'global.components.buttons.add\':\n        \'global.components.buttons.save\' | translate }}" class="btn" ng-click="$ctrl.onSaveClick()" ng-disabled="!$ctrl.nextEnabled" translate-cloak> {{:: $ctrl.isAdd ? \'global.components.buttons.add\': \'global.components.buttons.save\' | translate }} </button> </footer> <footer ng-show="$ctrl.showConfirmExitUI"> <button actionable-id="{{::ctrl.pageId}}-edit-modal-deny_exit" class="btn btn--edit" ng-click="$ctrl.denyExit()"> <span ng-if="$ctrl.showWarningOnExit && !$ctrl.showWarningOnDelete" translate translate-cloak>global.pageFlow.buttons.cancel</span> <span ng-if="$ctrl.showWarningOnDelete" translate translate-cloak>global.pageFlow.buttons.noGoBack</span> </button> <button actionable-id="{{::ctrl.pageId}}-edit-modal-allow_exit" class="btn btn--tangerine" ng-click="$ctrl.allowExit()"> <span ng-if="$ctrl.showWarningOnExit && !$ctrl.showWarningOnDelete" translate translate-cloak>global.pageFlow.buttons.exit</span> <span ng-if="$ctrl.showWarningOnDelete" translate translate-cloak>global.pageFlow.buttons.yesDelete</span> </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(8)),a=o(n(0)),s=o(n(2)),r=n(67);function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,s,o,c,l,u,d,h,f,p,g,m,_,v,S,T){(0,a.default)(this,t),this.$scope=e,this.$log=n,this.BeneficiariesModalConstants=i,this.RELATIONSHIP=this.BeneficiariesModalConstants.RELATIONSHIP,this.$q=s,this.translateFilter=u("translate"),this.numbersOnlyPattern=r.numbersOnlyPattern,this.SETUP_CONST=i.SETUP_CONST,this.BENEFICIARY_TYPES=i.BENEFICIARY_TYPES,this.updateForm={},this.pageId="benefUpdateModal",this.ReferenceDataService=o,this.DateService=c,this.autoselectConstants=l,this.$timeout=d,this.referenceDataConstants=h,this.customerConstants=f,this.AnchorService=p,this.ErrorService=_,this.BeneficiariesService=g,this.pageFlowConstants=m,this.ERROR_EVENTS=v.AVAILABLE_EVENTS,this.LocaleService=S,this.EventBusService=T,this.NAME_PATTERN=r.namePatternUnlimited,this.BUSINESS_NUMBER_OR_NAME_PATTERN=r.businessNumberOrNamePattern,this.emailRegexPattern=r.emailFullPattern,this.RELATIONSHIP=this.BeneficiariesModalConstants.RELATIONSHIP}return(0,s.default)(t,[{key:"$onInit",value:function(){var t=this;this.showConfirmExitUI=!1,this.nextEnabled=!1,this._charityRelationshipOptions=[this.relationshipStatusOptions.find((function(e){return e.code===t.RELATIONSHIP.OTHER}))],this.personOriginal?(this.person=angular.copy(this.personOriginal),this.isUpdate=!0):(this.person={},this.isAdd=!0,this.person.beneficiary_type=this.isSuccessor?this.BENEFICIARY_TYPES.SUCCESSOR:this.BENEFICIARY_TYPES.BENEFICIARY),this.person.address_list||(this.person.address_list=[{address_type:this.BeneficiariesModalConstants.ADDRESS_TYPE}]),this.person.address_list[0].address_line3&&this.person.address_list[0].address_line3.length>0&&(this.person.address_list[0].suite=this.person.address_list[0].address_line3),this.person.phone_list||(this.person.phone_list=[{type:this.BeneficiariesModalConstants.PHONE_TYPE}]),!this.isSuccessor&&this.isAdd&&(this.person.percentage=0),this.isAdd&&this._getCandidates(),1===this.relationshipStatusOptions.length&&(this.person.relationship=this.relationshipStatusOptions[0].code),this.$timeout((function(){t.updateForm.$setUntouched(),t.updateForm.$setPristine()}),50)}},{key:"onDateChange",value:function(t){t.isSame(this._existingDOB)||this.updateForm.$setDirty(),this.validateForm()}},{key:"onBeneficiaryTypeSelected",value:function(){this.person.beneficiary_type===this.BENEFICIARY_TYPES.CHARITY&&(this.person.relationship=this.BeneficiariesModalConstants.RELATIONSHIP.OTHER),this._getCandidates(),this.validateForm()}},{key:"validateForm",value:function(){var t=this;this.$timeout((function(){t.nextEnabled=t.updateForm.$valid&&t.updateForm.$dirty}),50)}},{key:"onSaveClick",value:function(){var t=this;if(this.isAccountDetails)return this._enterLoadingMode(),this.BeneficiariesService.saveBeneficiary(this.person,this.planNumber).then((function(){return t._showLoadingDoneIcon(),t.$timeout((function(){t.onUpdate({person:t.person}),t.onModalClose()}),t.pageFlowConstants.MODAL_VISIBILITY_TIMEOUT)})).catch((function(e){return t._showSubmitErrors(e)})).finally((function(){return t._exitLoadingMode()}));var e=this.person;return this.isAdd?this.onAdd({person:e}):this.isDelete?this.onDelete({person:e}):this.isUpdate&&this.onUpdate({person:e}),this.isDoneLoading=!0,this.onModalClose(),null}},{key:"_enterLoadingMode",value:function(){this.isLoading=!0,this.isDoneLoading=!1}},{key:"_exitLoadingMode",value:function(){this.isLoading=!1}},{key:"_showLoadingDoneIcon",value:function(){this.isDoneLoading=!0}},{key:"onEmailUpdate",value:function(){this.validateForm()}},{key:"onCharityEntityNoUpdate",value:function(){this.person.client_number=null,this.validateForm()}},{key:"onClientNoUpdate",value:function(){this.person.business_number=null,this.validateForm()}},{key:"onDeleteClick",value:function(){var t=this;this.showWarningOnDelete=!0,this._warnOnExit().then((function(){t.isDelete=!0,t.onSaveClick()})).catch((function(){t.$log.debug("deletion of successor/beneficiary cancelled by the user")})).finally((function(){t.showWarningOnDelete=!1}))}},{key:"onPrefillSelect",value:function(){this.$log.debug("selected pre-fill option",this.candidateIndex,this.candidates[this.candidateIndex]);var t=this.BeneficiariesModalConstants.BENEFICIARY_TYPES,e=(0,i.default)({},this.candidates[this.candidateIndex]);delete e.$$hashKey,delete e.percentage,e.beneficiary_type===t.CHARITY&&(delete e.first_name,delete e.last_name);var n=this.person.beneficiary_type;(0,i.default)(this.person,e),this.person.beneficiary_type=n,this.validateForm(),this.EventBusService.publish("dobSelectPrefill",this.person.date_of_birth)}},{key:"onModalClose",value:function(){var t=this;this.showConfirmExitUI?this.denyExit():this.updateForm.$dirty?this._warnOnExit().then((function(){t.onClose()})).catch((function(){t.$log.debug("closing beneficiary edit form cancelled by the user")})):this.onClose()}},{key:"_warnOnExit",value:function(){var t=this;this.showConfirmExitUI=!0;var e=this.$q((function(e,n){t.allowExit=function(){t.showConfirmExitUI=!1,e("user accepted navigation")},t.denyExit=function(){t.showConfirmExitUI=!1,n("user rejected navigation")}}));return(this.isDoneLoading||!this.showWarningOnExit&&!this.showWarningOnDelete)&&this.allowExit(),e}},{key:"getItemTypeName",value:function(t,e){var n=this.isSuccessor?this.translateFilter("forms.banking.beneficiary.updateModal."+(e?"successors":"successor")):this.translateFilter("forms.banking.beneficiary.updateModal."+(e?"beneficiaries":"beneficiary"));return t?n.replace(/^\w/,(function(t){return t.toLowerCase()})):n}},{key:"_getCandidates",value:function(){var t=this;this.candidateIndex=null;var e=0;this.candidates=[];var n=this.BeneficiariesModalConstants,i=n.BENEFICIARY_TYPES,a=n.PRODUCT_TYPES,s=n.RELATIONSHIP;if(!this.beneficiariesModalController.isRSP){var r=this.beneficiariesModalController.activeSelectedProducts.find((function(t){return t.productType===a.RSP}));if(r){var o=this.beneficiariesModalController.currentProduct;r.beneficiaries.forEach((function(n){t.isSuccessor&&-1===[s.SPOUSE,s.COMMON_LAW].indexOf(n.relationship)||(t.person.beneficiary_type===i.CHARITY&&n.beneficiary_type===i.CHARITY||t.person.beneficiary_type!==i.CHARITY&&n.beneficiary_type!==i.CHARITY)&&(o.beneficiaries.find((function(e){return t._isTheSamePerson(e,n)}))||o.successors.find((function(e){return t._isTheSamePerson(e,n)}))||(n.name=n.beneficiary_type===i.CHARITY?n.business_name:n.first_name+" "+n.last_name,n.listIndex=e,e+=1,t.candidates.push(n)))}))}}}},{key:"_isTheSamePerson",value:function(t,e){var n=this.BeneficiariesModalConstants.BENEFICIARY_TYPES;return t.beneficiary_type===n.CHARITY&&e.beneficiary_type===n.CHARITY&&t.business_name===e.business_name||t.beneficiary_type!==n.CHARITY&&e.beneficiary_type!==n.CHARITY&&t.first_name===e.first_name&&t.last_name===e.last_name}},{key:"_showSubmitErrors",value:function(t){var e=this;return this.submitErrors=[],this.ErrorService.processError(t,this.ERROR_EVENTS.REQUEST_ERROR).then((function(t){e.submitErrors.push(t.message),e._scrollToTop()}))}},{key:"_scrollToTop",value:function(){this.AnchorService.scrollToModalTop()}},{key:"relOptions",get:function(){return this.isCharity?this._charityRelationshipOptions:this.relationshipStatusOptions}},{key:"isFrench",get:function(){return this.LocaleService.locale===this.LocaleService.localeConstants.LOCALES.FR_CA}},{key:"isCharity",get:function(){return this.person.beneficiary_type===this.BeneficiariesModalConstants.BENEFICIARY_TYPES.CHARITY}},{key:"isIndividual",get:function(){return this.person.beneficiary_type!==this.BeneficiariesModalConstants.BENEFICIARY_TYPES.CHARITY}},{key:"deleteWarningTitle",get:function(){return this.translateFilter("forms.banking.beneficiary.updateModal.deleteWarningTitle",{itemType:this.getItemTypeName(!1)})}},{key:"deleteWarnvalidateingMsg",get:function(){var t=this.BeneficiariesModalConstants.BENEFICIARY_TYPES;return this.translateFilter("forms.banking.beneficiary.updateModal.deleteWarningMsg",{personName:this.person.beneficiary_type===t.CHARITY?this.person.business_name:this.person.first_name+" "+this.person.last_name,itemType:this.getItemTypeName(!0),planNames:this.beneficiariesModalController.selectedPlans.map((function(t){return t.planDescription+" "+(t.planMaskedMFAccountNumber||t.planId)})).join(", ")})}},{key:"hasSubmitErrors",get:function(){return this.submitErrors&&this.submitErrors.length>0}}]),t}();c.$inject=["$scope","$log","BeneficiariesModalConstants","$q","ReferenceDataService","DateService","tngSelectAutocompleteConstants","$filter","$timeout","referenceDataConstants","customerConstants","AnchorService","BeneficiariesService","pageFlowConstants","ErrorService","errorConstants","LocaleService","EventBusService"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(5100)),a=d(n(5104)),s=d(n(5108)),r=d(n(5112)),o=d(n(5116)),c=d(n(5120)),l=d(n(5121)),u=d(n(5122));function d(t){return t&&t.__esModule?t:{default:t}}var h=angular.module("tangerine.payBills.payment.module",[]).component("tngPayBillsDialog",i.default).component("tngSelectBiller",a.default).component("tngSelectBillerDetails",s.default).component("tngReviewPayment",r.default).component("tngAllDonePage",o.default).service("PayBillsDialogService",c.default).service("PayBillsDialogFlowService",l.default).constant("PayBillsDialogConstants",u.default);e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5101)),a=s(n(5102));function s(t){return t&&t.__esModule?t:{default:t}}n(5103);var r={template:i.default,controller:a.default,bindings:{accountDetails:"<",onClose:"&",availFlag:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog ng-class="{\'isMobileNative\': $ctrl.service.isMobileView}" on-close="$ctrl.warnOnExit()" analytics-id="bill-payment" hide-close="$ctrl.service.loading" show-confirm-exit="$ctrl.service.showConfirmExitUI" on-allow-exit="$ctrl.onAllowExit()" on-deny-exit="$ctrl.service.showConfirmExitUI = false" flow-service="$ctrl.flowService"> <header> <span actionable-id="payBillsDialog_header" ng-bind-html="$ctrl.service.title | translate"> </span> </header> <tng-error-message message-only="!$ctrl.service.errorMessageTitle" message-title="$ctrl.service.errorMessageTitle" class="upload-error" ng-if="$ctrl.service.errors && $ctrl.service.errors.length > 0"> <ul class="error-list"> <li ng-class="{\'error-list-item\' : ($ctrl.service.errors && $ctrl.service.errors.length > 0)}" ng-repeat="error in $ctrl.service.errors"> <span class="li-message" translate>{{error}}</span> </li> </ul> </tng-error-message> <tng-select-biller ng-if="$ctrl.service.state === $ctrl.service.STATES.SELECT_BILLER" on-close="$ctrl.warnOnExit()" on-recurring-payment-link-clicked="$ctrl.onRecurringPaymentLinkClicked(payee)" avail-flag="$ctrl.availFlag"> </tng-select-biller> <tng-select-biller-details ng-if="$ctrl.service.state === $ctrl.service.STATES.SELECT_BILLER_DETAILS" on-recurring-payment-link-clicked="$ctrl.onRecurringPaymentLinkClicked(payee)" on-close="$ctrl.warnOnExit()"> </tng-select-biller-details> <tng-review-payment ng-if="$ctrl.service.state === $ctrl.service.STATES.REVIEW_PAYMENT" on-close="$ctrl.warnOnExit()"> </tng-review-payment> <tng-all-done-page ng-if="$ctrl.service.state === $ctrl.service.STATES.DONE" confirmed-payments="$ctrl.service.confirmedPayments" on-close="$ctrl.warnOnExit()"> </tng-all-done-page> <footer class="pay-bills-dialog-footer" ng-if="$ctrl.service.buttons && !$ctrl.service.loading"> <div> <tng-item-counter ng-if="$ctrl.service.state === $ctrl.service.STATES.SELECT_BILLER  && !$ctrl.service.isMobileView" class="item-counter" items="$ctrl.service.selectedPayees" scrolling-enabled="false" text-to-display="billPay.billPayV2.billerSelected"> </tng-item-counter> </div> <div> <button ng-repeat="button in $ctrl.service.buttons track by $index" ng-class="button.class" actionable-id="payBills_{{ ::button.name }}" ng-disabled="button.isDisabled && button.isDisabled()" ng-click="button.action()"> {{ button.label | translate }} </button> </div> </footer> <div class="loading-spinner-container" ng-if="$ctrl.service.loading"> <tng-loading-spinner> {{ ::\'global.pageFlow.loading.isLoading\' | translate }} </tng-loading-spinner> </div> </tng-modal-dialog> <tng-add-biller-dialog ng-if="$ctrl.service.showAddBillerModal" on-close="$ctrl.onAddBillerClose(result, goTo)" disable-curtain="true"> </tng-add-biller-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(0)),a=o(n(2)),s=n(1797),r=n(1802);function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f,p){(0,i.default)(this,t),this.$log=e,this.$scope=n,this.$state=s,this.$window=a,this.storageConstants=r,this.FeedbackSurveyConstants=o,this.EnvironmentService=c,this.service=l,this.flowService=u,this.addBillerDialogService=d,this.StorageService=h,this.FeedbackSurveyService=f,this.menuConstants=p,this.service.showConfirmExitUI=!1,this.service.reset()}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.flowService.setStates(this.service.STATES),this.flowService.activate(),this._setInitialState(),this.service.isMobileView=this.EnvironmentService.isMobileViewSize(),this.resizeEventHandler=this.resizeEventListener.bind(this),this.resize$=(0,s.fromEvent)(this.$window,"resize"),this.resizeSubscription=this.resize$.pipe((0,r.debounceTime)(200),(0,r.filter)((function(){return t.service.hasViewChanged()}))).subscribe(this.resizeEventHandler)}},{key:"_setInitialState",value:function(){this.service.setState(this.service.STATES.SELECT_BILLER)}},{key:"resizeEventListener",value:function(){var t=this;this.$scope.$apply((function(){t.service.isMobileView=t.EnvironmentService.isMobileViewSize(),t.service.state!==t.service.STATES.SELECT_BILLER&&t.service.state!==t.service.STATES.SELECT_BILLER_DETAILS||t.service.clearAndResetState()}))}},{key:"$onDestroy",value:function(){this.resizeSubscription&&this.resizeSubscription.unsubscribe(),this.flowService.deactivate()}},{key:"warnOnExit",value:function(){this.service.isConfirmationRequired(this.flowService.currentState)?this.service.showConfirmExitUI=!0:this.onModalClose()}},{key:"onAddBillerClose",value:function(t,e){this.service.onAddBillerClose(),this.service.goTo=e,"Finished"===t&&this.onModalClose()}},{key:"onModalClose",value:function(){this.onClose(),this.service.goTo&&this.$state.go(this.service.goTo,{},{reload:!0}),this.service.reset()}},{key:"onAllowExit",value:function(){this.onModalClose(),this.EnvironmentService.isIOS()||this.launchBillPayAbandonFeedback()}},{key:"launchBillPayAbandonFeedback",value:function(){var t=this,e=this.FeedbackSurveyConstants.MEDALLIA_FORM_IDS.BILL_PAY_ABANDON_FEEDBACK;return this.StorageService.getItem(this.storageConstants.KEYS.SURVEY_BILLPAY).then((function(n){return n||(t.StorageService.setItem(t.storageConstants.KEYS.SURVEY_BILLPAY,!0),t.FeedbackSurveyService.launchFeedbackSurvey(e)),n}))}},{key:"onRecurringPaymentLinkClicked",value:function(t){this.addBillerDialogService.initialState=this.addBillerDialogService.STATES.SET_UP_PAYMENT,this.addBillerDialogService.payeeForPayment=t,this.addBillerDialogService.setUpRecurringPayment=!0,this.service.showAddBillerModal=!0}},{key:"goToManageBills",value:function(){this.$state.go(this.menuConstants.ACTIVE_ON_PAGES.BILLS),this.onClose()}}]),t}();c.$inject=["$log","$scope","$window","$state","storageConstants","FeedbackSurveyConstants","EnvironmentService","PayBillsDialogService","PayBillsDialogFlowService","AddBillerDialogService","StorageService","FeedbackSurveyService","menuConstants"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5105)),a=s(n(5106));function s(t){return t&&t.__esModule?t:{default:t}}n(5107);var r={template:i.default,controller:a.default,bindings:{onClose:"&",onRecurringPaymentLinkClicked:"&?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div ng-if="!$ctrl.service.loading"> <div ng-if="$ctrl.service.isMobileView" class="mobile"> <div class="select-biller-heading-container"> <p>{{::$ctrl.heading | translate}}</p> </div> <div class="bill-pay-v2-button-group"> <button actionable-id="bill-pay-mobile-add_payee" class="btn btn--edit manage-bills-button" ng-click="$ctrl.service.showAddBiller()"> {{ ::\'billPay.billPayV2.addPayee\' | translate }} </button> <button actionable-id="bill-pay-mobile-multiple_pay_bills" class="btn btn--edit manage-bills-button" ng-click="$ctrl.goToManageBills()"> {{ ::\'billPay.landingPage.manageBills\' | translate }} </button> </div> <tng-biller-mobile ng-repeat="payee in $ctrl.service.payees track by $index" index="$index" select-subject="$ctrl.service.billerSelectSubject" biller="payee"> </tng-biller-mobile> </div> <div ng-if="!$ctrl.service.isMobileView" class="web padded-bottom"> <div class="select-biller-heading"> <p>{{::$ctrl.heading | translate}}</p> </div> <h4 class="heading--sub3 family-normal margin__b--fix1 account-select-heading"> {{ ::\'billPay.multipleBP.payFrom\' | translate }} </h4> <div class="field c-payee-multiple__selector account-select-container" id="billPay-selectBiller-selector"> <tng-select-autocomplete class="margin__b--fix2 account-select" input-id="selectBiller_select_accounts" ng-if="$ctrl.service.fromAccountOptions" ng-model="$ctrl.selectedFromAccount" on-select="$ctrl.onAccountChange(option)" options="$ctrl.service.fromAccountOptions" option-label-key="title" option-right-label-key="balance" option-value-key="number" alternate-light="true" select-type="$ctrl.selectConstants.SELECT_TYPES.STATIC"> </tng-select-autocomplete> <div class="bill-pay-v2-button-group"> <button actionable-id="bill-pay-add_new_payee" class="btn btn--edit manage-bills-button" ng-click="$ctrl.service.showAddBiller()"> {{ ::\'billPay.billPayV2.addPayee\' | translate }} </button> <button actionable-id="bill-pay-multiple_pay_bills" class="btn btn--edit manage-bills-button" ng-click="$ctrl.goToManageBills()"> {{ ::\'billPay.landingPage.manageBills\' | translate }} </button> </div> <div class="clear"></div> </div> <div actionable-id="biller-table" class="biller-table-header" ng-if="$ctrl.service.payees && $ctrl.service.payees.length"> <div class="checkbox"></div> <div class="biller-name">{{ ::\'billPay.billPayV2.tableHeader.billerName\' | translate }}</div> <div class="filler"></div> <div class="date">{{ ::\'billPay.billPayV2.tableHeader.paymentDate\' | translate }}</div> <div class="amount">{{ ::\'billPay.billPayV2.amount\' | translate }}</div> </div> <tng-biller ng-repeat="payee in $ctrl.service.payees track by $index" index="$index" select-subject="$ctrl.service.billerSelectSubject" amount-errors="payee.errors" has-amount-error="payee.hasError" biller="payee" on-recurring-payment-link-clicked="$ctrl.onRecurringPaymentLinkClicked({payee})" avail-flag="$ctrl.flowService.availFlag"> </tng-biller> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f,p,g,m){var _=this;(0,i.default)(this,t),this.$log=e,this.$q=n,this.$translate=r,this.$filter=o,this.$scope=a,this.EnvironmentService=c,this.service=l,this.flowService=u,this.EventBusService=d,this.selectConstants=h,this.serviceConstants=f,this.billPayConstants=p,this.menuConstants=g,this.stateConstants=m,this.buttons=[{label:"global.components.buttons.cancel",action:this.cancel.bind(this),class:"btn btn--edit",name:"selectBiller_cancel"},{label:this.service.isMobileView?"global.components.buttons.next":"global.components.buttons.reviewPayments",action:this.next.bind(this),class:"btn btn--tangerine",isDisabled:function(){return!_.nextEnabled()},name:this.service.isMobileView?"selectBiller_next":"selectBiller_reviewPayments"}],this.buttonsMobile=[{label:"global.components.buttons.cancel",action:this.cancel.bind(this),class:"btn btn--edit",name:"select-biller-mobile_cancel"},{label:"global.components.buttons.next",action:this.next.bind(this),class:"btn btn--tangerine",isDisabled:function(){return!_.nextEnabled()},name:"select-biller-mobile_next"}]}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;return this.service.title="billPay.multipleBP.headerFrom",this.heading="billPay.states.selectBiller",this.flowService&&(this.flowService.holdLink=!1),this.service.buttons=this.service.isMobileView?this.buttonsMobile:this.buttons,this.service.errors=[],this.billerSelectSubscription=this.service.getBillerSelectObservable$().subscribe(this._observer.bind(this)),this.EventBusService.subscribe(this.$scope,this.billPayConstants.EVENTS.ADD_PAYEE_DONE,(function(){t.service.loading=!0,t.service.retrievePayees().catch((function(e){t.service.handleErrors(e.message_code),t.service.loading=!1})).finally((function(){t.service.loading=!1}))})),this.service.loadAccountsAndPayees?(this.service.loading=!0,this.service.loadAccountsAndPayees=!1,this.$q.all({accountsResp:this.service.prepareAccounts(),payeesResp:this._preparePayees()}).then((function(){t.selectedFromAccount=t.service.selectedAccount&&t.service.selectedAccount.number,t.service.selectedAccount&&void 0!==t.service.selectedAccount.external_available_balance&&(t.external_avail_balance=t.$filter("currency")(t.service.selectedAccount.external_available_balance))})).catch((function(e){t.service.handleErrors(e.message_code),t.service.loadAccountsAndPayees=!0})).finally((function(){t.service.loading=!1}))):(this.selectedFromAccount=this.service.selectedAccount&&this.service.selectedAccount.number,this.$q.resolve())}},{key:"_observer",value:function(t){if(t){var e=this.service.payees.find((function(e){return e.id===t.biller.id})),n=!!this.service.selectedPayees.find((function(t){return t.id===e.id}));t.checked&&!n?this.service.selectedPayees.push(e):t.checked||(this.service.selectedPayees=this.service.selectedPayees.filter((function(t){return t.id!==e.id})))}}},{key:"onAccountChange",value:function(t){t&&t.index>=0&&(this.service.selectedAccount=this.service.fromAccounts[t.index],this.selectedFromAccount=this.service.selectedAccount.number,this.available_balance=this.$filter("currency")(this.service.selectedAccount.account_balance),this.external_avail_balance=this.$filter("currency")(this.service.selectedAccount.external_available_balance))}},{key:"goToManageBills",value:function(){this.service.goTo=this.menuConstants.ACTIVE_ON_PAGES.BILLS,this.onClose()}},{key:"_preparePayees",value:function(){return this.service.retrievePayees().then((function(t){return t=t.map((function(t){return t.dateIsBusinessDay=!0,t}))}))}},{key:"cancel",value:function(){this.onClose()}},{key:"next",value:function(){return this.service.resetErrors(),this.service.selectedAccount&&void 0!==this.service.selectedAccount.external_available_balance&&(this.external_avail_balance=this.$filter("currency")(this.service.selectedAccount.external_available_balance)),this.service.isMobileView?this._handleNextInMobileView():this._handleNextInWebView()}},{key:"_handleNextInMobileView",value:function(){return this.service.sortSelectedPayees(),this.service.setState(this.service.STATES.SELECT_BILLER_DETAILS),this.$q.resolve()}},{key:"_handleNextInWebView",value:function(){var t=this;return this.service.loading=!0,this.flowService&&(this.flowService.availFlag=!1,this.flowService.holdLink=!1),this.service.validatePaymentRequest().then((function(){return t.service.processPayments(!0,t.external_avail_balance)})).then((function(){t.service.setState(t.service.STATES.REVIEW_PAYMENT)})).catch((function(e){return t.service.handleErrors(e.message_code)})).finally((function(){t.service.loading=!1}))}},{key:"nextEnabled",value:function(){return this.service.selectedPayeesValid()}},{key:"$onDestroy",value:function(){this.billerSelectSubscription.unsubscribe()}}]),t}();r.$inject=["$log","$q","$scope","$state","$translate","$filter","EnvironmentService","PayBillsDialogService","PayBillsDialogFlowService","EventBusService","tngSelectAutocompleteConstants","serviceConstants","billPayConstants","menuConstants","stateConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5109)),a=s(n(5110));function s(t){return t&&t.__esModule?t:{default:t}}n(5111);var r={template:i.default,controller:a.default,bindings:{onClose:"&",onRecurringPaymentLinkClicked:"&?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div ng-if="!$ctrl.service.loading"> <h4 class="heading--sub3 family-normal margin__b--fix1 account-select-heading"> {{ ::\'billPay.multipleBP.payFrom\' | translate }} </h4> <div class="field c-payee-multiple__selector account-select-container" id="billPay-selectBiller-selector"> <tng-select-autocomplete class="margin__b--fix2 account-select" input-id="selectBiller_select_accounts" ng-if="$ctrl.service.fromAccountOptions" ng-model="$ctrl.service.selectedFromAccount" on-select="$ctrl.onAccountChange(option)" options="$ctrl.service.fromAccountOptions" option-label-key="title" option-right-label-key="balance" option-value-key="number" alternate-light="true" select-type="$ctrl.selectConstants.SELECT_TYPES.STATIC" enable-for-mobile="true"> </tng-select-autocomplete> <div class="clear"></div> </div> <tng-biller-details-mobile ng-repeat="payee in $ctrl.service.selectedPayees track by $index" index="$index" amount-errors="payee.errors" has-amount-error="payee.hasError" biller="payee" on-recurring-payment-link-clicked="$ctrl.onRecurringPaymentLinkClicked({payee})" avail-flag="$ctrl.flowService.availFlag" go-to-holds-page="$ctrl.goToHoldsPage()"> </tng-biller-details-mobile> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d,h){(0,i.default)(this,t),this.$log=e,this.$q=n,this.$translate=a,this.$filter=s,this.service=r,this.menuConstants=o,this.serviceConstants=c,this.selectConstants=l,this.flowService=u,this.$state=d,this.stateConstants=h}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.service.title="billPay.multipleBP.headerFrom",this.heading="billPay.states.selectBiller",this.flowService&&(this.flowService.holdLink=!1),this.service.buttons=[{label:"global.components.buttons.back",action:this.back.bind(this),class:"btn btn--edit",name:"select-biller-mobile_back"},{label:this.service.isMobileApp?"global.components.buttons.reviewPaymentsMobile":"global.components.buttons.reviewPayments",action:this.next.bind(this),class:"btn btn--tangerine",isDisabled:function(){return!t.nextEnabled()},name:this.service.isMobileApp?"select-biller-mobile_next":"selectBiller_next"}],this.service.errors=[],this.service.selectedAccount&&void 0!==this.service.selectedAccount.external_available_balance&&(this.external_available_balance=this.$filter("currency")(this.service.selectedAccount.external_available_balance)),this.billerSelectSubscription=this.service.getBillerSelectObservable$().subscribe(this._observer.bind(this))}},{key:"_observer",value:function(t){if(t){var e=this.service.payees.find((function(e){return e.id===t.biller.id})),n=!!this.service.selectedPayees.find((function(t){return t.id===e.id}));t.checked&&!n?this.service.selectedPayees.push(e):t.checked||(this.service.selectedPayees=this.service.selectedPayees.filter((function(t){return t.id!==e.id})))}}},{key:"onAccountChange",value:function(t){t&&t.index>=0&&(this.service.selectedAccount=this.service.fromAccounts[t.index],this.available_balance=this.$filter("currency")(this.service.selectedAccount.account_balance),this.external_available_balance=this.$filter("currency")(this.service.selectedAccount.external_available_balance))}},{key:"back",value:function(){this.service.setState(this.service.STATES.SELECT_BILLER)}},{key:"next",value:function(){var t=this;return this.service.loading=!0,this.service.resetErrors(),this.flowService&&(this.flowService.availFlag=!1,this.flowService.holdLink=!1),this.service.validatePaymentRequest().then((function(){return t.service.processPayments(!0,t.external_available_balance)})).then((function(){t.service.setState(t.service.STATES.REVIEW_PAYMENT)})).catch((function(e){return t.service.handleErrors(e.message_code)})).finally((function(){t.service.loading=!1}))}},{key:"nextEnabled",value:function(){return this.service.selectedPayeesValid()}},{key:"$onDestroy",value:function(){this.billerSelectSubscription.unsubscribe()}},{key:"goToHoldsPage",value:function(){this.$state.go(this.stateConstants.HOLDS_MODAL)}}]),t}();r.$inject=["$log","$q","$translate","$filter","PayBillsDialogService","menuConstants","serviceConstants","tngSelectAutocompleteConstants","PayBillsDialogFlowService","$state","stateConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(5113);var i=s(n(5114)),a=s(n(5115));function s(t){return t&&t.__esModule?t:{default:t}}var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e,n){},function(t,e){t.exports='<div class="c-review-payment" ng-if="!$ctrl.service.loading"> <div class="c-review-payment__heading" ng-if="$ctrl.payEnabled()" ng-bind-html="\'billPay.states.reviewPayment\' | translate: {\n            totalPayment: ($ctrl.totalPayment | currency),\n          }"> </div> <div class="c-review-payment__disclaimer"> {{ ::\'billPay.states.disclaimer\' | translate }} <span ng-if="$ctrl.displayDynamicDisclaimer"> {{ ::\'billPay.states.dynamicDisclaimer\' | translate }} </span> </div> <div class="c-review-payment__tiles"> <tng-tile-list pay-bill-v2="true" tile-data="$ctrl.service.selectedAccount" ng-if="$ctrl.service.selectedAccount" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" all-actionable="true" on-tile-click="$ctrl.back();"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.service.selectedPayees" tile-type="$ctrl.tileListConstants.TILE_TYPE.review" all-actionable="true" on-tile-click="$ctrl.back();"> </tng-tile-list> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.$q=n,this.service=a,this.accountsService=s,this.serviceConstants=r,this.tileListConstants=o}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.service.title="billPay.multipleBP.reviewPayment",this.heading="billPay.states.reviewPayment",this.service.buttons=[{label:"global.components.buttons.back",action:this.back.bind(this),class:"btn btn--edit",name:"reviewPayment_back"},{label:"global.components.buttons.pay",action:this.next.bind(this),class:"btn btn--tangerine",name:"reviewPayment_pay",isDisabled:function(){return!t.payEnabled()}}],this.service.loading=!1,this.service.errors=[]}},{key:"back",value:function(){this.service.setState(this.service.STATES.SELECT_BILLER)}},{key:"payEnabled",value:function(){return!this.service.disablePayButton}},{key:"next",value:function(){var t=this;return this.service.loading=!0,this.service.resetErrors(),this.service.processPayments(!1).then((function(){return t.accountsService.getAccounts().then((function(e){t._processAccountLookupResponse(e),t.service.setState(t.service.STATES.DONE)})).catch((function(e){t.service.handleErrors(e.message_code)}))})).catch((function(e){t.service.handleErrors(e.message_code)})).finally((function(){t.service.loading=!1}))}},{key:"_processAccountLookupResponse",value:function(t){var e=this,n=t.fromAccounts.find((function(t){return t.number===e.service.selectedAccount.number}));this.service.selectedAccount.account_balance=n.available_balance}},{key:"totalPayment",get:function(){return this.service.selectedPayees.reduce((function(t,e){return Number(t)+Number(e.amount)}),0)}},{key:"payeeNames",get:function(){return this.service.selectedPayees.map((function(t){return t.name})).join(", ")}},{key:"displayDynamicDisclaimer",get:function(){return this.service.selectedPayees.reduce((function(t,e){return t||e.isScheduledWeekend}),!1)}}]),t}();r.$inject=["$log","$q","PayBillsDialogService","BillPayAccountsService","serviceConstants","tngTileListConstants"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(5117);var i=s(n(5118)),a=s(n(5119));function s(t){return t&&t.__esModule?t:{default:t}}var r={template:i.default,controller:a.default,bindings:{paymentResult:"<?",confirmedPayments:"<",onClose:"&"}};e.default=r,t.exports=e.default},function(t,e,n){},function(t,e){t.exports='<div class="all-done-container" ng-if="!$ctrl.service.loading"> <div class="all-done-page-heading"> <p ng-bind-html="::$ctrl.heading | translate"></p> </div> <div class="from-account panel"> <span> {{ ::\'billPay.multipleBP.newBalance\' | translate }} </span> <span class="bold-account"> {{ ::$ctrl.accountDisplayName | normalizeType }} {{ ::$ctrl.service.selectedAccount.display_name | maskNumber }} </span> <div class="balance"> {{ ::$ctrl.service.selectedAccount.account_balance | currency }} </div> </div> <div class="payment-groups" ng-repeat="date in $ctrl.sortedPaymentDates track by $index"> <span>{{::\'billPay.billPayV2.allDonePage.paymentGroupHeader\' | translate}}</span> <b>{{ $ctrl.stringToJsDate(date) | date: $ctrl.isFrench ? \'dd MMMM yyyy\' : \'MMMM dd yyyy\' }}.</b><br> <tng-tile-list pay-bill-v2="true" tile-data="$ctrl.groupedPayments[date]" tile-type="$ctrl.tileListConstants.TILE_TYPE.confirmPaymentPayBill" go-to-manage-bills="$ctrl.goToManageBills()"> </tng-tile-list> </div> <tng-print-button button-class="btn btn-grey" only-element="\'printMe\'">{{ ::\'global.print\' | translate}}</tng-print-button> </div> <div id="printMe"> <div class="all-done-details-print"> <div class="print-content" style="margin:70px;width:90%"> <header> {{ ::$ctrl.service.title | translate }} </header> <br/> <p ng-bind-html="::$ctrl.heading | translate"></p> <table> <tr> <td> <div> <span> {{ ::\'billPay.multipleBP.newBalance\' | translate }} </span> <span> {{ ::$ctrl.accountDisplayName | normalizeType }} {{ ::$ctrl.service.selectedAccount.display_name | maskNumber }} </span> </div> <div> <b> {{ ::$ctrl.service.selectedAccount.account_balance | currency }} </b> </div> </td> </tr> </table> <div ng-repeat="date in $ctrl.sortedPaymentDates track by $index"> <br><br> {{::\'billPay.billPayV2.allDonePage.paymentGroupHeader\' | translate}} <b>{{ $ctrl.stringToJsDate(date) | date: \'MMMM dd, yyyy\'}}.</b> <br><br> <tng-tile-list pay-bill-v2="true" tile-data="$ctrl.groupedPayments[date]" tile-type="$ctrl.tileListConstants.TILE_TYPE.confirmPaymentPayBill"> </tng-tile-list> <br> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(15)),a=o(n(0)),s=o(n(2)),r=o(n(45));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,s,r,o,c,l,u){(0,a.default)(this,t),this.$log=e,this.$q=n,this.service=i,this.localeService=s,this.EventBusService=r,this.billPayConstants=o,this.LOCALES=s.localeConstants.LOCALES,this.serviceConstants=c,this.tileListConstants=l,this.menuConstants=u,this.dateFormat="YYYYMMDD"}return(0,s.default)(t,[{key:"$onInit",value:function(){this.service.title="billPay.billPayV2.allDonePage.title",this.heading="billPay.billPayV2.allDonePage.heading",this.service.loading=!1,this.groupedPayments=this.groupConfirmedPayments(this.confirmedPayments),this.sortedPaymentDates=this.sortConfirmedPaymentsByDate(this.groupedPayments),this.service.buttons=[{label:"global.components.buttons.done",action:this.done.bind(this),class:"btn btn--tangerine",name:"alldone_done"}]}},{key:"stringToJsDate",value:function(t){return(0,r.default)(t,this.dateFormat).toDate()}},{key:"groupConfirmedPayments",value:function(t){var e=this,n={};return t&&t.length>0&&t.forEach((function(t){var i=t.selectedDate.format(e.dateFormat);n[i]?n[i].push(t):(n[i]=[],n[i].push(t))})),n}},{key:"sortConfirmedPaymentsByDate",value:function(t){return t?(0,i.default)(t).sort((function(t,e){return new Date(t)-new Date(e)})):[]}},{key:"done",value:function(){this.EventBusService.publish(this.billPayConstants.EVENTS.REFRESH_PAYEES),this.onClose()}},{key:"goToManageBills",value:function(){this.service.goTo=this.menuConstants.ACTIVE_ON_PAGES.BILLS,this.done()}},{key:"isFrench",get:function(){return this.localeService.locale===this.LOCALES.FR_CA}},{key:"accountDisplayName",get:function(){return this.service.accountHelpersService.getDisplayNameInstant(this.service.selectedAccount)}}]),t}();c.$inject=["$log","$q","PayBillsDialogService","LocaleService","EventBusService","billPayConstants","serviceConstants","tngTileListConstants","menuConstants"],e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(104)),a=d(n(92)),s=d(n(0)),r=d(n(2)),o=d(n(1872)),c=d(n(553)),l=d(n(116)),u=n(1797);function d(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(e,n,i,a,r,o,c,l,d,h,f,p,g,m,_,v,S,T,y,E,A){(0,s.default)(this,t),this.$log=e,this.$q=n,this.$translate=i,this.$sce=a,this.$timeout=r,this.$filter=o,this.EnvironmentService=c,this.ErrorService=l,this.RequesterService=d,this.PayeeListService=h,this.payBillService=f,this.accountHelpersService=p,this.billHistoryService=g,this.flowService=m,this.EventBusService=_,this.ERROR_EVENTS=v.AVAILABLE_EVENTS,this.serviceConstants=S,this.STATES=T.STATES,this.billPayConstants=y,this.transactionTypes=y.BILL_HISTORY_FILTER,this.transactionFrequency=y.FREQUENCY,this.tngDateSelectorConstants=E,this.GOOD_STATUS_CODES=A,this.billerSelectSubject=new u.Subject,this.TANGERINE_MASTERCARD="TANGERINE MASTERCARD",this.errorMessageTitle="",this.reset()}return(0,r.default)(t,[{key:"handleErrors",value:function(t){var e=this;return this.errors=[],this.ErrorService.processError(t,this.ERROR_EVENTS.REQUEST_ERROR).then((function(t){return t&&t.message&&e.errors.push(t.message),e.errors}))}},{key:"retrieveAccounts",value:function(){var t=this;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.BILL_PAY_ACCOUNTS).then((function(e){return t.fromAccounts=e&&e.fromAccounts,t.fromAccounts}))}},{key:"retrievePayees",value:function(){var t=this;return this.PayeeListService.getPayees({},{resetCache:!0}).then((function(e){var n=e&&e.payees;return n&&n.length&&t.payees&&t.payees.length&&(n=n.map((function(e){var n=t.payees.find((function(t){return t.id===e.id}));return(0,a.default)({},e,{amount:n&&n.amount,selectedDate:n&&n.selectedDate})}))),n})).then((function(e){return t.payees=angular.copy(e),t.payees.forEach((function(e){e.name=t.titleCase(e.name)})),t._getTransactionHistory().then((function(e){var n=e.pending_transactions.filter((function(e){return e.type===t.transactionTypes.BP&&e.frequency!==t.transactionFrequency.ONCE}));return t._addTransactionDateToPayees(t.payees,n),t.payees}))}))}},{key:"prepareAccounts",value:function(){var t=this;return this.retrieveAccounts().then((function(e){return t._prepareAccountsSelection(e),e}))}},{key:"_prepareAccountsSelection",value:function(t){var e=this;t&&0!==t.length&&(this.selectedAccount=t[0],this.selectedAccount.tileDescription=this.$translate.instant("billPay.multipleBP.payFrom"),this.selectedFromAccount=this.selectedAccount.number,this.available_balance=this.$filter("currency")(this.selectedAccount.account_balance),this.fromAccountOptions=t.map((function(t,n){var i=e.EnvironmentService.isPhone()?10:20,a=t.nickname?t.nickname:e.$translate.instant("billPay.multipleBP.chequing");return a.length>i&&(a=a.substring(i,0)+"..."),{title:"<b>"+a+"</b>  "+e.$filter("maskNumber")(t.display_name),balance:e.$filter("currency")(t.account_balance),index:n,number:t.number}})))}},{key:"_mapErrorCodeToMessage",value:function(t){return{code:t,message:this.$sce.trustAsHtml(this.$translate.instant("global.errorCodes."+t))}}},{key:"validatePaymentRequest",value:function(){var t=this,e={message_code:"billPay.errorPrompt"};if(this.selectedPayees&&this.selectedPayees.length){var n=this.billPayConstants.ERROR_CODES.BP_AMOUNT_NOT_GREATER_THAN_ZERO.valueOf(),i=this.selectedPayees.filter((function(e){return t._isPayeeAmountInvalid(e)}));return i.forEach((function(e){e.errors=[t._mapErrorCodeToMessage(n)],e.hasError=!0})),i&&i.length?this.$q.reject(e):this.$q.resolve()}return this.$q.reject(e)}},{key:"validateSinglePaymentRequest",value:function(t){var e={message_code:"billPay.errorPrompt"};if(t){var n=this.billPayConstants.ERROR_CODES.BP_AMOUNT_NOT_GREATER_THAN_ZERO.valueOf();return this._isPayeeAmountInvalid(t)?(t.errors=[this._mapErrorCodeToMessage(n)],t.hasError=!0,this.$q.reject(e)):this.$q.resolve(t)}return this.$q.reject(e)}},{key:"_isPayeeAmountInvalid",value:function(t){return isNaN(t.amount)||t.amount<=0}},{key:"_getTransactionHistory",value:function(){return this.billHistoryService.getScheduledPayments()}},{key:"_addTransactionDateToPayees",value:function(t,e){t&&t.length>0&&e&&e.length>0&&(t=this._addEffectiveDate(t,e))}},{key:"_addEffectiveDate",value:function(t,e){return t.forEach((function(t){t.transactionHistory=[],e.forEach((function(n,i){if(t.account_number===e[i].to_account.number||t.account_token===e[i].to_account.number)if(t.transactionHistory.length>0){var a=!1;if(t.transactionHistory.forEach((function(e){e.frequency===n.frequency&&(a=!0,(!t.last_payment_date||n.effective_date>t.last_payment_date)&&e.date>n.effective_date&&(e.date=n.effective_date,e.amount=n.amount))})),!a){var s={frequency:n.frequency,date:n.effective_date,amount:n.amount};t.transactionHistory.push(s)}}else{var r={frequency:n.frequency,date:n.effective_date,amount:n.amount};t.transactionHistory.push(r)}t.transactionHistory.length>1&&t.transactionHistory.sort((function(t,e){return e.date<t.date}))}))})),t}},{key:"getPaymentSummary",value:function(t){var e=this,n="";return t&&t.length&&t.forEach((function(t,i){0!==i&&(n+=", "),n+=e.$translate.instant("billPay.billPayV2.selectBillerPage.paymentDateAmount",{paymentDate:t.date,paymentAmount:t.amount})})),n}},{key:"processPayments",value:function(t,e){var n=this;return this._preparePayload().then((function(e){return e.validate_only=t,e.id=n.selectedAccount.number,n.payBillService.submitMultiBillTransaction(e)})).then((function(i){return n._handlePaymentsResponse(i,t,e)}))}},{key:"processSinglePayment",value:function(t,e,n){var i=this;return this._prepareSinglePayload(t).then((function(t){return t.validate_only=n,t.id=e.number,i.payBillService.submitMultiBillTransaction(t)})).then((function(e){return i._handleSinglePaymentResponse(t,e,n)}))}},{key:"updateSinglePayment",value:function(t,e,n){var i=this;return this._prepareSinglePayload(t).then((function(a){var s=a.payments[0],r={payee:{id:s.payee_id},payFromAccount:{number:e.number},sequenceNumber:n.sequenceNumber,when:s.when,frequency:s.frequency,amount:s.amount,scheduledStartDate:s.scheduled_start_date?moment(s.scheduled_start_date,"YYYY-MM-DD"):void 0,scheduledEndDate:s.scheduled_end_date?moment(s.scheduled_end_date,"YYYY-MM-DD"):void 0,datePickerSelectionMode:s.when===i.billPayConstants.WHEN.ONGOING&&t.isIndefinitely&&!t.selectedEndDate?i.tngDateSelectorConstants.DATE_SELECTOR_MODES.INDEFINITE:void 0};return i.payBillService.updateExistingTransaction(r)})).then((function(t){return i._handleUpdateSinglePaymentResponse(t)})).catch((function(t){return i.$log.error("cannot update transaction",t),i._handleUpdateSinglePaymentError(t).then((function(t){return i.$q.reject(t)}))}))}},{key:"_preparePayload",value:function(){var t=this;return this.sortSelectedPayees(),this.$q.resolve({payments:this.selectedPayees.map((function(e){return t._mapPayeeToPayment(e)}))})}},{key:"_prepareSinglePayload",value:function(t){return this.$q.resolve({payments:[this._mapPayeeToPayment(t)]})}},{key:"_mapPayeeToPayment",value:function(t){var e={payee_id:t.id,amount:t.amount||0,when:this._getPaySchedule(t)};return e.when!==this.billPayConstants.WHEN.NOW&&(e.scheduled_start_date=moment(t.selectedDate).format(this.billPayConstants.MOMENT_FORMAT),e.when===this.billPayConstants.WHEN.ONGOING&&(e.frequency=t.frequency,!t.isIndefinitely&&t.selectedEndDate&&(e.scheduled_end_date=moment(t.selectedEndDate).format(this.billPayConstants.MOMENT_FORMAT)))),e}},{key:"sortSelectedPayees",value:function(){this.selectedPayees&&this.selectedPayees.sort((function(t,e){var n=t.name;t.nickname&&(n=t.nickname);var i=e.name;return e.nickname&&(i=e.nickname),n.toLowerCase().localeCompare(i.toLowerCase())}))}},{key:"_prepareMultipleBPErrorMessage",value:function(t){return t.code===this.serviceConstants.STATUS_CODES.RANGE?this.$sce.trustAsHtml(this.$translate.instant("billPay.multipleBP.billsToolTip")):t.code===this.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_DAILY?this.$sce.trustAsHtml(this.$translate.instant("global.errorCodes.BP_LIMIT_VIOLATION_DAILY")):t.code===this.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_SINGLE_PAYMENT?this.$sce.trustAsHtml(this.$translate.instant("global.errorCodes.BP_LIMIT_VIOLATION_SINGLE_PAYMENT")):""}},{key:"_handleSinglePaymentResponse",value:function(t,e,n){var i=this,s=!1,r=void 0;if(this.errorMessageTitle="",t.hasError=!1,t.errors=[],e.response_status.status_code!==this.serviceConstants.STATUS_CODES.SUCCESS)s=!0,e.response_status.details?e.response_status.details.forEach((function(t){if(t.field_name.indexOf("payments")>-1){var e=t.details_code,n=i._prepareMultipleBPErrorMessage(t);i.payee.errors.push({code:e,message:n})}})):e.response_status.status_code===this.billPayConstants.ERROR_CODES.DUPLICATE_TRANSACTION?(this.disablePayButton=!0,s=!0):e.response_status.status_code===this.serviceConstants.STATUS_CODES.SYSTEM_ERROR?(s=!0,-1!==[this.billPayConstants.ERROR_CODES.BP_SYSTEM_ERROR,this.billPayConstants.ERROR_CODES.BP_TELUS_SERVICE_DOWN,this.billPayConstants.ERROR_CODES.DUPBPMT].indexOf(e.response_status.return_code)?(t.hasError=!0,t.errors.push(this._mapErrorCodeToMessage(e.response_status.return_code)),r="billPay.errorPrompt"):this.billPayConstants.ERROR_CODES.BP_RESTRICT===e.response_status.return_code?r=e.response_status.return_code:this.billPayConstants.ERROR_CODES.REMOVEOLDCREDITCARD===e.response_status.return_code&&(r=e.response_status.return_code,this.errorMessageTitle=this.$translate.instant("global.errorCodes.billPay.removeOldCreditCardHeader"))):e.response_status.status_code===this.serviceConstants.STATUS_CODES.AVLBAL||e.response_status.status_code===this.serviceConstants.STATUS_CODES.MM_OVER_PAYMENT?(s=!0,e.response_status.return_code!==this.billPayConstants.ERROR_CODES.AVLBAL&&e.response_status.return_code!==this.billPayConstants.ERROR_CODES.MM_OVER_PAYMENT||(t.hasError=!0,t.errors.push(this._mapErrorCodeToMessage(e.response_status.return_code)),r="billPay.errorPrompt")):e.response_status.status_code===this.billPayConstants.ERROR_CODES.BP_LIMITS_VIOLATION&&e.response_status.return_code===this.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_DAILY&&(s=!0,r=e.response_status.return_code);else if(e.response_status.status_code===this.serviceConstants.STATUS_CODES.SUCCESS){this.confirmedPayments=[];var o=void 0;e.confirmations.forEach((function(e){if(e.errors&&e.errors.length){o=e.errors[e.errors.length-1].code;var c=[i.billPayConstants.ERROR_CODES.AVLBAL.valueOf(),i.billPayConstants.ERROR_CODES.AVLBALHLD.valueOf(),i.billPayConstants.ERROR_CODES.BP_AMOUNT_NOT_GREATER_THAN_ZERO.valueOf(),i.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_DAILY.valueOf(),i.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_SINGLE_PAYMENT.valueOf(),i.billPayConstants.ERROR_CODES.BP_SYSTEM_ERROR.valueOf()],l=!1;o&&-1!==c.indexOf(o)||(o="billPay.multipleBP.paymentNotProccessed",l=!0),s=!0,n?(t.hasError=!0,l||(o="global.errorCodes."+o),t.errors.push({code:o,message:(i.billPayConstants.ERROR_CODES.AVLBAL.valueOf().indexOf(o),i.$sce.trustAsHtml(i.$translate.instant(o)))}),r="billPay.errorPrompt"):(r=o,i.disablePayButton=!0)}else i.confirmedPayments.push((0,a.default)({},t,{confirmation_code:e.confirmation_code,tileHeader:t.nickname||t.name})),t.confirmation_code=e.confirmation_code})),n||this.EventBusService.publish(this.billPayConstants.EVENTS.REFRESH_PAYEES)}return s?(r&&(e.message_code=r),this.$q.reject(e)):e}},{key:"_handleUpdateSinglePaymentResponse",value:function(t){var e=this.GOOD_STATUS_CODES,n=this.$log,a=t.response_status;if(-1===e.TRANSACTION_STATUS_CODES.indexOf(a.status_code))return n.error("Transaction brought system error:",t),this.$q.reject(t);var s=this._getConfirmationResultData(t),r=(0,i.default)(s,1)[0],o=this._getConfirmationResultData(t,"warnings"),c=(0,i.default)(o,1)[0];return r?this.$q.reject({errorMessage:r.code}):c&&c.code&&!c.code===e.TRANSACTION_STATUSES.DUPLICATE_TRANSACTION?this.$q.reject({warningMessage:c.code}):t}},{key:"_getConfirmationResultData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"errors",n=(0,l.default)(t,"confirmation."+e);return Array.isArray(n)&&n||[]}},{key:"_handleUpdateSinglePaymentError",value:function(t){var e=this,n="";return this.ErrorService.processError(t,this.ERROR_EVENTS.REQUEST_ERROR).then((function(i){return e.$log.debug("data",i),i.code===e.serviceConstants.STATUS_CODES.RANGE?(t.response_status&&t.response_status.details&&(n=t.response_status.details[0].detail_code),n):(n="generic"===i.code?t.errorMessage===e.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_DAILY?e.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_DAILY:t.errorMessage===e.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_SINGLE_PAYMENT?e.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_SINGLE_PAYMENT:t.errorMessage===e.billPayConstants.ERROR_CODES.AVLBAL?e.billPayConstants.ERROR_CODES.AVLBAL:i.message:i.code===e.billPayConstants.ERROR_CODES.DUPTRAN?e.billPayConstants.ERROR_CODES.DUPTRAN:i.code,e.$log.debug("errorCode:",n),n)}))}},{key:"_handlePaymentsResponse",value:function(t,e,n){var i=this,s=!1,r=void 0;if(this.errorMessageTitle="",this.selectedPayees.forEach((function(t){t.hasError=!1,t.errors=[]})),t.response_status.status_code!==this.serviceConstants.STATUS_CODES.SUCCESS)s=!0,t.response_status.details?t.response_status.details.forEach((function(t){if(t.field_name.indexOf("payments")>-1){var e=t.field_name.match(/\d+/g),n=t.details_code,a=i._prepareMultipleBPErrorMessage(t);i.selectedPayees[e].hasError=!0,i.selectedPayees[e].errors.push({code:n,message:a})}})):t.response_status.status_code===this.billPayConstants.ERROR_CODES.DUPLICATE_TRANSACTION?(this.disablePayButton=!0,s=!0):t.response_status.status_code===this.serviceConstants.STATUS_CODES.SYSTEM_ERROR?(s=!0,-1!==[this.billPayConstants.ERROR_CODES.BP_RESTRICT,this.billPayConstants.ERROR_CODES.BP_SYSTEM_ERROR,this.billPayConstants.ERROR_CODES.BP_TELUS_SERVICE_DOWN,this.billPayConstants.ERROR_CODES.DUPBPMT].indexOf(t.response_status.return_code)?(this.selectedPayees.forEach((function(e){e.hasError=!0,e.errors.push(i._mapErrorCodeToMessage(t.response_status.return_code))})),r="billPay.errorPrompt"):this.billPayConstants.ERROR_CODES.REMOVEOLDCREDITCARD===t.response_status.return_code&&(r=t.response_status.return_code,this.errorMessageTitle=this.$translate.instant("global.errorCodes.billPay.removeOldCreditCardHeader"))):t.response_status.status_code===this.serviceConstants.STATUS_CODES.AVLBAL||t.response_status.status_code===this.serviceConstants.STATUS_CODES.MM_OVER_PAYMENT?(s=!0,t.response_status.return_code!==this.billPayConstants.ERROR_CODES.AVLBAL&&t.response_status.return_code!==this.billPayConstants.ERROR_CODES.MM_OVER_PAYMENT||(this.selectedPayees.forEach((function(e){e.hasError=!0,e.errors.push(i._mapErrorCodeToMessage(t.response_status.return_code))})),r="billPay.errorPrompt")):t.response_status.status_code===this.billPayConstants.ERROR_CODES.BP_LIMITS_VIOLATION&&t.response_status.return_code===this.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_DAILY&&(s=!0,r=t.response_status.return_code);else if(t.response_status.status_code===this.serviceConstants.STATUS_CODES.SUCCESS){this.confirmedPayments=[];var o=void 0;t.confirmations.forEach((function(t,l){if(t.errors&&t.errors.length){o=t.errors[t.errors.length-1].code;var u=[i.billPayConstants.ERROR_CODES.AVLBAL.valueOf(),i.billPayConstants.ERROR_CODES.AVLBALHLD.valueOf(),i.billPayConstants.ERROR_CODES.BP_AMOUNT_NOT_GREATER_THAN_ZERO.valueOf(),i.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_DAILY.valueOf(),i.billPayConstants.ERROR_CODES.BP_LIMIT_VIOLATION_SINGLE_PAYMENT.valueOf(),i.billPayConstants.ERROR_CODES.BP_SYSTEM_ERROR.valueOf()],d=!1;o&&-1!==u.indexOf(o)||(o="billPay.multipleBP.paymentNotProccessed",d=!0),s=!0,e?(i.selectedPayees[l].hasError=!0,i.billPayConstants.ERROR_CODES.AVLBALHLD===o&&(i.flowService.availFlag=!0),d||(o="global.errorCodes."+o),i.selectedPayees[l].errors.push({code:o,message:i.flowService.availFlag?i.$sce.trustAsHtml(i.$translate.instant(o,{availAmount:n})):i.$sce.trustAsHtml(i.$translate.instant(o))}),r="billPay.errorPrompt"):(r=o,i.disablePayButton=!0)}else{var h=!1,f=i.selectedPayees[l];t.warnings&&(h=(0,c.default)(t.warnings,["code",i.billPayConstants.WARNINGS.REMINDER_REMOVEOLDCREDITCARD])>-1),i.confirmedPayments.push((0,a.default)({},f,{confirmation_code:t.confirmation_code,tileHeader:f.nickname||f.name,showRemoveOldCreditCardReminder:h}))}}))}return s?(r&&(t.message_code=r),this.$q.reject(t)):t}},{key:"_getPaySchedule",value:function(t){var e=moment().tz("America/Toronto").format(this.billPayConstants.MOMENT_FORMAT);return t.frequency&&t.frequency!==this.transactionFrequency.NONE?this.billPayConstants.WHEN.ONGOING:moment(t.selectedDate.format(this.billPayConstants.MOMENT_FORMAT)).isSameOrBefore(e)?this.billPayConstants.WHEN.NOW:this.billPayConstants.WHEN.LATER}},{key:"getBillerSelectObservable$",value:function(){return this.billerSelectSubject.asObservable()}},{key:"clearPayeeErrors",value:function(){this.selectedPayees&&this.selectedPayees.length&&(this.selectedPayees=this.selectedPayees.map((function(t){return(0,a.default)({},t,{hasError:!1,errors:[]})})))}},{key:"isConfirmationRequired",value:function(t){return!!(t!==this.STATES.DONE&&this.selectedPayees&&this.selectedPayees.length>0)}},{key:"showAddBiller",value:function(){this.showAddBillerModal=!0}},{key:"onAddBillerClose",value:function(){this.showAddBillerModal=!1}},{key:"hasViewChanged",value:function(){return this.EnvironmentService.isMobileViewSize()!==!!this.isMobileView}},{key:"selectedPayeesValid",value:function(){return!(!this.selectedPayees||!this.selectedPayees.length)}},{key:"titleCase",value:function(t){return t?(0,o.default)(t.toLowerCase()):""}},{key:"setState",value:function(t){this.state=t,this.flowService.currentState=t}},{key:"resetState",value:function(){delete this.state,delete this.flowService.currentState}},{key:"clearAndResetState",value:function(){var t=this;return this.resetState(),this.loading=!0,this.$timeout((function(){t.setState(t.STATES.SELECT_BILLER)}),10).finally((function(){t.loading=!1}))}},{key:"isTangerineCC",value:function(t){return!(!t||!t.tangerine_credit_card)}},{key:"reset",value:function(){this.resetErrors(),this.loading=!1,this.selectedPayees=[],this.selectedFromAccount=null,this.loadAccountsAndPayees=!0,delete this.accountDetails,delete this.customer,delete this.fromAccountOptions,delete this.title,delete this.buttons,delete this.state,delete this.loading,delete this.showConfirmExitUI,delete this.payees,delete this.goTo}},{key:"resetErrors",value:function(){this.errors=[],this.disablePayButton=!1}}]),t}();h.$inject=["$log","$q","$translate","$sce","$timeout","$filter","EnvironmentService","ErrorService","RequesterService","PayeeListService","PayBillService","AccountHelpersService","BillHistoryService","PayBillsDialogFlowService","EventBusService","errorConstants","serviceConstants","PayBillsDialogConstants","billPayConstants","tngDateSelectorConstants","transactionConstants"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(177)),a=c(n(0)),s=c(n(2)),r=c(n(264)),o=c(n(265));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(t,n,s,o,c,l,u,d,h,f){(0,a.default)(this,e);var p=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,u,l,d));return p.$timeout=h,p.EVENTS=l.EVENTS,p.stateConstants=f,p.holdLink=!1,p}return(0,o.default)(e,t),(0,s.default)(e,[{key:"setStates",value:function(t){this.STATES=t}},{key:"_getAnalyticsID",value:function(){return"pay-bills-v2"}}]),e}(c(n(267)).default);l.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","$rootScope","AnalyticsService","$timeout","stateConstants"],e.default=l,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={STATES:{SELECT_BILLER:"SELECT_BILLER",SELECT_BILLER_DETAILS:"SELECT_BILLER_DETAILS",REVIEW_PAYMENT:"REVIEW_PAYMENT",DONE:"DONE"}},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=p(n(5124)),a=p(n(5125)),s=p(n(5126)),r=p(n(5130)),o=p(n(5134)),c=p(n(5138)),l=p(n(5142)),u=p(n(5146)),d=p(n(5150)),h=p(n(5154)),f=p(n(5158));function p(t){return t&&t.__esModule?t:{default:t}}var g=angular.module("tangerine.payBills.addBiller.module",[]).component("tngAddBillerDialog",s.default).component("tngSelectPayee",r.default).component("tngAddInfo",o.default).component("tngRecommendStart",l.default).component("tngRecommendEnd",u.default).component("tngSetUpPayment",d.default).component("tngSetUpPaymentReview",f.default).component("tngSetUpPaymentDone",h.default).component("tngAddBillerDone",c.default).service("AddBillerDialogService",i.default).constant("AddBillerDialogConstants",a.default);e.default=g,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(15)),a=l(n(177)),s=l(n(0)),r=l(n(2)),o=l(n(264)),c=l(n(265));function l(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(t,n,i,r,c,l,u,d,h,f,p,g,m,_,v,S){(0,s.default)(this,e);var T=(0,o.default)(this,(e.__proto__||(0,a.default)(e)).call(this,t,n,u,r,c,i,S,h));return T.STATES={SELECT_PAYEE:"SELECT_PAYEE",RECOMMEND_START:"RECOMMEND_START",RECOMMEND_END:"RECOMMEND_END",ADD_INFO:"ADD_INFO",SET_UP_PAYMENT:"SET_UP_PAYMENT",SET_UP_PAYMENT_REVIEW:"SET_UP_PAYMENT_REVIEW",SET_UP_PAYMENT_DONE:"SET_UP_PAYMENT_DONE",DONE:"DONE"},T.$log=t,T.$q=n,T.$window=c,T.$translate=l,T.errorService=d,T.billPayService=f,T.eventBusService=p,T.payBillService=g,T.ERROR_EVENTS=m.AVAILABLE_EVENTS,T.GOOD_STATUS_CODES=_,T.billPayConstants=v,T.ADD_BILLER_DIALOG="add_biller_dialog_v2",T.BP_DUPLICATE_PAYEE_INSTANCE="BP_DUPLICATE_PAYEE_INSTANCE",T.reset(),T}return(0,c.default)(e,t),(0,r.default)(e,[{key:"handleErrors",value:function(t){var e=this;return this.errorService.processError(t,this.ERROR_EVENTS.REQUEST_ERROR).then((function(t){e.errors.push(t&&t.message||e.$translate.instant("global.errorCodes.generic"))}))}},{key:"setState",value:function(t){t&&(this.currentState=t)}},{key:"createPayee",value:function(t){var e=this;return this.billPayService.createPayee({payee:{id:this.selectedPayee.id},nickname:this.selectedPayee.nickname,accountNumber:this.selectedPayee.accountNumber},t).then((function(n){return-1===e.GOOD_STATUS_CODES.TRANSACTION_STATUS_CODES.indexOf(n.response_status.status_code)?e.$q.reject(n):(t||e.eventBusService.publish(e.billPayConstants.EVENTS.REFRESH_PAYEES),e.selectedPayee.payee_id=n.payeeId,e.selectedPayee.tangerine_credit_card=n.tangerine_credit_card,n)}))}},{key:"updateExistingTransaction",value:function(t){return this.payBillService.updateExistingTransaction({sequenceNumber:t.sequenceNumber,amount:t.amount,when:t.frequency,scheduledStartDate:t.startDate,scheduledEndDate:t.endDate,pay:{id:t.payId},payFromAccount:{number:t.accountNumber}})}},{key:"clearAllErrors",value:function(){this.errors=[],this.clearPayeeToPayErrors()}},{key:"clearPayeeToPayErrors",value:function(){this.payeeForPayment&&(this.payeeForPayment.hasError=!1,this.payeeForPayment.errors=[])}},{key:"_getAnalyticsID",value:function(){return this.ADD_BILLER_DIALOG}},{key:"reset",value:function(){this.errors=[],delete this.isDirty,delete this.title,delete this.buttons,delete this.state,delete this.loading,delete this.showConfirmExitUI,delete this.selectedPayee,delete this.duplicatePayee,delete this.payeeForPayment,delete this.setUpRecurringPayment,delete this.singleBillPay,delete this.initialState,delete this.skipWarningDialog,delete this.selectedAccount,delete this.transactionForEditing}},{key:"isEditingPayment",get:function(){return!!this.transactionForEditing&&(0,i.default)(this.transactionForEditing).length>0}}]),e}(l(n(267)).default);u.$inject=["$log","$q","$rootScope","$state","$window","$translate","$transitions","ErrorService","AnalyticsService","BillPayService","EventBusService","PayBillService","errorConstants","transactionConstants","billPayConstants","pageFlowConstants"],e.default=u,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={STATES:{ADD_CARD:"ADD_CARD",ADD_CARD_DONE:"ADD_CARD_DONE",REVIEW:"REVIEW",DONE:"DONE",LIST:"LIST",LOADING:"LOADING",ERROR:"ERROR"},ERRORS:{},TRANSFER_FEE:.01,MIN_AMOUNT:500,ACTIONS:{DONE:"DONE",BACK:"BACK"}},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5127)),a=s(n(5128));function s(t){return t&&t.__esModule?t:{default:t}}n(5129);var r={template:i.default,controller:a.default,bindings:{onClose:"&",disableCurtain:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.warnOnExit()" ng-class="{ \'enable-lazy-loading\': $ctrl.service.currentState === $ctrl.service.STATES.SELECT_PAYEE }" analytics-id="add-payee" hide-close="$ctrl.service.loading" show-confirm-exit="$ctrl.service.showConfirmExitUI" on-allow-exit="$ctrl.onModalClose()" on-deny-exit="$ctrl.service.showConfirmExitUI = false" scroll-id="add-bill-modal-event" disable-animation="$ctrl.disableCurtain" disable-curtain="$ctrl.disableCurtain" flow-service="$ctrl.service"> <header> <span actionable-id="payBillsDialog_header" ng-bind-html="$ctrl.service.title | translate : $ctrl.service.titleParams"> </span> </header> <tng-error-message class="upload-error" ng-if="$ctrl.service.errors && $ctrl.service.errors.length"> <ul class="error-list"> <li ng-class="{\'error-list-item\' : $ctrl.service.errors}" ng-repeat="error in $ctrl.service.errors track by $index"> {{ error }} </li> </ul> </tng-error-message> <tng-select-payee ng-if="$ctrl.service.currentState === $ctrl.service.STATES.SELECT_PAYEE" on-close="$ctrl.warnOnExit()"> </tng-select-payee> <tng-add-info ng-if="$ctrl.service.currentState === $ctrl.service.STATES.ADD_INFO" on-close="$ctrl.warnOnExit()"> </tng-add-info> <tng-recommend-start ng-if="$ctrl.service.currentState === $ctrl.service.STATES.RECOMMEND_START" on-close="$ctrl.warnOnExit()"> </tng-recommend-start> <tng-recommend-end ng-if="$ctrl.service.currentState === $ctrl.service.STATES.RECOMMEND_END" on-close="$ctrl.warnOnExit()"> </tng-recommend-end> <tng-set-up-payment ng-if="$ctrl.service.currentState === $ctrl.service.STATES.SET_UP_PAYMENT" on-close="$ctrl.warnOnExit(action)"> </tng-set-up-payment> <tng-set-up-payment-review ng-if="$ctrl.service.currentState === $ctrl.service.STATES.SET_UP_PAYMENT_REVIEW" on-close="$ctrl.warnOnExit()"> </tng-set-up-payment-review> <tng-set-up-payment-done ng-if="$ctrl.service.currentState === $ctrl.service.STATES.SET_UP_PAYMENT_DONE" on-close="$ctrl.warnOnExit(action)"> </tng-set-up-payment-done> <tng-add-biller-done ng-if="$ctrl.service.currentState === $ctrl.service.STATES.DONE" on-close="$ctrl.warnOnExit()"> </tng-add-biller-done> <footer class="pay-bills-dialog-footer" ng-if="$ctrl.service.buttons && !$ctrl.service.loading"> <div class="add-bills-button-group"> <button ng-repeat="button in $ctrl.service.buttons track by $index" ng-class="button.class" actionable-id="payBills_{{ button.name }}" id="payBills_{{ button.name }}" ng-disabled="button.isDisabled && button.isDisabled()" ng-click="button.action()"> {{ button.label | translate }} </button> </div> </footer> <div class="loading-spinner-container" ng-if="$ctrl.service.loading"> <tng-loading-spinner> {{ ::\'global.pageFlow.loading.isLoading\' | translate }} </tng-loading-spinner> </div> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.$log=e,this.billPayConstants=n,this.AddBillerDialogConstants=a,this.service=s,this.EventBusService=r}return(0,a.default)(t,[{key:"$onInit",value:function(){this.service.activate(),this.service.initialState?this.service.setState(this.service.initialState):this._setInitialState()}},{key:"_setInitialState",value:function(){this.service.setState(this.service.STATES.SELECT_PAYEE)}},{key:"$onDestroy",value:function(){this.service.reset(),this.service.deactivate()}},{key:"warnOnExit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.service.currentState===this.service.STATES.DONE||this.service.currentState===this.service.STATES.RECOMMEND_END||this.service.currentState===this.service.STATES.SET_UP_PAYMENT_DONE||this.service.skipWarningDialog?this.onModalClose(t):this.service.isDirty?this.service.showConfirmExitUI=!0:this.onModalClose(t)}},{key:"onModalClose",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.service.isEditingPayment)switch(t){case this.AddBillerDialogConstants.ACTIONS.DONE:this.EventBusService.publish(this.billPayConstants.EVENTS.EDIT_PAYMENT_DONE);break;case this.AddBillerDialogConstants.ACTIONS.BACK:break;default:this.EventBusService.publish(this.billPayConstants.EVENTS.EDIT_PAYMENT_EXIT)}this.service.reset(),this.onClose()}}]),t}();r.$inject=["$log","billPayConstants","AddBillerDialogConstants","AddBillerDialogService","EventBusService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5131)),a=s(n(5132));function s(t){return t&&t.__esModule?t:{default:t}}n(5133);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div ng-if="!$ctrl.service.loading"> <div class="fb2"> <div class="c-tile__header--flex header"> <b>{{ ::\'billPay.billPayV2.searchPayeeHeader\' | translate }}</b> </div> <div class="field"> <i class="field__icon icon-search search-icon"></i> <form novalidate name="form" ng-submit="$ctrl.payeeSearchFormSubmit()"> <input ng-model-options="{ debounce: 300 }" ng-model="$ctrl.searchTerm" type="text" maxlength="50" actionable-id="search_addBillModal" class="input" ng-class="{\'warning\': $ctrl.hasError()}" placeholder="{{ ::\'billPay.billPayV2.searchPayeePlaceholder\' | translate }}" autofocus ng-change="$ctrl.search($ctrl.service.selectedProvince.code)"> </form> <div class="field__error" ng-show="$ctrl.hasError()"> {{ $ctrl.errorMessage }} </div> </div> <div class="c-tile c-tile--flat-design ignore-modal-padding"> <tng-tile-item ng-repeat="(key, payee) in $ctrl.searchResults | filter:$ctrl.searchTerm | orderBy:\'name\'" ng-click="$ctrl.setPayee(key, payee)" class="c-tile--md" ng-class="{\'c-tile--selected\': key === $ctrl.selectedKey}"> <div class="tile-section"> <h1>{{ ::payee.displayName }}</h1> </div> </tng-tile-item> </div> <div class="recommended" ng-show="$ctrl.searchTerm.length >= 2"> <span ng-if="$ctrl.searchResults.length === 0" class="table__quiet" ng-bind-html="\'billPay.addBill.recommendRow\' | translate:{ name: $ctrl.searchTerm }"> </span> <button actionable-id="payee-search-recommend" class="btn--edit btn--large" ng-click="$ctrl.recommend($ctrl.searchTerm)"> {{ ::\'billPay.addBill.recommend\' | translate }} </button> </div> </div> <div ng-show="$ctrl.loadingList"> <tng-loading-in-progress></tng-loading-in-progress> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(68)),a=c(n(8)),s=c(n(0)),r=c(n(2)),o=c(n(532));function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n,i,a,r,o,c,l,u,d){(0,s.default)(this,t),this.$log=e,this.$q=o,this.$scope=n,this.$translate=c,this.billPayService=i,this.selectedKey=null,this.loadingList=!1,this.referenceDataService=a,this.referenceDataConstants=r,this.EventBusService=l,this.service=u,this.$filter=d,this.service.searchParams={"start-item":0,count:20,"match-start-of-word-only":!0}}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;return this.service.title="billPay.billPayV2.addNewPayeeTitle",this.heading="billPay.states.selectBiller",this.service.selectedPayee=void 0,this.service.skipWarningDialog=!0,this.service.buttons=[{label:"global.components.buttons.cancel",action:this.cancel.bind(this),class:"btn btn--edit",name:"selectPayee_cancel"},{label:"global.components.buttons.next",action:this.next.bind(this),class:"btn btn--tangerine",isDisabled:function(){return!t.nextEnabled()},name:"selectPayee_next"}],this.service.errors=[],this.errorMessage="",this.loadingList=!0,this.provinces=[],this.service.selectedProvince=null,this.EventBusService.subscribe(this.$scope,"INFINITE_SCROLL_EVENT",(0,o.default)(this.loadMorePayees.bind(this),2500)),this._getProvinces().catch((function(e){t.$log.error(e)})).finally((function(){t.loadingList=!1}))}},{key:"updateProvince",value:function(){this.$log.debug("Selected province: ",this.service.selectedProvince);var t=this.service.selectedProvince&&"code"in this.service.selectedProvince?this.service.selectedProvince.code:null;return this.search(t)}},{key:"_getProvinces",value:function(){var t=this,e=this.referenceDataService,n=this.referenceDataConstants;return e.getDataByType(n.TYPES.PROVINCES).then((function(e){return t.provinces=[{name:t.$translate.instant("billPay.addBill.allProvinces"),code:""}].concat(e[n.TYPES.PROVINCES]),t.service.selectedProvince=t.provinces[0],t.provinces}))}},{key:"search",value:function(t){return this.service.searchParams=(0,a.default)({},this.service.searchParams,{name:this.searchTerm,"start-item":0}),this.service.recommendPayee=this.searchTerm,t?this.service.searchParams.province=t:delete this.service.searchParams.province,this.searchTerm&&this.searchTerm.length<2?(this.errorMessage=this.$translate.instant("global.errorCodes.BP_SEARCHPAYEE_NAME_TOO_SHORT"),!1):this.searchTerm&&this.searchTerm.trim()?(this.selectedKey=null,this.service.selectedPayee=null,this.getPayeesList()):(this.searchResults=[],!1)}},{key:"getPayeesList",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.payeesLoading=!0,this.billPayService.getPayees(this.service.searchParams).then((function(e){return e&&e.registered_payees&&e.registered_payees.length&&(e.registered_payees=e.registered_payees.map((function(e){return e.displayName=t.$filter("camelCaseType")(e.name),e}))),e})).then((function(n){return t.searchResults=e?[].concat((0,i.default)(t.searchResults),(0,i.default)(n.registered_payees)):n.registered_payees,t.service.searchParams["start-item"]=t.searchResults.length,"registered_payees"in n&&0===n.registered_payees.length&&0===t.searchResults.length?t.errorMessage=t.$translate.instant("global.errorCodes.BP_EMPTY_PAYEE_LIST"):(t.errorMessage="",t.$log.log("Registered Payees:",t.searchResults)),n})).catch((function(){t.errorMessage=t.$translate.instant("global.errorCodes.BP_EMPTY_PAYEE_LIST")})).finally((function(){t.payeesLoading=!1}))}},{key:"hasError",value:function(){return!!(this.errorMessage&&this.errorMessage.length>1)}},{key:"loadMorePayees",value:function(t,e){return"add-bill-modal-event"!==e.id||this.payeesLoading?this.$q.resolve(!1):(this.service.searchParams=(0,a.default)({},this.service.searchParams,{"start-item":this.service.searchParams["start-item"],"match-start-of-word-only":this.service.searchParams["match-start-of-word-only"]}),this.getPayeesList(!0))}},{key:"setPayee",value:function(t,e){this.selectedKey=t,this.service.selectedPayee=e,this.service.skipWarningDialog=!1}},{key:"recommend",value:function(){this.service.setState(this.service.STATES.RECOMMEND_START)}},{key:"resetSearch",value:function(){this.searchTerm=""}},{key:"payeeSearchFormSubmit",value:function(){this.generalFormSubmit()}},{key:"generalFormSubmit",value:function(){this.hideMobileKeyboard()}},{key:"hideMobileKeyboard",value:function(){this.removePageFocus()}},{key:"removePageFocus",value:function(){document.activeElement.blur()}},{key:"next",value:function(){this.service.setState(this.service.STATES.ADD_INFO),this.service.skipWarningDialog=!1}},{key:"nextEnabled",value:function(){return!!this.searchResults&&this.searchResults.length>0&&!!this.service.selectedPayee}},{key:"cancel",value:function(){this.onClose()}}]),t}();l.$inject=["$log","$scope","BillPayService","ReferenceDataService","referenceDataConstants","$q","$translate","EventBusService","AddBillerDialogService","$filter"],e.default=l,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5135)),a=s(n(5136));function s(t){return t&&t.__esModule?t:{default:t}}n(5137);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div ng-if="!$ctrl.service.loading"> <div class="c-bill-pay__error" ng-if="$ctrl.service.duplicatePayee"> <tng-warning-message> {{::\'global.errorCodes.WARNING_DUPTRAN\' | translate }} </tng-warning-message> </div> <form name="$ctrl.accountForm" ng-submit="$ctrl.next()"> <h1 ng-bind-html="::$ctrl.accountHeading | translate"></h1> <div class="payee-details-input-container"> <span class="payee-details-input-prefix family-fancy" ng-class="{ \'sizeChanged\' : $ctrl.sizeChanged }"> # </span> <input class="input payee-details-input family-fancy" ng-model-options="{ debounce: 500 }" type="text" ng-pattern="/^[a-zA-Z0-9]*$/" actionable-id="addBill_accountNumber" placeholder="00000000000" maxlength="30" ng-class="{ \'sizeChanged\' : $ctrl.sizeChanged }" ng-model="$ctrl.service.selectedPayee.accountNumber" ng-change="$ctrl.accountNumChanged($ctrl.service.selectedPayee.accountNumber)" autofocus> </div> <hr class="payee-input-underline"> <div ng-messages="$ctrl.accountForm.addBill_accountNumber.$error" ng-show="$ctrl.accountForm.addBill_accountNumber.$dirty && $ctrl.accountForm.addBill_accountNumber.$invalid" class="field__error"> <p ng-message="pattern"> {{ ::\'billPay.addBill.validationErrorAccountNumber\' | translate}} </p> </div> <span class="payee-details-hint" ng-if="$ctrl.service.selectedPayee.hint"> {{ ::$ctrl.service.selectedPayee.hint }} </span> <h1 class="margin-top" ng-bind-html="::$ctrl.nickNameHeading | translate : $ctrl.nickNameHeadingParams"></h1> <div class="payee-details-input-container"> <input type="text" class="input payee-details-input family-fancy" placeholder="{{ ::\'billPay.addBill.nickNamePlaceholder\' | translate }}" maxlength="{{ $ctrl.NICK_NAME_MAX_LENGTH }}" ng-model-options="{ debounce: 500 }" ng-pattern="$ctrl.lettersNumbersSpacesPattern" actionable-id="addBill_accountNickname" ng-model="$ctrl.service.selectedPayee.nickname" ng-change="$ctrl.nickNameChanged($ctrl.service.selectedPayee.nickname)"/> <hr class="payee-input-underline"> <div ng-messages="$ctrl.accountForm.addBill_accountNickname.$error" ng-show="$ctrl.accountForm.addBill_accountNickname.$dirty && $ctrl.accountForm.addBill_accountNickname.$invalid" class="field__error"> <p ng-message="pattern"> {{ ::\'billPay.addBill.validationErrorNickname\' | translate }} </p> <p ng-message="isNickNameInvalidChars"> {{ ::\'billPay.addBill.validationErrorNickname\' | translate }} </p> <p ng-message="isNickName2Long"> {{ ::\'billPay.addBill.validationErrorLongNickname\' | translate }} </p> </div> </div> </form> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(0)),a=o(n(2)),s=o(n(116)),r=n(67);function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.$q=n,this.selectedKey=null,this.loadingList=!1,this.service=a,this.EventBusService=s,this.accountConstants=r,this.billPayConstants=o,this.NICK_NAME_MAX_LENGTH=r.NICKNAME_MAX_LEN,this.LARGE_FONT_MAX_LENGTH=18}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.service.title="billPay.addBill.addInformation",this.service.titleParams={biller:this.service.selectedPayee.displayName},this.accountHeading="billPay.addBill.whatAccountNumber",this.nickNameHeading="billPay.addBill.wouldYouLikeNickname",this.nickNameHeadingParams={biller:this.service.selectedPayee.displayName},this.service.buttons=[{label:"global.components.buttons.back",action:this.back.bind(this),class:"btn btn--edit",name:"addInfo_back"},{label:"global.components.buttons.add",action:this.next.bind(this),class:"btn btn--tangerine",isDisabled:function(){return!t.nextEnabled()},name:"addInfo_next"}]}},{key:"accountNumChanged",value:function(t){t&&t.length>=this.LARGE_FONT_MAX_LENGTH?this.sizeChanged=!0:this.sizeChanged=!1}},{key:"nickNameChanged",value:function(t){var e="";t?(this.accountForm.addBill_accountNickname.$setValidity("isNickName2Long",t.length<=this.NICK_NAME_MAX_LENGTH),e=t.replace(r.lettersNumbersSpacesReplacePattern,""),this.accountForm.addBill_accountNickname.$setValidity("isNickNameInvalidChars",e.length===t.length)):(this.accountForm.addBill_accountNickname.$setPristine(),this.accountForm.addBill_accountNickname.$invalid=!1)}},{key:"next",value:function(){var t=this;return this.service.loading=!0,this.service.errors=[],this.service.duplicatePayee=!1,this.service.createPayee(!1).then((function(e){if((0,s.default)(e,"response_status.status_code")===t.service.BP_DUPLICATE_PAYEE_INSTANCE)t.service.duplicatePayee=!0;else{t.service.setState(t.service.STATES.DONE);var n=e.payeeId;t.EventBusService.publish(t.billPayConstants.EVENTS.ADD_PAYEE_DONE,{payeeId:n})}})).catch((function(e){return t.service.handleErrors(e)})).finally((function(){t.service.loading=!1}))}},{key:"nextEnabled",value:function(){return!(!this.service.selectedPayee||!this.service.selectedPayee.accountNumber||(0,s.default)(this.accountForm,"addBill_accountNumber.$invalid")||(0,s.default)(this.accountForm,"addBill_accountNickname.$invalid"))}},{key:"back",value:function(){this.service.setState(this.service.STATES.SELECT_PAYEE)}}]),t}();c.$inject=["$log","$q","AddBillerDialogService","EventBusService","accountConstants","billPayConstants"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5139)),a=s(n(5140));function s(t){return t&&t.__esModule?t:{default:t}}n(5141);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="done-container" ng-if="!$ctrl.service.loading"> <div class="from-account-container panel"> <div> <div class="c-account-tile__description"> {{ ::\'billPay.billPayV2.addBillerDonePage.payee\' | translate }} </div> <h3 class="bold-account"> {{ ::$ctrl.service.selectedPayee.displayName }} </h3> </div> <div class="top-margin-small"> <div class="c-account-tile__description"> {{ ::\'billPay.billPayV2.addBillerDonePage.accountNumber\' | translate }} </div> <h3 class="bold-account"> {{ ::$ctrl.service.selectedPayee.accountNumber }} </h3> </div> <div class="top-margin-small" ng-if="$ctrl.service.selectedPayee.nickname"> <div class="c-account-tile__description"> {{ ::\'billPay.billPayV2.addBillerDonePage.nickname\' | translate }} </div> <h3 class="bold-account"> {{ ::$ctrl.service.selectedPayee.nickname }} </h3> </div> </div> <div class="action-container"> <div class="dialog__title family-fancy" ng-bind-html="::\'billPay.billPayV2.addBillerDonePage.nextSteps\' | translate:{ name: $ctrl.selected.payee.name }"> </div> <tng-tile-list tile-data="$ctrl.setupPaymentTiles" tile-type="this.tileListConstants.TILE_TYPE.text" is-actionable="true" on-tile-click="$ctrl.handleNextSteps(tileData)"> </tng-tile-list> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.$q=n,this.$state=a,this.service=s,this.billPayConstants=r,this.NEXT_STEPS_TILES=this.billPayConstants.NEXT_STEPS_TILES,this.stateConstants=o}return(0,a.default)(t,[{key:"$onInit",value:function(){this.service.title="billPay.billPayV2.addBillerDonePage.title",this.setupPaymentTiles=[this.NEXT_STEPS_TILES.SETUP_PAYMENT,this.NEXT_STEPS_TILES.ADD_ANOTHER_PAYEE],this.service.buttons=[{label:"global.components.buttons.done",action:this.handleDone.bind(this),class:"btn btn--tangerine",name:"addPayee_done_done"}]}},{key:"handleNextSteps",value:function(t){switch(t.header){case this.NEXT_STEPS_TILES.SETUP_PAYMENT.header:this.handleSetUpPaymentOption();break;case this.NEXT_STEPS_TILES.ADD_ANOTHER_PAYEE.header:this.handleAddOtherPayee();break;default:this.$log.error("Invalid action ",t.header)}}},{key:"handleSetUpPaymentOption",value:function(){this.service.setState(this.service.STATES.SET_UP_PAYMENT)}},{key:"handleAddOtherPayee",value:function(){this.service.setState(this.service.STATES.SELECT_PAYEE)}},{key:"handleDone",value:function(){this.onClose()}}]),t}();r.$inject=["$log","$q","$state","AddBillerDialogService","billPayConstants","stateConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5143)),a=s(n(5144));function s(t){return t&&t.__esModule?t:{default:t}}n(5145);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div> <label for="recommend_addBill" class="margin__tb--fix2"> {{ ::$ctrl.heading | translate }} </label> <p class="heading--sub3 margin__tb--fix2">{{ ::\'billPay.addBill.payeeName\' | translate }}</p> <input id="recommend_addBill" class="input" type="text" ng-change="$ctrl.recommendPayeeOnChange()" ng-model="$ctrl.service.recommendPayee"> <div ng-show="!$ctrl.submitEnabled" class="field__error"> <p> {{ ::\'global.validation.required\' | translate}} </p> </div> </div>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.service=e}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.service.title="billPay.states.recommendStart",this.heading="billPay.addBill.recommendTellUs",this.service.buttons=[{label:"global.components.buttons.back",action:this.back.bind(this),class:"btn btn--edit",name:"recommendStart_back"},{label:"global.components.buttons.submit",action:this.submit.bind(this),class:"btn btn--tangerine",isDisabled:function(){return!t.submitEnabled},name:"recommendStart_submit"}],this.submitEnabled=Boolean(this.service.recommendPayee)}},{key:"back",value:function(){this.service.setState(this.service.STATES.SELECT_PAYEE)}},{key:"submit",value:function(){this.service.setState(this.service.STATES.RECOMMEND_END)}},{key:"recommendPayeeOnChange",value:function(){this.submitEnabled=Boolean(this.service.recommendPayee)}}]),t}();r.$inject=["AddBillerDialogService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5147)),a=s(n(5148));function s(t){return t&&t.__esModule?t:{default:t}}n(5149);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports=' <div ng-if="$ctrl.service.currentState === $ctrl.service.STATES.RECOMMEND_END"> <span class="margin__tb--fix2"> {{ ::\'billPay.addBill.weWillInvestigate\' | translate }} </span> <div class="panel m-bill-pay__panel margin__t--fix2"> <div class="m-bill-pay__tile-description">{{ ::\'billPay.addBill.payeeName\' | translate}}</div> <span class="m-bill-pay__tile-orange heading--sub2">{{ $ctrl.service.recommendPayee }}</span> </div> </div>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.service=e,this.BillPayService=n}return(0,a.default)(t,[{key:"$onInit",value:function(){this.service.title="billPay.states.recommendEnd",this.heading="billPay.addBill.weWillInvestigate",this.service.buttons=[{label:"global.components.buttons.back",action:this.back.bind(this),class:"btn btn--edit",name:"recommendEnd_back"},{label:"global.components.buttons.done",action:this.done.bind(this),class:"btn btn--tangerine",name:"recommendEnd_done"}]}},{key:"back",value:function(){this.service.setState(this.service.STATES.RECOMMEND_START)}},{key:"done",value:function(){var t=this;return this.BillPayService.recommend(this.service.recommendPayee).then((function(){return t.onClose()}))}}]),t}();r.$inject=["AddBillerDialogService","BillPayService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5151)),a=s(n(5152));function s(t){return t&&t.__esModule?t:{default:t}}n(5153);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div ng-if="!$ctrl.service.loading"> <div class="setup-payment-heading"> {{ ::$ctrl.heading | translate }} </div> <div class="setup-payment-field"> <tng-amount-input input-max-length="9" autofocus="true" ng-model="$ctrl.service.payeeForPayment.amount" on-amount-change="$ctrl.onAmountChange(amount)" has-error="$ctrl.service.payeeForPayment.hasError"> </tng-amount-input> <ul ng-if="$ctrl.service.payeeForPayment.hasError"> <li id="error-message-{{$index}}" ng-bind-html="err.message" ng-repeat="err in $ctrl.service.payeeForPayment.errors track by $index" class="error-message"></li> </ul> </div> <p class="heading--sub3 setup-payment-field-heading">{{ ::\'billPay.accountTile.payFrom\' | translate }}</p> <div class="field account-select-container setup-payment-field" id="billPay-selectBiller-selector-from-account"> <tng-select-autocomplete class="margin__b--fix2 account-select" input-id="set-up-payment_select_accounts" ng-if="$ctrl.payBillsService.fromAccountOptions" ng-model="$ctrl.service.selectedAccount.number" on-select="$ctrl.onAccountChange(option)" options="$ctrl.payBillsService.fromAccountOptions" option-label-key="title" option-right-label-key="balance" option-value-key="number" alternate-light="true" select-type="$ctrl.selectAutoCompleteConstants.SELECT_TYPES.STATIC" enable-for-mobile="true" ng-readonly="$ctrl.service.isEditingPayment" placeholder="{{ ::\'billPay.billPayV2.setUpPaymentPage.fromAccountPlaceholder\' | translate }}"> </tng-select-autocomplete> <div class="clear"></div> </div> <p class="heading--sub3 setup-payment-field-heading">{{ ::\'billPay.toPayee\' | translate }}</p> <div class="setup-payment-field"> <div class="payee-tile"> <span class="payee-name">{{ ::($ctrl.service.payeeForPayment.nickname || $ctrl.service.payeeForPayment.name) }}</span> <span>{{ ::$ctrl.service.payeeForPayment.account_number | maskNumber }}</span> </div> <div class="clear"></div> </div> <p class="heading--sub3 setup-payment-field-heading">{{ ::\'billPay.addBill.frequency\' | translate }}</p> <div class="field account-select-container setup-payment-field" id="billPay-selectBiller-selector-frequency"> <tng-select-autocomplete class="margin__b--fix2 account-select" input-id="set-up-payment_frequency" ng-model="$ctrl.service.payeeForPayment.frequency" on-select="$ctrl.onFrequencyChange(oldValue, value)" options="$ctrl.availableFrequencies" option-label-key="name" option-value-key="value" alternate-light="true" select-type="$ctrl.selectAutoCompleteConstants.SELECT_TYPES.STATIC" enable-for-mobile="true" ng-readonly="$ctrl.isEditingOneTimePayment" placeholder="{{ ::\'billPay.billPayV2.setUpPaymentPage.frequencyPlaceholder\' | translate }}"> </tng-select-autocomplete> <div class="clear"></div> </div> <p ng-if="$ctrl.service.payeeForPayment.frequency" class="heading--sub3 setup-payment-field-heading">{{ $ctrl.getDateSelectorHeader() | translate }}</p> <div ng-if="$ctrl.service.payeeForPayment.frequency" style="position:relative" class="setup-payment-field"> <tng-date-selector class="tng-set-up-payment__selected-date--date-selector" tng-click="$ctrl.onSelectDateClick()" min-date="$ctrl.defaultDate" max-date="$ctrl.datePickerMaxDate" move-focus-to-date-on-calendar-shown="$ctrl.service.payeeForPayment.selectedDate" selection-mode="$ctrl.DATE_SELECTOR_MODES.SINGLE" selected-date="$ctrl.service.payeeForPayment.selectedDate" on-date-change="$ctrl.onStartDateChange(selectedDate)" hide-frequency-selector="true" hide-selection-mode-selector="true" hide-start-date-incrementer="true" single-month-view-enabled="true" show-input-display="true" component-name="set-up-payment-date-selector" force-user-selection="true" hide-calendar-on-date-change="true" toggle-calendar-from-input-display="true" set-white-background-on-calendar="true" display-on-external-update="true" reflect-date-input="true" close-calendar-on-click-outside="true" date-display-format="DD MMM YYYY" ignore-outside-click-for-input-id="{{\'set-up-payment-date-selector\'}}" frequency="$ctrl.dateFrequency" , date-input-placeholder="{{ ::\'billPay.billPayV2.setUpPaymentPage.startDatePlaceholder\' | translate }}"> </tng-date-selector> </div> <tng-checkbox-input ng-if="!$ctrl.getHideCheckbox() && $ctrl.service.payeeForPayment.frequency" label="{{ ::\'billPay.addBill.continueIndefinitely\' | translate }}" tng-model="$ctrl.service.payeeForPayment.isIndefinitely" input-id="set-up-payment-recurring" tng-change="$ctrl.onCheckboxChange()"> </tng-checkbox-input> <div ng-if="!$ctrl.hideEndDateCal &&\n    $ctrl.service.payeeForPayment.frequency &&\n    !$ctrl.service.payeeForPayment.isIndefinitely &&\n    $ctrl.service.payeeForPayment.frequency !== $ctrl.FREQUENCY.NONE" style="position:relative" class="setup-payment-field"> <tng-date-selector class="tng-set-up-payment__selected-date--date-selector" min-date="$ctrl.minDateForEndDate" max-date="$ctrl.datePickerMaxDate" move-focus-to-date-on-calendar-shown="$ctrl.minDateForEndDate" selection-mode="$ctrl.DATE_SELECTOR_MODES.SINGLE" selected-date="$ctrl.service.payeeForPayment.selectedEndDate" on-date-change="$ctrl.onEndDateChange(selectedDate)" hide-frequency-selector="true" hide-selection-mode-selector="true" hide-start-date-incrementer="true" single-month-view-enabled="true" show-input-display="true" component-name="set-up-payment-date-selector-end" force-user-selection="true" hide-calendar-on-date-change="true" toggle-calendar-from-input-display="true" set-white-background-on-calendar="true" display-on-external-update="true" reflect-date-input="true" close-calendar-on-click-outside="true" date-display-format="DD MMM YYYY" ignore-outside-click-for-input-id="{{\'set-up-payment-date-selector-end\'}}" date-input-placeholder="{{ ::\'billPay.billPayV2.setUpPaymentPage.endDatePlaceholder\' | translate }}"> </tng-date-selector> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(92)),a=o(n(68)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,a,r,o,c,l,u,d){(0,s.default)(this,t),this.service=e,this.payBillsService=n,this.BusinessDaysService=i,this.selectAutoCompleteConstants=a,this.tngTileListConstants=r,this.$timeout=d,this.FREQUENCY=c.FREQUENCY_MODE_CONSTANTS,this.TRANSACTION_FREQUENCY=o.FREQUENCY,this.DATE_SELECTOR_HEADERS=o.DATE_SELECTOR_HEADERS,this.BusinessDaysService=i,this.DATE_SELECTOR_MODES=c.DATE_SELECTOR_MODES,this.AddBillerDialogConstants=l,this.$q=u,this.DATE_SELECTOR_FREQUENCIES=[{value:this.FREQUENCY.NONE,name:"billPay.setUpPaymentFrequency.ONCE"},{value:this.FREQUENCY.WEEKLY,name:"billPay.setUpPaymentFrequency.WEEKLY"},{value:this.FREQUENCY.BIWEEKLY,name:"billPay.setUpPaymentFrequency.BIWEEKLY"},{value:this.FREQUENCY.MONTHLY,name:"billPay.setUpPaymentFrequency.MONTHLY"}]}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;return this.service.clearAllErrors(),this.service.title=this.service.isEditingPayment?"billPay.states.editPaymentV2":"billPay.states.setUpPaymentV2",this.heading=this.service.isEditingPayment?"billPay.addBill.editAmount":"billPay.addBill.letsSetUpAmount",this._setupButtons(),this._preparePayeeForPayment(),this._prepareAvailableFrequencies(),this._prepareCalendar(),this.service.loading=!0,this.$q.resolve(this.payBillsService.fromAccountOptions||this.payBillsService.prepareAccounts()).then((function(){return t._prepareAccountSelection()})).finally((function(){t.service.loading=!1}))}},{key:"_prepareAvailableFrequencies",value:function(){var t=this;this.availableFrequencies=[].concat((0,a.default)(this.DATE_SELECTOR_FREQUENCIES)),this.payBillsService.isTangerineCC(this.service.payeeForPayment)||this.isEditingOneTimePayment?this.availableFrequencies=[this.availableFrequencies.find((function(e){return e.value===t.FREQUENCY.NONE}))]:(this.service.setUpRecurringPayment||this.service.isEditingPayment)&&(this.availableFrequencies=this.availableFrequencies.filter((function(e){return-1!==[t.FREQUENCY.WEEKLY,t.FREQUENCY.BIWEEKLY,t.FREQUENCY.MONTHLY].indexOf(e.value)}))),1===this.availableFrequencies.length&&(this.service.payeeForPayment.frequency=this.availableFrequencies[0].value)}},{key:"_prepareAccountSelection",value:function(){var t=this;this.payBillsService.fromAccounts&&(this.service.isEditingPayment?this.service.selectedAccount=this.payBillsService.fromAccounts.find((function(e){return e.number===t.service.transactionForEditing.from_account.number})):1===this.payBillsService.fromAccounts.length&&(this.service.selectedAccount=(0,i.default)({},this.payBillsService.fromAccounts[0])))}},{key:"_setupButtons",value:function(){var t=this;this.service.buttons=[{label:"global.components.buttons.next",action:this.next.bind(this),class:"btn btn--tangerine",isDisabled:function(){return!t._nextEnabled()},name:"setUpPayment_next"}],this.service.singleBillPay?this.service.buttons.unshift({label:"global.components.buttons.cancel",action:this.onClose.bind(this),class:"btn btn--edit",name:"setUpPayment_cancel"}):this.service.buttons.unshift({label:"global.components.buttons.back",action:this.back.bind(this),class:"btn btn--edit",name:"setUpPayment_back"})}},{key:"_validateBasicFields",value:function(){return!!(this.service.payeeForPayment&&parseFloat(this.service.payeeForPayment.amount)&&this.service.selectedAccount&&this.service.payeeForPayment.frequency)}},{key:"_validateFrequency",value:function(){return!!(this.service.payeeForPayment&&this.service.payeeForPayment.frequency&&this.service.payeeForPayment.selectedDate)&&(this.service.payeeForPayment.frequency===this.FREQUENCY.NONE?!this.service.payeeForPayment.isIndefinitely&&!this.service.payeeForPayment.selectedEndDate:this.service.payeeForPayment.isIndefinitely?!this.service.payeeForPayment.selectedEndDate:!!this.service.payeeForPayment.selectedEndDate)}},{key:"_nextEnabled",value:function(){return this._validateBasicFields()&&this._validateFrequency()}},{key:"_prepareCalendar",value:function(){var t=moment();this.datePickerMaxDate=moment.utc().add(1,"years");var e=moment().add(1,"d");this.defaultDate=this.service.isEditingPayment?e:t}},{key:"_preparePayeeForPayment",value:function(){if(!this.service.payeeForPayment)if(this.service.isEditingPayment)this._populateFromTransactionDetails();else{var t=this.service.selectedPayee;this.service.payeeForPayment={id:t.payee_id||t.id,name:t.name,account_number:t.account_number||t.accountNumber,nickname:t.nickname,selectedEndDate:null,tangerine_credit_card:t.tangerine_credit_card}}}},{key:"_populateFromTransactionDetails",value:function(){var t=this.service.transactionForEditing.to_account,e=t.id,n=t.name,i=t.account_number,a=t.nickname;this.service.payeeForPayment={id:e,name:n,account_number:i,nickname:a},this.TRANSACTION_FREQUENCY.ONCE===this.service.transactionForEditing.frequency?this.service.payeeForPayment.frequency=this.FREQUENCY.NONE:this.service.payeeForPayment.frequency=this.service.transactionForEditing.frequency,this.service.payeeForPayment.amount=this.service.transactionForEditing.amount,this.service.payeeForPayment.selectedDate=moment(this.service.transactionForEditing.nextPaymentDate),this.service.transactionForEditing.expiry_date?(this.service.payeeForPayment.isIndefinitely=!1,this.service.payeeForPayment.selectedEndDate=moment(this.service.transactionForEditing.expiry_date)):this.service.payeeForPayment.isIndefinitely=!(this.service.payeeForPayment.frequency===this.FREQUENCY.NONE)}},{key:"onAmountChange",value:function(t){t!==this.service.payeeForPayment.amount&&(this.service.payeeForPayment.hasError=!1,this.service.isDirty=!0)}},{key:"onFrequencyChange",value:function(t,e){t!==e&&(this.service.isDirty=!0),this.service.payeeForPayment.frequency===this.FREQUENCY.NONE?(this.service.payeeForPayment.isIndefinitely=!1,this.service.payeeForPayment.selectedEndDate=null,this.defaultDate=moment()):this.defaultDate=moment().add(1,"d")}},{key:"onCheckboxChange",value:function(){this.service.payeeForPayment.isIndefinitely&&(this.service.payeeForPayment.selectedEndDate=null),this.service.isDirty=!0}},{key:"onAccountChange",value:function(t){t&&t.index>=0&&(this.service.selectedAccount=(0,i.default)({},this.payBillsService.fromAccounts[t.index]))}},{key:"onStartDateChange",value:function(t){if(t){this.service.payeeForPayment.selectedDate&&t!==this.service.payeeForPayment.selectedDate&&(this.service.isDirty=!0),this.service.payeeForPayment.frequency===this.FREQUENCY.MONTHLY?this.service.payeeForPayment.isScheduledWeekend=!0:this.service.payeeForPayment.isScheduledWeekend=!this.BusinessDaysService.isBusinessDay(t);var e=t.clone().add(1,"d");this.minDateForEndDate!==e&&(this.minDateForEndDate=e),this.service.payeeForPayment.selectedEndDate=this.service.payeeForPayment.selectedEndDate||null}}},{key:"onEndDateChange",value:function(t){t&&this.service.payeeForPayment.selectedEndDate&&t!==this.service.payeeForPayment.selectedEndDate&&(this.service.isDirty=!0)}},{key:"onSelectDateClick",value:function(){var t=this;return this.hideEndDateCal=!0,this.$timeout((function(){t.hideEndDateCal=!1}),0)}},{key:"back",value:function(){this.service.clearAllErrors(),(this.service.setUpRecurringPayment||this.service.isEditingPayment)&&(this.service.skipWarningDialog=!0,this.onClose({action:this.AddBillerDialogConstants.ACTIONS.BACK})),this.service.setState(this.service.STATES.DONE)}},{key:"getDateSelectorHeader",value:function(){return this.service.payeeForPayment.frequency===this.FREQUENCY.NONE||this.service.payeeForPayment.isIndefinitely?this.DATE_SELECTOR_HEADERS.SELECT_DATE:this.DATE_SELECTOR_HEADERS.CHOOSE_START_END_DATE}},{key:"getHideCheckbox",value:function(){return this.service.payeeForPayment.frequency===this.FREQUENCY.NONE}},{key:"next",value:function(){var t=this;return this.service.clearAllErrors(),this.service.loading=!0,this.payBillsService.validateSinglePaymentRequest(this.service.payeeForPayment).then((function(e){return t._determineToValidate(e)})).then((function(){t.service.setState(t.service.STATES.SET_UP_PAYMENT_REVIEW)})).catch((function(e){return t.service.handleErrors(e.message_code)})).finally((function(){t.service.loading=!1}))}},{key:"_determineToValidate",value:function(t){return this.service.isEditingPayment?this.$q.resolve():this.payBillsService.processSinglePayment(t,this.service.selectedAccount,!0)}},{key:"isEditingOneTimePayment",get:function(){return!!this.service.isEditingPayment&&this.service.transactionForEditing.frequency===this.TRANSACTION_FREQUENCY.ONCE}}]),t}();c.$inject=["AddBillerDialogService","PayBillsDialogService","BusinessDaysService","tngSelectAutocompleteConstants","tngTileListConstants","billPayConstants","tngDateSelectorConstants","AddBillerDialogConstants","$q","$timeout"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5155)),a=s(n(5156));function s(t){return t&&t.__esModule?t:{default:t}}n(5157);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="all-done-container" ng-if="!$ctrl.service.loading"> <div class="all-done-page-heading"> <p ng-bind-html="::$ctrl.heading | translate"></p> </div> <div class="from-account panel"> <span> {{ ::\'billPay.currentBalance\' | translate }} </span> <span class="bold-account"> {{ ::$ctrl.accountDisplayName | normalizeType }} {{ ::$ctrl.service.selectedAccount.display_name | maskNumber }} </span> <div class="balance"> {{ ::$ctrl.service.selectedAccount.account_balance | currency }} </div> </div> <div class="payment-groups"> <span>{{::\'billPay.billPayV2.allDonePage.paymentGroupHeader\' | translate}}</span> <b>{{ $ctrl.paymentDate | date: $ctrl.isFrench ? \'dd MMMM yyyy\' : \'MMMM dd, yyyy\' }}.</b><br> <tng-tile-list pay-bill-v2="true" tile-data="$ctrl.confirmationTiles" tile-type="$ctrl.tileListConstants.TILE_TYPE.confirmPaymentPayBill"> </tng-tile-list> </div> <tng-print-button button-class="btn btn-grey" only-element="\'printMe\'">{{ ::\'global.print\' | translate}}</tng-print-button> </div> <div id="printMe"> <div class="all-done-details-print"> <div class="print-content" style="margin:70px;width:90%"> <header> {{ ::$ctrl.service.title | translate }} </header> <br/> <p ng-bind-html="::$ctrl.heading | translate"></p> <table> <tr> <td> <div> <span> {{ ::\'billPay.currentBalance\' | translate }} </span> <span> {{ ::$ctrl.accountDisplayName | normalizeType }} {{ ::$ctrl.service.selectedAccount.display_name | maskNumber }} </span> </div> <div> <b> {{ ::$ctrl.service.selectedAccount.account_balance | currency }} </b> </div> </td> </tr> </table> <div> <br><br> {{::\'billPay.billPayV2.allDonePage.paymentGroupHeader\' | translate}} <b>{{ $ctrl.paymentDate | date: $ctrl.isFrench ? \'dd MMMM yyyy\' : \'MMMM dd, yyyy\' }}.</b> <br><br> <tng-tile-list pay-bill-v2="true" tile-data="$ctrl.confirmationTiles" tile-type="$ctrl.tileListConstants.TILE_TYPE.confirmPaymentPayBill"> </tng-tile-list> <br> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=r(n(116));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.service=e,this.payBillsService=n,this.localeService=a,this.LOCALES=a.localeConstants.LOCALES,this.serviceConstants=s,this.tileListConstants=r,this.AddBillerDialogConstants=o,this.DATE_FORMAT="YYYYMMDD"}return(0,a.default)(t,[{key:"$onInit",value:function(){this.service.title="billPay.billPayV2.allDonePage.title",this.heading="billPay.billPayV2.allDonePage.heading",this.service.loading=!1,this.service.buttons=[{label:"global.components.buttons.done",action:this.done.bind(this),class:"btn btn--tangerine",name:"setupPaymentDone_done"}],this._prepareConfirmationTile(),this.paymentDate=this.stringToJsDate((0,s.default)(this.service,"payeeForPayment.selectedDate"))}},{key:"_prepareConfirmationTile",value:function(){this.confirmationTiles=[{amount:this.service.payeeForPayment.amount,frequency:this.service.payeeForPayment.frequency,name:this.service.payeeForPayment.name,account_number:this.service.payeeForPayment.account_number,nickname:this.service.payeeForPayment.nickname,selectedDate:this.service.payeeForPayment.selectedDate,selectedEndDate:this.service.payeeForPayment.selectedEndDate,confirmation_code:this.service.payeeForPayment.confirmation_code,tileHeader:this.service.payeeForPayment.nickname||this.service.payeeForPayment.name}]}},{key:"stringToJsDate",value:function(t){return moment(t,this.DATE_FORMAT).toDate()}},{key:"done",value:function(){this.onClose({action:this.AddBillerDialogConstants.ACTIONS.DONE})}},{key:"isFrench",get:function(){return this.localeService.locale===this.LOCALES.FR_CA}},{key:"accountDisplayName",get:function(){return this.payBillsService.accountHelpersService.getDisplayNameInstant(this.service.selectedAccount)}}]),t}();o.$inject=["AddBillerDialogService","PayBillsDialogService","LocaleService","serviceConstants","tngTileListConstants","AddBillerDialogConstants"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5159)),a=s(n(5160));function s(t){return t&&t.__esModule?t:{default:t}}n(5161);var r={template:i.default,controller:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-review-payment__tiles" ng-if="!$ctrl.service.loading"> <div class="c-review-payment__disclaimer"> {{ ::\'billPay.states.disclaimer\' | translate }} <span ng-if="$ctrl.displayDynamicDisclaimer"> {{ ::\'billPay.states.dynamicDisclaimer\' | translate }} </span> </div> <tng-tile-list pay-bill-v2="true" tile-data="$ctrl.service.selectedAccount" ng-if="$ctrl.service.selectedAccount" tile-type="$ctrl.TILE_TYPE.account" all-actionable="true" on-tile-click="$ctrl.back();"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.paymentReviewTileData" tile-type="$ctrl.TILE_TYPE.review" all-actionable="true" on-tile-click="$ctrl.back();"> </tng-tile-list> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s){(0,i.default)(this,t),this.service=e,this.payBillsService=n,this.accountsService=a,this.TILE_TYPE=s.TILE_TYPE}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.service.title="billPay.states.setUpPaymentReview",this.service.buttons=[{label:"global.components.buttons.back",action:this.back.bind(this),class:"btn btn--edit",name:"setUpPaymentReview_back"},{label:"global.components.buttons.pay",action:this.pay.bind(this),class:"btn btn--tangerine",isDisabled:function(){return!t.payEnabled()},name:"setUpPaymentReview_pay"}],this.paymentReviewTileData=[this.service.payeeForPayment]}},{key:"payEnabled",value:function(){return!this.payBillsService.disablePayButton}},{key:"back",value:function(){this.service.setState(this.service.STATES.SET_UP_PAYMENT)}},{key:"pay",value:function(){var t=this;return this.service.loading=!0,this.payBillsService.resetErrors(),this._processPaymentRequest().then((function(){return t.accountsService.getAccounts()})).then((function(e){t._processAccountLookupResponse(e),t.service.setState(t.service.STATES.SET_UP_PAYMENT_DONE)})).catch((function(e){t.payBillsService.handleErrors(e.message_code||e).then((function(e){t.service.errors=e}))})).finally((function(){t.service.loading=!1}))}},{key:"_processPaymentRequest",value:function(){return this.service.isEditingPayment?this.payBillsService.updateSinglePayment(this.service.payeeForPayment,this.service.selectedAccount,this.service.transactionForEditing):this.payBillsService.processSinglePayment(this.service.payeeForPayment,this.service.selectedAccount,!1)}},{key:"_processAccountLookupResponse",value:function(t){var e=this,n=t.fromAccounts.find((function(t){return t.number===e.service.selectedAccount.number}));this.service.selectedAccount.account_balance=n.available_balance}},{key:"displayDynamicDisclaimer",get:function(){return this.service.payeeForPayment.isScheduledWeekend}}]),t}();r.$inject=["AddBillerDialogService","PayBillsDialogService","BillPayAccountsService","tngTileListConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5163)),a=s(n(5164));function s(t){return t&&t.__esModule?t:{default:t}}n(5165);var r={template:i.default,controller:a.default,bindings:{biller:"<",index:"<",selectSubject:"<?",hasAmountError:"=?",amountErrors:"<?",onRecurringPaymentLinkClicked:"&?",availFlag:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="tng-biller__billerContainer"> <div actionable-id="payee-name-{{$ctrl.index}}" class="tng-biller__field tng-biller__biller-info" ng-click="$ctrl.onInfoFieldClick($event)"> <div actionable-id="payee-checkbox-{{$ctrl.index}}" class="tng-biller__field tng-biller__checkbox"> <input id="consent__check-{{$ctrl.index}}" class="tng-biller__checkbox--input" name="consent__check-{{$ctrl.index}}" actionable-id="consent__check-{{$ctrl.index}}" ng-true-value="true" ng-false-value="false" ng-model="$ctrl.isCheckBoxChecked" type="checkbox"/> <label for="consent__check-{{$ctrl.index}}" ng-bind-html="::$ctrl.consent | translate: $ctrl.translationParams"> </label> </div> <span class="tng-biller__biller-info--biller-name">{{$ctrl.biller.nickname || $ctrl.biller.name}}</span> <span class="tng-biller__biller-info--account-number">{{$ctrl.biller.account_number | maskNumber}}</span> </div> <div class="tng-biller__field tng-biller__selectedDate"> <tng-date-selector class="tng-biller__selectedDate--dateSelector" min-date="$ctrl.defaultDate" max-date="$ctrl.datePickerMaxDate" move-focus-to-date-on-calendar-shown="$ctrl.defaultDate" selection-mode="\'SINGLE\'" selected-date="$ctrl.selectedDate" on-date-change="$ctrl.onDateChange(selectedDate)" hide-frequency-selector="true" hide-selection-mode-selector="true" hide-start-date-incrementer="true" single-month-view-enabled="true" show-input-display="true" component-name="date-selector-{{$index}}" force-user-selection="true" hide-calendar-on-date-change="true" toggle-calendar-from-input-display="true" set-white-background-on-calendar="true" display-on-external-update="true" reflect-date-input="true" date-input-placeholder="{{ ::\'billPay.billPayV2.dateInputPlaceholder\' | translate}}" close-calendar-on-click-outside="true" date-display-format="DD MMM YYYY" ignore-outside-click-for-input-id="{{\'biller-date-selector-\' + $ctrl.index}}" actionable-id-root="tng-biller-date-selector-{{ $ctrl.index }}" link-text="{{ $ctrl.isRecurringPaymentAvailable ? \'billPay.billPayV2.recurringPaymentLink\' : undefined }}" on-text-link-clicked="$ctrl.onRecurringPaymentLinkClickedFromCalendar()"> </tng-date-selector> </div> <div class="tng-biller__field tng-biller__billAmount"> <tng-amount-input input-type="\'simple-inline\'" input-max-length="12" actionable-id-root="tng-biller-amount-input-{{$ctrl.index}}" disable-autofocus="true" on-amount-change="$ctrl.onAmountChange(amount)" ng-model="$ctrl.biller.amount" set-placeholder="{{ ::\'billPay.billPayV2.amountInputPlaceholder\' | translate}}" show-warning-border="true" show-warning-message="true" has-error="$ctrl.hasAmountError"> </tng-amount-input> </div> </div> <ul ng-if="$ctrl.hasAmountError"> <li id="tng-biller__error-message-{{$index}}" ng-bind-html="err.message" ng-repeat="err in $ctrl.amountErrors track by $index" class="tng-biller__error-message"> </li> <tng-help-bubble ng-show="$ctrl.availFlag"> {{\'billPay.billPayV2.moreThanAvailableToolTip\'| translate}} <a ng-href="./#/holds" id="billerHold" class="tng-biller__help"> {{::\'billPay.billPayV2.learnMore\'| translate}}</a> </tng-help-bubble> </ul> <div class="tng-biller__payment-summary-container" ng-if="$ctrl.recurringChargesEnabled && $ctrl.biller.transactionHistory && $ctrl.biller.transactionHistory.length > 0"> <span class="tng-biller__payment-summary" ng-bind-html="::\'billPay.billPayV2.selectBillerPage.recurringPayment\' | translate: {\n    payeeName: ($ctrl.biller.nickname || $ctrl.biller.name) }"> </span> <tng-help-bubble> <span ng-bind-html="::\'billPay.billPayV2.selectBillerPage.paymentSummary\' | translate: {\n      paymentDateAmount: $ctrl.PayBillsDialogService.getPaymentSummary($ctrl.biller.transactionHistory) }"> </span> </tng-help-bubble> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(92)),a=o(n(0)),s=o(n(2)),r=o(n(45));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,s,o,c){(0,a.default)(this,t),this.$log=e,this.$q=n,this.EnvironmentService=i,this.PayBillsDialogService=s,this.BusinessDaysService=o,this.flowService=c,this.today=(0,r.default)(),this.datePickerMaxDate=r.default.utc().add(1,"years")}return(0,s.default)(t,[{key:"$onInit",value:function(){this.recurringChargesEnabled=this.EnvironmentService.isEnabled("billPayV2RecurringCharges"),this.selectedDate=this.biller.selectedDate||null,this.defaultDate=this.today,this.isCheckBoxChecked=!!this.biller.isSelected,this.isDirty=!1,this.isAmountErrorDisplayed=!1,this.isRecurringPaymentAvailable=!this.PayBillsDialogService.isTangerineCC(this.biller)}},{key:"onInfoFieldClick",value:function(t){t.stopPropagation(),t.preventDefault(),this.isCheckBoxChecked=!this.isCheckBoxChecked,this.onCheckBoxChange(this.isCheckBoxChecked,this.index)}},{key:"onCheckBoxChange",value:function(t,e){this.isDirty=!0,t?(this.selectedDate=this.selectedDate||this.defaultDate,this.biller.selectedDate=this.selectedDate,this.biller.isSelected=!0):(this.biller.selectedDate=null,this.selectedDate=null,this.biller.amount=null,this.hasAmountError=!1,this.biller.isSelected=!1),this.billPaymentWeekendCheck(this.biller.selectedDate),this.selectSubject&&this.selectSubject.next&&this.selectSubject.next({biller:this.biller,checked:t,index:e})}},{key:"onDateChange",value:function(t){t&&(this.billPaymentWeekendCheck(t),this.selectedDate=t,this.biller.selectedDate=this.selectedDate,this.isCheckBoxChecked||(this.isCheckBoxChecked=!0,this.onCheckBoxChange(this.isCheckBoxChecked)))}},{key:"onRecurringPaymentLinkClickedFromCalendar",value:function(){this.onRecurringPaymentLinkClicked({payee:(0,i.default)({},this.biller)})}},{key:"onAmountChange",value:function(t){t&&(this.isAmountErrorDisplayed?(this.hasAmountError=!1,this.isAmountErrorDisplayed=!1):this.hasAmountError&&(this.isAmountErrorDisplayed=!0)),t&&!this.isCheckBoxChecked?(this.isCheckBoxChecked=!0,this.onCheckBoxChange(this.isCheckBoxChecked)):this.isCheckBoxChecked&&this.isDirty&&(this.hasAmountError=!1)}},{key:"goToHoldsPage",value:function(){this.flowService.holdLink=!0}},{key:"billPaymentWeekendCheck",value:function(t){t?(this.dateIsBusinessDay=this.BusinessDaysService.isBusinessDay(t),this.biller.isScheduledWeekend=!this.dateIsBusinessDay):this.biller.isScheduledWeekend=!1}}]),t}();c.$inject=["$log","$q","EnvironmentService","PayBillsDialogService","BusinessDaysService","PayBillsDialogFlowService"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5167)),a=s(n(5168));function s(t){return t&&t.__esModule?t:{default:t}}n(5169);var r={template:i.default,controller:a.default,bindings:{biller:"<",index:"<",selectSubject:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="tng-biller-mobile__billerContainer" ng-click="$ctrl.onRowClick($event);"> <div class="tng-biller-mobile__field tng-biller-mobile__biller-info"> <div actionable-id="payee-mobile-checkbox-{{$ctrl.index}}" class="tng-biller-mobile__field tng-biller-mobile__checkbox"> <input id="consent__check-{{$ctrl.index}}" class="tng-biller-mobile__checkbox--input" name="consent__check-{{$ctrl.index}}" actionable-id="consent__check-{{$ctrl.index}}" ng-true-value="true" ng-false-value="false" ng-model="$ctrl.isCheckBoxChecked" type="checkbox"/> <label for="consent__check-{{$ctrl.index}}" ng-bind-html="::$ctrl.consent | translate: $ctrl.translationParams"> </label> </div> <span class="tng-biller-mobile__biller-info--biller-name">{{$ctrl.biller.nickname || $ctrl.biller.name}}</span> <span class="tng-biller-mobile__biller-info--account-number">{{$ctrl.biller.account_number | maskNumber}}</span> </div> </div> <div class="tng-biller-mobile__payment-summary-container" ng-if="$ctrl.recurringChargesEnabled && $ctrl.biller.transactionHistory && $ctrl.biller.transactionHistory.length > 0"> <span class="tng-biller-mobile__payment-summary" ng-bind-html="\'billPay.billPayV2.selectBillerPage.recurringPayment\' | translate: {\n      payeeName: ($ctrl.biller.nickname || $ctrl.biller.name) }"> </span> <tng-help-bubble> <span ng-bind-html="\'billPay.billPayV2.selectBillerPage.paymentSummary\' | translate: {\n        paymentDateAmount: $ctrl.PayBillsDialogService.getPaymentSummary($ctrl.biller.transactionHistory) }"> </span> </tng-help-bubble> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=r(n(45));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,r,o){(0,i.default)(this,t),this.$log=e,this.$q=n,this.EnvironmentService=a,this.PayBillsDialogService=r,this.BusinessDaysService=o,this.today=(0,s.default)(),this.datePickerMaxDate=s.default.utc().add(1,"years")}return(0,a.default)(t,[{key:"$onInit",value:function(){this.recurringChargesEnabled=this.EnvironmentService.isEnabled("billPayV2RecurringCharges"),this.selectedDate=this.biller.selectedDate||null,this.defaultDate=this.today,this.isCheckBoxChecked=!!this.biller.isSelected,this.isDirty=!1,this.isAmountErrorDisplayed=!1}},{key:"onRowClick",value:function(t){t.stopPropagation(),t.preventDefault(),this.isCheckBoxChecked=!this.isCheckBoxChecked,this.onCheckBoxChange(this.isCheckBoxChecked,this.index)}},{key:"onCheckBoxChange",value:function(t,e){this.isDirty=!0,t?(this.selectedDate=this.selectedDate||this.defaultDate,this.biller.selectedDate=this.selectedDate,this.biller.isSelected=!0):(this.biller.selectedDate=null,this.selectedDate=null,this.biller.amount=null,this.biller.hasError=!1,this.biller.errors=[],this.biller.isSelected=!1),this.billPaymentWeekendCheck(this.biller.selectedDate),this.selectSubject&&this.selectSubject.next&&this.selectSubject.next({biller:this.biller,checked:t,index:e})}},{key:"billPaymentWeekendCheck",value:function(t){t?(this.dateIsBusinessDay=this.BusinessDaysService.isBusinessDay(t),this.biller.isScheduledWeekend=!this.dateIsBusinessDay):this.biller.isScheduledWeekend=!1}}]),t}();o.$inject=["$log","$q","EnvironmentService","PayBillsDialogService","BusinessDaysService"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5171)),a=s(n(5172));function s(t){return t&&t.__esModule?t:{default:t}}n(5173);var r={template:i.default,controller:a.default,bindings:{biller:"<",index:"<",selectSubject:"<?",hasAmountError:"=?",amountErrors:"<?",onRecurringPaymentLinkClicked:"&?",availFlag:"<?",goToHoldsPage:"&?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="tng-biller-details-mobile__biller-container"> <div class="tng-biller-details-mobile__field tng-biller-details-mobile__biller-info"> <span class="tng-biller-details-mobile__biller-info--biller-name">{{$ctrl.biller.nickname || $ctrl.biller.name}}</span> <span class="tng-biller-details-mobile__biller-info--account-number">{{$ctrl.biller.account_number | maskNumber}}</span> </div> <div class="tng-biller-details-mobile__field tng-biller-details-mobile__selected-date"> <tng-date-selector actionable-id-root="tng-biller-date-selector-mobile-{{ $ctrl.index }}" class="tng-biller-details-mobile__selected-date--date-selector" min-date="$ctrl.defaultDate" max-date="$ctrl.datePickerMaxDate" move-focus-to-date-on-calendar-shown="$ctrl.defaultDate" selection-mode="\'SINGLE\'" selected-date="$ctrl.selectedDate" on-date-change="$ctrl.onDateChange(selectedDate)" hide-frequency-selector="true" hide-selection-mode-selector="true" hide-start-date-incrementer="true" single-month-view-enabled="true" show-input-display="true" component-name="date-selector-{{$index}}" force-user-selection="true" hide-calendar-on-date-change="true" toggle-calendar-from-input-display="true" set-white-background-on-calendar="true" display-on-external-update="true" reflect-date-input="true" close-calendar-on-click-outside="true" date-display-format="DD MMM YYYY" ignore-outside-click-for-input-id="{{\'biller-date-selector-\' + $ctrl.index}}" link-text="{{ $ctrl.isRecurringPaymentAvailable ? \'billPay.billPayV2.recurringPaymentLink\' : undefined }}" on-text-link-clicked="$ctrl.onRecurringPaymentLinkClickedFromCalendar()"> </tng-date-selector> </div> <div class="tng-biller-details-mobile__field tng-biller-details-mobile__billAmount"> <div class="tng-biller-details-mobile__billAmount--amount-label">{{ ::\'billPay.billPayV2.amount\' | translate }}</div> <tng-amount-input input-type="\'simple-inline\'" input-max-length="12" actionable-id-root="tng-biller-details-mobile-amount-input-{{$ctrl.index}}" disable-autofocus="true" on-amount-change="$ctrl.onAmountChange(amount)" ng-model="$ctrl.biller.amount" set-placeholder="{{ ::\'billPay.billPayV2.amountInputPlaceholder\' | translate}}" show-warning-border="true" show-warning-message="true" has-error="$ctrl.hasAmountError"> </tng-amount-input> </div> <ul ng-if="$ctrl.hasAmountError"> <li id="tng-biller-details-mobile__error-message-{{$index}}" ng-bind-html="err.message" ng-repeat="err in $ctrl.amountErrors track by $index" class="tng-biller-details-mobile__error-message"></li> <tng-help-bubble ng-show="$ctrl.availFlag" internal-click="$ctrl.goToHoldsPage()"> {{\'billPay.billPayV2.moreThanAvailableToolTip\'| translate}} <a class="tng-biller-details-mobile__help" internal-click> {{::\'billPay.billPayV2.learnMore\'| translate}}</a> </tng-help-bubble> </ul> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(92)),a=o(n(0)),s=o(n(2)),r=o(n(45));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,s){(0,a.default)(this,t),this.$log=e,this.$q=n,this.BusinessDaysService=i,this.PayBillsDialogService=s,this.today=(0,r.default)(),this.datePickerMaxDate=r.default.utc().add(1,"years")}return(0,s.default)(t,[{key:"$onInit",value:function(){this.selectedDate=this.biller.selectedDate||null,this.defaultDate=this.today,this.isDirty=!1,this.isAmountErrorDisplayed=!1,this.isRecurringPaymentAvailable=!this.PayBillsDialogService.isTangerineCC(this.biller)}},{key:"onDateChange",value:function(t){t&&(this.dateIsBusinessDay=this.BusinessDaysService.isBusinessDay(t),this.biller.isScheduledWeekend=!this.dateIsBusinessDay,this.selectedDate=t,this.biller.selectedDate=this.selectedDate)}},{key:"onAmountChange",value:function(t){t&&(this.isAmountErrorDisplayed?(this.hasAmountError=!1,this.isAmountErrorDisplayed=!1):this.hasAmountError&&(this.isAmountErrorDisplayed=!0)),this.isDirty&&(this.hasAmountError=!1)}},{key:"onRecurringPaymentLinkClickedFromCalendar",value:function(){this.onRecurringPaymentLinkClicked({payee:(0,i.default)({},this.biller)})}}]),t}();c.$inject=["$log","$q","BusinessDaysService","PayBillsDialogService"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5175)),a=s(n(5176));function s(t){return t&&t.__esModule?t:{default:t}}n(5177);var r={controller:i.default,template:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(8)),a=o(n(104)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,a,r,o,c,l,u,d,h,f,p,g,m,_,v,S,T,y,E,A){(0,s.default)(this,t),this.$q=d,this.$log=e,this.$timeout=n,this.accountService=i,this.flowService=a,this.stateConstants=r,this.AspAccountsService=h,this.AccountDetailsService=f,this.UserService=p,this.USER_CAPABILITIES=_.CAPABILITIES,this.investmentConstants=g,this.MODAL_TYPES=y.MODAL_TYPES,this.EventBusService=E,this.eventConstants=A,this.accountConstants=o,this.ACCOUNT_TYPES=o.ACCOUNT_TYPES,this.TILE_TYPE=c.TILE_TYPE,this.DATE_SELECTOR_MODES=l.DATE_SELECTOR_MODES,this.SUCCESS_VISIBILITY_TIMEOUT=u.MODAL_VISIBILITY_TIMEOUT,this.STATUS_CODES=S.STATUS_CODES,this.baseUrl=m.getAPIUrl(),this.$state=v,this.cifTypeService=T,this.showMinimum=!1}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;this.flowService.activate(!1,!1,!0),this.userCapabilities=[],this.transactionState=this.stateConstants.TRANSACTIONS,this.cifTypeService.isChild()||this.cifTypeService.isBusiness()?this.chooseActionTiles=[{header:"asp.chooseAction.savings"}]:this.chooseActionTiles=[{header:"asp.chooseAction.savings"},{header:"asp.chooseAction.investment"}],this.flowService.onButtonClickSubmit=function(){t._submitData()},this.flowService.onButtonClickCancel=function(){t._close()},this.flowService.onButtonClickDone=function(){t._close()},this.flowService.onButtonClickRestart=function(){t._getAccounts(),t.flowService.returnToStart()},this._getUserCapabilities()}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"_getUserCapabilities",value:function(){var t=this;return this.flowService.enterLoadingMode(),this.UserService.getCapabilities().then((function(e){t.userCapabilities=e.capabilities})).finally((function(){t._getAccounts()}))}},{key:"_getAccounts",value:function(){var t=this,e=[],n=void 0;this.flowService.enterLoadingMode(),this.savingFromAccounts=[],this.savingToAccounts=[],this.investmentToAccounts=[],this.investmentFromAccounts=[],n=this.AspAccountsService.getSavingAccounts().then((function(e){e.fromAccounts.length&&(t.flowService.hasSavingFlow=!0),t.savingFromAccounts=e.fromAccounts,t.savingToAccounts=e.toAccounts})),e.push(n),-1!==this.userCapabilities.indexOf(this.USER_CAPABILITIES.MUTUALFUND_TRANSACT_BUY)&&-1!==this.userCapabilities.indexOf(this.USER_CAPABILITIES.MUTUALFUND_TRANSACT_SELL)&&(n=this.AspAccountsService.getInvestmentToAccounts().then((function(e){e.length&&(t.flowService.hasInvestingFlow=!0),t.investmentToAccounts=e})),e.push(n)),this.$q.all(e).finally((function(){t.flowService.setInitialState(),t.flowService.exitLoadingMode()}))}},{key:"_requestAccountDetails",value:function(t,e){var n=this;return this.AccountDetailsService.getAccountDetails(t,e).then((function(t){n.flowService.ACCOUNT_DETAILS=t.account_summary})).catch((function(t){n.$log.error(t)}))}},{key:"getFromAccounts",value:function(){return this.flowService.isSavingModalType()?this.savingFromAccounts:this.investmentFromAccounts}},{key:"getToAccounts",value:function(){return this.flowService.isSavingModalType()?this.savingToAccounts:this.investmentToAccounts}},{key:"onAwayNavigation",value:function(){return this._warn()}},{key:"_warn",value:function(){var t=this;return this.flowService.warn().then((function(){t.onClose()})).catch((function(e){return t.$log.error(e),t.$q.reject()}))}},{key:"onModalClose",value:function(){this._close()}},{key:"goToTransactionPage",value:function(){this.onModalClose(),this.$state.go(this.stateConstants.TRANSACTIONS)}},{key:"onFromAccountSelect",value:function(t){var e=(0,a.default)(t,1);this.flowService.transaction.fromAccount=e[0],this.flowService.gotoNextState()}},{key:"onToAccountSelect",value:function(t){var e=this;this.flowService.transaction.toAccount=t[0],this.flowService.isInvestmentModalType()?(this.flowService.enterLoadingMode(),this.investmentFromAccounts=[],this.$q.all([this._requestAccountDetails(t[0].number,t[0].type),this.AspAccountsService.getInvestmentFromAccounts(t[0].number).then((function(t){e.investmentFromAccounts=t,e.flowService.gotoNextState()}))]).finally((function(){e.flowService.exitLoadingMode()}))):this.flowService.gotoNextState()}},{key:"onReviewTileChangeClick",value:function(t,e){this.flowService.resetSubmitErrors(),this.flowService.moveTo(e.step)}},{key:"onReviewAmountTileClick",value:function(){this.flowService.resetSubmitErrors(),this.flowService.gotoPreviousState(),this.flowService.isInvestmentModalType()&&this.flowService.goToOneOfPreviousStates(1)}},{key:"onReviewAccountTileClick",value:function(t){this.flowService.resetSubmitErrors(),0===t?this.flowService.goToOneOfPreviousStates(4):this.flowService.isInvestmentModalType()&&1===t?this.flowService.goToOneOfPreviousStates(5):this.flowService.goToOneOfPreviousStates(3)}},{key:"onReviewDateTileClick",value:function(){this.flowService.resetSubmitErrors(),this.flowService.goToOneOfPreviousStates(2),this.flowService.isInvestmentModalType()&&this.flowService.goToOneOfPreviousStates(1)}},{key:"_buildParams",value:function(t){var e=t.toAccount,n={transfers:{when:t.when,amount:t.amount},validate_only:!1};return this.flowService.isSavingModalType()?(n.is_asp=!0,n.transfers.to_account=e.display_name,n.transfers.currency=t.currency,t.fromAccount.currency_type===t.toAccount.currency_type&&t.toAccount.currency_type!==n.transfers.currency&&(n.transfers.currency=t.toAccount.currency_type)):this.flowService.isInvestmentModalType()&&(0,i.default)(n.transfers,{cash_target_account:t.fromAccount.display_name,leverage_disclosure:t.investment.hasBorrowedMoney,transaction_type:this.investmentConstants.TRANSACTION_TYPE.BUY}),t.toAccount.type===this.ACCOUNT_TYPES.CREDIT_CARD&&(n.transfers.to_account=e.number),n.transfers.scheduled_start_date=t.scheduledStartDate.format("YYYY-MM-DD"),n.transfers.frequency=t.frequency,t.dateSelectorSelectionMode===this.DATE_SELECTOR_MODES.INDEFINITE?t.toAccount.type===this.ACCOUNT_TYPES.CREDIT_CARD&&(n.transfers.payment_indicator=t.payment_indicator):n.transfers.scheduled_end_date=t.scheduledEndDate.format("YYYY-MM-DD"),n}},{key:"_prepareData",value:function(t){return{urlVars:{accountHash:this.flowService.isInvestmentModalType()?this.flowService.transaction.toAccount.number:this.flowService.transaction.fromAccount.number},data:this._buildParams(t)}}},{key:"_submitData",value:function(){var t=this;this.flowService.enterLoadingMode(),this._simpleSubmit().then((function(e){if(e.response_status.status_code===t.STATUS_CODES.VALIDATION_ERROR)return t.$log.error("Transaction failed validation:",e),t.flowService.showSubmitErrors(e),void t.flowService.exitLoadingMode();t.$log.debug("Transaction was accepted:",e),t.EventBusService.publish(t.eventConstants.PROGRESS_TAB_DATA_CHANGE,t.accountConstants.PROGRESS_TABS.ASP),t.flowService.reviewData.confirmationCode=e.confirmation.confirmation_code,t.$timeout((function(){t.flowService.exitLoadingMode(),t.flowService.enableButtons(),t.flowService.gotoNextState()}),t.SUCCESS_VISIBILITY_TIMEOUT),t.flowService.disableButtons()})).catch((function(e){t.$log.error("Transaction was rejected:",e),t.flowService.showSubmitErrors(e),t.flowService.exitLoadingMode()}))}},{key:"_close",value:function(){this.flowService.showConfirmExitUI?this.flowService.denyExit():this._warn()}},{key:"_simpleSubmit",value:function(){var t=this,e=this._prepareData(this.flowService.transaction,this.flowService.modalType);return this.accountService.moveMoney(e,!1,this.flowService.modalType).then((function(e){if(e.response_status.status_code===t.STATUS_CODES.DUPLICATE_TRANSACTION)throw t.$log.error("DataPower service returned DUPLICATE_TRANSACTION, throwing error"),e;return e}))}},{key:"validateAmount",value:function(t){switch(0===Math.abs(t)){case!0:this.isDirty=!0;break;default:this.isDirty=!1}this.flowService.transaction.amount&&!this.flowService.isValidAmount(this.flowService.transaction.amount)?this.showMinimum=!0:this.showMinimum=!1}},{key:"onAmountChanged",value:function(t,e){this.flowService.isValidAmount(this.flowService.transaction.amount)&&(this.showMinimum=!1),this.flowService.onAmountChanged(t,e)}},{key:"nextYear",get:function(){return(new Date).getFullYear()+1}},{key:"isRspAccount",get:function(){return!this.flowService.transaction.toAccount.tax_free&&this.flowService.transaction.toAccount.registered}},{key:"isTfsaAccount",get:function(){return this.flowService.transaction.toAccount.tax_free}},{key:"isTfsaCampaign",get:function(){return this.isTfsaAccount&&-1!==this.userCapabilities.indexOf(this.USER_CAPABILITIES.PRE_TFSA_ENROLL)}}]),t}();c.$inject=["$log","$timeout","AccountService","AspFlowService","stateConstants","accountConstants","tngTileListConstants","tngDateSelectorConstants","pageFlowConstants","$q","AspAccountsService","AccountDetailsService","UserService","investmentConstants","EnvironmentService","menuConstants","$state","aspConstants","CifTypeService","moveMoneyConstants","EventBusService","eventConstants"],e.default=c,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onModalClose(result)" class="c-asp-modal c-move-money" hide-close="$ctrl.flowService.inLoadingMode" flow-service="$ctrl.flowService"> <header> <span ng-show="$ctrl.flowService.showMainUI"> {{ $ctrl.flowService.getPageTitleTransKey() | translate }} </span> </header> <div ng-if="$ctrl.flowService.inLoadingMode" class="c-asp-modal__loading"> <tng-loading-in-progress ng-show="$ctrl.flowService.isLoading" is-loading-key="asp.loading.isLoading"></tng-loading-in-progress> <tng-loading-in-progress ng-show="$ctrl.flowService.isDoneLoading" loading-done-key="asp.loading.isDone"></tng-loading-in-progress> </div> <div ng-if="$ctrl.flowService.showMainUI"> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.CHOOSE_ACTION"> <p class="c-asp-modal__sub-header-confirm"> {{ ::\'asp.chooseAction.subHeader\' | translate }} </p> <tng-tile-list class="c-asp-modal__sub-header" tile-data="$ctrl.chooseActionTiles" tile-type="$ctrl.TILE_TYPE.text" is-actionable="true" on-tile-click="$ctrl.flowService.onChooseActionClick(index, data)"></tng-tile-list> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.FROM"> <tng-tile-list ng-if="$ctrl.flowService.isInvestmentModalType()" class="c-move-money__single-tile margin__b--fix2" tile-data="$ctrl.flowService.reviewData.accounts" all-disabled="true" tile-type="$ctrl.TILE_TYPE.account"> </tng-tile-list> <tng-account-select sub-title-key="asp.from.subHeader" accounts="$ctrl.getFromAccounts()" selected-accounts="[$ctrl.flowService.transaction.fromAccount]" on-select="$ctrl.onFromAccountSelect(account)" hide-footer-copy="$ctrl.flowService.isInvestmentModalType()" on-away="$ctrl.onAwayNavigation()"></tng-account-select> </div> <div class="c-asp-modal__account-to-step" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.TO"> <tng-tile-list ng-if="$ctrl.flowService.isSavingModalType()" sub-title-key="asp.to.transferFrom" class="c-move-money__single-tile margin__b--fix2" tile-data="$ctrl.flowService.reviewData.accounts" all-disabled="true" tile-type="$ctrl.TILE_TYPE.account"> </tng-tile-list> <tng-account-select sub-title-key="asp.to.subHeader" accounts="$ctrl.getToAccounts()" selected-accounts="[$ctrl.flowService.transaction.toAccount]" on-select="$ctrl.onToAccountSelect(account)" hide-footer-copy="$ctrl.flowService.isInvestmentModalType()" on-away="$ctrl.onAwayNavigation()"></tng-account-select> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.WHEN"> <tng-date-selector selected-date="$ctrl.flowService.transaction.scheduledStartDate" min-date="$ctrl.flowService.dateSelectorMinDate" max-date="$ctrl.flowService.dateSelectorMaxDate" start-date="$ctrl.flowService.transaction.scheduledStartDate" end-date="$ctrl.flowService.transaction.scheduledEndDate" hide-selection-mode-selector="false" hide-frequency-selector="false" frequency-exclude="$ctrl.flowService.excludedFrequencies" selection-mode="$ctrl.flowService.transaction.dateSelectorSelectionMode" selection-mode-exclude-single="true" frequency="$ctrl.flowService.transaction.frequency" on-date-change="$ctrl.flowService.onDateChanged(selectedDaysCount)"></tng-date-selector> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.AMOUNT"> <tng-amount-input locale="$ctrl.locale" ng-model="$ctrl.flowService.transaction.amount" reset-on="$ctrl.flowService.transaction" on-amount-change="$ctrl.onAmountChanged(amount, currency)" input-type="$ctrl.flowService.amountInputType" set-value="$ctrl.flowService.transaction.amount" selected-currency="$ctrl.flowService.transaction.currency" base-currency="$ctrl.flowService.transaction.fromAccount[0].currency_type" on-blur="$ctrl.validateAmount(amount)" focus="true"> </tng-amount-input> <div ng-show="$ctrl.showMinimum" class="field__error" ng-bind="$ctrl.flowService.minimumAmountMessage()" translate-cloak> </div> <div ng-if="$ctrl.flowService.isInvestmentModalType() && !$ctrl.flowService.STATES.BORROW_ASP_MONEY" class="confirm-message margin__t--fix margin__b--fix2"> <p> {{ ::\'moveMoney.amountState.borrowedMoney\' | translate }} </p> <button actionable-id="moveMoneyModal_investmentAspBorrowedMoneyYes" class="c-move-money__button-small btn--view" ng-class="{\'is-active\': $ctrl.flowService.transaction.investment.hasBorrowedMoney}" ng-click="$ctrl.flowService.setInvestmentHasBorrowedMoney(true)"> {{ ::\'global.yes\' | translate }} </button> <button actionable-id="moveMoneyModal_investmentAspBorrowedMoneyNo" class="c-move-money__button-small btn--view" ng-class="{\'is-active\': !$ctrl.flowService.transaction.investment.hasBorrowedMoney}" ng-click="$ctrl.flowService.setInvestmentHasBorrowedMoney(false)"> {{ ::\'global.no\' | translate }} </button> <p ng-if="$ctrl.flowService.transaction.investment.hasBorrowedMoney" class="margin__t--fix2"> <tng-accordion rows="[{ header: \'moveMoney.amountState.borrowedMoneyTooltipTitle\', body: \'moveMoney.amountState.borrowedMoneyTooltip\', bodyValues: { apiUrl: $ctrl.baseUrl }}]"></tng-accordion> </p> </div> <tng-tile-list class="c-move-money__single-tile" ng-class="{\'c-asp-modal__single-tile\': $ctrl.flowService.isInvestmentModalType()}" tile-data="$ctrl.flowService.reviewData.accounts" tile-type="$ctrl.TILE_TYPE.account"> </tng-tile-list> <tng-tile-list class="c-move-money__single-tile" ng-class="{\'c-asp-modal__single-tile\': $ctrl.flowService.isInvestmentModalType()}" tile-data="$ctrl.flowService.reviewData.date" tile-type="$ctrl.TILE_TYPE.date"> </tng-tile-list> <p ng-if="$ctrl.flowService.isInvestmentModalType()" class="c-move-money__asp-script confirm-message confirm-message-asp"> <span ng-bind-html=" ::\'moveMoney.amountState.note.investmentsBuy\' | translate: { portfolioUrl: $ctrl.flowService.portfolioUrl } | absoluteHref"></span> </p> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.REVIEW"> <p ng-if="$ctrl.flowService.submitErrors" class="margin__b--fix2"> <tng-error-message> <span ng-bind-html="$ctrl.flowService.submitErrors | translate"></span> </tng-error-message> </p> <p class="c-asp-modal__sub-header" ng-bind-html="$ctrl.flowService.getReviewSubHeaderTransKey() | translate : {reviewData: $ctrl.flowService.reviewData}"></p> <p class="c-asp-modal__sub-header" ng-if="$ctrl.isRspAccount"> {{ \'asp.review.rspMessage\' | translate }} </p> <p class="c-asp-modal__sub-header" ng-if="$ctrl.flowService.transaction.investment.hasBorrowedMoney"> {{ ::\'asp.borrowAspMoney.borrowedMoneyMessage\' | translate }} </p> <tng-tile-list class="c-move-money__single-tile asp-amount" tile-data="$ctrl.flowService.reviewData.amount" is-actionable="true" on-tile-click="$ctrl.onReviewAmountTileClick()" tile-type="$ctrl.TILE_TYPE.amount"></tng-tile-list> <tng-tile-list class="c-move-money__single-tile" tile-data="$ctrl.flowService.reviewData.accounts" is-actionable="true" on-tile-click="$ctrl.onReviewAccountTileClick(index)" tile-type="$ctrl.TILE_TYPE.account"></tng-tile-list> <tng-tile-list class="c-move-money__single-tile" tile-data="$ctrl.flowService.reviewData.date" is-actionable="true" on-tile-click="$ctrl.onReviewDateTileClick()" tile-type="$ctrl.TILE_TYPE.date"></tng-tile-list> <div class="c-asp-modal__footer-space"></div> <p ng-if="$ctrl.flowService.isInvestmentModalType()" class="c-move-money__post-script confirm-message margin__t--fix2"> <span ng-bind-html=" ::\'asp.review.investment.note\' | translate | absoluteHref"></span> <span ng-bind-html=" ::\'asp.confirm.investment.note\' | translate"></span> </p> <div class="c-asp-modal__tfsa__messages c-asp-modal__sub-header" ng-if="$ctrl.isTfsaAccount || $ctrl.isTfsaCampaign"> <p class="c-move-money__post-script" ng-if="$ctrl.isTfsaAccount"> {{ \'asp.review.tfsaMessage\' | translate }} </p> <p ng-if="$ctrl.isTfsaCampaign" translate="asp.review.tfsaMessageCampaign" translate-values="{nextYear: $ctrl.nextYear}"> </p> </div> <div class="c-asp-modal__tfsa__agreements-container"> <section class="c-asp-modal__tfsa__agreements hide-for-print" ng-if="$ctrl.flowService.transaction.toAccount.tax_free"> <div class="container"> <div class="field"> <input id="asp__tfsa__check" class="input" name="asp__tfsa__check" actionable-id="asp__tfsa__check" ng-model="$ctrl.flowService.tfsaCheck" ng-click="$ctrl.flowService.tfsaClick()" type="checkbox"/> <label for="asp__tfsa__check" ng-bind-html="\'moveMoney.reviewState.confirmTFSA\' | translate | absoluteHref"></label> </div> </div> </section> </div> </div> <borrow-asp-money-state ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.BORROW_ASP_MONEY"></borrow-asp-money-state> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.CONFIRM"> <p class="c-asp-modal__sub-header-confirm" ng-bind-html="$ctrl.flowService.getConfirmSubHeaderTransKey() | translate : {reviewData: $ctrl.flowService.reviewData}"></p> <div class="confirm__table"> <div class="confirm__table__row"> <div class="confirm__table__header cell__code"> <span class="confirmed--title"> {{ ::\'moveMoney.confirmedState.confirmationNumber\' | translate }} <span class="body--callout2">{{ ::$ctrl.flowService.reviewData.confirmationCode }}</span> </span> </div> </div> <div ng-if="$ctrl.flowService.isSavingModalType()" class="confirm__table__row"> <div class="confirm__table__cell cell__amount"> <span class="confirmed--title"> <b>{{ ::\'asp.confirm.recurringTransferAmount\' | translate }}</b> </span> <br/> <div class="amount--orange"> {{ ::$ctrl.flowService.reviewData.amount.amount | currency }} </div> </div> <div class="confirm__table__cell cell__new-balance-from"> <span class="confirmed--title"> {{ ::\'asp.confirm.transferFrom\' | translate}} <strong> {{ ::$ctrl.flowService.reviewData.accounts[0].accountName }} {{ ::$ctrl.flowService.reviewData.accounts[0].accountNumber | maskNumber }} </strong> </span> <br/> <div class="amount--orange"> {{ ::$ctrl.flowService.reviewData.accounts[0].amount | currency }} </div> </div> <div class="confirm__table__cell cell__new-balance-to"> <span class="confirmed--title"> {{ ::\'asp.confirm.transferTo\' | translate}} <strong> {{ ::$ctrl.flowService.reviewData.accounts[1].accountName }} {{ ::$ctrl.flowService.reviewData.accounts[1].accountNumber | maskNumber }} </strong> </span> <br/> <div class="amount--orange"> {{ ::$ctrl.flowService.reviewData.accounts[1].amount | currency }} </div> </div> </div> <div ng-if="$ctrl.flowService.isInvestmentModalType()" class="confirm__table__row"> <div class="confirm__table__cell cell__amount"> <span class="confirmed--title"> <b>{{ ::\'asp.confirm.investment.purchaseAmount\' | translate }}</b> </span> <br/> <div class="amount--orange"> {{ ::$ctrl.flowService.reviewData.amount.amount | currency }} </div> </div> <div class="confirm__table__cell cell__new-balance-from"> <span class="confirmed--title"> {{ ::\'asp.confirm.investment.currentBalance\' | translate }} <strong> {{ ::$ctrl.flowService.reviewData.accounts[0].accountName }} {{ ::$ctrl.flowService.reviewData.accounts[0].accountNumber | maskNumber }} </strong> </span> <br/> <span class="amount--orange"> {{ ::$ctrl.flowService.reviewData.accounts[0].amount | currency }} </span> </div> <div class="confirm__table__cell cell__new-balance-to"> <span class="confirmed--title"> {{ ::\'asp.confirm.investment.toPortfolio\' | translate }} </span> <br/> <span class="c-confirmed-state__portfolio-name"> {{ ::$ctrl.flowService.getInvestmentPortfolioName() }} </span> </div> </div> </div> <p class="c-asp-modal__pending-transfers-paragraph" ng-if="!$ctrl.flowService.isInvestmentModalType()"> <span translate="{{ \'asp.confirm.pendingTransfers\' }}" translate-values="{ transactionState: $ctrl.transactionState }"> </span> </p> <tng-print-button button-class="btn btn--orange c-close-account-modal__print" ng-if="!$ctrl.flowService.isInvestmentModalType()"> {{ ::\'global.print\' | translate}} </tng-print-button> </div> </div> <footer> <tng-page-flow-controls flow-service="$ctrl.flowService"></tng-page-flow-controls> </footer> </tng-modal-dialog> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=g(n(8)),a=g(n(92)),s=g(n(68)),r=g(n(33)),o=g(n(177)),c=g(n(0)),l=g(n(2)),u=g(n(264)),d=g(n(266)),h=g(n(265)),f=g(n(267)),p=n(364);function g(t){return t&&t.__esModule?t:{default:t}}var m=function(t){function e(t,n,i,a,l,d,h,f,p,g,m,_,v,S,T,y,E,A,b){(0,c.default)(this,e);var C=(0,u.default)(this,(e.__proto__||(0,o.default)(e)).call(this,t,n,i,a,l,h,f,v));return C.accountHelpersService=g,C.$translate=d,C.$filter=T,C.CURRENCY_TYPES=y.CURRENCY_TYPES,C.WHEN=m.WHEN.ONGOING,C.MODAL_TYPES=_.MODAL_TYPES,C.STATUS_CODES=_.STATUS_CODES,C.DATE_PICKER_FREQUENCY=S.DATE_PICKER_FREQUENCY,C.tngDateSelectorConstants=p,C.DATE_SELECTOR_MODES=p.DATE_SELECTOR_MODES,C.FREQUENCY_MODE_CONSTANTS=p.FREQUENCY_MODE_CONSTANTS,C.InvestmentFundConstants=E,C.EnvironmentService=A,C.LocaleService=b,C.PORTFOLIO_NAMES_ENGLISH=C.InvestmentFundConstants.PORTFOLIO_NAMES_ENGLISH,C.PORTFOLIO_NAMES_FRENCH=C.InvestmentFundConstants.PORTFOLIO_NAMES_FRENCH,C.PORTFOLIO_TYPE_PARAMS=C.InvestmentFundConstants.PORTFOLIO_TYPE_PARAMS,C.STATES={CHOOSE_ACTION:{titleKey:"asp.chooseAction.header"},FROM:{titleKey:"asp.from.header",customTitleKey:(0,r.default)({},C.MODAL_TYPES.INVESTMENT,"asp.from.investment.header")},TO:{titleKey:"asp.to.header",customTitleKey:(0,r.default)({},C.MODAL_TYPES.INVESTMENT,"asp.to.investment.header")},WHEN:{titleKey:"asp.when.header"},AMOUNT:{titleKey:"asp.amount.header",customTitleKey:(0,r.default)({},C.MODAL_TYPES.INVESTMENT,"asp.amount.investment.header")},BORROW_ASP_MONEY:{titleKey:"asp.borrowAspMoney.header",customTitleKey:(0,r.default)({},C.MODAL_TYPES.INVESTMENT,"asp.borrowAspMoney.borrowAspMoneyModalTitle")},REVIEW:{titleKey:"asp.review.header",customTitleKey:(0,r.default)({},C.MODAL_TYPES.INVESTMENT,"asp.review.investment.header")},CONFIRM:{titleKey:"asp.confirm.header"}},C._initialState=C.STATES.CHOOSE_ACTION,C.submitErrors="",C.tfsaCheck=!1,C.dateSelectorMinDate=p.TODAY_IN_EST.clone().add(1,"days"),C.dateSelectorMaxDate=p.TODAY_IN_EST.clone().add(5,"years"),C.defaultExcludedFrequencies=[p.FREQUENCY_MODE_CONSTANTS.NONE,p.FREQUENCY_MODE_CONSTANTS.QUARTERLY,p.FREQUENCY_MODE_CONSTANTS.YEARLY],C.excludedFrequencies=[].concat((0,s.default)(C.defaultExcludedFrequencies)),C}return(0,h.default)(e,t),(0,l.default)(e,[{key:"_resetState",value:function(){(0,d.default)(e.prototype.__proto__||(0,o.default)(e.prototype),"_resetState",this).call(this),this.BUTTONS={BTN_GRY:new p.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new p.ModalFooterButton(this.BUTTON_TYPES.NEXT,!1,!1)},this.transaction={when:this.WHEN,amount:null,fromAccount:null,toAccount:null,numTransactions:0,frequency:this.FREQUENCY_MODE_CONSTANTS.NONE,scheduledStartDate:this.dateSelectorMinDate.clone(),scheduledEndDate:null,dateSelectorSelectionMode:this.DATE_SELECTOR_MODES.INDEFINITE,investment:{hasBorrowedMoney:!1}},this.reviewData={accounts:[],date:null,amount:null},this.hasSavingFlow=!1,this.hasInvestingFlow=!1,this.modalType=this.MODAL_TYPES.DEFAULT,this.resetSubmitErrors(),this.setBuyFundsHasBorrowedMoney(void 0)}},{key:"hasMultipleFlows",value:function(){return this.hasSavingFlow&&this.hasInvestingFlow}},{key:"_startSavingFlow",value:function(){this.modalType=this.MODAL_TYPES.SAVING,this.moveTo(this.STATES.FROM)}},{key:"_startInvestmentFlow",value:function(){this.modalType=this.MODAL_TYPES.INVESTMENT,this.moveTo(this.STATES.TO)}},{key:"isSavingModalType",value:function(){return this.modalType===this.MODAL_TYPES.SAVING}},{key:"isInvestmentModalType",value:function(){return this.modalType===this.MODAL_TYPES.INVESTMENT}},{key:"setInitialState",value:function(){this.hasInvestingFlow&&!this.hasSavingFlow?this._startInvestmentFlow():this.hasSavingFlow&&!this.hasInvestingFlow&&this._startSavingFlow(),this.hideWarning()}},{key:"onChooseActionClick",value:function(t){0===t?this._startSavingFlow():this._startInvestmentFlow()}},{key:"returnToStart",value:function(){this._resetState()}},{key:"_updateUI",value:function(){switch(this.currentState){case this.STATES.CHOOSE_ACTION:this._onChooseActionEnter(),this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.CANCEL,this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_ORG.show=!1;break;case this.STATES.FROM:this._onAccountFromEnter(),this.BUTTONS.BTN_GRY.type=this.hasMultipleFlows()?this.BUTTON_TYPES.BACK:this.BUTTON_TYPES.CANCEL,this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_GRY.disable=!1,this.BUTTONS.BTN_ORG.show=!1;break;case this.STATES.TO:this._onAccountToEnter(),this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_GRY.disable=!1,this.BUTTONS.BTN_ORG.show=!1;break;case this.STATES.WHEN:this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.NEXT,this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_GRY.disable=!1,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!this.hasFrequency,this.modalType===this.MODAL_TYPES.INVESTMENT?this.excludedFrequencies.push(this.FREQUENCY_MODE_CONSTANTS.DAILY):this.excludedFrequencies=[].concat((0,s.default)(this.defaultExcludedFrequencies));break;case this.STATES.AMOUNT:this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.NEXT,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!this.isValidAmount(this.transaction.amount),this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_GRY.disable=!1;break;case this.STATES.BORROW_ASP_MONEY:this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.NEXT,this.BUTTONS.BTN_ORG.disable=!0;break;case this.STATES.REVIEW:this.BUTTONS.BTN_GRY.show=!1,this.BUTTONS.BTN_ORG.disable=!1,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.SUBMIT,this.BUTTONS.BTN_ORG.show=!0;break;case this.STATES.CONFIRM:this.hideWarning(),this.BUTTONS.BTN_GRY.show=!1,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.DONE}}},{key:"onButtonClick",value:function(t){switch(t.type){case this.BUTTON_TYPES.RESTART:this.onButtonClickRestart();break;case this.BUTTON_TYPES.BACK:this.resetSubmitErrors(),(0,d.default)(e.prototype.__proto__||(0,o.default)(e.prototype),"onButtonClick",this).call(this,t);break;default:(0,d.default)(e.prototype.__proto__||(0,o.default)(e.prototype),"onButtonClick",this).call(this,t)}}},{key:"gotoNextState",value:function(){switch(this.currentState){case this.STATES.FROM:this.moveTo(this.isSavingModalType()?this.STATES.TO:this.STATES.WHEN);break;case this.STATES.TO:this.moveTo(this.isSavingModalType()?this.STATES.WHEN:this.STATES.FROM);break;case this.STATES.WHEN:this._onAmountEnter(),this.moveTo(this.STATES.AMOUNT);break;case this.STATES.AMOUNT:this._onReviewEnter(),this.transaction.toAccount.tax_free&&(this.tfsaCheck=!1,this.disableButtons()),this.moveTo(this.isInvestmentModalType()?this.STATES.BORROW_ASP_MONEY:this.STATES.REVIEW);break;case this.STATES.BORROW_ASP_MONEY:this.moveTo(this.STATES.REVIEW);break;case this.STATES.REVIEW:this.moveTo(this.STATES.CONFIRM)}}},{key:"disableButtons",value:function(){this.BUTTONS.BTN_ORG.disable=!0,this.BUTTONS.BTN_GRY.disable=!0}},{key:"enableButtons",value:function(){this.BUTTONS.BTN_ORG.disable=!1,this.BUTTONS.BTN_GRY.disable=!1}},{key:"onDateChanged",value:function(t){this.transaction.numTransactions=t||0,this.BUTTONS.BTN_ORG.disable=!this.hasFrequency}},{key:"tfsaClick",value:function(){this.transaction&&this.transaction.toAccount&&this.transaction.toAccount.tax_free?this.tfsaCheck?this.enableButtons():this.disableButtons():this.enableButtons()}},{key:"goToOneOfPreviousStates",value:function(t){if(t>0){for(var e=0;e<t-1;e++)if(this._stateHistory.length>0)this._stateHistory.pop();else if(this.flowIsRetreating&&"function"==typeof this.flowIsRetreating){this.flowIsRetreating();break}this.gotoPreviousState()}}},{key:"_prepareAccount",value:function(t,e,n){var i=this;return this.accountHelpersService.getDisplayName(t).then((function(a){return{tileDescription:e,accountName:a,accountNumber:t.display_name,amount:t.account_balance,amountText:t.currency_type===i.CURRENCY_TYPES.CAD?void 0:t.currency_type,step:n}}))}},{key:"_onChooseActionEnter",value:function(){this.transaction.fromAccount=null,this.transaction.toAccount=null}},{key:"_onAccountToEnter",value:function(){var t=this;this.isSavingModalType()?this._prepareAccount(this.transaction.fromAccount,"asp.reviewData.transferFrom",this.STATES.FROM).then((function(e){t.reviewData.accounts[0]=e})):this.transaction.fromAccount=null}},{key:"_onAccountFromEnter",value:function(){var t=this;this.isInvestmentModalType()?this._prepareAccount(this.transaction.toAccount,"asp.reviewData.to",this.STATES.TO).then((function(e){t.reviewData.accounts=[],t.reviewData.accounts[0]=e})):this.transaction.toAccount=null}},{key:"_onReviewEnter",value:function(){this.reviewData.amount={header:"Amount",amount:this.transaction.amount,step:this.STATES.AMOUNT},this.reviewData.frequency=this._getFormattedFrequency(),this.reviewData=(0,a.default)({},this.reviewData,this._getFormattedFrequencyEvery()),this.reviewData.howManyTransactions=this.transaction.numTransactions,this.reviewData.totalAmount=this.transaction.amount*this.transaction.numTransactions,this.isInvestmentModalType()&&(this.reviewData.portfolio=this.getInvestmentPortfolioName())}},{key:"_onAmountEnter",value:function(){var t=this;this.reviewData.accounts=[],this._prepareAccount(this.transaction.fromAccount,this.isInvestmentModalType()?"asp.reviewData.from":"asp.reviewData.transferFrom",this.STATES.FROM).then((function(e){t.reviewData.accounts[0]=e})),this._prepareAccount(this.transaction.toAccount,this.isInvestmentModalType()?"asp.reviewData.to":"asp.reviewData.transferTo",this.STATES.TO).then((function(e){t.reviewData.accounts[1]=e,t.isInvestmentModalType()&&((0,i.default)(t.reviewData.accounts[1],{extraTitle:t.$translate.instant("asp.reviewData.portfolio"),extraDescription:t.getInvestmentPortfolioName()}),t.setPortfolioPageUrl(t.reviewData.accounts[1].extraDescription))})),this.reviewData.startDate=this.$filter("date")(this.transaction.scheduledStartDate.utcOffset(this.tngDateSelectorConstants.UTC_OFFSET,!0).toDate(),"longDate"),this.reviewData.endDate=this.$filter("date")(this.transaction.scheduledEndDate.utcOffset(this.tngDateSelectorConstants.UTC_OFFSET,!0).toDate(),"longDate");var e={nickname:null,tileDescription:this.$translate.instant("asp.reviewData.transferFrequency",{frequency:this._getFormattedFrequency()}),accountName:this.$translate.instant("asp.reviewData.starting",{startDate:this.reviewData.startDate}),step:this.STATES.WHEN,bottomText:""};this._isIndefiniteMode()||(e.bottomText=this.$translate.instant("asp.reviewData.ending",{endDate:this.reviewData.endDate})),this.reviewData.date=[e]}},{key:"_getFormattedFrequency",value:function(){return this.$translate.instant("moveMoney.dateTileFrequencies."+this.transaction.frequency)}},{key:"_getFormattedFrequencyEvery",value:function(){switch(this.transaction.frequency){case this.DATE_PICKER_FREQUENCY.weekly.value:return{frequencyEvery:this.$filter("date")(this.transaction.scheduledStartDate.toDate(),"EEEE"),frequencyPrefix:"",frequencySuffix:""};case this.DATE_PICKER_FREQUENCY.biWeekly.value:return{frequencyEvery:this.$filter("date")(this.transaction.scheduledStartDate.toDate(),"EEEE"),frequencyPrefix:this.$translate.instant("asp.confirm.prefixBiWeekly"),frequencySuffix:""};case this.DATE_PICKER_FREQUENCY.monthly.value:return{frequencyEvery:this.transaction.scheduledStartDate.format("Do"),frequencyPrefix:"",frequencySuffix:this.$translate.instant("asp.confirm.suffixMonthly")};default:return{}}}},{key:"onAmountChanged",value:function(t,e){this.currentState===this.STATES.AMOUNT&&(this.transaction.amount=t,this.BUTTONS.BTN_ORG.disable=!this.isValidAmount(t),e&&(this.$log.debug("received",e,"as currency type"),this.transaction.currency=e))}},{key:"showSubmitErrors",value:function(t){var e=this;this.$log.debug("formatting errors");var n="";angular.isDefined(t.response_status)?"details"in t.response_status&&Array.isArray(t.response_status.details)?(t.response_status.details.forEach((function(t,i){if(i>0&&(n+="<br>"),t.details_code)if("INSUFFICIENT_ACCOUNT_BALANCE"===t.details_code)n=e.$translate.instant("global.errorCodes.INSUFFICIENT_ACCOUNT_BALANCE");else{var a=e.$translate.instant("global.errorCodes."+t.details_code);n=""+n+a}else n=""+n+t.technical_description})),this.$log.debug("formatted submission errors:",n),this.submitErrors=n):(t.response_status.status_code===this.STATUS_CODES.ACC_TRANSACTION_MINAMT?this.submitErrors=this.ERROR_MESSAGES.MINAMT:this.submitErrors="global.errorCodes."+t.response_status.status_code,this.$log.debug("showing raw error code:",this.submitErrors)):(this.submitErrors=t.error_message,this.$log.debug("showing raw error code:",this.submitErrors))}},{key:"resetSubmitErrors",value:function(){this.submitErrors=""}},{key:"moveBackTo",value:function(t){(0,d.default)(e.prototype.__proto__||(0,o.default)(e.prototype),"moveBackTo",this).call(this,t),this.resetSubmitErrors()}},{key:"getPageTitleTransKey",value:function(){return this.currentState.customTitleKey&&this.currentState.customTitleKey[this.modalType]?this.currentState.customTitleKey[this.modalType]:this.currentState.titleKey}},{key:"setInvestmentHasBorrowedMoney",value:function(t){this.transaction.investment.hasBorrowedMoney=!!t}},{key:"getInvestmentPortfolioName",value:function(){return this.isInvestmentModalType()?this.ACCOUNT_DETAILS.mutual_fund.holdings[0].portfolio_name:""}},{key:"getReviewSubHeaderTransKey",value:function(){var t="asp.review.";return this.isInvestmentModalType()&&(t+="investment."),t+="subHeader",this._isIndefiniteMode()?t+"Indefinite":t}},{key:"getConfirmSubHeaderTransKey",value:function(){var t="asp.confirm.";return this.isInvestmentModalType()&&(t+="investment."),t+="subHeader",this._isIndefiniteMode()?t+"Indefinite":t}},{key:"_isIndefiniteMode",value:function(){return this.transaction.dateSelectorSelectionMode===this.DATE_SELECTOR_MODES.INDEFINITE}},{key:"_getAnalyticsID",value:function(){return"asp"}},{key:"isValidAmount",value:function(t){return this.accountHelpersService.isAmountValid(t,10)}},{key:"minimumAmountMessage",value:function(){return this.$translate.instant("asp.warning.minimumAmount")}},{key:"setBuyFundsHasBorrowedMoney",value:function(t){this._buyFundsHasBorrowedMoney=t}},{key:"setBorrowedMoneyFrom",value:function(t){this._borrowedMoneyFrom=t}},{key:"setBorrowedMoneyAgreement",value:function(t){this._borrowedMoneyAgreementAccepted=!!t}},{key:"setPortfolioPageUrl",value:function(t){switch(this.marketingUrl=this.EnvironmentService.getBaseUrl(),t){case this.PORTFOLIO_NAMES_ENGLISH.BALANCED_INCOME_PORTFOLIO:case this.PORTFOLIO_NAMES_FRENCH.BALANCED_INCOME_PORTFOLIO:this.portfolioUrl=this.marketingUrl+this.$translate.instant("asp.defaultInvestmentUrl")+this.PORTFOLIO_TYPE_PARAMS.BALANCED_INCOME;break;case this.PORTFOLIO_NAMES_ENGLISH.BALANCED_PORTFOLIO:case this.PORTFOLIO_NAMES_FRENCH.BALANCED_PORTFOLIO:this.portfolioUrl=this.marketingUrl+this.$translate.instant("asp.defaultInvestmentUrl")+this.PORTFOLIO_TYPE_PARAMS.BALANCED;break;case this.PORTFOLIO_NAMES_ENGLISH.BALANCED_GROWTH_PORTFOLIO:case this.PORTFOLIO_NAMES_FRENCH.BALANCED_GROWTH_PORTFOLIO:this.portfolioUrl=this.marketingUrl+this.$translate.instant("asp.defaultInvestmentUrl")+this.PORTFOLIO_TYPE_PARAMS.BALANCED_GROWTH;break;case this.PORTFOLIO_NAMES_ENGLISH.DIVIDEND_PORTFOLIO:case this.PORTFOLIO_NAMES_FRENCH.DIVIDEND_PORTFOLIO:this.portfolioUrl=this.marketingUrl+this.$translate.instant("asp.defaultInvestmentUrl")+this.PORTFOLIO_TYPE_PARAMS.DIVIDEND;break;case this.PORTFOLIO_NAMES_ENGLISH.EQUITY_GROWTH_PORTFOLIO:case this.PORTFOLIO_NAMES_FRENCH.EQUITY_GROWTH_PORTFOLIO:this.portfolioUrl=this.marketingUrl+this.$translate.instant("asp.defaultInvestmentUrl")+this.PORTFOLIO_TYPE_PARAMS.EQUITY_GROWTH;break;default:this.LocaleService.localeDisplay,this.portfolioUrl=this.marketingUrl+this.$translate.instant("asp.defaultInvestmentUrl")}}},{key:"hasFrequency",get:function(){return this.transaction.frequency!==this.FREQUENCY_MODE_CONSTANTS.NONE&&!!this.transaction.frequency}},{key:"buyFundsHasBorrowedMoney",get:function(){return this._buyFundsHasBorrowedMoney}},{key:"borrowedMoneyFrom",get:function(){return this._borrowedMoneyFrom}},{key:"borrowedMoneyAgreement",get:function(){return this._borrowedMoneyAgreementAccepted}}]),e}(f.default);m.$inject=["$log","$q","$transitions","$state","$window","$translate","$rootScope","pageFlowConstants","tngDateSelectorConstants","AccountHelpersService","timeStateConstants","aspConstants","AnalyticsService","tngDatePickerConstants","$filter","accountConstants","InvestmentFundConstants","EnvironmentService","LocaleService"],e.default=m,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$q=e,this.$log=n,this.$httpParamSerializer=a,this.RequesterService=s,this.serviceConstants=r,this.ACTION_CODES=o.ACTION_CODES}return(0,a.default)(t,[{key:"getSavingAccounts",value:function(){var t=this;return this._loadAccountsFromApi(this.ACTION_CODES.ASP_ACCOUNTS).then((function(e){return Array.isArray(e.toAccounts)&&Array.isArray(e.fromAccounts)?e:t.$q.reject(e)}))}},{key:"getInvestmentToAccounts",value:function(){var t=this;return this._loadAccountsFromApi(this.ACTION_CODES.MF_FUND_ACCOUNTS).then((function(e){return Array.isArray(e.mutualFundAccounts)?e.mutualFundAccounts:t.$q.reject(e)}))}},{key:"getInvestmentFromAccounts",value:function(t){var e=this;return this._loadAccountsFromApi(this.ACTION_CODES.MF_FROM_ASP_ACCOUNTS,t).then((function(t){return Array.isArray(t.cashFundAccounts)?t.cashFundAccounts:e.$q.reject(t)}))}},{key:"_loadAccountsFromApi",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i={actionCode:t};null!==n&&(i.accNum=n);var a={mockResponse:t,urlVars:{queryString:this.$httpParamSerializer(i)}},s=[this.serviceConstants.STATUS_CODES.SUCCESS,this.serviceConstants.STATUS_CODES.NO_DATA];return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.MOVE_MONEY,a).then((function(i){return i.response_status&&-1!==s.indexOf(i.response_status.status_code)?(e.$log.debug("Accounts returned by API, actionCode: "+t+", accNum: "+n,i),i):e.$q.reject(i)}))}},{key:"_loadMutualFundsOperationAccounts",value:function(t,e){var n=this;return this._loadAccountsFromApi(t,e).then((function(t){return Array.isArray(t.cashFundAccounts)?t.cashFundAccounts:n.$q.reject(t)}))}}]),t}();r.$inject=["$q","$log","$httpParamSerializer","RequesterService","serviceConstants","moveMoneyConstants"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={MODAL_TYPES:{DEFAULT:"default",SAVING:"saving",INVESTMENT:"investment"},STATUS_CODES:{ACC_TRANSACTION_MINAMT:"ACC_TRANSACTION_MINAMT",DUPLICATE_TRANSACTION:"DUPLICATE_TRANSACTION",VALIDATION_ERROR:"VALIDATION_ERROR"},BORROW_ASP_MONEY:{LINE_OF_CREDIT:"LOC",CREDIT_CARD:"CC",MORTGAGE_TERM_LOAN:"MORTGAGE_TERM",RRSP_LOAN:"RRSP",BORROWED_FROM_FAMILY_FRIENDS:"BORROWED_FROM_FAMILY_FRIENDS"}},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5182)),a=s(n(5183));function s(t){return t&&t.__esModule?t:{default:t}}n(5184);var r={template:i.default,controller:a.default,bindings:{}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div> <button type="button" actionable-id="aspModal_buyFundsBorrowedMoneyNo" class="c-asp-borrowedAspMoney__button-large btn--view" ng-class="{\'is-active\': !$ctrl.flowService.buyFundsHasBorrowedMoney && $ctrl.flowService.buyFundsHasBorrowedMoney !== undefined}" ng-click="$ctrl.setBorrowedMoney(false)"> {{ ::\'asp.borrowAspMoney.borrowedMoneyNo\' | translate }} </button> <button type="button" actionable-id="aspModal_buyFundsBorrowedMoneyYes" class="c-asp-borrowedAspMoney__button-large btn--view" ng-class="{\'is-active\': $ctrl.flowService.buyFundsHasBorrowedMoney}" ng-click="$ctrl.setBorrowedMoney(true)"> {{ ::\'asp.borrowAspMoney.borrowedMoneyYes\' | translate }} </button> <div ng-if="$ctrl.flowService.transaction.investment.hasBorrowedMoney === true" class="margin__t--fix2"> <div class="field c-asp-borrowedAspMoney__tbGap"> <h2 class="heading--sub3 top-margin-medium"> {{ ::\'asp.borrowAspMoney.borrowedAspMoneyLoanType.title\' | translate }} </h2> <input id="{{ ::$ctrl.pageId }}_loc" actionable-id="{{ ::$ctrl.pageId }}_loc" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.burrowAspMoneyConstants.LINE_OF_CREDIT" ng-click="$ctrl.radioSelectionChanged($ctrl.burrowAspMoneyConstants.LINE_OF_CREDIT)"/> <label for="{{ ::$ctrl.pageId }}_loc"> {{ ::\'asp.borrowAspMoney.borrowedAspMoneyLoanType.loc\' | translate }} </label> <input id="{{ ::$ctrl.pageId }}_cc" actionable-id="{{ ::$ctrl.pageId }}_cc" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.burrowAspMoneyConstants.CREDIT_CARD" ng-click="$ctrl.radioSelectionChanged($ctrl.burrowAspMoneyConstants.CREDIT_CARD)"/> <label for="{{ ::$ctrl.pageId }}_cc"> {{ ::\'asp.borrowAspMoney.borrowedAspMoneyLoanType.cc\' | translate }} </label> <input id="{{ ::$ctrl.pageId }}_mortgageLoan" actionable-id="{{ ::$ctrl.pageId }}_mortgageLoan" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.burrowAspMoneyConstants.MORTGAGE_TERM_LOAN" ng-click="$ctrl.radioSelectionChanged($ctrl.burrowAspMoneyConstants.MORTGAGE_TERM_LOAN)"/> <label for="{{ ::$ctrl.pageId }}_mortgageLoan"> {{ ::\'asp.borrowAspMoney.borrowedAspMoneyLoanType.mortgageTermLoan\' | translate }} </label> <input id="{{ ::$ctrl.pageId }}_rrspLoan" actionable-id="{{ ::$ctrl.pageId }}_rrspLoan" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.burrowAspMoneyConstants.RRSP_LOAN" ng-click="$ctrl.radioSelectionChanged($ctrl.burrowAspMoneyConstants.RRSP_LOAN)"/> <label for="{{ ::$ctrl.pageId }}_rrspLoan"> {{ ::\'asp.borrowAspMoney.borrowedAspMoneyLoanType.rrsp\' | translate }} </label> <input id="{{ ::$ctrl.pageId }}_borrowedFromFF" actionable-id="{{ ::$ctrl.pageId }}_borrowedFromFF" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.burrowAspMoneyConstants.BORROWED_FROM_FAMILY_FRIENDS" ng-click="$ctrl.radioSelectionChanged($ctrl.burrowAspMoneyConstants.BORROWED_FROM_FAMILY_FRIENDS)"/> <label for="{{ ::$ctrl.pageId }}_borrowedFromFF"> {{ ::\'asp.borrowAspMoney.borrowedAspMoneyLoanType.borrowedFromFamilyFriend\' | translate }} </label> </div> <div class="field c-asp-borrowedAspMoney__tbGap"> <h2 class="heading--sub3 top-margin-medium"> {{ ::\'asp.borrowAspMoney.borrowedMoneyAgreementTitle\' | translate }} </h2> <input id="{{ ::$ctrl.pageId }}_agreement" actionable-id="{{ ::$ctrl.pageId }}_agreement" name="checkbox" class="input input--tangerine-checkbox" type="checkbox" ng-checked="$ctrl.flowService.borrowedMoneyAgreement" ng-click="$ctrl.isAgreementSelected()" ng-model="$ctrl.agreementSelectionMode" ng-change="$ctrl.flowService.setBorrowedMoneyAgreement($ctrl.agreementSelectionMode)"/> <label for="{{ ::$ctrl.pageId }}_agreement"> {{ ::\'asp.borrowAspMoney.borrowedMoneyAgreement\' | translate }} <a actionable-id="{{ ::$ctrl.pageId }}_agreementPDFLink" ng-href="{{ ::\'asp.borrowAspMoney.borrowedMoneyAgreementPDFhref\' | translate | absoluteHref:\'url\' }}" target="_blank"> {{ ::\'asp.borrowAspMoney.borrowedMoneyAgreementPDFlink\' | translate }} </a> </label> </div> </div> </div>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.$log=e,this.flowService=n,this.burrowAspMoneyConstants=a.BORROW_ASP_MONEY,this.pageId="borrowedAspMoney"}return(0,a.default)(t,[{key:"$onInit",value:function(){this.flowService.buyFundsHasBorrowedMoney?(this.radioSelectionMode=this.flowService.borrowedMoneyFrom,this.agreementSelectionMode=!0,this.flowService.BUTTONS.BTN_ORG.disable=!1):void 0!==this.flowService.buyFundsHasBorrowedMoney?this.flowService.BUTTONS.BTN_ORG.disable=!1:(this.flowService.transaction.investment.hasBorrowedMoney=void 0,this.flowService.setBuyFundsHasBorrowedMoney(void 0))}},{key:"setBorrowedMoney",value:function(t){this.flowService.transaction.investment.hasBorrowedMoney=!!t,this.flowService.BUTTONS.BTN_ORG.disable=!0===t,this.radioSelectionMode=void 0,this.agreementSelectionMode=!1,this.flowService.setBuyFundsHasBorrowedMoney(t),this.flowService.setBorrowedMoneyFrom(void 0),this.flowService.setBorrowedMoneyAgreement(!1),this.isAllBorrowedMoneyFormsSelected&&(this.flowService.BUTTONS.BTN_ORG.disable=!1)}},{key:"radioSelectionChanged",value:function(t){this.flowService.setBorrowedMoneyFrom(t),this.radioSelectionMode=t,this.isAllBorrowedMoneyFormsSelected&&(this.flowService.BUTTONS.BTN_ORG.disable=!1)}},{key:"isAgreementSelected",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=!this.isAllBorrowedMoneyFormsSelected}},{key:"isAllBorrowedMoneyFormsSelected",get:function(){return Boolean(this.flowService.borrowedMoneyFrom&&this.flowService.borrowedMoneyAgreement)}}]),t}();r.$inject=["$log","AspFlowService","aspConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5186)),a=s(n(5187));function s(t){return t&&t.__esModule?t:{default:t}}n(5188);var r={template:i.default,controller:a.default};e.default=r,t.exports=e.default},function(t,e){t.exports=' <tng-tax-banner ng-if="!$ctrl.isClientBusiness"></tng-tax-banner> <div class="c-account-summary__hide-on-large-screen"> <tng-personal-insights-toggle ng-if="$ctrl.hasPersonalInsightCapability && $ctrl.PersonalInsightsService.isPersonalInsightsEnabled() &&\n           $ctrl.showInsightsToggle && $ctrl.PersonalInsightsService.accountsFetched"> </tng-personal-insights-toggle> <div ng-if="!$ctrl.hasPersonalInsightCapability ||\n              (!$ctrl.PersonalInsightsService.isPersonalInsightsEnabled() ||\n              ($ctrl.PersonalInsightsService.isPersonalInsightsEnabled() && !$ctrl.PersonalInsightsService.isEnhancedInsights))" ng-class="{\'c-insights-carousel--not-personal\': $ctrl.PersonalInsightsService.isPersonalInsightsEnabled() && !$ctrl.isEnhancedInsights}"> <tng-insight-carousel></tng-insight-carousel> </div> </div> <div class="c-account-summary__hide-on-small-screen"> <tng-insight-carousel></tng-insight-carousel> </div> <tng-kyc-roadblock-modal ng-if="$ctrl.isKYCModalVisible" on-close="$ctrl.isKYCModalVisible = false"> </tng-kyc-roadblock-modal> <div class="c-account-summary fb2" ng-show="!$ctrl.loading"> <tng-error-message ng-if="$ctrl.hasErrors"> <ul> <li ng-repeat="error in $ctrl.errors">{{error | translate}}</li> </ul> </tng-error-message> <div class="c-account-summary__content"> <div> <lts-widget></lts-widget> </div> <tng-lift-and-load-container> <div lift-and-load-child class="content__what-i grid__container" ng-show="!$ctrl.checkServiceErrors()"> <div class="c-account-summary__grid-item"> <what-i-card id="accountSummary_whatIHave" title-key="account.overview.whatICard.whatIHave" data="$ctrl.whatIHaveData" class="what-i"> </what-i-card> </div> <div class="c-account-summary__grid-item" ng-show="!$ctrl.isClientBusiness"> <what-i-card id="accountSummary_whatIOwe" title-key="account.overview.whatICard.whatIOwe" data="$ctrl.whatIOweData" class="what-i"> </what-i-card> </div> </div> <div class="grid__container" lift-and-load-child> <div class="what-i__buttons"> <span ng-show="$ctrl.showTabListView" class="account-summary-list-title" translate="account.overview.accounts"></span> <span ng-class="{\'c-account-summary__account-action-buttons-container\' : $ctrl.showTabListView}"> <button actionable-id="accountSummary_addAccount" class="btn btn--orange btn--large btn--auto btn--add-account" tng-warn-on-click-kyc-pending ng-if="!$ctrl.disableOpenAccount" ui-sref="{{ $ctrl.getOnboardingStateKey() }}" translate="account.overview.addAccountButton"> </button> <button tng-warn-on-click-kyc-pending actionable-id="account-details-open-statement" class="btn btn--edit btn--large btn--auto what-i__buttons__transaction" ng-click="$ctrl.openStatementsModal()" translate="account.overview.statements"> </button> </span> <div ng-if="$ctrl.showViewToggle && !$ctrl.isNative" class="field c-account-summary__view-selector"> <tng-image-with-tool-tip id="ListView" image-alt="::$ctrl.VIEW_TYPES[1].label | translate" image-src="$ctrl.viewSelected.value === $ctrl.LIST_VIEW ? \'assets/images/list_view_selected.svg\' : \'assets/images/list_view_unselected.svg\'" image_id_prefix="list_view" ng-click="$ctrl.onUpdateView($ctrl.VIEW_TYPES[1])"> {{ ::$ctrl.VIEW_TYPES[1].label | translate }} </tng-image-with-tool-tip> <tng-image-with-tool-tip id="TileView" class="c-account-summary__view-selector__tile-view-button" image-alt="::$ctrl.VIEW_TYPES[0].label | translate" image-src="$ctrl.viewSelected.value === $ctrl.TILE_VIEW ? \'assets/images/tile_view_selected.svg\' : \'assets/images/tile_view_unselected.svg\'" image_id_prefix="tile_view" ng-click="$ctrl.onUpdateView($ctrl.VIEW_TYPES[0])"> {{ ::$ctrl.VIEW_TYPES[0].label | translate }} </tng-image-with-tool-tip> </div> </div> </div> <tng-account-summary-list class="account-summary-list" ng-show="$ctrl.showTabListView" account-select-subject="$ctrl.accountSelectSubject" account-update-observable$="$ctrl.accountUpdateObservable$" usd-rate="$ctrl.usdRate" is-kyc-pending="$ctrl.isKycLockedMode" allow-aggregation-accounts="$ctrl.displayAggregateAccounts" is-client-business="$ctrl.isClientBusiness"> </tng-account-summary-list> <div ng-if="$ctrl.showTabListView && $ctrl.showProgressSummaryList" class="grid__container c-account-summary__automated-savings-title"> <div class="what-i__buttons"> <span class="account-summary-list-title"> {{ ::\'account.overview.automatedSavings\' | translate }} </span> </div> </div> <tng-progress-summary-list class="account-summary-list" ng-show="$ctrl.showTabListView && $ctrl.showProgressSummaryList" capabilities-change-subject$="$ctrl.capabilitiesChangeSubject$" account-select-subject="$ctrl.accountSelectSubject" account-update-subject$="$ctrl.goalAccountUpdateSubject"> </tng-progress-summary-list> <div class="content__accounts" ng-show="!$ctrl.isClientBusiness" ng-class="{\'personal-accounts-list-view\': $ctrl.showTabListView}"> <account-section id="accountSummary_sectionSpending" account-type="$ctrl.ACCOUNT_CATEGORIES.CHEQUING" account-group="$ctrl.ACCOUNT_GROUPS.SPENDING" title-key="account.overview.accountSection.spending" accounts="$ctrl.sortedAccounts.SPENDING" disable-open-account="$ctrl.disableOpenAccount" tsys-service-error="$ctrl.CREDIT_CARD_ERROR_SERVICE" usd-rate="$ctrl.usdRate" is-tile-view="$ctrl.viewSelected.value === $ctrl.TILE_VIEW" is-kyc-pending="$ctrl.isKycLockedMode" pending-accounts="$ctrl.pendingSpendingAccounts"></account-section> <account-section id="accountSummary_sectionSaving" account-type="$ctrl.ACCOUNT_CATEGORIES.SAVING" account-group="$ctrl.ACCOUNT_GROUPS.SAVINGS" disable-open-account="$ctrl.disableOpenAccount" title-key="account.overview.accountSection.saving" accounts="$ctrl.sortedAccounts.SAVING" usd-rate="$ctrl.usdRate" is-tile-view="$ctrl.viewSelected.value === $ctrl.TILE_VIEW" is-kyc-pending="$ctrl.isKycLockedMode" pending-accounts="$ctrl.pendingSavingAccounts"></account-section> <account-section id="accountSummary_sectionInvesting" account-type="$ctrl.ACCOUNT_CATEGORIES.INVESTING" account-group="$ctrl.ACCOUNT_GROUPS.INVESTING" title-key="account.overview.accountSection.investing" accounts="$ctrl.sortedAccounts.INVESTING" disable-open-account="$ctrl.disableOpenAccount" ewms-service-error="$ctrl.MUTUAL_FUND_ERROR_SERVICE" usd-rate="$ctrl.usdRate" is-tile-view="$ctrl.viewSelected.value === $ctrl.TILE_VIEW" on-click-pending-account="$ctrl.openMfAccountInfoModal(account)" pending-accounts="$ctrl.pendingInvestingAccounts" is-pending-accounts-loading="$ctrl.isPendingAccountsLoading" is-kyc-pending="$ctrl.isKycLockedMode"></account-section> <account-section id="accountSummary_sectionBorrowing" account-type="$ctrl.ACCOUNT_CATEGORIES.BORROWING" account-group="$ctrl.ACCOUNT_GROUPS.BORROWING" disable-open-account="$ctrl.disableOpenAccount" title-key="account.overview.accountSection.borrowing" accounts="$ctrl.sortedAccounts.BORROWING" usd-rate="$ctrl.usdRate" is-tile-view="$ctrl.viewSelected.value === $ctrl.TILE_VIEW" is-kyc-pending="$ctrl.isKycLockedMode" on-click-pending-account="$ctrl.openPendingBorrowingAccount(account)" pending-accounts="$ctrl.pendingBorrowingAccounts"></account-section> <account-section id="accountSummary_externalAccounts" ng-if="$ctrl.displayAggregateAccounts" account-type="$ctrl.ACCOUNT_CATEGORIES.ACCOUNT_AGGREGATION" account-group="$ctrl.ACCOUNT_GROUPS.ACCOUNT_AGGREGATION" disable-open-account="false" title-key="account.overview.accountAggregationSection.external" accounts="$ctrl.aggregatedAccounts" aggregated-accounts="$ctrl.allAggregatedAccounts" usd-rate="$ctrl.usdRate" is-tile-view="$ctrl.viewSelected.value === $ctrl.TILE_VIEW"></account-section> </div> <account-section id="accountSummary_sectionGoals" ng-class="{\'personal-accounts-list-view\': $ctrl.showTabListView}" ng-if="$ctrl.isGoalsCapable" account-type="$ctrl.ACCOUNT_CATEGORIES.GOALS" account-group="$ctrl.ACCOUNT_GROUPS.GOALS" disable-open-account="$ctrl.disableOpenAccount" title-key="account.overview.goalsSection.goals" accounts="$ctrl.sortedAccounts.GOALS" usd-rate="$ctrl.usdRate" is-tile-view="true"></account-section> <div class="content__accounts" ng-if="$ctrl.isClientBusiness" ng-class="{\'business-accounts-list-view\': $ctrl.showTabListView}"> <account-section id="accountSummary_businessSectionSaving" ng-if="$ctrl.bussSavingsListArr.length > 0" account-type="$ctrl.ACCOUNT_CATEGORIES.BUSINESS_SAVING" account-group="$ctrl.bussSavingsListArr" disable-open-account="$ctrl.disableOpenAccount" title-key="account.overview.accountSectionBusiness.saving" accounts="$ctrl.bussSavingsListArr" usd-rate="$ctrl.usdRate" is-tile-view="$ctrl.viewSelected.value === $ctrl.TILE_VIEW"></account-section> <account-section id="accountSummary_businessSectionGic" ng-if="$ctrl.bussGicListArr.length > 0" account-type="$ctrl.ACCOUNT_CATEGORIES.BUSINESS_GIC" account-group="$ctrl.bussGicListArr" disable-open-account="$ctrl.disableOpenAccount" title-key="account.overview.accountSectionBusiness.gic" accounts="$ctrl.bussGicListArr" usd-rate="$ctrl.usdRate" is-tile-view="$ctrl.viewSelected.value === $ctrl.TILE_VIEW"></account-section> </div> </tng-lift-and-load-container> </div> <pre-approved ng-if="!$ctrl.isNative && $ctrl.preApprovalEnabled"> </pre-approved> <quick-access sorted-accounts="$ctrl.sortedAccounts" pending-applications="$ctrl.pendingApplications" orange-key="$ctrl.user.orange_key" show-tab-list-view="$ctrl.showTabListView"> </quick-access> </div> <tng-application-in-progress-modal ng-if="$ctrl.showMfAccountInfoModal" on-close="$ctrl.closeAccountInfoModal()" account="$ctrl.selectedMfAccount" show-only-close="true"> </tng-application-in-progress-modal> <tng-magic-switch ng-if="$ctrl.showMagicSwitchModal" on-close="$ctrl.closeAccountInfoModal()" is-on-boarding="false" account="$ctrl.magicSwitchMfAccount" mf-deal-id="$ctrl.pendingAppsMfDealId" application="$ctrl.selectedMfAccount" show-only-close="true"> </tng-magic-switch> <insights-page-update insights-interaction-point="ip_MR_NewListView"/> <div ng-if="$ctrl.accountsLoaded  && $ctrl.isEMTCapable && $ctrl.isEmailMoneyBlackButtonVisible()"> <tng-tour-cards-container page-id="ip_TT_OverviewDefaultList"/> <tng-tour-card card-id="email_money_card"/> </div> <tng-transactions-modals visible-popup-state="$ctrl.visiblePopupState" notify-pop="$ctrl.onModalStatePop()" type="$ctrl.TRANSACTION_VIEW_TYPE" selected-transaction="$ctrl.selectedTransaction"> </tng-transactions-modals> <tng-recipe-details-modal ng-if="$ctrl.showRecipeDetailsModal" on-close="$ctrl.closeRecipeDetailsModal()" recipe="$ctrl.selectedRecipe"> </tng-recipe-details-modal> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=m(n(198)),a=m(n(8)),s=m(n(15)),r=m(n(33)),o=m(n(58)),c=m(n(68)),l=m(n(104)),u=m(n(92)),d=m(n(0)),h=m(n(2)),f=n(1797),p=m(n(366)),g=n(178);function m(t){return t&&t.__esModule?t:{default:t}}var _=function(){function t(e,n,i,a,s,r,o,c,l,u,h,f,p,g,m,_,v,S,T,y,E,A,b,C,$,N,O,I,w,P,M,R,D,L,k,B,U,F,x,Y,G,V,q,H,W,j,K,z,Q,X,J,Z,tt,et,nt,it,at,st,rt){(0,d.default)(this,t),this.$compile=z,this.$ngRedux=K,this.$q=l,this.$log=u,this.$scope=f,this.AccountSummaryService=e,this.AccountHelpersService=Q,this.ExternalAccountsService=n,this.AccountDetailsService=i,this.UserService=a,this.stateConstants=r,this.EventBusService=h,this.DropOffService=p,this.dropOffConstants=g,this.serviceConstants=o,this.DateService=P,this.EnvironmentService=M,this.$state=m,this.mappedFXRates={},this.accountDetailsArray=[],this.cifTypeService=O,this.customersService=I,this.RspLoanService=R,this.$translate=D,this.CacheFactory=L,this.MutualFundService=H,this.mortgageConstants=j,this.accountConstants=s,this.$timeout=J,this.$rootScope=Z,this.AccountTabListService=tt,this.PendingTransactionsTitleFormatter=et,this.FeedbackSurveyService=rt,this.RSP_LOAN_ENROLLMENT_CONFIG=s.RSP_LOAN_ENROLLMENT_CONFIG,this.ACCOUNT_MAPS=s.ACCOUNT_MAPS,this.ACCOUNT_CATEGORIES=s.ACCOUNT_CATEGORIES,this.ACCOUNT_GROUPS=s.ACCOUNT_GROUPS,this.FUND_TYPE_CODES=s.FUND_TYPE_CODES,this.MAP_PRODCUT_CODE_TO_TYPE=s.DOCUMENT_TYPES_BY_PPT,this.UNAVAILABLE_SERVICES=c.USER_CAPABILITIES_SERVICE_SYSTEM_ERRORS,this.INVALIDATE_ACCOUNT=s.ACCOUNT_EVENTS.INVALIDATE_ACCOUNT,this.DATA_INVALIDATED=o.DATA_INVALIDATED,this.ROOT_ENDPOINTS=o.ROOT_ENDPOINTS,this.SessionService=_,this.PendingApplicationsService=v,this.pendingApplicationsConstants=S,this.GlobalModalsService=T,this.ACCOUNT_TYPES=s.ACCOUNT_TYPES,this.ACCOUNT_REGISTRATIONS=s.ACCOUNT_REGISTRATIONS,this.CAPABILITIES=y.CAPABILITIES,this.globalModalsConstants=E,this.KYCPendingService=A,this.USD_CURRENCY_TYPE=s.CURRENCY_TYPES.USD,this.VIEW_TYPES=s.VIEW_TYPES,this.TILE_VIEW=s.VIEW_TYPES[0].value,this.LIST_VIEW=s.VIEW_TYPES[1].value,this.ACCOUNT_PPTS=s.ACCOUNT_PPTS,this.VIEW_ONLY=this.accountConstants.ACCOUNT_SUBCATEGORIES.VIEW_ONLY.toLowerCase(),this.ACTIVE=this.accountConstants.ACCOUNT_SUBCATEGORIES.ACTIVE.toLowerCase(),this.ALL_AGGREGATED_ACCOUNTS=this.accountConstants.AGGREGATION_ACCOUNT_CONSTANTS.ALL_AGGREGATED_ACCOUNTS,this.AGGREGATION_ACCOUNTS=this.accountConstants.AGGREGATION_ACCOUNT_CONSTANTS.AGGREGATION_ACCOUNTS,this.POPUP_STATES=nt.TRANSACTION_POPUP_STATES,this.SUBMENU_ID_OPENEMT=y.SUBMENU_ID.OPENEMT,this.TimerService=B,this.colorConstants=U,this.buildConstants=k,this.AccountSummaryPrefetchService=F,this.BundleService=x,this.bundleConstants=Y,this.$locale=G,this.AnchorService=X,this.recipesConstants=at,this.$stateParams=b,this.ErrorService=C,this.errorConstants=$,this.$location=N,this.FooterNotificationsService=w,this.PersonalInsightsService=it,this.RecipesService=st,this.CREDIT_CARD_ERROR_SERVICE=!1,this.MUTUAL_FUND_ERROR_SERVICE=!1,this.MORTGAGE_ERROR_SERVICE=!1,this.eNotificationService=V,this.CustomerInfoService=q,this.loading=!0,this.isKycLockedMode=!1,this.isClientBusiness=!1,this.isBudgetLts=!1,this.errors=[],this.isNative=M.isNative(),this.preApprovalEnabled=this.buildConstants.CONFIG.preApprovalEnabled,this.imageBaseUrl=M.getBaseUrl(),this._customerInfoPromise=void 0,this.GoalsConstants=W,this.bussSavingsListArr=[],this.bussGicListArr=[],this.pendingBorrowingAccounts=[],this.listViewJustSelected=!1,this.INSIGHTS_SHOW_EXTERNAL_TAB=this.accountConstants.ACCOUNT_AGGREGATION.INSIGHTS_SHOW_EXTERNAL_TAB,this.INSIGHTS_SHOW_EXTERNAL_ACCOUNTS=this.accountConstants.ACCOUNT_AGGREGATION.INSIGHTS_SHOW_EXTERNAL_ACCOUNTS,this.UNIQUE_ACCOUNT_GROUP_IDS=[1,2,3,4,5,6,7,8,9],this.RECIPES_STATUSES=at.RECIPES_STATUSES,this.PERSONAL_CLIENT="2",this.BUSINESS_CLIENT="1"}return(0,h.default)(t,[{key:"$onInit",value:function(){var t=this;this.hasPersonalInsightCapability=!1,this.AccountSummaryPrefetchService.getPersonalInsightsCapabilityPromise().then((function(){t.hasPersonalInsightCapability=t.UserService.personalInsightsCapabilities&&-1!==t.UserService.personalInsightsCapabilities.indexOf(t.PersonalInsightsService.CAPABILITIES.INSIGHTS_RETRIEVE),t.hasPersonalInsightCapability&&(t.PersonalInsightsService.accountsFetched=!1,t.PersonalInsightsService.setCarousel(),-1!==t.UserService.personalInsightsCapabilities.indexOf(t.PersonalInsightsService.CAPABILITIES.INSIGHTS_DEFAULT_VIEW_PERSONETICS)&&t.PersonalInsightsService.setEnhancedInsightsDefault())})),(this.PersonalInsightsService.storyShown||this.PersonalInsightsService.storySource)&&(this.PersonalInsightsService.isEnhancedInsights=!0,this.PersonalInsightsService.insightsPanelOpen=!0),this.showInsightsToggle=!0,this.showViewToggle=this.EnvironmentService.isEnabled("showViewToggle"),this.viewSelected=this.VIEW_TYPES[1],this._initializeCache(),this.accountSelectSubject=new f.Subject,this.accountUpdateSubject=new f.Subject,this.capabilitiesChangeSubject$=new f.ReplaySubject(1),this.accountUpdateObservable$=this._accountUpdateObservable$(),this.accountSelectSubscription=this._accountSelectObservable$().subscribe(this._accountSelectionObserver.bind(this)),this.EventBusService.subscribe(this.$rootScope,this.INSIGHTS_SHOW_EXTERNAL_ACCOUNTS,(function(){return t._scrollToExternalAccounts(t.INSIGHTS_SHOW_EXTERNAL_ACCOUNTS)})),this.goalAccountUpdateSubject=new f.Subject,this.unsubscribe=this.$ngRedux.connect(this.mapStateToThis.bind(this),(0,u.default)({},g.ChatWithUsActions))(this),this.isTabletViewSize=this.EnvironmentService.isTabletViewSize(),this.getAccountsAndCapabilities(),this.getUser(),this.EventBusService.subscribe(this.$scope,this.DATA_INVALIDATED,(function(e,n){return t._handleDataInvalidated(n)}))}},{key:"_accountSelectObservable$",value:function(){return this.accountSelectSubject.asObservable()}},{key:"_accountUpdateObservable$",value:function(){return this.accountUpdateSubject.asObservable()}},{key:"$onDestroy",value:function(){this.accountSelectSubscription.unsubscribe(),this.unsubscribe()}},{key:"_accountSelectionObserver",value:function(t){var e=t.account,n=void 0===e?{}:e,i=t.category,a=void 0===i?"":i;if(this.isKycLockedMode)this.GlobalModalsService.showKYCRoadblockModal({mortgageDealId:n.isMortgagePending&&n.dealId});else if(n.isPendingAccount)switch(a){case this.ACCOUNT_CATEGORIES.INVESTING:this.openMfAccountInfoModal(n);break;case this.ACCOUNT_CATEGORIES.BORROWING:this.openPendingBorrowingAccount(n)}else this.goToDetails(n,a)}},{key:"goToDetails",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.accountConstants,i=this.stateConstants,a=t.goal_account&&e===this.ACCOUNT_CATEGORIES.GOALS?n.ACCOUNT_TYPES.GOALS:t.type;a||(t.mutual_fund?a=n.ACCOUNT_TYPES.ASP:t.recipe_type&&t.recipes_configuration&&(a=n.ACCOUNT_TYPES.RECIPES));var s=n.ACCOUNT_GROUPS[a];switch(a){case n.ACCOUNT_TYPES.CHEQUING:this.TimerService.startTimerForAction(this.TimerService.EVENTS.VIEW_CHEQUING_ACCOUNT),this._goTo(i.ACCOUNT_DETAILS_CHEQUING,t.number);break;case n.ACCOUNT_TYPES.CREDIT_CARD:this._goTo(i.ACCOUNT_DETAILS_CREDIT_CARD,t.number);break;case n.ACCOUNT_TYPES.SAVINGS:this.TimerService.startTimerForAction(this.TimerService.EVENTS.VIEW_SAVING_ACCOUNT),this._goTo(i.ACCOUNT_DETAILS_SAVINGS,t.number);break;case n.ACCOUNT_TYPES.MORTGAGE:this._goTo(i.ACCOUNT_DETAILS_MORTGAGE,t.number);break;case n.ACCOUNT_TYPES.LOAN:this._goTo(i.ACCOUNT_DETAILS_LOAN,t.number);break;case n.ACCOUNT_TYPES.MUTUAL_FUND:this.$state.go(i.ACCOUNT_DETAILS_INVESTMENT,{accountHash:t.number});break;case n.ACCOUNT_TYPES.GOALS:this.TimerService.startTimerForAction(this.TimerService.EVENTS.VIEW_GOAL_ACCOUNT),-1!==[this.GoalsConstants.GOAL_ARCHETYPES.HOME_DOWNPAYMENT,this.GoalsConstants.GOAL_ARCHETYPES.RETIREMENT,this.GoalsConstants.GOAL_ARCHETYPES.DEBT_REPAYMENT].indexOf(t.goal_archetype)?this.$state.go(this.stateConstants.GOAL_DETAILS,{lifeGoalId:t.life_goal_id}):this.$state.go(this.stateConstants.ACCOUNT_DETAILS_GOALS,{accountHash:t.number,lifeGoalId:t.life_goal_id,accountGroup:s});break;case n.ACCOUNT_TYPES.ASP:this.visiblePopupState=this.POPUP_STATES.VIEW,t.mutual_fund||(t.transaction_date=t.scheduledDate),this.selectedTransaction=t;break;case n.ACCOUNT_TYPES.RECIPES:this.showRecipeDetailsModal=!0,this.selectedRecipe=t;break;default:this.$log.debug("Action: "+t.type+" not available yet"),this._goTo(i.COMING_SOON)}}},{key:"onModalStatePop",value:function(){this.visiblePopupState=void 0}},{key:"closeRecipeDetailsModal",value:function(){this.showRecipeDetailsModal=!1}},{key:"_goTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.$state.go(t,{accountHash:e})}},{key:"mapStateToThis",value:function(t){return{isChatWithUsAvailable:(0,u.default)({},t.chatWithUs).isChatWithUsAvailable}}},{key:"_initializeCache",value:function(){this.cache=this.CacheFactory.get("accountSummaryCache"),this.cache?this.viewSelected=this._getCachedData("viewType"):(this.cache=this.CacheFactory.createCache("accountSummaryCache",{storageMode:"sessionStorage"}),this._cacheData("viewType",this.viewSelected))}},{key:"_cacheData",value:function(t,e){this.cache.put(t,e)}},{key:"_getCachedData",value:function(t){return this.cache.get(t)}},{key:"onSelectView",value:function(t){this.viewSelected.label!==t.label&&(t.value===this.LIST_VIEW&&(this.listViewJustSelected=!0),this.viewSelected=t,this._cacheData("viewType",this.viewSelected))}},{key:"onUpdateView",value:function(t){return this.onSelectView(t),this.putAccountSummaryViewPreference(t)}},{key:"_handleDataInvalidated",value:function(t){t===this.ROOT_ENDPOINTS.ACCOUNTS&&(this.getAccountsAndCapabilities(),this.getAggregatedAccounts())}},{key:"getAccountsAndCapabilities",value:function(){var t=this,e=this.isNative?this.$q.resolve([]):this.RspLoanService.getAvailablePAL({getPostApprovals:!0}).catch((function(e){t.$log.error("GET Rsp Loan Post-approvals ERROR: ",e)})),n=this._getCapabilitiesServicingSystems(),i=this.AccountSummaryPrefetchService.getAccountsPromise()||this.AccountSummaryService.getAccounts({},{resetCache:this.$stateParams.ignoreCache}),a=this.AccountSummaryPrefetchService.getAggregatedAccountsPromise(),s=this.$q.all([i,a]).then((function(e){return t.PersonalInsightsService.accountsFetched=!0,t.resetSortedAccounts(e[0]),t._extractAggregatedAccountsResponseData(e[1]),t._handleLoadAccount(e[0],t.aggregatedAccounts)})).catch((function(e){t.$log.error("GET ACCOUNTS ERROR: ",e),t._processError(e)})).finally((function(){t.EventBusService.publish(t.accountConstants.ACCOUNT_EVENTS.ACCOUNT_SUMMARY_LOADED,{})})),r=this.loadTrackerMortgages().catch((function(e){t.$log.error("Get pending mortgage error: ",e)})),o=!this.isNative&&this.AccountSummaryPrefetchService.preloadGICAccounts(),d=void 0;d=this.isNative?this.$q.resolve():this.ExternalAccountsService.fetchAccounts().then((function(e){if(e.externalLinks&&e.externalLinks[0]&&e.externalLinks[0].accounts&&e.externalLinks[0].accounts.length){var n=t.AccountSummaryService.mapExternalAccounts(e.externalLinks[0].accounts);t.accountUpdateSubject.next({id:t.UNIQUE_ACCOUNT_GROUP_IDS[0],accounts:n})}}));var h=this._getPendingAppsForPendingModalDisplay(),f=this.PendingApplicationsService.getAllPendingApplications().then((function(e){if(e&&e.response_status&&e.response_status.status_code===t.serviceConstants.STATUS_CODES.SUCCESS)return e;throw e})).catch((function(e){t.$log.error("Error retrieving pending applications",e),t._processError(e)})),p=this._getCustomerInfo();this.cifTypeService.didParentSwitchToChild()||(this._customerInfoPromise=p);var g=[i,f,n,p,h],m=this.$q.all(g);return this.$q.all([e,s,r]).then((function(e){var n=(0,l.default)(e,1)[0];if(!t.isNative&&n&&n.length>0){var i,a=n.map((function(e){return{description:t.$translate.instant("rspLoan.accountSummary.postApprovalTile.description"),nickname:t.$translate.instant("rspLoan.accountSummary.postApprovalTile.nickname"),display_name:"XXXX",account_balance:0,dealId:e.deal_id,isRspLoanPostApproval:!0}}));return(i=t.sortedAccounts[t.ACCOUNT_CATEGORIES.BORROWING]).push.apply(i,(0,c.default)(a)),t.accountUpdateSubject.next({id:t.UNIQUE_ACCOUNT_GROUP_IDS[1],accounts:a}),a}return t.$timeout((function(){t.accountsLoaded=!0}),3e3),!1})).then((function(){return o})).then((function(e){return e&&e.accounts&&t.sortedAccounts[t.ACCOUNT_CATEGORIES.SAVING].forEach((function(t){e.accounts.forEach((function(e){t.number===e.number&&(t.maturityDate=e.maturity_date)}))})),e})).then((function(){return t._handleDropOffScenarios(m)})).then((function(){return d})).then((function(){return t.isKycLockedMode?t.retrievePendingAccountsForKycPendingClient():(t._appendPendingTlocToBorrowing(t.pendingApplications),t.retrievePendingMfAppsDetail(t.pendingApplications))})).finally((function(){var e=[t.ACCOUNT_CATEGORIES.SPENDING,t.ACCOUNT_CATEGORIES.SAVING,t.ACCOUNT_CATEGORIES.INVESTING,t.ACCOUNT_CATEGORIES.BORROWING],n=[];if(e.forEach((function(e){t.sortedAccounts[e]&&t.sortedAccounts[e].length>0&&n.push.apply(n,(0,c.default)(t.sortedAccounts[e]))})),t.accountUpdateSubject.next({id:t.UNIQUE_ACCOUNT_GROUP_IDS[3],accounts:n}),t.mfNonIncompleteApplications.length>0){var i=t.mfNonIncompleteApplications.map((function(e){var n=e.applicationDetail,i=n.portfolioDisplayName,a=n.productDisplayName;return(0,u.default)({},e,{isPendingAccount:!0,accountType:e.type,description:t.$translate.instant(a),accountName:t.$translate.instant(i)})}));t.accountUpdateSubject.next({id:t.UNIQUE_ACCOUNT_GROUP_IDS[8],accounts:i})}t.$location.search({})}))}},{key:"loadTrackerMortgages",value:function(){var t=this;return this.isNative&&!this.EnvironmentService.get("mortgageTrackerNativeEnabled")?this.$q.resolve():this._getCustomerInfo().then((function(){return t.PendingApplicationsService.getMortgages().then((function(e){var n;if(e&&e.service_requests){var i=e.service_requests;t.EnvironmentService.isMock()&&(i=i.filter((function(e){return e.type===t.pendingApplicationsConstants.TYPES.MORTGAGE})));var a=!0,s=!1,r=void 0;try{for(var l,d=(0,o.default)(i);!(a=(l=d.next()).done);a=!0){var h=l.value;t.PendingApplicationsService.setMortgageStatus(h)}}catch(t){s=!0,r=t}finally{try{!a&&d.return&&d.return()}finally{if(s)throw r}}var f=e.service_requests.filter((function(t){return t.showMortgageTrackerTile})),p=t.pendingApplicationsConstants.MORTGAGE_WEB_STATUS,g=f.map((function(t){return{dealId:t.dealId,isMortgagePending:!0,type:t.type,webstatus:-1!==[p.DECISIONED,p.PA_APPROVED].indexOf(t.webstatus)?t.webstatus:p.INPROGRESS,applicationDetail:{portfolioDisplayName:"mortgageTracker.accountSummaryTile.titles."+t.loan_type,primaryTitle:"mortgageTracker.accountSummaryTile.titles."+t.loan_type,productDisplayName:"mortgage.transactionTypes."+t.transaction_type,secondaryTitle:"mortgage.transactionTypes."+t.transaction_type}}}));if((n=t.pendingBorrowingAccounts).push.apply(n,(0,c.default)(g)),g.length>0){var m=g.map((function(e){var n=e.applicationDetail,i=n.portfolioDisplayName,a=n.productDisplayName;return(0,u.default)({},e,{isPendingAccount:!0,accountType:e.type,type:t.ACCOUNT_TYPES.MORTGAGE,description:t.$translate.instant(a),accountName:t.$translate.instant(i)})}));t.accountUpdateSubject.next({id:t.UNIQUE_ACCOUNT_GROUP_IDS[2],accounts:m})}}}))}))}},{key:"getUser",value:function(){var t=this;return this._customerInfoPromise?this._customerInfoPromise:this.UserService.getUserInfo().then((function(e){return t.user=e.customer,t.setAccountSummaryViewPreference({clientType:t.user.client_type,listViewPreference:t.user.account_list_view_preference}),e})).catch((function(e){t.$log.error("GET USER INFO ERROR: ",e),t._processError(e)}))}},{key:"setAccountSummaryViewPreference",value:function(t){var e=t.listViewPreference,n=void 0!==e&&e;!this.showViewToggle||this.isNative||n||this.onSelectView(this.VIEW_TYPES[0])}},{key:"putAccountSummaryViewPreference",value:function(t){var e=this;return this.customersService.putCustomerInfo({customer:{account_list_view_preference_update_only:!0,account_list_view_preference:t===this.VIEW_TYPES[1]}}).catch((function(t){e.$log.error("PUT ACCUNT SUMMARY VIEW PREFERENCE ERROR",t)}))}},{key:"resetSortedAccounts",value:function(){var t;this.sortedAccounts=(t={},(0,r.default)(t,this.ACCOUNT_CATEGORIES.SPENDING,[]),(0,r.default)(t,this.ACCOUNT_CATEGORIES.SAVING,[]),(0,r.default)(t,this.ACCOUNT_CATEGORIES.INVESTING,[]),(0,r.default)(t,this.ACCOUNT_CATEGORIES.BORROWING,[]),(0,r.default)(t,this.ACCOUNT_CATEGORIES.GOALS,[]),(0,r.default)(t,this.ACCOUNT_CATEGORIES.EXTERNAL,[]),t),this.isClientBusiness&&(this.bussSavingsListArr=[],this.bussGicListArr=[])}},{key:"_getCapabilitiesServicingSystems",value:function(){var t=this;return this.$q.all([this.AccountSummaryPrefetchService.getCapabilitiesPromise()||this.UserService.getCapabilities(),this._setGoalsCapabilities()]).then((function(e){var n=e[0],i=n.capabilities||[];return t._mapServiceErrors(n),t.isClientKycPending=t.KYCPendingService.checkCapabilities(n&&n.capabilities),t.isClientBusiness=i.indexOf(t.CAPABILITIES.BUSINESS_UPDATE_FULL)>=0,t.isClientBusiness&&t.AccountSummaryService.setIsCIFBusiness(t.isClientBusiness),t.isClientCsa=-1!==i.indexOf(t.CAPABILITIES.PERSON_UPDATE_BASIC),t.isRecipeCapable=!!i.find((function(e){return e===t.CAPABILITIES.RECIPES_CREATE||e===t.CAPABILITIES.RECIPES_RETRIEVE||e===t.CAPABILITIES.RECIPES_UPDATE||e===t.CAPABILITIES.RECIPES_DELETE}))&&!t.isClientBusiness,t.isMoveMoneyCapable=-1!==i.indexOf(t.CAPABILITIES.DEPOSIT_TRANSACT),t.isEMTCapable=-1!==i.indexOf(t.CAPABILITIES.EMT_TRANSACT),t.capabilitiesChangeSubject$.next({showGoalsTab:t.isGoalsCapable,showRecipeTab:t.isRecipeCapable,showAspTab:t.isMoveMoneyCapable}),n})).catch((function(e){t.isRecipeCapable=!1,t.isMoveMoneyCapable=!1,t.isEMTCapable=!1,t.$log.error("GET CAPABILITIES ERROR: ",e),t._processError(e)}))}},{key:"checkServiceErrors",value:function(){return this.CREDIT_CARD_ERROR_SERVICE||this.MUTUAL_FUND_ERROR_SERVICE||this.MORTGAGE_ERROR_SERVICE}},{key:"_mapServiceErrors",value:function(t){var e=this,n=t.unavailable_products;n&&n.forEach((function(t){e.UNAVAILABLE_SERVICES.indexOf(t)>-1&&(e[t+"_ERROR_SERVICE"]=!0)}))}},{key:"_handleLoadAccount",value:function(t,e){var n=this,i=[],a=[];if(t.unavailable_servicing_systems&&t.unavailable_servicing_systems.length>0){var s=t.unavailable_servicing_systems;this.checkTsysStatus(s)}var r=angular.copy(t.accounts);this.hasAccounts=r.length>0,t.exchangeRates?t.exchangeRates.forEach((function(t){n.mappedFXRates[t.currency]=t})):this.mappedFXRates={};var o=0,c=0,u=0;this.AccountSummaryService.allAccounts=r,r=r.filter((function(t){return!t.toHide}));var d=[];r.forEach((function(t){var e=n.ACCOUNT_MAPS[t.type];if(e){if(n.sortedAccounts[e].push(t),t.type===n.ACCOUNT_TYPES.CHEQUING){o+=1;var s=n.AccountDetailsService.getAccountDetails(t.number,n.ACCOUNT_TYPES.CHEQUING).then((function(t){var e=t.account_summary.account_registration;e!==n.ACCOUNT_REGISTRATIONS.JOINT&&e!==n.ACCOUNT_REGISTRATIONS.FR_JOINT||n.accountDetailsArray.push(t)}));d.push(s)}if(t.type===n.ACCOUNT_TYPES.CREDIT_CARD){c+=1;var r=n.AccountDetailsService.getAccountDetails(t.number,n.ACCOUNT_TYPES.CREDIT_CARD).then((function(e){t.date_opened=e.account_summary.date_opened,n.accountDetailsArray.push(e)}));d.push(r)}t.type===n.ACCOUNT_TYPES.SAVINGS&&(u+=1,setTimeout((function(){!n.isClientBusiness||t.product_code!==n.ACCOUNT_PPTS.BUSINESS_SAVINGS&&t.product_code!==n.ACCOUNT_PPTS.BUSINESS_US_SAVINGS?n.bussGicListArr.push(t):n.bussSavingsListArr.push(t)})));var h=n.AccountSummaryService.sortHaveOrOwe(t,i,a),f=(0,l.default)(h,2);i=f[0],a=f[1]}}));var h=this._getExternalHaveOweAggregatedAccounts(e,!0),f=this._getExternalHaveOweAggregatedAccounts(e,!1);return this.whatIHaveData=this.AccountSummaryService.getWhatIData(i,this.mappedFXRates,h),this.whatIOweData=this.AccountSummaryService.getWhatIData(a,this.mappedFXRates,f),this.AccountSummaryService.setMultiCheckingAccount(o),this.AccountSummaryService.setMultiCreditCardAccount(c),this.AccountSummaryService.setMultiSavingAccount(u),d.push(this._setGoalCardData(this.sortedAccounts[this.ACCOUNT_CATEGORIES.GOALS].concat(this.sortedAccounts[this.ACCOUNT_CATEGORIES.SAVING].filter((function(t){return t.goal_account}))).concat(this.sortedAccounts[this.ACCOUNT_CATEGORIES.INVESTING]))),this.getLtsDays(),d.push(this.getLtsBudget()),this.usdRate=this.USD_CURRENCY_TYPE in this.whatIHaveData.rates?this.whatIHaveData.rates.USD:1,this.$q.all(d).then((function(){return n.FooterNotificationsService.setAccountDetails(n.accountDetailsArray)})).finally((function(){n.accountDataLoaded=!0}))}},{key:"_getExternalHaveOweAggregatedAccounts",value:function(t,e){var n=e?(0,s.default)(this.accountConstants.ACCOUNT_AGGREGATION.WHAT_I_HAVE_CATEGORIES):(0,s.default)(this.accountConstants.ACCOUNT_AGGREGATION.WHAT_I_OWE_CATEGORIES);return t.filter((function(t){return-1!==n.indexOf(t.category)&&t.isChecked}))}},{key:"_setGoalsCapabilities",value:function(){var t=this;return this.AccountSummaryService.getGoalsCapabilities().then((function(e){return t.isGoalsCapable=!(!(e&&e.goalsCapabilities&&e.goalsCapabilities.length)||t.isClientCsa),t.isGoalsCapable}))}},{key:"_setGoalCardData",value:function(t){var e=this;return this.AccountSummaryService.getLifeGoals().then((function(n){if(n&&n.response_status.status_code===e.serviceConstants.STATUS_CODES.SUCCESS){if(t.forEach((function(t){var i=!0,a=!1,s=void 0;try{for(var r,c=(0,o.default)(n.data);!(i=(r=c.next()).done);i=!0){var l=r.value;if(t.display_name===l.tgsAccountId){t.life_goal_id=l.id,t.goal_name=l.name,t.goal_target_amount=l.targetAmount,t.goal_image_url=l.goalImageUrl,t.goal_achieved=l.isAchieved,t.goal_archetype=l.archetype,t.goal_account=!0,t.goalData=l,-1===e.sortedAccounts[e.ACCOUNT_CATEGORIES.GOALS].indexOf(t)&&e.sortedAccounts[e.ACCOUNT_CATEGORIES.GOALS].push(t);break}if(l.goalLinkedAccounts&&l.goalLinkedAccounts.length>0&&-1!==l.goalLinkedAccounts.indexOf(t.display_name)){t.life_goal_id=l.id,t.goal_archetype=l.archetype,t.goal_account=!0;break}t.goal_account=!1}}catch(t){a=!0,s=t}finally{try{!i&&c.return&&c.return()}finally{if(a)throw s}}})),n&&n.data){var i=!0,a=!1,s=void 0;try{for(var r,c=(0,o.default)(n.data);!(i=(r=c.next()).done);i=!0){var l=r.value;-1!==[e.GoalsConstants.GOAL_ARCHETYPES.DEBT_REPAYMENT,e.GoalsConstants.GOAL_ARCHETYPES.HOME_DOWNPAYMENT,e.GoalsConstants.GOAL_ARCHETYPES.RETIREMENT].indexOf(l.archetype)&&function(){var t={};t.life_goal_id=l.id,t.goal_name=l.name,t.goal_current_balance=e._setGoalCurrentBalance(l),t.goal_target_amount=l.targetAmount,t.goal_image_url=l.goalImageUrl,t.goal_achieved=l.isAchieved,t.goal_archetype=l.archetype,t.goal_account=!0,t.goalData=l,e.sortedAccounts[e.ACCOUNT_CATEGORIES.GOALS]&&!e.sortedAccounts[e.ACCOUNT_CATEGORIES.GOALS].find((function(e){return e.life_goal_id===t.life_goal_id}))&&e.sortedAccounts[e.ACCOUNT_CATEGORIES.GOALS].push(t)}()}}catch(t){a=!0,s=t}finally{try{!i&&c.return&&c.return()}finally{if(a)throw s}}}}else t.service_error=!0,t.forEach((function(t){t.service_error=!0,t.life_goal_id=null,t.goal_target_amount=null,t.goal_image_url=null}));var u=e.sortedAccounts[e.ACCOUNT_CATEGORIES.GOALS]||[];e.goalAccountUpdateSubject.next({type:e.accountConstants.PROGRESS_TABS.GOALS,data:u}),e.getLtsDays(),e.getLtsBudget()})).catch((function(t){e.$log.error(t)}))}},{key:"_setGoalCurrentBalance",value:function(t){return-1!==["HOME_DOWNPAYMENT","RETIREMENT"].indexOf(t.archetype)&&t.goalLinkedAccounts?this.sortedAccounts[this.ACCOUNT_CATEGORIES.SAVING].concat(this.sortedAccounts[this.ACCOUNT_CATEGORIES.INVESTING]).filter((function(e){return-1!==t.goalLinkedAccounts.indexOf(e.display_name)})).reduce((function(t,e){return t+e.account_balance}),0):t.archetype===this.GoalsConstants.GOAL_ARCHETYPES.DEBT_REPAYMENT?t.currentAmount:null}},{key:"getLtsDays",value:function(){var t=new Date;this.currentDay=t.getDate(),this.daysInMonth=new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),this.month=this.$locale.DATETIME_FORMATS.MONTH[(new Date).getMonth()],this.year=(new Date).getFullYear()}},{key:"getLtsBudget",value:function(){var t=this;return this.showBudgets=!1,this.AccountSummaryService.getBudgetLtsSettings().then((function(e){t.budget_settings_details=e.budget_settings_details,void 0!==t.budget_settings_details&&t.budget_settings_details.is_budgets_enabled&&t.budget_settings_details.is_show_widget&&t.budget_settings_details.has_active_budget&&(t.showBudgets=!0,t.AccountSummaryService.getLtsBudget().then((function(e){t.save_available=!1,t.showButtons=!1,t.budget_lts=e.budget_lts,t.actual_lts=e.actual_lts,t.lts_preview=e.budget_details.is_preview,e.budget_details.warn_balance_details&&e.budget_details.warn_balance_details&&(t.warnings=e.budget_details.warn_balance_details.warnings),null!=e.budget_details.save_action_details&&(t.save_available=e.budget_details.save_action_details.save_available,t.amount_exceed=e.budget_details.save_action_details.amount_exceed),t.actual_lts>0?t.firstWidth=t.actual_lts/t.budget_lts*100:t.firstWidth=100,t.isBudgetLts=!0})).catch((function(e){t.$log.error("GET LTS BUDGET ERROR: ",e)})))})).catch((function(e){t.$log.error("GET BUDGET CAPABILITIES ERROR: ",e)}))}},{key:"getOnboardingStateKey",value:function(){return this.stateConstants.EXISTING_CLIENT_ONBOARDING}},{key:"_handleDropOffScenarios",value:function(t){var e=this,n=!1,i=null;return t.then((function(t){var a=t[0]&&t[0].accounts,s=t[1]&&t[1].service_requests;e.allPendingApplications=s;var r=t[2]&&t[2].capabilities||[],o=t[3];e.amlCustomerInfo=o;var c=t[4],l=e.GlobalModalsService.lastModalClosed,u=-1!==r.indexOf(e.CAPABILITIES.PERSON_UPDATE_MINIMUM);if(e.disableOpenAccount=u&&e.isNative,e.$stateParams.showKYCPendingModal&&e.GlobalModalsService.showKYCRoadblockModal(),!u){var d=e.DropOffService.determineOutflowState(a,s,r,c);d===e.dropOffConstants.OUTFLOW_STATES.ACCOUNT_OVERVIEW?(n=!0,i=e.$location.search().action):d===e.dropOffConstants.OUTFLOW_STATES.ACCOUNT_OVERVIEW_LOCKED?e._enterKycLockedMode():d===e.dropOffConstants.OUTFLOW_STATES.BASKET_PAGE?e.$location.search().products?e.$state.go(e.stateConstants.EXISTING_CLIENT_ONBOARDING,{products:e.$location.search().products}):e.$state.go(e.stateConstants.EXISTING_CLIENT_ONBOARDING):d===e.dropOffConstants.OUTFLOW_STATES.PENDING_APPLICATIONS&&(l!==e.globalModalsConstants.AVAILABLE_MODALS.PENDING_APPLICATIONS&&e.GlobalModalsService.showPendingApplications(),e.isClientKycPending&&e._enterKycLockedMode()),e.cifTypeService.didParentSwitchToChild()||e.cifTypeService.findCurrentCifType(o,r),e.$stateParams.feedbackId&&(e.FeedbackSurveyService.launchFeedbackSurvey(e.$stateParams.feedbackId),e.$stateParams.feedbackId=null)}})).catch((function(t){e.$log.error("Error retrieving accounts",t),e._processError(t)})).finally((function(){e.loading=!1,e._customerInfoPromise=void 0,e.AccountSummaryPrefetchService.invalidate(),e.TimerService.endTimersForActions(e.TimerService.EVENTS.SUBMIT_LOGIN_EVENTS),e._lazyLoadAccountDetailsBundle(),n&&(e._scrollToExternalAccounts(e.INSIGHTS_SHOW_EXTERNAL_ACCOUNTS),e._showAMLConfirmInfo().then((function(t){t&&e.BundleService.loadBundle(e.bundleConstants.AVAILABLE_BUNDLES.AML).then((function(){if(p.default.isFeatureEnabled(e.EnvironmentService))e._displayAMLConfirmInfo();else{var t=p.default.buildAMLEventInProgressParams("",e.eNotificationService.eNotificationConstants.CONFIRM_EVENT_TYPE.CLOSE_MODAL,"",e.eNotificationService.eNotificationConstants.CONFIRM_EVENT_TYPE.HIGH_RISK_ACCOUNT_SUMMARY);p.default.showRemediationMissingInfoRoadblock(e.$q,e.SessionService,e.cifTypeService,e.eNotificationService,e.GlobalModalsService,t).then((function(t){t&&void 0!==t||e._displayAMLConfirmInfo()}))}}))})),"openChat"===i&&(e.$log.debug("Account summary action : "+i),e.BundleService.loadBundle(e.bundleConstants.AVAILABLE_BUNDLES.CONTACT_US).then((function(t){t&&setTimeout((function(){e.$compile(angular.element("tng-global-modals").contents())(e.$scope)}),0),e.toggleChatWithUsModal()})))),e.SessionService.accountSummaryViewed=!0}))}},{key:"_showAMLConfirmInfo",value:function(){if(this.SessionService.showAMLConfirmInfo&&!this.SessionService.accountSummaryViewed)return this.$q.resolve(!0);if(!this.SessionService.accountSummaryViewed&&p.default.canConfirmAMLEvent(this.cifTypeService,this.SessionService,!0)){if(this.cifTypeService.isAMLHighRisk)return this.$q.resolve(!0);if(p.default.isFeatureEnabled(this.EnvironmentService))return this.cifTypeService.isBusiness()?this.$q.resolve(!1):(!this.cifTypeService.isBusiness()&&p.default.hasAMLMissingInfo(this.$q,this.SessionService,this.cifTypeService,this.eNotificationService)).then((function(t){return t})).then((function(t){return t}))}return this.$q.resolve(!1)}},{key:"_displayAMLConfirmInfo",value:function(){var t=this,e=!1;if(this.cifTypeService.isAMLHighRisk){this.isLoading=!0;var n=angular.copy(this.amlCustomerInfo);n.view_confirm_event=!0;var i=p.default.updateCustomerObject(n);i.confirm_event=!1,this.CustomerInfoService.update(i).then((function(){})).catch((function(n){t._processError(n),e=!0})).finally((function(){t.isLoading=!1}))}e||this.CustomerInfoService.getCustomerIntendedUseList().then((function(e){if(e.customer){var n=t.cifTypeService.isAMLHighRisk||t.SessionService.showAMLConfirmInfo;t.GlobalModalsService.showAMLConfirmInfo(e.customer,t.cifTypeService.isBusiness(),!n)}}))}},{key:"_processEmtReclaimData",value:function(t){var e=t[5]&&t[5].emt;return e&&(0,a.default)(e,{record_id:e.reference_number,from_account_number:e.from_account,confirmation_number:e.reference_number}),e||null}},{key:"_enterKycLockedMode",value:function(){this.$log.debug("User is KYC pending, show account summary in locked state"),this.isKycLockedMode=!0}},{key:"_processError",value:function(t){var e=this;this.ErrorService.processError(t,this.errorConstants.AVAILABLE_EVENTS.REQUEST_ERROR).then((function(t){e.errors=[t.message]})).catch((function(t){e.$log.error("_processError error",t),e.errors=[e.$translate.instant("global.errorCodes.generic")]}))}},{key:"_getCustomerInfo",value:function(){var t=this;return this.cifTypeService.didParentSwitchToChild()?this._skipRequest(this.cifTypeService.selectedCif.customerInfo):this.customersService.getCustomerInfo({include_servicing_systems:!0}).then((function(e){return t.$log.debug("GET Customers Info response: ",e),t.setAccountSummaryViewPreference({clientType:e.customer.client_type,listViewPreference:e.customer.account_list_view_preference}),e.customer})).catch((function(e){t.$log.error(e),t._processError(e)}))}},{key:"_getPendingAppsForPendingModalDisplay",value:function(){var t=this;return this.PendingApplicationsService.getPendingApplicationsForModal().then((function(e){return t.pendingApplications=e,e})).catch((function(e){t.$log.error("Error retrieving pending applications",e),t._processError(e)}))}},{key:"retrievePendingAccountsForKycPendingClient",value:function(){var t=this,e=this.allPendingApplications.filter((function(e){return!t.PendingApplicationsService.isMutualFundApplicationIncomplete(e)}));this.PendingApplicationsService.prepareKycPendingAccounts(e,(function(e){var n;t.pendingSpendingAccounts=e[t.ACCOUNT_CATEGORIES.SPENDING],t.pendingSavingAccounts=e[t.ACCOUNT_CATEGORIES.SAVING],t.kycPendingInvestingAccounts=e[t.ACCOUNT_CATEGORIES.INVESTING],(n=t.pendingBorrowingAccounts).push.apply(n,(0,c.default)(e[t.ACCOUNT_CATEGORIES.BORROWING]));var i=[t.ACCOUNT_CATEGORIES.SPENDING,t.ACCOUNT_CATEGORIES.SAVING,t.ACCOUNT_CATEGORIES.INVESTING,t.ACCOUNT_CATEGORIES.BORROWING],a=[];i.forEach((function(n){if(e[n].length>0){var i=e[n].map((function(e){var n=e.product_code?t.MAP_PRODCUT_CODE_TO_TYPE[e.product_code]:e.type;return(0,u.default)({},e,{type:n,accountName:t.$translate.instant(e.applicationDetail.primaryTitle),description:t.$translate.instant(e.applicationDetail.secondaryTitle),isPendingAccount:!0})}));a=a.concat(i)}})),t.accountUpdateSubject.next({id:t.UNIQUE_ACCOUNT_GROUP_IDS[4],accounts:a}),t.$scope.$apply()}))}},{key:"retrievePendingMfAppsDetail",value:function(t){var e=this;return this.mfNonIncompleteApplications=this.PendingApplicationsService.filterMfIncompleteApplications(t),this.mfNonIncompleteApplications.length>0?(this.isPendingAccountsLoading=!0,this.PendingApplicationsService.getMfApplicationDetails(this.mfNonIncompleteApplications).then((function(t){t.forEach((function(t,n){e.mfNonIncompleteApplications[n].applicationDetail=e.PendingApplicationsService.prepareMfApplicationDetail(t),e.PendingApplicationsService.setInternalFundedMfAppStatus(e.mfNonIncompleteApplications[n])})),e.handleMfAppDetailResponse(),e.isPendingAccountsLoading=!1,e.$scope.$apply()})).catch((function(t){e.$log.debug("Error getting application details:",t),e.isPendingAccountsLoading=!1,e.mfNonIncompleteApplications=[]}))):this.$q.resolve()}},{key:"handleMfAppDetailResponse",value:function(){var t=this.sortedAccounts.INVESTING,e=this.mfNonIncompleteApplications.reduce((function(e,n){return n.applicationDetail&&n.applicationDetail.accountNum&&t.forEach((function(t){t.display_name===n.applicationDetail.accountNum&&void 0!==t.account_balance&&(0===t.account_balance?e.accountsToRemove.push(t.display_name):e.applicationsToRemove.push(n.applicationDetail.accountNum))})),e}),{accountsToRemove:[],applicationsToRemove:[]});this.sortedAccounts.INVESTING=t.filter((function(t){return!(-1!==e.accountsToRemove.indexOf(t.display_name))})),this.mfNonIncompleteApplications=this.mfNonIncompleteApplications.filter((function(t){return!(-1!==e.applicationsToRemove.indexOf(t.applicationDetail.accountNum))}))}},{key:"_skipRequest",value:function(t){return new i.default((function(e){e(t)}))}},{key:"goToBudgetTool",value:function(){!1===this.lts_preview?this.$state.go(this.stateConstants.BUDGET_LTS_OVERVIEW,{}):this.$state.go(this.stateConstants.BUDGET_TOOL,{currentState:"INITIAL"})}},{key:"_lazyLoadAccountDetailsBundle",value:function(){this.isNative&&this.BundleService.loadBundle(this.bundleConstants.AVAILABLE_BUNDLES.ACCOUNT_DETAILS)}},{key:"openStatementsModal",value:function(){this.$state.go(this.stateConstants.ACCOUNT_DOCUMENTS_STATEMENTS)}},{key:"openPendingBorrowingAccount",value:function(t){t.isMortgagePending?this.$state.go(this.stateConstants.MORTGAGE_TRACKER,{dealId:t.dealId}):t.isTlocPending&&this.GlobalModalsService.showManualReviewTlocApplication(t)}},{key:"openMfAccountInfoModal",value:function(t){this.isKycLockedMode||(this.selectedMfAccount=t,this.MutualFundService.magicSwitchFundsUpgraded&&t.ms_deal_id?this.PendingApplicationsService.isApplicationProcessed(t)?this.showMfAccountInfoModal=!0:(this.magicSwitchMfAccount=this._prepareMagicSwitchInfo(t),this.pendingAppsMfDealId=t.dealId,this.showMagicSwitchModal=!0):this.showMfAccountInfoModal=!0)}},{key:"_prepareMagicSwitchInfo",value:function(t){var e=this.pendingApplicationsConstants.MUTUAL_FUND_TRANSACTION_TYPE;return-1!==[e.ENROLLMENT.RSP,e.ENROLLMENT.TFSA,e.ENROLLMENT.RSPSP].indexOf(t.transaction_type)?{type:this.ACCOUNT_TYPES.MUTUAL_FUND,description:this.$translate.instant("clientOnboarding.wrapUp.cc.toBeIssued")}:null}},{key:"closeAccountInfoModal",value:function(){this.showMfAccountInfoModal=!1,this.showMagicSwitchModal=!1}},{key:"checkTsysStatus",value:function(t){-1!==t.indexOf(this.ACCOUNT_TYPES.CREDIT_CARD)&&(this.errors=[this.$translate.instant("global.errorCodes.TSYS_UNAVAILABLE")])}},{key:"_appendPendingTlocToBorrowing",value:function(t){var e=this;if(t){var n,i=[];if(this.pendingApplications.forEach((function(t){if("CREDIT"===t.type&&"PENDING"===t.status){var e={dealId:t.dealId,type:t.type,isTlocPending:!0,webstatus:t.webstatus,status:t.status,statusUpdateDate:t.status_update_date,applicationDetail:{portfolioDisplayName:"tlocapp.manualReview.portfolioDisplayName",productDisplayName:"tlocapp.manualReview.productDisplayName"}};i.push(e)}})),i.length>0)if((n=this.pendingBorrowingAccounts).push.apply(n,i),i.length>0){var a=i.map((function(t){var n=t.applicationDetail,i=n.portfolioDisplayName,a=n.productDisplayName;return(0,u.default)({},t,{isPendingAccount:!0,accountType:t.type,type:e.ACCOUNT_TYPES.LOAN,description:e.$translate.instant(a),accountName:e.$translate.instant(i)})}));this.accountUpdateSubject.next({id:this.UNIQUE_ACCOUNT_GROUP_IDS[5],accounts:a})}}}},{key:"getAggregatedAccounts",value:function(){var t=this;this.AccountSummaryPrefetchService.getAggregatedAccountsPromise().then((function(e){t._extractAggregatedAccountsResponseData(e),t._scrollToExternalAccounts()})).catch((function(e){t.$log.error("GET AGGREGATED ACCOUNTS ERROR: ",e)}))}},{key:"_extractAggregatedAccountsResponseData",value:function(t){var e=this;if(this.aggregatedAccounts=[],this.allAggregatedAccounts=[],this.AccountSummaryPrefetchService.hasAccountSummaryAACapability&&!this.AccountSummaryPrefetchService.isAccountAggregationKillSwitch&&t&&t.response_status.status_code===this.serviceConstants.STATUS_CODES.SUCCESS)if(this.AccountHelpersService.initLoginRequirdInstitutions(),t&&t.response_status.status_code===this.serviceConstants.STATUS_CODES.SUCCESS){if(this.aggregatedAccounts=[],this.allAggregatedAccounts=[],t&&!t.aggregated_accounts||t&&t.aggregated_accounts&&0===t.aggregated_accounts.length)return;var n=void 0,i=t.aggregated_accounts;if(this.allAggregatedAccounts=t.aggregated_accounts,this.accountUpdateSubject.next({id:this.UNIQUE_ACCOUNT_GROUP_IDS[6],accounts:this.allAggregatedAccounts,type:this.ALL_AGGREGATED_ACCOUNTS}),t.selected_accounts){var a=void 0,s=void 0,r=void 0;i.forEach((function(e){(a=t.selected_accounts.find((function(t){return t.institution_id===e.institution_id})))&&(s=a.accounts.map((function(t){return t.id})),r=e.accounts.filter((function(t){return s.indexOf(t.id_hashed)>-1})),e.selectedInstitutionAccounts=r)}))}i.forEach((function(t){var i=t.selectedInstitutionAccounts&&t.selectedInstitutionAccounts.length>0;(t.selectedInstitutionAccounts?t.selectedInstitutionAccounts:t.accounts).forEach((function(a){(n=angular.copy(a)).bankId=t.institution_seqid?t.institution_seqid:t.institution_id,n.bankName=t.institution_name,n.logo=t.institution_logo,n.account_balance=a.balance.amount,n.last_update_date=t.last_update_date,n.isRelogin=t.status===e.accountConstants.AA_LOGIN_REQUIRED,n.isChecked=!n.isRelogin&&i,e.AccountHelpersService.isLoginRequirdInstitutions(n.bankId)||e.aggregatedAccounts.push(n),n.isRelogin&&e.AccountHelpersService.addLoginRequirdInstitutions(n.bankId)}))}));var o=this.aggregatedAccounts.map((function(t){return(0,u.default)({},t,{currency_type:t.balance.currency,accountType:t.type,type:e.ACCOUNT_CATEGORIES.EXTERNAL,subCategoryName:e.VIEW_ONLY,display_name:t.mask,accountName:t.bankName})}));this.accountUpdateSubject.next({id:this.UNIQUE_ACCOUNT_GROUP_IDS[7],accounts:o,type:this.AGGREGATION_ACCOUNTS})}else;}},{key:"_scrollToExternalAccounts",value:function(t){var e=this;this.EventBusService.INSIGHTS_SHOW_EXTERNAL_ACCOUNTS&&t&&(this.EventBusService.INSIGHTS_SHOW_EXTERNAL_ACCOUNTS=!1,this.EnvironmentService.isPhone()&&this.$timeout((function(){e.AnchorService.scroll(e.accountConstants.ACCOUNT_AGGREGATION.INSIGHTS_BANNER_EXTERNAL_ID_TILE_VIEW)}),500),this.showTabListView?this.EnvironmentService.isTablet()&&this.EnvironmentService.isNative()?this.$timeout((function(){e.AnchorService.scroll(e.accountConstants.ACCOUNT_AGGREGATION.INSIGHTS_BANNER_EXTERNAL_ID_TILE_VIEW)}),500):(this.AccountTabListService.selectedAccountTabsSubject$().next(this.accountConstants.ACCOUNT_CATEGORIES.EXTERNAL),this.$timeout((function(){e.AnchorService.scroll(e.accountConstants.ACCOUNT_AGGREGATION.INSIGHTS_BANNER_EXTERNAL_ID_LIST_VIEW)}),500)):this.$timeout((function(){e.AnchorService.scroll(e.accountConstants.ACCOUNT_AGGREGATION.INSIGHTS_BANNER_EXTERNAL_ID_TILE_VIEW)}),500))}},{key:"isEmailMoneyBlackButtonVisible",value:function(){return document.getElementById(this.SUBMENU_ID_OPENEMT).offsetHeight>0}},{key:"hasErrors",get:function(){return this.errors&&this.errors.length>0}},{key:"progressBarColor",get:function(){var t=this.colorConstants.COLOR_GREY;return this.isBudgetLts&&(this.actual_lts<0?t=this.colorConstants.COLOR_WARNING:this.actual_lts>0&&(t=this.colorConstants.COLOR_DUSTY_ORANGE)),t}},{key:"pendingInvestingAccounts",get:function(){return this.isKycLockedMode?this.kycPendingInvestingAccounts:this.mfNonIncompleteApplications}},{key:"isPendingAccountsLoading",set:function(t){this._isPendingAccountsLoading=t},get:function(){return this._isPendingAccountsLoading||this.PendingApplicationsService.isPendingAccountsLoading}},{key:"showTabListView",get:function(){return!this.EnvironmentService.isNative()&&!this.isTabletViewSize&&this.viewSelected.value!==this.TILE_VIEW}},{key:"showProgressSummaryList",get:function(){return!!(this.isGoalsCapable||this.isRecipeCapable||this.isMoveMoneyCapable)}},{key:"displayAggregateAccounts",get:function(){return!(!this.AccountSummaryPrefetchService.hasAccountSummaryAACapability||this.AccountSummaryPrefetchService.isAccountAggregationKillSwitch)}}]),t}();_.$inject=["AccountSummaryService","ExternalAccountsService","AccountDetailsService","UserService","accountConstants","stateConstants","serviceConstants","userConstants","$q","$log","EventBusService","$scope","DropOffService","dropOffConstants","$state","SessionService","PendingApplicationsService","pendingApplicationsConstants","GlobalModalsService","menuConstants","globalModalsConstants","KYCPendingService","$stateParams","ErrorService","errorConstants","$location","CifTypeService","CustomersService","FooterNotificationsService","DateService","EnvironmentService","RspLoanService","$translate","CacheFactory","buildConstants","TimerService","colorConstants","AccountSummaryPrefetchService","BundleService","bundleConstants","$locale","eNotificationService","CustomerInfoService","MutualFundService","GoalsConstants","mortgageConstants","$ngRedux","$compile","AccountHelpersService","AnchorService","$timeout","$rootScope","AccountTabListService","PendingTransactionsTitleFormatter","transactionConstants","PersonalInsightsService","recipesConstants","recipesService","FeedbackSurveyService","$injector"],e.default=_,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5190)),a=s(n(5191));function s(t){return t&&t.__esModule?t:{default:t}}n(5192);var r={template:i.default,controller:a.default,bindings:{titleKey:"@",data:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-what-i-card"> <div class="c-what-i-card__top {{ $ctrl.hasAccounts ? \'\' : \'bottom-rounded\'}}"> <span id="whatICard_title" class="c-what-i-card__title"> {{ $ctrl.title | translate }} <tng-help-bubble ng-show="$ctrl.data.showHelp"> <div ng-bind-html="$ctrl.helpText | translate:$ctrl.helpTextTranslationData"></div> </tng-help-bubble> </span> <span id="whatICard_amount" class="c-what-i-card__amount"> {{ $ctrl.data.totalBalance | currency }} </span> </div> <div class="c-what-i-card__mobileTop {{ ($ctrl.expanded && $ctrl.hasAccounts) ? \'c-what-i-card__mobileTop--expanded\' : \'c-what-i-card__mobileTop--collapsed\'}}" ng-click="$ctrl.toggleExpanded()"> <div class="c-what-i-card__mobileTopCell"> <span class="c-what-i-card__title"> {{ $ctrl.title | translate }}: </span> <span class="c-what-i-card__amount" ng-class="{\'c-what-i-card__amount_size_smaller\': $ctrl.isHundredThousands || $ctrl.isOneMillions || $ctrl.isTenMillionsPlus }"> {{ $ctrl.data.totalBalance | currency }} <tng-help-bubble ng-show="$ctrl.data.showHelp"> <div ng-bind-html="$ctrl.helpText | translate:$ctrl.helpTextTranslationData"></div> </tng-help-bubble> </span> </div> <div> <span class="c-what-i-card__icon-inside icon-plus large" ng-class="{ \'c-what-i-card__icon--hide\' : $ctrl.expanded || !$ctrl.hasAccounts }"></span> </div> </div> <drawer-item ng-repeat="category in $ctrl.data.categories" ng-show="$ctrl.expanded" category="category" display-currency-for-type="$ctrl.data.displayCurrencyForType"></drawer-item> <div id="whatICard_toggleDrawerClose" class="c-what-i-card__bottom c-what-i-card--collapsed" ng-click="$ctrl.toggleExpanded()" ng-show="$ctrl.hasAccounts && !$ctrl.expanded"> <span class="c-what-i-card__footerTitle">{{ \'account.overview.whatICard.seeBalance\' | translate }}</span> <span class="c-what-i-card__icon icon-plus large" ng-show="!$ctrl.expanded"></span> </div> <div id="whatICard_toggleDrawerOpen" class="c-what-i-card__bottom c-what-i-card--expanded" ng-click="$ctrl.toggleExpanded()" ng-show="$ctrl.hasAccounts && $ctrl.expanded"> <span>{{ \'account.overview.whatICard.closeBalance\' | translate }}</span> <span class="c-what-i-card__icon icon-x large" ng-show="$ctrl.expanded"></span> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.$translate=e,this.transPrefix="account.overview.whatICard.",this.expanded=!1,this.helpBubbleVisible=!1}return(0,a.default)(t,[{key:"$onChanges",value:function(){this.setTitle()}},{key:"toggleExpanded",value:function(){this.expanded=!this.expanded}},{key:"setTitle",value:function(){if(this.title=this.titleKey,this.data&&this.data.showHelp){var t="USD"in this.data.rates?this.data.rates.USD:"";this.helpTextTranslationData={rate:t},this.helpText=this.transPrefix+"helpText"}}},{key:"isBetweenRange",value:function(t,e,n){return t>=e&&t<=n}},{key:"hasAccounts",get:function(){return this.data&&this.data.categories.length>0}},{key:"isHundredThousands",get:function(){return!!this.data&&this.isBetweenRange(this.data.totalBalance,1e5,999999.99)}},{key:"isOneMillions",get:function(){return!!this.data&&this.isBetweenRange(this.data.totalBalance,1e6,9999999.99)}},{key:"isTenMillionsPlus",get:function(){return!!this.data&&this.data.totalBalance>=1e7}}]),t}();r.$inject=["$translate"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5194)),a=s(n(5195));function s(t){return t&&t.__esModule?t:{default:t}}n(5196);var r={template:i.default,controller:a.default,bindings:{category:"<",displayCurrencyForType:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-drawer-item"> <span class="c-drawer-item__title"> {{ $ctrl.title | translate }} <span ng-if="$ctrl.categoryCurrency"> {{ $ctrl.category.currency }}</span> </span> <span class="c-drawer-item__amount"> {{ $ctrl.category.amount | tngCurrency:$ctrl.category.currency}} </span> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.$translate=e}return(0,a.default)(t,[{key:"$onInit",value:function(){this.setTitle()}},{key:"setTitle",value:function(){this.title="global.accountType."+this.category.type}},{key:"categoryCurrency",get:function(){return this.displayCurrencyForType[this.category.currency]}}]),t}();r.$inject=["$translate"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5198)),a=s(n(5199));function s(t){return t&&t.__esModule?t:{default:t}}n(5200);var r={template:i.default,controller:a.default,bindings:{titleKey:"@",accounts:"<",aggregatedAccounts:"<",accountType:"<",accountGroup:"<",disableOpenAccount:"<",tsysServiceError:"<",ewmsServiceError:"<",isTileView:"<",usdRate:"<",onClickPendingAccount:"&?",pendingAccounts:"<?",isPendingAccountsLoading:"<?",isKycPending:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports=' <div ng-if="!$ctrl.isNative()" class="c-account-section c-account-section--tile-view" ng-class="{\'is-tile-view-selected\': $ctrl.isTileView}" lift-and-load-child account-section> <h2 class="c-account-section__title" ng-class="{ \'c-account-section__title--with-subtitle\': $ctrl.getSubtitleTransKey() }"> {{ $ctrl.titleKey | translate }} </h2> <h4 ng-if="$ctrl.getSubtitleTransKey() !== \'\' && !$ctrl.isGoalAccount()" class="c-account-section__subtitle" ng-class="" id="accountSection_account_subtitle_trans_key"> {{ $ctrl.getSubtitleTransKey() | translate }} </h4> <h4 ng-if="$ctrl.isGoalAccount() && $ctrl.getSubtitleTransKey() !== \'\' && $ctrl.showGoalMaxOutMsg()" class="c-account-section__subtitle"> {{ $ctrl.getSubtitleTransKey() | translate }} </h4> <div ng-if="$ctrl.isAggregatedAccount()"> <table class="aa-table-width"> <tr> <td><h4 class="sub-title"> {{ $ctrl.AccountAggregationService.getMostRecentLastUpdateDateSubtitle($ctrl.accounts) | translate }} </h4> </td> <td class="aa-edit-link"><a actionable-id="accountSection_accountAggrgation_edit" href="" class="btn-edit" ng-if="$ctrl.showAAEditBtn()" ng-click="$ctrl.editAggregatedAccount()">{{::\'global.components.buttons.edit\' | translate}} </a> </td> </tr> </table> </div> <tng-service-interruption ng-if="$ctrl.accountType === $ctrl.accountConstants.ACCOUNT_CATEGORIES.CHEQUING && $ctrl.tsysServiceError"> <p translate>{{ $ctrl.TSYSserviceErrorMsg }}</p> </tng-service-interruption> <tng-service-interruption ng-if="$ctrl.accountType === $ctrl.accountConstants.ACCOUNT_CATEGORIES.INVESTING && $ctrl.ewmsServiceError"> <p ng-bind-html="$ctrl.EWMSserviceError | translate"></p> </tng-service-interruption> <tng-service-interruption ng-if="$ctrl.accountType === $ctrl.accountConstants.ACCOUNT_CATEGORIES.MORTGAGE && $ctrl.mbsServiceError"> <p translate>{{ $ctrl.MBSserviceError }}</p> </tng-service-interruption> <div class="c-account-section__accounts grid__container"> <account-card id="accountSection_account_{{ account.display_name }}" class="c-account-section__grid-item" account="account" has-been-clicked-already="account === $ctrl.selectedAccount" is-tile-view="$ctrl.isTileView" ng-click="$ctrl.animateAndGoToDetails(account)" ng-repeat="account in $ctrl.accounts" ng-if="!$ctrl.isGoalAccount() && !$ctrl.isAggregatedAccount() && !$ctrl.isPendingAccountsLoading && !$ctrl.isKycPending"> </account-card> <account-card tng-warn-on-click-kyc-pending ng-if="!$ctrl.isPendingAccountsLoading && !$ctrl.isAggregatedAccount()" tng-mortgage-deal-id="{{ account.isMortgagePending ? account.dealId : null }}" id="accountSection_account_{{ account.display_name }}" class="c-account-section__grid-item" is-tile-view="$ctrl.isTileView" is-status-tile="true" ng-click="$ctrl.onClickPendingAccount({account})" ng-repeat="account in $ctrl.pendingAccounts" account="account" is-kyc-pending="$ctrl.isKycPending"> </account-card> <account-cards-loading ng-if="$ctrl.isPendingAccountsLoading" is-tile-view="$ctrl.isTileView"></account-cards-loading> <goal-card id="accountSection_account_{{ account.display_name }}" class="c-account-section__grid-item" account="account" has-been-clicked-already="account === $ctrl.selectedAccount" is-tile-view="$ctrl.isTileView" ng-click="$ctrl.animateAndGoToDetails(account)" ng-repeat="account in $ctrl.accounts" ng-if="$ctrl.isGoalAccount()"> </goal-card> <account-aggregation-card id="accountSection_account_{{ account.data }}" class="c-account-section__grid-item" account="account" is-tile-view="$ctrl.isTileView" ng-repeat="account in $ctrl.accounts" ng-if="$ctrl.isAggregatedAccount()"> </account-aggregation-card> <div class="c-account-section__grid-item" ng-if="!$ctrl.disableOpenAccount"> <div tng-warn-on-click-kyc-pending id="accountSection_addAccount_tileView" class="panel c-account-add" ui-sref="{{$ctrl.getOnboardingStateKey()}}({ addAccount: $ctrl.accountGroup })" ng-if="!$ctrl.isGoalAccount() && !$ctrl.isAggregatedAccount()"> <span class="icon-plus large"></span> <p class="c-account-add__add">{{ $ctrl.addAccountButton($ctrl.accountType) | translate }} </p> </div> <div id="accountSection_addAccount_tileView" class="panel c-account-add" ng-click="$ctrl.clickAddGoal()" ng-if="$ctrl.isGoalAccount() && $ctrl.isAddGoalAllowed()"> <span class="icon-plus large"></span> <p class="c-account-add__add">{{ $ctrl.addAccountButton($ctrl.accountType) | translate }} </p> </div> <div id="accountSection_addAccount_tileView" class="panel c-account-add" ng-click="$ctrl.clickAddAggregatedAccount()" ng-if="$ctrl.isAggregatedAccount()"> <span class="icon-plus large"></span> <p class="c-account-add__add">{{ $ctrl.addAccountButton($ctrl.accountType) | translate }} </p> </div> </div> </div> </div> <div class="c-account-section c-account-section--list-view" ng-class="{\'is-tile-view-selected\': $ctrl.isTileView}" lift-and-load-child> <div ng-if="$ctrl.isGoalAccount() && $ctrl.getSubtitleTransKey() !== \'\' && $ctrl.showGoalMaxOutMsg()" class="c-account-section__subtitle"> {{ $ctrl.getSubtitleTransKey() | translate }} </div> <div class="c-account-section__dropdownHeader"> <span class="c-account-section__title" ng-class="{ \'c-account-section__title--with-subtitle\': $ctrl.getSubtitleTransKey() }"> {{ $ctrl.titleKey | translate }} </span> <span class="c-account-section__section_header"> <a actionable-id="accountSection_accountAggrgation_edit" ng-if="$ctrl.isAggregatedAccount() && $ctrl.showAAEditBtn()" href="" class="c-account-section__link-edit" ng-click="$ctrl.editAggregatedAccount()">{{::\'global.components.buttons.edit\' | translate}} </a> <button ng-if="$ctrl.hasAccounts" class="c-account-section__dropdownToggle" ng-click="$ctrl.isExpanded = !$ctrl.isExpanded"> <span ng-class="$ctrl.isExpanded ? \'icon-uparrow\' : \'icon-downarrow\'"></span> </button> </span> </div> <div class="c-account-section__acct-aggreg-list-updated-date" ng-if="$ctrl.isAggregatedAccount()" class="sub-title"> {{ $ctrl.AccountAggregationService.getMostRecentLastUpdateDateSubtitle($ctrl.accounts) | translate }} </div> <div ng-if="$ctrl.hasAccounts && $ctrl.isExpanded" class="c-account-section__dropdown-content {{ ($ctrl.isExpanded) ? \'c-account-section__dropdownContent--expanded\' : \'c-account-section__dropdownContent--collapsed\'}}"> <account-card id="accountSection_account_{{ account.display_name }}" class="c-account-section__list-item" account="account" has-been-clicked-already="account === $ctrl.selectedAccount" is-tile-view="$ctrl.isTileView" ng-click="$ctrl.animateAndGoToDetails(account)" ng-repeat="account in $ctrl.accounts" ng-if="!$ctrl.isGoalAccount() && !$ctrl.isAggregatedAccount() && !$ctrl.isPendingAccountsLoading && !$ctrl.isKycPending"> </account-card> <goal-card id="accountSection_account_{{ account.display_name }}" class="c-account-section__list-item" account="account" has-been-clicked-already="account === $ctrl.selectedAccount" is-tile-view="$ctrl.isTileView" ng-click="$ctrl.animateAndGoToDetails(account)" ng-repeat="account in $ctrl.accounts" ng-if="$ctrl.isGoalAccount()"> </goal-card> <account-aggregation-card id="accountSection_account_{{ account.data }}" class="c-account-section__list-item" account="account" is-tile-view="$ctrl.isTileView" ng-repeat="account in $ctrl.accounts" ng-if="$ctrl.isAggregatedAccount()"> </account-aggregation-card> </div> <div> <account-card tng-warn-on-click-kyc-pending ng-if="!$ctrl.isPendingAccountsLoading" id="accountSection_account_{{ account.display_name }}" tng-mortgage-deal-id="{{ account.isMortgagePending ? account.dealId : null }}" class="c-account-section__list-item" is-tile-view="$ctrl.isTileView" is-status-tile="true" ng-click="$ctrl.onClickPendingAccount({account})" ng-repeat="account in $ctrl.pendingAccounts" account="account" has-been-clicked-already="account === $ctrl.selectedAccount" is-kyc-pending="$ctrl.isKycPending"> </account-card> <account-cards-loading ng-if="$ctrl.isPendingAccountsLoading" is-tile-view="$ctrl.isTileView"></account-cards-loading> </div> <div ng-if="$ctrl.hasAccounts && $ctrl.isExpanded" class="c-account-section__dropdown-content {{ ($ctrl.isExpanded) ? \'c-account-section__dropdownContent--expanded\' : \'c-account-section__dropdownContent--collapsed\'}}"> <div ng-if="![$ctrl.accountConstants.ACCOUNT_GROUPS.SPENDING, $ctrl.accountConstants.ACCOUNT_GROUPS.GOALS,\n                $ctrl.accountConstants.ACCOUNT_GROUPS.ACCOUNT_AGGREGATION].includes($ctrl.accountGroup)" class="c-account-section__total-section"> <div class="c-account-section__total-section__total"> {{ :: \'account.overview.total\' | translate }} </div> <div class="c-account-section__total-section__amount"> {{ $ctrl.getAccountSectionTotal($ctrl.accounts) }} </div> </div> </div> <div ng-if="(!$ctrl.hasAccounts || $ctrl.isGoalAccount() || $ctrl.isAggregatedAccount()) && !$ctrl.disableOpenAccount"> <div id="accountSection_addAccount_native" class="c-account-add" ui-sref="{{$ctrl.getOnboardingStateKey()}}({ addAccount: $ctrl.accountGroup })" tng-warn-on-click-kyc-pending ng-if="!$ctrl.isGoalAccount()  && !$ctrl.isAggregatedAccount()"> <span class="c-account-add__add">{{ $ctrl.addAccountButton($ctrl.accountType) | translate }} </span> <button class="c-account-add__addIcon icon-plus large"></button> </div> <div id="accountSection_addAccount_native" class="c-account-add" ng-click="$ctrl.clickAddGoal()" ng-if="$ctrl.isGoalAccount() && $ctrl.isAddGoalAllowed()"> <span class="c-account-add__add">{{ $ctrl.addAccountButton($ctrl.accountType) | translate }} </span> <button class="c-account-add__addIcon icon-plus large"></button> </div> <div id="accountSection_addAccount_native" class="c-account-add" ng-click="$ctrl.clickAddAggregatedAccount()" ng-if="$ctrl.isAggregatedAccount()"> <span class="c-account-add__add">{{ $ctrl.addAccountButton($ctrl.accountType) | translate }} </span> <button class="c-account-add__addIcon icon-plus large"></button> </div> </div> <div ng-if="$ctrl.getSubtitleTransKey() !== \'\' && !$ctrl.isGoalAccount()" class="c-account-section__subtitle"> {{ $ctrl.getSubtitleTransKey() | translate }} </div> </div> <div class="c-account-section c-account-section--print-view" ng-class="{\'is-tile-view-selected\': $ctrl.isTileView}" lift-and-load-child ng-if="!$ctrl.isNative()"> <div ng-if="$ctrl.isGoalAccount() && $ctrl.getSubtitleTransKey() !== \'\' && $ctrl.showGoalMaxOutMsg()" class="c-account-section__subtitle"> {{ $ctrl.getSubtitleTransKey() | translate }} </div> <div class="c-account-section__dropdownHeader"> <span class="c-account-section__title" ng-class="{ \'c-account-section__title--with-subtitle\': $ctrl.getSubtitleTransKey() }"> {{ $ctrl.titleKey | translate }} </span> <button ng-if="$ctrl.hasAccounts" class="c-account-section__dropdownToggle" ng-click="$ctrl.isExpanded = !$ctrl.isExpanded"> <span ng-class="$ctrl.isExpanded ? \'icon-uparrow\' : \'icon-downarrow\'"></span> </button> </div> <div ng-if="$ctrl.hasAccounts && $ctrl.isExpanded" class="c-account-section__dropdown-content {{ ($ctrl.isExpanded) ? \'c-account-section__dropdownContent--expanded\' : \'c-account-section__dropdownContent--collapsed\'}}"> <account-card id="accountSection_account_{{ account.display_name }}" class="c-account-section__list-item" account="account" has-been-clicked-already="account === $ctrl.selectedAccount" is-tile-view="$ctrl.isTileView" ng-click="$ctrl.animateAndGoToDetails(account)" ng-repeat="account in $ctrl.accounts" ng-if="!$ctrl.isGoalAccount() && !$ctrl.isPendingAccountsLoading && !$ctrl.isKycPending"> </account-card> <account-card tng-warn-on-click-kyc-pending ng-if="!$ctrl.isPendingAccountsLoading" id="accountSection_account_{{ account.display_name }}" class="c-account-section__list-item" is-tile-view="$ctrl.isTileView" is-status-tile="true" ng-click="$ctrl.onClickPendingAccount({account})" ng-repeat="account in $ctrl.pendingAccounts" account="account" has-been-clicked-already="account === $ctrl.selectedAccount"> </account-card> <account-cards-loading ng-if="$ctrl.isPendingAccountsLoading" is-tile-view="$ctrl.isTileView"></account-cards-loading> <goal-card id="accountSection_account_{{ account.display_name }}" class="c-account-section__list-item" account="account" has-been-clicked-already="account === $ctrl.selectedAccount" is-tile-view="$ctrl.isTileView" ng-click="$ctrl.animateAndGoToDetails(account)" ng-repeat="account in $ctrl.accounts" ng-if="$ctrl.isGoalAccount()"> </goal-card> <div ng-if="![$ctrl.accountConstants.ACCOUNT_GROUPS.SPENDING, $ctrl.accountConstants.ACCOUNT_GROUPS.GOALS].includes($ctrl.accountGroup)" class="c-account-section__total-section"> <div class="c-account-section__total-section__total"> {{ :: \'account.overview.total\' | translate }} </div> <div class="c-account-section__total-section__amount"> {{ $ctrl.getAccountSectionTotal($ctrl.accounts) }} </div> </div> </div> <div ng-if="(!$ctrl.hasAccounts || $ctrl.isGoalAccount() || $ctrl.isAggregatedAccount()) && !$ctrl.disableOpenAccount"> <div id="accountSection_addAccount_native" class="c-account-add" ui-sref="{{$ctrl.getOnboardingStateKey()}}({ addAccount: $ctrl.accountGroup })" ng-if="!$ctrl.isGoalAccount()"> <span class="c-account-add__add">{{ $ctrl.addAccountButton($ctrl.accountType) | translate }} </span> <button class="c-account-add__addIcon icon-plus large"></button> </div> <div id="accountSection_addAccount_native" class="c-account-add" ng-click="$ctrl.clickAddGoal()" ng-if="$ctrl.isGoalAccount() && $ctrl.isAddGoalAllowed()"> <span class="c-account-add__add">{{ $ctrl.addAccountButton($ctrl.accountType) | translate }} </span> <button class="c-account-add__addIcon icon-plus large"></button> </div> <div id="accountSection_addAccount_native" class="c-account-add" ng-click="$ctrl.clickAddAggregatedAccount()" ng-if="$ctrl.isAggregatedAccount()"> <span class="c-account-add__add">{{ $ctrl.addAccountButton($ctrl.accountType) | translate }} </span> <button class="c-account-add__addIcon icon-plus large"></button> </div> </div> <div ng-if="$ctrl.getSubtitleTransKey() !== \'\' && !$ctrl.isGoalAccount()" class="c-account-section__subtitle"> {{ $ctrl.getSubtitleTransKey() | translate }} </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(2)),s=r(n(45));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f,p,g,m,_,v){(0,i.default)(this,t),this.state=e,this.$log=n,this.stateConstants=a,this.accountConstants=s,this.SessionService=r,this.EnvironmentService=o,this.AccountHelpersService=c,this.$timeout=l,this.TimerService=u,this.DateService=d,this.AccountService=h,this.AccountDetailsService=f,this.GlobalModalsService=p,this.StepUpService=g,this.FinancialService=m,this.GoalsConstants=_,this.AccountAggregationService=v,this.isExpanded=!0,this.TSYSserviceErrorMsg="global.serviceInterruption.creditCardService",this.EWMSserviceError="global.serviceInterruption.investmentFund",this.MBSserviceError="global.serviceInterruption.mortgage"}return(0,a.default)(t,[{key:"goToDetails",value:function(t){var e=this.accountConstants,n=this.stateConstants,i=this.accountType;switch(t.goal_account&&i===e.ACCOUNT_TYPES.GOALS?e.ACCOUNT_TYPES.GOALS:t.type){case e.ACCOUNT_TYPES.CHEQUING:this.TimerService.startTimerForAction(this.TimerService.EVENTS.VIEW_CHEQUING_ACCOUNT),this._goTo(n.ACCOUNT_DETAILS_CHEQUING,t.number);break;case e.ACCOUNT_TYPES.CREDIT_CARD:this._goTo(n.ACCOUNT_DETAILS_CREDIT_CARD,t.number);break;case e.ACCOUNT_TYPES.SAVINGS:this.TimerService.startTimerForAction(this.TimerService.EVENTS.VIEW_SAVING_ACCOUNT),this._goTo(n.ACCOUNT_DETAILS_SAVINGS,t.number);break;case e.ACCOUNT_TYPES.MORTGAGE:this._goTo(n.ACCOUNT_DETAILS_MORTGAGE,t.number);break;case e.ACCOUNT_TYPES.LOAN:this._goTo(n.ACCOUNT_DETAILS_LOAN,t.number);break;case e.ACCOUNT_TYPES.MUTUAL_FUND:this.state.go(n.ACCOUNT_DETAILS_INVESTMENT,{accountHash:t.number});break;case e.ACCOUNT_TYPES.GOALS:this.TimerService.startTimerForAction(this.TimerService.EVENTS.VIEW_GOAL_ACCOUNT),-1!==[this.GoalsConstants.GOAL_ARCHETYPES.HOME_DOWNPAYMENT,this.GoalsConstants.GOAL_ARCHETYPES.RETIREMENT,this.GoalsConstants.GOAL_ARCHETYPES.DEBT_REPAYMENT].indexOf(t.goal_archetype)?this.state.go(this.stateConstants.GOAL_DETAILS,{lifeGoalId:t.life_goal_id}):this.state.go(this.stateConstants.ACCOUNT_DETAILS_GOALS,{accountHash:t.number,lifeGoalId:t.life_goal_id,accountGroup:this.accountGroup});break;default:this.$log.debug("Action: "+t.type+" not available yet"),this._goTo(n.COMING_SOON)}}},{key:"animateAndGoToDetails",value:function(t){var e=this;this.AccountService.isCreditCard(t)&&this.DateService.isToday(!!t.date_opened&&t.date_opened)||(t.isRspLoanPostApproval?this.state.go(this.stateConstants.EXISTING_CLIENT_ONBOARDING,{rspLoan:{dealId:t.dealId,postApproval:!0,application:!1}}):(this.selectedAccount=t,this.$timeout((function(){t.type===e.accountConstants.ACCOUNT_TYPES.CHEQUING?e.TimerService.startTimerForAction(e.TimerService.EVENTS.VIEW_CHEQUING_ACCOUNT):t.type===e.accountConstants.ACCOUNT_TYPES.SAVINGS?e.TimerService.startTimerForAction(e.TimerService.EVENTS.VIEW_SAVING_ACCOUNT):t.type===e.accountConstants.ACCOUNT_TYPES.GOALS&&e.TimerService.startTimerForAction(e.TimerService.EVENTS.VIEW_GOAL_ACCOUNT),e.goToDetails(t)}),200)))}},{key:"getOnboardingStateKey",value:function(){return this.stateConstants.EXISTING_CLIENT_ONBOARDING}},{key:"_goTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.state.go(t,{accountHash:e})}},{key:"addAccountButton",value:function(t){return"account.overview.addAccountButtons."+t}},{key:"getSubtitleTransKey",value:function(){switch(this.accountType){case this.accountConstants.ACCOUNT_CATEGORIES.INVESTING:return"account.overview.accountSection.subtitle.investing";case this.accountConstants.ACCOUNT_CATEGORIES.GOALS:return"account.overview.goalsSection.maxOutText";default:return""}}},{key:"isNative",value:function(){return this.EnvironmentService.isNative()}},{key:"getAccountSectionTotal",value:function(t){var e=this,n=0;if(!t||t.length<=0)return 0;var i=this.accountConstants.CURRENCY_TYPES.CAD;return this.accountGroup===this.accountConstants.ACCOUNT_GROUPS.GOALS?t.forEach((function(t){t.goalData&&t.goalData.archetype&&-1!==[e.GoalsConstants.GOAL_ARCHETYPES.HOME_DOWNPAYMENT,e.GoalsConstants.GOAL_ARCHETYPES.RETIREMENT].indexOf(t.goalData.archetype)?n+=e._getRetirementGoalBalance(t):n+=t.account_balance||t.goal_current_balance||0})):t.forEach((function(t){t.currency_type===e.accountConstants.CURRENCY_TYPES.USD?n+=t.account_balance*e.usdRate:n+=t.account_balance})),this.AccountHelpersService.getAmountDisplay(n,i)}},{key:"isGoalAccount",value:function(){return this.accountType===this.AccountDetailsService.getGoalsAccountType()}},{key:"isAggregatedAccount",value:function(){return this.accountType===this.AccountDetailsService.getAggregatedAccountType()}},{key:"isAddGoalAllowed",value:function(){return!this.showGoalMaxOutMsg()&&this.accounts&&!this.accounts.service_error}},{key:"showGoalMaxOutMsg",value:function(){var t=this;return this.accounts&&this.accounts.filter((function(e){return e.type===t.accountConstants.ACCOUNT_TYPES.GOALS})).length>=this.accountConstants.TGSA_LIMIT}},{key:"showAAEditBtn",value:function(){return this.accounts&&this.accounts.length>0}},{key:"editAggregatedAccount",value:function(){this.AccountAggregationService.editAggregatedAccount(this.accounts,this.aggregatedAccounts,this.AccountAggregationService.sources.ACCOUNT_SUMMARY)}},{key:"clickAddGoal",value:function(){var t=this;this.isAddGoalAllowed()&&this.StepUpService.requestLevel2().then((function(){t.GlobalModalsService.showGoalModal()}))}},{key:"clickAddAggregatedAccount",value:function(){this.AccountAggregationService.addAggregatedAccount(this.accounts,this.AccountAggregationService.sources.ACCOUNT_SUMMARY)}},{key:"_getRetirementGoalBalance",value:function(t){var e=t.goalData.currentAmount;if(t.goalData.goalExtendedData.externalCurrentSavings){var n=t.goalData.goalExtendedData.externalCurrentSavings||0,i=t.goalData.goalExtendedData.externalMonthlySavings||0;if(n||i){var a=(0,s.default)(new Date),r=(0,s.default)(t.goalData.contributionStartDate),o=Math.floor(s.default.duration(a.diff(r)).asMonths());o=o<0?0:o;var c=this.FinancialService.calculateMonthlyInterest(t.goalData.goalExtendedData.interestRate);e+=this.FinancialService.calculateSavingsTillRetirement(n,i,c,o)}}return e}},{key:"hasAccounts",get:function(){return this.accounts&&this.accounts.length>0}}]),t}();o.$inject=["$state","$log","stateConstants","accountConstants","SessionService","EnvironmentService","AccountHelpersService","$timeout","TimerService","DateService","AccountService","AccountDetailsService","GlobalModalsService","StepUpService","FinancialService","GoalsConstants","AccountAggregationService"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5202)),a=s(n(5203));function s(t){return t&&t.__esModule?t:{default:t}}n(5204);var r={template:i.default,controller:a.default,bindings:{usdRate:"<",accountSelectSubject:"<?",accountUpdateObservable$:"<?",isKycPending:"<",allowAggregationAccounts:"<?",isClientBusiness:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div> <tng-category-tabs ng-class="{\'business-client\': $ctrl.isClientBusiness}" tabs="$ctrl.ACCOUNT_LIST" subject="$ctrl.AccountTabListService.selectedAccountTabsSubject$()"> </tng-category-tabs> <div id="category-{{$ctrl.currentTab.toLowerCase()}}-empty-state" class="account-list-tile account-empty-state account-list-no-top-border" ng-if="$ctrl.accountsMap.showEmptyState" ng-bind-html="$ctrl.trustAsHtml($ctrl.accountsMap.emptyState)"></div> <div id="{{ category.id }}_tab" ng-if="!$ctrl.accountsMap.showEmptyState" ng-repeat="category in $ctrl.accountsMap track by $index"> <div ng-if="!(category.accounts.length === 0)" id="{{category.name.toLowerCase()}}-accounts-heading" class="account-list-category-heading"> <div class="account-list-category-heading-title"> <div class="account-list-category-heading-title-text three-quarters-width"> {{ category.title | translate }} <span ng-if="(category.name === $ctrl.ACCOUNT_SUBCATEGORIES.VIEW_ONLY) && !category.emptyState" class="account-list-category-heading-extra-info"> {{ $ctrl.AccountAggregationService.getMostRecentLastUpdateDateSubtitle($ctrl.aggregationAccounts) | translate }} </span> </div> <div ng-if="category.maturityDate" class="account-list-category-heading-title-text account-list-smaller-font"> {{ category.maturityDate | translate }} </div> <div ng-if="category.links && !category.emptyState" class="account-list-category-heading-links-wrapper"> <span class="account-list-category-heading-link" ng-repeat="link in category.links track by $index"> <button id="account-list-category-heading-link-{{ link.name.toLowerCase() }}" class="btn--edit btn--large btn--auto manage-accounts-button" ng-click="link.action()"> {{ link.translation | translate }} </button> </span> </div> </div> </div> <div ng-if="category.headingText && !category.emptyState" class="account-list-category-heading-description" ng-bind-html="category.headingText | translate"></div> <div class="account-list-tile"> <div ng-if="category.emptyState" class="account-list-tile-row"> <div class="account-list-tile-name" translate="{{ category.emptyState }}"> </div> </div> <div id="{{category.name.toLowerCase()}}-account-{{$index}}" ng-repeat="account in category.accounts track by $index" class="account-list-tile-row" ng-if="!$ctrl.isKycPending || account.isPendingAccount" ng-class="{ \'clickable-row\' : $ctrl.isAccountClickable(account, category)}" ng-click="!$ctrl.isAccountClickable(account, category) || $ctrl.onAccountClick({account, category: $ctrl.getAccountCategory($ctrl.currentTab, category.name)})"> <div class="account-list-tile-name three-quarters-width"> <span ng-if="account.logo" class="account-logo"> <img ng-src="data:image/png;base64,{{ account.logo }}"/> </span> <span class="account-tile-nickname" id="{{category.name.toLowerCase()}}-account-{{$index}}-name"> {{ account.accountName }} </span> <span ng-if="account.isRelogin" class="account-tile-number-error" id="{{category.name.toLowerCase()}}-account-{{$index}}-number" ng-bind-html="$ctrl.errorTextRelogin"> </span> <span ng-if="!account.isRelogin" class="account-tile-number" id="{{category.name.toLowerCase()}}-account-{{$index}}-number"> {{ account.display_name | maskNumber }} <span id="{{category.name.toLowerCase()}}-account-{{$index}}-description"> {{ (account.description ? \' | \' : \'\') }} {{ account.description }} </span> </span> <span ng-if="account.showGoalTag" class="account-tile-goal-badge" id="{{category.name.toLowerCase()}}-account-{{$index}}-goal-badge"> <span>{{ account.goalLabel | translate }}</span> </span> </div> <div ng-if="!account.isPendingAccount && account.maturityDate && category.maturityDate" class="account-list-tile-maturity-date" id="{{category.name.toLowerCase()}}-account-{{$index}}-maturity-date"> {{ account.maturityDate | date:\'mediumDate\' }} </div> <div ng-if="!account.isPendingAccount && account.account_balance !== undefined && !account.isRelogin" class="account-list-tile-balance" id="{{category.name.toLowerCase()}}-account-{{$index}}-balance"> {{ account.account_balance | tngCurrency:account.currency_type }} </div> <div ng-if="account.isPendingAccount && account.status && !account.webstatus" class="account-list-tile-balance" id="{{category.name.toLowerCase()}}-account-{{$index}}-pending-status"> {{ ::\'pendingApplications.status.T2033.PENDING\' | blankIfNotFoundTranslate }} </div> <div ng-if="account.isPendingAccount && account.webstatus" class="account-list-tile-balance" id="{{category.name.toLowerCase()}}-account-{{$index}}-pending-status"> {{ ::\'pendingApplications.status.\' + account.accountType + \'.\' + account.webstatus | blankIfNotFoundTranslate }} </div> </div> <div ng-if="category.showTotalBalance" class="account-list-tile-row account-list-border-top" id="{{category.name.toLowerCase()}}-accounts-total"> <div class="account-list-tile-total-label" id="{{category.name.toLowerCase()}}-accounts-total-balance-label" ng-bind-html="\'account.overview.categories.\' + category.name + \'.total\' | translate"></div> <div class="account-list-tile-total-balance" id="{{category.name.toLowerCase()}}-accounts-total-balance"> {{ category.totalBalance }} </div> </div> </div> </div> <div ng-if="$ctrl.accountsMap.total" class="account-list-tile"> <div class="account-list-tile-row"> <div class="account-list-tile-total-label" id="tab-total-accounts-total-balance-label"> {{ $ctrl.accountsMap.totalTranslation | translate }} </div> <div class="account-list-tile-total-balance" id="tab-total-accounts-total-balance"> {{ $ctrl.accountsMap.total }} </div> </div> </div> <div class="account-list-button-tile"> <div ng-if="$ctrl.accountsMap.openAccount || $ctrl.accountsMap.statements" class="account-list-tile-row"> <div class="account-list-tile-total-balance" id="tab-total-accounts-open-account"> <button title="{{ $ctrl.accountsMap.openAccount.title | translate }}" ng-if="$ctrl.accountsMap.openAccount" actionable-id="accountSummary_accountListAddAccount-{{ $ctrl.accountsMap.name }}" id="accountSummary_accountListAddAccount-{{ $ctrl.accountsMap.name }}" class="btn btn--orange btn--large btn--auto btn--add-account account-list-tile-footer-button" tng-warn-on-click-kyc-pending ui-sref="{{ $ctrl.accountsMap.openAccount.sref }}($ctrl.accountsMap.openAccount.srefParam)" translate="{{ $ctrl.accountsMap.openAccount.title }}"> </button> <button ng-if="$ctrl.accountsMap.statements" title="{{ $ctrl.accountsMap.statements.title | translate }}" actionable-id="accountSummary_accountListStatements-{{ $ctrl.accountsMap.name }}" id="accountSummary_accountListStatements-{{ $ctrl.accountsMap.name }}" class="btn btn--edit btn--large btn--auto account-list-tile-footer-button" ng-click="$ctrl.accountsMap.statements.action()" tng-warn-on-click-kyc-pending translate="{{ $ctrl.accountsMap.statements.name }}"> </button> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(33)),a=l(n(15)),s=l(n(0)),r=l(n(2)),o=l(n(535)),c=n(1802);function l(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(e,n,i,a,r,o,c,l,u,d,h,f,p,g){(0,s.default)(this,t),this.$log=e,this.$scope=n,this.$state=g,this.accountConstants=i,this.stateConstants=r,this.DATA_INVALIDATED=a.DATA_INVALIDATED,this.ROOT_ENDPOINTS=a.ROOT_ENDPOINTS,this.AccountHelpersService=o,this.AccountTabListService=c,this.AccountAggregationService=l,this.EventBusService=u,this.$filter=d,this.$sce=h,this.$translate=f,this.$location=p,this.ACCOUNT_LIST=this.accountConstants.ACCOUNT_LIST,this.ACCOUNT_SUBCATEGORY_CONFIG=this.accountConstants.ACCOUNT_SUBCATEGORY_CONFIG,this.ACCOUNT_CATEGORY_CONFIG=this.accountConstants.ACCOUNT_CATEGORY_CONFIG,this.ACCOUNT_CATEGORIES=i.ACCOUNT_CATEGORIES,this.PRODUCT_SUBCATEGORY_MAP=i.PRODUCT_SUBCATEGORY_MAP,this.ACCOUNT_SUBCATEGORIES=i.ACCOUNT_SUBCATEGORIES,this.ACCOUNT_MAPING_FUNCTIONS=i.ACCOUNT_MAPING_FUNCTIONS,this.LINK_ACTION_FUNCTIONS=i.LINK_ACTION_FUNCTIONS,this.ACCOUNT_LIST_COMPARATORS=i.ACCOUNT_LIST_COMPARATORS,this.GROUP_TITLE="account.overview.accountSection",this.GOAL_TRANSLATION="account.overview.goals",this.GOAL_LABEL="_LABEL",this.EXTRA_NOTE="EXTRA_NOTE",this.ALL_AGGREGATED_ACCOUNTS=this.accountConstants.AGGREGATION_ACCOUNT_CONSTANTS.ALL_AGGREGATED_ACCOUNTS,this.AGGREGATION_ACCOUNTS=this.accountConstants.AGGREGATION_ACCOUNT_CONSTANTS.AGGREGATION_ACCOUNTS,this.populateFunctionsMaps()}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;this.allowAggregationAccounts=!!this.allowAggregationAccounts,this.resetTabAccounts(),this.selectedTabsSubscription=this.AccountTabListService.selectedAccountTabsSubject$().subscribe(this._observer.bind(this)),this.accountUpdateObservable$&&(this.accountUpdateSubscription=this.accountUpdateObservable$.pipe((0,c.filter)((function(e){return t.allowAggregationAccounts||e.type!==t.AGGREGATION_ACCOUNTS}))).subscribe(this._accountUpdateObserver.bind(this))),this.EventBusService.subscribe(this.$scope,this.DATA_INVALIDATED,(function(e,n){n===t.ROOT_ENDPOINTS.ACCOUNTS&&t.resetTabAccounts()}))}},{key:"$onChanges",value:function(t){t.isClientBusiness&&(this.ACCOUNT_LIST=t.isClientBusiness.currentValue?this.accountConstants.BUSINESS_ACCOUNT_LIST:this.accountConstants.ACCOUNT_LIST)}},{key:"_observer",value:function(t){var e=this;if(t){var n=this.ACCOUNT_LIST[t],i=n.TOTAL,a=n.SUBCATEGORIES&&n.SUBCATEGORIES.length;this.currentTab=t;var s=n.EMPTY_STATE,r=this.EXTRA_NOTE in n||n.EXTRA_NOTE,c=n.STATEMENTS;if(a){var l=n.SUBCATEGORIES;this.allowAggregationAccounts||(l=l.filter((function(t){return t!==e.ACCOUNT_SUBCATEGORIES.VIEW_ONLY}))),this.accountsMap=l.map((function(t){var i=e.ACCOUNT_SUBCATEGORY_CONFIG[t],a=e.getAccountMapper(i.accountMapper),s=e.getAccountComparator(i.accountSort),r=i.headingLinks&&i.headingLinks.map((function(t){var n=e.getAccountLinkAction(t.action);return{name:t.name,translation:t.translation,action:n&&n.bind(e)}})),o=(e.tabAccounts[n.ACCOUNTS]||[]).filter((function(n){return n.isPendingAccount?t===e.accountConstants.ACCOUNT_SUBCATEGORIES.PENDING:a.bind(e)(n)===t&&!e.isKycPending})),c=i.showTotal,l=0===o.length;return s&&o.sort(s.bind(e)),{id:i.id||t,name:t,title:e.GROUP_TITLE+"."+t.toLowerCase(),accounts:o,headingText:i.headingText,emptyState:l&&i.emptyState,showTotalBalance:c,totalBalance:c&&e.getAccountCategoryTotal(o),readOnly:i.readOnly,maturityDate:i.maturityDate,links:r}}))}else this.accountsMap=(0,o.default)([n.ACCOUNTS]).map((function(t){var n=e.ACCOUNT_CATEGORY_CONFIG[t],i=e.tabAccounts[t]||[],a=n.showTotal&&!(1===i.length&&i.hasPendingAccounts);return{id:n.id||t,name:t,title:e.GROUP_TITLE+"."+t.toLowerCase(),accounts:i,showTotalBalance:a,totalBalance:a&&e.getAccountCategoryTotal(i),readOnly:n.readOnly}})).filter((function(t){return t.accounts&&t.accounts.length}));this.errorTextRelogin="",this.currentTab===this.ACCOUNT_CATEGORIES.EXTERNAL?this.errorTextRelogin=this.$translate.instant("account.overview.accountaggregation.errorlinkTabExternal"):this.errorTextRelogin=this.$translate.instant("account.overview.accountaggregation.errorlinkTabAll");var u=(0,o.default)(this.accountsMap.map((function(t){return t.accounts})));this.accountsMap.name=n.NAME,this.accountsMap.extraNote=r,this.accountsMap.showEmptyState=s&&0===u.length,this.accountsMap.emptyState=s,i&&!this.accountsMap.showEmptyState&&(this.accountsMap.total=this.getAccountCategoryTotal(u),this.accountsMap.totalTranslation="account.overview.categories."+n.NAME+".total"),this.accountsMap.openAccount=n.OPEN_ACCOUNT,c&&(this.accountsMap.statements={name:c.title,title:c.title,action:this.getAccountLinkAction(c.action).bind(this)})}}},{key:"_accountUpdateObserver",value:function(t){var e=this,n=t.accounts,i=void 0===n?[]:n,s=t.type,r=void 0===s?"":s,o=t.id,c=void 0===o?0:o;""!==r&&(this[r]=i),(0,a.default)(this.tabAccounts).forEach((function(t){e.tabAccounts[t]=e.tabAccounts[t].filter((function(t){return t.listId!==c}))})),r!==this.ALL_AGGREGATED_ACCOUNTS&&(i.forEach((function(t){var n=t.type,i=e.accountConstants.ACCOUNT_MAPS[n];i&&(t.listId=c,t.accountName=t.accountName||e.AccountHelpersService.getDisplayNameInstant(t),t.showGoalTag=t.goal_account&&t.life_goal_id,t.goalLabel=t.goal_archetype&&e.GOAL_TRANSLATION+"."+t.goal_archetype+e.GOAL_LABEL,e.tabAccounts[i].push(t),e.tabAccounts[i].hasPendingAccounts=!!t.isPendingAccount,e.AccountHelpersService.isAccountGreyOut(t)&&(t.readOnly=!0))})),this._observer(this.currentTab))}},{key:"getAccountCategoryTotal",value:function(t){var e=this,n=0,i=this.accountConstants.CURRENCY_TYPES,a=i.CAD;return!t||t.length<=0?this.AccountHelpersService.getAmountDisplay(0,a):(t.forEach((function(t){t.isPendingAccount||(t.currency_type===i.USD?n+=t.account_balance*e.usdRate:n+=t.account_balance)})),this.AccountHelpersService.getAmountDisplay(n,a))}},{key:"onAccountClick",value:function(t){this.accountSelectSubject&&this.accountSelectSubject.next&&this.accountSelectSubject.next(t)}},{key:"trustAsHtml",value:function(t){return this.$sce.trustAsHtml(this.$translate.instant(t))}},{key:"resetTabAccounts",value:function(){var t;this.tabAccounts=(t={},(0,i.default)(t,this.ACCOUNT_CATEGORIES.SPENDING,[]),(0,i.default)(t,this.ACCOUNT_CATEGORIES.SAVING,[]),(0,i.default)(t,this.ACCOUNT_CATEGORIES.INVESTING,[]),(0,i.default)(t,this.ACCOUNT_CATEGORIES.BORROWING,[]),(0,i.default)(t,this.ACCOUNT_CATEGORIES.GOALS,[]),(0,i.default)(t,this.ACCOUNT_CATEGORIES.EXTERNAL,[]),t)}},{key:"$onDestroy",value:function(){this.selectedTabsSubscription.unsubscribe(),this.accountUpdateSubscription&&this.accountUpdateSubscription.unsubscribe(),this.resetTabAccounts()}},{key:"getAccountMapper",value:function(t){return this.ACCOUNT_SUMMARY_LIST_MAPPERS[t]}},{key:"getAccountComparator",value:function(t){return this.ACCOUNT_SUMMARY_COMPARATORS[t]}},{key:"getAccountLinkAction",value:function(t){return this.ACCOUNT_SUMMARY_LINK_ACTIONS[t]}},{key:"populateFunctionsMaps",value:function(){var t,e;this.ACCOUNT_SUMMARY_LIST_MAPPERS=(t={},(0,i.default)(t,this.ACCOUNT_MAPING_FUNCTIONS.BY_PRODUCT_CODE,this.byProductCode),(0,i.default)(t,this.ACCOUNT_MAPING_FUNCTIONS.BY_SUBCATEGORY_NAME,this.bySubcategoryFlagName),t),this.ACCOUNT_SUMMARY_LINK_ACTIONS=(e={},(0,i.default)(e,this.LINK_ACTION_FUNCTIONS.EDIT,this.edit),(0,i.default)(e,this.LINK_ACTION_FUNCTIONS.ADD,this.add),(0,i.default)(e,this.LINK_ACTION_FUNCTIONS.MANAGE,this.manage),(0,i.default)(e,this.LINK_ACTION_FUNCTIONS.STATEMENTS,this.statements),e),this.ACCOUNT_SUMMARY_COMPARATORS=(0,i.default)({},this.ACCOUNT_LIST_COMPARATORS.MATURITY_DATE,this.compareByMaturityDate)}},{key:"compareByMaturityDate",value:function(t,e){return Date.parse(t.maturityDate)-Date.parse(e.maturityDate)}},{key:"byProductCode",value:function(t){return this.PRODUCT_SUBCATEGORY_MAP[t.product_code]||this.ACCOUNT_SUBCATEGORIES.OTHERS}},{key:"bySubcategoryFlagName",value:function(t){if(t.subCategoryName)return this.ACCOUNT_SUBCATEGORIES[t.subCategoryName.toUpperCase()]||this.ACCOUNT_SUBCATEGORIES.OTHERS}},{key:"edit",value:function(){return this.AccountAggregationService.editAggregatedAccount(this.aggregationAccounts,this.allAggregatedAccounts)}},{key:"add",value:function(){return this.AccountAggregationService.addAggregatedAccount(this.aggregationAccounts)}},{key:"manage",value:function(){this.$location.path("/settings/external-accounts")}},{key:"statements",value:function(){this.$state.go(this.stateConstants.ACCOUNT_DOCUMENTS_STATEMENTS)}},{key:"isAccountClickable",value:function(t,e){return!e.readOnly&&!t.readOnly}},{key:"getAccountCategory",value:function(t,e){return t===this.accountConstants.ACCOUNT_TYPES.ALL?e:t}}]),t}();u.$inject=["$log","$scope","accountConstants","serviceConstants","stateConstants","AccountHelpersService","AccountTabListService","AccountAggregationService","EventBusService","$filter","$sce","$translate","$location","$state"],e.default=u,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5206)),a=s(n(5207));function s(t){return t&&t.__esModule?t:{default:t}}n(5208);var r={template:i.default,controller:a.default,bindings:{accountSelectSubject:"<?",accountUpdateSubject$:"<?",capabilitiesChangeSubject$:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div> <tng-category-tabs tabs="$ctrl.PROGRESS_LIST" register="$ctrl.onTabsReady()" subject="$ctrl.AccountTabListService.selectedProgressTabsSubject$()"> </tng-category-tabs> <div id="progress-summary-service_errors" ng-show="$ctrl.serviceErrors.length"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.serviceErrors track by $index">{{ error | translate }}</li> </ul> </tng-error-message> </div> <div class="progress-summary-goals-container" ng-show="$ctrl.PROGRESS_TABS.GOALS === $ctrl.selectedTab && $ctrl.accountsMap[$ctrl.selectedTab].data.length && !$ctrl.loading"> <goal-card id="accountSection_account_{{ dataItem.display_name }}" class="c-account-section__grid-item" account="dataItem" has-been-clicked-already="false" is-tile-view="true" ng-click="$ctrl.onAccountClick(dataItem, $ctrl.ACCOUNT_CATEGORIES.GOALS)" ng-repeat="dataItem in $ctrl.accountsMap[$ctrl.selectedTab].data"> </goal-card> </div> <div class="progress-summary-empty-state" ng-if="!$ctrl.accountsMap[$ctrl.selectedTab].data.length && !$ctrl.loading && !$ctrl.serviceErrors.length"> <div> {{ $ctrl.emptyState | translate }} </div> <div class="progress-button-tile-empty-state" ng-show="$ctrl.emptyStateButtons.length"> <div class="progress-row"> <div class="progress-button-cell-empty-state"> <button ng-repeat="button in $ctrl.emptyStateButtons" title="{{ button.translation | translate }}" actionable-id="{{ button.id }}" id="{{ button.id }}" class="{{ button.class }}" ng-click="button.action()"> {{ button.translation | translate }} </button> </div> </div> </div> </div> <div class="progress-table" ng-show="$ctrl.PROGRESS_TABS.ASP === $ctrl.selectedTab && $ctrl.accountsMap[$ctrl.selectedTab].data.length && !$ctrl.loading"> <div class="progress-heading-row"> <div class="progress-cell progress-heading-cell"> {{ ::\'transactions.aspSubHeader.scheduledDate\' | translate }} </div> <div class="progress-cell progress-heading-cell"> {{ ::\'transactions.aspSubHeader.destination\' | translate }} </div> <div class="progress-cell progress-heading-cell progress-right-aligned"> {{ ::\'transactions.aspSubHeader.amount\' | translate }} </div> </div> <div class="progress-row clickable-progress-row" ng-repeat="dataItem in $ctrl.accountsMap[$ctrl.selectedTab].data" ng-click="$ctrl.onAccountClick(dataItem)"> <div class="progress-cell progress-asp-cell"> <div>{{ dataItem.scheduledDate | date: \'longDate\' }}</div> <div class="progress-asp-details"> {{ dataItem.frequencyType | translate}} </div> </div> <div class="progress-cell progress-asp-cell"> <div> {{ dataItem.toAccountType }} <span class="progress-asp-to-account-name"> {{ dataItem.toAccountNumber }} </span> </div> <div class="progress-asp-details"> {{ \'transactions.pendingTransactionsList.from\' | translate }} {{ dataItem.fromAccountName }} </div> </div> <div class="progress-cell progress-asp-cell progress-asp-amount progress-right-aligned"> {{ dataItem.amount | currency }} </div> </div> </div> <div class="progress-table" ng-show="$ctrl.PROGRESS_TABS.RECIPES === $ctrl.selectedTab && $ctrl.accountsMap[$ctrl.selectedTab].data.length && !$ctrl.loading"> <div class="progress-heading-row"> <div class="progress-cell progress-heading-cell"> {{ ::\'financialPlan.assetsState.assetType\' | translate }} </div> <div class="progress-cell progress-heading-cell"> </div> <div class="progress-cell progress-heading-cell"> {{ ::\'transactions.recipeSubHeader.description\' | translate }} </div> </div> <div class="progress-row clickable-progress-row" ng-repeat="dataItem in $ctrl.accountsMap[$ctrl.selectedTab].data" ng-click="$ctrl.onAccountClick(dataItem)"> <div class="progress-cell progress-recipe-cell"> <span id="category-icon-heart-tab-icon" class="progress-recipe-icon category-icon {{ $ctrl.recipesConstants.RecipesConstants.AVAILABLE_RECIPES[dataItem.recipe_type].icon | translate }}"></span> </div> <div class="progress-cell progress-recipe-type-cell"> <div class="progress-recipe-type"> {{ $ctrl.recipesConstants.RecipesConstants.AVAILABLE_RECIPES[dataItem.recipe_type].title | translate }} </div> </div> <div class="progress-cell progress-recipe-cell"> <span class="progress-destination-text-wrap" ng-bind-html="dataItem.destination"></span> </div> </div> </div> <div class="progress-button-tile" ng-show="$ctrl.footerButtons.length && !$ctrl.loading && !$ctrl.serviceErrors.length"> <div class="progress-row"> <div class="progress-button-cell"> <button ng-repeat="button in $ctrl.footerButtons" title="{{ button.translation | translate }}" actionable-id="{{ button.id }}" id="{{ button.id }}" class="{{ button.class }}" ng-click="button.action()"> {{ button.translation | translate }} </button> </div> </div> </div> <div ng-if="$ctrl.loading" class="c-loading-spinner-container"> <tng-loading-spinner> <p>{{ ::\'global.commonWords.loading\' | translate }}</p> </tng-loading-spinner> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(269)),a=d(n(33)),s=d(n(92)),r=d(n(8)),o=d(n(68)),c=d(n(0)),l=d(n(2)),u=d(n(116));function d(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(e,n,i,a,s,r,l,u,d,h,f,p,g,m,_,v){(0,c.default)(this,t),this.$log=e,this.$scope=d,this.accountConstants=n,this.stateConstants=i,this.AccountTabListService=a,this.EventBusService=_,this.$translate=m,this.PendingTransactionsTitleFormatter=g,this.AccountSummaryService=f,this.RecipesService=p,this.StepUpService=s,this.GlobalModalsService=r,this.recipesConstants=l,this.eventConstants=v,this.$state=u,this.$q=h,this.LINK_ACTION_FUNCTIONS=this.accountConstants.LINK_ACTION_FUNCTIONS,this.ELIGIBILITY_FUNCTIONS=this.accountConstants.ELIGIBILITY_FUNCTIONS,this.DATA_RETRIEVAL_FUNCTIONS=this.accountConstants.DATA_RETRIEVAL_FUNCTIONS,this.PROGRESS_TABS=this.accountConstants.PROGRESS_TABS,this.ACCOUNT_CATEGORIES=n.ACCOUNT_CATEGORIES,this.RECIPES_STATUSES=l.RECIPES_STATUSES,this.PROGRESS_TAB_DATA_CHANGE=this.eventConstants.PROGRESS_TAB_DATA_CHANGE,this.serviceErrors=[],this.PROGRESS_LIST=[].concat((0,o.default)(this.accountConstants.PROGRESS_LIST))}return(0,l.default)(t,[{key:"$onInit",value:function(){var t=this;this.populateFunctionsMaps(),this.selectedProgressTabsSubject$=this.AccountTabListService.selectedProgressTabsSubject$(),this.selectedTabsSubscription=this.selectedProgressTabsSubject$.subscribe(this._observer.bind(this)),this.accountUpdateSubject$&&(this.accountUpdateSubscription=this.accountUpdateSubject$.subscribe(this._accountUpdateObserver.bind(this))),this.resetAccountsMap(),this.EventBusService.subscribe(this.$scope,this.PROGRESS_TAB_DATA_CHANGE,(function(e,n){return t._onProgressTabDataUpdate(n)})),this.capabilitiesChangeSubject$&&(this.capabilitiesChangeSubscription=this.capabilitiesChangeSubject$.subscribe(this._onCapabilityUpdate.bind(this)))}},{key:"onTabsReady",value:function(){this._selectFirstAvailableTab()}},{key:"_onCapabilityUpdate",value:function(t){(0,r.default)(this,t),this._runEligibilityFilters()}},{key:"_runEligibilityFilters",value:function(){var t=this;this.PROGRESS_LIST=this.PROGRESS_LIST.filter((function(e){var n=t.ELIGIBILITY_FILTERS[e.eligibilityLogic];return!n||n.bind(t)()})),this.selectedTab&&this.PROGRESS_LIST.find((function(e){return e.NAME===t.selectedTab}))||this._selectFirstAvailableTab()}},{key:"_selectFirstAvailableTab",value:function(){this.PROGRESS_LIST.length&&this.selectedProgressTabsSubject$.next(this.PROGRESS_LIST[0].NAME)}},{key:"_onProgressTabDataUpdate",value:function(t){t&&this.selectedTab===t&&this.selectedProgressTabsSubject$.next(t)}},{key:"resetAccountsMap",value:function(){this.accountsMap={}}},{key:"_observer",value:function(t){var e=this;if(!t)return this.$q.resolve(!1);this.selectedTab=t,this.footerButtons=this._retrieveFooterButtons(),this.emptyState=(0,u.default)(this.accountConstants,"PROGRESS_TABS_CONFIG."+this.selectedTab+".emptyState");var n=(0,u.default)(this.accountConstants,"PROGRESS_TABS_CONFIG."+this.selectedTab+".lazy");if(this.emptyStateButtons=this._retrieveEmptyStateButtons(),n){var i=(0,u.default)(this.accountConstants,"PROGRESS_TABS_CONFIG."+this.selectedTab+".dataKey");return this.loading=!0,this.serviceErrors=[],this.DATA_RETRIEVAL_FUNCTIONS[i].bind(this)().then((function(t){e.accountUpdateSubject$.next(t)})).catch((function(t){e._showServiceErrors(t)})).finally((function(){e.loading=!1}))}return this.$q.resolve(this.accountsMap&&this.accountsMap[this.selectedTab])}},{key:"_accountUpdateObserver",value:function(t){var e=t.data,n=void 0===e?[]:e,i=t.id,a=void 0===i?0:i,r=t.type,o=void 0===r?this.selectedTab:r;o&&(this.accountsMap[o]={data:n.map((function(t){return(0,s.default)({},t,{listId:a})}))},o===this.selectedTab&&(this.footerButtons=this._retrieveFooterButtons()))}},{key:"onAccountClick",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.accountSelectSubject&&this.accountSelectSubject.next&&this.accountSelectSubject.next({account:t,category:e})}},{key:"_retrieveFooterButtons",value:function(){var t=this,e=(0,u.default)(this.accountConstants,"PROGRESS_TABS_CONFIG."+this.selectedTab+".footerButtons");return e?e.filter((function(e){var n=t.LINK_FILTERS[e.action];return!n||n.bind(t)()})).map((function(e){var n=t.PROGRESS_LINK_ACTIONS[e.action];return(0,s.default)({},e,{action:n&&n.bind(t)})})):[]}},{key:"_retrieveEmptyStateButtons",value:function(){var t=this,e=(0,u.default)(this.accountConstants,"PROGRESS_TABS_CONFIG."+this.selectedTab+".emptyStateButtons");return e?e.map((function(e){var n=t.PROGRESS_LINK_ACTIONS[e.action];return(0,s.default)({},e,{action:n&&n.bind(t)})})):[]}},{key:"populateFunctionsMaps",value:function(){var t,e,n,i;this.PROGRESS_LINK_ACTIONS=(t={},(0,a.default)(t,this.LINK_ACTION_FUNCTIONS.ADD_GOAL,this.onAddGoalClick),(0,a.default)(t,this.LINK_ACTION_FUNCTIONS.ADD_ASP,this.onAddAspClick),(0,a.default)(t,this.LINK_ACTION_FUNCTIONS.ADD_RECIPE,this.onAddRecipe),t),this.LINK_FILTERS=(e={},(0,a.default)(e,this.LINK_ACTION_FUNCTIONS.ADD_GOAL,this._addGoalFilter),(0,a.default)(e,this.LINK_ACTION_FUNCTIONS.ADD_ASP,this._addAspFilter),(0,a.default)(e,this.LINK_ACTION_FUNCTIONS.ADD_RECIPE,this._addRecipeFilter),e),this.ELIGIBILITY_FILTERS=(n={},(0,a.default)(n,this.ELIGIBILITY_FUNCTIONS.IS_GOALS_TAB_ALLOWED,this._isGoalsTabAllowed),(0,a.default)(n,this.ELIGIBILITY_FUNCTIONS.IS_RECIPE_TAB_ALLOWED,this._isRecipeTabAllowed),(0,a.default)(n,this.ELIGIBILITY_FUNCTIONS.IS_ASP_TAB_ALLOWED,this._isAspTabAllowed),n),this.DATA_RETRIEVAL_FUNCTIONS=(i={},(0,a.default)(i,this.DATA_RETRIEVAL_FUNCTIONS.GET_ASPS,this._fetchASPs),(0,a.default)(i,this.DATA_RETRIEVAL_FUNCTIONS.GET_RECIPES,this._fetchRecipes),i)}},{key:"_showServiceErrors",value:function(t){var e=this.serviceErrors;if("errorMessage"in t&&e.push(t.errorMessage),"details"in t.response_status){var n=t.response_status.details.map((function(t){return t.details_code&&"global.errorCodes."+t.details_code||t.technical_description})),a=[].concat((0,o.default)(new i.default(n)));e.push.apply(e,(0,o.default)(a))}else-1===["CREATED","SUCCESS"].indexOf(t.response_status.status_code)&&("SYSTEM_ERROR"===t.response_status.status_code&&t.response_status.return_code?e.push(this.$translate.instant("global.errorCodes."+t.response_status.return_code)):"status_code"in t.response_status?e.push(this.$translate.instant("global.errorCodes."+t.response_status.status_code)):e.push(this.$translate.instant("global.errorCodes."+t.response_status.return_code)))}},{key:"_fetchASPs",value:function(){var t=this;return this.AccountSummaryService.getScheduledPayments(!0,!0).then((function(e){var n=[];return e&&e.length&&(n=e.map((function(e){return(0,s.default)({},e,{scheduledDate:t._getScheduledDate(e),frequencyType:t._getFrequencyType(e),fromAccountName:t._getFromAccountName(e),toAccountType:t.PendingTransactionsTitleFormatter.getPendingTransactionTypeOrName(e),toAccountNumber:t.PendingTransactionsTitleFormatter.getMaskedNumber(e.to_account?e.to_account.display_name:"")})}))),{type:t.accountConstants.PROGRESS_TABS.ASP,data:n}}))}},{key:"_getScheduledDate",value:function(t){var e=t.effective_date;return!e&&t.mutual_fund&&(e=t.mutual_fund.effective_date),e}},{key:"_getFrequencyType",value:function(t){var e=t.frequency;return!e&&t.mutual_fund&&t.mutual_fund.frequency&&(e=t.mutual_fund.frequency.toUpperCase()),this.accountConstants.DATE_FREQUENCY[e]}},{key:"_fetchRecipes",value:function(){var t=this;return this.AccountSummaryService.getCurrentRecipes().then((function(e){if(!(e&&e.recipes&&e.recipes.length))return null;var n=e.recipes.map((function(e){return(0,s.default)({},e,{destination:t.RecipesService.getProgressSummaryListRecipeDescription(e)})})).filter((function(e){return e.recipes_configuration.status===t.RECIPES_STATUSES.ACTIVE}));return{type:t.accountConstants.PROGRESS_TABS.RECIPES,data:n}}))}},{key:"_getFromAccountName",value:function(t){var e=void 0;if(t){if(t.from_account){var n=void 0;t.from_account.type&&(n=this.$translate.instant("global.accountType."+t.from_account.type));var i=void 0;t.from_account.display_name&&(i=this.PendingTransactionsTitleFormatter.getMaskedNumber(t.from_account.display_name)),t.from_account.fi_name?e=i?t.from_account.fi_name+" "+i:""+t.from_account.fi_name:t.from_account.nickname?e=i?t.from_account.nickname+" "+i:""+t.from_account.nickname:n&&(e=i?n+" "+i:""+n)}return e}}},{key:"onAddGoalClick",value:function(){var t=this;this.isAddGoalAllowed()&&this.StepUpService.requestLevel2().then((function(){t.GlobalModalsService.showGoalModal()}))}},{key:"_addGoalFilter",value:function(){return this.isAddGoalAllowed()&&this._isAnyDataInSelectedTab()}},{key:"_addAspFilter",value:function(){return this.isAddAspAllowed()&&this._isAnyDataInSelectedTab()}},{key:"_addRecipeFilter",value:function(){return this.isAddRecipeAllowed()&&this._isAnyDataInSelectedTab()}},{key:"_isAnyDataInSelectedTab",value:function(){return!!(0,u.default)(this.accountsMap,this.selectedTab+".data.length")}},{key:"isAddGoalAllowed",value:function(){return!0}},{key:"isAddRecipeAllowed",value:function(){return!0}},{key:"onAddAspClick",value:function(){var t=this;this.isAddAspAllowed()&&this.StepUpService.requestLevel2().then((function(){t.GlobalModalsService.showASP()}))}},{key:"onAddRecipe",value:function(){this.$state.go(this.stateConstants.RECIPES,{},{reload:!0})}},{key:"isAddAspAllowed",value:function(){return!0}},{key:"_isGoalsTabAllowed",value:function(){return!!this.showGoalsTab}},{key:"_isRecipeTabAllowed",value:function(){return!!this.showRecipeTab}},{key:"_isAspTabAllowed",value:function(){return!!this.showAspTab}},{key:"$onDestroy",value:function(){this.selectedTabsSubscription.unsubscribe(),this.accountUpdateSubscription&&this.accountUpdateSubscription.unsubscribe(),this.capabilitiesChangeSubscription&&this.capabilitiesChangeSubscription.unsubscribe()}}]),t}();h.$inject=["$log","accountConstants","stateConstants","AccountTabListService","StepUpService","GlobalModalsService","recipesConstants","$state","$scope","$q","AccountSummaryService","recipesService","PendingTransactionsTitleFormatter","$translate","EventBusService","eventConstants"],e.default=h,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5210)),a=s(n(5211));function s(t){return t&&t.__esModule?t:{default:t}}n(5212);var r={template:i.default,controller:a.default,bindings:{tabs:"<",subject:"<",register:"&?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div> <ul id="category-tab-list"> <li ng-repeat="tab in $ctrl.tabs"> <div class="category" id="category-{{ tab.NAME.toLowerCase() }}-tab" title="{{ ::$ctrl.getTranslationKey(tab.NAME) | translate }}" alt="{{ ::$ctrl.getTranslationKey(tab.NAME) | translate }}" ng-class="{ \'selected\': tab.NAME == $ctrl.currentSelectedTab}" ng-click="$ctrl.selectTab(tab)"> <span id="category-{{ tab.NAME.toLowerCase() }}-tab-icon" class="category-icon icon-{{ tab.ICON }}"></span> <h5 id="category-{{ tab.NAME.toLowerCase() }}-tab-name" class="category-name" ng-bind-html="$ctrl.getTranslationKey(tab.NAME) | translate"></h5> </div> </li> </ul> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.$log=e}return(0,a.default)(t,[{key:"$onInit",value:function(){this.tabSubscription=this.subject.subscribe(this._observer.bind(this)),this.register&&"function"==typeof this.register&&this.register()}},{key:"_observer",value:function(t){this.currentSelectedTab=t}},{key:"selectTab",value:function(t){this.subject.next(t.NAME)}},{key:"getTranslationKey",value:function(t){return"account.overview.accountSection."+t.toLowerCase()}},{key:"$onDestroy",value:function(){this.tabSubscription.unsubscribe()}}]),t}();r.$inject=["$log"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5214)),a=s(n(5215));function s(t){return t&&t.__esModule?t:{default:t}}n(5216);var r={template:i.default,controller:a.default,bindings:{account:"<",hasBeenClickedAlready:"<",isTileView:"<",isStatusTile:"<?",isKycPending:"<?"},transclude:!0};e.default=r,t.exports=e.default},function(t,e){t.exports=' <a ng-if="!$ctrl.isNative()" actionable-id="account-card-link" class="panel account-card account-card--tile-view" href="" ng-class="{\n    \'account-card--clicked\': $ctrl.hasBeenClickedAlready,\n    \'account-card--grey\': $ctrl.isCardGrey,\n    \'account-card--disable\': $ctrl.isDisabled,\n    \'account-card--active\': $ctrl.isActive,\n    \'account-card--pal\': $ctrl.isRspPAL,\n    \'is-tile-view-selected\': $ctrl.isTileView,\n    \'account-card--goal-account\': $ctrl.isGoalTagVisable,\n    \'account-card__loading\': $ctrl.shouldShowLoadingTile,\n  }"> <div ng-if="!$ctrl.isStatusTile"> <p ng-if="$ctrl.isGoalTagVisable" class="account-card__goal-name"> <i ng-class="{\n          \'icon-savings\': $ctrl.account.goal_archetype === \'EMERGENCY_FUND\',\n          \'icon-sun\': $ctrl.account.goal_archetype === \'RETIREMENT\',\n          \'icon-home\': $ctrl.account.goal_archetype === \'HOME_DOWNPAYMENT\',\n          \'icon-dollar-bill\': $ctrl.account.goal_archetype === \'OTHER\'\n        }"></i> <span>{{ ::\'account.overview.goals.\' + $ctrl.account.goal_archetype + \'_LABEL\' | translate }}</span> </p> <p class="account-card__name"> <span class="account-card__nickname">{{ $ctrl.accountName }}</span> <span class="account-card__number">{{ $ctrl.account.display_name | maskNumber }}</span> </p> <p class="account-card__prod-name">{{ $ctrl.description }}</p> <p class="account-card__amount">{{ $ctrl.account.account_balance | tngCurrency:$ctrl.account.currency_type}}</p> </div> <div ng-if="!$ctrl.isKycPending && $ctrl.isStatusTile && $ctrl.account.applicationDetail" class="account-card__status-tile"> <div class="account-card__name"> <span class="account-card__status-tile__portfolio" ng-bind-html="$ctrl.account.applicationDetail.portfolioDisplayName | translate"></span> </div> <p class="account-card__prod-name" ng-bind-html="$ctrl.account.applicationDetail.productDisplayName | translate"></p> <div class="account-card__amount"> <tng-category-icon class="account-card__status" icon="icon-clock" size="24"></tng-category-icon> <span>{{ ::\'pendingApplications.status.\' + $ctrl.account.type + \'.\' + $ctrl.account.webstatus | blankIfNotFoundTranslate }}</span> </div> </div> <div ng-if="$ctrl.isKycPending && $ctrl.isStatusTile && $ctrl.account.applicationDetail" class="account-card__status-tile"> <div class="account-card__name"> <span class="account-card__status-tile__portfolio" ng-bind-html="$ctrl.account.applicationDetail.primaryTitle | translate"></span> </div> <p class="account-card__prod-name" ng-bind-html="$ctrl.account.applicationDetail.secondaryTitle | translate"></p> <div class="account-card__amount"> <tng-category-icon class="account-card__status" icon="icon-clock" size="24"></tng-category-icon> <span>{{ ::\'pendingApplications.status.T2033.PENDING\' | blankIfNotFoundTranslate }}</span> </div> </div> <div ng-if="!$ctrl.isKycPending && $ctrl.isStatusTile && !$ctrl.account.applicationDetail" class="account-card__status-tile"></div> </a> <a actionable-id="account-card-link"> <div ng-if="!$ctrl.isStatusTile" class="account-card account-card--list-view" ng-class="{\n      \'account-card--clicked\': $ctrl.hasBeenClickedAlready,\n      \'account-card--grey\': $ctrl.isCardGrey,\n      \'account-card--disable\': $ctrl.isDisabled,\n      \'account-card--active\': $ctrl.isActive,\n      \'is-tile-view-selected\': $ctrl.isTileView,\n    }"> <div class="account-card__name-field"> <p class="account-card__name"> <span class="account-card__nickname">{{ $ctrl.accountName }}</span> <span>{{ $ctrl.account.display_name | maskNumber }}</span> </p> <p class="account-card__prod-name">{{ $ctrl.description }}</p> <p ng-if="$ctrl.isGoalTagVisable" class="account-card__goal-name"> <i ng-class="{\n            \'icon-savings\': $ctrl.account.goal_archetype === \'EMERGENCY_FUND\',\n            \'icon-sun\': $ctrl.account.goal_archetype === \'RETIREMENT\',\n            \'icon-dollar-bill\': $ctrl.account.goal_archetype === \'OTHER\'\n          }"></i> <span>{{ ::\'account.overview.goals.\' + $ctrl.account.goal_archetype + \'_LABEL\' | translate }}</span> </p> </div> <div class="account-card__descriptionField"> <p class="account-card__prod-name">{{ $ctrl.description }}</p> </div> <div ng-if="!$ctrl.isDisplaySignNextLine()" class="account-card__amount-field" ng-class="{ \'account-card__amount-field-higher\': $ctrl.isGoalTagVisable }"> <p class="account-card__amount">{{ $ctrl.account.account_balance | tngCurrency:$ctrl.account.currency_type }}</p> </div> <div ng-if="$ctrl.isDisplaySignNextLine()" class="account-card__amount-field-thin"> <p class="account-card__amount">{{ $ctrl.account.account_balance | currency }}<br/> {{$ctrl.account.currency_type | tngCurrencySign }}</p> </div> </div> <div ng-if="!$ctrl.isKycPending && $ctrl.isStatusTile && $ctrl.account.applicationDetail" class="account-card account-card--list-view" ng-class="{\n      \'account-card--clicked\': $ctrl.hasBeenClickedAlready,\n      \'account-card--grey\': $ctrl.isCardGrey,\n      \'account-card--disable\': $ctrl.isDisabled,\n      \'account-card--active\': $ctrl.isActive,\n      \'is-tile-view-selected\': $ctrl.isTileView,\n    }"> <div class="account-card__name-field"> <p class="account-card__name"> <span class="account-card__status-tile__portfolio" ng-bind-html="$ctrl.account.applicationDetail.portfolioDisplayName | translate"></span> </p> <p class="account-card__prod-name" ng-bind-html="$ctrl.account.applicationDetail.productDisplayName | translate"></p> </div> <div class="account-card__descriptionField"> <p class="account-card__prod-name" ng-bind-html="$ctrl.account.applicationDetail.productDisplayName | translate"></p> </div> <div class="account-card__amount-field"> <tng-category-icon class="account-card__status" icon="icon-clock" size="24"></tng-category-icon> <span class="account-card__amount account-card__status-mobile"> {{ ::\'pendingApplications.status.\' + $ctrl.account.type + \'.\' + $ctrl.account.webstatus | blankIfNotFoundTranslate }} </span> </div> </div> <div ng-if="$ctrl.isKycPending && $ctrl.isStatusTile && $ctrl.account.applicationDetail" class="account-card account-card--list-view" ng-class="{\n      \'account-card--clicked\': $ctrl.hasBeenClickedAlready,\n      \'account-card--grey\': $ctrl.isCardGrey,\n      \'account-card--disable\': $ctrl.isDisabled,\n      \'account-card--active\': $ctrl.isActive,\n      \'is-tile-view-selected\': $ctrl.isTileView,\n    }"> <div class="account-card__name-field"> <p class="account-card__name"> <span class="account-card__status-tile__portfolio" ng-bind-html="$ctrl.account.applicationDetail.primaryTitle | translate"></span> </p> <p class="account-card__prod-name" ng-bind-html="$ctrl.account.applicationDetail.secondaryTitle | translate"></p> </div> <div class="account-card__descriptionField"> <p class="account-card__prod-name" ng-bind-html="$ctrl.account.applicationDetail.secondaryTitle | translate"></p> </div> <div class="account-card__amount-field"> <tng-category-icon class="account-card__status" icon="icon-clock" size="24"></tng-category-icon> <span class="account-card__amount account-card__status-mobile"> {{ ::\'pendingApplications.status.T2033.PENDING\' | blankIfNotFoundTranslate }} </span> </div> </div> <div ng-if="!$ctrl.isTileView && $ctrl.shouldShowLoadingTile" class="account-card account-card--list-view account-card__loading"></div> </a> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u){(0,i.default)(this,t),this.$filter=e,this.$translate=n,this.AccountHelpersService=s,this.CurrencyService=a,this.EnvironmentService=r,this.transPrefix="global.accountType.",this.ACCOUNT_TYPES=o.ACCOUNT_TYPES,this.RequesterService=c,this.serviceConstants=l,this.DateService=u}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.setDescription(),this.AccountHelpersService.getDisplayName(this.account).then((function(e){t.accountName=e}))}},{key:"setDescription",value:function(){var t=this;this.isRspPAL?this.description=this.account.description:this.account.description?this.$translate(""+this.transPrefix+this.account.description,{},"",""+this.account.description).then((function(e){t.description=e})):this.description=""}},{key:"isDisplaySignNextLine",value:function(){return this.EnvironmentService.isMobile()&&!this.CurrencyService.isCanadian(this.account.currency_type)}},{key:"isNative",value:function(){return this.EnvironmentService.isNative()}},{key:"setPortfolioName",value:function(){this.account.applicationDetail&&this.account.applicationDetail.portfolioDisplayName&&(this.portfolioName=this.$translate.instant(this.account.applicationDetail.portfolioDisplayName))}},{key:"isCardGrey",get:function(){return this.AccountHelpersService.isAccountGreyOut(this.account)}},{key:"isDisabled",get:function(){return this.account.transfer_in_progress&&this.account.type===this.ACCOUNT_TYPES.MORTGAGE}},{key:"isActive",get:function(){return!this.isCardGrey&&!this.isDisabled}},{key:"isRspPAL",get:function(){return this.account.isRspLoanPostApproval}},{key:"isGoalTagVisable",get:function(){return this.account.goal_account&&this.account.life_goal_id}},{key:"shouldShowLoadingTile",get:function(){return this.isStatusTile&&!this.account.applicationDetail}}]),t}();r.$inject=["$filter","$translate","CurrencyService","AccountHelpersService","EnvironmentService","accountConstants","RequesterService","serviceConstants","DateService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5218)),a=s(n(5219));function s(t){return t&&t.__esModule?t:{default:t}}n(5220);var r={template:i.default,controller:a.default,bindings:{account:"<",hasBeenClickedAlready:"<",isTileView:"<"},transclude:!0};e.default=r,t.exports=e.default},function(t,e){t.exports=' <a ng-if="!$ctrl.isNative()" actionable-id="goal-card-link" class="panel goal-card goal-card--tile-view" href="" translate-cloak ng-class="{\n    \'goal-card--clicked\': $ctrl.hasBeenClickedAlready,\n    \'goal-card--image\': $ctrl.getGoalImageUrl(),\n    \'is-tile-view-selected\': $ctrl.isTileView,\n  }" ng-style="{\'background-image\':\'url(\' + $ctrl.getGoalImageUrl() + \')\'}"> <span class="overlay goal-card__overlay" ng-if="$ctrl.getGoalImageUrl()"></span> <span class="goal-card__content"> <p class="goal-card__name"> <span class="goal-card__nickname">{{ $ctrl.account.goal_name }}</span> </p> <p class="goal-card__amount margin__t--fix2" ng-if="!$ctrl.isGoalServiceError()"> <span ng-if="$ctrl.account.goal_archetype !== \'RETIREMENT\'" class="goal-card__current-amount">{{ $ctrl.getGoalCurrentBalance() | tngCurrency:$ctrl.account.currency_type }}</span> <span ng-if="$ctrl.account.goal_archetype === \'RETIREMENT\'" class="goal-card__current-amount">{{ ($ctrl.getGoalCurrentBalance() + $ctrl.externalCurrentSavings) | tngCurrency:$ctrl.account.currency_type }}</span> <span class="goal-card__target-amount">{{ ::\'account.overview.goalsSection.of\' | translate }} {{ $ctrl.account.goal_target_amount | tngCurrency:$ctrl.account.currency_type }}</span></p> <p class="goal-card__progress-bar" ng-class="{\'goal-card__progress-bar--complete\': $ctrl.account.goal_achieved}" ng-if="!$ctrl.isGoalServiceError()"> <tng-progress-bar ng-if="$ctrl.account.goal_archetype !== \'RETIREMENT\'" height="20" width="::$ctrl.calculateProgressBarWidthPercentage()" second-width="$ctrl.progressBarSecondWidth" color="{{ $ctrl.getProgressBarColor() }}" second-color="{{ $ctrl.getProgressBarSecondColor() }}"> </tng-progress-bar> <tng-progress-bar ng-if="$ctrl.account.goal_archetype === \'RETIREMENT\'" height="19" width="::$ctrl.externalSavingsPercentage" color="{{ ::$ctrl.colorConstants.COLOR_GRAY_LIGHT }}" second-width="::$ctrl.progressBarSecondWidth" second-color="{{ ::$ctrl.colorConstants.COLOR_GRAY_LIGHT }}" third-width="($ctrl.totalSavingsPercentage)" third-color="{{ $ctrl.account.goal_achieved && $ctrl.account.goal_image_url ? $ctrl.colorConstants.COLOR_DUSTY_ORANGE : $ctrl.getProgressBarColor() }}" achieved="$ctrl.account.goal_achieved" no-image="!$ctrl.account.goal_image_url"> </tng-progress-bar> <span class="goal-card__progress-bar-legend float-right"> <span ng-if="$ctrl.account.goal_achieved">{{ ::\'account.overview.goalsSection.goalComplete\' | translate }}</span> <span ng-if="!$ctrl.account.goal_achieved && $ctrl.account.goal_archetype !== \'RETIREMENT\'">{{ $ctrl.getProgressBarWidthPercentage() }}%</span> <span ng-if="!$ctrl.account.goal_achieved && $ctrl.account.goal_archetype === \'RETIREMENT\'">{{ $ctrl.getProgressPercentage() }}%</span> </span> </p> <p class="goal-card__amount goal-card__service-error" ng-if="$ctrl.isGoalServiceError()"> <span class="goal-card__current-amount">{{ $ctrl.getGoalCurrentBalance() | tngCurrency:$ctrl.account.currency_type }}</span> </p> </span> </a> <a ng-if="!$ctrl.isNative()" actionable-id="goal-card-link" class="goal-card goal-card--large-list-view" href="" translate-cloak ng-class="{\n    \'goal-card--clicked\': $ctrl.hasBeenClickedAlready,\n    \'is-tile-view-selected\': $ctrl.isTileView,\n  }"> <div class="goal-card__name-field"> <p class="goal-card__name"> <span class="goal-card__nickname">{{ $ctrl.account.goal_name }}</span> </p> </div> <div class="goal-card__progress-bar" ng-class="{\'goal-card__progress-bar--complete\': $ctrl.account.goal_achieved}" ng-if="!$ctrl.isGoalServiceError()"> <tng-progress-bar ng-if="$ctrl.account.goal_archetype !== \'RETIREMENT\'" height="20" width="::$ctrl.calculateProgressBarWidthPercentage()" second-width="$ctrl.progressBarSecondWidth" color="{{ $ctrl.getProgressBarColor() }}" second-color="{{ $ctrl.getProgressBarSecondColor() }}"> </tng-progress-bar> <tng-progress-bar ng-if="$ctrl.account.goal_archetype === \'RETIREMENT\'" height="19" width="::$ctrl.externalSavingsPercentage" color="{{ ::$ctrl.colorConstants.COLOR_GRAY_LIGHT }}" second-width="::$ctrl.progressBarSecondWidth" second-color="{{ ::$ctrl.colorConstants.COLOR_GRAY_LIGHT }}" third-width="($ctrl.totalSavingsPercentage)" third-color="{{ $ctrl.account.goal_achieved && $ctrl.account.goal_image_url ? $ctrl.colorConstants.COLOR_DUSTY_ORANGE : $ctrl.getProgressBarColor() }}" achieved="$ctrl.trueValue" no-image="!$ctrl.account.goal_image_url"> </tng-progress-bar> </div> <div class="goal-card__progress-bar-legend" ng-if="!$ctrl.isGoalServiceError()"> <span ng-if="$ctrl.account.goal_achieved">{{ ::\'account.overview.goalsSection.goalComplete\' | translate }}</span> <span ng-if="!$ctrl.account.goal_achieved && $ctrl.account.goal_archetype !== \'RETIREMENT\'">{{ $ctrl.getProgressBarWidthPercentage() }}%</span> <span ng-if="!$ctrl.account.goal_achieved && $ctrl.account.goal_archetype === \'RETIREMENT\'">{{ $ctrl.getProgressPercentage() }}%</span> </div> <div class="goal-card__amount-field"> <p class="goal-card__amount"> <span ng-if="$ctrl.account.goal_archetype !== \'RETIREMENT\'" class="goal-card__current-amount">{{ $ctrl.getGoalCurrentBalance() | tngCurrency:$ctrl.account.currency_type }}</span> <span ng-if="$ctrl.account.goal_archetype === \'RETIREMENT\'" class="goal-card__current-amount">{{ ($ctrl.getGoalCurrentBalance() + $ctrl.externalCurrentSavings) | tngCurrency:$ctrl.account.currency_type }}</span> <span class="goal-card__target-amount" ng-if="!$ctrl.isGoalServiceError()">{{ ::\'account.overview.goalsSection.of\' | translate }} {{ $ctrl.account.goal_target_amount | tngCurrency:$ctrl.account.currency_type }}</span> </p> </div> </a> <a actionable-id="goal-card-link" class="goal-card goal-card--small-list-view" href="" translate-cloak ng-class="{\n    \'goal-card--clicked\': $ctrl.hasBeenClickedAlready,\n    \'goal-card--image\': $ctrl.getGoalImageUrl(),\n    \'goal-card--native-view\': $ctrl.isNative(),\n    \'is-tile-view-selected\': $ctrl.isTileView,\n  }" ng-style="{\'background-image\':\'url(\' + $ctrl.getGoalImageUrl() + \')\'}"> <span class="overlay goal-card__overlay" ng-if="$ctrl.getGoalImageUrl()"></span> <span class="goal-card__content"> <div class="margin__t--fix1" ng-class="{\'margin__t--fix2\': $ctrl.isGoalServiceError()}"> <span class="goal-card__name float-left"> <span class="goal-card__nickname">{{ $ctrl.account.goal_name }}</span> </span> <span class="goal-card__amount float-right"> <span ng-if="$ctrl.account.goal_archetype !== \'RETIREMENT\'" class="goal-card__current-amount">{{ $ctrl.getGoalCurrentBalance() | tngCurrency:$ctrl.account.currency_type }}</span> <span ng-if="$ctrl.account.goal_archetype === \'RETIREMENT\'" class="goal-card__current-amount">{{ ($ctrl.getGoalCurrentBalance() + $ctrl.externalCurrentSavings) | tngCurrency:$ctrl.account.currency_type }}</span> <span class="goal-card__target-amount" ng-if="!$ctrl.isGoalServiceError()">{{ ::\'account.overview.goalsSection.of\' | translate }} {{ $ctrl.account.goal_target_amount | tngCurrency:$ctrl.account.currency_type }}</span> </span> <span class="clearfix"></span> </div> <div class="goal-card__progress-bar margin__t--fix1" ng-class="{\'goal-card__progress-bar--complete\': $ctrl.account.goal_achieved}" ng-if="!$ctrl.isGoalServiceError()"> <tng-progress-bar ng-if="$ctrl.account.goal_archetype !== \'RETIREMENT\'" height="20" width="::$ctrl.calculateProgressBarWidthPercentage()" second-width="$ctrl.progressBarSecondWidth" color="{{ $ctrl.getProgressBarColor() }}" second-color="{{ $ctrl.getProgressBarSecondColor() }}"> </tng-progress-bar> <tng-progress-bar ng-if="$ctrl.account.goal_archetype === \'RETIREMENT\'" height="19" width="::$ctrl.externalSavingsPercentage" color="{{ ::$ctrl.colorConstants.COLOR_GRAY_LIGHT }}" second-width="::$ctrl.progressBarSecondWidth" second-color="{{ ::$ctrl.colorConstants.COLOR_GRAY_LIGHT }}" third-width="($ctrl.totalSavingsPercentage)" third-color="{{ $ctrl.account.goal_achieved && $ctrl.account.goal_image_url ? $ctrl.colorConstants.COLOR_DUSTY_ORANGE : $ctrl.getProgressBarColor() }}" achieved="$ctrl.account.goal_achieved" no-image="!$ctrl.account.goal_image_url"> </tng-progress-bar> </div> <div class="goal-card__progress-bar-legend margin__t--fix1" ng-if="!$ctrl.isGoalServiceError()"> <span class="float-right margin__b--fix1" ng-if="$ctrl.account.goal_achieved">{{ ::\'account.overview.goalsSection.goalComplete\' | translate }}</span> <span class="float-right margin__b--fix1" ng-if="!$ctrl.account.goal_achieved && $ctrl.account.goal_archetype !== \'RETIREMENT\'">{{ $ctrl.getProgressBarWidthPercentage() }}%</span> <span class="float-right margin__b--fix1" ng-if="!$ctrl.account.goal_achieved && $ctrl.account.goal_archetype === \'RETIREMENT\'">{{ $ctrl.getProgressPercentage() }}%</span> </div> </span> </a> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l){(0,i.default)(this,t),this.$filter=e,this.$translate=n,this.$timeout=a,this.AccountHelpersService=s,this.EnvironmentService=r,this.colorConstants=o,this.FinancialService=c,this.GoalsConstants=l,this.progressBarThirdColor=this.colorConstants.COLOR_GRAY_LIGHT,this.imageBaseUrl=this.EnvironmentService.getBaseUrl(),this.progressBarSecondWidth=100,this.trueValue=!0}return(0,a.default)(t,[{key:"$onInit",value:function(){this._calculateExternalSavingsComponent(),this._calcualteSavingsPercentages()}},{key:"calculateProgressBarWidthPercentage",value:function(){this._prepareData();var t=this.getGoalCurrentBalance();return t<0?0:this.account.goal_achieved?100:t/this.account.goal_target_amount*100}},{key:"getProgressBarWidthPercentage",value:function(){return Math.floor(this.calculateProgressBarWidthPercentage())}},{key:"getGoalImageUrl",value:function(){return this.account.goal_image_url?this.imageBaseUrl+this.account.goal_image_url:null}},{key:"getProgressBarColor",value:function(){return this.getGoalImageUrl()&&!this.account.goal_achieved?this.colorConstants.COLOR_WHITE:this.colorConstants.COLOR_DUSTY_ORANGE}},{key:"getProgressBarSecondColor",value:function(){return this.colorConstants.COLOR_WHITE_TWO}},{key:"isNative",value:function(){return this.EnvironmentService.isNative()}},{key:"isGoalServiceError",value:function(){return!!this.account.service_error}},{key:"_calculateExternalSavingsComponent",value:function(){if("RETIREMENT"===this.account.goal_archetype){var t=this.account.goalData&&this.account.goalData.goalExtendedData?this.account.goalData.goalExtendedData:null;if(this.externalCurrentSavings=0,t&&(t.externalCurrentSavings||t.externalMonthlySavings)){var e=t.externalCurrentSavings||0,n=t.externalMonthlySavings||0,i=moment(),a=moment(t.updateDate),s=i.diff(a,"months");s=s<0?0:s;var r=this.FinancialService.calculateMonthlyInterest(t.interestRate);this.externalCurrentSavings=this.FinancialService.calculateSavingsTillRetirement(e,n,r,s)}}}},{key:"_calcualteSavingsPercentages",value:function(){"RETIREMENT"===this.account.goal_archetype&&(this.totalSavings=this.getGoalCurrentBalance()+this.externalCurrentSavings,this.totalSavings>this.account.goal_target_amount||0===this.account.goal_target_amount?(this.totalSavingsPercentage=100,this.externalSavingsPercentage=this.externalCurrentSavings/this.totalSavings*100):(this.totalSavingsPercentage=this.totalSavings/this.account.goal_target_amount*100,this.externalSavingsPercentage=this.externalCurrentSavings/this.account.goal_target_amount*100))}},{key:"_prepareData",value:function(){"HOME_DOWNPAYMENT"===this.account.goal_archetype&&(this.account.goal_current_balance=this.account.goalData.currentAmount,this.account.goal_current_balance>=this.account.goalData.targetAmount&&(this.account.goal_achieved=!0))}},{key:"getProgressPercentage",value:function(){return Math.floor(this.totalSavingsPercentage)}},{key:"getGoalCurrentBalance",value:function(){return-1!==[this.GoalsConstants.GOAL_ARCHETYPES.DEBT_REPAYMENT,this.GoalsConstants.GOAL_ARCHETYPES.HOME_DOWNPAYMENT,this.GoalsConstants.GOAL_ARCHETYPES.RETIREMENT].indexOf(this.account.goal_archetype)?this.account.goal_current_balance:this.account.account_balance}}]),t}();r.$inject=["$filter","$translate","$timeout","AccountHelpersService","EnvironmentService","colorConstants","FinancialService","GoalsConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5222)),a=s(n(5223));function s(t){return t&&t.__esModule?t:{default:t}}n(5224);var r={template:i.default,controller:a.default,bindings:{account:"<",hasBeenClickedAlready:"<",isTileView:"<",isStatusTile:"<?",isKycPending:"<?"},transclude:!0};e.default=r,t.exports=e.default},function(t,e){t.exports=' <a ng-if="!$ctrl.isNative()" actionable-id="account-card-aa-link" class="panel account-card-aa account-card-aa--tile-view" href="" ng-class="{\n    \'account-card-aa--disable\': $ctrl.isDisabled,\n    \'is-tile-view-selected\': $ctrl.isTileView,\n    \'account-card-aa--goal-account\': $ctrl.isGoalTagVisable,\n  }"> <table class="table table--full"> <tbody> <tr> <td class="account-card-aa__td-image-field"> <span class="account-card-aa__logo-image-card"> <img class="account-card-aa__logo-aa" ng-src="data:image/png;base64,{{$ctrl.logoImg}}"/> </span> </td> <td colspan="3" style="padding:0" class="account-card-aa__td-bank-field"> <p class="account-card-aa__name"> <span class="account-card-aa__nickname account-card-aa__nickname-aa">{{ $ctrl.account.fi_name }}</span> <span class="account-card-aa__number account-card-aa__number-aa">****{{ $ctrl.account.mask }}</span> </p> <p class="account-card-aa__prod-name-aggreg">{{ $ctrl.description }}</p> </td> </tr> </tbody> </table> <p class="account-card-aa__amount-aggreg"> {{ $ctrl.account.account_balance | tngCurrency:$ctrl.account.currency_type : $ctrl.account.currency_type === $ctrl.CURRENCY_TYPES.USD}}</p> </a> <a actionable-id="account-card-aa-link"> <div actionable-id="{{ ::$ctrl.pageId }}_AA_Relogin" class="account-card-aa account-card-aa--list-view" ng-if="$ctrl.account.isRelogin" ng-class="{\n      \'account-card-aa--disable\': $ctrl.isDisabled,\n      \'is-tile-view-selected\': $ctrl.isTileView,\n    }"> <div class="logo-image-list" ng-class="{\'logo-image-list ieStyleAALogo\': !$ctrl.EnvironmentService.isNative() && $ctrl.EnvironmentService.isIE()}"> <img ng-src="data:image/png;base64,{{$ctrl.logoImg}}"/> </div> <div class="account-card-aa__name-field"> <p class="account-card-aa__name"> <span class="account-card-aa__nickname">{{ $ctrl.account.fi_name }}</span> </p> <p class="account-card-aa__error_relink" ng-bind-html="::\'account.overview.accountaggregation.errorlinkMobile\' | translate"></p> </div> </div> <div actionable-id="{{ ::$ctrl.pageId }}_{{ $ctrl.accountId }}_{{ $ctrl.description }}" class="account-card-aa account-card-aa--list-view" ng-if="!$ctrl.account.isRelogin" ng-class="{\n        \'account-card-aa--disable\': $ctrl.isDisabled,\n        \'is-tile-view-selected\': $ctrl.isTileView,\n        }"> <div class="logo-image-list" ng-class="{\'logo-image-list ieStyleAALogo\': !$ctrl.EnvironmentService.isNative() && $ctrl.EnvironmentService.isIE()}"> <img ng-src="data:image/png;base64,{{$ctrl.logoImg}}"/> </div> <div class="account-card-aa__name-field"> <p class="account-card-aa__name"> <span class="account-card-aa__nickname">{{ $ctrl.account.fi_name }}</span> <span>****{{ $ctrl.account.mask }}</span> </p> <p class="account-card-aa__prod-name">{{ $ctrl.description }}</p> </div> <div class="account-card-aa__descriptionField"> <p class="account-card-aa__prod-name" ng-class="{\'ieStyleAA\': !$ctrl.EnvironmentService.isNative() && $ctrl.EnvironmentService.isIE()}">{{ $ctrl.description }}</p> </div> <div ng-if="!$ctrl.isDisplaySignNextLine()" class="account-card-aa__amount-field" ng-class="{ \'account-card-aa__amount-field-higher\': $ctrl.isGoalTagVisable }"> <p class="account-card-aa__amount">{{ $ctrl.account.account_balance | tngCurrency:$ctrl.account.currency_type }}</p> </div> <div ng-if="$ctrl.isDisplaySignNextLine()" class="account-card-aa__amount-field-thin"> <p class="account-card-aa__amount">{{ $ctrl.account.account_balance | currency }}<br/> {{$ctrl.account.currency_type | tngCurrencySign }}</p> </div> </div> <div ng-if="!$ctrl.isTileView && $ctrl.shouldShowLoadingTile" class="account-card-aa account-card-aa--list-view account-card-aa__loading"></div> </a> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s){(0,i.default)(this,t),this.$translate=e,this.CurrencyService=n,this.EnvironmentService=a,this.transPrefix="global.accountType.",this.transPrefixOther="global.accountType.OTHER",this.transPrefixStudentLoan="global.accountType.STUDENT",this.logoImg=this.account.logo,this.CURRENCY_TYPES=s.CURRENCY_TYPES}return(0,a.default)(t,[{key:"$onInit",value:function(){this.isDisabled=!0,this.setDescription(),this.account.account_balance=this.account.balance.amount,this.account.currency_type=this.account.balance.currency,this.account.fi_name=this.account.bankName,this.pageId="AcctSummAA",this.accountId=this.account.bankName+"****"+this.account.mask}},{key:"setDescription",value:function(){this.description=this.account.description}},{key:"isDisplaySignNextLine",value:function(){return this.EnvironmentService.isMobile()&&!this.CurrencyService.isCanadian(this.account.currency_type)}},{key:"isNative",value:function(){return this.EnvironmentService.isNative()}},{key:"isGoalTagVisable",get:function(){return this.account.goal_account&&this.account.life_goal_id}},{key:"shouldShowLoadingTile",get:function(){return!1}}]),t}();r.$inject=["$translate","CurrencyService","EnvironmentService","accountConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5226));n(5227);var a=s(n(5228));function s(t){return t&&t.__esModule?t:{default:t}}var r={template:i.default,controller:a.default,bindings:{isTileView:"<",tileCount:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-account-cards-loading"> <div ng-if="!$ctrl.isNative" class="panel account-card c-account-section__grid-item account-card--tile-view" ng-repeat="x in [].constructor($ctrl.tileCount) track by $index" ng-class="{\n      \'is-tile-view-selected\': $ctrl.isTileView,\n    }"> <div class="c-account-cards-loading__skeleton-container" ng-class="{\n      \'c-account-cards-loading__tile-placeholder\': $ctrl.isTileView,\n      \'c-account-cards-loading__list-placeholder\': !$ctrl.isTileView\n    }"> <div></div> <div></div> <div></div> </div> </div> <div class="panel account-card c-account-section__grid-item account-card--list-view" ng-repeat="x in [].constructor($ctrl.tileCount) track by $index" ng-class="{\n      \'is-tile-view-selected\': $ctrl.isTileView,\n    }"> <div class="c-account-cards-loading__skeleton-container" ng-class="{\n      \'c-account-cards-loading__tile-placeholder\': $ctrl.isTileView,\n      \'c-account-cards-loading__list-placeholder\': !$ctrl.isTileView\n    }"> <div></div> <div ng-if="!$ctrl.isNative" class="skeleton-to-hide"></div> <div ng-if="!$ctrl.isNative" class="skeleton-to-hide"></div> </div> </div> </div>'},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.EnvironmentService=e}return(0,a.default)(t,[{key:"$onInit",value:function(){this.tileCount||(this.tileCount=3),this.isNative=this.EnvironmentService.isNative()}}]),t}();r.$inject=["EnvironmentService"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5230)),a=s(n(5231));function s(t){return t&&t.__esModule?t:{default:t}}n(5232);var r={template:i.default,controller:a.default,bindings:{orangeKey:"<",sortedAccounts:"<",pendingApplications:"<",showTabListView:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-quick-access"> <div class="c-quick-access__content"> <div tng-hide-kyc-pending class="what-you-earned-container" ng-if="$ctrl.userInfo.customer.monthly_fee || $ctrl.userInfo.customer.interest_paid_lifetime"> <h2 class="c-quick-access__title">{{ ::\'account.overview.quickAccess.whatYouEarned\' | translate }}</h2> <div class="grid__container whatYouEarned"> <div class="c-account-summary__grid-item interest-accrued" ng-if="$ctrl.userInfo.customer.interest_paid_lifetime > 0"> <div class="panel"> <h3>{{ ::\'account.overview.quickAccess.interest\' | translate }}</h3> <p class="interest-amount">{{ $ctrl.userInfo.customer.interest_paid_lifetime | currency }}</p> </div> </div> <div class="c-account-summary__grid-item fees-earned" ng-if="$ctrl.userInfo.customer.monthly_fee"> <div class="panel what-i-earned-panel"> <h3 class="fees-earned-header">{{ ::\'account.overview.quickAccess.fees\' | translate }}</h3> <tng-help-bubble class="fees-saved-help-bubble"> {{ ::(\'account.overview.quickAccess.feesTip\' | translate) }} </tng-help-bubble> <p class="fees-amount">{{ $ctrl.userInfo.customer.fees_saved | currency }}</p> <button actionable-id="feesCalculator_modal" class="btn btn--edit btn--auto" tng-click="$ctrl.openModal($ctrl.menuConstants.FEES_SAVED.FEES)"> {{ ::\'account.overview.quickAccess.feesAdjustButton\' | translate }} </button> </div> </div> </div> </div> <h2 class="c-quick-access__title">{{ ::\'account.overview.quickAccess.title\' | translate}}</h2> <div class="grid__container"> <div class="panel c-quick-access__grid-item card__refer"> <h3>{{ ::\'account.overview.quickAccess.referAFriend\' | translate }}</h3> <p class="orange-key">{{ \'account.overview.quickAccess.orangeKey\' | translate }}</p> <p class="referral-code">{{ $ctrl.userInfo.customer.orange_key }}</p> <div class="bottom"> <button actionable-id="quickAccess_shareKey" class="btn btn--orange btn--auto" tng-click="$ctrl.openModal($ctrl.referFriendConstants.MODAL_TYPES.SHARED_KEY)" level2-auth> {{ ::\'account.overview.quickAccess.shareKey\' | translate }} </button> <button actionable-id="quickAccess_review" class="btn btn--edit btn--auto" tng-click="$ctrl.openModal($ctrl.referFriendConstants.MODAL_TYPES.REVIEW)" level2-auth> {{ ::\'account.overview.quickAccess.learnMore\' | translate }} </button> </div> </div> <div class="panel c-quick-access__grid-item card__app-status" ng-if="$ctrl.shouldShowPendingApplications()"> <h3>{{ ::\'account.overview.quickAccess.appStatus\' | translate }}</h3> <p class="content__app-status">{{ ::\'account.overview.quickAccess.appYouHave\' | translate }}</p> <div class="bottom"> <button actionable-id="quickAccess_viewApps" class="btn btn--orange btn--auto" ng-click="$ctrl.startPendingApplications()">{{ ::\'account.overview.quickAccess.appView\' | translate }}</button> </div> </div> <div tng-hide-kyc-pending class="panel c-quick-access__grid-item card__asp" ng-class="{\'hideASP\' : $ctrl.showTabListView }" ng-if="$ctrl.allowAsp"> <h3>{{ ::\'account.overview.quickAccess.aspTitle\' | translate }}</h3> <p class="content__asp">{{ \'account.overview.quickAccess.aspDesc\' | translate }}</p> <div class="bottom"> <button actionable-id="quickAccess_startASP" class="btn btn--orange btn--auto" ng-click="$ctrl.startASP()">{{ ::\'account.overview.quickAccess.aspStart\' | translate }}</button> </div> </div> </div> <tng-cdic-logo class="cdic-quick-access"></tng-cdic-logo> </div> </div> <tng-fees-calculator ng-if="$ctrl.modalTypeVisible === $ctrl.menuConstants.FEES_SAVED.FEES" current-fee="$ctrl.userInfo.customer.monthly_fee" on-close="$ctrl.closeModal({ reloadCustomer: true })"> </tng-fees-calculator> <tng-refer-friend-share-key ng-if="$ctrl.modalTypeVisible === $ctrl.referFriendConstants.MODAL_TYPES.SHARED_KEY" orange-key="{{$ctrl.userInfo.customer.orange_key}}" user-email="{{$ctrl.userInfo.customer.email}}" on-close="$ctrl.closeModal(result)"> </tng-refer-friend-share-key> <tng-refer-friend-review ng-if="$ctrl.modalTypeVisible === $ctrl.referFriendConstants.MODAL_TYPES.REVIEW" orange-key="{{$ctrl.userInfo.customer.orange_key}}" on-close="$ctrl.closeModal(result)"> </tng-refer-friend-review> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f){(0,i.default)(this,t),this.$log=e,this.$state=n,this.stateConstants=a,this.referFriendConstants=s,this.menuConstants=u,this.CustomersService=r,this.UserService=o,this.MenuService=c,this.GlobalModalsService=l,this.modalTypeVisible=null,this.buildConstants=h,this.EnvironmentService=f}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this._getUserInfo(),this.allowAsp=this._shouldShowAsp(),this.UserService.getMoveMoneyCapability().then((function(e){t.allowAsp=e}))}},{key:"_getUserInfo",value:function(){var t=this;this.CustomersService.getCustomerInfo({include_servicing_systems:!0}).then((function(e){t.userInfo=e,t.userInfo.customer.monthly_fee&&!t.userInfo.customer.fees_saved&&(t.userInfo.customer.fees_saved=0)})).catch((function(e){t.$log.error("QuickAccessController => _getUserInfo error:",e)}))}},{key:"openModal",value:function(t){t===this.referFriendConstants.MODAL_TYPES.SHARED_KEY?this.$state.go(this.stateConstants.REFER_FRIEND_MODAL):this.modalTypeVisible=t}},{key:"closeModal",value:function(t){t&&t.reloadCustomer&&this._getUserInfo(),this.modalTypeVisible=null}},{key:"shouldShowPendingApplications",value:function(){return Array.isArray(this.pendingApplications)&&this.pendingApplications.length>0}},{key:"startPendingApplications",value:function(){this.GlobalModalsService.showPendingApplications()}},{key:"_shouldShowAsp",value:function(){return!this.sortedAccounts||(this.sortedAccounts.SAVING&&this.sortedAccounts.SAVING.length||this.sortedAccounts.INVESTING&&this.sortedAccounts.INVESTING.length)}},{key:"startASP",value:function(){var t=this.menuConstants.LINK_TYPES.METHOD,e=this.menuConstants.ACTION_METHODS.OPEN_ASP;this.MenuService.handleMenuInteraction(t,e)}}]),t}();r.$inject=["$log","$state","stateConstants","referFriendConstants","CustomersService","UserService","MenuService","GlobalModalsService","menuConstants","pendingApplicationsConstants","buildConstants","EnvironmentService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(5234),s=(i=a)&&i.__esModule?i:{default:i};n(5235);var r={template:s.default,controller:angular.noop,transclude:!0,bindings:{}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-service-interruption panel" ng-transclude></div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5237)),a=s(n(5238));function s(t){return t&&t.__esModule?t:{default:t}}n(5239);var r={template:i.default,controller:a.default,require:{parentController:"^accountSummary"},bindings:{}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-pre-approved" ng-if="$ctrl.hasPreApproval"> <div class="c-pre-approved__content-container"> <div class="c-pre-approved__content"> <div class="grid__container orangeItem"> <div class="grid__column--5of6"> <div class="panel c-pre-approved__grid-item-orange"> <div class="c-pre-approved__grid-item-orange"> <h2 class="c-pre-approved__title">{{ ::\'rspLoan.preApprovedSection.preapproved\' | translate}}</h2> <div class="c-pre-approved__text"> <p>{{ \'rspLoan.preApprovedSection.goodNews\' | translate }}</p> </div> </div> </div> </div> <div class="grid__column--1of6 rightItem"> <div class="panel c-pre-approved__grid-item-orange"> <div class="c-pre-approved__grid-item-orange"> <tng-category-icon icon="icon-lightbulb" size="100"> </tng-category-icon> </div> </div> </div> </div> </div> </div> <div ng-repeat="application in $ctrl.preApprovals"> <div class="c-pre-approved-rsp" ng-if="application.isRspLoan"> <div class="c-pre-approved-rsp__content-container"> <div class="c-pre-approved__content"> <div class="grid__container orangeItem"> <div class="grid__column--5of6"> <div class="panel c-pre-approved-rsp__grid-item-orange"> <div class="c-pre-approved-rsp__grid-item-orange"> <div class="c-pre-approved-rsp__text"> <p><strong>{{ :: (application.isCloned ? \'rspLoan.preApprovedSection.qualifyCloneTitle\' : \'rspLoan.preApprovedSection.qualifyLoanTitle\') | translate }}</strong></p> <p ng-bind-html=" (application.isCloned ? \'rspLoan.preApprovedSection.qualifyCloneText\' : \'rspLoan.preApprovedSection.qualifyLoanText\') | translate: {\n                      amount: (application.amount_requested | currency),\n                      date: application.redeemBeforeDate }"></p> <p> <span>{{ :: \'rspLoan.preApprovedSection.spousalInfo\' | translate }}</span> </p> </div> </div> </div> </div> <div class="grid__column--1of6 rightItem"> <div class="panel c-pre-approved-rsp__grid-item-orange--button"> <div class="c-pre-approved-rsp__grid-item-orange--button"> <div class="buttonItem"> <a ui-sref="{{$ctrl.parentController.getOnboardingStateKey()}}({ products: $ctrl.PPTS.RSP_LOAN})"> <button actionable-id="preApprovedRsp_enroll" class="btn btn--orange btn--auto">{{ ::\'rspLoan.preApprovedSection.enroll\' | translate }} </button> </a> </div> </div> </div> </div> </div> </div> </div> </div> <div class="c-pre-approved-rsp" ng-if="application.isPreApprovedCreditCard"> <div class="c-pre-approved-rsp__content-container"> <div class="c-pre-approved__content"> <div class="grid__container orangeItem"> <div class="grid__column--5of6"> <div class="panel c-pre-approved-rsp__grid-item-orange"> <div class="c-pre-approved-rsp__grid-item-orange"> <div nclass="c-pre-approved-rsp__text"> <p><strong>{{ ::\'preApprovedCreditCard.tile.heading\' | translate: { limit: (application.credit_card_offer_details.credit_limit | currency) } }}</strong></p> <p><span>{{ ::\'preApprovedCreditCard.tile.content\' | translate: { limit: (application.credit_card_offer_details.credit_limit | currency), expiry_date: (application.offerExpiryDate | date: \'longDate\') } }}</span></p> </div> </div> </div> </div> <div class="grid__column--1of6 rightItem"> <div class="panel c-pre-approved-rsp__grid-item-orange"> <div class="c-pre-approved-rsp__grid-item-orange"> <div class="buttonItem"> <button ng-click="$ctrl.openCreditCardOffer()" actionable-id="preApprovedCreditCard_enroll" class="btn btn--orange btn--auto"> {{::\'preApprovedCreditCard.tile.btnOpenOffer\' | translate }} </button> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> <pre-approved-credit-card-modal on-close="$ctrl.preApprovedCreditCard.showModal = false" ng-if="$ctrl.preApprovedCreditCard.showModal" offer="$ctrl.preApprovedCreditCard.offer"> </pre-approved-credit-card-modal> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c){(0,i.default)(this,t),this.$log=e,this.$q=n,this.RspLoanService=a,this.accountConstants=s,this.PPTS=s.ACCOUNT_PPTS,this.DateService=r,this.hasPreApproval=!1,this.CustomersService=o,this.serviceConstants=c,this.preApprovedCreditCard={offer:void 0,showModal:!1},this.preApprovals=[]}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.$q.all([this._getPreApprovals(),this._getPreApprovedCreditCardOffer()]).then((function(e){var n=e[0];n&&t.preApprovals.push(n);var i=e[1];i&&(t.preApprovedCreditCard.offer=i,t.preApprovals.push(i))})).catch((function(e){t.$log.error("ERROR getting approval offers: ",e)})).finally((function(){t.preApprovals.length>0&&(t.hasPreApproval=!0)}))}},{key:"_getPreApprovals",value:function(){var t=this;return this.RspLoanService.getAvailablePAL().then((function(e){return e&&(e.redeemBeforeDate=t.DateService.momentToTngDate(t.DateService.serverFormatToMoment(e.expiry_date)),e.isRspLoan=!0),e})).catch((function(e){t.$log.error("GET AVAILABLE Pre approved Loan ERROR: ",e)}))}},{key:"_getPreApprovedCreditCardOffer",value:function(){var t=this;return this.CustomersService.getPreApprovedCreditCardOffer().then((function(t){return t})).catch((function(e){t.$log.error("Error getting CC offer",e)}))}},{key:"openCreditCardOffer",value:function(){this.$log.debug("openCreditCardOffer"),this.preApprovedCreditCard.showModal=!0}}]),t}();r.$inject=["$log","$q","RspLoanService","accountConstants","DateService","CustomersService","serviceConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5241));function a(t){return t&&t.__esModule?t:{default:t}}n(5242);var s={template:a(n(5243)).default,controller:i.default,bindings:{onClose:"&",offer:"<"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.$log=e,this.EnvironmentService=n,this.$window=a}return(0,a.default)(t,[{key:"$onInit",value:function(){this.$log.debug("PreApprovedController loaded")}},{key:"cancel",value:function(){this.$log.debug("PreApprovedController cancelled"),this.onClose()}},{key:"acceptOffer",value:function(){this.$log.debug("PreApprovedController offer accepted, thanks");var t=this.EnvironmentService.getAPIUrl()+"/web/Tangerine.html?command=goToOpenAccount&productType=1100CAD&FBE_NAV=true";this.$window.location.href=t}},{key:"onModalClose",value:function(){this.$log.debug("onModalClose"),this.cancel()}}]),t}();r.$inject=["$log","EnvironmentService","$window"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e){t.exports="<tng-modal-dialog on-close=\"$ctrl.onModalClose()\" class=\"c-pre-approved-credit-card-modal\"> <header> {{ ::'preApprovedCreditCard.modal.heading' | translate }} </header> <div> <p><span class=\"orangeText\">{{ ::'preApprovedCreditCard.tile.heading' | translate: { limit: ( $ctrl.offer.credit_card_offer_details.credit_limit | currency) } }}</span></p> </div> <div> <p> {{ ::'preApprovedCreditCard.modal.howDoesCardHelp' | translate }} <ul> <li class=\"c-pre-approved-credit-card-modal__feature-item\">{{ ::'preApprovedCreditCard.modal.feature1' | translate }}</li> <li class=\"c-pre-approved-credit-card-modal__feature-item\">{{ ::'preApprovedCreditCard.modal.feature2' | translate }}</li> <li class=\"c-pre-approved-credit-card-modal__feature-item\">{{ ::'preApprovedCreditCard.modal.feature3' | translate }}</li> <li class=\"c-pre-approved-credit-card-modal__feature-item\">{{ ::'preApprovedCreditCard.modal.feature4' | translate }}</li> </ul> </p> </div> <div> <p>{{ ::'preApprovedCreditCard.modal.saveInterest' | translate }}</p> </div> <div> <p>{{ ::'preApprovedCreditCard.modal.ifYouHaveBalance' | translate }}</p> </div> <hr> <div> <p>{{ ::'preApprovedCreditCard.modal.offerExpiry' | translate: {expiry_date: ( $ctrl.offer.offerExpiryDate | date: 'longDate') } }} </p> </div> <footer> <button class=\"btn btn--cancel\" ng-click=\"$ctrl.cancel()\" actionable-id=\"preApprovedCreditCardModal.cancel\">{{ ::'preApprovedCreditCard.modal.cancel' | translate }}</button> <button class=\"btn btn--tangerine\" ng-click=\"$ctrl.acceptOffer()\" actionable-id=\"preApprovedCreditCardModal.accept\">{{ ::'preApprovedCreditCard.modal.accept' | translate }}</button> </footer> </tng-modal-dialog> "},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5245)),a=s(n(5246));function s(t){return t&&t.__esModule?t:{default:t}}n(5247);var r={template:i.default,controller:a.default,require:{parentController:"^accountSummary"},bindings:{}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div ng-if="$ctrl.parentController.showBudgets === true" ng-click="$ctrl.parentController.goToBudgetTool()" class="c-budget-summary__budget-lts"> <div> <div class="c-budget-summary__text"> <span class="c-budget-summary__headTitle" ng-bind-html="\'budget.budgetSummary.lts_title\' | translate"></span> <span ng-if="!$ctrl.parentController.actual_lts" class="c-budget-summary__actual-lts-amount" ng-style="{\'color\':$ctrl.parentController.progressBarColor}"> <span class="general-text-loading-animation" data-text=" . . ."></span> </span> <span ng-if="$ctrl.parentController.actual_lts" class="c-budget-summary__actual-lts-amount" ng-style="{\'color\':$ctrl.parentController.progressBarColor}"> {{ ($ctrl.parentController.actual_lts) | currency }} </span> <span class="c-budget-summary__dayTitle"> <span ng-bind-html="\'budget.budgetSummary.Day\' | translate"></span> {{ $ctrl.parentController.currentDay }} <span ng-bind-html="\'budget.budgetSummary.of\'| translate"></span> {{ $ctrl.parentController.daysInMonth}} </span> </div> <div class="c-budget-summary__progress"> <tng-progress-bar height="8" width="$ctrl.parentController.firstWidth" color="{{$ctrl.getFirstColor()}}" second-color="{{ $ctrl.getSecondColor() }}" second-width="$ctrl.secondWidth"> </tng-progress-bar> </div> </div> </div>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c){(0,i.default)(this,t),this.$log=e,this.colorConstants=n,this.$translate=a,this.$scope=s,this.globalModalsConstants=r,this.EventBusService=o,this.serviceConstants=c,this.ROOT_ENDPOINTS=c.ROOT_ENDPOINTS}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.changeColor=!1,this.getFirstColor(),this.getSecondColor(),this.EventBusService.subscribe(this.$scope,this.globalModalsConstants.GLOBAL_EVENTS.GLOBAL_MODAL_CLOSE,(function(e,n){n&&(t.parentController.getLtsBudget(),t.parentController.getLtsDays())}))}},{key:"changeStyle",value:function(t){this.changeColor=t}},{key:"getFirstColor",value:function(){return this.firstColor=this.parentController.progressBarColor,!1===this.changeColor?this.firstColor=this.parentController.progressBarColor:!0===this.changeColor&&(this.parentController.progressBarColor===this.colorConstants.COLOR_GREY||this.parentController.progressBarColor===this.colorConstants.COLOR_WARNING?this.firstColor=this.colorConstants.COLOR_LIGHT_ORANGE:this.firstColor=this.colorConstants.COLOR_WHITE),this.firstColor}},{key:"getSecondColor",value:function(){return this.secondColor=this.colorConstants.COLOR_GREY,!0===this.changeColor&&this.parentController.progressBarColor===this.colorConstants.COLOR_DUSTY_ORANGE&&(this.secondColor=this.colorConstants.COLOR_LIGHT_ORANGE,this.secondWidth=100),this.secondColor}}]),t}();r.$inject=["$log","colorConstants","$translate","$scope","globalModalsConstants","EventBusService","serviceConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5249));function a(t){return t&&t.__esModule?t:{default:t}}n(5250);var s={template:a(n(5251)).default,controller:i.default,bindings:{onClose:"&",application:"<"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.$log=e}return(0,a.default)(t,[{key:"$onInit",value:function(){this.$log.debug("ManualReviewTlocModalController loaded")}},{key:"onModalClose",value:function(){this.$log.debug("onModalClose"),this.onClose()}}]),t}();r.$inject=["$log"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.onClose()" class="c-manual-review-tloc-modal"> <header> {{ ::\'pendingApplications.headings.done\' | translate}} </header> <div> <table class="table table--full c-manual-review-tloc-modal__table c-manual-review-tloc-modal__hide-mobile"> <thead> <tr> <th>{{ ::\'pendingApplications.tableHeadings.application\' | translate}}</th> <th>{{ ::\'pendingApplications.tableHeadings.type\' | translate}}</th> <th>{{ ::\'pendingApplications.tableHeadings.date_modified\' | translate}}</th> <th>{{ ::\'pendingApplications.tableHeadings.status\' | translate}}</th> <th>{{ ::\'pendingApplications.tableHeadings.referenceNumber\' | translate}}</th> </tr> </thead> <tbody> <tr> <td> <div class="table__quiet"> <strong>{{ ::\'tlocapp.manualReview.portfolioDisplayName\' | translate }}</strong> </div> </td> <td></td> <td> <div class="table__quiet">{{$ctrl.application.statusUpdateDate}}</div> </td> <td> <div class="table__quiet"> {{ ::\'tlocapp.manualReview.status\' | translate }}</div> </td> <td> <div class="table__quiet" id="application_deal_id">{{::$ctrl.application.dealId}}</div> </td> </tr> </tbody> </table> <div class="c-manual-review-tloc-modal__show-mobile c-manual-review-tloc-modal__mobile"> <div class="c-manual-review-tloc-modal__mobile__container"> <div class="c-manual-review-tloc-modal__mobile__header"> <span>{{ \'pendingApplications.tableHeadings.application\' | translate}}</span> <span>{{ ::\'pendingApplications.tableHeadings.status\' | translate}}/{{ ::\'pendingApplications.tableHeadings.referenceNumber\' | translate}}</span> </div> <div> <div class="c-manual-review-tloc-modal__mobile__tile__header">{{ ::\'pendingApplications.tableHeadings.date_modified\' | translate}} : {{$ctrl.application.statusUpdateDate}}</div> <div class="c-manual-review-tloc-modal__mobile__tile__content"> <div class="c-manual-review-tloc-modal__mobile__tile__content__child"> <div class="table__quiet"> <strong>{{ ::\'tlocapp.manualReview.portfolioDisplayName\' | translate }}</strong> </div> </div> <div class="c-manual-review-tloc-modal__mobile__tile__content__child"> <div class="table__quiet">{{ ::\'tlocapp.manualReview.status\' | translate }}</div> <div class="table__quiet" id="application_deal_id">{{::$ctrl.application.dealId}}</div> </div> </div> </div> </div> </div> </div> <footer> <button class="btn btn--orange" ng-click="$ctrl.onClose()" actionable-id="c-manual-review-tloc-modal_close"> {{ ::\'pendingApplications.buttons.close\' | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(92)),a=u(n(8)),s=u(n(15)),r=u(n(365)),o=u(n(33)),c=u(n(2)),l=u(n(0));function u(t){return t&&t.__esModule?t:{default:t}}var d=function t(e,n,i,a){(0,l.default)(this,t),this.name=e,this.type=n,this.amount=i,this.currency=a},h=function(){function t(e,n,i,a,s,r,o,c,u,d){(0,l.default)(this,t),this.$filter=e,this.RequesterService=n,this.serviceConstants=a,this.$log=s,this.EnvironmentService=r,this.AccountHelpersService=o,this.UserService=c,this.$q=u,this.ACCT_TYPES=i.ACCOUNT_TYPES,this.CURR_TYPES=i.CURRENCY_TYPES,this.ACCOUNT_CATEGORIES=i.ACCOUNT_CATEGORIES,this.ACTIVE=i.ACCOUNT_SUBCATEGORIES.ACTIVE.toLowerCase(),this.ACCOUNT_AGGREGATION=i.ACCOUNT_AGGREGATION,this.TRANSACTION_TYPE_CODES=d.TRANSACTION_TYPE_TO_CODE,this.TRANSACTION_TYPE_FILTER_MAP=d.TRANSACTION_TYPE_FILTER_MAP,this.categoryOrder=[this.ACCT_TYPES.CHEQUING,this.ACCT_TYPES.SAVINGS,this.ACCT_TYPES.MUTUAL_FUND,this.ACCT_TYPES.CREDIT_CARD,this.ACCT_TYPES.LOAN,this.ACCT_TYPES.MORTGAGE,this.ACCOUNT_AGGREGATION.ACCOUNT_AGGREGATION_HAVE_OWE_TYPE_EXTERNAL],this.customer={},this.retirementGoalId=void 0}return(0,c.default)(t,[{key:"getAccounts",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNT_SUMMARY,t,e)}},{key:"getLtsBudget",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_LTS_BUDGET,{urlVars:{queryString:"show-message=false"}})}},{key:"getBudgetFeatureFlag",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_BUDGET_CAPABILITIES,t,e)}},{key:"getBudgetLtsSettings",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_BUDGET_LTS_STATUS)}},{key:"getWhatIData",value:function(t,e,n){var i=this;n?n.forEach((function(t){t.type=i.ACCOUNT_AGGREGATION.ACCOUNT_AGGREGATION_HAVE_OWE_TYPE_EXTERNAL,t.account_balance=t.balance.amount,t.currency_type=t.balance.currency})):n=[];var a={totalBalance:0,rates:(0,o.default)({},this.CURR_TYPES.CAD,1),categories:[],showHelp:!1,displayCurrencyForType:{}},c={};return(0,r.default)(this.CURR_TYPES).forEach((function(t){a.displayCurrencyForType[t]=!1})),t.concat(n).forEach((function(t){var e=t.currency_type;e in c||(c[e]=[]),c[e].push(t),e!==i.CURR_TYPES.CAD&&(a.displayCurrencyForType[e]=!0,a.showHelp=!0)})),(0,s.default)(c).forEach((function(t){var n={},s=c[t],r=1,o=e[t];o&&(r=a.rates[t]=o.sell),s.forEach((function(e){var s=e.type.toUpperCase();a.totalBalance+=e.account_balance*r;var o=i.$filter("normalizeType")(s);a.displayCurrencyForType[s]&&(o=o+" "+t),o in n||(n[o]=a.categories.length,a.categories.push(new d(o,s,0,t))),a.categories[n[o]].amount+=e.account_balance}))})),this.sortCategories(a.categories),a}},{key:"getLifeGoals",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.LIFE_GOALS,e,n).then((function(e){if(angular.isArray(e.data)){var n=e.data.filter((function(t){return"RETIREMENT"===t.archetype}));t.retirementGoalId=n.length?n[0].id:null}return e}))}},{key:"invalidateRetirementGoalId",value:function(){this.retirementGoalId=void 0}},{key:"getGoalsCapabilities",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GOAL_CAPABILITIES)}},{key:"sortCategories",value:function(t){var e=this;t.sort((function(t,n){var i=t.type.toUpperCase(),a=n.type.toUpperCase();return e.categoryOrder.indexOf(i)-e.categoryOrder.indexOf(a)}))}},{key:"sortHaveOrOwe",value:function(t,e,n){var i=(0,a.default)({},t),s=i.type;return s===this.ACCT_TYPES.CHEQUING||s===this.ACCT_TYPES.SAVINGS||s===this.ACCT_TYPES.MUTUAL_FUND?i.account_balance>=0?e.push(i):(i.account_balance*=-1,n.push(i)):s===this.ACCT_TYPES.CREDIT_CARD?i.account_balance>=0?n.push(i):i.account_balance<0&&(i.account_balance*=-1,e.push(i)):s!==this.ACCT_TYPES.LOAN&&s!==this.ACCT_TYPES.MORTGAGE||n.push(i),[e,n]}},{key:"setMultiCheckingAccount",value:function(t){this.checkingAccountsCount=t}},{key:"hasCheckingAccounts",value:function(){return void 0===this.checkingAccountsCount?"undefined":this.checkingAccountsCount>0}},{key:"isMultiCheckingAccount",value:function(){return this.checkingAccountsCount>1}},{key:"setMultiCreditCardAccount",value:function(t){this.creditCardAccountsCount=t}},{key:"hasCreditCardAccounts",value:function(){return this.creditCardAccountsCount>0}},{key:"setMultiSavingAccount",value:function(t){this.savingAccountsCount=t}},{key:"hasSavingAccounts",value:function(){return this.savingAccountsCount>0}},{key:"setIsCIFBusiness",value:function(t){this.isBusiness=t}},{key:"getAccountAggregationCapabilities",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_ACCOUNT_SUMMARY_AGGREGATION_CAPABILITY)}},{key:"getAccountAggregationAvailability",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_IS_ACCOUNT_AGGREGATION_AVAILABLE)}},{key:"getAggregatedAccountsPromise",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_ACCOUNT_AGGREGATION_SUMMARY,{urlVars:{queryString:"caller=ACCOUNT_SUMMARY&source=internal&include_logo="+!0}},{resetCache:!0})}},{key:"mapExternalAccounts",value:function(t){var e=this;return t.map((function(t){var n=(0,i.default)({},t,{display_name:t.account_number,number:t.account_number,currency_type:t.currency,nickname:t.institution_description,subCategoryName:e.ACTIVE});return n.accountName=e.AccountHelpersService.getDisplayNameInstant(n),n.type=e.ACCOUNT_CATEGORIES.EXTERNAL,n}))}},{key:"getScheduledPayments",value:function(t,e){var n=this;var i={urlVars:{queryString:null}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.PENDING_TRANSACTIONS,i).then((function(t){if(t&&t.pending_transactions)return e?t.pending_transactions.filter((function(t){return t.type===n.TRANSACTION_TYPE_CODES[n.TRANSACTION_TYPE_FILTER_MAP.automaticSavingProgram]||t.asp})):t.pending_transactions}))}},{key:"getCurrentRecipes",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_CURRENT_RECIPES)}},{key:"isCIFBusiness",get:function(){return this.isBusiness}},{key:"totalAssetsUnderManagement",get:function(){var t=this,e=0;return this.allAccounts&&(e=this.allAccounts.reduce((function(e,n){return-1!==[t.ACCT_TYPES.CHEQUING,t.ACCT_TYPES.MORT_WEB,t.ACCT_TYPES.MORT_DAWT,t.ACCT_TYPES.LOAN,t.ACCT_TYPES.CREDIT_CARD,t.ACCT_TYPES.RSPLOAN,t.ACCT_TYPES.MORTGAGE].indexOf(n.type)?e:e+n.account_balance}),0)),e}}]),t}();h.$inject=["$filter","RequesterService","accountConstants","serviceConstants","$log","EnvironmentService","AccountHelpersService","UserService","$q","transactionConstants"],e.default=h,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(365)),a=o(n(0)),s=o(n(2)),r=n(1797);function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n){(0,a.default)(this,t),this.$log=n,this.accountConstants=e,this.ACCOUNT_LIST=e.ACCOUNT_LIST,this.PROGRESS_LIST=e.PROGRESS_LIST;var s=(0,i.default)(this.ACCOUNT_LIST).find((function(t){return t.DEFAULT}));this.selectedAccountTabsSubject=new r.BehaviorSubject(s.NAME),this.selectedProgressTabsSubject=new r.Subject}return(0,s.default)(t,[{key:"selectedAccountTabsSubject$",value:function(){return this.selectedAccountTabsSubject}},{key:"selectedProgressTabsSubject$",value:function(){return this.selectedProgressTabsSubject}}]),t}();c.$inject=["accountConstants","$log"],e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=h(n(15)),a=h(n(365)),s=h(n(8)),r=h(n(177)),o=h(n(0)),c=h(n(2)),l=h(n(264)),u=h(n(265)),d=h(n(531));function h(t){return t&&t.__esModule?t:{default:t}}var f=function(t){function e(t,n,i,a,s,c,u,d,h,f,p,g,m){(0,o.default)(this,e);var _=(0,l.default)(this,(e.__proto__||(0,r.default)(e)).call(this,i,d,a,t,n,s,c,h,f,p));return _.RspLoanConstants=u,_.ExistingClientOnboardingConstants=p,_.DateService=g,_.REQUIRES_OCCUPATION=m.REQUIRES_OCCUPATION,_.translateFilter=a("translate"),_}return(0,u.default)(e,t),(0,c.default)(e,[{key:"getCustomEligibilityErrorMessage",value:function(t){return angular.isNumber(t.available_amount)&&t.available_amount<this.RspLoanConstants.CREDIT_LIMIT_DEFAULTS.MIN?{title:"rspLoan.details.description.insufficientAmountTitle",message:"rspLoan.details.description.insufficientAmount"}:null}},{key:"getFirstPaymentDateRange",value:function(t){var e=this,n={urlVars:{queryString:"loan_term="+t.serverCode+"&date_range=true"}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.RSP_LOAN_PAYMENT_CALCULATOR,n).then((function(n){if(n.response_status.status_code!==e.serviceConstants.STATUS_CODES.SUCCESS)throw e.$log.error("RSP Loan enrollment getFirstPaymentDateRange response error:",n),n;return e.$log.debug("RSP Loan enrollment getFirstPaymentDateRange response retrieved",n),t.firstPaymentMinDate=e.DateService.serverFormatToMoment(n.first_available_date),t.firstPaymentMaxDate=e.DateService.serverFormatToMoment(n.last_available_date),t.advanceDate=n.current_advance_date,n})).catch((function(t){throw e.$log.error("RSP Loan enrollment getFirstPaymentDateRange error:",t),t}))}},{key:"calculatePayment",value:function(t,e,n){var i=this,a=this.DateService.momentToServerFormat(n),s={urlVars:{queryString:"loan_amount="+t+"&loan_term="+e.serverCode+"&first_payment_date="+a+"&advance_date="+e.advanceDate}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.RSP_LOAN_PAYMENT_CALCULATOR,s).then((function(t){if(t.response_status.status_code!==i.serviceConstants.STATUS_CODES.SUCCESS)throw i.$log.error("RSP Loan enrollment calculatePayment response error:",t),t;return i.$log.debug("RSP Loan enrollment payment calculator response retrieved",t),t})).catch((function(t){throw i.$log.error("RSP Loan enrollment payment calculator error:",t),t}))}},{key:"getRspLoanAllowedDestAccounts",value:function(){var t=this;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_RSP_LOAN_ALLOWED_ALLOCATION_ACCOUNTS).then((function(e){if(e.response_status.status_code!==t.serviceConstants.STATUS_CODES.SUCCESS&&e.response_status.status_code!==t.serviceConstants.STATUS_CODES.NO_DATA)throw t.$log.error("RSP Loan enrollment get allowed destination accounts response error:",e),e;return t.$log.debug("RSP Loan enrollment get allowed destination accounts response retrieved",e),e})).catch((function(e){throw t.$log.error("RSP Loan enrollment get allowed destination accounts error:",e),e}))}},{key:"createApplication",value:function(t,e){var n=this;this._setPayload(t,e);var i={data:this._payload};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.CREATE_RSP_LOAN_APPLICATION,i).then((function(t){if(t.response_status.status_code!==n.serviceConstants.STATUS_CODES.CREATED)throw n.$log.error("Create RSP-loan application response error:",t),t;return n.$log.debug("RSP-loan application was created successfully",t),t.deal_id})).catch((function(t){throw n.$log.error("Create RSP-loan application error:",t),t}))}},{key:"getApplication",value:function(t,e){var n=this,i=this.serviceConstants.AVAILABLE_SERVICES.GET_RSP_LOAN_APPLICATION,a={urlVars:{dealId:e.dealId}};return this.RequesterService.request(i,a).then((function(i){if(i.response_status.status_code!==n.serviceConstants.STATUS_CODES.SUCCESS)throw n.$log.error("Get RSP-loan application response error:",i),i;return n._payload=angular.copy(i),delete n._payload.response_status,delete n._payload.responseHeaders,n._setupApplicationUIModel(t,e),n.$log.debug("RSP-loan application was retrieved successfully",i),i})).catch((function(t){throw n.$log.error("Get RSP-loan application error:",t),t}))}},{key:"getPAL",value:function(t){var e=this,n=this.serviceConstants.AVAILABLE_SERVICES.GET_RSP_PAL_APPLICATION,i={urlVars:{dealId:t.rspLoanPalDealId}};return this.RequesterService.request(n,i).then((function(n){if(n.response_status.status_code!==e.serviceConstants.STATUS_CODES.SUCCESS)throw e.$log.error("Get RSP PAL response error:",n),n;return e._payload=angular.copy(n),e._setupPALUIModel(t),e.$log.debug("Get RSP PAL retrieved successfully",n),n})).catch((function(t){throw e.$log.error("Get RSP PAL error:",t),t}))}},{key:"_isPalRsp",value:function(t){return!!t.rspLoanPalDealId}},{key:"getAvailablePAL",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.getPostApprovals,i=void 0!==n&&n,a=this.serviceConstants.AVAILABLE_SERVICES.GET_RSP_LOAN_AVAILABLE_PAL;return this.RequesterService.request(a).then((function(e){if(e&&e.response_status&&e.response_status.status_code===t.serviceConstants.STATUS_CODES.NO_DATA)return t.$log.debug("Get RSP-loan applications (PALs) response: NO DATA:",e),i?[]:null;if(e.code!==t.serviceConstants.STATUS_CODES.SUCCESS)throw t.$log.error("Get RSP-loan applications (PALs) response error:",e),e;t.$log.debug("Get RSP-loan applications (PALs) was retrieved successfully",e);var n=t.RspLoanConstants.APPROVAL_TRANSACTION_TYPES.preApproval;if(i)return e.rsp_credit_applications.filter((function(t){return t.transaction_type!==n}));var a=e.rsp_credit_applications.find((function(t){return t.transaction_type===n}));return a&&t._addApplicationProperties(a),a})).catch((function(e){throw t.$log.error("Get RSP-loan applications (PALs) error:",e),e}))}},{key:"_addApplicationProperties",value:function(t){t.isCloned=angular.isString(t.pal_ref_num)&&t.pal_ref_num.length>0&&t.pal_ref_num.indexOf("_")>=0}},{key:"updateApplication",value:function(t,e,n,i){var a=this,r=this._getRequestDataForApplication(e,n,i.applicationState),o=this.serviceConstants.AVAILABLE_SERVICES.UPDATE_RSP_LOAN_APPLICATION,c={data:r,urlVars:{dealId:e.dealId}};return this.RequesterService.request(o,c).then((function(n){if(n.response_status.status_code!==a.serviceConstants.STATUS_CODES.SUCCESS)throw a.$log.error("Update RSP-loan application response error:",n),n;return n.confirmation&&(e.confirmation||(e.confirmation={}),(0,s.default)(e.confirmation,n.confirmation,{deal_id:e.dealId})),a._payload=angular.copy(n),delete a._payload.response_status,delete a._payload.confirmation,delete a._payload.responseHeaders,a._setupApplicationUIModel(t,e,i.applicationState),a.$log.debug("RSP-loan applicaton was updated successfully",n),n}))}},{key:"submitPAL",value:function(t,e){var n=this,i=this._getRequestDataForPal(t,e),a=this.serviceConstants.AVAILABLE_SERVICES.SUBMIT_RSP_PAL_APPLICATION,s={data:i,urlVars:{dealId:t.rspLoanPalDealId}};return this.RequesterService.request(a,s).then((function(e){if(e.response_status.status_code!==n.serviceConstants.STATUS_CODES.SUCCESS)throw n.$log.error("Submit PAL response error:",e),e;return t.confirmation={new_account_number:e.rsp_loan_account_number,deal_id:e.rsp_pal_application.deal_id},n._payload=e,n._setupPALUIModel(t),n.$log.debug("PAL submitted successfully",e),e}))}},{key:"retrieveFromAccounts",value:function(){var t=this;return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_RSP_LOAN_PAYMENT_FROM_ACCOUNTS).then((function(e){if(e.response_status.status_code!==t.serviceConstants.STATUS_CODES.SUCCESS&&e.response_status.status_code!==t.serviceConstants.STATUS_CODES.NO_DATA)throw t.$log.error("Get RSP from account response error:",e),e;return e}))}},{key:"_setPayload",value:function(t,e){this._payload={validate_only:!1,validate_client_eligibility:!1,application:{loan_detail:{transaction_type:e.selectedTerm.transactionType,amount_requested:parseInt(e.loanAmount,10),payment_amount:e.monthlyPayment,registration_type:this.RspLoanConstants.APP_REGISTRATION_TYPE.SINGLE},legal_instructions:{consent_credit_bureau:e.personalInfoConsent,electronic_documents_selected:e.eDocsAgreement,third_party:!!e.thirdParty}}},this._payload.application.legal_instructions.third_party&&(this._payload.application.legal_instructions.third_party_info=this.AccountPayload.getThirdPartyInfo(e)),this.$log.debug(t),this.$log.debug(e)}},{key:"_getRequestDataForPal",value:function(t,e){var n=this._payload.rsp_pal_application;n.amount=parseInt(t.loanAmount,10),n.payment_source=t.selectedFromAccount.display_name,n.payment_date=this.DateService.momentToServerFormat(t.firstPaymentDate),n.loan_term=t.selectedTerm.paymentNumber.toString().concat("M"),n.existing_rsp_isa=!0,n.existing_rsp_isa_investment_amount=n.amount,n.existing_rsp_isa_account=t.rspLoanPayoutAccount.display_name,n.agrees_to_econsent=!0,n.agrees_to_edelivery=!0,n.new_rsp_isa=!1,n.new_st_rsp_gic=!1,n.new_lt_rsp_gic=!1;var i={rsp_pal_application:n,submit_application:!0,legal_instructions:{}};return e&&this._fillPayloadWithEmployerInfo(i,t.crtEmployer,!0,!0),t.thirdParty?(i.legal_instructions.third_party_info=this.AccountPayload.getThirdPartyInfo(t),i.legal_instructions.third_party=!0):i.legal_instructions.third_party=!1,i}},{key:"_getRequestDataForApplication",value:function(t,e,n){var i=this,r=this._payload;delete r.cache_status;var o=r.application,c=o.loan_detail,l=o.legal_instructions,u=o.applicants.find((function(t){return t.cif===i.RspLoanConstants.CURRENT_APPLICANT_CIF})),d=u.financial,h=d.asset_detail_list,f=d.liability_detail_list;t.thirdParty?(l.third_party_info=this.AccountPayload.getThirdPartyInfo(t),l.third_party=!0):(delete l.third_party_info,l.third_party=!1),t.selectedTerm&&t.loanAmount&&t.monthlyPayment&&(0,s.default)(c,{amount_requested:parseInt(t.loanAmount,10),payment_amount:t.monthlyPayment}),t.crtAddressInfo&&(u.address=[this._generateAddressInfoForPayload(t.crtAddressInfo,!0)]),t.crtAddressInfo&&!t.crtAddressInfo.livedAtLeastTwoYears&&t.prevAddressInfo&&t.prevAddressInfo.address&&(u.address||(u.address=[]),u.address.push(this._generateAddressInfoForPayload(t.prevAddressInfo,!1))),t.householdInfo&&(0,s.default)(u,{marital_status:t.householdInfo.maritalStatus.code,number_of_dependant:t.householdInfo.numOfDependents}),u.income=[],t.crtEmployer&&this._fillPayloadWithEmployerInfo(u,t.crtEmployer,!0),t.prevEmployer&&t.crtEmployer&&t.crtEmployer.workDurationYears.key<2?this._fillPayloadWithEmployerInfo(u,t.prevEmployer,!1):delete u.previous_employer,t.otherIncomeSources&&t.additionalIncomeSources&&t.additionalIncomeSources.forEach((function(e){var n={income_amount:parseFloat(e.amount),income_source:e.incomeType.code,description:e.sourceName,frequency:e.frequency.code};e.sequenceNumber&&(n.sequence_number=e.sequenceNumber);var s=(0,a.default)(i.ExistingClientOnboardingConstants.ADDITIONAL_INCOMES_LINK_TO_EMPLOYER);e.employerSequenceNumber?n.employer_sequence_num=e.employerSequenceNumber:-1!==s.indexOf(e.incomeType.code)&&t.crtEmployer&&t.crtEmployer.sequenceNumber&&(n.employer_sequence_num=t.crtEmployer.sequenceNumber),u.income.push(n)})),t.externalAssets&&(h.client_input=t.externalAssets.map((function(t){return i._mapAssetFrontEndToBackEnd(t)}))),t.externalLiabilities&&(f.client_input=t.externalLiabilities.map((function(t){return i._mapLiabilityFrontEndToBackEnd(t)}))),l.terms_and_conditions_accepted=!0;var p=(0,s.default)({},r,{validate_only:!1});return n&&(p.application_state=n),p}},{key:"_fillPayloadWithEmployerInfo",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.employmentStatusCode===d.default.CODES.EMPLOYED||e.employmentStatusCode===d.default.CODES.SELF_EMPLOYED,s=e.employmentStatusCode===d.default.CODES.RETIRED,r={};if(e.sequenceNumber&&(r.sequence_number=e.sequenceNumber),a&&e.employerName&&(r.employer_name=e.employerName),e.industryCode&&(r.industry=e.industryCode),e.employmentStatusCode&&(r.occupation_status=e.employmentStatusCode),e.occupationCode&&(r.occupation=e.occupationCode),a&&e.industryYears&&(r.years_in_line_of_bus=e.industryYears,r.months_in_line_of_bus=0),e.workDurationYears&&(r.years_of_employment=e.workDurationYears.key),e.workDurationMonths&&(r.months_of_employment=e.workDurationMonths.key),a&&e.employerAddress&&(r.employer_adress=angular.copy(e.employerAddress),r.employer_adress.street_name=r.employer_adress.address_line1,delete r.employer_adress.address_line1,r.employer_adress.province&&(r.employer_adress.state=r.employer_adress.province,delete r.employer_adress.province),r.employer_adress.suite&&(r.employer_adress.appartment=r.employer_adress.suite,delete r.employer_adress.suite)),a&&e.number){var o={phone_number:e.number};!i&&e.extension&&(o.extension=e.extension),r.employer_contact_phone=o}if(i?t.employer_detail=r:n?t.current_employer=r:t.previous_employer=r,!i){var c=a||s?e.incomeWithoutBonus:0,l=a&&e.incomeBonus?e.incomeBonus:0,u=s?"12":"1",h=s?"Retired":null;c>0&&this._fillEmploymentIncome(e,c,t.income,!1,u,h),l>0&&this._fillEmploymentIncome(e,l,t.income,!0,u)}}},{key:"_fillEmploymentIncome",value:function(t,e,n,i,a,s){var r={income_source:i?this.ExistingClientOnboardingConstants.EMPLOYER_INCOME.BONUS:this.ExistingClientOnboardingConstants.EMPLOYER_INCOME.SALARY,description:i?"Bonus from "+t.employerName:"Salary from "+t.employerName,income_amount:""+e,frequency:a};s&&(r.description=s),t.sequenceNumber?r.employer_sequence_num=t.sequenceNumber:r.employer_sequence_num=t.employerName,i?t.incomeBonusSequenceNumber&&(r.sequence_number=t.incomeBonusSequenceNumber):t.incomeWithoutBonusSequenceNumber&&(r.sequence_number=t.incomeWithoutBonusSequenceNumber),n.push(r)}},{key:"_generateAddressInfoForPayload",value:function(t,e){var n=this.generateAddressPayload(t,e);return n.at_least_two_years=!e||t.livedAtLeastTwoYears,e&&t.addressStatus&&(n.home_status=t.addressStatus.code),n}},{key:"_setupPALUIModel",value:function(t){var e=this._payload,n=e.rsp_pal_application,i=e.legal_instructions;t.dealId=n.deal_id,t.approvedAmount=n.approve_amount,t.interestRate=n.interest_rate,t.costOfBorrowingConfirmed=n.cost_of_borrowing,t.monthlyPaymentConfirmed=n.monthly_payment,t.isPreApproval=n.application_type===this.RspLoanConstants.APPROVAL_TRANSACTION_TYPES.preApproval,t.isPostApproval=!t.isPreApproval,t.isPostApproval&&i&&(t.thirdParty=i.third_party,t.thirdParty&&i.third_party_info&&(t.third_party_info=i.third_party_info))}},{key:"_setupApplicationUIModel",value:function(t,e,n){var a=this,r=this._payload.application,o=r.loan_detail,c=r.legal_instructions,l=r.applicants.find((function(t){return t.cif===a.RspLoanConstants.CURRENT_APPLICANT_CIF})),u=l.marital_status,d=l.number_of_dependant,h=l.address,f=l.income,p=l.current_employer,g=l.previous_employer,m=l.financial,_=m.asset_detail_list,v=_.tng_accounts,S=_.client_input,T=m.liability_detail_list,y=T.tng_accounts,E=T.client_input;if(e.personalInfoConsent=c.consent_credit_bureau,e.thirdParty=c.third_party,c.third_party&&c.third_party_info&&(e.third_party_info||(e.third_party_info={}),(0,s.default)(e.third_party_info,c.third_party_info)),o){e.loanAmount=""+o.amount_requested;var A=this.RspLoanConstants.TERMS;e.selectedTerm=A[(0,i.default)(A).find((function(t){return A[t].transactionType===o.transaction_type}))],e.firstPaymentDate=e.selectedTerm.firstPaymentMaxDate,e.monthlyPayment=o.payment_amount}e.householdInfo||(e.householdInfo={}),u&&(e.householdInfo.maritalStatus=e.maritalStatusOptions.find((function(t){return t.code===u}))),(d||(""+d).length>0)&&(e.householdInfo.numOfDependents=d),h&&!n&&h.forEach((function(t){a._setupAddressInfoUIModel(t,e)})),n&&n!==this.RspLoanConstants.STATES.ASSETS.applicationState||this._processAssetsFromService(e,v,S),n&&n!==this.RspLoanConstants.STATES.LIABILITIES.applicationState||this._processLiabilitiesFromService(e,y,E),p&&(e.crtEmployer||(e.crtEmployer={}),this._setupEmployerUIModel(e.crtEmployer,p,f,e)),g&&(e.prevEmployer||(e.prevEmployer={}),this._setupEmployerUIModel(e.prevEmployer,g,f,e)),this._setUpAdditionalIncome(e,f)}},{key:"_setUpCreditInfo",value:function(t,e){e&&(t.creditInfo={},e.judgement_collection_type&&(t.creditInfo.collectionType={serverCode:e.judgement_collection_type},e.credit_latenessType&&(t.creditInfo.paymentLatenessType={serverCode:e.credit_latenessType}),t.creditInfo.bankruptcyDischargeYears=e.years_since_bankruptcy))}},{key:"generateEmploymentAndIncomeInfo",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!t)return null;var a=[],s=t&&(t.employmentStatusCode===d.default.CODES.EMPLOYED||t.employmentStatusCode===d.default.CODES.SELF_EMPLOYED),r=t&&t.employmentStatusCode===d.default.CODES.RETIRED,o=!(!t||!t.employmentStatusCode)&&this.REQUIRES_OCCUPATION[t.employmentStatusCode],c=!(!e||!e.employmentStatusCode)&&this.REQUIRES_OCCUPATION[e.employmentStatusCode];if(a.push({label:this.translateFilter("rspLoan.review.occupationStatus"),html:t.employmentStatus?t.employmentStatus.name:""}),o&&a.push({label:this.translateFilter("rspLoan.review.industry"),html:t.industry?t.industry.name:""},{label:this.translateFilter("rspLoan.review.occupation"),html:t.occupation?t.occupation.name:""},{label:this.translateFilter("rspLoan.review.employerName"),html:t.employerName}),t.employmentStatus&&t.employmentStatus.require_employment_details&&a.push({label:this.translateFilter("rspLoan.review.employerAddr"),html:this.generateAddressDisplayText(t.employerAddress,"rspLoan.review.unitNo")},{label:this.translateFilter("rspLoan.review.employerPhoneNo"),html:t.number?t.number:""}),!i){var l=void 0;switch(t.employmentStatusCode){case d.default.CODES.STUDENT:l="timeAsStudent";break;case d.default.CODES.RETIRED:l="timeRetired";break;case d.default.CODES.HOMEMAKER:l="timeAsHomemaker";break;case d.default.CODES.UNEMPLOYED:l="timeUnemployed";break;default:l="timeEmployed"}a.push({label:this.translateFilter("rspLoan.review."+l),html:(t.workDurationYears?t.workDurationYears.value:"")+" "+(t.workDurationMonths?t.workDurationMonths.value:"")})}return i||!s&&!r||a.push({label:r?this.translateFilter("rspLoan.review.monthlyGrossIncome"):this.translateFilter("rspLoan.review.incomeWithoutBusiness"),html:this.currencyFilter(t.incomeWithoutBonus)}),!i&&s&&a.push({label:this.translateFilter("rspLoan.review.bonus"),html:this.currencyFilter(t.incomeBonus?t.incomeBonus:0)}),!i&&e&&this.needPrevEmployerInfo&&(a.push({label:this.translateFilter("rspLoan.review.prevOccupationStatus"),html:e.employmentStatus?e.employmentStatus.name:""}),c&&a.push({label:this.translateFilter("rspLoan.review.prevIndustry"),html:e.industry?e.industry.name:""},{label:this.translateFilter("rspLoan.review.prevOccupation"),html:e.occupation?e.occupation.name:""},{label:this.translateFilter("rspLoan.review.prevEmployerName"),html:e.employerName?e.employerName:""}),e.employmentStatus&&e.employmentStatus.require_employment_details&&a.push({label:this.translateFilter("rspLoan.review.prevEmployerAddress"),html:this.RspLoanService.generateAddressDisplayText(e.employerAddress,"rspLoan.review.unitNo")},{label:this.translateFilter("rspLoan.review.prevEmployerPhoneNo"),html:e.number?e.number:""})),i||a.push({label:this.translateFilter("rspLoan.review.otherIncomeSource"),html:n?this.translateFilter("global.yes"):this.translateFilter("global.no")}),a}}]),e}(h(n(2157)).default);f.$inject=["RequesterService","serviceConstants","$log","$filter","ReferenceDataService","referenceDataConstants","RspLoanConstants","$q","AccountHelpersService","tpiFormConstants","ExistingClientOnboardingConstants","DateService","ccIncomeVerificationConstants"],e.default=f,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={STATES:{INTRO:{_name:"intro"},TPI:{_name:"tpi",applicationState:"LOAN_DETAIL"},DETAILS:{_name:"details",applicationState:"LOAN_DETAIL"},CREDIT_INFO:{_name:"creditInfo",applicationState:"CREDIT_INFO"},HOME_STATUS:{_name:"homeStatus",applicationState:"ADDRESS"},EMPLOYMENT:{_name:"employment",applicationState:"EMPLOYMENT"},ADDITIONAL_INCOME:{_name:"additionalIncome",applicationState:"INCOME"},ASSETS:{_name:"assets",applicationState:"ASSETS"},LIABILITIES:{_name:"liabilities",applicationState:"LIABILITIES"},REVIEW:{_name:"review",applicationState:"SUBMIT"},APPROVED_INTRO:{_name:"approved_intro"},APPROVED_DETAILS:{_name:"approved_details"},APPROVED_EMPLOYMENT:{_name:"approved_employment"},APPROVED_FROM_ACCOUNT:{_name:"approved_from_account"},APPROVED_ALLOCATION:{_name:"approved_allocation"},APPROVED_REVIEW:{_name:"approved_review"}},APPLICATION_TYPES:{PRIMARY:"PR",CO_APPLICANT:"CO"},TERMS:{payment12:{header:"rspLoan.details.loanTerm.term.payment12.title",subHeader:"rspLoan.details.loanTerm.term.payment12.description",serverCode:"TwelveMonthsTerm",paymentNumber:12,transactionType:"RST"},payment9:{header:"rspLoan.details.loanTerm.term.payment9.title",subHeader:"rspLoan.details.loanTerm.term.payment9.description",serverCode:"NineMonthsTerm",paymentNumber:9,transactionType:"RSN"}},CREDIT_LIMIT_DEFAULTS:{MIN:100,MAX:15e3},FLOW_TYPES:{APPLICATION:{localeCode:"application"},POST_APPROVAL:{localeCode:"postApproval"},PRE_APPROVAL:{localeCode:"preApproval"},PRE_APPROVAL_CLONE:{localeCode:"preApprovalClone"}},APP_REGISTRATION_TYPE:{SINGLE:"SING",JOINT_COAPP:"JCAP",JOINT_GUARANTOR:"JGUR"},CREDIT_COLLECTION_TYPE:{NONE:{localizationCode:"rspLoan.creditInfo.bankruptcyOpt.none",serverCode:"0"},YES_0_TO_1000:{localizationCode:"rspLoan.creditInfo.bankruptcyOpt.yes_0_to_1000",serverCode:"1"},YES_1000_TO_2000:{localizationCode:"rspLoan.creditInfo.bankruptcyOpt.yes_1000_to_2000",serverCode:"2"},YES_2000_TO_ABOVE:{localizationCode:"rspLoan.creditInfo.bankruptcyOpt.yes_2000_to_above",serverCode:"3"}},CREDIT_LATENESS_TYPE:{NEVER:{localizationCode:"rspLoan.creditInfo.latePaymentOpt.never",serverCode:"NE"},OCCASIONALLY:{localizationCode:"rspLoan.creditInfo.latePaymentOpt.occasionally",serverCode:"OC"},FREQUENTLY:{localizationCode:"rspLoan.creditInfo.latePaymentOpt.frequently",serverCode:"UF"}},APPROVAL_TRANSACTION_TYPES:{preApproval:"RPA",postApprovalNine:"RSN",postApprovalTwelve:"RST"},EMPLOYER_EMPLOYMENT_STATUS_CODES:{CURRENT_EMPLOYER:"C",PREVIOUS_EMPLOYER:"P"},CURRENT_APPLICANT_CIF:"my"},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=h(n(5257)),a=h(n(5261)),s=h(n(5265)),r=h(n(5269)),o=h(n(5273)),c=h(n(5277)),l=h(n(5281)),u=h(n(5285)),d=h(n(5289));function h(t){return t&&t.__esModule?t:{default:t}}var f=angular.module("tangerine.etransfer.send.module",[]).component("tngSendEtransferDialog",d.default).component("tngEtransferEntry",i.default).component("tngEtransferAgreement",a.default).component("tngEtransferSetup",s.default).component("tngEtransferEditContact",r.default).component("tngEtransferDeleteContact",o.default).component("tngEtransferQandA",c.default).component("tngEtransferReview",l.default).component("tngEtransferDone",u.default);e.default=f,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5258)),a=s(n(5259));function s(t){return t&&t.__esModule?t:{default:t}}n(5260);var r={template:a.default,controller:i.default,bindings:{}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a=n(178),s=function(){function t(t,e,n,i,a,s,r,o,c){this.$log=t,this.localeConstants=e,this.LocaleService=n,this.CustomersService=i,this.eTransferDialogConstants=a,this.$ngRedux=s,this.$timeout=r,this.$q=o,this.AnalyticsService=c,this.ETRANSFER_TYPES=this.eTransferDialogConstants.ETRANSFER_TYPES,this.ETRANSFER_CONSENT_TYPES=this.eTransferDialogConstants.ETRANSFER_CONSENT_TYPES,this.shortHandLocale=this.localeConstants.SHORTHAND_LOCALE[this.LocaleService.locale]}return t.prototype.$onInit=function(){var t=this;return this.stateUnsubscriber=this.$ngRedux.connect(this._mapStateToThis.bind(this),i({},a.EtransferFlowActions))(this),this.updateLoadingState(!0),this.interacAgreementAccepted=this.flow.transferDetail.interacAgreementAccepted,this._setButtons(),this.AnalyticsService.sendAction(this.AnalyticsService.availableEvents.FLOW_STATE_CHANGE,this.flow.analyticsPath),this._getInteracConsent().finally((function(){t.updateLoadingState(!1),t._setPageFocus()}))},t.prototype._setButtons=function(){this.setFlowButtons([{label:"global.components.buttons.cancel",action:this.cancelTransfer,class:"btn btn--edit",name:"eTransfer_cancel"}])},t.prototype._getInteracConsent=function(){var t=this;return this.interacAgreementAccepted?this.$q.resolve(this.interacAgreementAccepted):this.CustomersService.getCustomerConsents().then((function(e){var n=e.consents.find((function(e){return e.name===t.ETRANSFER_CONSENT_TYPES.INTERAC}));n&&(t.interacAgreementAccepted="Y"===n.value)})).catch((function(e){t.$log.error("error fetching customer consents:",e)}))},t.prototype._setPageFocus=function(){var t=this;return this.$timeout((function(){t.onMouseDownBinding=t._onMouseDown.bind(t),t.onMouseUpBinding=t._onMouseUp.bind(t),document.addEventListener("mousedown",t.onMouseDownBinding),document.addEventListener("mouseup",t.onMouseUpBinding),t.elementFocusBinding=t._onElementFocus.bind(t),t.tabElements=document.querySelectorAll(".tangerine-accessible"),t.tabElements.forEach((function(e){e.addEventListener("focus",t.elementFocusBinding)})),document.getElementById("etransfer-choose-type").focus()}))},t.prototype._onMouseDown=function(){this.isMouseDown=!0},t.prototype._onMouseUp=function(){this.isMouseDown=!1},t.prototype._onElementFocus=function(t){this.isMouseDown&&t.target.blur()},t.prototype.onInteracClick=function(){this.gotoSetup({eTransferType:this.ETRANSFER_TYPES.INTERAC_EMT,interacAgreementAccepted:this.interacAgreementAccepted,contactView:!0,eTransferTypeChanged:this.flow.transferDetail.eTransferType!==this.ETRANSFER_TYPES.INTERAC_EMT})},t.prototype.onTangerineEmtClick=function(){this.gotoSetup({eTransferType:this.ETRANSFER_TYPES.TANGERINE_EMT,interacAgreementAccepted:this.interacAgreementAccepted,contactView:!0,eTransferTypeChanged:this.flow.transferDetail.eTransferType!==this.ETRANSFER_TYPES.TANGERINE_EMT})},t.prototype._mapStateToThis=function(t){return{flow:t.etransferFlow}},t.prototype.$onDestroy=function(){var t=this;this.stateUnsubscriber&&this.stateUnsubscriber(),document.removeEventListener("mousedown",this.onMouseDownBinding),document.removeEventListener("mouseup",this.onMouseUpBinding),this.tabElements.forEach((function(e){e.removeEventListener("focus",t.elementFocusBinding)}))},t}();s.$inject=["$log","localeConstants","LocaleService","CustomersService","eTransferDialogConstants","$ngRedux","$timeout","$q","AnalyticsService"],e.default=s},function(t,e){t.exports=' <div ng-if="!$ctrl.flow.loading" class="e-transfer-entry-container"> <p id="etransfer-choose-type" tabindex="0">{{ ::\'emt.entry.choseType\' | translate }}</p> <div class="c-tile c-tile--round"> <a class="e-transfer-block" href="" ng-click="$ctrl.onInteracClick()"> <tng-tile-item class="c-tile--md" id="tile-item-interac"> <div class="tile-section"> <div class="e-transfer-entry-flex"> <h1 class="e-transfer-entry-medium-font margin-bot-0" ng-bind-html="::\'emt.entry.interac\' | translate"></h1> <tng-help-bubble class="icon-center"> <span translate="emt.entry.interacBubble"></span> </tng-help-bubble> </div> <p class="e-transfer-entry-very-small-font">{{ ::\'emt.entry.free\' | translate }}</p> </div> <div class="tile-section align-right"> <span class="tile-section__arrow tile-section__arrow--large icon-rightarrow"></span> </div> </tng-tile-item> </a> </div> <div class="e-transfer-entry-tangerine"> <span> <span translate="emt.entry.tangerineLink"/> <tng-help-bubble class="e-transfer-entry-recertify-help-bubble"> {{ ::\'emt.entry.emailMoneyBubble\' | translate }} </tng-help-bubble> </span> </div> <p class="e-transfer-entry-disclaimer" ng-bind-html="\'emt.setupPayment.disclaimer\' | translate"></p> <p class="e-transfer-entry-interac-logo"><img ng-src="{{::\'assets/images/logo_interac_\' + $ctrl.shortHandLocale  + \'.png\'}}" alt="Interac"></p> <p class="e-transfer-entry-interac-trademark" ng-bind-html="\'emt.setupPayment.interacTrademark\' | translate"></p> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5262));function a(t){return t&&t.__esModule?t:{default:t}}n(5263);var s={template:a(n(5264)).default,controller:i.default,bindings:{}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a=n(178),s=function(){function t(t,e,n,i,a){this.$log=t,this.$ngRedux=e,this.CustomersService=n,this.eTransferDialogConstants=i,this.AnalyticsService=a,this.submitErrors=[],this.ETRANSFER_CONSENT_TYPES=this.eTransferDialogConstants.ETRANSFER_CONSENT_TYPES}return t.prototype.$onInit=function(){this.stateUnsubscriber=this.$ngRedux.connect(this.mapStateToThis.bind(this),i({},a.EtransferFlowActions))(this),this.interacAgreementConfirmation=this.flow.transferDetail.interacAgreementAccepted,this.setFlowButtons([{label:"global.components.buttons.back",action:this.onBackButtonClick.bind(this),class:"btn btn--edit",name:"eTransfer_back"},{label:"global.components.buttons.accept",action:this.onAcceptButtonClick.bind(this),class:"btn btn--orange",name:"eTransfer_accept",isDisabled:this.updateAcceptButton.bind(this)}]),this.AnalyticsService.sendAction(this.AnalyticsService.availableEvents.FLOW_STATE_CHANGE,this.flow.analyticsPath)},t.prototype.updateAcceptButton=function(){return!this.interacAgreementConfirmation},t.prototype.onAcceptButtonClick=function(){var t=this;return this.$log.debug("Call accept Interac TermsAndConditions"),this.updateLoadingState(!0),this.CustomersService.putCustomerConsents({consent:{name:this.ETRANSFER_CONSENT_TYPES.INTERAC,value:"Y"}}).then((function(){t.acceptInteracAgreement({interacAgreementAccepted:!0})})).catch((function(e){t.$log.error("Save consents: service error",e),t.showSubmitErrors(e)})).finally((function(){t.updateLoadingState(!1)}))},t.prototype.showSubmitErrors=function(t){var e=this;"errorMessage"in t?this.submitErrors.push(t.errorMessage):"details"in t.response_status&&t.response_status.details.forEach((function(t){e.submitErrors.push(t)})),this.$log.error("eTransfer Agreement error:",this.submitErrors)},t.prototype.onBackButtonClick=function(){this.gotoPreviousState()},t.prototype.mapStateToThis=function(t){return{flow:t.etransferFlow}},t.prototype.$onDestroy=function(){this.stateUnsubscriber&&this.stateUnsubscriber()},t}();s.$inject=["$log","$ngRedux","CustomersService","eTransferDialogConstants","AnalyticsService"],e.default=s},function(t,e,n){},function(t,e){t.exports='<div ng-if="!$ctrl.flow.loading" class="c-emt-terms-and-conditions"> <div id="etransfer_review_error_message" ng-if="$ctrl.submitErrors.length > 0"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors track by $index">{{ error | translate }}</li> </ul> </tng-error-message> </div> <div class="c-emt-terms-and-conditions__terms-table-section"> <div class="emt-main-content-heading"> <div class="emt-main-row-fluid"> <p id="etransfer-agreement-terms-conditions-sub" ng-if="$ctrl.parentController.interacAutoDespositRegistration === true" class="emt-terms-conditions-sub" translate="userSettings.moneyTransfer.interac.autoDespoit.termsandconditions.header"></p> <p id="etransfer-agreement-terms-conditions-details" ng-if="$ctrl.parentController.interacAutoDespositRegistration !== true" class="emt-terms-conditions-sub" translate="emt.termsAndConditions.termsDetails"></p> <span id="etransfer-agreement-terms-conditions-title" ng-if="$ctrl.reviewState" class="emt-terms">{{\'emt.termsAndConditions.title\' | translate}}</span> </div> </div> <div id="emt-tnc-accordion-wrapper" tabindex="1"> <emt-terms-and-conditions-accordion></emt-terms-and-conditions-accordion> </div> </div> <div class="c-emt-terms-and-conditions__agreement"> <input id="etransfer-agreement-terms-and-conditions-checkbox" tabindex="2" type="checkbox" class="input c-emt-terms-and-conditions__agreement-checkbox CB_ReadOnly" ng-model="$ctrl.interacAgreementConfirmation" ng-change="$ctrl.updateAcceptButton()"/> <label id="etransfer-agreement-terms-and-conditions-label" for="etransfer-agreement-terms-and-conditions-checkbox"> <span translate="emt.termsAndConditions.iAgreeTerms"></span> </label> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5266));function a(t){return t&&t.__esModule?t:{default:t}}n(5267);var s={template:a(n(5268)).default,controller:i.default,bindings:{}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a=n(45),s=n(105),r=n(1797),o=n(1802),c=n(178),l=n(538),u=function(){function t(t,e,n,i,a,s,r,o,c,l,u,d,h,f,p,g,m,_,v){this.$log=t,this.$q=e,this.$ngRedux=n,this.$window=i,this.$filter=a,this.$translate=s,this.localeConstants=r,this.LocaleService=o,this.$state=c,this.stateConstants=l,this.emtConstants=u,this.eTransferDialogConstants=d,this.tngDateSelectorConstants=h,this.ETransferService=f,this.EnvironmentService=p,this.serviceConstants=g,this.AnalyticsService=m,this.$timeout=_,this.AnchorService=v,this.mobileView=!1,this.showNoContactMsg=!1,this.transferDetail={isSecurityQandAUpdated:!1},this.filteredRecipientOptions=[],this.recipientSearchKeyword=void 0,this.amountValidationErrorShown=!1,this.showLimits=!1,this.accountValid=!0,this.recipientValid=!0,this.amountValid=!0,this.submitErrors=[],this.RECIPIENT_CLICK_DEBOUNCE=50,this.ETRANSFER_TYPES=this.eTransferDialogConstants.ETRANSFER_TYPES,this.shortHandLocale=this.localeConstants.SHORTHAND_LOCALE[this.LocaleService.locale],this.dateDisplayFormat="en"===this.shortHandLocale?"MMMM DD, YYYY":"DD MMMM YYYY"}return t.prototype.$onInit=function(){this.stateUnsubscriber=this.$ngRedux.connect(this.mapStateToThis.bind(this),i({},c.EtransferFlowActions))(this),this.init(),this.setSizeListener(),this.setButtons(),this.setCalendar(),this.setGoogleAnalytics(),this.loadData()},t.prototype.init=function(){this.transferDetail=s.copy(this.flow.transferDetail),this.recipientPlaceholder=this.$translate.instant("emt.setupPayment.toRecipientPlaceholder")},t.prototype.setGoogleAnalytics=function(){this.AnalyticsService.sendAction(this.AnalyticsService.availableEvents.FLOW_STATE_CHANGE,this.flow.analyticsPath)},t.prototype.setSizeListener=function(){var t=this,e=r.fromEvent(this.$window,"resize"),n=this._resizeEventListener.bind(this);this.resizeSubscription=e.pipe(o.debounceTime(200),o.filter((function(){return t.EnvironmentService.isTabletViewSize()!==t.mobileView}))).subscribe(n),this.mobileView=this.EnvironmentService.isTabletViewSize()},t.prototype._resizeEventListener=function(){this.mobileView=!this.mobileView,this.setButtons(),this.recipientValid=!0,this.accountValid=!0,this.amountValid=!0},t.prototype.setButtons=function(){var t=[{label:"global.components.buttons.back",action:this.onBackButtonClick.bind(this),class:"btn btn--edit",name:"eTransfer_back"},{label:"global.components.buttons.next",action:this.onNextButtonClick.bind(this),class:"btn btn--orange",name:"eTransfer_accept",isDisabled:this.setNextButton.bind(this)}];this.mobileView&&this.transferDetail.contactView&&t.pop(),this.setFlowButtons(t)},t.prototype.setCalendar=function(){var t=a();this.datePickerMaxDate=a.utc().add(1,"years"),this.defaultDate=t,this.transferDetail.selectedDate||(this.transferDetail.selectedDate=t)},t.prototype.loadData=function(){var t=this;return this.updateLoadingState(!0),this.$q.all([this.getRecipients(),this.getFromAccounts(),this.setLimits()]).finally((function(){t.updateLoadingState(!1)}))},t.prototype.getRecipients=function(){var t=this;return this.transferDetail.recipients?(this.sortRecipients(this.transferDetail.recipients),this.filteredRecipientOptions=this.transferDetail.recipients,this.$q.resolve()):(this.transferDetail.recipients=[],this.ETransferService.getEmtRecipients().then((function(e){e.recipient&&e.recipient.length>0&&(t.transferDetail.recipients=e.recipient.map((function(t,e){return{name:t.first_name+" "+t.last_name,first_name:t.first_name,last_name:t.last_name,index:e,email_address:t.email_address,sequence_number:t.sequence_number,securityQuestion:t.email_question,email_language:t.email_language,auto_accept:t.auto_accept,fuzzy_version:t.fuzzy_version}})),t.sortRecipients(t.transferDetail.recipients)),t.filteredRecipientOptions=t.transferDetail.recipients})).catch((function(e){t.showSubmitErrors(void 0,e),t.AnchorService.scrollToTop()})))},t.prototype.sortRecipients=function(t){t.sort((function(t,e){return t.first_name.concat(" ").concat(t.last_name).toLowerCase().localeCompare(e.first_name.concat(" ").concat(e.last_name).toLowerCase())}))},t.prototype.getFromAccounts=function(){var t=this;if(!this.transferDetail.accounts)return this.ETransferService.getEmailTransferAccounts().then((function(e){var n=e.fromAccounts;e.fromAccounts&&0!==e.fromAccounts.length&&(t.transferDetail.accounts=n.map((function(e,n){var i=t.EnvironmentService.isPhone()?10:20,a=e.nickname?e.nickname:t.$translate.instant("billPay.multipleBP.chequing");return a.length>i&&(a=a.substring(i,0)+"..."),{title:"<b>"+a+"</b>  "+t.$filter("maskNumber")(e.display_name),balance:t.$filter("currency")(e.account_balance),account_balance:e.account_balance,index:n,number:e.number,external_available_balance:e.external_available_balance}})),1===t.transferDetail.accounts.length&&t.onAccountSelect(t.transferDetail.accounts[0]))})).catch((function(e){t.showSubmitErrors(void 0,e),t.AnchorService.scrollToTop()}))},t.prototype.setLimits=function(){var t=this;if(!this.transferDetail.limits)return this.ETransferService.getEmtLimits().then((function(e){t.transferDetail.limits=e.limits.emailTransferLimits}))},t.prototype.filterRecipientOptions=function(){this.onInputTextChange(this.recipientSearchKeyword),this.transferDetail.recipients&&this.transferDetail.recipients.length&&(this.filteredRecipientOptions=this.$filter("filter")(this.transferDetail.recipients,this.recipientSearchKeyword))},t.prototype.onRecipientSelect=function(t){var e=this;if(this.recipientValid=!0,t)return this.contactInputValue=void 0,this.flow.transferDetail.selectedRecipient&&this.flow.transferDetail.selectedRecipient.sequence_number!=t.sequence_number&&(this.transferDetail.optionalMessage=void 0,this.transferDetail.isSecurityQandAUpdated=!1),this.markSelectedRecipient(t),this.$timeout((function(){e.mobileView&&e.setMobileContactAndShowSetup()}),this.RECIPIENT_CLICK_DEBOUNCE)},t.prototype.markSelectedRecipient=function(t){var e=this;this.transferDetail.recipients.forEach((function(n){t.sequence_number===n.sequence_number?(n.selected=!0,e.transferDetail.selectedRecipient=n,e.transferDetail.securityQuestion=n.securityQuestion,e.transferDetail.securityAnswer=void 0!==e.transferDetail.securityQuestion?e.eTransferDialogConstants.SECURITY_ANSWER_MASK:void 0):n.selected=!1}))},t.prototype.suggestionsSearchFilter=function(t,e){return this.contactInputValue=t,[e.first_name,e.last_name,e.email_address].map((function(t){return"string"==typeof t?t.toLocaleLowerCase():null})).join(" ").includes(t.toLocaleLowerCase())},t.prototype.onInputTextChange=function(t){t&&t.length&&(this.showNoContactMsg=!1,this.contactInputValue=t,this.transferDetail.selectedRecipient={},this.transferDetail.recipients.forEach((function(t){return t.selected=!1})))},Object.defineProperty(t.prototype,"showEditLink",{get:function(){return this.transferDetail.selectedRecipient&&Object.keys(this.transferDetail.selectedRecipient).length},enumerable:!0,configurable:!0}),t.prototype.onEditClick=function(t){this.markSelectedRecipient(t),this.gotoUpdateContact({recipients:s.copy(this.transferDetail.recipients),selectedRecipient:s.copy(this.transferDetail.selectedRecipient)})},t.prototype.onNewContactClick=function(){this.gotoCreateContact({transferDetail:{recipients:s.copy(this.transferDetail.recipients),accounts:s.copy(this.transferDetail.accounts),selectedAccount:this.transferDetail.selectedAccount||(1===this.transferDetail.accounts.length?this.transferDetail.accounts[0]:null),limits:s.copy(this.transferDetail.limits)},newContactInfo:this.ETransferService.parseEmailOrFullname(this.contactInputValue)})},t.prototype.onAccountSelect=function(t){t&&(this.transferDetail.selectedAccount=i({},this.transferDetail.accounts[t.index]),this.amountValidationError=void 0),this.accountValid=this.isAccountValid()},t.prototype.onBlurAccounts=function(){this.accountValid=this.isAccountValid()},t.prototype.toggleShowLimits=function(){this.showLimits=!this.showLimits},t.prototype.onAmountChange=function(){void 0!==this.transferDetail.amount&&this.isAmountValid()},t.prototype.isFormValid=function(){return this.mobileView?!!this.transferDetail.contactView||(this.accountValid=this.isAccountValid(),this.amountValid=this.isAmountValid(),this.transferForm["$ctrl.select_account"].select_account.$touched=!0,this.transferForm.amount.$touched=!0,this.accountValid?this.amountValid||(this.AnchorService.scrollWithOffset("amount_title"),this.ETransferService.focusElement("amount")):(this.AnchorService.scrollWithOffset("accounts_title"),this.ETransferService.focusElement("select_account")),this.accountValid&&this.amountValid):(this.recipientValid=this.isRecipientValid(),this.accountValid=this.isAccountValid(),this.amountValid=this.isAmountValid(),this.transferForm["$ctrl.select_contact"].select_contact.$touched=!0,this.transferForm["$ctrl.select_account"].select_account.$touched=!0,this.transferForm.amount.$touched=!0,this.recipientValid?this.accountValid?this.amountValid||(this.AnchorService.scrollWithOffset("amount_title"),this.ETransferService.focusElement("amount")):(this.AnchorService.scrollWithOffset("accounts_title"),this.ETransferService.focusElement("select_account")):(this.recipientSearchKeyword&&this.contactInputValue||(this.transferForm["$ctrl.select_contact"].select_contact.$error.required=!0),this.AnchorService.scrollWithOffset("contacts_title"),this.ETransferService.focusElement("select_contact")),this.recipientValid&&this.accountValid&&this.amountValid)},t.prototype.isRecipientValid=function(){if(!this.transferDetail.selectedRecipient||!Object.keys(this.transferDetail.selectedRecipient).length){var t=document.getElementById("select_contact");return t&&(t.value="",this.recipientSearchKeyword="",this.contactInputValue=""),!1}return void 0!==this.transferForm["$ctrl.select_contact"]&&this.transferForm["$ctrl.select_contact"].$valid},t.prototype.isAccountValid=function(){return void 0===this.transferForm||void 0===this.transferForm["$ctrl.select_account"]||this.transferForm["$ctrl.select_account"].$valid},t.prototype.isAmountValid=function(){return this.transferDetail.amount?Number(this.transferDetail.amount)<this.transferDetail.limits.minimumLimit?(this.amountError=this.$translate.instant("emt.setupPayment.minAmountError",{minAmount:this.transferDetail.limits.minimumLimit}),!1):Number(this.transferDetail.amount)>this.transferDetail.limits.transactionLimit?(this.amountError=this.$translate.instant("emt.setupPayment.maxAmountError",{maxAmount:this.transferDetail.limits.transactionLimit}),!1):!this.amountValidationErrorShown&&this.amountValidationError?(this.amountError=this.amountValidationError,this.amountValidationErrorShown=!0,!1):(this.amountError=void 0,!0):(this.amountError=this.$translate.instant("emt.setupPayment.requiredAmountError"),!1)},t.prototype.onBackButtonClick=function(){this.mobileView&&!this.transferDetail.contactView?(this.transferDetail.contactView=!0,this.submitErrors=[],this.setButtons()):this.gotoPreviousState()},t.prototype.setMobileContactAndShowSetup=function(){this.saveTransferDetails({recipients:s.copy(this.transferDetail.recipients),selectedRecipient:s.copy(this.transferDetail.selectedRecipient)}),this.transferDetail.contactView=!1,this.setButtons()},t.prototype.onNextButtonClick=function(){if(this.isFormValid())if(this.mobileView&&this.transferDetail.contactView)this.saveTransferDetails({recipients:s.copy(this.transferDetail.recipients),selectedRecipient:s.copy(this.transferDetail.selectedRecipient)}),this.transferDetail.contactView=!1;else{if(this.validationNeeded())return this.submitErrors=[],this.validateTransaction();this.goToSecurityQuestionAndAnswer()}return this.$q.resolve()},t.prototype.validationNeeded=function(){return!(!this.transferDetail.eTransferTypeChanged&&this.flow.transferDetail.selectedRecipient&&this.flow.transferDetail.selectedRecipient.sequence_number===this.transferDetail.selectedRecipient.sequence_number&&this.flow.transferDetail.selectedAccount&&this.flow.transferDetail.selectedAccount.number===this.transferDetail.selectedAccount.number&&this.flow.transferDetail.amount===this.transferDetail.amount&&this.flow.transferDetail.selectedDate&&this.flow.transferDetail.selectedDate.isSame(this.transferDetail.selectedDate,"day"))},t.prototype.validateTransaction=function(){var t=this;this.transferDetail.selectedRecipient.sequence_number=this.transferDetail.selectedRecipient.sequence_number;var e={TRANSFER_TYPE_STATE:this.transferDetail.eTransferType,WHEN_STATE:this.ETransferService.isFutureDate(this.transferDetail.selectedDate)?this.emtConstants.WHEN_SEND.LATER:this.emtConstants.WHEN_SEND.NOW,scheduledDate:this.transferDetail.selectedDate,payFromAccount:this.transferDetail.selectedAccount,recipient:this.transferDetail.selectedRecipient,amount:this.transferDetail.amount,optionalMessage:""};return this.updateLoadingState(!0),this.ETransferService.sendMoneyEmailTransfer(e,!0).then((function(e){t.updateLoadingState(!1);var n=void 0;return e.response_status.status_code===t.serviceConstants.STATUS_CODES.AVLBAL?(t.amountValidationError=t.$translate.instant("emt.emailMoney.moreThanAvailable"),t.amountValidationErrorShown=!1,t.AnchorService.scrollWithOffset("amount_title",void 0),!1):e.response_status.status_code===t.serviceConstants.STATUS_CODES.AVLBALHLD?(t.amountValidationError=t.$translate.instant("emt.emailMoney.moreThanAvailableHold",{availableAmount:t.$filter("tngCurrency")(t.transferDetail.selectedAccount.external_available_balance||0)}),t.amountValidationErrorShown=!1,t.AnchorService.scrollWithOffset("amount_title",void 0),!1):-1===[t.serviceConstants.STATUS_CODES.CREATED,t.serviceConstants.STATUS_CODES.SUCCESS].indexOf(e.response_status.status_code)?(t.$log.error("EMT API VALIDATION ERROR: ",e.response_status),n=t.$translate.instant("global.errorCodes."+(e.response_status.return_code||e.response_status.status_code)),t.showSubmitErrors(n,void 0),t.AnchorService.scrollToTop(),!1):(e.autodeposit_details?(t.transferDetail.autoDepositDetail=new l.EtransferAutoDepositDetail,t.transferDetail.autoDepositDetail.emailAddress=e.autodeposit_details.email_address,t.transferDetail.autoDepositDetail.registrationName=e.autodeposit_details.registration_name,t.transferDetail.autoDepositDetail.contactName=e.autodeposit_details.contact_name):t.transferDetail.autoDepositDetail=void 0,t.saveTransferDetails(t.transferDetail),t.goToSecurityQuestionAndAnswer(),!0)})).catch((function(e){t.updateLoadingState(!1),t.showSubmitErrors(void 0,e),t.AnchorService.scrollToTop()}))},t.prototype.setNextButton=function(){return!this.transferDetail.selectedRecipient&&this.mobileView},Object.defineProperty(t.prototype,"submitFunction",{get:function(){return this.mobileView&&this.transferDetail.contactView?this.onNewContactClick:this.onNextButtonClick},enumerable:!0,configurable:!0}),t.prototype.showSubmitErrors=function(t,e){var n=this;t?this.submitErrors.push(t):"errorMessage"in e?this.submitErrors.push(e.errorMessage):"details"in e.response_status&&e.response_status.details.forEach((function(t){n.submitErrors.push(t)})),this.$log.error("eTransfer Setup error:",this.submitErrors)},t.prototype.mapStateToThis=function(t){return{flow:t.etransferFlow}},t.prototype.$onDestroy=function(){this.stateUnsubscriber&&this.stateUnsubscriber(),this.resizeSubscription.unsubscribe()},t}();u.$inject=["$log","$q","$ngRedux","$window","$filter","$translate","localeConstants","LocaleService","$state","stateConstants","emtConstants","eTransferDialogConstants","tngDateSelectorConstants","ETransferService","EnvironmentService","serviceConstants","AnalyticsService","$timeout","AnchorService"],e.default=u},function(t,e,n){},function(t,e){t.exports='<div ng-if="!$ctrl.flow.loading"> <div id="service_errors" class="e-transfer-setup-service-errors" ng-show="$ctrl.submitErrors.length"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors track by $index">{{ error | translate }}</li> </ul> </tng-error-message> </div> <div class="e-transfer-setup"> <form class="e-transfer-setup__transfer-form" name="$ctrl.transferForm" ng-submit="$ctrl.submitFunction()" novalidate autocomplete="off"> <input ng-hide="true" type="submit"/> <div ng-if="!$ctrl.mobileView"> <p id="contacts_title" class="etransfer-setup-input-recipients-title">{{ ::\'emt.setupPayment.sendMoneyTo\' | translate }}</p> <div class="etransfer-setup-input" id="e-transfer-setup-to-email-selector"> <div class="etransfer-setup-recipients"> <div class="contact-select-wrapper"> <tng-select-autocomplete class="margin__b--fix2 contact-select" input-id="select_contact" ng-if="$ctrl.transferDetail.recipients" ng-required="true" ng-model="$ctrl.transferDetail.selectedRecipient" ng-model-set-raw-object="true" on-select="$ctrl.onRecipientSelect(option)" options="$ctrl.transferDetail.recipients" option-label-key="name" option-right-label-key="email_address" option-value-key="name" secondary-label-beneath-primary="true" alternate-light="true" enable-for-mobile="true" hide-right-label-on-search="true" autocomplete="off" ng-warning-border="true" placeholder="{{ $ctrl.recipientPlaceholder }}" suggestions-search-filter="$ctrl.suggestionsSearchFilter(input, element)" show-suggestion-empty-state="true" on-input-change="$ctrl.onInputTextChange(input)" suggestion-empty-state="emt.setupPayment.noRecipientsWeb" hide-placeholder-when-click="true"> </tng-select-autocomplete> </div> </div> <p id="edit_contact_link" ng-if="$ctrl.showEditLink" ng-click="$ctrl.onEditClick($ctrl.transferDetail.selectedRecipient)" class="heading--sub3 setup-payment-field-heading edit-contact"><u>{{ ::\'emt.setupPayment.editContact\' | translate }}</u></p> </div> <div class="etransfer-setup-new-contact-buttons"> <button id="new_contact_button" class="btn btn--edit etransfer-setup-new-contact-button" ng-click="$ctrl.onNewContactClick()"> {{ ::\'emt.setupPayment.newContact\' | translate }} </button> </div> </div> <div ng-if="$ctrl.mobileView && $ctrl.transferDetail.contactView" class="etransfer-setup-recipients-mobile"> <div class="field"> <i class="field__icon icon-search"></i> <input id="select_contact" tabindex="0" ng-model="$ctrl.recipientSearchKeyword" ng-change="$ctrl.filterRecipientOptions()" type="text" class="input" placeholder="{{ \'emt.emailMoney.searchPlaceholder\' | translate }}"> </div> <div class="etransfer-setup-new-contact-buttons"> <button id="new_contact_button" class="btn btn--edit etransfer-setup-new-contact-button" ng-click="$ctrl.onNewContactClick()"> {{ ::\'emt.setupPayment.newContact\' | translate }} </button> </div> <div id="contact_list" ng-repeat="recipient in $ctrl.filteredRecipientOptions track by $index" class="c-recipient-tile" ng-class="{\'recipient-selected\': recipient.selected}"> <div class="c-recipient-contact-info" ng-click="$ctrl.onRecipientSelect(recipient)"> <div id="contact_name_email_{{$index}}" class="c-recipient-name-email"> <p class="c-recipient-name">{{ recipient.name }}</p> <p class="c-recipient-email">{{ recipient.email_address }}</p> </div> </div> <div id="etransfer-contact-edit-{{$index}}" ng-click="$ctrl.onEditClick(recipient)" class="c-recipient-edit">{{ \'emt.emailMoney.edit\' | translate }}</div> </div> <p ng-if="!$ctrl.transferDetail.recipients || !$ctrl.transferDetail.recipients.length || !$ctrl.filteredRecipientOptions.length" class="etransfer-setup-no-recipients-message">{{ ::\'emt.setupPayment.noRecipientsMobile\' | translate }}</p> </div> <p id="selected_recipient" ng-if="$ctrl.mobileView && !$ctrl.transferDetail.contactView" class="etransfer-setup-recipient" ng-bind-html="\'emt.setupPayment.recipient\' | translate:{name: $ctrl.transferDetail.selectedRecipient.name, email: $ctrl.transferDetail.selectedRecipient.email_address}"> </p> <div ng-if="!$ctrl.mobileView || !$ctrl.transferDetail.contactView" class="etransfer-setup-accounts"> <p id="accounts_title" class="etransfer-setup-input-accounts-title">{{ ::\'emt.setupPayment.transferFrom\' | translate }}</p> <div class="etransfer-setup-input" id="c-e-transfer-from-account"> <tng-select-autocomplete class="margin__b--fix2 account-select" input-id="select_account" ng-if="$ctrl.transferDetail.accounts" ng-required="true" ng-model="$ctrl.transferDetail.selectedAccount.number" on-select="$ctrl.onAccountSelect(option)" on-blur="$ctrl.onBlurAccounts()" options="$ctrl.transferDetail.accounts" option-label-key="title" option-right-label-key="balance" option-value-key="number" alternate-light="true" select-type="\'STATIC\'" enable-for-mobile="true" placeholder="{{ ::\'billPay.billPayV2.setUpPaymentPage.fromAccountPlaceholder\' | translate }}" show-warning-border="!$ctrl.accountValid"> </tng-select-autocomplete> </div> </div> <div ng-if="!$ctrl.mobileView || !$ctrl.transferDetail.contactView" class="etransfer-setup-amount" ng-class="{\'etransfer-setup-amount-limits\': !$ctrl.transferDetail.limits}"> <p id="amount_title" class="etransfer-setup-input-amount-title">{{::\'emt.setupPayment.amount\' | translate }}</p> <div class="m-send-emt__emt-amount-input"> <tng-amount-input actionable-id="amount" ng-model="$ctrl.transferDetail.amount" disable-autofocus="true" ng-required="true" no-decimals="false" input-max-length="9" on-amount-change="$ctrl.onAmountChange()" set-value="$ctrl.transaction.amount"> </tng-amount-input> </div> <div> <p class="field__error" ng-show="$ctrl.amountError"> {{$ctrl.amountError}} </p> </div> </div> <div ng-if="(!$ctrl.mobileView || !$ctrl.transferDetail.contactView) && $ctrl.transferDetail.limits" id="amount-limits" class="etransfer-setup-limits"> <p id="limits_title" class="heading--sub3 setup-payment-field-heading sub-header"> <span class="cursor" ng-click="$ctrl.toggleShowLimits()"> <u>{{ ::\'emt.setupPayment.limitsTitle\' | translate }}</u> <button ng-class="{\'icon-downarrow\': !$ctrl.showLimits, \'icon-uparrow\': $ctrl.showLimits}" class="emt-chevron"></button> </span> </p> <div ng-if="$ctrl.showLimits"> <table> <tr> <td class="heading--sub3 setup-payment-field-heading sub-header">{{ ::\'emt.setupPayment.daily\' | translate }}</td> <td class="heading--sub3 setup-payment-field-heading limit-text">{{ ::\'emt.setupPayment.daily\' | translate }}{{ ::\'emt.setupPayment.maxLimit\' | translate: {maxLimit: $ctrl.transferDetail.limits.dailyLimit} }}<br> {{ ::\'emt.setupPayment.dailyLimitRefresh\' | translate }}</td> <td></td> </tr> <tr> <td class="heading--sub3 setup-payment-field-heading sub-header">{{ ::\'emt.setupPayment.weekly\' | translate }}</td> <td class="heading--sub3 setup-payment-field-heading limit-text">{{ ::\'emt.setupPayment.weekly\' | translate }}{{ ::\'emt.setupPayment.maxLimit\' | translate: {maxLimit: $ctrl.transferDetail.limits.weeklyLimit} }}<br> {{ ::\'emt.setupPayment.weeklyLimitRefresh\' | translate }}</td> </tr> <tr> <td class="heading--sub3 setup-payment-field-heading sub-header">{{ ::\'emt.setupPayment.monthly\' | translate }}</td> <td class="heading--sub3 setup-payment-field-heading limit-text">{{ ::\'emt.setupPayment.monthly\' | translate }}{{ ::\'emt.setupPayment.maxLimit\' | translate: {maxLimit: $ctrl.transferDetail.limits.monthlyLimit} }}<br> {{ ::\'emt.setupPayment.monthlyLimitRefresh\' | translate }}</td> </tr> </table> </div> </div> <div ng-if="!$ctrl.mobileView || !$ctrl.transferDetail.contactView" class="etransfer-setup-date-selector"> <p id="date_title" class="etransfer-setup-date-selector-title">{{ ::\'emt.setupPayment.selectDate\' | translate }}</p> <div class="field date-select-container setup-payment-field" id="e-transfer-date" style="position:relative"> <tng-date-selector class="tng-e-transfer-setup__selected-date--date-selector" min-date="$ctrl.defaultDate" max-date="$ctrl.datePickerMaxDate" move-focus-to-date-on-calendar-shown="$ctrl.transferDetail.selectedDate" selection-mode="$ctrl.tngDateSelectorConstants.DATE_SELECTOR_MODES.SINGLE" selected-date="$ctrl.transferDetail.selectedDate" hide-frequency-selector="true" hide-selection-mode-selector="true" hide-start-date-incrementer="true" single-month-view-enabled="true" show-input-display="true" component-name="e-transfer-setup_date-selector" force-user-selection="true" hide-calendar-on-date-change="true" toggle-calendar-from-input-display="true" set-white-background-on-calendar="true" display-on-external-update="true" reflect-date-input="true" close-calendar-on-click-outside="true" date-display-format="{{$ctrl.dateDisplayFormat}}" ignore-outside-click-for-input-id="{{\'e-transfer-setup_date-selector\'}}" indicate-today="true"> </tng-date-selector> </div> </div> </form> </div> <div ng-if="!$ctrl.EnvironmentService.isTabletViewSize()"> <tng-tour-cards-container page-id="ip_TT_EmailMoney"/> <tng-tour-card card-id="email_money_modal_sendto_card"/> <tng-tour-card card-id="email_money_modal_limit_card"/> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5270));function a(t){return t&&t.__esModule?t:{default:t}}n(5271);var s={template:a(n(5272)).default,controller:i.default,bindings:{}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a=n(178),s=n(538),r=n(67),o=n(105),c=function(){function t(t,e,n,i,a,o,c,l,u,d,h,f,p){this.$log=t,this.$q=e,this.$filter=n,this.$translate=i,this.$timeout=a,this.$ngRedux=o,this.eTransferDialogConstants=c,this.ETransferService=l,this.serviceConstants=u,this.AnalyticsService=d,this.AnchorService=h,this.EventBusService=f,this.eventConstants=p,this.nameValidation=r.nameValidation,this.PAGES=s.EtransferPage,this.isUpdateState=!1,this.serviceErrors=[],this.warnings=[],this.recipient={}}return t.prototype.$onInit=function(){this.stateUnsubscriber=this.$ngRedux.connect(this._mapStateToThis.bind(this),i({},a.EtransferFlowActions))(this),this._init(),this._setButtons(),this.AnalyticsService.sendAction(this.AnalyticsService.availableEvents.FLOW_STATE_CHANGE,this.flow.analyticsPath)},t.prototype._init=function(){this.transferDetail=o.copy(this.flow.transferDetail),this.isUpdateState=this.flow.currentFlowIndex===this.PAGES.ETRANSFER_UPDATE_CONTACT,this.isUpdateState?(this.recipient=o.copy(this.transferDetail.selectedRecipient),this.onSubmitForm=this._onUpdateButtonClick):(this.recipient.email_language=this.eTransferDialogConstants.LANGUAGES.ENGLISH,Object.assign(this.recipient,this.flow.newContactInfo),this.onSubmitForm=this._onSaveButtonClick)},t.prototype._setButtons=function(){this.isUpdateState?this.setFlowButtons([{label:"global.components.buttons.back",action:this._onBackButtonClick.bind(this),class:"btn btn--edit",name:"eTransfer_back"},{label:"emt.newContact.update",action:this._onUpdateButtonClick.bind(this),class:"btn btn--orange",name:"eTransfer_next"}]):this.setFlowButtons([{label:"global.components.buttons.back",action:this._onBackButtonClick.bind(this),class:"btn btn--edit",name:"eTransfer_back"},{label:"global.components.buttons.save",action:this._onSaveButtonClick.bind(this),class:"btn btn--orange",name:"eTransfer_next"}])},t.prototype.onFirstNameChange=function(){this.recipient.first_name&&(this.contactForm.firstName.$setValidity("invalidFirstName",this.nameValidation(this.recipient.first_name)),this._validateDuplicateContact())},t.prototype.onLastNameChange=function(){this.recipient.last_name&&(this.contactForm.lastName.$setValidity("invalidLastName",this.nameValidation(this.recipient.last_name)),this._validateDuplicateContact())},t.prototype._validateDuplicateContact=function(){var t=this;this.recipient.first_name&&this.recipient.last_name&&this.transferDetail.recipients.filter((function(e){return e.sequence_number!==t.recipient.sequence_number})).some((function(e){return t.recipient.first_name.toLowerCase()===e.first_name.toLowerCase()&&t.recipient.last_name.toLowerCase()===e.last_name.toLowerCase()}))?this.warnings.push("global.errorCodes.EMT_DUPLICATE_RECIPIENT"):this.warnings=[]},t.prototype.onEmailChanged=function(){var t=this;this.recipient.email_address&&this.contactForm.emailAddress.$setValidity("existingEmailAddress",!this.transferDetail.recipients.some((function(e){return t.recipient.email_address.toLowerCase()===e.email_address.toLowerCase()})))},t.prototype._onBackButtonClick=function(){this.gotoPreviousState()},t.prototype._onSaveButtonClick=function(){var t=this;return this._validateForm()?(this.updateLoadingState(!0),this.serviceErrors=[],this.ETransferService.addContact(this.recipient).then((function(e){if(e.response_status.status_code!==t.serviceConstants.STATUS_CODES.CREATED)return t.$log.error("Wrong status code:",e),t.$q.reject(e);var n={sequence_number:e.sequence_number,name:t.recipient.first_name+" "+t.recipient.last_name,first_name:t.recipient.first_name,last_name:t.recipient.last_name,index:t.transferDetail.recipients.length,email_address:t.recipient.email_address,email_language:t.recipient.email_language};return t.addNewRecipient(n),t.gotoPreviousState(),t.EventBusService.publish(t.eventConstants.EMT_CONTACTS_REFRESH),e})).catch((function(e){t._showServiceErrors(e)})).finally((function(){t.updateLoadingState(!1)}))):this.$q.resolve()},t.prototype._onUpdateButtonClick=function(){var t=this;if(this._validateForm()){if(!this._recipientNotChanged())return this.updateLoadingState(!0),this.serviceErrors=[],this.ETransferService.editContact(this.recipient).then((function(e){return e.response_status.status_code!==t.serviceConstants.STATUS_CODES.SUCCESS?(t.$log.error("Wrong status code:",e),t.$q.reject(e)):(t.recipient.name=t.recipient.first_name+" "+t.recipient.last_name,t.transferDetail.selectedRecipient=i({},t.transferDetail.recipients.find((function(e){return e.sequence_number===t.recipient.sequence_number})),t.recipient),t.transferDetail.recipients.some((function(e,n){return e.sequence_number===t.recipient.sequence_number&&(t.transferDetail.recipients[n]=t.recipient,!0)})),t.saveTransferDetails({recipients:o.copy(t.transferDetail.recipients),selectedRecipient:o.copy(t.transferDetail.selectedRecipient)}),t.gotoPreviousState(),t.EventBusService.publish(t.eventConstants.EMT_CONTACTS_REFRESH),e)})).catch((function(e){t._showServiceErrors(e)})).finally((function(){t.updateLoadingState(!1)}));this.gotoPreviousState()}return this.$q.resolve()},t.prototype._recipientNotChanged=function(){return this.recipient.first_name.toLowerCase()===this.transferDetail.selectedRecipient.first_name.toLowerCase()&&this.recipient.last_name.toLowerCase()===this.transferDetail.selectedRecipient.last_name.toLowerCase()&&this.recipient.email_address.toLowerCase()===this.transferDetail.selectedRecipient.email_address.toLowerCase()&&this.recipient.email_language.toLowerCase()===this.transferDetail.selectedRecipient.email_language.toLowerCase()},t.prototype.onDeleteButtonClick=function(){this.gotoDeleteContact()},t.prototype._validateForm=function(){return this.contactForm.firstName.$touched=!0,this.contactForm.lastName.$touched=!0,this.contactForm.emailAddress.$touched=!0,this.contactForm.firstName.$invalid?(this.AnchorService.scrollWithOffset("nameTitle"),this.ETransferService.focusElement("firstName"),!1):this.contactForm.lastName.$invalid?(this.AnchorService.scrollWithOffset("nameTitle"),this.ETransferService.focusElement("lastName"),!1):!this.contactForm.emailAddress.$invalid||(this.AnchorService.scrollWithOffset("emailAddressTitle"),this.ETransferService.focusElement("emailAddress"),!1)},t.prototype._showServiceErrors=function(t){var e;if("errorMessage"in t&&this.serviceErrors.push(t.errorMessage),"details"in t.response_status){var n=t.response_status.details.map((function(t){return t.details_code?"global.errorCodes."+t.details_code:t.technical_description})),i=Array.from(new Set(n)).slice();(e=this.serviceErrors).push.apply(e,i)}else"SYSTEM_ERROR"===t.response_status.status_code&&t.response_status.return_code?this.serviceErrors.push(this.$translate.instant("global.errorCodes."+t.response_status.return_code)):"status_code"in t.response_status?this.serviceErrors.push(this.$translate.instant("global.errorCodes."+t.response_status.status_code)):this.serviceErrors.push(this.$translate.instant("global.errorCodes."+t.response_status.return_code));this.$log.debug("Formatted service errors:",this.serviceErrors),this.serviceErrors.length&&this.AnchorService.scrollToTop()},t.prototype._mapStateToThis=function(t){return{flow:t.etransferFlow}},t.prototype.$onDestroy=function(){this.stateUnsubscriber&&this.stateUnsubscriber()},t}();c.$inject=["$log","$q","$filter","$translate","$timeout","$ngRedux","eTransferDialogConstants","ETransferService","serviceConstants","AnalyticsService","AnchorService","EventBusService","eventConstants"],e.default=c},function(t,e,n){},function(t,e){t.exports=' <div class="etransfer-edit-contact"> <div id="service_errors" class="etransfer-edit-contact__service-errors" ng-show="$ctrl.serviceErrors.length"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.serviceErrors track by $index" translate="{{ error }}"> </li> </ul> </tng-error-message> </div> <div id="service_warnings" class="etransfer-edit-contact__service-errors" ng-show="$ctrl.warnings.length"> <tng-warning-message> <ul> <li ng-repeat="warning in $ctrl.warnings  track by $index"> <span class="dot"></span>&nbsp;&nbsp;{{ warning | translate }} </li> </ul> </tng-warning-message> </div> <div ng-if="!$ctrl.flow.loading" class="etransfer-edit-contact__container"> <form name="$ctrl.contactForm" ng-submit="$ctrl.onSubmitForm()" novalidate autocomplete="off"> <input ng-hide="true" type="submit"/> <p id="nameTitle" class="etransfer-edit-contact__title">{{ ::\'emt.newContact.nameTitle\' | translate }}</p> <div class="etransfer-edit-contact__name-email"> <div class="etransfer-edit-contact__input-field"> <input class="input" ng-class="{ \'warning\': $ctrl.contactForm.firstName.$invalid && $ctrl.contactForm.firstName.$touched }" id="firstName" name="firstName" type="text" required maxlength="32" autocomplete="nope" ng-model="$ctrl.recipient.first_name" ng-change="$ctrl.onFirstNameChange()" placeholder="{{ \'emt.newContact.firstNamePlaceholder\' | translate }}"/> <div ng-messages="$ctrl.contactForm.firstName.$error" ng-show="$ctrl.contactForm.firstName.$touched" class="field__error"> <p ng-message="required"> {{ ::\'emt.validation.isRequired\' | translate}} </p> <p ng-message="invalidFirstName"> {{ ::\'emt.validation.invalidName\' | translate}} </p> </div> </div> <div class="etransfer-edit-contact__input-field"> <input class="input" ng-class="{ \'warning\': $ctrl.contactForm.lastName.$invalid && $ctrl.contactForm.lastName.$touched }" id="lastName" name="lastName" type="text" required maxlength="32" autocomplete="nope" ng-model="$ctrl.recipient.last_name" ng-change="$ctrl.onLastNameChange()" placeholder="{{\'emt.newContact.lastNamePlaceholder\' | translate}}"/> <div ng-messages="$ctrl.contactForm.lastName.$error" ng-show="$ctrl.contactForm.lastName.$touched" class="field__error"> <p ng-message="required"> {{ ::\'emt.validation.isRequired\' | translate}} </p> <p ng-message="invalidLastName"> {{ ::\'emt.validation.invalidName\' | translate}} </p> </div> </div> </div> <p id="emailAddressTitle" class="etransfer-edit-contact__title">{{ ::\'emt.newContact.emailTitle\' | translate }}</p> <div class="etransfer-edit-contact__name-email"> <div class="etransfer-edit-contact__input-field"> <input class="input" ng-class="{ \'warning\': $ctrl.contactForm.emailAddress.$invalid && $ctrl.contactForm.emailAddress.$touched }" id="emailAddress" name="emailAddress" type="email" required maxlength="60" autocomplete="nope" ng-model="$ctrl.recipient.email_address" ng-change="$ctrl.onEmailChanged()" placeholder="{{\'emt.newContact.emailPlaceholder\' | translate}}"/> <div ng-messages="$ctrl.contactForm.emailAddress.$error" ng-show="$ctrl.contactForm.emailAddress.$touched" class="field__error"> <p ng-message="required"> {{ ::\'emt.validation.isRequired\' | translate }} </p> <p ng-message="email"> {{ ::\'emt.validation.wrongEmailFormat\' | translate }} </p> <p ng-message="existingEmailAddress"> {{ ::\'emt.validation.emailAlreadyOnList\' | translate }} </p> </div> </div> </div> <p id="preferredLanguageTitle" class="etransfer-edit-contact__title">{{ ::\'emt.newContact.languageTitle\' | translate }}</p> <div class="etransfer-edit-contact__language"> <div class="etransfer-edit-contact__radio-button"> <input class="input input--tangerine-radio" id="emailLanguageEn" type="radio" name="emailLanguageEn" value="en" required ng-model="$ctrl.recipient.email_language"/> <label for="emailLanguageEn">{{ ::\'emt.newContact.english\' | translate}}</label> </div> <div class="m-send-emt__language-radio-button"> <input class="input input--tangerine-radio" id="emailLanguageFr" type="radio" name="emailLanguageFr" value="fr" required ng-model="$ctrl.recipient.email_language"/> <label for="emailLanguageFr">{{ ::\'emt.newContact.french\' | translate}}</label> </div> </div> <div ng-if="$ctrl.isUpdateState"> <button id="delete_button" class="btn etransfer-edit-contact__delete-button" ng-click="$ctrl.onDeleteButtonClick()"> {{ ::\'emt.newContact.delete\' | translate }} </button> </div> </form> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5274));function a(t){return t&&t.__esModule?t:{default:t}}n(5275);var s={template:a(n(5276)).default,controller:i.default,bindings:{}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a=n(178),s=n(105),r=function(){function t(t,e,n,i,a,s,r,o,c,l,u,d){this.$log=t,this.$q=e,this.$translate=n,this.$timeout=i,this.$ngRedux=a,this.serviceConstants=s,this.ETransferService=r,this.analyticsConstants=o,this.AnalyticsService=c,this.AnchorService=l,this.eventConstants=u,this.EventBusService=d,this.serviceErrors=[],this.recipient={}}return t.prototype.$onInit=function(){this.stateUnsubscriber=this.$ngRedux.connect(this.mapStateToThis.bind(this),i({},a.EtransferFlowActions))(this),this.transferDetail=s.copy(this.flow.transferDetail),this.recipient=this.transferDetail.selectedRecipient,this.AnalyticsService.sendAction(this.AnalyticsService.availableEvents.FLOW_STATE_CHANGE,this.flow.analyticsPath),this.setButtons()},t.prototype.setButtons=function(){this.setFlowButtons([{label:"global.components.buttons.back",action:this.onBackButtonClick.bind(this),class:"btn btn--edit",name:"eTransfer_back"},{label:"global.components.buttons.delete",action:this.onDeleteButtonClick.bind(this),class:"btn etransfer-delete-contact__delete-button",name:"eTransfer_delete"}])},t.prototype.onBackButtonClick=function(){this.gotoPreviousState()},t.prototype.onDeleteButtonClick=function(){var t=this;this.updateLoadingState(!0);var e=this.recipient.sequence_number;return this.serviceErrors=[],this.ETransferService.deleteContact(e).then((function(n){return"SUCCESS"===(n&&n.response_status&&n.response_status.status_code)?(t.saveTransferDetails({contactView:!0,recipients:t.transferDetail.recipients.filter((function(t){return t.sequence_number!==e})),selectedRecipient:null}),t.gotoSetup(t.flow.transferDetail),t.EventBusService.publish(t.eventConstants.EMT_CONTACTS_REFRESH),n):t.$q.reject(n)})).catch((function(e){t.$log.error("error deleting contact:",e),t.showServiceErrors(e)})).finally((function(){t.updateLoadingState(!1)}))},t.prototype.showServiceErrors=function(t){var e;if("errorMessage"in t&&this.serviceErrors.push(t.errorMessage),t.response_status&&"details"in t.response_status){var n=t.response_status.details.map((function(t){return t.details_code?"global.errorCodes."+t.details_code:t.technical_description})),i=Array.from(new Set(n)).slice();(e=this.serviceErrors).push.apply(e,i)}else t.response_status&&t.response_status.status_code&&"SYSTEM_ERROR"===t.response_status.status_code&&t.response_status.return_code?this.serviceErrors.push(this.$translate.instant("global.errorCodes."+t.response_status.return_code)):t.response_status&&"status_code"in t.response_status?this.serviceErrors.push(this.$translate.instant("global.errorCodes."+t.response_status.status_code)):this.serviceErrors.push(this.$translate.instant("global.errorCodes."+t.response_status.return_code));this.$log.debug("Formatted service errors:",this.serviceErrors),this.serviceErrors.length&&this.AnchorService.scrollWithOffset("service_errors")},t.prototype.mapStateToThis=function(t){return{flow:t.etransferFlow}},t.prototype.$onDestroy=function(){this.stateUnsubscriber&&this.stateUnsubscriber()},t}();r.$inject=["$log","$q","$translate","$timeout","$ngRedux","serviceConstants","ETransferService","analyticsConstants","AnalyticsService","AnchorService","eventConstants","EventBusService"],e.default=r},function(t,e,n){},function(t,e){t.exports=' <div class="etransfer-delete-contact"> <div id="service_errors" class="etransfer-edit-contact__service-errors" ng-show="$ctrl.serviceErrors.length"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.serviceErrors track by $index" translate="{{ error }}"> </li> </ul> </tng-error-message> </div> <div ng-if="!$ctrl.flow.loading" class="etransfer-delete-contact__container"> <div class="etransfer-delete-contact__container-6"> <p>{{ ::\'emt.deleteContact.contactWillBeDeleted\' | translate}}</p> <div class="etransfer-delete-contact__panel margin__t--fix1"> <div class="etransfer-delete-contact__description"> <p class="etransfer-delete-contact__name"> <strong>{{$ctrl.recipient.first_name}} {{$ctrl.recipient.last_name}}</strong> </p> <span class="etransfer-delete-contact__title"> {{$ctrl.recipient.email_address}} </span> </div> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5278)),a=s(n(5279));function s(t){return t&&t.__esModule?t:{default:t}}n(5280);var r={template:a.default,controller:i.default,bindings:{}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a=n(1876),s=n(178),r=n(67),o=function(){function t(t,e,n,i,a,s,o,c,l){this.$log=t,this.$ngRedux=e,this.$timeout=n,this.$q=i,this.ETransferService=a,this.eTransferDialogConstants=s,this.serviceConstants=o,this.AnalyticsService=c,this.AnchorService=l,this.questionPattern=r.emtQuestionPattern,this.answerPattern=r.emtAnswerPattern,this.quetionContainsForbiddenKeywords=r.quetionContainsForbiddenKeywords,this.submitErrors=[],this.submitWarnings=[],this.isQandADisabled=!1,this.emtSHA2EnabledConfigKey="emtSHA2Enabled",this.transferDetail={isSecurityQandAUpdated:!1},this.SECURITY_ANSWER_MASK=s.SECURITY_ANSWER_MASK,this.EMT_VALIDATION_LIMIT=s.EMT_VALIDATION_LIMIT}return t.prototype.$onInit=function(){this.stateUnsubscriber=this.$ngRedux.connect(this.mapStateToThis.bind(this),i({},s.EtransferFlowActions))(this),this.init(),this.setFocusOnTop(),this.setButtons(),this.setGoogleAnalytics()},t.prototype.init=function(){this.transferDetail=Object.assign(this.transferDetail,this.flow.transferDetail),this.existingSecurityQuestion=this.transferDetail.selectedRecipient.securityQuestion,this.transferDetail.securityQuestion&&this.transferDetail.securityQuestion.length>this.EMT_VALIDATION_LIMIT.EMAIL_QUESTION_INTERAC_LENGTH_LIMIT&&(this.transferDetail.securityQuestion="",this.transferDetail.securityAnswer=""),this.validateSHA2Enable(this.transferDetail.selectedRecipient),this.isAutoDeposit=Boolean(this.transferDetail.securityQuestion)&&Boolean(this.transferDetail.autoDepositDetail)&&this.transferDetail.eTransferType===this.eTransferDialogConstants.ETRANSFER_TYPES.INTERAC_EMT,this.isAutoAccept=Boolean(this.transferDetail.securityQuestion)&&this.transferDetail.selectedRecipient.auto_accept&&this.transferDetail.eTransferType===this.eTransferDialogConstants.ETRANSFER_TYPES.TANGERINE_EMT},t.prototype.setFocusOnTop=function(){this.AnchorService.scrollToTop()},t.prototype.setButtons=function(){this.setFlowButtons([{label:"global.components.buttons.back",action:this.onBackButton.bind(this),class:"btn btn--edit",name:"eTransfer_back"},{label:"global.components.buttons.reviewETransfer",action:this.onNextButton.bind(this),class:"btn btn--orange",name:"eTransfer_next"}])},t.prototype.validateSHA2Enable=function(t){t.fuzzy_version===this.EMT_VALIDATION_LIMIT.MD5_FUZZY_VERSION&&(this.transferDetail.securityQuestion="",this.transferDetail.securityAnswer="")},t.prototype.setGoogleAnalytics=function(){this.AnalyticsService.sendAction(this.AnalyticsService.availableEvents.FLOW_STATE_CHANGE,this.flow.analyticsPath)},t.prototype.isQandADirty=function(){return!(this.isAutoAccept||this.isAutoDeposit)&&(this.questionAndAnswerForm.securityAnswer.$dirty||this.questionAndAnswerForm.securityQuestion.$dirty)},t.prototype.validateForm=function(){var t=!this.questionAndAnswerForm.securityQuestion||this.questionAndAnswerForm.securityQuestion.$valid,e=!this.questionAndAnswerForm.securityAnswer||this.questionAndAnswerForm.securityAnswer.$valid,n=this.questionAndAnswerForm.optionalMessage.$valid;return t?e?n||(this.AnchorService.scrollWithOffset("etransfer-security-message"),this.ETransferService.focusElement("etransfer-q-and-a-input-option-message")):(this.AnchorService.scrollWithOffset("etransfer-security-answer"),this.ETransferService.focusElement("etransfer-q-and-a-input-security-answer")):(this.AnchorService.scrollWithOffset("etransfer-security-question"),this.ETransferService.focusElement("etransfer-q-and-a-input-security-question")),this.questionAndAnswerForm.$dirty&&this.isQandADirty()?(this.validateDuplicateInfo(),this.questionAndAnswerForm.$valid&&!this.questionContainsAnswer&&!this.messageContainsAnswer&&!this.questionContainsForbiddenWords):this.questionAndAnswerForm.$valid},t.prototype.validateDuplicateInfo=function(){var t=this.transferDetail,e=t.securityAnswer,n=t.securityQuestion,i=t.optionalMessage;this.questionContainsAnswer=Boolean(n&&e&&-1!==n.indexOf(e)),this.messageContainsAnswer=Boolean(i&&e&&-1!==i.indexOf(e)),this.questionContainsForbiddenWords=this.quetionContainsForbiddenKeywords(n),this.isAutoAccept||this.isAutoDeposit||(this.questionAndAnswerForm.securityAnswer.$setValidity("questionContainsAnswer",!this.questionContainsAnswer),this.questionAndAnswerForm.optionalMessage.$setValidity("messageContainsAnswer",!this.messageContainsAnswer),this.questionAndAnswerForm.securityQuestion.$setValidity("questionContainsForbiddenWords",!this.questionContainsForbiddenWords))},t.prototype.clearSecurityAnswerMask=function(){this.transferDetail.securityAnswer!==this.SECURITY_ANSWER_MASK&&this.transferDetail.securityAnswer||(this.transferDetail.securityAnswer="")},t.prototype.onQuestionChange=function(){this.questionAndAnswerForm.securityQuestion.$dirty&&(this.transferDetail.isSecurityQandAUpdated=!0,this.clearSecurityAnswerMask(),this.validateDuplicateInfo())},t.prototype.onAnswerBlur=function(){this.isQandADirty()||this.transferDetail.securityQuestion&&(this.transferDetail.securityAnswer=this.SECURITY_ANSWER_MASK)},t.prototype.onAnswerChange=function(){this.questionAndAnswerForm.securityAnswer.$dirty?(this.transferDetail.isSecurityQandAUpdated=!0,this.validateDuplicateInfo()):this.transferDetail.securityAnswer=this.SECURITY_ANSWER_MASK},t.prototype.onOptionalMessageChange=function(){this.questionAndAnswerForm.optionalMessage.$dirty&&(this.transferDetail.isSecurityQandAUpdated=Boolean(""!==this.transferDetail.optionalMessage)||this.isQandADirty()||this.transferDetail.securityAnswer!==this.SECURITY_ANSWER_MASK,this.validateDuplicateInfo())},t.prototype.revertOldQandA=function(){var t=this;return this.transferDetail.securityQuestion=this.existingSecurityQuestion,this.transferDetail.securityAnswer=this.eTransferDialogConstants.SECURITY_ANSWER_MASK,this.transferDetail.isSecurityQandAUpdated=Boolean(this.transferDetail.optionalMessage&&""!==this.transferDetail.optionalMessage),this.$timeout((function(){t.questionAndAnswerForm.$setPristine(),t.isQandADisabled=!0}))},t.prototype.profanityCheck=function(t){var e=this;return""!==t?this.ETransferService.profanityChecker(t).catch((function(t){e.errorHandle(t)})):this.$q.resolve({})},t.prototype.editContact=function(){var t=this;return this.ETransferService.editContact(i({},this.transferDetail.selectedRecipient,{email_answer:this.transferDetail.securityAnswer})).catch((function(e){t.errorHandle(e)}))},t.prototype.errorHandle=function(t){var e=this;this.updateLoadingState(!1);var n,i,a,s=this.eTransferDialogConstants.ERROR_CODES;t.response_status&&t.response_status.status_code===s.VALIDATION_ERROR?t.response_status.details&&t.response_status.details.length>0&&t.response_status.details.forEach((function(t){t.details_code&&(t.details_code===s.EMT_INVALID_MESSAGE_PROFANITY?(n=s.EMT_INVALID_PROFANITY,i="global.errorCodes."+n,e.submitErrors.push(i)):t.details_code===s.EMT_PENDING_EMTS_FOUND_WHILE_EDIT?(a="emt.validation."+t.details_code,e.submitWarnings.push(a),e.revertOldQandA()):(i="global.errorCodes."+t.details_code,e.submitErrors.push(i)))})):t.response_status.return_code===s.EMT_PENDING_EMTS_FOUND_WHILE_EDIT?(a="emt.validation."+t.response_status.return_code,this.submitWarnings.push(a),this.revertOldQandA()):t.response_status&&t.response_status.return_code&&(i="global.errorCodes."+t.response_status.return_code,this.submitErrors.push(i)),this.AnchorService.scrollToTop()},t.prototype.onNextButton=function(){var t=this;if(this.submitErrors=[],this.submitWarnings=[],this.validateForm()){if(this.questionAndAnswerForm.$dirty||this.transferDetail.isSecurityQandAUpdated)return this.updateLoadingState(!0),this.ETransferService.editContact(i({},this.transferDetail.selectedRecipient,{email_question:this.transferDetail.securityQuestion,email_answer:this.transferDetail.securityAnswer,message:this.transferDetail.optionalMessage}),!0).then((function(e){t.$log.debug(e),t.saveTransferDetails(t.transferDetail),t.goToReview()})).catch((function(e){t.errorHandle(e)})).finally((function(){t.updateLoadingState(!1)}));this.saveTransferDetails(this.transferDetail),this.goToReview()}else this.questionAndAnswerForm.securityAnswer.$setTouched(),this.questionAndAnswerForm.securityQuestion.$setTouched(),this.questionAndAnswerForm.optionalMessage.$setTouched();return this.$q.resolve()},t.prototype.onBackButton=function(){this.gotoPreviousState()},t.prototype.getCharactersLeft=function(){var e=a.get(this.transferDetail.optionalMessage,"length")||0;return t.AVAILABLE_CHARACTERS-e},t.prototype.mapStateToThis=function(t){return{flow:t.etransferFlow}},t.prototype.$onDestroy=function(){this.stateUnsubscriber&&this.stateUnsubscriber()},t.AVAILABLE_CHARACTERS=250,t.INITIAL_FOCUS_EL="etransfer-q-and-a-content",t}();o.$inject=["$log","$ngRedux","$timeout","$q","ETransferService","eTransferDialogConstants","serviceConstants","AnalyticsService","AnchorService"],e.default=o},function(t,e){t.exports=' <div id="etransfer_QandA_error_message" class="etransfer_QandA_error_message" ng-if="$ctrl.submitErrors.length"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors track by $index" translate="{{ error }}"></li> </ul> </tng-error-message> </div> <div id="etransfer_QandA_warning_message" class="etransfer_QandA_error_message" ng-if="$ctrl.submitWarnings.length"> <tng-warning-message> <ul> <li ng-repeat="warning in $ctrl.submitWarnings track by $index" translate="{{ warning }}"></li> </ul> </tng-warning-message> </div> <div ng-if="!$ctrl.flow.loading" class="etransfer-q-and-a-content" id="etransfer-q-and-a-content"> <p class="body--1" id="etransfer-q-and-a-subheading" ng-if="!($ctrl.isAutoDeposit || $ctrl.isAutoAccept)" tabindex="0"> <span>{{ ::\'emt.securityQuestionAndAnswer.qAndASubheading\' | translate }}</span> <span ng-if="$ctrl.transferDetail.securityQuestion">{{ ::\'emt.securityQuestionAndAnswer.qAndASubheadingReuse\' | translate }}</span> </p> <div id="etransfer-q-and-a-auto-deposit-subheading" ng-if="$ctrl.isAutoDeposit || $ctrl.isAutoAccept"> <p class="body--1" ng-if="$ctrl.isAutoDeposit" ng-bind-html="::\'emt.securityQuestionAndAnswer.interacAutoDepositSubheading\' | translate"></p> <p class="body--1" ng-if="$ctrl.isAutoAccept" ng-bind-html="::\'emt.securityQuestionAndAnswer.tngAutoAcceptSubheading\' | translate"></p> </div> <form name="$ctrl.questionAndAnswerForm" ng-submit="$ctrl.onNextButton()" novalidate autocomplete="off"> <input ng-hide="true" type="submit"/> <div class="etransfer-q-and-a-container" ng-if="!($ctrl.isAutoDeposit || $ctrl.isAutoAccept)"> <div class="field etransfer-q-and-a-input-container" id="etransfer-security-question"> <label for="securityQuestion"> {{ ::\'emt.securityQuestionAndAnswer.securityQuestion\' | translate }} <tng-help-bubble> <p class="c-tool-tip__bottom-padding"> {{ ::\'emt.securityQuestionAndAnswer.securityQuestionTooltip\' | translate }} </p> </tng-help-bubble> </label> <input id="etransfer-q-and-a-input-security-question" name="securityQuestion" class="input etransfer-q-and-a-input-width" ng-class="{warning:\n                $ctrl.questionAndAnswerForm.securityQuestion.$invalid &&\n                $ctrl.questionAndAnswerForm.securityQuestion.$touched\n              }" ng-model="$ctrl.transferDetail.securityQuestion" ng-change="$ctrl.onQuestionChange()" ng-required="true" ng-keypress="$ctrl.onKeyPress($event)" placeholder="{{ \'emt.securityQuestionAndAnswer.securityQuestionPlaceholder\' | translate }}" minlength="1" maxlength="40" ng-pattern="$ctrl.questionPattern" ng-disabled="$ctrl.isQandADisabled" title="{{ \'emt.securityQuestionAndAnswer.securityQuestion\' | translate }}"/> <div ng-messages="$ctrl.questionAndAnswerForm.securityQuestion.$error" ng-show="$ctrl.questionAndAnswerForm.securityQuestion.$touched" class="field__error"> <p ng-message="required"> {{ ::\'userSettings.general.security.requiredField\' | translate }} </p> <p ng-message="minlength"> {{ ::\'emt.validation.tooShort\' | translate }} </p> <p ng-message="pattern"> {{ ::\'global.errorCodes.EMT_INVALID_QUESTION\' | translate }} </p> <p ng-message="questionContainsForbiddenWords"> {{ ::\'emt.validation.questionContainsForbiddenWords\' | translate }} </p> </div> </div> <div class="field etransfer-q-and-a-input-container" id="etransfer-security-answer"> <label for="securityAnswer"> {{ \'emt.securityQuestionAndAnswer.securityAnswer\' | translate }} <tng-help-bubble> <p class="c-tool-tip__bottom-padding"> {{ ::\'emt.securityQuestionAndAnswer.securityAnswerTooltip\' | translate }} </p> </tng-help-bubble> </label> <input id="etransfer-q-and-a-input-security-answer" name="securityAnswer" ng-focus="$ctrl.clearSecurityAnswerMask()" ng-blur="$ctrl.onAnswerBlur()" ng-pattern="$ctrl.answerPattern" class="input etransfer-q-and-a-input-width" ng-class="{warning:\n                ($ctrl.questionAndAnswerForm.securityAnswer.$invalid ||\n                $ctrl.questionContainsAnswer) &&\n                $ctrl.questionAndAnswerForm.securityAnswer.$touched\n              }" ng-model="$ctrl.transferDetail.securityAnswer" ng-change="$ctrl.onAnswerChange()" ng-required="true" ng-keypress="$ctrl.onKeyPress($event)" placeholder="{{ \'emt.securityQuestionAndAnswer.securityAnswerPlaceholder\' | translate }}" minlength="3" maxlength="30" ng-disabled="$ctrl.isQandADisabled" title="{{ \'emt.securityQuestionAndAnswer.securityAnswer\' | translate }}"/> <div ng-messages="$ctrl.questionAndAnswerForm.securityAnswer.$error" ng-show="$ctrl.questionAndAnswerForm.securityAnswer.$touched" class="field__error"> <p ng-message="required"> {{ ::\'userSettings.general.security.requiredField\' | translate }} </p> <p ng-message="minlength"> {{ ::\'emt.validation.tooShort\' | translate }} </p> <p ng-message="questionContainsAnswer"> {{ ::\'global.errorCodes.EMT_INVALID_QUESTION_CONTAINS_ANSWER\' | translate }} </p> <p ng-message="pattern"> {{ ::\'emt.validation.onlyNumbersAndLetters\' | translate }} </p> </div> </div> </div> <div class="field etransfer-q-and-a-input-container" id="etransfer-security-message"> <label for="optionalMessage"> {{ \'emt.securityQuestionAndAnswer.optionalMessageLabel\' | translate }} <tng-help-bubble> <p class="c-tool-tip__bottom-padding" ng-bind-html="::\'emt.securityQuestionAndAnswer.optionalMessageLabelTooltip\' | translate"></p> </tng-help-bubble> </label> <div class="e-transfer-q-and-a-6-cols"> <div class="etransfer-q-and-a-message-panel panel" ng-class="{warning:\n          ($ctrl.questionAndAnswerForm.optionalMessage.$invalid ||\n          $ctrl.messageContainsAnswer) &&\n          $ctrl.questionAndAnswerForm.optionalMessage.$touched\n        }"> <div class="etransfer-q-and-a-message-description"> <textarea name="optionalMessage" id="etransfer-q-and-a-input-option-message" rows="10" tng-tool-tip-translate="emt.securityQuestionAndAnswer.optionalMessageTooltip" maxlength="250" ng-model="$ctrl.transferDetail.optionalMessage" ng-change="$ctrl.onOptionalMessageChange()" class="input etransfer-q-and-a-message-textarea" placeholder="{{\'emt.securityQuestionAndAnswer.optionalMessagePlaceholder\' | translate}}" title="{{ \'emt.securityQuestionAndAnswer.optionalMessageLabel\' | translate }}">\n              </textarea> </div> <span class="e-transfer-characters-left">{{ $ctrl.getCharactersLeft()}} {{\'emt.securityQuestionAndAnswer.optionalMessageCharsLeft\' | translate }}</span> </div> <div ng-messages="$ctrl.questionAndAnswerForm.optionalMessage.$error" ng-show="$ctrl.questionAndAnswerForm.optionalMessage.$touched" class="field__error"> <p ng-message="messageContainsAnswer"> {{ ::\'global.errorCodes.EMT_MESSAGE_CONTAINS_ANSWER\' | translate }} </p> </div> </div> </div> </form> <div class="etransfer-interac-disclaimer-container" ng-if="$ctrl.transferDetail.eTransferType === $ctrl.eTransferDialogConstants.ETRANSFER_TYPES.INTERAC_EMT && $ctrl.isAutoDeposit"> <p class="e-transfer-entry-interac-trademark" ng-bind-html="\'emt.setupPayment.interacTrademark\' | translate"></p> </div> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5282));function a(t){return t&&t.__esModule?t:{default:t}}n(5283);var s={template:a(n(5284)).default,controller:i.default,bindings:{}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a=n(178),s=function(){function t(t,e,n,i,a,s,r,o,c,l,u,d,h){this.$log=t,this.$q=e,this.$filter=n,this.$translate=i,this.$ngRedux=a,this.serviceConstants=s,this.eTransferDialogConstants=r,this.ETransferService=o,this.DateService=c,this.AnalyticsService=l,this.EventBusService=u,this.eventConstants=d,this.AnchorService=h,this.transferDetail={isSecurityQandAUpdated:!1},this.submitErrors=[],this.transferType=void 0,this.selectedRecipient=void 0,this.selectedAccount=void 0,this.amount=void 0,this.selectedDate=new Date,this.when=void 0,this.enteredQuestion=void 0,this.enteredAnswer=void 0,this.optionalMessage=void 0,this.autoDepositDetail=void 0,this.ETRANSFER_TYPES=this.eTransferDialogConstants.ETRANSFER_TYPES,this.WHEN_SEND=this.eTransferDialogConstants.WHEN_SEND}return t.prototype.$onInit=function(){this.stateUnsubscriber=this.$ngRedux.connect(this.mapStateToThis.bind(this),i({},a.EtransferFlowActions))(this),this.init(),this.setFocusOnTop(),this.setButtons(),this.setGoogleAnalytics(),this.loadData()},t.prototype.init=function(){this.transferDetail=Object.assign(this.transferDetail,this.flow.transferDetail),this.isAutoDeposit=Boolean(this.transferDetail.securityQuestion)&&Boolean(this.transferDetail.autoDepositDetail)&&this.transferDetail.eTransferType===this.eTransferDialogConstants.ETRANSFER_TYPES.INTERAC_EMT,this.isAutoAccept=Boolean(this.transferDetail.securityQuestion)&&this.transferDetail.selectedRecipient.auto_accept&&this.transferDetail.eTransferType===this.eTransferDialogConstants.ETRANSFER_TYPES.TANGERINE_EMT},t.prototype.setFocusOnTop=function(){this.AnchorService.scrollToTop()},t.prototype.setButtons=function(){this.setFlowButtons([{label:"global.components.buttons.back",action:this.onBackButtonClick.bind(this),class:"btn btn--edit",name:"eTransfer_back"},{label:"global.components.buttons.send",action:this.onSendButtonClick.bind(this),class:"btn btn--orange",name:"eTransfer_send"}])},t.prototype.setGoogleAnalytics=function(){this.AnalyticsService.sendAction(this.AnalyticsService.availableEvents.FLOW_STATE_CHANGE,this.flow.analyticsPath)},t.prototype.loadData=function(){this.transferType=this.flow.transferDetail.eTransferType,this.selectedRecipient=this.flow.transferDetail.selectedRecipient,this.selectedAccount=this.flow.transferDetail.selectedAccount,this.amount=this.$filter("tngCurrency")(this.flow.transferDetail.amount||0),this.selectedDate=this.flow.transferDetail.selectedDate,this.when=this.ETransferService.isFutureDate(this.transferDetail.selectedDate)?this.WHEN_SEND.LATER:this.WHEN_SEND.NOW,this.enteredQuestion=this.flow.transferDetail.securityQuestion,this.enteredAnswer=this.flow.transferDetail.securityAnswer,this.optionalMessage=this.flow.transferDetail.optionalMessage,this.autoDepositDetail=this.flow.transferDetail.autoDepositDetail},t.prototype.onBackButtonClick=function(){this.$log.debug("Return to eTransfer Q&A page"),this.gotoPreviousState()},t.prototype.getRecipientDisplayName=function(){return this.autoDepositDetail?this.autoDepositDetail.registrationName.concat(" (",this.selectedRecipient.name,")"):this.selectedRecipient.name},t.prototype.isSecurityQuestionAnswerUpdated=function(){return this.ETransferService.isSecurityQuestionAnswerUpdated(this.transferDetail)},t.prototype.onSendButtonClick=function(){var t=this;return this.$log.debug("Submit the request from eTranfer Review Page"),this.updateLoadingState(!0),this.submitErrors=[],this.submitRequest().then((function(e){t.updateLoadingState(!1),e?(t.$log.debug("Submit transfer from eTranfer Review Page"),t.gotoDone(t.transferDetail)):t.AnchorService.scrollToTop()})).catch((function(e){t.updateLoadingState(!1),t.showSubmitErrors(void 0,e),t.AnchorService.scrollToTop()}))},t.prototype.onTransferTypeTileClick=function(){this.$log.debug("Return to eTransfer Q&A page"),this.goFromReviewToEntry()},t.prototype.onTransferInfoTileClick=function(){this.$log.debug("Return to eTransfer Setup page"),this.goFromReviewToSetup(this.transferDetail)},t.prototype.onSecurityInfoTileClick=function(){this.$log.debug("Return to eTransfer Q&A page"),this.gotoPreviousState()},t.prototype.submitRequest=function(){var t=this,e=this.ETransferService.prepareTransactionPayload(this.transferDetail);return this.isSecurityQuestionAnswerUpdated()?this.saveContact().then((function(n){t.eTransferDialogConstants.ERROR_CODES;return n?t.submitETransfer(e):t.$q.resolve(!1)})):this.submitETransfer(e)},t.prototype.submitETransfer=function(t){var e=this;return this.ETransferService.sendMoneyEmailTransfer(t,!1).then((function(t){var n=void 0;if(t.response_status.status_code===e.serviceConstants.STATUS_CODES.AVLBALHLD){var i="emt.emailMoney.moreThanAvailableHold",a=e.$filter("tngCurrency")(e.amount||0);n=e.$translate.instant(i,{availableAmount:a})}else if(t.response_status.status_code===e.serviceConstants.STATUS_CODES.AVLBAL){i="emt.emailMoney.moreThanAvailable";n=e.$translate.instant(i)}else-1===[e.serviceConstants.STATUS_CODES.CREATED,e.serviceConstants.STATUS_CODES.SUCCESS].indexOf(t.response_status.status_code)&&(e.$log.error("EMT API Submission Error: ",t.response_status),n=e.$translate.instant("global.errorCodes."+(t.response_status.return_code||t.response_status.status_code)));return n?(e.showSubmitErrors(n,void 0),e.$q.resolve(!1)):(t.confirmations&&t.confirmations.length>0&&(e.transferDetail.confirmationNumber=t.confirmations[0].confirmation_code),e.$q.resolve(!0))}))},t.prototype.saveContact=function(){var t=this;return this.ETransferService.editContact(i({},this.transferDetail.selectedRecipient,{email_question:this.transferDetail.securityQuestion,email_answer:this.transferDetail.securityAnswer}),!1).then((function(e){var n,i=t.eTransferDialogConstants.ERROR_CODES;return e.response_status.status_code===i.EMT_INVALID_MESSAGE_PROFANITY?n=t.$translate.instant("global.errorCodes.global.errorCodes.ERROR_CODES.EMT_INVALID_PROFANITY"):e.response_status.status_code===i.EMT_INVALID_MESSAGE_PROFANITY?n=t.$translate.instant("emt.validation.ERROR_CODES.ERROR_CODES.NOT_ALLOWED_TO_EDIT_CONTACT"):-1===[t.serviceConstants.STATUS_CODES.CREATED,t.serviceConstants.STATUS_CODES.SUCCESS].indexOf(e.response_status.status_code)&&(t.$log.error("EMT API Submission Error: ",e.response_status),n=t.$translate.instant("global.errorCodes."+(e.response_status.return_code||e.response_status.status_code))),n?(t.showSubmitErrors(n,void 0),t.$q.resolve(!1)):(t.EventBusService.publish(t.eventConstants.EMT_CONTACTS_REFRESH),t.$q.resolve(!0))}))},t.prototype.showSubmitErrors=function(t,e){var n=this;t?this.submitErrors.push(t):"errorMessage"in e?this.submitErrors.push(e.errorMessage):e.response_status&&"details"in e.response_status?e.response_status.details.forEach((function(t){n.submitErrors.push(t)})):(e.response_status.return_code||e.response_status.status_code)&&this.submitErrors.push(this.$translate.instant("global.errorCodes."+(e.response_status.return_code||e.response_status.status_code))),this.$log.error("eTransfer Review error:",this.submitErrors)},t.prototype.mapStateToThis=function(t){return{flow:t.etransferFlow}},t.prototype.$onDestroy=function(){this.stateUnsubscriber&&this.stateUnsubscriber()},t.INITIAL_FOCUS_EL="etransfer-review-transfer-type-tile-arrow",t}();s.$inject=["$log","$q","$filter","$translate","$ngRedux","serviceConstants","eTransferDialogConstants","ETransferService","DateService","AnalyticsService","EventBusService","eventConstants","AnchorService"],e.default=s},function(t,e,n){},function(t,e){t.exports=' <div ng-if="!$ctrl.flow.loading" class="c-review-container"> <div class="c-review-tile-container"> <div id="etransfer_review_error_message" ng-if="$ctrl.submitErrors.length > 0"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors track by $index">{{ error | translate }}</li> </ul> </tng-error-message> </div> <p id="etransfer-review-tangerine-emt-subtitle" ng-show="::($ctrl.transferType === $ctrl.ETRANSFER_TYPES.TANGERINE_EMT)"> {{ ::\'emt.review.tangerineEmtSubtitle\' | translate }} </p> <div id="etransfer-review-transfer-type-tile" class="c-tile c-tile--round"> <tng-tile-item class="c-tile--md" ng-click="$ctrl.onTransferTypeTileClick()"> <div class="m-send-emt__to-tile-section"> <div class="tile-header">{{ ::\'emt.emailMoney.transferType\' | translate }}</div> <div id="etransfer-review-transfer-type-tangerine-emt" class="c-tile-info-bold c-review-text" ng-if="::($ctrl.transferType === $ctrl.ETRANSFER_TYPES.TANGERINE_EMT)"> {{ ::\'emt.review.transferType.tangerineEtransfer\' | translate }}</div> <div id="etransfer-review-transfer-type-interac-emt" class="c-tile-info-bold c-review-text" ng-if="::($ctrl.transferType === $ctrl.ETRANSFER_TYPES.INTERAC_EMT)" ng-bind-html="::\'emt.review.transferType.interacEtransfer\' | translate"></div> </div> <div class="tile-section align-right"> <span id="etransfer-review-transfer-type-tile-arrow" class="tile-section__arrow tile-section__arrow--large large icon-rightarrow" tabindex="0"></span> </div> </tng-tile-item> </div> <div id="etransfer-review-transfer-info-tile" class="c-tile c-tile--round"> <tng-tile-item class="c-tile--flex" ng-click="$ctrl.onTransferInfoTileClick()"> <div class="m-send-emt__to-tile-section"> <div class="tile-header">{{ ::\'emt.review.transfer.sendTo\' | translate }}</div> <div id="etransfer-review-transfer-to-name" class="c-tile-info-bold c-review-text c-line-spacing">{{ ::$ctrl.getRecipientDisplayName() }}</div> <div id="etransfer-review-transfer-to-email" class="c-review-text c-email-text c-section-spacing">{{ ::$ctrl.selectedRecipient.email_address }}</div> <div class="tile-header">{{ ::\'emt.review.transfer.from\' | translate }}</div> <div id="etransfer-review-transfer-from-account" class="c-tile-info-bold c-review-text c-line-spacing" ng-bind-html="::$ctrl.selectedAccount.title"></div> <div id="etransfer-review-transfer-from-balance" class="c-review-text c-review-text c-section-spacing">{{ ::$ctrl.selectedAccount.balance }}</div> <div class="tile-header">{{ ::\'emt.review.transfer.amount\' | translate }}</div> <div id="etransfer-review-transfer-amount" class="c-tile-amount c-section-spacing">{{ ::$ctrl.amount}}</div> <div class="tile-header">{{ ::\'emt.review.transfer.transferDate\' | translate }}</div> <div class="c-tile-info-bold c-review-text c-line-spacing">{{ ::$ctrl.DateService.convertToFormattedMonthDayYear($ctrl.selectedDate) }}</div> </div> <div class="tile-section align-right"> <span id="etransfer-review-transfer-info-tile-arrow" class="tile-section__arrow tile-section__arrow--large large icon-rightarrow"></span> </div> </tng-tile-item> </div> <div id="etransfer-review-security-qanda-tile" class="c-tile c-tile--round" ng-if="::$ctrl.transferDetail.isSecurityQandAUpdated"> <tng-tile-item class="c-tile--md" ng-click="$ctrl.onSecurityInfoTileClick()"> <div class="m-send-emt__to-tile-section"> <div id="etransfer-review-security-qanda-section" ng-if="::$ctrl.isSecurityQuestionAnswerUpdated()"> <div class="tile-header">{{ ::\'emt.review.security.question\' | translate }}</div> <div id="etransfer-review-security-qanda-question" class="c-security-text c-section-spacing">{{ ::$ctrl.enteredQuestion }}</div> <div class="tile-header">{{ ::\'emt.review.security.answer\' | translate }}</div> <div id="etransfer-review-security-qanda-answer" class="c-security-text c-section-spacing">{{ ::$ctrl.enteredAnswer }}</div> </div> <div id="etransfer-review-security-optional-message-section" ng-if="::$ctrl.optionalMessage && $ctrl.optionalMessage.length > 0"> <div class="tile-header">{{ ::\'emt.review.security.optionalMessage\' | translate }}</div> <div id="etransfer-review-security-qanda-optional-message" class="c-security-text">{{ ::$ctrl.optionalMessage }}</div> </div> </div> <div class="tile-section align-right"> <span id="etransfer-review-security-qanda-tile-arrow" class="tile-section__arrow tile-section__arrow--large large icon-rightarrow"></span> </div> </tng-tile-item> </div> <div ng-if="$ctrl.isAutoDeposit || $ctrl.isAutoAccept"> <div class="c-note-text" ng-bind-html="::\'emt.review.autodeposit\' | translate"></div> <div class="c-note-text" ng-bind-html="::\'emt.review.beware\' | translate"></div> </div> <div class="c-note-text" ng-bind-html="::\'emt.review.bewareNote\' | translate" ng-if="!($ctrl.isAutoDeposit || $ctrl.isAutoAccept)"></div> </div> <div id="etransfer-review-interac-tandc" class="c-emt-terms-and-conditions__terms-table-section" ng-if="$ctrl.transferType === $ctrl.ETRANSFER_TYPES.INTERAC_EMT"> <div class="dialog__title">{{ ::\'emt.termsAndConditions.title\' | translate }}</div> <div id="emt-tnc-accordion-wrapper" tabindex="0"> <emt-terms-and-conditions-accordion></emt-terms-and-conditions-accordion> </div> <div id="etransfer-review-interac-tandc-disclaimer" class="c-interac-disclaimer"> <span translate="emt.receiveMoneyClient.interacTrademark1"></span> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5286));function a(t){return t&&t.__esModule?t:{default:t}}n(5287);var s={template:a(n(5288)).default,controller:i.default,bindings:{}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a=n(178),s=n(45),r=function(){function t(t,e,n,i,a,s,r,o,c,l){this.$log=t,this.$ngRedux=e,this.$state=n,this.stateConstants=i,this.eTransferDialogConstants=a,this.localeConstants=s,this.LocaleService=r,this.AnalyticsService=o,this.ETransferService=c,this.$window=l,this.isAutoDeposit=!1,this.isAutoAccept=!1,this.currentBalance=!1,this.showAutoDepositMsg=!1,this.EMAIL_TRANSFER_TYPE_FILTER="emailMoneyTransfer",this.ETRANSFER_TYPES=this.eTransferDialogConstants.ETRANSFER_TYPES,this.dateDisplayFormat="en"===this.localeConstants.SHORTHAND_LOCALE[this.LocaleService.locale]?"MMMM DD, YYYY":"DD MMMM YYYY"}return t.prototype.$onInit=function(){this._init(),this._setButtons(),this._setSelectedDate(),this._setCurrentBalance(),this._setPageState(),this._setGoogleAnalytics()},t.prototype._init=function(){this.stateUnsubscriber=this.$ngRedux.connect(this._mapStateToThis.bind(this),i({},a.EtransferFlowActions))(this),this.transferDetail=this.flow.transferDetail,this.isAutoDeposit=Boolean(this.transferDetail.autoDepositDetail)&&this.transferDetail.eTransferType===this.eTransferDialogConstants.ETRANSFER_TYPES.INTERAC_EMT,this.isAutoAccept=Boolean(this.transferDetail.selectedRecipient.auto_accept)&&this.transferDetail.eTransferType===this.eTransferDialogConstants.ETRANSFER_TYPES.TANGERINE_EMT,this.showAutoDepositMsg=!this.ETransferService.isSecurityQuestionAnswerUpdated(this.transferDetail)&&this.isAutoDeposit},t.prototype._setButtons=function(){this.setFlowButtons([{label:"global.components.buttons.done",action:this._onDoneButtonClick.bind(this),class:"btn btn--orange",name:"eTransfer_done"}])},t.prototype._setSelectedDate=function(){this.selectedDate=this.transferDetail.selectedDate.format(this.dateDisplayFormat)},t.prototype._setCurrentBalance=function(){this.currentBalance=s().isSame(this.transferDetail.selectedDate,"day")?this.transferDetail.selectedAccount.account_balance-this.transferDetail.amount:this.transferDetail.selectedAccount.account_balance},t.prototype._setPageState=function(){this.$window.currentStatePageChangeCb&&this.$window.currentStatePageChangeCb(this.flow.analyticsPath)},t.prototype._setGoogleAnalytics=function(){this.AnalyticsService.sendAction(this.AnalyticsService.availableEvents.FLOW_STATE_CHANGE,this.flow.analyticsPath)},t.prototype.getRecipientDisplayName=function(){return this.transferDetail.autoDepositDetail?this.transferDetail.autoDepositDetail.registrationName.concat(" (",this.transferDetail.selectedRecipient.name,")"):this.transferDetail.selectedRecipient.name},t.prototype.isSecurityQuestionAnswerUpdated=function(){return this.ETransferService.isSecurityQuestionAnswerUpdated(this.transferDetail)},t.prototype._onDoneButtonClick=function(){this.exitTransfer()},t.prototype.onViewEtransferClick=function(){return this.exitTransfer(),this.$state.go(this.stateConstants.TRANSACTIONS,{filter:this.EMAIL_TRANSFER_TYPE_FILTER})},t.prototype._mapStateToThis=function(t){return{flow:t.etransferFlow}},t.prototype.$onDestroy=function(){this.stateUnsubscriber&&this.stateUnsubscriber()},t}();r.$inject=["$log","$ngRedux","$state","stateConstants","eTransferDialogConstants","localeConstants","LocaleService","AnalyticsService","ETransferService","$window"],e.default=r},function(t,e,n){},function(t,e){t.exports=' <div class="etransfer-done"> <div class="etransfer-done__subtitles"> <p id="done-subtitle1" class="etransfer-done__subtitle">{{::\'emt.done.subtitle1\' | translate }}</p> <p ng-if="$ctrl.transferDetail.eTransferType === $ctrl.ETRANSFER_TYPES.TANGERINE_EMT" id="done-subtitle1" class="etransfer-done__subtitle" ng-bind-html="\'emt.done.subtitle2\' | translate"></p> <p ng-if="$ctrl.transferDetail.eTransferType === $ctrl.ETRANSFER_TYPES.INTERAC_EMT" id="done-subtitle1" class="etransfer-done__subtitle" ng-bind-html="\'emt.done.subtitle3\' | translate"></p> </div> <div class="etransfer-done__setup"> <table class="etransfer-done__table"> <tr> <td colspan="3"> {{::\'emt.done.confirmationNumber\' | translate }} <span id="confirmNo" class="etransfer-done__confirm">{{ $ctrl.transferDetail.confirmationNumber }}</span> </td> </tr> <tr> <td colspan="3"> {{::\'emt.done.transferTo\' | translate }}<br/> <span id="name" class="etransfer-done__text-space"><b>{{ $ctrl.getRecipientDisplayName() }}</b></span> <span id="email" class="etransfer-done__text">{{ $ctrl.transferDetail.selectedRecipient.email_address }}</span> </td> </tr> <tr> <td class="etransfer-done__3cells"> {{::\'emt.done.amount\' | translate }}<br/> <span id="amount" class="etransfer-done__large-orange">{{ $ctrl.transferDetail.amount | currency:"$":2 }}</span> </td> <td class="etransfer-done__3cells"> <span>{{::\'emt.done.newBalance\' | translate }}</span> <b><span ng-bind-html="::$ctrl.transferDetail.selectedAccount.title"></span></b><br/> <span id="balance" class="etransfer-done__large-orange">{{ $ctrl.currentBalance | currency:"$":2 }}</span> </td> <td> <span ng-bind-html="\'emt.done.transfer\' | translate"></span><br/> <span id="transferDate" class="etransfer-done__large-orange"> {{ $ctrl.selectedDate }} </span> </td> </tr> </table> </div> <div ng-if="$ctrl.transferDetail.isSecurityQandAUpdated" class="etransfer-done__verification"> <table class="etransfer-done__table"> <tr ng-if="::$ctrl.isSecurityQuestionAnswerUpdated()"> <td class="etransfer-done__2cells"> {{::\'emt.done.question\' | translate }}<br/> <span id="securityQuestion" class="etransfer-done__text"><b>{{ $ctrl.transferDetail.securityQuestion}}</b></span> </td> <td> {{::\'emt.done.answer\' | translate }}<br/> <span id="securityAnswer" class="etransfer-done__text"><b>{{ $ctrl.transferDetail.securityAnswer }}</b></span> </td> </tr> <tr ng-if="$ctrl.transferDetail.optionalMessage"> <td colspan="2"> {{::\'emt.done.message\' | translate }}<br/> <span id="securityMsg" class="etransfer-done__text">{{ $ctrl.transferDetail.optionalMessage }}</span> </td> </tr> </table> </div> <div class="etransfer-done__setup-verification"> <table class="etransfer-done__table"> <tr> <td> {{::\'emt.done.confirmationNumber\' | translate }} <span id="confirmNo" class="etransfer-done__confirm">{{ $ctrl.transferDetail.confirmationNumber }}</span> </td> </tr> <tr> <td> {{::\'emt.done.transferTo\' | translate }}<br/> <span id="nameEmail" class="etransfer-done__text-space"><b>{{ $ctrl.transferDetail.selectedRecipient.name }}</b></span> <span class="etransfer-done__text">{{ $ctrl.transferDetail.selectedRecipient.email_address }}</span> </td> </tr> <tr> <td> {{::\'emt.done.amount\' | translate }}<br/> <span id="amount" class="etransfer-done__large-orange">{{ $ctrl.transferDetail.amount | currency:"$":2 }}</span> </td> </tr> <tr> <td> <span>{{::\'emt.done.newBalance\' | translate }}</span> <b><span ng-bind-html="::$ctrl.transferDetail.selectedAccount.title"></span></b><br/> <span id="balance" class="etransfer-done__large-orange">{{ $ctrl.currentBalance | currency:"$":2 }}</span> </td> </tr> <tr> <td> <span ng-bind-html="\'emt.done.transfer\' | translate"></span><br/> <span id="transferDate" class="etransfer-done__large-orange"> {{ $ctrl.selectedDate }} </span> </td> </tr> <tr ng-if="::$ctrl.isSecurityQuestionAnswerUpdated()"> <td> {{::\'emt.done.question\' | translate }}<br/> <span id="sequirtyQuestion" class="etransfer-done__text"><b>{{ $ctrl.transferDetail.securityQuestion}}</b></span> </td> </tr> <tr ng-if="::$ctrl.isSecurityQuestionAnswerUpdated()"> <td> {{::\'emt.done.answer\' | translate }}<br/> <span id="sequirtyAnswer" class="etransfer-done__text"><b>{{ $ctrl.transferDetail.securityAnswer }}</b></span> </td> </tr> <tr ng-if="$ctrl.transferDetail.optionalMessage"> <td colspan="2"> {{::\'emt.done.message\' | translate }}<br/> <span id="sequirtyMsg" class="etransfer-done__text">{{ $ctrl.transferDetail.optionalMessage }}</span> </td> </tr> </table> </div> <div class="etransfer-done__auto-transfer"> <p ng-if="$ctrl.showAutoDepositMsg" id="interacAutodeposit" ng-bind-html="::\'emt.done.autodeposit\'|translate"></p><p ng-if="$ctrl.isAutoAccept" id="interacAutoaccept" ng-bind-html="::\'emt.done.autoaccept\'|translate"></p> </div> <div class="etransfer-done__button"> <tng-print-button id="printButton" button-class="btn etransfer-done__button__grey" only-element="\'printMe\'"> {{ ::\'global.print\' | translate}} </tng-print-button> </div> <div class="etransfer-done__view-transfer"> <p id="tileHeader" class="etransfer-done__tile-title">{{::\'emt.done.etransferTitle\' | translate }}</p> <div id="viewTranferTile" class="etransfer-done__tile" ng-click="$ctrl.onViewEtransferClick()"> <div class="etransfer-done__tile-text"> {{ ::\'emt.done.etransferTile\' | translate }} </div> <div class="etransfer-done__arrow icon-rightarrow large"></div> </div> </div> <div ng-if="$ctrl.transferDetail.eTransferType === $ctrl.ETRANSFER_TYPES.INTERAC_EMT"> <p id="interacTrademark" class="etransfer-done__interac-trademark" ng-bind-html="\'emt.setupPayment.interacTrademark\' | translate"></p> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5290));n(5291);var a=s(n(5292));function s(t){return t&&t.__esModule?t:{default:t}}var r={controller:i.default,template:a.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a=n(178),s=n(538),r=function(){function t(t,e,n){this.$log=t,this.$ngRedux=e,this.$translate=n,this.PAGES=s.EtransferPage}return t.prototype.$onInit=function(){this.stateUnsubscriber=this.$ngRedux.connect(this.mapStateToThis.bind(this),i({},a.EtransferFlowActions))(this)},Object.defineProperty(t.prototype,"header",{get:function(){return this.flow.currentFlowIndex===this.PAGES.ETRANSFER_UPDATE_CONTACT||this.flow.currentFlowIndex===this.PAGES.ETRANSFER_DELETE_CONTACT?this.$translate.instant(this.flow.dialogTitle,{firstName:this.flow.transferDetail.selectedRecipient.first_name}):this.$translate.instant(this.flow.dialogTitle)},enumerable:!0,configurable:!0}),t.prototype.onAction=function(t,e){t(),e.target.blur()},t.prototype.mapStateToThis=function(t){var e=t.etransferFlow;return e.closeModal&&this.onClose(),{flow:e}},t.prototype.$onDestroy=function(){this.resetFlow(),this.stateUnsubscriber&&this.stateUnsubscriber()},t}();r.$inject=["$log","$ngRedux","$translate"],e.default=r},function(t,e,n){},function(t,e){t.exports='<tng-modal-dialog on-close="$ctrl.exitTransfer()" on-allow-exit="$ctrl.onClose()" show-confirm-exit="$ctrl.flow.showExitConfirmation" on-deny-exit="$ctrl.hideExitConfirmation()"> <div id="scroll-to-top"></div> <header> {{ $ctrl.header }} </header> <tng-etransfer-entry ng-if="$ctrl.flow.currentFlowIndex === $ctrl.PAGES.ETRANSFER_CHOOSE_TYPE"> </tng-etransfer-entry> <tng-etransfer-agreement ng-if="$ctrl.flow.currentFlowIndex === $ctrl.PAGES.ETRANSFER_AGREEMENT"> </tng-etransfer-agreement> <tng-etransfer-setup ng-if="$ctrl.flow.currentFlowIndex === $ctrl.PAGES.ETRANSFER_SETUP"> </tng-etransfer-setup> <tng-etransfer-edit-contact ng-if="$ctrl.flow.currentFlowIndex === $ctrl.PAGES.ETRANSFER_UPDATE_CONTACT || $ctrl.flow.currentFlowIndex === $ctrl.PAGES.ETRANSFER_CREATE_CONTACT"> </tng-etransfer-edit-contact> <tng-etransfer-delete-contact ng-if="$ctrl.flow.currentFlowIndex === $ctrl.PAGES.ETRANSFER_DELETE_CONTACT"> </tng-etransfer-delete-contact> <tng-etransfer-payment-mobile ng-if="$ctrl.flow.currentFlowIndex === $ctrl.PAGES.ETRANSFER_PAYMENT_MOBILE"> </tng-etransfer-payment-mobile> <tng-etransfer-qand-a ng-if="$ctrl.flow.currentFlowIndex === $ctrl.PAGES.ETRANSFER_SECURITY_QUESTION_AND_ANSWER"> </tng-etransfer-qand-a> <tng-etransfer-review ng-if="$ctrl.flow.currentFlowIndex === $ctrl.PAGES.ETRANSFER_REVIEW"> </tng-etransfer-review> <tng-etransfer-done id="printMe" ng-if="$ctrl.flow.currentFlowIndex === $ctrl.PAGES.ETRANSFER_DONE"> </tng-etransfer-done> <div ng-if="$ctrl.flow.loading" class="c-loading-spinner-container"> <tng-loading-spinner> <p>{{ ::\'global.commonWords.loading\' | translate }}</p> </tng-loading-spinner> </div> <footer class="send-etransfer-dialog-footer" ng-if="!$ctrl.flow.loading"> <button class="tangerine-accessible" ng-repeat="button in $ctrl.flow.buttons.slice().reverse() track by $index" ng-class="button.class" watch-actionable-id="true" actionable-id="etransferButton_{{ button.name }}" ng-disabled="button.isDisabled && button.isDisabled()" ng-click="$ctrl.onAction(button.action, $event)"> {{ button.label | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(5294)),a=r(n(5298)),s=r(n(5299));function r(t){return t&&t.__esModule?t:{default:t}}var o=angular.module("send-emt-modal",[]).component("sendEmtModal",i.default).service("sendEmtFlowService",a.default).filter("contactSearchFilter",s.default);e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5295)),a=s(n(5296));function s(t){return t&&t.__esModule?t:{default:t}}n(5297);var r={controller:a.default,template:i.default,bindings:{onClose:"&",settingsRecipient:"<",goToStep:"<",transferContactEdit:"<",isTransactionEdit:"<",isSelectingJointContact:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog class="m-send-emt fb2" hide-close="$ctrl.loading" on-close="$ctrl.onModalClose(result)" is-visible="true" flow-service="$ctrl.flowService"> <header ng-if="!$ctrl.flowService.showConfirmExitUI"> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.SEARCH"> {{ $ctrl.flowService.STATES.SEARCH.titleKey | translate }} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.ACCEPT_TERMS_AND_CONDITIONS"> {{ $ctrl.flowService.STATES.ACCEPT_TERMS_AND_CONDITIONS.titleKey | translate }} </span> <span ng-if="$ctrl.isSelectingJointContact && $ctrl.FORM_TYPE.EDIT === $ctrl.formType"> {{ ::\'emt.jointAccount.title.edit\' | translate: { name: $ctrl.recipient.first_name } }} </span> <span ng-if="$ctrl.isSelectingJointContact && $ctrl.FORM_TYPE.NEW === $ctrl.formType"> {{ ::\'emt.jointAccount.title.add\' | translate}} </span> <span ng-if="!$ctrl.isSelectingJointContact && $ctrl.FORM_TYPE.EDIT === $ctrl.formType\n                && ($ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS)" ng-bind-html="$ctrl.flowService.STATES.EDIT_ADDRESS.titleKey | translate:{\n          firstName: $ctrl.recipient.first_name }"> </span> <span ng-if="$ctrl.FORM_TYPE.EDIT === $ctrl.formType\n                && ($ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS_EMT_FLOW)"> {{ $ctrl.flowService.STATES.EDIT_ADDRESS_EMT_FLOW.titleKey | translate }} </span> <span ng-if="!$ctrl.isSelectingJointContact && $ctrl.FORM_TYPE.NEW === $ctrl.formType\n                && ($ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS || $ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS_EMT_FLOW)"> {{ ::\'emt.states.newContact\' | translate}} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DELETE_CONTACT"> {{ $ctrl.flowService.STATES.DELETE_CONTACT.titleKey | translate }} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.CONTACT_DELETED"> {{ $ctrl.flowService.STATES.CONTACT_DELETED.titleKey | translate }} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.TYPE_OF_TRANSFER"> {{ $ctrl.flowService.STATES.TYPE_OF_TRANSFER.titleKey | translate }} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.CHOOSE_ACCOUNT"> {{ $ctrl.flowService.STATES.CHOOSE_ACCOUNT.titleKey | translate }} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.WHEN"> {{ $ctrl.flowService.STATES.WHEN.titleKey | translate }} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.HOW_MUCH"> {{ $ctrl.flowService.STATES.HOW_MUCH.titleKey | translate }} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DATE"> {{ $ctrl.flowService.STATES.DATE.titleKey | translate }} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW"> {{ $ctrl.flowService.STATES.REVIEW.titleKey | translate }} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.PROCESSING"> {{ $ctrl.flowService.STATES.PROCESSING.titleKey | translate }} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DONE && $ctrl.transaction.WHEN_STATE === $ctrl.WHEN_SEND.NOW"> {{ $ctrl.flowService.STATES.DONE.titleKey | translate }} </span> <span ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DONE && $ctrl.transaction.WHEN_STATE === $ctrl.WHEN_SEND.LATER"> {{ $ctrl.flowService.STATES.SCHEDULED.titleKey | translate }} </span> </header> <div ng-if="!$ctrl.flowService.showConfirmExitUI"> <tng-loading-in-progress ng-if="$ctrl.loading" class="c-loading-spinner"> </tng-loading-in-progress> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.SEARCH"> <form novalidate name="form" ng-submit="$ctrl.searchTermSubmit()"> <div ng-if="$ctrl.submitErrors.length > 0"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors track by $index">{{ error | translate }}</li> </ul> </tng-error-message> </div> <div class="field"> <i class="field__icon icon-search"></i> <input ng-model="$ctrl.searchTerm" ng-change="$ctrl.checkContact()" type="text" class="input" placeholder="{{ \'emt.emailMoney.searchPlaceholder\' | translate }}" ng-model-options="{ debounce: 750 }"> </div> </form> <div class="c-tile c-tile--flat-design c-tile--margin-top-none ignore-modal-padding" ng-if="$ctrl.searchTerm && ($ctrl.recipients|contactSearchFilter: $ctrl.searchTerm).length === 0"> <div class="c-tile__header c-tile__header--flex"> <div class="c-tile__header-title">{{ ::\'emt.emailMoney.addContact\' | translate }}</div> </div> <tng-tile-item class="c-tile--md" ng-click="$ctrl.addContact()"> <div class="tile-section"> <h1>{{$ctrl.searchTerm}}</h1> <p>{{ ::\'emt.emailMoney.clickNextToCreateContact\' | translate }}</p> </div> </tng-tile-item> </div> <div> <div class="loading--full-modal" ng-show="$ctrl.loading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div class="c-tile c-tile--flat-design c-tile--margin-top-lg ignore-modal-padding" ng-if="($ctrl.recentContacts | contactSearchFilter:$ctrl.searchTerm).length"> <div class="c-tile__header c-tile__header--flex"> <div class="c-tile__header-title">{{ ::\'emt.emailMoney.recentContacts\' | translate }}</div> <div class="c-tile__header-title"> {{ ::\'emt.emailMoney.autoAccept\' | translate }} <tng-help-bubble>{{ ::(\'emt.emailMoney.autoAcceptTooltip\' | translate) }}</tng-help-bubble> </div> </div> <tng-tile-item ng-repeat="(key, recipient) in $ctrl.recentContacts |\n              limitTo: 5 |\n              contactSearchFilter:$ctrl.searchTerm |\n              orderBy:\'-last_email_date\'" ng-click="$ctrl.setSelectedRecentRecipient(key, recipient)" class="c-tile--md c-tile--footer-on-select c-tile" ng-class="{\'c-tile--selected\': key === $ctrl.selectedRecentRecipientKey}"> <div class="tile-section col-6"> <h1>{{ ::recipient.first_name }} {{ ::recipient.last_name }}</h1> <p>{{ ::recipient.email_address }}</p> </div> <div class="tile-section hide-on-mobile show-on-hover"> <button actionable-id="send-emt-edit_contacts_recipients" tng-click="$ctrl.editContact(recipient)" level2-auth class="btn--edit" ng-class="{\'c-tile--selected\': key === $ctrl.selectedRecentRecipientKey}">{{ ::\'emt.emailMoney.edit\' | translate }} </button> </div> <div class="tile-section align-right col-2"> <div class="m-send-emt__check-icon" tng-tool-tip-translate="emt.emailMoney.autoAcceptTooltip" ng-show="recipient.auto_accept"> <span class="icon-check1"></span> </div> </div> <footer> <button actionable-id="send-emt-edit_contacts_recipients" tng-click="$ctrl.editContact(recipient)" level2-auth class="btn--edit btn--tile-footer" ng-class="{\'c-tile--selected\': key === $ctrl.selectedRecentRecipientKey}">{{ ::\'emt.emailMoney.edit\' | translate }} </button> </footer> </tng-tile-item> </div> <button actionable-id="send-emt-manage_contacts" ng-click="$ctrl.manageContacts()" class="btn--edit margin__t--fix2">{{ ::\'emt.emailMoney.manage\' | translate }} </button> <div class="c-tile c-tile--flat-design c-tile--margin-top-lg ignore-modal-padding" ng-if="($ctrl.recipients | contactSearchFilter:$ctrl.searchTerm).length"> <div class="c-tile__header c-tile__header--flex"> <div class="c-tile__header-title">{{ ::\'emt.emailMoney.allContacts\' | translate }}</div> <div class="c-tile__header-title"> {{ ::\'emt.emailMoney.autoAccept\' | translate }} <tng-help-bubble>{{ ::(\'emt.emailMoney.autoAcceptTooltip\' | translate) }}</tng-help-bubble> </div> </div> <tng-tile-item class="c-tile--md c-tile--footer-on-select" ng-repeat="(key, recipient) in $ctrl.recipients | contactSearchFilter:$ctrl.searchTerm | orderBy:\'last_name\'" ng-click="$ctrl.setSelectedRecipient(key, recipient)" ng-class="{\'c-tile--selected\': key === $ctrl.selectedRecipientKey}"> <div class="tile-section col-6"> <h1>{{ ::recipient.first_name }} {{ ::recipient.last_name }}</h1> <p>{{ ::recipient.email_address }}</p> </div> <div class="tile-section hide-on-mobile show-on-hover"> <button actionable-id="send-emt-edit_contacts_recipients" tng-click="$ctrl.editContact(recipient)" level2-auth class="btn--edit" ng-class="{\'c-tile--selected\': key === $ctrl.selectedRecipientKey}">{{ ::\'emt.emailMoney.edit\' | translate }} </button> </div> <div class="tile-section align-right col-2"> <div ng-show="recipient.auto_accept" class="m-send-emt__check-icon" tng-tool-tip-translate="emt.emailMoney.autoAcceptTooltip"> <span class="icon-check1"></span> </div> </div> <footer> <button actionable-id="send-emt-edit_contacts_recipients" tng-click="$ctrl.editContact(recipient)" level2-auth class="btn--edit btn--tile-footer" ng-class="{\'c-tile--selected\': key === $ctrl.selectedRecentRecipientKey}">{{ ::\'emt.emailMoney.edit\' | translate }} </button> </footer> </tng-tile-item> </div> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.TYPE_OF_TRANSFER" class="m-send-emt__container-6"> <p class="body--2">{{ ::\'emt.emailMoney.choseType\' | translate}}</p> <div class="c-tile c-tile--round"> <tng-tile-item class="c-tile--md" ng-click="$ctrl.transfer($ctrl.TRANSFER_TYPE.INTERAC_EMT)"> <div class="tile-section"> <div class="display-flex bot-p"> <h1 class="m-send-emt__interac-tile-new-style margin-bot-0" ng-bind-html="\'emt.emailMoney.interac\' | translate"></h1> <tng-help-bubble class="icon-center"><span translate="emt.emailMoney.interacBubble"></span></tng-help-bubble> </div> <p class="m-send-emt__interac-free-new-style">{{::\'emt.emailMoney.free\' | translate}}</p> </div> <div class="tile-section align-right"> <span class="tile-section__arrow tile-section__arrow--large icon-rightarrow"></span> </div> </tng-tile-item> </div> <div class="m-send-emt__emt-tile-new-style"> <span class="m-send-emt__emt-tile-new-flex"> <span translate="emt.emailMoney.newemailMoney"/> <tng-help-bubble class="m-send-emt__recertify-helpBubble">{{::\'emt.emailMoney.emailMoneyBubble\' | translate}} </tng-help-bubble> </span> </div> <p class="fb2-disclaimer"> <span translate="emt.emailMoney.disclaimer"></span><br/><br/> <img ng-src="{{::\'assets/images/logo_interac_\' + $ctrl.shortHandLocale  + \'.png\'}}" class="email-money-content__interac-logo" alt="Interac"> <span translate="emt.receiveMoneyClient.interacTrademark"></span> </p> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.CHOOSE_ACCOUNT" class="m-send-emt__container-6"> <div class="c-tile c-tile--round margin-top-0 margin-bot-lg"> <tng-tile-item class="c-tile--selected-grey c-tile--md"> <div class="tile-section"> <p class="small-tile-header">{{::\'emt.emailMoney.transferType\' | translate}}</p> <h1 ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.TANGERINE_EMT)"> {{::\'emt.emailMoney.free\' | translate}}</h1> <h1 ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT)"> {{::\'emt.emailMoney.free\' | translate}}</h1> <p ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.TANGERINE_EMT)"> {{::\'emt.emailMoney.emailMoney\' | translate}}</p> <p ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT)" ng-bind-html="\'emt.emailMoney.interac\' | translate"></p> </div> </tng-tile-item> </div> <p class="small-tile-header">{{::\'emt.emailMoney.whichAccount\' | translate}}</p> <tng-tile-list class="c-tile--flex c-tile--md" on-tile-click="$ctrl.selectFromAccount(index, tileData)" all-actionable="true" tile-data="$ctrl.fromAccounts" tile-type="$ctrl.TILE_TYPE.account"> </tng-tile-list> <p ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT)" class="fb2-disclaimer"> <span translate="emt.receiveMoneyClient.interacTrademark1"></span> </p> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.WHEN" class="m-send-emt__container-6"> <tng-tile-list class="c-tile--flex c-tile--md" tile-data="$ctrl.whenTiles" tile-type="this.TILE_TYPE.text" is-actionable="true" on-tile-click="$ctrl.whenSend(index)"> </tng-tile-list> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.HOW_MUCH"> <div class="m-send-emt__review-container-6"> <div class="m-send-emt__emt-amount-input"> <form ng-submit="$ctrl.amountInputFormSubmit()"> <tng-amount-input debounce-delay="500" on-amount-change="$ctrl.onAmountChange(amount)" set-value="$ctrl.transaction.amount"> </tng-amount-input> </form> <tng-help-bubble> <span ng-bind-html="\'emt.emailMoney.amountTooltip\' | translate:{\n            minimumLimit: $ctrl.limits.minimumLimit,\n            transactionLimit: $ctrl.limits.transactionLimit,\n            dailyLimit: $ctrl.limits.dailyLimit,\n            weeklyLimit: $ctrl.limits.weeklyLimit,\n            monthlyLimit: $ctrl.limits.monthlyLimit\n            }"></span> </tng-help-bubble> </div> </div> <div ng-show="$ctrl.showAmountGreaterThanAvail"> <div class="m-send-emt__review-container-7 field__error"> {{ ::$ctrl.availableBalanceWithHold }} <tng-help-bubble> {{\'emt.emailMoney.moreThanAvailableToolTip\'| translate}} <a class="m-send-emt__tooltip-link" ng-click="$ctrl.goToHoldsPage()"> {{::\'emt.emailMoney.learnMore\'| translate}}</a> </tng-help-bubble> </div> </div> <div class="m-send-emt__container-6"> <div class="m-send-emt__amount-validation"> <p class="field__error" ng-show="$ctrl.amountMessage"> {{$ctrl.amountMessage}} </p> </div> <div class="c-tile c-tile--round"> <tng-tile-item class="c-tile--md"> <div class="tile-section"> <p class="small-tile-header">{{::\'emt.emailMoney.transferType\' | translate}}</p> <h1 ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.TANGERINE_EMT)"> {{::\'emt.emailMoney.free\' | translate}}</h1> <h1 ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT)"> {{::\'emt.emailMoney.free\' | translate}}</h1> <p ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.TANGERINE_EMT)"> {{::\'emt.emailMoney.emailMoney\' | translate}}</p> <p ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT)" ng-bind-html="\'emt.emailMoney.interac\' | translate"></p> </div> </tng-tile-item> </div> <tng-tile-list class="c-tile--flex c-tile--md" tile-data="::$ctrl.transaction.payFromAccount" tile-type="::$ctrl.TILE_TYPE.account"> </tng-tile-list> <div class="c-tile c-tile--round"> <tng-tile-item class="c-tile--md"> <div class="tile-section"> <h1 ng-if="$ctrl.transaction.WHEN_STATE === $ctrl.WHEN_SEND.NOW">{{::\'emt.emailMoney.now\' | translate}} </h1> <h1 ng-if="$ctrl.transaction.WHEN_STATE === $ctrl.WHEN_SEND.LATER"> {{ ::$ctrl.dateService.convertToFormattedMonthDayYear($ctrl.transaction.when) }}</h1> </div> <div class="tile-section align-right"> <span class="tile-section__arrow tile-section__arrow--large large icon-calendar"></span> </div> </tng-tile-item> </div> <tng-warning-message warning-title="\'emt.emailMoney.infoBoxTitle\' | translate"> {{::\'emt.emailMoney.infoBoxMessage\' | translate}} </tng-warning-message> <p ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT)" class="fb2-disclaimer"> <span translate="emt.receiveMoneyClient.interacTrademark1"></span> </p> </div> </div> <div class="send-emt__review" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW"> <div ng-if="$ctrl.submitErrors.length > 0"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.submitErrors track by $index">{{ error | translate }}</li> </ul> </tng-error-message> </div> <p class="fb2-title" ng-if="$ctrl.transaction.WHEN_STATE === $ctrl.WHEN_SEND.NOW && $ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT" ng-bind-html="\'emt.emailMoney.reviewSummaryInterac\' | translate:{\n          amount: $ctrl.transaction.amount,\n          displayName: $ctrl.getRecipientDisplayName(),\n          account: $ctrl.transaction.payFromAccount.payFromAccountNickNameNum\n        }"></p> <p class="fb2-title" ng-if="$ctrl.transaction.WHEN_STATE === $ctrl.WHEN_SEND.NOW && $ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.TANGERINE_EMT" ng-bind-html="\'emt.emailMoney.reviewSummary\' | translate:{\n          amount: $ctrl.transaction.amount,\n          displayName: $ctrl.getRecipientDisplayName(),\n          account: $ctrl.transaction.payFromAccount.payFromAccountNickNameNum\n        }"></p> <p class="fb2-title" ng-if="$ctrl.transaction.WHEN_STATE === $ctrl.WHEN_SEND.LATER" ng-bind-html="\'emt.emailMoney.reviewSummaryFuture\' | translate:{\n          amount: $ctrl.transaction.amount,\n          displayName: $ctrl.getRecipientDisplayName(),\n          account: $ctrl.transaction.payFromAccount.type,\n          date: $ctrl.dateService.convertToFormattedMonthDayYear($ctrl.transaction.when),\n        }"></p> <div class="m-send-emt__review-form"> <tng-tile-list class="c-tile--flex c-tile--md" tile-data="$ctrl.transactionTile" all-actionable="true" on-tile-click="$ctrl.goBacktoHowMuchState()" tile-type="$ctrl.TILE_TYPE.amount"> </tng-tile-list> <div class="c-tile c-tile--round"> <tng-tile-item class="c-tile--md" ng-click="$ctrl.flowService.moveTo($ctrl.flowService.STATES.TYPE_OF_TRANSFER)"> <div class="tile-section"> <p class="small-tile-header">{{::\'emt.emailMoney.transferType\' | translate}}</p> <h1 ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.TANGERINE_EMT)"> {{::\'emt.emailMoney.free\' | translate}}</h1> <h1 ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT)"> {{::\'emt.emailMoney.free\' | translate}}</h1> <p ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.TANGERINE_EMT)"> {{::\'emt.emailMoney.emailMoney\' | translate}}</p> <p ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT)" ng-bind-html="\'emt.emailMoney.interac\' | translate"></p> </div> <div class="tile-section align-right"> <span class="tile-section__arrow tile-section__arrow--large large icon-rightarrow"></span> </div> </tng-tile-item> </div> <tng-tile-list class="c-tile--flex c-tile--md" ng-if="$ctrl.fromAccounts.length > 1" on-tile-click="$ctrl.goBacktoChooseAccount()" all-actionable="true" tile-data="::$ctrl.transaction.payFromAccount" tile-type="::$ctrl.TILE_TYPE.account"> </tng-tile-list> <tng-tile-list class="c-tile--flex c-tile--md" ng-if="$ctrl.fromAccounts.length <= 1" on-tile-click="$ctrl.goBacktoChooseAccount()" tile-data="::$ctrl.transaction.payFromAccount" tile-type="::$ctrl.TILE_TYPE.account"> </tng-tile-list> <div class="c-tile c-tile--round"> <tng-tile-item class="c-tile--flex" ng-click="$ctrl.goBacktoSelectContact()"> <div class="m-send-emt__to-tile-section"> <p class="small-tile-header">{{::\'emt.emailMoney.sendTo\' | translate}}</p> <h1>{{::$ctrl.getRecipientDisplayName()}}</h1> <p>{{::$ctrl.transaction.recipient.email_address}}</p> <p class="small-tile-header margin__t--fix1" ng-if="$ctrl.transaction.autoDepositDetails.email_address != null"> {{::\'emt.emailMoney.autoDepositMessage\' | translate}}</p> </div> <div class="emt-tile-section align-right col-2"> <div class="m-send-emt__check-icon" tng-tool-tip-translate="emt.emailMoney.autoAcceptTooltip" ng-if="$ctrl.transaction.autoDepositDetails.email_address != null"> <span class="icon-check1"></span> </div> </div> </tng-tile-item> </div> <div class="c-tile c-tile--round"> <tng-tile-item class="c-tile--md" ng-click="$ctrl.moveBackToWhen()"> <div class="tile-section"> <h1 ng-if="$ctrl.transaction.WHEN_STATE === $ctrl.WHEN_SEND.NOW">{{::\'emt.emailMoney.now\' | translate}} </h1> <h1 ng-if="$ctrl.transaction.WHEN_STATE === $ctrl.WHEN_SEND.LATER"> {{ ::$ctrl.dateService.convertToFormattedMonthDayYear($ctrl.transaction.when) }}</h1> </div> <div class="tile-section align-right"> <span class="tile-section__arrow tile-section__arrow--large large icon-calendar"></span> </div> </tng-tile-item> </div> </div> <div class="m-send-emt__review-optional-message"> <div class="m-send-emt__panel m-send-emt__panel--message panel"> <div class="m-send-emt__description"> <span class="m-send-emt__title">{{::\'emt.emailMoney.messageLabel\' | translate}}</span> <textarea name="EMTEMAILMESSAGE" id="EMTEMAILMESSAGE" rows="10" tng-tool-tip-translate="emt.emailMoney.optionalMessageTooltip" maxlength="250" ng-model="$ctrl.transaction.optionalMessage" ng-change="$ctrl.validateMessage()" class="input m-send-emt__textarea" placeholder="{{\'emt.emailMoney.optionalMessage\' | translate}}">\n            </textarea> </div> <span>{{$ctrl.getCharactersLeft()}} {{\'emt.emailMoney.optionalMessageCharsLeft\' | translate}}</span> </div> </div> <p class="fb2-disclaimer" ng-if="$ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.TANGERINE_EMT"> {{::\'emt.emailMoney.reviewTerms\' | translate}} </p> <p class="fb2-disclaimer" ng-if="$ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT"></p> </div> <div class="m-send-emt__terms-conditions-component-review" ng-if="$ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT && $ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW"> <emt-terms-and-conditions term-state="$ctrl.flowService.currentState === $ctrl.flowService.STATES.ACCEPT_TERMS_AND_CONDITIONS" review-state="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW" is-type-interac="$ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT" accepted-terms-flag="$ctrl.agreementConfirmationFromServer" parent-controller="$ctrl"> </emt-terms-and-conditions> <p class="fb2-disclaimer"> <span translate="emt.receiveMoneyClient.interacTrademark1"></span> </p> </div> <div class="m-send-emt__terms-conditions-component" ng-if="$ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT && $ctrl.flowService.currentState === $ctrl.flowService.STATES.ACCEPT_TERMS_AND_CONDITIONS"> <emt-terms-and-conditions term-state="$ctrl.flowService.currentState === $ctrl.flowService.STATES.ACCEPT_TERMS_AND_CONDITIONS" review-state="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW" is-type-interac="$ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT" accepted-terms-flag="$ctrl.agreementConfirmationFromServer" parent-controller="$ctrl"> </emt-terms-and-conditions> </div> <div class="send-emt__review" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.PROCESSING"> <div class="loading--full-modal" ng-show="$ctrl.loading"> <tng-loading-in-progress></tng-loading-in-progress> </div> </div> <div id="printMe" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DONE"> <div class="m-send-emt__confirmation-title-section"> <p ng-if="$ctrl.selected.paymentSetup === $ctrl.SETUP_PAYMENT.YES && $ctrl.transaction.WHEN_STATE === $ctrl.WHEN_SEND.NOW" class="fb2-title" ng-bind-html="\'emt.emailMoney.doneInfoNow\' | translate:{\n                        firstName: $ctrl.transaction.recipient.first_name,\n                        lastName: $ctrl.transaction.recipient.last_name,\n                        recipientName: $ctrl.getRecipientDisplayName(),\n                        date: $ctrl.creationDate.toDate(),\n                        time: $ctrl.formattedCreationTime\n                      }"> </p> <p ng-if="$ctrl.selected.paymentSetup === $ctrl.SETUP_PAYMENT.YES && $ctrl.transaction.WHEN_STATE === $ctrl.WHEN_SEND.LATER" class="fb2-title" ng-bind-html="\'emt.emailMoney.doneInfoLater\' | translate:{\n                        firstName: $ctrl.transaction.recipient.first_name,\n                        lastName: $ctrl.transaction.recipient.last_name,\n                        recipientName: $ctrl.getRecipientDisplayName(),\n                        date: $ctrl.dateService.convertToFormattedMonthDayYear($ctrl.transaction.when),\n                      }"> </p> </div> <div class="c-balance-grid"> <div class="c-balance-grid-inside-emt__table-column-top ignore-modal-padding--mobile"> <span class="c-balance-grid-inside-emt__table-column-top-left"> {{::\'emt.emailMoney.confirmationNumber\' | translate}} <span class="heading--sub4">{{::$ctrl.confirmation.confirmation_code}}</span> </span> </div> <div class="c-balance-grid-inside-emt__table ignore-modal-padding--mobile m-send-emt__confirmation-height"> <div class="c-balance-grid-inside-emt__table-column"> <div class="c-balance-grid-inside-emt__section"> <p class="c-balance-grid-inside-emt__title"> <strong>{{::\'emt.emailMoney.transferAmount\' | translate}}</strong> </p> <p class="c-balance-grid-inside-emt__value"> {{ ::$ctrl.transaction.amount | currency}} </p> </div> </div> <div class="c-balance-grid-inside-emt__table-column c-balance-grid-inside-emt__table-column--has-borders no-bottom-border"> <div class="c-balance-grid-inside-emt__section"> <p class="c-balance-grid-inside-emt__title" ng-if="$ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.TANGERINE_EMT"> {{::\'emt.emailMoney.fees\' | translate}} </p> <p class="c-balance-grid-inside-emt__title" ng-if="$ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT" ng-bind-html="\'emt.emailMoney.feesInterac\' | translate"> </p> <p class="c-balance-grid-inside-emt__value"> <span ng-if="$ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.TANGERINE_EMT"> {{::\'emt.emailMoney.free\' | translate}} </span> <span ng-if="$ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT"> {{::\'emt.emailMoney.free\' | translate}} </span> </p> </div> </div> <div class="c-balance-grid-inside-emt__table-column"> <div class="c-balance-grid-inside-emt__section"> <p class="c-balance-grid-inside-emt__title"> {{::\'emt.emailMoney.newBalance\' | translate}} <br><strong>{{::$ctrl.transaction.payFromAccount.payFromAccountNickName}} {{::$ctrl.transaction.payFromAccount.display_name | maskNumber}}</strong> </p> <p class="c-balance-grid-inside-emt__value" ng-if="($ctrl.transaction.WHEN_STATE === $ctrl.WHEN_SEND.NOW) &&\n                        ($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.TANGERINE_EMT)"> {{ ::($ctrl.transaction.payFromAccount.available_balance - $ctrl.transaction.amount) | currency }} </p> <p class="c-balance-grid-inside-emt__value" ng-if="($ctrl.transaction.WHEN_STATE === $ctrl.WHEN_SEND.NOW) &&\n                        ($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT)"> {{ ::($ctrl.transaction.payFromAccount.available_balance - $ctrl.transaction.amount) | currency }} </p> <p class="c-balance-grid-inside-emt__value" ng-if="$ctrl.transaction.WHEN_STATE === $ctrl.WHEN_SEND.LATER"> {{ ::($ctrl.transaction.payFromAccount.available_balance) | currency }} </p> </div> </div> </div> </div> <div class="m-send-emt__confirmation-transfer-section"> <p class="margin__tb--fix2"> <span>{{::\'emt.emailMoney.youCanView\'|translate}}</span> <a actionable-id="send-emt-transaction_page" href="" ng-click="$ctrl.goToTransactionPage()" class="body--callout pointer">{{::\'emt.emailMoney.transactionPage\'|translate}}</a>. </p> </div> <div class="print-hide"> <span ng-if="$ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.TANGERINE_EMT"> {{ ::\'emt.emailMoney.reviewTerms\' | translate}} </span> </div> <tng-print-button button-class="btn btn--orange c-close-account-modal__print" only-element="\'printMe\'"> {{ ::\'global.print\' | translate}} </tng-print-button> <p ng-if="::($ctrl.transaction.TRANSFER_TYPE_STATE === $ctrl.TRANSFER_TYPE.INTERAC_EMT)" class="fb2-disclaimer"> <span translate="emt.receiveMoneyClient.interacTrademark1"></span> </p> </div> <div id="send-emt-contactForm" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS || $ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS_EMT_FLOW"> <tng-error-message ng-if="$ctrl.submitErrors.length > 0"> <ul> <li ng-repeat="error in $ctrl.submitErrors track by $index" ng-bind-html="error | translate"></li> </ul> </tng-error-message> <tng-warning-message ng-if="$ctrl.warnings.length > 0"> <ul> <li ng-repeat="warning in $ctrl.warnings  track by $index" ng-bind-html="warning | translate"></li> </ul> </tng-warning-message> <div class="m-send-emt__container-6"> <form name="$ctrl.contactForm" ng-submit="$ctrl.contactFormSubmit()"> <p ng-if="$ctrl.isSelectingJointContact"> <span ng-if="$ctrl.FORM_TYPE.EDIT === $ctrl.formType"> {{ ::\'emt.jointAccount.description.edit\' | translate }} </span> <span ng-if="$ctrl.FORM_TYPE.NEW === $ctrl.formType"> {{ ::\'emt.jointAccount.description.add\' | translate}} </span> </p> <div class="field__group"> <div class="field"> <label id="EmailRecipientFirstName_label" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS || $ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS_EMT_FLOW" for="EmailRecipientFirstName">{{ ::\'emt.emailMoney.name\' | translate }}</label> <input class="input" ng-class="{\'warning\':\n                      ($ctrl.contactForm.EmailRecipientFirstName.$invalid &&\n                      $ctrl.contactForm.EmailRecipientFirstName.$dirty)\n                     }" id="EmailRecipientFirstName" name="EmailRecipientFirstName" type="text" ng-disabled="$ctrl.recipient.auto_accept || (!$ctrl.allowNameEdit && $ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS_EMT_FLOW)" required autofocus maxlength="32" ng-model="$ctrl.recipient.first_name" ng-change="$ctrl.onNameChange($ctrl.recipient)" placeholder="{{ \'emt.emailMoney.firstName\' | translate }}" validation-order="1" autocomplete="nope"/> <div ng-messages="$ctrl.contactForm.EmailRecipientFirstName.$error" ng-show="$ctrl.contactForm.EmailRecipientFirstName.$dirty" class="field__error"> <p ng-message="required"> {{ ::\'emt.validation.isRequired\' | translate}} </p> </div> </div> <div class="field"> <label id="EmailRecipientLastName_label">&nbsp;</label> <input class="input" ng-class="{\'warning\':\n                      ($ctrl.contactForm.EmailRecipientLastName.$invalid &&\n                      $ctrl.contactForm.EmailRecipientLastName.$dirty)\n                     }" id="EmailRecipientLastName" name="EmailRecipientLastName" type="text" ng-disabled="$ctrl.recipient.auto_accept  || (!$ctrl.allowNameEdit && $ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS_EMT_FLOW)" required maxlength="32" ng-model="$ctrl.recipient.last_name" ng-change="$ctrl.onNameChange($ctrl.recipient)" placeholder="{{\'emt.emailMoney.lastName\' | translate}}" validation-order="2" autocomplete="nope"/> <div ng-messages="$ctrl.contactForm.EmailRecipientLastName.$error" ng-show="$ctrl.contactForm.EmailRecipientLastName.$dirty" class="field__error"> <p ng-message="required"> {{ ::\'emt.validation.isRequired\' | translate}} </p> <p ng-message="maxlength"> {{ ::\'emt.validation.tooLong\' | translate}} </p> </div> </div> </div> <div class="field__group margin__t--fix2"> <div class="field"> <label id="EmailRecipientEmailAddress_label" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS || $ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS_EMT_FLOW " for="EmailRecipientEmailAddress">{{ ::\'emt.emailMoney.email\' | translate }}</label> <input class="input" ng-class="{\'warning\':\n                        ($ctrl.contactForm.EmailRecipientEmailAddress.$invalid &&\n                        $ctrl.contactForm.EmailRecipientEmailAddress.$dirty ||\n                        $ctrl.emailAlreadyOnTheList)\n                     }" id="EmailRecipientEmailAddress" name="EmailRecipientEmailAddress" type="email" ng-disabled="$ctrl.recipient.auto_accept || $ctrl.warnings.length > 0" required maxlength="60" ng-change="$ctrl.checkIsEmailAllowed()" ng-model="$ctrl.recipient.email_address" placeholder="{{ $ctrl.getAttributeValue(\'emailHolder\') }}" validation-order="3" autocomplete="nope"/> <div ng-messages="$ctrl.contactForm.EmailRecipientEmailAddress.$error" ng-show="$ctrl.contactForm.EmailRecipientEmailAddress.$dirty ||\n                    $ctrl.emailAlreadyOnTheList" class="field__error"> <p ng-message="required"> {{ ::\'emt.validation.isRequired\' | translate }} </p> <p ng-message="email"> {{ ::\'emt.validation.wrongEmailFormat\' | translate }} </p> <p ng-message="maxlength"> {{ ::\'emt.validation.tooLong\' | translate}} </p> <p ng-show="$ctrl.emailAlreadyOnTheList"> {{ ::\'emt.validation.emailAlreadyOnList\' | translate }} </p> </div> </div> </div> <div class="field__group margin__t--fix2" ng-if="$ctrl.isSelectingJointContact"> <div class="field"> <label id="EMTEMAILQUESTION_label" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS || $ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS_EMT_FLOW " for="EMTEMAILQUESTION"> {{ :: $ctrl.isSelectingJointContact ? \'emt.jointAccount.questionHeader\' : \'emt.emailMoney.secretQuestion\' | translate}} <tng-help-bubble ng-if="!$ctrl.isSelectingJointContact" class="m-send-emt__tooltip"> {{ ::\'emt.emailMoney.secretQuestionTooltip\' | translate}} </tng-help-bubble> <tng-help-bubble ng-if="$ctrl.isSelectingJointContact" class="m-send-emt__tooltip"> {{ ::\'emt.emailMoney.joint.secretQuestionTooltip\' | translate}} </tng-help-bubble> </label> <input class="input CB_DoNotShow" ng-class="{\'warning\':\t\n                          ($ctrl.contactForm.EMTEMAILQUESTION.$invalid &&\t\n                          $ctrl.contactForm.EMTEMAILQUESTION.$dirty)\t\n                       }" id="EMTEMAILQUESTION" name="EMTEMAILQUESTION" type="text" maxlength="40" minlength="1" required ng-change="$ctrl.checkQuestion()" ng-pattern="$ctrl.questionPattern" ng-model="$ctrl.recipient.email_question" placeholder="{{ $ctrl.getAttributeValue(\'questionHolder\') }}" validation-order="4"/> <div ng-messages="$ctrl.contactForm.EMTEMAILQUESTION.$error" ng-show="$ctrl.contactForm.EMTEMAILQUESTION.$dirty" class="field__error"> <p ng-message="required"> {{ ::\'emt.validation.isRequired\' | translate}} </p> <p ng-message="minlength"> {{ ::\'emt.validation.tooShort\' | translate}} </p> <p ng-message="pattern"> {{ ::\'global.errorCodes.EMT_INVALID_QUESTION\' | translate}} </p> </div> </div> </div> <div class="field__group margin__t--fix2" ng-if="$ctrl.isSelectingJointContact"> <div class="field"> <label id="emailAnswer_EMT_label" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS || $ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS_EMT_FLOW" for="emailAnswer_EMT"> {{ :: $ctrl.isSelectingJointContact ? \'emt.jointAccount.answerHeader\' : \'emt.emailMoney.secretAnswer\' | translate}} <tng-help-bubble ng-if="!$ctrl.isSelectingJointContact" class="m-send-emt__tooltip"> {{ ::\'emt.emailMoney.secretAnswerTooltip\' | translate}} </tng-help-bubble> <tng-help-bubble ng-if="$ctrl.isSelectingJointContact" class="m-send-emt__tooltip"> {{ ::\'emt.emailMoney.joint.secretAnswerTooltip\' | translate}} </tng-help-bubble> </label> <input class="input CB_DoNotShow" ng-class="{\'warning\': $ctrl.showWarningMessage()}" actionable-id="emailAnswer_EMT" name="emailAnswer_EMT" type="text" ng-required="($ctrl.FORM_TYPE.NEW === $ctrl.formType || $ctrl.FORM_TYPE.EDIT === $ctrl.formType)" ng-change="$ctrl.checkAnswer(); $ctrl.checkAnswerReentered()" ng-click="$ctrl.onAnswerInput()" ng-focus="$ctrl.onAnswerInput()" ng-blur="$ctrl.emailQuestionBlur()" maxlength="30" minlength="3" ng-pattern="$ctrl.answerPattern" ng-model="$ctrl.recipient.email_answer" placeholder="{{\'emt.emailMoney.answer\' | translate}}" validation-order="5"/> <div ng-messages="$ctrl.contactForm.emailAnswer_EMT.$error" ng-show="$ctrl.contactForm.emailAnswer_EMT.$dirty" class="field__error"> <p ng-message="minlength"> {{ ::\'emt.validation.tooShort\' | translate}} </p> <p ng-message="required"> {{ ::\'emt.validation.isRequired\' | translate}} </p> <p ng-message="pattern"> {{ ::\'emt.validation.onlyNumbersAndLetters\' | translate}} </p> <p ng-if="$ctrl.showAnswerValidationError"> {{ ::\'emt.validation.questionAndAnswerAreTheSame\' | translate}} </p> </div> </div> </div> <div class="field__group--inline margin__t--fix2"> <div class="field m-send-emt__answer-label"> <label for="EmailRecipientLanguageEn">{{ ::\'emt.emailMoney.preferredLanguage\' | translate}}</label> </div> <div class="field"> <div class="m-send-emt__language-radio-button"> <input id="EmailRecipientLanguageEn" name="radio" value="en" required ng-disabled="$ctrl.recipient.auto_accept" ng-model="$ctrl.recipient.email_language" class="input input--tangerine-radio" type="radio"/> <label for="EmailRecipientLanguageEn">{{ ::\'emt.emailMoney.english\' | translate}}</label> </div> <div class="m-send-emt__language-radio-button"> <input id="EmailRecipientLanguageFr" name="radio" ng-disabled="$ctrl.recipient.auto_accept" value="fr" ng-model="$ctrl.recipient.email_language" class="input input--tangerine-radio" type="radio"/> <label for="EmailRecipientLanguageFr">{{ ::\'emt.emailMoney.french\' | translate}}</label> </div> </div> </div> </form> <button class="btn--warn m-send-emt__delete-button" ng-class="{\'btn--large\': !$ctrl.isSelectingJointContact, \'btn--fluid\': $ctrl.isSelectingJointContact}" actionable-id="BUTTON_Go" type="button" aria-label="{{\'emt.emailMoney.deleteContact\' | translate}}" ng-if="$ctrl.FORM_TYPE.EDIT === $ctrl.formType" ng-click="$ctrl.deleteContact()"> {{ ::($ctrl.isSelectingJointContact ? \'emt.jointAccount.removeCoapplicant\' : \'emt.emailMoney.deleteContact\') | translate }} </button> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DELETE_CONTACT" id="delete-emt-contact"> <div class="margin__b--fix1" ng-if="$ctrl.deleteContactError.length > 1"> <tng-error-message> <ul> <li ng-bind-html="$ctrl.deleteContactError"></li> </ul> </tng-error-message> </div> <div class="margin__b--fix1" ng-if="$ctrl.warnings.length"> <tng-warning-message ng-if="$ctrl.warnings.length > 0"> <ul> <li ng-repeat="warning in $ctrl.warnings  track by $index" ng-bind-html="warning | translate"></li> </ul> </tng-warning-message> </div> <div class="m-send-emt__container-6"> <p>{{ ::\'emt.emailMoney.contactWillBeDeleted\' | translate}}</p> <div class="m-send-emt__panel panel margin__t--fix1"> <div class="m-send-emt__description"> <span class="m-send-emt__title">{{ ::\'emt.emailMoney.contact\' | translate}} <span ng-if="$ctrl.recipient.email_language === \'fr\'">{{ ::\'emt.emailMoney.french\' | translate}}</span> <span ng-if="$ctrl.recipient.email_language === \'en\'">{{ ::\'emt.emailMoney.english\' | translate}}</span> </span> <p class="m-send-emt__name"> <strong>{{$ctrl.recipient.first_name}} {{$ctrl.recipient.last_name}}</strong> </p> <span class="m-send-emt__title"> {{$ctrl.recipient.email_address}} </span> </div> </div> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.CONTACT_DELETED"> <p>{{ ::\'emt.emailMoney.contactHasBeenDeleted\' | translate}}</p> <div class="m-send-emt__panel panel margin__t--fix1"> <div class="m-send-emt__description"> <span class="m-send-emt__title">{{ ::\'emt.emailMoney.contact\' | translate}}</span> <p class="m-send-emt__name"> <strong>{{$ctrl.recipient.first_name}} {{$ctrl.recipient.last_name}}</strong> </p> <span class="m-send-emt__title"> {{$ctrl.recipient.email_address}} </span> </div> </div> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DATE"> <tng-date-selector ng-if="$ctrl.selected.paymentType === $ctrl.PAYMENT_TYPE.MANUAL" min-date="$ctrl.tomorrow" selection-mode="$ctrl.dateConstants.DATE_SELECTOR_MODES.SINGLE" selected-date="$ctrl.transaction.when" max-date="$ctrl.nextYear" on-date-change="$ctrl.logDateChangeSingle()" hide-selection-mode-selector="true"> </tng-date-selector> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.PROCESSING"> <div class="loading--full-modal"> <tng-loading-in-progress is-loading-key="global.pageFlow.loading.isLoading"></tng-loading-in-progress> </div> </div> </div> <footer ng-hide="$ctrl.flowService.showConfirmExitUI"> <button class="btn btn--edit" actionable-id="{{$ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_GRY.type.label)}}" watch-actionable-id="true" ng-show="$ctrl.flowService.BUTTONS.BTN_GRY.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_GRY.disable" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_GRY)"> {{ $ctrl.flowService.BUTTONS.BTN_GRY.type.label | translate }} </button> <button class="btn btn--orange" actionable-id="{{$ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_ORG.type.label)}}" watch-actionable-id="true" ng-class="{\'CB_ReadOnly\': $ctrl.flowService.CB_DISABLED_BUTTONS.includes($ctrl.flowService.BUTTONS.BTN_ORG.type)}" ng-if="($ctrl.flowService.currentState !== $ctrl.flowService.STATES.EDIT_ADDRESS && $ctrl.flowService.currentState !== $ctrl.flowService.STATES.EDIT_ADDRESS_EMT_FLOW) && $ctrl.flowService.BUTTONS.BTN_ORG.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_ORG.disable" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_ORG)"> {{ $ctrl.flowService.BUTTONS.BTN_ORG.type.label | translate }} </button> <button class="btn btn--orange" actionable-id="{{ $ctrl.FORM_TYPE.EDIT === $ctrl.formType ?\n        $ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_ORG.type.label) :\n        $ctrl.flowService.currentFlow.getButtonId(\'global.components.buttons.add\')\n        }}" watch-actionable-id="true" ng-class="{\'CB_ReadOnly\': $ctrl.flowService.CB_DISABLED_BUTTONS.includes($ctrl.flowService.BUTTONS.BTN_ORG.type)}" ng-if="($ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS || $ctrl.flowService.currentState === $ctrl.flowService.STATES.EDIT_ADDRESS_EMT_FLOW) && $ctrl.flowService.BUTTONS.BTN_ORG.show" ng-disabled="!$ctrl.isSelectingJointContact && $ctrl.isContactFormInvalid" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_ORG)"> <span ng-if="$ctrl.FORM_TYPE.EDIT === $ctrl.formType"> {{ $ctrl.flowService.BUTTONS.BTN_ORG.type.label | translate }} </span> <span ng-if="$ctrl.FORM_TYPE.NEW === $ctrl.formType"> {{ ::\'global.components.buttons.add\' | translate }} </span> </button> <button class="btn btn--warn" actionable-id="emt_warnButton" ng-show="$ctrl.flowService.BUTTONS.BTN_RED.show" ng-click="$ctrl.onButtonClick($ctrl.flowService.BUTTONS.BTN_RED)"> {{ $ctrl.flowService.BUTTONS.BTN_RED.type.label | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(269)),a=u(n(68)),s=u(n(104)),r=u(n(0)),o=u(n(2)),c=u(n(45)),l=n(67);function u(t){return t&&t.__esModule?t:{default:t}}var d="EMT_INVALID_QUESTION_LENGTH",h="EMT_DUPLICATE_RECIPIENT",f="EMT_PENDING_EMTS_FOUND_WHILE_EDIT",p="EMT_PENDING_EMTS_FOUND",g=function(){function t(e,n,i,a,s,o,u,d,h,f,p,g,m,_,v,S,T,y,E,A,b,C,$,N,O,I,w,P,M,R,D,L,k){(0,r.default)(this,t),this.$q=n,this.flowService=i,this.emtService=s,this.$scope=u,this.$filter=_,this.$timeout=v,this.TimerService=C,this.BackButtonService=O,this.backButtonConstants=I,this.$translate=f,this.LocaleService=g,this.localeConstants=S,this.accountDetailsService=m,this.shortHandLocale=S.SHORTHAND_LOCALE[this.LocaleService.locale],this.$location=T,this.$anchorScroll=y,this.cifTypeService=E,this.customersService=A,this.dateService=$,this.buildConstants=N,this.AnchorService=w,this.StorageService=R,this.FeedbackSurveyService=L,this.$log=e,this.$state=a,this.emtConstants=o,this.TILE_TYPE=d.TILE_TYPE,this.FORM_TYPE=this.emtConstants.FORM_TYPE,this.TRANSFER_TYPE=this.emtConstants.TRANSFER_TYPE,this.WHEN_TILES=this.emtConstants.WHEN_TILES,this.WHEN_SEND=this.emtConstants.WHEN_SEND,this.EMT_VALIDATION_LIMIT=this.emtConstants.EMT_VALIDATION_LIMIT,this.dateConstants=h,this.stateConstants=p,this.serviceConstants=P,this.storageConstants=M,this.FeedbackSurveyConstants=D,this.EnvironmentService=k,this.localeValue=this.LocaleService.localeDisplay.toLowerCase(),this.recipients=[],this.recentContacts=[],this.formType=this.FORM_TYPE.NEW,this.loading=!1,this.contactForm={},this.submitErrors=[],this.warnings=[],this.allowNameEdit=!0,this.transaction={TRANSFER_TYPE_STATE:this.TRANSFER_TYPE.TANGERINE_EMT,WHEN_STATE:this.WHEN_SEND.NOW,when:(0,c.default)(),payFromAccount:{},recipient:{},amount:0,optionalMessage:"",autoDepositDetails:{}},this._initialTransactionObj=angular.copy(this.transaction),this.questionPattern=l.emtQuestionPattern,this.answerPattern=l.emtAnswerPattern,this.answerReenterPattern=l.emtAnswerReenterPattern,this.accountHelpersService=b}return(0,o.default)(t,[{key:"$onInit",value:function(){var t=this;this.flowService.isSelectingJointContact=this.isSelectingJointContact,this.EnvironmentService.isIOS()||this.initSurveyInFlowService(),this.originalRecipient={},this.recipient={},this.flowService.activate(),this._setState(),this._checkEmailAnswer(),this._getEmtRecipients(),this.isSelectingJointContact||(this._getLimits(),this._getEmailTransferAccounts(),this._getCustomerConsents()),this._watchFormChange(),this.accordionRows=[{header:"emt.emailMoney.generalTermsHeader",body:"emt.emailMoney.generalTermsBody"},{header:"emt.emailMoney.termsApplyHeader",body:"emt.emailMoney.termsApplyBody"},{header:"emt.emailMoney.termsOfUseHeader",body:"emt.emailMoney.termsOfUseBody"},{header:"emt.emailMoney.agencyHeader",body:"emt.emailMoney.agencyBody"}],this.whenTiles=[this.WHEN_TILES.NOW,this.WHEN_TILES.LATER],this.showAnswerValidationError=!1,this.showAnswerReenteredValidationError=!1,this.confirmation={},this.today=this.dateConstants.TODAY_IN_EST.clone(),this.tomorrow=(0,c.default)().add(1,"days"),this.nextYear=(0,c.default)().add(1,"y"),this.deleteContactError="",this.goToStep&&(this.flowService.currentState=this.goToStep),this.duplicateContactOnTheList=!1,this.showAmountGreaterThanAvail=!1,this.toolTipDescription=this.$translate.instant("emt.emailMoney.moreThanAvailableToolTip"),this._setupNativeBackButton(),this.flowService.postMoveTo=function(){return t._postMoveTo()},this._postMoveTo()}},{key:"_setupNativeBackButton",value:function(){var t=this;this.BackButtonService.addBackButtonListener(this.$scope,this.backButtonConstants.PRIORITY.HIGH,(function(){return t._handleNativeBackButtonClick()}))}},{key:"_handleNativeBackButtonClick",value:function(){return this.flowService.BUTTONS.BTN_GRY.show&&this.onButtonClick(this.flowService.BUTTONS.BTN_GRY),!0}},{key:"_postMoveTo",value:function(){this.isSelectingJointContact&&this.flowService.hideWarningOnExit()}},{key:"$postLink",value:function(){this.loading=!0}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"_setState",value:function(){if(this.goToStep){var t=this.settingsRecipient||{};switch(this.goToStep){case this.flowService.STATES.EDIT_ADDRESS:t.sequence_number?this.editContact(this.settingsRecipient):this.addContact()}}}},{key:"goToTransactionPage",value:function(){this.onClose(),this.$state.go(this.stateConstants.TRANSACTIONS)}},{key:"_close",value:function(){var t=this;if(this.flowService.currentState===this.flowService.STATES.SEARCH||this.flowService.currentState===this.flowService.STATES.DELETE_CONTACT||this.flowService.currentState===this.flowService.STATES.TYPE_OF_TRANSFER||this.flowService.currentState===this.flowService.STATES.EDIT_ADDRESS&&angular.equals(this.recipient,this.originalRecipient)){var e=angular.equals(this._initialTransactionObj,this.transaction);if((this.flowService.currentState!==this.flowService.STATES.SEARCH||e)&&e)return void this.onClose();this.flowService.showWarning()}else this.flowService.currentState===this.flowService.STATES.DONE&&this.flowService.hideWarning();this.flowService.showConfirmExitUI?this.flowService.denyExit():this.flowService.warn().then((function(){t.onClose({payload:{isCancelled:!0}}),t.flowService.returnToStart()}))}},{key:"onModalClose",value:function(){this._close()}},{key:"initSurveyInFlowService",value:function(){var t=this;return this.StorageService.getItem(this.storageConstants.KEYS.SURVEY_EMT).then((function(e){e||(t.flowService.setStorageConstant(t.storageConstants.KEYS.SURVEY_EMT),t.flowService.setStorageService(t.StorageService),t.flowService.setFeedbackSurveyIDs(t.FeedbackSurveyConstants.MEDALLIA_FORM_IDS.EMT_ABANDON_FEEDBACK),t.flowService.setSurveyService(t.FeedbackSurveyService))}))}},{key:"onButtonClick",value:function(t){var e=this,n=this.$log,i=this.flowService;switch(n.debug("ACTION: "+t.type.label),this.flowService.holdLink=!1,t.type){case i.BUTTON_TYPES.BACK:if(this.submitErrors=[],this.warnings=[],this.transaction.payFromAccount&&this.transaction.payFromAccount.tileDescription&&(this.transaction.payFromAccount.tileDescription=""),this.isTransactionEdit||("NEW"===this.formType||"EDIT"===this.formType)&&this.transferContactEdit)return this.flowService.hideWarning(),void this.onClose();i.gotoPreviousState();break;case i.BUTTON_TYPES.SKIP:i.gotoNextState();break;case i.BUTTON_TYPES.CANCEL:i.currentState===i.STATES.DELETE_CONTACT?i.gotoPreviousState():this._close();break;case i.BUTTON_TYPES.DELETE:return void this._deleteContact();case i.BUTTON_TYPES.NEXT:i.currentState===i.STATES.SEARCH?this._validateRecipientInformation():i.currentState===i.STATES.HOW_MUCH?(this.showAmountGreaterThanAvail=!1,this.loading=!0,this.emtService.sendMoneyEmailTransfer(this.transaction,!0).then((function(t){if(e.loading=!1,e.transaction.amount>e.limits.transactionLimit)e.amountMessage=e.$translate.instant("emt.validation.tooMuch",{value:e.limits.transactionLimit});else if(t.response_status.status_code===e.serviceConstants.STATUS_CODES.AVLBALHLD){e.flowService.holdLink=!0,e.showAmountGreaterThanAvail=!0;var a=e.$filter("tngCurrency")(e.transaction.payFromAccount.external_available_balance||0);e.availableBalanceWithHold=e.$translate.instant("emt.emailMoney.moreThanAvailableHold",{availableAmount:a})}else-1===["CREATED","SUCCESS"].indexOf(t.response_status.status_code)?(n.error("EMT API VALIDATION ERROR: ",t.response_status),e.amountMessage=e.$translate.instant("global.errorCodes."+t.response_status.return_code)):(e.amountMessage=null,e.flowService.holdLink=!1,e.showAmountGreaterThanAvail=!1);t.autodeposit_details&&(e.transaction.autoDepositDetails.email_address=t.autodeposit_details.email_address,e.transaction.autoDepositDetails.registration_name=t.autodeposit_details.registration_name,e.transaction.autoDepositDetails.contact_name=t.autodeposit_details.contact_name),e.transaction.optionalMessage=e.tempOptionalMessage,null===e.amountMessage&&!1===e.showAmountGreaterThanAvail&&i.gotoNextState()})).catch((function(t){e.loading=!1,n.error(t)}))):i.gotoNextState();break;case i.BUTTON_TYPES.SAVE:this._saveOrAddRecipient();break;case i.BUTTON_TYPES.CONTINUE:this._saveRecipientAndContinue();break;case i.BUTTON_TYPES.CONFIRM:i.BUTTONS.BTN_ORG.disable=!0,i.gotoNextState();break;case i.BUTTON_TYPES.REVIEW:i.gotoNextState();break;case i.BUTTON_TYPES.DONE:this.onClose();break;case i.BUTTON_TYPES.SEND:this._sendMoney();break;case i.BUTTON_TYPES.ACCEPT:this._acceptInteracTermsAndConditions();break;case i.BUTTON_TYPES.ADD:break;default:n.debug("default - NO ACTION")}}},{key:"setSelectedRecipient",value:function(t,e){this.submitErrors=[];var n=this.flowService;this.selectedRecipientKey=t,this.selectedRecentRecipientKey=null,this.transaction.recipient=e,n.BUTTONS.BTN_ORG.disable=!e}},{key:"_validateRecipientInformation",value:function(){this.submitErrors=[],this.warnings=[];var t=this.flowService;this.transaction.recipient?(this._validateDuplicateContact(this.transaction.recipient),this.scrollToTop(),!!this.warnings&&this.warnings.length>0?this.editContact(this.transaction.recipient,t.STATES.EDIT_ADDRESS_EMT_FLOW):t.gotoNextState()):t.gotoNextState()}},{key:"_validateRecipientQuestion",value:function(t){t.email_question&&t.email_question.length>this.EMT_VALIDATION_LIMIT.EMAIL_QUESTION_INTERAC_LENGTH_LIMIT&&this.warnings.push("global.errorCodes."+d)}},{key:"_validateDuplicateContact",value:function(t){var e=this;(this.duplicateContactOnTheList=!1,this.allowNameEdit=!1,!this.recipientsCopy||this.recipientsCopy.length<=0)?this.emtService.getEmtRecipients().then((function(n){e.recipients=n.recipient,e.recipientsCopy=angular.copy(e.recipients),e.duplicateContactOnTheList=e.recipientsCopy.some((function(e){return t.first_name.toLowerCase()===e.first_name.toLowerCase()&&t.last_name.toLowerCase()===e.last_name.toLowerCase()&&t.sequence_number!==e.sequence_number}))})).catch((function(t){e.$log.error("error fetching EMT recipients:",t)})):this.duplicateContactOnTheList=this.recipientsCopy.some((function(e){return t.first_name.toLowerCase()===e.first_name.toLowerCase()&&t.last_name.toLowerCase()===e.last_name.toLowerCase()&&t.sequence_number!==e.sequence_number}));!0===this.duplicateContactOnTheList&&(this.allowNameEdit=!0,this.warnings.push("global.errorCodes."+h))}},{key:"setSelectedRecentRecipient",value:function(t,e){var n=this.flowService;this.selectedRecipientKey=null,this.selectedRecentRecipientKey=t,this.transaction.recipient=e,n.BUTTONS.BTN_ORG.disable=!e}},{key:"_getEmtRecipients",value:function(){var t=this,e=this.emtService,n=this.$log;e.getEmtRecipients().then((function(e){t.recipients=e.recipient,t.recentContacts=e.recipient.filter((function(t){return"last_email_date"in t})),t.loading=!1})).catch((function(e){t.loading=!1,n.error("error fetching EMT recipients:",e),t._showSubmitErrors(e)}))}},{key:"_saveRecipientAndContinue",value:function(){var t=this;if(this.loading=!0,this.submitErrors=[],this.warnings=[],this._validateDuplicateContact(this.recipient),this.warnings&&this.warnings.length>0)return this.loading=!1,this.scrollToTop(),this.recipient;var e=this.flowService,n=this.emtService,i=this.$log;e.moveTo(e.STATES.PROCESSING);var a=void 0;return this.FORM_TYPE.EDIT===this.formType&&(a=n.editContact(this.recipient,this.isSelectingJointContact)),a.then((function(n){return t.loading=!1,-1===["CREATED","SUCCESS"].indexOf(n.response_status.status_code)?(i.error("Wrong response code:",n),t.$q.reject(n)):-1!==["EMT_PENDING_EMTS_FOUND_WHILE_EDIT"].indexOf(n.response_status.status_code)?(i.error("EMT is in-flight:",n),t._showSubmitErrors(n),t.$q.reject(n)):(t.transaction.recipient=t.recipient,e.moveTo(t.flowService.STATES.TYPE_OF_TRANSFER),t._getEmtRecipients(),t.recipient)})).catch((function(e){t.loading=!1,t.flowService.gotoPreviousState(),f===e.response_status.status_code?t.submitErrors.push(t.$translate.instant("emt.validation."+e.response_status.return_code)):(t._showSubmitErrors(e),i.error("error saving EMT recipients:",e))}))}},{key:"_saveOrAddRecipient",value:function(){var t=this;if(this.isSelectingJointContact&&(!(0,l.genericFormValidator)({form:this.contactForm,anchorService:this.AnchorService})||this.isContactFormInvalid))return null;if(this.warnings=[],this._validateDuplicateContact(this.recipient),this.warnings&&this.warnings.length>0)return this.recipient;this.loading=!0,this.submitErrors=[];var e=this.flowService,n=this.emtService,i=this.$log;e.moveTo(e.STATES.PROCESSING);return(this.FORM_TYPE.EDIT===this.formType?n.editContact(this.recipient,this.isSelectingJointContact):n.addContact(this.recipient,this.isSelectingJointContact)).then((function(n){return t.loading=!1,-1===["CREATED","SUCCESS"].indexOf(n.response_status.status_code)?(i.error("Wrong response code:",n),t.$q.reject(n)):-1!==["EMT_PENDING_EMTS_FOUND_WHILE_EDIT"].indexOf(n.response_status.status_code)?(i.error("EMT is in-flight:",n),t._showSubmitErrors(n),t.$q.reject(n)):(t.FORM_TYPE.NEW===t.formType?(t.recipient.sequence_number=n.sequence_number,t.recipients.push(t.recipient)):t._getEmtRecipients(),t.transferContactEdit?t.onClose({payload:{model:t.recipient}}):e.moveTo(e.STATES.SEARCH),t.resetSearch())})).catch((function(e){t.loading=!1,t.flowService.gotoPreviousState(),f===e.response_status.status_code?t.submitErrors.push(t.$translate.instant("emt.validation."+e.response_status.return_code)):(t._showSubmitErrors(e),i.error("error saving EMT recipients:",e))}))}},{key:"_completeRecipientData",value:function(){if(this.settingsRecipient&&!this.flowService.addNewRecipient)this.recipient=this.settingsRecipient;else{var t=this.$log;if(this.recipient={},t.debug("Search term is: ",this.searchTerm),/\S+@\S+/i.test(this.searchTerm)&&(t.debug("Search term contains @: "),this.recipient.email_address=this.searchTerm.trim()),/\s/i.test(this.searchTerm)){t.debug("Search term contains space: ");var e=this.searchTerm.trim().split(" "),n=(0,s.default)(e,2);this.recipient.first_name=n[0],this.recipient.last_name=n[1]}}this.recipient.email_language=this.localeConstants.SHORTHAND_LOCALE[this.localeConstants.LOCALES.EN_CA],this.formType=this.FORM_TYPE.NEW}},{key:"checkContact",value:function(){var t=this.flowService;t.addNewRecipient=0===this.$filter("filter")(this.recipients,this.searchTerm).length,t.addNewRecipient&&(this._completeRecipientData(),t.BUTTONS.BTN_ORG.disable=!1),t.addNewRecipient||void 0!==this.selectedRecentRecipientKey||(t.BUTTONS.BTN_ORG.disable=!0)}},{key:"addContact",value:function(){var t=this.flowService;this._completeRecipientData(),t.addNewRecipient=!0,t.gotoNextState()}},{key:"editContact",value:function(t,e){var n=this.flowService;this.originalRecipient=angular.copy(t),this.recipient=angular.copy(t),this.formType=this.FORM_TYPE.EDIT,this.recipientsCopy=angular.copy(this.recipients),this.submitErrors=[],this.warnings=[],this._checkEmailAnswer(),this._validateDuplicateContact(this.recipient),this.scrollToTop(),e?n.moveTo(e):n.moveTo(n.STATES.EDIT_ADDRESS),n.BUTTONS.BTN_ORG.disable=!1}},{key:"deleteContact",value:function(){if(this.isSelectingJointContact)this.onClose({payload:{isRemoved:!0}});else{var t=this.flowService;t.moveTo(t.STATES.DELETE_CONTACT)}}},{key:"manageContacts",value:function(){var t=this,e=this.flowService,n=this.$state;e.warn().then((function(){t.onClose(),t.cifTypeService.switchToParentCif(),n.go(t.stateConstants.USER_SETTINGS_MONEY_TRANSFER,{optionalComponentLoad:"TRANSFER_DETAILS"})}))}},{key:"_watchFormChange",value:function(){var t=this,e=this.flowService;this.$scope.$watch((function(){return t.recipient}),(function(){t.contactForm&&Object.prototype.hasOwnProperty.call(t.contactForm,"$valid")&&(t.showAnswerValidationError||t.showAnswerReenteredValidationError?e.BUTTONS.BTN_ORG.disable=!0:e.BUTTONS.BTN_ORG.disable=!t.contactForm.$valid)}),!0)}},{key:"transfer",value:function(t){var e=this.flowService,n=this.TRANSFER_TYPE;t===n.TANGERINE_EMT?this.transaction.TRANSFER_TYPE_STATE=n.TANGERINE_EMT:this.transaction.TRANSFER_TYPE_STATE=n.INTERAC_EMT,t!==n.INTERAC_EMT||this.interacConsent&&this.interacConsent.length>0&&"Y"===this.interacConsent[0].value?e.gotoNextState():e.moveTo(e.STATES.ACCEPT_TERMS_AND_CONDITIONS)}},{key:"goToNextFlow",value:function(){this.transfer(this.TRANSFER_TYPE.TANGERINE_EMT)}},{key:"updateAcceptButton",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=!this.interacAgreementConfirmation}},{key:"_acceptInteracTermsAndConditions",value:function(){var t=this;return this.$log.debug("Call accept Interac TermsAndConditions"),this.customersService.putCustomerConsents({consent:{name:this.TRANSFER_TYPE.INTERAC,value:"Y"}}).then((function(){t.flowService.gotoNextState()})).catch((function(e){t._showSubmitErrors(e),t.$log.error("EMT fulfill: service error",e)}))}},{key:"selectFromAccount",value:function(t,e){var n=this.flowService;this.transaction.payFromAccount=e,this.flowService.currentState===this.flowService.STATES.TYPE_OF_TRANSFER?this.transaction.payFromAccount.tileDescription="":this.transaction.payFromAccount.tileDescription=this.$translate.instant("emt.emailMoney.from"),this.transaction.payFromAccount.payFromAccountNickName=this.accountHelpersService.getDisplayNameInstant(e),this.transaction.payFromAccount.payFromAccountNickNameNum=this.getNickNameWithNum(this.transaction.payFromAccount.payFromAccountNickName,this.transaction.payFromAccount.display_name),n.gotoNextState(),this._getAccountDetails()}},{key:"getNickNameWithNum",value:function(t,e){var n=e.length,i=n-4,a=n,s="***".concat(e.slice(i,a));return t.concat("  ").concat(s)}},{key:"whenSend",value:function(t){var e=this.flowService,n=this.WHEN_SEND;0===t?(this.transaction.WHEN_STATE=n.NOW,this.transaction.when=(0,c.default)(),e.moveTo(e.STATES.HOW_MUCH)):(this.transaction.WHEN_STATE=n.LATER,this.transaction.when=(0,c.default)().add(1,"days"),e.moveTo(e.STATES.DATE))}},{key:"logDateChangeSingle",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=!this.transaction.when,this.$log.debug("EMT: Logging new selectedDay: ",this.transaction.when)}},{key:"onAmountChange",value:function(t){this.transaction.amount=t,this.transactionTile={header:this.$translate.instant("emt.emailMoney.amount"),amount:t},t<=0?this.flowService.BUTTONS.BTN_ORG.disable=!0:t>0&&this._showValidationIfIncorrectAmount(t)}},{key:"validateAmountForErrorMessage",value:function(t){if(this.showAmountGreaterThanAvail=!1,void 0!==this.transaction.payFromAccount.external_available_balance&&this.transaction.payFromAccount.external_available_balance>=0&&""!==t&&this.transaction.payFromAccount.external_available_balance<t){this.amountMessage=null,this.showAmountGreaterThanAvail=!0;var e=this.$filter("tngCurrency")(this.transaction.payFromAccount.external_available_balance||0);this.availableBalanceWithHold=this.$translate.instant("emt.emailMoney.moreThanAvailable",{availableAmount:e}),this.flowService.BUTTONS.BTN_ORG.disable=!1,this.flowService.holdLink=!0}return!this.showAmountGreaterThanAvail}},{key:"onAmountBlurChange",value:function(t){this.transaction.amount=t,this._showValidationIfIncorrectAmount(t)}},{key:"_showValidationIfIncorrectAmount",value:function(t){var e=this.flowService,n=this.$log,i=this.$translate;n.debug("AMOUNT: ",t),t<this.limits.minimumLimit?(this.flowService.holdLink=!1,this.showAmountGreaterThanAvail=!1,this.amountMessage=i.instant("emt.validation.tooLittle",{value:this.limits.minimumLimit}),e.BUTTONS.BTN_ORG.disable=!0):this._validateAmountInput(t)}},{key:"_validateAmountInput",value:function(t){var e=this,n=this.flowService,i=this.$log,a=this.$translate,s=this.$timeout,r=this.emtService;n.BUTTONS.BTN_ORG.disable=!0,this.amountMessage=null,this.isValidatingAmount=!0,this.transaction.autoDepositDetails={},this.tempOptionalMessage=this.transaction.optionalMessage,this.transaction.optionalMessage="",this.validationTimeout&&s.cancel(this.validationTimeout),this.validationTimeout=s((function(){e.validationTimeout=null,r.sendMoneyEmailTransfer(e.transaction,!0).then((function(s){t===e.transaction.amount&&(t>e.limits.transactionLimit?(e.amountMessage=a.instant("emt.validation.tooMuch",{value:e.limits.transactionLimit}),n.BUTTONS.BTN_ORG.disable=!0):s.response_status.status_code===e.serviceConstants.STATUS_CODES.AVLBAL||s.response_status.status_code===e.serviceConstants.STATUS_CODES.AVLBALHLD?n.BUTTONS.BTN_ORG.disable=!1:-1===["CREATED","SUCCESS"].indexOf(s.response_status.status_code)?(i.error("EMT API VALIDATION ERROR: ",s.response_status),e.amountMessage=e.$translate.instant("global.errorCodes."+s.response_status.return_code),n.BUTTONS.BTN_ORG.disable=!0):(e.amountMessage=null,e.flowService.holdLink=!1,e.showAmountGreaterThanAvail=!1,n.BUTTONS.BTN_ORG.disable=!(t&&t>0)),e.isValidatingAmount=null,s.autodeposit_details&&(e.transaction.autoDepositDetails.email_address=s.autodeposit_details.email_address,e.transaction.autoDepositDetails.registration_name=s.autodeposit_details.registration_name,e.transaction.autoDepositDetails.contact_name=s.autodeposit_details.contact_name),e.transaction.optionalMessage=e.tempOptionalMessage)})).catch((function(t){i.error(t),e.isValidatingAmount=null}))}),500)}},{key:"resetSearch",value:function(){this.searchTerm=""}},{key:"_sendMoney",value:function(){var t=this,e=this.$log,n=this.flowService;if(this.loading=!0,this.submitErrors=[],this.TimerService.startTimerForAction(this.TimerService.EVENTS.SUBMIT_EMT),n.moveTo(n.STATES.PROCESSING),!this.interacConsent[0]||"Y"===this.interacConsent[0].value||!this.interacAgreementConfirmation)return this._simpleSendMoney();var i={consent:{name:this.TRANSFER_TYPE.INTERAC,value:"Y"}};this.customersService.putCustomerConsents(i).then((function(e){return"SUCCESS"!==e.response_status.status_code?new Error:t._simpleSendMoney()})).catch((function(n){t.loading=!1,e.error("error saving customer consent:",n),t._showSubmitErrors(n)}))}},{key:"_simpleSendMoney",value:function(){var t=this,e=this.$log,n=this.flowService;return this.emtService.sendMoneyEmailTransfer(this.transaction,!1).then((function(i){if(t.loading=!1,"CREATED"===i.response_status.status_code){t.creationDate=(0,c.default)(),t.formattedCreationTime=t.getLocalizedTime(t.creationDate);var a=(0,s.default)(i.confirmations,1);t.confirmation=a[0],e.debug("Got confirmation code: ",t.confirmation),n.moveTo(n.STATES.DONE)}else t._showSubmitErrors(i),n.moveTo(n.STATES.REVIEW),n.BUTTONS.BTN_ORG.disable=!0})).catch((function(n){t.loading=!1,e.error("error sending email money:",n),t._showSubmitErrors(n)})).finally((function(){t.TimerService.endTimerForAction(t.TimerService.EVENTS.SUBMIT_EMT)}))}},{key:"getLocalizedTime",value:function(t){return this.LocaleService.locale===this.localeConstants.LOCALES.EN_CA?t.format("h:mm A"):t.format("HH:mm").replace(":"," h ")}},{key:"_showSubmitErrors",value:function(t){var e=this.submitErrors,n=this.flowService;if("errorMessage"in t&&e.push(t.errorMessage),"details"in t.response_status){var s=t.response_status.details.map((function(t){return t.details_code?"global.errorCodes."+t.details_code:t.technical_description})),r=[].concat((0,a.default)(new i.default(s)));e.push.apply(e,(0,a.default)(r))}else-1===["CREATED","SUCCESS"].indexOf(t.response_status.status_code)&&("SYSTEM_ERROR"===t.response_status.status_code&&t.response_status.return_code?e.push(this.$translate.instant("global.errorCodes."+t.response_status.return_code)):"status_code"in t.response_status?e.push(this.$translate.instant("global.errorCodes."+t.response_status.status_code)):e.push(this.$translate.instant("global.errorCodes."+t.response_status.return_code)));n.BUTTONS.BTN_GRY.disable=!1,n.BUTTONS.BTN_GRY.show=!0,n.BUTTONS.BTN_GRY.type=this.isSelectingJointContact?n.BUTTON_TYPES.CANCEL:n.BUTTON_TYPES.BACK,this.$log.debug("formatted error:",e)}},{key:"_deleteContact",value:function(){var t=this,e=this.$log,n=this.flowService,i=this.emtService;this.loading=!0,this.submitErrors=[],this.warnings=[],this.deleteContactError="",n.moveTo(n.STATES.PROCESSING),i.deleteContact(this.recipient.sequence_number).then((function(e){t.loading=!1,"SUCCESS"!==e.response_status.status_code?(n.moveTo(n.STATES.DELETE_CONTACT),n._stateHistory.pop(),n._stateHistory.pop(),p===e.response_status.status_code?t.deleteContactError=t.$translate.instant("emt.validation."+e.response_status.return_code):t.deleteContactError=t.$translate.instant("global.errorCodes."+e.response_status.return_code)):(t._removeContactFromDOM(),t.transaction.recipient={})})).catch((function(n){t.loading=!1,e.error("error sending email money:",n),t._showSubmitErrors(n)}))}},{key:"_getEmailTransferAccounts",value:function(){var t=this,e=this.emtService,n=this.$log;e.getEmailTransferAccounts().then((function(e){t.fromAccounts=e.fromAccounts})).catch((function(e){n.error("error fetching email transfer accounts:",e),t._showSubmitErrors(e)}))}},{key:"_getCustomerConsents",value:function(){var t=this,e=this.customersService,n=this.$log;e.getCustomerConsents().then((function(e){t.consents=e.consents,t.interacConsent=t.consents.filter((function(e){return e.name===t.TRANSFER_TYPE.INTERAC})),t.agreementConfirmationFromServer=!1,t.interacConsent.length?t.agreementConfirmationFromServer="Y"===t.interacConsent[0].value:t.agreementConfirmationFromServer=!1,t.interacAgreementConfirmation=t.agreementConfirmationFromServer})).catch((function(e){n.error("error fetching customer consents:",e),t._showSubmitErrors(e)}))}},{key:"_removeContactFromDOM",value:function(){var t=this,e=this.$log,n=this.flowService,i=this.recipients.findIndex((function(e){return e.email_address===t.recipient.email_address})),a=this.recentContacts.findIndex((function(e){return e.email_address===t.recipient.email_address}));-1!==i&&(this.recipients.splice(i,1),e.debug("Recipient deleted"),n.moveTo(n.STATES.CONTACT_DELETED)),-1!==a&&this.recentContacts.splice(a,1)}},{key:"checkQuestion",value:function(){this.showAnswerValidationError=!1,void 0!==this.recipient.email_question&&this.contactForm.EMTEMAILQUESTION.$dirty&&(this.recipient.email_answer="",this.contactForm.emailAnswer_EMT.$setDirty(),this.contactForm.emailAnswer_EMT.$setValidity("required",!1)),void 0!==this.contactForm.emailAnswer_EMT.$valid&&this.recipient.email_answer===this.recipient.email_question?this.showAnswerValidationError=!0:this.showAnswerValidationError=!1}},{key:"checkAnswer",value:function(){this.contactForm.EMTEMAILQUESTION.$valid&&this.recipient.email_answer===this.recipient.email_question?this.showAnswerValidationError=!0:this.showAnswerValidationError=!1}},{key:"checkAnswerReentered",value:function(){this.contactForm.emailAnswer_EMT.$valid&&this.recipient.answer_reenter!==this.recipient.email_answer?this.showAnswerReenteredValidationError=!0:this.showAnswerReenteredValidationError=!1}},{key:"_checkEmailAnswer",value:function(){var t=this.$translate.instant("emt.emailMoney.answer");this.recipient.email_address&&this.recipient.email_address.length>0&&this.warnings&&this.warnings<=0&&(this.recipient.email_answer="*****"),this.answerPlaceHolderText=t}},{key:"emailQuestionBlur",value:function(){this.recipient.email_answer||this.FORM_TYPE.EDIT!==this.formType||this.contactForm.EMTEMAILQUESTION.$dirty||this.contactForm.emailAnswer_EMT.$dirty||(this.recipient.email_answer="*****")}},{key:"getCharactersLeft",value:function(){return 250-this.transaction.optionalMessage.length}},{key:"validateMessage",value:function(){this.submitErrors=[],this.recipient.email_answer&&-1!==this.transaction.optionalMessage.indexOf(this.recipient.email_answer)?(this.submitErrors.push(this.$translate.instant("global.errorCodes.EMT_MESSAGE_CONTAINS_ANSWER")),this.flowService.BUTTONS.BTN_ORG.disable=!0):this.flowService.BUTTONS.BTN_ORG.disable=!1}},{key:"_getLimits",value:function(){var t=this;this.emtService.getEmtLimits().then((function(e){t.limits=e.limits.emailTransferLimits}))}},{key:"_getAccountDetails",value:function(){var t=this;this.accountDetailsService.getAccountDetails(this.transaction.payFromAccount.number).then((function(e){t.overdraftLimit="overdraft"in e.account_summary?e.account_summary.overdraft.overdraft_limit:0}))}},{key:"getRecipientDisplayName",value:function(){return this.displayName="",this.transaction.autoDepositDetails&&this.transaction.autoDepositDetails.contact_name?(this.displayName=this.transaction.autoDepositDetails.contact_name,this.transaction.autoDepositDetails.registration_name&&(this.displayName=this.transaction.autoDepositDetails.registration_name+" ("+this.displayName+")")):this.displayName=this.transaction.recipient.first_name+" "+this.transaction.recipient.last_name,this.displayName}},{key:"checkIsEmailAllowed",value:function(){var t=this;this.recipientsCopy?this.emailAlreadyOnTheList=this.recipientsCopy.some((function(e){return t.recipient.sequence_number!==e.sequence_number&&t.recipient.email_address&&e.email_address&&t.recipient.email_address.toLowerCase()===e.email_address.toLowerCase()})):this.emtService.getEmtRecipients().then((function(e){t.recipients=e.recipient,t.recipientsCopy=angular.copy(t.recipients),t.emailAlreadyOnTheList=t.recipientsCopy.some((function(e){return t.recipient.sequence_number!==e.sequence_number&&t.recipient.email_address&&e.email_address&&t.recipient.email_address.toLowerCase()===e.email_address.toLowerCase()}))})).catch((function(e){t.$log.error("error fetching EMT recipients:",e)}))}},{key:"moveBackToWhen",value:function(){var t=this.flowService;this.transaction.WHEN_STATE===this.WHEN_SEND.NOW?t.moveTo(t.STATES.WHEN):this.transaction.WHEN_STATE===this.WHEN_SEND.LATER&&t.moveTo(t.STATES.DATE)}},{key:"onAnswerInput",value:function(){"*****"===this.recipient.email_answer&&(this.recipient.email_answer=null)}},{key:"addNewContact",value:function(){this.flowService.gotoNextState()}},{key:"areAnswersCorrect",value:function(){return this.recipient.email_answer&&this.recipient.answer_reenter===this.recipient.email_answer}},{key:"saveNewContact",value:function(){var t=this;this.submitErrors=[];var e=this.flowService,n=this.emtService,i=this.$log;e.gotoNextState(),n.addContact(this.recipient,this.isSelectingJointContact).then((function(e){-1===["CREATED","SUCCESS"].indexOf(e.response_status.status_code)?(i.error("Wrong response code:",e),t._showSubmitErrors(e)):(t.recipient.sequence_number=e.sequence_number,t.recipients.push(t.recipient))})).catch((function(e){i.error("error saving EMT recipients:",e),t._showSubmitErrors(e)}))}},{key:"getAttributeValue",value:function(t){var e=this.flowService.currentState;if(e===this.flowService.STATES.EDIT_ADDRESS||e===this.flowService.STATES.EDIT_ADDRESS_EMT_FLOW)switch(t){case"emailHolder":return this.$translate.instant("emt.emailMoney.emailAddress");case"questionHolder":return this.$translate.instant("emt.emailMoney.question");case"answerHolder":return this.$translate.instant("emt.emailMoney.answer")}return""}},{key:"goBacktoHowMuchState",value:function(){var t=this.flowService;return this.loading=!1,this.submitErrors=[],this.warnings=[],t.moveTo(t.STATES.HOW_MUCH)}},{key:"goBacktoSelectContact",value:function(){var t=this.flowService;return this.loading=!1,this.submitErrors=[],this.warnings=[],t.moveTo(t.STATES.SEARCH)}},{key:"goBacktoChooseAccount",value:function(){var t=this.flowService;return this.loading=!1,this.submitErrors=[],this.warnings=[],this.transaction.payFromAccount&&this.transaction.payFromAccount.tileDescription&&(this.transaction.payFromAccount.tileDescription=""),t.moveTo(t.STATES.CHOOSE_ACCOUNT)}},{key:"showWarningMessage",value:function(){return!(!this.contactForm.emailAnswer_EMT.$invalid||!this.contactForm.emailAnswer_EMT.$touched||this.FORM_TYPE.NEW!==this.formType&&this.FORM_TYPE.EDIT!==this.formType)||!(!this.showAnswerValidationError||!this.contactForm.emailAnswer_EMT.$touched)}},{key:"onNameChange",value:function(t){this.warnings=[],t.first_name&&t.last_name&&this._validateDuplicateContact(t)}},{key:"scrollToTop",value:function(){this.$location.hash("send-emt-contactForm"),this.$anchorScroll()}},{key:"amountInputFormSubmit",value:function(){this.generalFormSubmit(),this.flowService.submit()}},{key:"contactFormSubmit",value:function(){this.generalFormSubmit()}},{key:"searchTermSubmit",value:function(){this.generalFormSubmit()}},{key:"generalFormSubmit",value:function(){this.hideMobileKeyboard()}},{key:"hideMobileKeyboard",value:function(){this.removePageFocus()}},{key:"removePageFocus",value:function(){document.activeElement.blur()}},{key:"isContactFormInvalid",get:function(){return this.contactForm&&(this.contactForm.$invalid||this.showAnswerValidationError||this.emailAlreadyOnTheList||this.duplicateContactOnTheList)}}]),t}();g.$inject=["$log","$q","sendEmtFlowService","$state","EmtService","emtConstants","$scope","tngTileListConstants","tngDateSelectorConstants","$translate","stateConstants","LocaleService","AccountDetailsService","$filter","$timeout","localeConstants","$location","$anchorScroll","CifTypeService","CustomersService","AccountHelpersService","TimerService","DateService","buildConstants","BackButtonService","backButtonConstants","AnchorService","serviceConstants","storageConstants","StorageService","FeedbackSurveyConstants","FeedbackSurveyService","EnvironmentService"],e.default=g,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(177)),a=u(n(0)),s=u(n(2)),r=u(n(264)),o=u(n(266)),c=u(n(265)),l=n(364);function u(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(t,n,s,o,c,l,u,d,h,f,p){(0,a.default)(this,e);var g=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,d,l,h));return g.$window=c,g.StepUpService=f,g.$log=t,g.emtService=u,g.stateConstants=p,g.fromAccounts=[],g.holdLink=!1,g.addNewRecipient=!1,g.STATES={SEARCH:{titleKey:"emt.states.search"},EDIT_ADDRESS:{titleKey:"emt.states.editAddress"},EDIT_ADDRESS_EMT_FLOW:{titleKey:"emt.states.enforceEditContact"},DELETE_CONTACT:{titleKey:"emt.states.deleteContact"},CONTACT_DELETED:{titleKey:"emt.states.contactDeleted"},TYPE_OF_TRANSFER:{titleKey:"emt.states.typeOfTransfer"},ACCEPT_TERMS_AND_CONDITIONS:{titleKey:"emt.states.termsAndConditions"},CHOOSE_ACCOUNT:{titleKey:"emt.states.moveMoney"},WHEN:{titleKey:"emt.states.when"},HOW_MUCH:{titleKey:"emt.states.howMuch"},DATE:{titleKey:"emt.states.selectDate"},REVIEW:{titleKey:"emt.states.review"},PROCESSING:{titleKey:"global.commonWords.processing"},DONE:{titleKey:"emt.states.done"},SCHEDULED:{titleKey:"emt.states.scheduled"}},g._initialState=g.STATES.SEARCH,g}return(0,c.default)(e,t),(0,s.default)(e,[{key:"_resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.BUTTONS={BTN_GRY:new l.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new l.ModalFooterButton(this.BUTTON_TYPES.NEXT,!0,!0),BTN_RED:new l.ModalFooterButton(this.BUTTON_TYPES.DELETE,!1,!0)}}},{key:"_updateUI",value:function(){var t=this.currentState,e=this.BUTTON_TYPES,n=this.BUTTONS,i=this.STATES;switch(n.BTN_GRY.show=!0,n.BTN_GRY.disable=!1,n.BTN_ORG.show=!0,n.BTN_ORG.disable=!1,n.BTN_RED.show=!1,n.BTN_RED.disable=!1,t){case i.SEARCH:n.BTN_GRY.type=e.CANCEL,n.BTN_ORG.type=e.NEXT,n.BTN_ORG.disable=!0,n.BTN_GRY.show=!0;break;case i.EDIT_ADDRESS_EMT_FLOW:n.BTN_GRY.type=e.BACK,n.BTN_ORG.type=e.CONTINUE,n.BTN_ORG.show=!0,n.BTN_ORG.disable=!0;break;case i.EDIT_ADDRESS:n.BTN_GRY.type=this.isSelectingJointContact?e.CANCEL:e.BACK,n.BTN_ORG.type=e.SAVE,n.BTN_ORG.show=!0,n.BTN_ORG.disable=!this.isSelectingJointContact;break;case i.DELETE_CONTACT:n.BTN_GRY.type=e.BACK,n.BTN_RED.type=e.DELETE,n.BTN_ORG.show=!1,n.BTN_RED.show=!0;break;case i.CONTACT_DELETED:n.BTN_GRY.show=!1,n.BTN_ORG.type=e.DONE,n.BTN_ORG.disable=!1;break;case i.TYPE_OF_TRANSFER:n.BTN_GRY.type=e.CANCEL,n.BTN_ORG.show=!1;break;case i.ACCEPT_TERMS_AND_CONDITIONS:n.BTN_ORG.type=e.ACCEPT,n.BTN_GRY.show=!1;break;case i.CHOOSE_ACCOUNT:case i.WHEN:n.BTN_GRY.type=e.BACK,n.BTN_ORG.show=!1;break;case i.HOW_MUCH:case i.DATE:n.BTN_GRY.show=!0,n.BTN_ORG.type=e.NEXT,n.BTN_ORG.disable=!0;break;case i.REVIEW:n.BTN_GRY.show=!1,n.BTN_ORG.type=e.SEND,n.BTN_ORG.disable=!1;break;case i.PROCESSING:n.BTN_GRY.show=!1,n.BTN_ORG.show=!1;break;case i.DONE:this.holdLink=!1,n.BTN_ORG.type=e.DONE,n.BTN_ORG.show=!0,n.BTN_GRY.show=!1,this.hideWarning()}}},{key:"gotoNextState",value:function(){var t=this,e=this.currentState,n=this.STATES;switch(this.holdLink=!1,e){case n.SEARCH:this.addNewRecipient?this.StepUpService.requestLevel2().then((function(){t.moveTo(n.EDIT_ADDRESS),t.addNewRecipient=!1})):this.moveTo(n.TYPE_OF_TRANSFER);break;case n.EDIT_ADDRESS:this.moveTo(n.SEARCH);break;case n.DELETE_CONTACT:this.moveTo(n.CONTACT_DELETED);break;case n.CONTACT_DELETED:this.moveTo(n.SEARCH);break;case n.TYPE_OF_TRANSFER:case n.ACCEPT_TERMS_AND_CONDITIONS:this.moveTo(n.CHOOSE_ACCOUNT);break;case n.CHOOSE_ACCOUNT:this.moveTo(n.WHEN);break;case n.HOW_MUCH:this.moveTo(n.REVIEW);break;case n.DATE:this.moveTo(n.HOW_MUCH);break;case n.REVIEW:this.moveTo(n.PROCESSING);break;case n.PROCESSING:this.moveTo(n.DONE);break;case n.DONE:break;default:this.$log.debug("Unknown or unrecognized state:",e)}}},{key:"returnToStart",value:function(){this._resetState()}},{key:"exitLoadingMode",value:function(){this.isLoading=!1,this.doneLoading=!1}},{key:"_getAnalyticsID",value:function(){return"emt/send"}}]),e}(u(n(267)).default);d.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","EmtService","$rootScope","AnalyticsService","StepUpService","stateConstants"],e.default=d,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return function(t,e){var n=[];return angular.isArray(t)&&"string"==typeof e?(t.forEach((function(t){var i=t.first_name+" "+t.last_name;-1===t.email_address.toUpperCase().indexOf(e.toUpperCase())&&-1===i.toUpperCase().indexOf(e.toUpperCase())||n.push(t)})),n):t}},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(5301)),a=r(n(5305)),s=r(n(5306));function r(t){return t&&t.__esModule?t:{default:t}}var o=angular.module("tangerine.emt.receiveMoney.module",[]).component("receiveMoneyClient",i.default).component("receiveMoneyInterac",i.default).component("receiveMoneyStandard",i.default).service("ReceiveMoneyFlowService",a.default).service("ReceiveMoneyService",s.default);e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5302)),a=s(n(5303));function s(t){return t&&t.__esModule?t:{default:t}}n(5304);var r={controller:a.default,template:i.default,bindings:{returnTo:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-loading-in-progress ng-if="$ctrl.isRedirecting" class="c-loading-spinner c-receive-money__spin-center"> </tng-loading-in-progress> <div class="c-receive-money c-emt-page" ng-if="!$ctrl.isRedirecting"> <div ng-if="$ctrl.flowService.showConfirmExitUI"> <tng-confirm-exit></tng-confirm-exit> </div> <div class="c-emt-page__loader-overlay" ng-if="$ctrl.model.shouldShowLoader"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div class="c-emt-page__content" ng-if="!$ctrl.model.shouldShowLoader && !$ctrl.flowService.showConfirmExitUI"> <h2 ng-if="!$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.standard)" class="heading--sub" translate="{{$ctrl.flowService.currentState.titleKey}}"></h2> <h2 ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.standard) && $ctrl.flowService.currentState !== $ctrl.flowService.STATES.CONFIRMATION" class="heading--sub" translate="{{$ctrl.flowService.currentState.titleKey}}"></h2> <h2 ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.standard) && $ctrl.flowService.currentState === $ctrl.flowService.STATES.CONFIRMATION" class="heading--sub"> {{::\'emt.receiveMoneyClient.states.confirmationStandard\' | translate }} </h2> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.TRANSFER_AUTHENTICATION"> <p class="margin__tb--fix2" translate="emt.receiveMoneyClient.enterDetails"> </p> <div class="c-error-message panel margin__tb--fix2" ng-if="$ctrl.model.errors.return_code"> {{\'global.errorCodes.\' + $ctrl.model.errors.return_code | translate }} </div> <form class="c-emt-page__form" id="transferAuthenticationForm" name="$ctrl.model.forms.transferAuthentication"> <div class="field"> <label translate="emt.receiveMoneyClient.emailMoneyTransferCode"></label> <input class="input" type="text" required ng-change="$ctrl.onFormChange($ctrl.forms.transferAuthentication)" ng-model="$ctrl.emtId"/> </div> <div class="field"> <label translate="emt.receiveMoneyClient.sendersLastName"></label> <input class="input" type="text" required ng-change="$ctrl.onFormChange($ctrl.forms.transferAuthentication)" ng-model="$ctrl.model.transferAuthentication.senderLastName" placeholder="{{ ::\'emt.receiveMoneyClient.sendersLastNamePlaceholder\' | translate}}"/> </div> <section class="field"> <label translate="emt.receiveMoneyClient.depositIntoTangerineAccount"></label> <div class="field__group--inline top-margin-medium"> <div class="field"> <input ng-required="true" ng-value="true" class="input input--pill" ng-change="$ctrl.onFormChange($ctrl.forms.transferAuthentication)" ng-model="$ctrl.model.transferAuthentication.depositIntoTangerineAccount" id="depositIntoTangerineAccountYes" actionable-id="depositIntoTangerineAccountYes" type="radio"/> <label for="depositIntoTangerineAccountYes" id="depositIntoTangerineAccountYes_label" class="c-client-onboarding__toggle-button">{{ ::\'clientOnboarding.setupAccountForm.labels.yes\' | translate }}</label> </div> <div class="field margin__l--fix1"> <input ng-required="true" ng-value="false" ng-change="$ctrl.onFormChange($ctrl.forms.transferAuthentication)" ng-model="$ctrl.model.transferAuthentication.depositIntoTangerineAccount" class="input input--pill" id="depositIntoTangerineAccountNo" actionable-id="depositIntoTangerineAccountNo" type="radio"/> <label for="depositIntoTangerineAccountNo" id="depositIntoTangerineAccountNo_label" class="c-client-onboarding__toggle-button">{{ ::\'clientOnboarding.setupAccountForm.labels.no\' | translate }}</label> </div> </div> </section> </form> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.ANSWER_QUESTION"> <div class="c-emt-page__form"> <p class="margin__tb--fix2" ng-hide="$ctrl.shouldHideControlsForInvalidEMTDetails()"> {{ \'emt.receiveMoneyClient.answerQuestionDescription\' | translate}} <strong> {{ $ctrl.model.transferDetails.senderFullName }}</strong>. </p> </div> <div class="c-emt-page__form-container"> <div class="c-error-message panel margin__tb--fix2" ng-if="$ctrl.model.errors.return_code"> {{\'global.errorCodes.\' + $ctrl.model.errors.return_code | translate }} </div> <form ng-hide="$ctrl.shouldHideControlsForInvalidEMTDetails()" class="c-emt-page__form" name="$ctrl.model.forms.answerQuestion" ng-init="$ctrl.onFormChange($ctrl.forms.answerQuestion)" id="answerQuestionForm"> <div class="field"> <label class="c-emt-page__emt-question CB_DoNotShow">{{$ctrl.model.question}}</label> <input class="input CB_DoNotShow" type="text" minlength="3" maxlength="30" required actionable-id="EmailAnswer" ng-change="$ctrl.onFormChange($ctrl.forms.answerQuestion)" placeholder="{{ \'emt.receiveMoneyClient.enterAnswerHere\' | translate}}" ng-model="$ctrl.model.answerQuestion.answer" ng-disabled="$ctrl.isAnswerQuestionDisabled"/> </div> </form> </div> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.TRANSFER_DETAILS" class="c-receive-money__details-wrapper"> <div class="c-emt-page__form-container margin__t--fix2"> <div class="c-emt-page__form"> <p translate="emt.receiveMoneyClient.pleaseProvideDetails" class="margin__b--fix2" ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.standard)"> </p> <div> <div class="{{:: \'panel c-receive-money__details-panel\' + ($ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.standard) ? \'--standard-amount\' : \'--amount\')}}"> <label class="c-receive-money__details-panel-label" translate="emt.receiveMoneyClient.amount" for=""> </label> <h4 class="c-receive-money__details-panel-amount">{{ $ctrl.model.transferDetails.transferAmount | currency }}</h4> </div> <div class="c-receive-money__details-panel panel"> <label translate="emt.receiveMoneyClient.from" class="c-receive-money__details-panel-label" for=""> </label> <h4 class="c-receive-money__details-panel-name">{{ $ctrl.model.transferDetails.senderFullName }}</h4> <h5 class="c-receive-money__details-panel-email">{{ $ctrl.model.transferDetails.senderEmail }}</h5> </div> <div class="c-receive-money__details-panel panel" ng-if="$ctrl.model.transferDetails.message"> <label class="c-receive-money__details-panel-label" translate="emt.receiveMoneyClient.message" for=""> </label> <h2 class="c-receive-money__details-panel-message" ng-bind="$ctrl.model.transferDetails.message"></h2> </div> </div> <div class="c-receive-money__deposit-to-section" ng-if="!$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.standard)"> <h3 ng-if="$ctrl.accountsToDepositTo && $ctrl.accountsToDepositTo.length > 0" translate="emt.receiveMoneyClient.depositToWhichAccount"></h3> <tng-tile-list ng-if="$ctrl.accountsToDepositTo && $ctrl.accountsToDepositTo.length > 0" on-tile-click="$ctrl.onAccountTileClick(index, tileData)" tile-data="$ctrl.accountsToDepositTo" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" single-select="true" all-actionable="true" selected-tiles="$ctrl.model.transferDetails.selectedAccount"> </tng-tile-list> <div ng-if="!$ctrl.accountsToDepositTo || $ctrl.accountsToDepositTo.length === 0"> <p class="body--4" translate="emt.receiveMoneyClient.noAccountsError"></p> </div> </div> <div class="c-receive-money__non-client-form" ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.standard)"> <form id="nonClientAccountForm" name="$ctrl.model.forms.nonClientAccount"> <div class="c-error-message panel margin__tb--fix2" ng-if="$ctrl.model.errors.return_code"> {{\'global.errorCodes.\' + $ctrl.model.errors.return_code | translate }} </div> <div class="c-receive-money__non-client-form-field field"> <label><strong translate="emt.receiveMoneyClient.nonClientAccount.transitNumber"></strong></label> <input class="input" type="tel" required minlength="0" maxlength="5" ng-model-options="{debounce: 400}" ng-change="$ctrl.checkFinancialInstitutionValidity()" id="TransitNumber" pattern="\\d*" ng-class="{\'warning\': $ctrl.model.forms.nonClientAccount.nonClientAccountTransitNumberBranch.$invalid\n                     && $ctrl.model.forms.nonClientAccount.$dirty}" name="nonClientAccountTransitNumberBranch" placeholder="{{ \'emt.receiveMoneyClient.nonClientAccount.transitNumberBranchPlaceholder\' | translate}}" ng-model="$ctrl.model.transferDetails.nonClientAccount.transitNumberBranch"/> <div ng-messages="$ctrl.model.forms.nonClientAccount.nonClientAccountTransitNumberBranch.$error" ng-show="$ctrl.model.forms.nonClientAccount.$dirty" class="field__error"> <p ng-message="maxlength | minlength"> {{\'emt.validation.exact5\' | translate}} </p> <p ng-message="required"> {{\'emt.validation.isRequired\' | translate}} </p> <p></p> <p ng-message="pattern"> {{\'emt.validation.onlyNumbers\' | translate}} </p> </div> <div class="field__error" ng-if="$ctrl.shouldDisplayInvalidInstitutionError()"> <p>{{\'emt.validation.invalidBankBranchCombination\' | translate}}</p> </div> </div> <div class="c-receive-money__non-client-form-field field"> <label> <strong translate="emt.receiveMoneyClient.nonClientAccount.institutionNumber"></strong> </label> <input class="input" type="tel" required minlength="3" maxlength="3" pattern="\\d*" ng-model-options="{debounce: 400}" ng-change="$ctrl.checkFinancialInstitutionValidity()" id="BankNumber" ng-class="{\'warning\': $ctrl.model.forms.nonClientAccount.nonClientAccountInstitutionNumberBank.$invalid\n                     && $ctrl.model.forms.nonClientAccount.$dirty}" name="nonClientAccountInstitutionNumberBank" placeholder="{{:: \'emt.receiveMoneyClient.nonClientAccount.institutionNumberBankPlaceholder\' | translate}}" ng-model="$ctrl.model.transferDetails.nonClientAccount.institutionNumberBank"/> <div ng-messages="$ctrl.model.forms.nonClientAccount.nonClientAccountInstitutionNumberBank.$error" ng-show="$ctrl.model.forms.nonClientAccount.$dirty" class="field__error"> <p ng-message="maxlength | minlength"> {{\'emt.validation.exact3\' | translate}} </p> <p ng-message="required"> {{\'emt.validation.isRequired\' | translate}} </p> <p ng-message="pattern"> {{\'emt.validation.onlyNumbers\' | translate}} </p> </div> <div class="field__error" ng-if="$ctrl.shouldDisplayInvalidInstitutionError()"> <p>{{\'emt.validation.invalidBankBranchCombination\' | translate}}</p> </div> </div> <div class="c-receive-money__non-client-form-field field"> <label> <strong translate="emt.receiveMoneyClient.nonClientAccount.accountNumber"> </strong> </label> <input class="input" type="tel" required pattern="\\d*" minlength="0" maxlength="12" ng-model-options="{debounce: 400}" ng-change="$ctrl.checkFinancialInstitutionValidity()" id="AccountNumber" name="nonClientAccountAccountNumber" ng-change="$ctrl.onTransferDetailsFormChange()" ng-class="{\'warning\': $ctrl.model.forms.nonClientAccount.nonClientAccountAccountNumber.$invalid\n                     && $ctrl.model.forms.nonClientAccount.$dirty}" placeholder="{{:: \'emt.receiveMoneyClient.nonClientAccount.accountNumberPlaceholder\' | translate }}" ng-model="$ctrl.model.transferDetails.nonClientAccount.accountNumber"/> <div ng-messages="$ctrl.model.forms.nonClientAccount.nonClientAccountAccountNumber.$error" ng-show="$ctrl.model.forms.nonClientAccount.$dirty" class="field__error"> <p ng-message="required"> {{\'emt.validation.isRequired\' | translate}} </p> <p ng-message="maxlength"> {{\'emt.validation.tooLong\' | translate}} </p> <p ng-message="minlength"> {{\'emt.validation.tooShort\' | translate}} </p> <p ng-message="pattern"> {{\'emt.validation.onlyNumbers\' | translate}} </p> </div> </div> <div class="c-receive-money__non-client-form-field field"> <label> <strong translate="emt.receiveMoneyClient.nonClientAccount.confirmAccountNumber"> </strong> </label> <input class="input" type="tel" required minlength="0" maxlength="12" pattern="\\d*" ng-change="$ctrl.onTransferDetailsFormChange()" id="ConfirmAccountNumber" name="nonClientAccountConfirmAccountNumber" ng-class="{\'warning\': $ctrl.model.forms.nonClientAccount.nonClientAccountConfirmAccountNumber.$invalid\n                     && $ctrl.model.forms.nonClientAccount.$dirty}" placeholder="{{ \'emt.receiveMoneyClient.nonClientAccount.confirmAccountNumberPlaceholder\' | translate}}" ng-model="$ctrl.model.transferDetails.nonClientAccount.confirmAccountNumber"/> <div ng-messages="$ctrl.model.forms.nonClientAccount.nonClientAccountConfirmAccountNumber.$error" ng-show="$ctrl.model.forms.nonClientAccount.$dirty" class="field__error"> <p ng-message="required"> {{\'emt.validation.isRequired\' | translate}} </p> <p ng-message="maxlength"> {{\'emt.validation.tooLong\' | translate}} </p> <p ng-message="minlength"> {{\'emt.validation.tooShort\' | translate}} </p> <p ng-message="pattern"> {{\'emt.validation.onlyNumbers\' | translate}} </p> </div> </div> <p class="body c-receive-money__non-client-transfer-duration-notice" translate="emt.receiveMoneyClient.nonClientAccount.transferDurationNote"> </p> <p class="body--4 margin__tb--fix2" translate="emt.receiveMoneyClient.nonClientAccount.transferDurationDescription"> </p> </form> </div> </div> <div class="c-receive-money__transfer-details-sidebar" ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.standard)"> <div class="c-receive-money__transfer-details-instructions"> <h5 class="heading--sub2" translate="emt.receiveMoneyClient.findingYourTransit"></h5> <p class="body--4 margin__t--fix1" translate="emt.receiveMoneyClient.yourTransitCanBeFound"></p> <div class="c-receive-money__image"> <img ng-src="{{ \'global.chequeReceivingImage\' | translate}}" alt="{{ ::(\'emt.receiveMoneyClient.findingYourTransit\' | translate) }}"> </div> <p class="body--4"> <strong translate="emt.receiveMoneyClient.accountNumberCanVary"></strong> </p> </div> <div class="c-receive-money__transfer-details-instructions"> <p class="body--4" translate="emt.receiveMoneyClient.pleaseContactExternalInstitution"></p> </div> </div> </div> <div class="grid__container" ng-if="!$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.standard) && $ctrl.isSelectedAccountRegistered()"> {{ \'emt.receiveMoneyClient.registeredLimit\' | translate}} </div> <div class="grid__container c-receive-money__autoaccept" ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.client) && !$ctrl.isSelectedAccountRegistered()"> <div class="c-receive-money__autoaccept-text"> <h3 class="heading--sub margin__tb--fix2" translate="emt.receiveMoneyClient.transferAutoAccept"> </h3> <p class="body--2" translate="emt.receiveMoneyClient.transferAutoAcceptDescription"> </p> <label class="body"> {{ \'emt.receiveMoneyClient.transferAutoAcceptLabel\'| translate}} {{$ctrl.model.transferDetails.senderFullName}}? </label> <form id="autoAcceptForm" action="" class="grid__container margin__tb--rel1"> <div class="field c-receive-money__radio-field"> <input id="transferAutoAccept-yes" value="yes" required ng-model="$ctrl.model.transferDetails.autoAccept" ng-change="$ctrl.onTransferDetailsFormChange()" name="transferAutoAccept" class="input input--tangerine-radio" type="radio"/> <label for="transferAutoAccept-yes" translate="emt.receiveMoneyClient.yes"></label> </div> <div class="field c-receive-money__radio-field"> <input id="transferAutoAccept-no" value="no" required ng-model="$ctrl.model.transferDetails.autoAccept" ng-change="$ctrl.onTransferDetailsFormChange()" name="transferAutoAccept" class="input input--tangerine-radio" type="radio"/> <label for="transferAutoAccept-no" translate="emt.receiveMoneyClient.no"></label> </div> </form> <span class="body--3 margin__tb--fix2" translate="emt.receiveMoneyClient.transferAutoAcceptNote"></span> </div> <div class="c-receive-money__autoaccept-image"> <i class="c-receive-money__autoaccept-icon icon-tangerine-handshake"></i> </div> </div> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.REVIEW"> <div class="c-receive-money__form-container margin__t--fix2"> <div class="c-error-message panel margin__tb--fix2" ng-if="$ctrl.model.errors.return_code"> {{\'global.errorCodes.\' + $ctrl.model.errors.return_code | translate }} </div> <div class="c-emt-page__form"> <div class="c-receive-money__details-panel panel"> <label class="c-receive-money__details-panel-label" translate="emt.receiveMoneyClient.amount" for=""> </label> <h4 class="c-receive-money__details-panel-amount">{{ $ctrl.model.transferDetails.transferAmount | currency }}</h4> </div> <div class="c-receive-money__details-panel panel"> <label class="c-receive-money__details-panel-label" translate="emt.receiveMoneyClient.from" for=""> </label> <h4 class="c-receive-money__details-panel-name" ng-bind="$ctrl.model.transferDetails.senderFullName"></h4> <h5 class="c-receive-money__details-panel-email" ng-bind="$ctrl.model.transferDetails.senderEmail"></h5> </div> <div class="c-receive-money__details-panel panel" ng-if="$ctrl.model.transferDetails.message"> <label translate="emt.receiveMoneyClient.message" class="c-receive-money__details-panel-label" for=""> </label> <h2 class="c-receive-money__details-panel-message" ng-bind="$ctrl.model.transferDetails.message"></h2> </div> <tng-tile-list ng-if="$ctrl.accountsToDepositTo" tile-data="$ctrl.model.transferDetails.selectedAccountToDisplay" all-actionable="true" on-tile-click="$ctrl.flowService.gotoPreviousState()" tile-type="$ctrl.tileListConstants.TILE_TYPE.account"> </tng-tile-list> <div class="c-receive-money__details-panel panel" ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.standard)"> <label translate="emt.receiveMoneyClient.transferTo" class="c-receive-money__details-panel-label" for=""> </label> <h4 class="heading--sub2">{{$ctrl.model.transferDetails.fullAccountDisplayName}}</h4> <h5 class="body--4">{{$ctrl.model.transferDetails.financial_institution.name}}</h5> <h5 class="body--4">{{$ctrl.model.transferDetails.financial_institution.address}}</h5> </div> <div class="c-receive-money__details-panel margin__tb--fix1 panel" ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.client) && $ctrl.model.transferDetails.autoAccept"> <a actionable-id="receive-money-goto_prev_state" href="" ng-click="$ctrl.flowService.gotoPreviousState()"> <label class="c-receive-money__details-panel-label" translate="emt.receiveMoneyClient.autoAccept" for=""> </label> <h2 class="c-receive-money__details-panel-message"> {{ \'emt.receiveMoneyClient.\' + $ctrl.model.transferDetails.autoAccept | translate }} </h2> </a> </div> </div> </div> </div> <div class="c-receive-money__terms-conditions-component" ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.interac)\n         && ($ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW || $ctrl.flowService.currentState === $ctrl.flowService.STATES.ACCEPT_TERMS_AND_CONDITIONS)"> <emt-terms-and-conditions term-state="$ctrl.flowService.currentState === $ctrl.flowService.STATES.ACCEPT_TERMS_AND_CONDITIONS" review-state="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW" is-type-interac="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.interac)" accepted-terms-flag="$ctrl.model.transferDetails.acceptedTandC" parent-controller="$ctrl"> </emt-terms-and-conditions> </div> <div id="printMe" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.CONFIRMATION"> <div class="c-emt-page__form"> <p class="margin__tb--fix2" ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.interac)" translate>{{::\'emt.receiveMoneyClient.interacAutoDepositOptionText\'}}</p> <p class="margin__tb--fix2" ng-if="!$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.interac)" translate="emt.receiveMoneyClient.tangerineWeveDepositedYourTransfer"></p> </div> <div class="c-balance-grid"> <div class="c-receive-money__grid-table-first-row grid__container"> <div class="c-receive-money__confirmation-number-column"> {{ \'emt.receiveMoneyClient.confirmationNumber\' | translate }}: <span class="c-receive-money__confirmation-number" ng-bind="$ctrl.model.summary.confirmationNumber"> </span> </div> <div class="c-receive-money__transfer-date-column"> <span> {{\'emt.receiveMoneyClient.transferReceivedOn\' | translate }}: <span class="c-receive-money__transfer-date"> {{ $ctrl.formatDateForDisplay($ctrl.model.summary.date) }} {{\'emt.receiveMoneyClient.at\' | translate }} {{ $ctrl.formatTimeForDisplay($ctrl.model.summary.date) }} </span> </span> </div> </div> <div class="c-balance-grid__table"> <div class="c-balance-grid__table__table-column-top"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title" translate="emt.receiveMoneyClient.from"> </p> <p class="c-balance-grid__value" ng-bind="$ctrl.model.transferDetails.senderFullName"> </p> </div> </div> <div class="c-balance-grid__table__table-column-top--has-borders"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title" translate="emt.receiveMoneyClient.amount"> </p> <p class="c-balance-grid__value"> {{ $ctrl.model.transferDetails.transferAmount | currency }} </p> </div> </div> <div class="c-balance-grid__table__table-column-top"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title" ng-if="!$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.standard)"> {{::\'emt.receiveMoneyClient.newBalance\'|translate}} <br/><strong>{{::$ctrl.model.transferDetails.selectedAccount.payFromAccountNickNameNum}}</strong> </p> <p class="c-balance-grid__value" ng-if="!$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.standard)"> {{ $ctrl.model.summary.newBalance | currency }} </p> <p class="c-balance-grid__title" ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.standard)" translate="emt.receiveMoneyClient.toAccount"> </p> <p class="c-balance-grid__value c-balance-grid__value--account" ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.standard)"> {{$ctrl.model.transferDetails.fullAccountDisplayName}} </p> </div> </div> </div> </div> <p> <tng-print-button button-class="btn btn--orange margin__tb margin__tb--fix2" only-element="\'printMe\'"> {{ ::\'emt.receiveMoneyClient.print\' | translate }} </tng-print-button> </p> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.DECLINE"> <div class="c-emt-page__form"> <div class="c-error-message panel margin__tb--fix2" ng-if="$ctrl.model.errors.return_code"> {{\'global.errorCodes.\' + $ctrl.model.errors.return_code | translate }} </div> <p class="margin__tb--fix2" translate="emt.receiveMoneyClient.areYouSureYouWantToDecline"></p> </div> <div class="c-emt-page__form-container margin__t--fix2"> <div class="c-emt-page__form"> <div class="c-receive-money__details-panel panel"> <label class="c-receive-money__details-panel-label" translate="emt.receiveMoneyClient.amount" for=""> </label> <h4 class="c-receive-money__details-panel-amount">{{ $ctrl.model.transferDetails.transferAmount | currency }}</h4> </div> <div class="c-receive-money__details-panel panel"> <label class="c-receive-money__details-panel-label" translate="emt.receiveMoneyClient.from" for=""> </label> <h4 class="c-receive-money__details-panel-name" ng-bind="$ctrl.model.transferDetails.senderFullName"></h4> <h5 class="c-receive-money__details-panel-email" ng-bind="$ctrl.model.transferDetails.senderEmail"></h5> </div> <div class="c-receive-money__details-panel panel" ng-if="$ctrl.model.transferDetails.message"> <label translate="emt.receiveMoneyClient.message" class="c-receive-money__details-panel-label" for=""> </label> <h2 class="c-receive-money__details-panel-message" ng-bind="$ctrl.model.transferDetails.message"></h2> </div> </div> </div> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.DECLINED"> <div class="c-emt-page__form"> <p class="margin__tb--fix2" translate="emt.receiveMoneyClient.youHaveDeclinedToReceiveTransfer"></p> </div> <div class="c-balance-grid c-receive-money__decline_balance_grid"> <div class="c-balance-grid__table"> <div class="c-balance-grid__table__table-column-top"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title" translate="emt.receiveMoneyClient.amount"> </p> <p class="c-balance-grid__value"> {{ $ctrl.model.transferDetails.transferAmount | currency }} </p> </div> </div> <div class="c-balance-grid__table__table-column-top--has-borders"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title" translate="emt.receiveMoneyClient.from"> </p> <p class="c-balance-grid__value" ng-bind="$ctrl.model.transferDetails.senderFullName"> </p> </div> </div> </div> </div> </div> <div class="c-emt-page__form-container" ng-if="::($ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.interac))"> <img ng-src="{{::\'assets/images/logo_interac_\' + $ctrl.shortHandLocale + \'.png\'}}" class="c-receive-money__interac-logo" alt="Interac"> <span class="c-receive-money__interac-trademark" translate="emt.receiveMoneyClient.interacTrademark"></span> </div> </div> <div class="c-emt-page__controls" ng-show="!$ctrl.model.shouldShowLoader"> <div class="c-emt-page__emt-footer flow-footer"> <div class="c-emt-page__controls-content"> <tng-page-flow-controls flow-service="$ctrl.flowService"> </tng-page-flow-controls> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(33)),a=c(n(8)),s=c(n(0)),r=c(n(2)),o=c(n(45));function c(t){return t&&t.__esModule?t:{default:t}}var l={client:"CLIENT",standard:"STANDARD",interac:"INTERAC"},u={SUCCESS:"SUCCESS"},d="yes",h="no",f={EMT_VALIDATION_FAILED_ACCESS_CODE:"EMT_VALIDATION_FAILED_ACCESS_CODE",INVALID_TRANSFERID_ANSWER:"INVALID_TRANSFERID_ANSWER",SUCCESS:"SUCCESS",VALIDATION_ERROR:"VALIDATION_ERROR"},p=function(){function t(e,n,i,a,r,o,c,d,h,f,p,g,m,_,v,S,T,y,E,A){(0,s.default)(this,t),this.$q=e,this.CredentialsTPWService=y,this.$log=n,this.$window=i,this.flowService=a,this.TRANSFER_TYPE=v.TRANSFER_TYPE,this.ReceiveMoneyService=r,this.tileListConstants=o,this.$stateParams=c,this.$state=h,this.$translate=f,this.shortHandLocale=p.SHORTHAND_LOCALE[d.locale],this.RECEIVE_MONEY_TYPES=l,this.INSTITUTION_VALIDATION_RESPONSES=u,this.SessionService=g,this.stateConstants=m,this.serviceConstants=_,this.CustomersService=S,this.EnvironmentService=T,this.DateService=E,this.accountHelpersService=A}return(0,r.default)(t,[{key:"postMoveTo",value:function(){this.flowService.currentState===this.flowService.STATES.ANSWER_QUESTION&&(this.flowService.isForeignInstitution||!0!==this.model.transferDetails.acceptedTandC&&this._getEmtDetails())}},{key:"$onInit",value:function(){var t=this;this.isRedirecting=!1,this.flowService.activate(),this.flowService.onConfirmDecline=this._declineTransfer.bind(this),this.flowService.onDeclineButtonClick=this._onDeclineButtonClick.bind(this),this.flowService.onAccept=this._accept.bind(this),this.flowService.onDoneButtonClick=this._redirectToAccountSummary.bind(this),this.flowService.onNextButtonClick=this._onNextButtonClick.bind(this),this.flowService.onCancelButtonClick=this._onCancelButtonClick.bind(this),this.flowService.postMoveTo=this.postMoveTo.bind(this),this._initializeFormsAndModel(),this._initializeStateVariables(),this.isType(this.RECEIVE_MONEY_TYPES.standard)?(this.flowService.isForeignInstitution=!0,this.$log.debug("Initializing EMT marketing campaign"),this.flowService.onDoneButtonClick=this._redirectToEmtMarketingPage.bind(this),this.$stateParams.lastName&&this.model.transferAuthentication.senderLastName!==this.$stateParams.lastname&&(this.model.transferAuthentication.senderLastName=this.$stateParams.lastName),this.emtId&&this.model.transferAuthentication.senderLastName&&(this._resetError(),this._validateLastnameCode().then((function(){t.model.errors||t.flowService.gotoNextState()})))):(this.flowService.isForeignInstitution=!1,this.flowService.moveToWithoutExitWarning(this.flowService.STATES.ANSWER_QUESTION),this._fetchAccounts())}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"isType",value:function(t){return this.type===t}},{key:"onFormChange",value:function(t){this.model.forms[t]&&(t===this.forms.transferAuthentication&&(this.flowService.isForeignInstitution=!this.model.transferAuthentication.depositIntoTangerineAccount),this.flowService.BUTTONS.BTN_ORG.disable=!this.model.forms[t].$valid||this.isAnswerQuestionDisabled)}},{key:"onTransferDetailsFormChange",value:function(){if(this.$log.debug("changed transfer details form",this.model.transferDetails.nonClientAccount),this.flowService.isForeignInstitution)return this.model.transferDetails.fullAccountDisplayName=[this.model.transferDetails.nonClientAccount.transitNumberBranch,this.model.transferDetails.nonClientAccount.institutionNumberBank,this.model.transferDetails.nonClientAccount.confirmAccountNumber].join("-"),void(this.flowService.BUTTONS.BTN_ORG.disable=!(this.model.forms.nonClientAccount.$valid&&this.model.transferDetails.isFinancialInstitutionValid));this.flowService.BUTTONS.BTN_ORG.disable=this.isType(this.RECEIVE_MONEY_TYPES.client)?!this.getSelectedAccount()&&!this.model.forms.transferDetails.$valid:!this.getSelectedAccount()}},{key:"onAccountTileClick",value:function(t,e){this.model.transferDetails.selectedAccount=[e],this.model.transferDetails.selectedAccountToDisplay=[(0,a.default)({tileDescription:this.$translate.instant("emt.receiveMoneyClient.transferTo")},e)],this.model.transferDetails.selectedAccount.payFromAccountNickName=this.accountHelpersService.getDisplayNameInstant(e),this.model.transferDetails.selectedAccount.payFromAccountNickNameNum=this.getNickNameWithNum(this.model.transferDetails.selectedAccount.payFromAccountNickName,e.display_name),this.onTransferDetailsFormChange()}},{key:"getNickNameWithNum",value:function(t,e){var n=e.length,i=n-4,a=n,s="***".concat(e.slice(i,a));return t.concat("  ").concat(s)}},{key:"shouldDisplayInvalidInstitutionError",value:function(){return!this.model.transferDetails.isFinancialInstitutionValid}},{key:"checkFinancialInstitutionValidity",value:function(){var t=this;this.model.transferDetails.nonClientAccount.transitNumberBranch&&this.model.transferDetails.nonClientAccount.institutionNumberBank&&(this.model.transferDetails.checkingValidity=!0,this.ReceiveMoneyService.validateFinancialInstitution(this.model.transferDetails.nonClientAccount.transitNumberBranch,this.model.transferDetails.nonClientAccount.institutionNumberBank).then((function(e){if(t.$log.debug("received validity response",e),t.model.transferDetails.checkingValidity=!1,e.response_status.status_code!==t.INSTITUTION_VALIDATION_RESPONSES.SUCCESS)return t.model.errors=e.response_status,void(t.model.transferDetails.isFinancialInstitutionValid=!1);t._resetError(),t.model.transferDetails.isFinancialInstitutionValid=!0,t.model.transferDetails.financial_institution=e.financial_institution}),(function(e){t.$log.error(e),t.model.transferDetails.checkingValidity=!1,t.model.transferDetails.isFinancialInstitutionValid=!1,t.onTransferDetailsFormChange()})))}},{key:"_initializeFormsAndModel",value:function(){var t,e;this.forms={transferAuthentication:"transferAuthentication",answerQuestion:"answerQuestion",transferDetails:"transferDetails",summary:"summary"},this.model=(e={},(0,i.default)(e,this.forms.transferAuthentication,{senderLastName:"",depositIntoTangerineAccount:!1}),(0,i.default)(e,this.forms.answerQuestion,{answer:""}),(0,i.default)(e,this.forms.transferDetails,{senderFullName:"",senderEmail:"",message:"",transferAmount:0,selectedAccount:[],checkingValidity:!1,nonClientAccount:{},isFinancialInstitutionValid:!0,autoAccept:h,acceptedTandC:!1}),(0,i.default)(e,this.forms.summary,{newBalance:null,confirmationNumber:null,date:null}),(0,i.default)(e,"question",""),(0,i.default)(e,"shouldShowLoader",!1),(0,i.default)(e,"forms",(t={},(0,i.default)(t,this.forms.transferAuthentication,{}),(0,i.default)(t,this.forms.answerQuestion,{}),(0,i.default)(t,this.forms.transferDetails,{}),(0,i.default)(t,this.forms.summary,{}),(0,i.default)(t,"nonClientAccount",{$valid:!1}),t)),e)}},{key:"_getAutoAccept",value:function(){return this.isType(this.RECEIVE_MONEY_TYPES.client)&&!this.getSelectedAccount().registered&&this.model.transferDetails.autoAccept===d}},{key:"getSelectedAccount",value:function(){return this.model.transferDetails.selectedAccount.length>0?this.model.transferDetails.selectedAccount[0]:void 0}},{key:"isSelectedAccountRegistered",value:function(){var t=this.getSelectedAccount();return!t||t.registered}},{key:"_fetchAccounts",value:function(){var t=this;this.ReceiveMoneyService.getAccountsListForTransfer().then((function(e){t.accountsToDepositTo=e.toAccounts,t.flowService.showWarning()}),(function(e){t.$log.debug("error fetching accounts",e)}))}},{key:"_initializeStateVariables",value:function(){this.type=this.RECEIVE_MONEY_TYPES[this.$stateParams.type],this.emtId=this.$stateParams.emtId}},{key:"_getEmtDetails",value:function(){var t=this;this.isAnswerQuestionDisabled||this.isAnswerQuestionErrorRetry||(this.model.shouldShowLoader=!0,this.ReceiveMoneyService.getTransferDetails(this.emtId,this.model.transferAuthentication.senderLastName,{isStandard:!1}).then((function(e){var n=e.emt,i=e.response_status;if(t.model.shouldShowLoader=!1,i&&-1!==[f.VALIDATION_ERROR,t.serviceConstants.STATUS_CODES.SYSTEM_ERROR].indexOf(i.status_code))return t.model.errors=i,t.flowService.BUTTONS.BTN_GRY.disable=!1,void(t.flowService.BUTTONS.BTN_ORG.disable=!0);t._resetError(),(0,a.default)(t.model.transferDetails,{senderEmail:n.sender_email,transferAmount:n.amount,senderFullName:[n.sender_first_name,n.sender_last_name].join(" "),message:n.message,acceptedTandC:!0}),n.type===t.TRANSFER_TYPE.INTERAC_EMT&&(0,a.default)(t.model.transferDetails,{acceptedTandC:n.accepted_terms_and_conditions}),n.type===t.TRANSFER_TYPE.INTERAC_EMT&&!1===n.accepted_terms_and_conditions?t.flowService.moveTo(t.flowService.STATES.ACCEPT_TERMS_AND_CONDITIONS):n.question||t.flowService.moveTo(t.flowService.STATES.TRANSFER_DETAILS),t.model.question=n.question})).catch((function(e){t.model.shouldShowLoader=!1,t.model.errors="generic",t.$log.error("error getting emt details",e)})))}},{key:"_createSession",value:function(){return this.CredentialsTPWService.metroGet("displayLogin",{locale:this.SessionService.locale},{bypassRedirect:!0},"InitialTangerine.html")}},{key:"_validateLastnameCode",value:function(){var t=this,e=this.$q.defer(),n=function(){t.ReceiveMoneyService.getTransferDetails(t.emtId,t.model.transferAuthentication.senderLastName,{isStandard:!0}).then((function(n){var i=n.emt,s=n.response_status;t.model.shouldShowLoader=!1,s.return_code===f.EMT_VALIDATION_FAILED_ACCESS_CODE?(t.flowService.moveBackTo(t.flowService.STATES.TRANSFER_AUTHENTICATION),t.model.errors=s,t.flowService.BUTTONS.BTN_GRY.disable=!0,t.flowService.BUTTONS.BTN_ORG.disable=!0):((0,a.default)(t.model.transferDetails,{senderEmail:i.sender_email,transferAmount:i.amount,senderFullName:[i.sender_first_name,i.sender_last_name].join(" "),message:i.message}),t.model.question=i.question),e.resolve()})).catch((function(n){t.model.shouldShowLoader=!1,t.model.errors="generic",t.$log.error("error getting emt details",n),e.reject()}))};return this.model.shouldShowLoader=!0,this.SessionService.isAuthenticated()?n():this._createSession().then((function(){n()})).catch((function(){e.reject()})),e.promise}},{key:"shouldHideControlsForInvalidEMTDetails",value:function(){return this.flowService.currentState===this.flowService.STATES.ANSWER_QUESTION&&!!this.model.errors&&this.model.errors.return_code===f.EMT_VALIDATION_FAILED_ACCESS_CODE}},{key:"_accept",value:function(){this.model.shouldShowLoader=!0,this.flowService.currentState===this.flowService.STATES.ACCEPT_TERMS_AND_CONDITIONS?this._acceptInteracTermsAndCondition():this.flowService.isForeignInstitution?this._acceptNoneTangerineTransfer():this.model.transferDetails.acceptedTandC&&!this.isType(this.RECEIVE_MONEY_TYPES.interac)?this._acceptTangerineTransfer():this._acceptInteracTransferWithConsent()}},{key:"_acceptTangerineTransfer",value:function(){var t=this;return this.ReceiveMoneyService.acceptClientTransfer(this._composeAcceptTransferParams(),this.emtId,this.getSelectedAccount().number).then((function(e){return t._transferAcceptHandler({addBalanceToSummary:!0})(e)})).catch((function(e){return t._transferErrorHandler(e)})).finally((function(){t.model.shouldShowLoader=!1}))}},{key:"_acceptInteracTermsAndCondition",value:function(){var t=this;return this.CustomersService.putCustomerConsents({alias:this.EnvironmentService._platformInfo.platform||"Not Applicable",consent:{name:this.RECEIVE_MONEY_TYPES.interac,value:"Y"}}).then((function(){t.model.transferDetails.acceptedTandC=!0,t.model.shouldShowLoader=!1,t.flowService.moveTo(t.flowService.STATES.ANSWER_QUESTION)})).catch((function(e){t._transferErrorHandler(e),t.model.shouldShowLoader=!1}))}},{key:"_acceptInteracTransferWithConsent",value:function(){var t=this;return this.ReceiveMoneyService.acceptClientTransfer(this._composeAcceptTransferParams(),this.emtId,this.getSelectedAccount().number).then((function(e){return t._transferAcceptHandler({addBalanceToSummary:!0})(e)})).catch((function(e){return t._transferErrorHandler(e)})).finally((function(){t.model.shouldShowLoader=!1}))}},{key:"_acceptNoneTangerineTransfer",value:function(){var t=this;this.ReceiveMoneyService.acceptTransfer(this._composeAcceptTransferParams(),this.emtId).then((function(e){return t._transferAcceptHandler({addBalanceToSummary:!1})(e)})).catch((function(e){return t._transferErrorHandler(e)})).finally((function(){t.model.shouldShowLoader=!1}))}},{key:"_transferErrorHandler",value:function(t){this.model.errors=t,this.flowService.moveTo(this.flowService.STATES.ANSWER_QUESTION),this.$log.error("EMT: service error",t)}},{key:"_resetError",value:function(){this.model.errors=void 0}},{key:"_transferAcceptHandler",value:function(t){var e=this,n=t.addBalanceToSummary,i=void 0!==n&&n;return function(t){if(t.response_status&&-1!==[f.INVALID_TRANSFERID_ANSWER,f.VALIDATION_ERROR,e.serviceConstants.STATUS_CODES.SYSTEM_ERROR].indexOf(t.response_status.status_code))e.model.errors=t.response_status;else{e._resetError(),e.flowService.gotoNextState();var n=[{confirmationNumber:t.confirmation_number,date:(0,o.default)().toDate()}];i&&n.push({newBalance:e.getSelectedAccount().account_balance+e.model.transferDetails.transferAmount}),a.default.apply(Object,[e.model.summary].concat(n))}}}},{key:"_declineTransfer",value:function(){return this.model.shouldShowLoader=!0,this.flowService.isForeignInstitution?this._declineStandardTransfer():this._declineClientTransfer()}},{key:"_declineClientTransfer",value:function(){var t=this;this.ReceiveMoneyService.declineClientTransfer({answer:this.model.answerQuestion.answer},this.emtId).then((function(e){e.response_status&&-1!==[f.INVALID_TRANSFERID_ANSWER,f.VALIDATION_ERROR,t.serviceConstants.STATUS_CODES.SYSTEM_ERROR].indexOf(e.response_status.status_code)?t.model.errors=e.response_status:(t._resetError(),t.flowService.gotoNextState())})).catch((function(e){t._transferErrorHandler(e)})).finally((function(){t.model.shouldShowLoader=!1}))}},{key:"_declineStandardTransfer",value:function(){var t=this;this.ReceiveMoneyService.declineTransfer(this.model.answerQuestion.answer,this.emtId).then((function(e){e.response_status&&-1!==[f.INVALID_TRANSFERID_ANSWER,f.VALIDATION_ERROR,t.serviceConstants.STATUS_CODES.SYSTEM_ERROR].indexOf(e.response_status.status_code)?t.model.errors=e.response_status:(t._resetError(),t.flowService.gotoNextState())})).catch((function(e){t._transferErrorHandler(e)})).finally((function(){t.model.shouldShowLoader=!1}))}},{key:"_composeAcceptTransferParams",value:function(){return this.flowService.isForeignInstitution?{answer:this.model.answerQuestion.answer,transit_number:this.model.transferDetails.nonClientAccount.transitNumberBranch,institution_id:this.model.transferDetails.nonClientAccount.institutionNumberBank,account_number:this.model.transferDetails.nonClientAccount.accountNumber,confirm_account_number:this.model.transferDetails.nonClientAccount.confirmAccountNumber}:{validate_only:!1,auto_accept:this._getAutoAccept(),answer:this.model.answerQuestion.answer}}},{key:"_composeValidateTransferParams",value:function(){return{validate_only:!0,answer:this.model.answerQuestion.answer}}},{key:"_validateAnswer",value:function(){var t=this;return this.model.shouldShowLoader=!0,this.ReceiveMoneyService.validateAnswer(this._composeValidateTransferParams(),this.emtId,this.flowService.isForeignInstitution).then((function(e){return t._validateAnswerHandler(e)})).catch((function(e){return t._transferErrorHandler(e)})).finally((function(){t.model.shouldShowLoader=!1}))}},{key:"_validateAnswerHandler",value:function(t){t.response_status&&t.response_status.return_code&&-1!==["IEMT_CP100","EMT_VALIDATION_FAILED_EMAIL_ANSWER"].indexOf(t.response_status.return_code)?(this.model.errors=t.response_status,this.flowService.moveTo(this.flowService.STATES.ANSWER_QUESTION)):t.response_status.status_code===this.serviceConstants.STATUS_CODES.SUCCESS?this._resetError():(this.model.errors=t.response_status,this.flowService.moveTo(this.flowService.STATES.ANSWER_QUESTION),this.flowService.BUTTONS.BTN_GRY.disable=!1,this.flowService.BUTTONS.BTN_ORG.disable=!0)}},{key:"_redirectToAccountSummary",value:function(){this.flowService.hideWarning(),this.isRedirecting=!0,this.$state.go(this.stateConstants.ACCOUNT_SUMMARY)}},{key:"_redirectToEmtMarketingPage",value:function(){var t=this.EnvironmentService.getBaseUrl()+"/"+this.$translate.instant("emt.campaignUrl");this.flowService.hideWarning(),this.$log.debug("EMT Marketing campaign , Redirecting to  "+t),this.$window.location.href=t}},{key:"updateAcceptButton",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=!this.interacAgreementConfirmation}},{key:"_onDeclineButtonClick",value:function(){this._resetError()}},{key:"_onNextButtonClick",value:function(){this.flowService.currentState===this.flowService.STATES.TRANSFER_AUTHENTICATION&&(this.flowService.isForeignInstitution?this._validateLastnameCode():this.$state.go(this.stateConstants.EMT_RECEIVE_MONEY_CLIENT,{type:this.RECEIVE_MONEY_TYPES.client,emtId:this.emtId,lastName:this.model.transferAuthentication.lastName,locale:this.SessionService.locale},{reload:!0})),this.flowService.currentState===this.flowService.STATES.ANSWER_QUESTION&&this._validateAnswer()}},{key:"_onCancelButtonClick",value:function(){this.flowService.currentState===this.flowService.STATES.DECLINE?this.flowService.gotoPreviousState():this.SessionService.isAuthenticated()?this.$state.go(this.stateConstants.ACCOUNT_SUMMARY):this.$window.location="/"}},{key:"formatDateForDisplay",value:function(t){return this.DateService.convertToFormattedNonUTCMonthDayYear(t)}},{key:"formatTimeForDisplay",value:function(t){return this.DateService.formatMomentToTimeWithLocalizedTime(t)}},{key:"goToMoneyTransferAutoDeposit",value:function(){this.flowService.hideWarning(),this.isRedirecting=!0,this.$state.go(this.stateConstants.USER_SETTINGS_MONEY_TRANSFER,{optionalComponentLoad:"INTERAC_AUTODEPOSIT"})}},{key:"isAnswerQuestionDisabled",get:function(){return!(this.flowService.currentState!==this.flowService.STATES.ANSWER_QUESTION||!this.model.errors||!this.model.errors.return_code)&&-1!==["IEMT_CP999","IEMT_CP101","EMT_VALIDATION_FAILED_EMAIL_ANSWER_INACATIVE"].indexOf(this.model.errors.return_code)}},{key:"isAnswerQuestionErrorRetry",get:function(){return!(this.flowService.currentState!==this.flowService.STATES.ANSWER_QUESTION||!this.model.errors||!this.model.errors.return_code)&&-1!==["IEMT_CP100","EMT_VALIDATION_FAILED_EMAIL_ANSWER"].indexOf(this.model.errors.return_code)}}]),t}();p.$inject=["$q","$log","$window","ReceiveMoneyFlowService","ReceiveMoneyService","tngTileListConstants","$stateParams","LocaleService","$state","$translate","localeConstants","SessionService","stateConstants","serviceConstants","emtConstants","CustomersService","EnvironmentService","CredentialsTPWService","DateService","AccountHelpersService"],e.default=p,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(177)),a=u(n(0)),s=u(n(2)),r=u(n(264)),o=u(n(266)),c=u(n(265)),l=n(364);function u(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(t,n,s,o,c,l,u,d,h){(0,a.default)(this,e);var f=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,d,l,h));return f.$state=o,f.$window=c,f.$log=t,f.stateConstants=u,f.STATES={TRANSFER_AUTHENTICATION:{titleKey:"emt.receiveMoneyClient.states.transferAuthentication"},ACCEPT_TERMS_AND_CONDITIONS:{titleKey:"emt.receiveMoneyClient.states.termsAndConditions"},ANSWER_QUESTION:{titleKey:"emt.receiveMoneyClient.states.answerQuestion"},TRANSFER_DETAILS:{titleKey:"emt.receiveMoneyClient.states.transferDetails"},REVIEW:{titleKey:"emt.receiveMoneyClient.states.review"},CONFIRMATION:{titleKey:"emt.receiveMoneyClient.states.confirmation"},DECLINE:{titleKey:"emt.declineTransfer.states.declineTransfer"},DECLINED:{titleKey:"emt.declineTransfer.states.transferDeclined"}},f._initialState=f.STATES.TRANSFER_AUTHENTICATION,f}return(0,c.default)(e,t),(0,s.default)(e,[{key:"_resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.BUTTONS={BTN_GRY:new l.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new l.ModalFooterButton(this.BUTTON_TYPES.NEXT,!0,!0),BTN_RED:new l.ModalFooterButton(this.BUTTON_TYPES.CONFIRM_DECLINE,!1,!1)}}},{key:"_updateUI",value:function(){var t=this.currentState,e=this.BUTTON_TYPES,n=this.BUTTONS,i=this.STATES;switch(n.BTN_GRY.show=!0,n.BTN_RED.show=!1,n.BTN_ORG.disable=!0,n.BTN_ORG.show=!0,t){case i.TRANSFER_AUTHENTICATION:case i.ANSWER_QUESTION:n.BTN_GRY.type=e.CANCEL,n.BTN_ORG.type=e.NEXT;break;case i.ACCEPT_TERMS_AND_CONDITIONS:n.BTN_ORG.type=e.ACCEPT,n.BTN_GRY.show=!1;break;case i.TRANSFER_DETAILS:n.BTN_GRY.type=e.DECLINE,n.BTN_ORG.type=e.NEXT;break;case i.REVIEW:n.BTN_GRY.type=e.DECLINE,n.BTN_ORG.type=e.ACCEPT,n.BTN_ORG.disable=!1;break;case i.CONFIRMATION:n.BTN_ORG.type=e.DONE,n.BTN_ORG.disable=!1,n.BTN_GRY.show=!1;break;case i.DECLINE:n.BTN_GRY.type=e.CANCEL,n.BTN_RED.type=e.CONFIRM_DECLINE,n.BTN_GRY.show=!0,n.BTN_ORG.show=!1,n.BTN_RED.show=!0;break;case i.DECLINED:n.BTN_ORG.type=e.DONE,n.BTN_ORG.disable=!1,n.BTN_GRY.show=!1,n.BTN_ORG.show=!0}}},{key:"moveToWithoutExitWarning",value:function(t){t&&(this._preMoveTo(),this.hideWarning(),this.currentState||this.$log.warn("No current state is detected. Did you initialize one in _resetState()?"),this._stateHistory.push(this.currentState),this.currentState=t,this._updateUI(),this.postMoveTo(),this._conditionalScrollToTop())}},{key:"gotoNextState",value:function(){var t=this.currentState,e=this.STATES;switch(t){case e.TRANSFER_AUTHENTICATION:this.isForeignInstitution&&this.moveTo(e.ANSWER_QUESTION);break;case e.ACCEPT_TERMS_AND_CONDITIONS:this.moveTo(e.ANSWER_QUESTION);break;case e.ANSWER_QUESTION:this.moveTo(e.TRANSFER_DETAILS);break;case e.TRANSFER_DETAILS:this.moveTo(e.REVIEW);break;case e.REVIEW:this.moveTo(e.CONFIRMATION);break;case e.CONFIRMATION:this.moveTo(e.TRANSFER_AUTHENTICATION);break;case e.DECLINE:this.moveTo(e.DECLINED);break;default:this.$log.debug("Unknown or unrecognized state:",t)}}},{key:"onButtonClick",value:function(t){switch(t.type){case this.BUTTON_TYPES.DECLINE:this.onDeclineButtonClick(),this.moveTo(this.STATES.DECLINE);break;case this.BUTTON_TYPES.CONFIRM_DECLINE:this.onConfirmDecline();break;case this.BUTTON_TYPES.ACCEPT:this.onAccept();break;case this.BUTTON_TYPES.DONE:this.onDoneButtonClick();break;case this.BUTTON_TYPES.NEXT:this.onNextButtonClick(),(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"onButtonClick",this).call(this,t);break;case this.BUTTON_TYPES.CANCEL:this.onCancelButtonClick();break;default:(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"onButtonClick",this).call(this,t)}}},{key:"_getAnalyticsID",value:function(){return"emt/receive"}}]),e}(u(n(267)).default);d.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","stateConstants","$rootScope","AnalyticsService"],e.default=d,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(8)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s){(0,a.default)(this,t),this.RequesterService=e,this.serviceConstants=n,this.$httpParamSerializer=i,this.locale=s.locale}return(0,s.default)(t,[{key:"getTransferDetails",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.RequesterService.request(n.isStandard?this.serviceConstants.AVAILABLE_SERVICES.STANDARD_EMT_GET_TRANSFER_DETAILS:this.serviceConstants.AVAILABLE_SERVICES.EMT_GET_TRANSFER_DETAILS,{urlVars:{queryString:this.$httpParamSerializer((0,i.default)({"transfer-id":t},e?{lastname:e}:{}))}})}},{key:"validateAnswer",value:function(t,e,n){return this.RequesterService.request(n?this.serviceConstants.AVAILABLE_SERVICES.ACCEPT_EMT:this.serviceConstants.AVAILABLE_SERVICES.VALIDATE_EMT_ANSWER,{urlVars:{transferId:e,"transfer-id":e},data:t})}},{key:"validateFinancialInstitution",value:function(t,e){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.VALIDATE_FINANCIAL_INSTITUTION,{urlVars:{transitNumber:t,institutionId:e,locale:this.locale}})}},{key:"getAccountsListForTransfer",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNTS_FOR_RECEIVE_EMAIL_MONEY)}},{key:"acceptTransfer",value:function(t,e){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCEPT_EMT,{data:t,urlVars:{transferId:e}})}},{key:"acceptClientTransfer",value:function(t,e,n){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCEPT_CLIENT_EMT,{data:t,urlVars:{transferId:e,accountHash:n}})}},{key:"declineClientTransfer",value:function(t,e){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.DECLINE_CLIENT_EMT,{urlVars:{transferId:e,queryString:"answer="+t.answer}})}},{key:"declineTransfer",value:function(t,e){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.DECLINE_EMT,{urlVars:{answer:t,transferId:e}})}}]),t}();o.$inject=["RequesterService","serviceConstants","$httpParamSerializer","LocaleService"],e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(5308)),a=r(n(5312)),s=r(n(5313));function r(t){return t&&t.__esModule?t:{default:t}}var o=angular.module("tangerine.emt.fulfillRequest.module",[]).component("fulfillRequestClient",i.default).component("fulfillRequestInterac",i.default).component("fulfillRequestStandard",i.default).service("FulfillRequestFlowService",a.default).service("FulfillRequestService",s.default);e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5309)),a=s(n(5310));function s(t){return t&&t.__esModule?t:{default:t}}n(5311);var r={controller:a.default,template:i.default,bindings:{returnTo:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-loading-in-progress ng-if="$ctrl.isRedirecting" class="c-loading-spinner c-request-money__spin-center"> </tng-loading-in-progress> <div class="c-request-money c-emt-page" ng-if="!$ctrl.isRedirecting"> <div ng-if="$ctrl.flowService.showConfirmExitUI"> <tng-confirm-exit confirm-title-key="global.warning.title"></tng-confirm-exit> </div> <div class="c-emt-page__loader-overlay" ng-if="$ctrl.model.shouldShowLoader"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div class="c-emt-page__content" ng-if="!$ctrl.model.shouldShowLoader && !$ctrl.flowService.showConfirmExitUI"> <h2 class="heading--sub" translate="{{$ctrl.flowService.currentState.titleKey}}"></h2> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.TRANSFER_DETAILS" class="c-request-money"> <div class="c-error-message panel margin__tb--fix2" ng-if="$ctrl.model.errors.return_code"> {{\'global.errorCodes.\' + $ctrl.model.errors.return_code | translate }} </div> <tng-warning-message ng-if="$ctrl.warnings.length > 0"> <ul> <li ng-repeat="warning in $ctrl.warnings">{{ warning }}</li> </ul> </tng-warning-message> <div class="c-emt-page__form-container margin__t--fix2" ng-if="$ctrl.model.transferDetails.transferAmount > 0"> <div class="c-emt-page__form-container margin__t--fix2"> <p class="fb2-title c-request-money__details-panel-name" ng-bind-html="\'emt.fulfillRequest.requestDetailsFrom\' | translate:{\n              fullName: $ctrl.model.transferDetails.senderFullName,\n              requestedAmount: $ctrl.model.transferDetails.transferAmount\n            }"> </p> <div> <div class="panel c-request-money__details-panel--amount"> <label class="c-request-money__details-panel-label" translate="emt.fulfillRequest.amount" for=""> </label> <h4 class="c-request-money__details-panel-amount">{{ $ctrl.model.transferDetails.transferAmount | currency }}</h4> </div> <div class="c-request-money__details-panel panel"> <label translate="emt.fulfillRequest.from" class="c-request-money__details-panel-label" for=""> </label> <h4 class="c-request-money__details-panel-name" ng-bind="$ctrl.model.transferDetails.senderFullName"></h4> <h5 class="c-request-money__details-panel-email" ng-bind="$ctrl.model.transferDetails.senderEmail"></h5> </div> <div class="c-request-money__details-panel panel"> <label class="c-request-money__details-panel-label" translate="emt.fulfillRequest.message" for=""> </label> <h2 class="c-request-money__details-panel-message" ng-bind="$ctrl.model.transferDetails.message"></h2> </div> <div class="c-request-money__details-panel panel"> <label class="c-request-money__details-panel-label" translate="emt.fulfillRequest.invoiceInfo" for=""> </label> <h2 class="c-request-money__details-panel-message" ng-bind="$ctrl.model.transferDetails.invoiceInfo"></h2> </div> <div class="c-request-money__details-panel panel"> <label class="c-request-money__details-panel-label" translate="emt.fulfillRequest.invoiceDueDate" for=""> </label> <h2 class="c-request-money__details-panel-message" ng-bind="$ctrl.formatDate($ctrl.model.transferDetails.invoiceDueDate)"></h2> </div> </div> <div class="c-request-money__bottom-panel-section"> <p class="fb2-title" ng-bind-html="\'emt.fulfillRequest.requestExpiryMessage\' | translate:{\n              expiryDate: $ctrl.formatDateForDisplay($ctrl.model.transferDetails.expiryDate)\n            }"> </p> </div> <div class="c-request-money__deposit-to-section" ng-if="$ctrl.fromAccounts && $ctrl.fromAccounts.length > 0"> <p class="fb2-title" translate="emt.fulfillRequest.chooseAccountFrom"></p> <tng-tile-list class="c-tile--flex c-tile--md" on-tile-click="$ctrl.onAccountTileClick(index, tileData)" all-actionable="true" tile-data="$ctrl.fromAccounts" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" single-select="true" all-actionable="true" selected-tiles="$ctrl.model.transferDetails.selectedAccount"> </tng-tile-list> </div> </div> </div> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.REVIEW"> <div class="c-emt-page__form-container"> <div class="c-error-message panel margin__tb--fix2" ng-if="$ctrl.model.errors.return_code"> {{\'global.errorCodes.\' + $ctrl.model.errors.return_code | translate }} </div> <div class="c-request-money__review-title-section"> <p class="fb2-title c-request-money__details-panel-name" ng-bind-html="\'emt.fulfillRequest.reviewDetails\' | translate:{\n                requestedAmount: $ctrl.model.transferDetails.transferAmount,\n                fullName: $ctrl.model.transferDetails.senderFullName,\n                accountDisplayName:$ctrl.model.transferDetails.payFromAccountNickNameNum\n              }"> </p> </div> <div class="c-emt-page__form"> <div class="panel c-request-money__details-panel--amount"> <label class="c-request-money__details-panel-label" translate="emt.fulfillRequest.amount" for=""> </label> <h4 class="c-request-money__details-panel-amount">{{ $ctrl.model.transferDetails.transferAmount | currency }}</h4> </div> <tng-tile-list ng-if="$ctrl.fromAccounts" tile-data="$ctrl.model.transferDetails.selectedAccountToDisplay" all-actionable="true" on-tile-click="$ctrl.gotoPreviousState()" tile-type="$ctrl.tileListConstants.TILE_TYPE.account"> </tng-tile-list> <div class="c-request-money__details-panel panel"> <label class="c-request-money__details-panel-label" translate="emt.fulfillRequest.reviewSendTo" for=""> </label> <h4 class="c-request-money__details-panel-name" ng-bind="$ctrl.model.transferDetails.senderFullName"></h4> <h5 class="c-request-money__details-panel-email" ng-bind="$ctrl.model.transferDetails.senderEmail"></h5> </div> <div class="c-request-money__details-panel panel"> <label translate="emt.fulfillRequest.reviewMessage" class="c-request-money__details-panel-label" for=""> </label> <h2 class="c-request-money__details-panel-message" ng-bind="$ctrl.model.transferDetails.message"></h2> </div> <div class="c-request-money__details-panel margin__tb--fix1 panel" ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.client) && $ctrl.model.transferDetails.autoAccept"> <a actionable-id="request-money-goto_prev_state" href="" ng-click="$ctrl.flowService.gotoPreviousState()"> <label class="c-request-money__details-panel-label" translate="emt.fulfillRequest.autoAccept" for=""> </label> <h2 class="c-request-money__details-panel-message"> {{ \'emt.fulfillRequest.\' + $ctrl.model.transferDetails.autoAccept | translate }} </h2> </a> </div> </div> </div> </div> <div ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.interac) && $ctrl.flowService.currentState == $ctrl.flowService.STATES.REVIEW"> <emt-terms-and-conditions term-state="$ctrl.flowService.currentState === $ctrl.flowService.STATES.ACCEPT_TERMS_AND_CONDITIONS" review-state="true" is-type-interac="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.interac)" accepted-terms-flag="$ctrl.model.transferDetails.acceptedTandC" parent-controller="$ctrl"> </emt-terms-and-conditions> </div> <div class="c-request-money__terms-conditions-component" ng-if="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.interac) && $ctrl.flowService.currentState == $ctrl.flowService.STATES.ACCEPT_TERMS_AND_CONDITIONS"> <emt-terms-and-conditions term-state="$ctrl.flowService.currentState === $ctrl.flowService.STATES.ACCEPT_TERMS_AND_CONDITIONS" review-state="true" is-type-interac="$ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.interac)" accepted-terms-flag="$ctrl.model.transferDetails.acceptedTandC" parent-controller="$ctrl"> </emt-terms-and-conditions> </div> <div id="printMe" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.CONFIRMATION"> <div class="c-request-money__confirmation-title-section"> <p class="margin__tb--fix2 c-request-money__details-panel-name" ng-bind-html="\'emt.fulfillRequest.fulfillmentCompleted\' | translate:{\n              fullName: $ctrl.model.transferDetails.senderFullName,\n              transferDate: $ctrl.formatDateForDisplay($ctrl.model.summary.date),\n              transfertime: $ctrl.formatTimeForDisplay($ctrl.model.summary.date)\n            }"> </p> </div> <div class="c-balance-grid"> <div class="c-request-money__grid-table-first-row grid__container"> <div class="c-request-money__confirmation-number-column"> {{ \'emt.fulfillRequest.confirmationNumber\' | translate }} <span class="c-request-money__confirmation-number" ng-bind="$ctrl.model.summary.confirmationNumber"> </span> </div> </div> <div class="c-balance-grid__table"> <div class="c-balance-grid__table__table-column-top"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> <strong> {{::\'emt.fulfillRequest.transferAmount\' | translate}} </strong> </p> <p class="c-balance-grid__value"> {{ $ctrl.model.transferDetails.transferAmount | currency }} </p> </div> </div> <div class="c-balance-grid__table__table-column-top--has-borders"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> {{::\'emt.fulfillRequest.newBalance\' | translate}}<strong>{{::$ctrl.model.transferDetails.payFromAccountNickNameNum}}</strong> </p> <p class="c-balance-grid__value"> {{ $ctrl.model.summary.newBalance | currency }} </p> </div> </div> </div> </div> <p class="margin__tb--fix2"> <span>{{::\'emt.fulfillRequest.fulfillmentConfirmation\'|translate}}</span> <a actionable-id="send-emt-transaction_page" href="" ng-click="$ctrl.goToTransactionPage()" class="body--callout pointer">{{::\'emt.fulfillRequest.transactionPage\'|translate}}</a>. </p> <p class="margin__tb--fix2"> <tng-print-button button-class="btn btn--orange margin__tb margin__tb--fix2" only-element="\'printMe\'"> {{ ::\'emt.fulfillRequest.print\' | translate }} </tng-print-button> </p> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.DECLINE"> <div class="c-emt-page__form"> <div class="c-error-message panel margin__tb--fix2" ng-if="$ctrl.model.errors.return_code"> {{\'global.errorCodes.\' + $ctrl.model.errors.return_code | translate }} </div> <p class="margin__tb--fix2" translate="emt.fulfillRequest.areYouSureYouWantToDecline"></p> </div> <div class="c-emt-page__form-container margin__t--fix2"> <div class="c-emt-page__form"> <div class="c-request-money__details-panel panel"> <label class="c-request-money__details-panel-label" translate="emt.fulfillRequest.amount" for=""> </label> <h4 class="c-request-money__details-panel-amount">{{ $ctrl.model.transferDetails.transferAmount | currency }}</h4> </div> <div class="c-request-money__details-panel panel"> <label class="c-request-money__details-panel-label" translate="emt.fulfillRequest.from" for=""> </label> <h4 class="c-emt-page__details-panel-name">{{ $ctrl.model.transferDetails.senderFullName }}</h4> <h5 class="c-emt-page__details-panel-email">{{ $ctrl.model.transferDetails.senderEmail }}</h5> </div> <div class="c-request-money__details-panel panel" ng-if="$ctrl.model.transferDetails.message"> <label translate="emt.fulfillRequest.message" class="c-request-money__details-panel-label" for=""> </label> <h2 class="c-request-money__details-panel-message" ng-bind="$ctrl.model.transferDetails.message"></h2> </div> </div> </div> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.DECLINED"> <div class="c-error-message panel margin__tb--fix2" ng-if="$ctrl.model.errors.return_code"> {{\'global.errorCodes.\' + $ctrl.model.errors.return_code | translate }} </div> <div class="c-emt-page__decline-form"> <p class="margin__tb--fix2" translate="emt.fulfillRequest.youHaveDeclinedToReceiveTransfer"></p> </div> <div class="c-balance-grid c-request-money__decline-balance-grid"> <div class="c-balance-grid__table"> <div class="c-balance-grid__table__table-column-top"> <div class="c-balance-grid__section c-request-money__decline-balance-section"> <p class="c-balance-grid__title" translate="emt.fulfillRequest.amount"> </p> <p class="c-balance-grid__value"> {{ $ctrl.model.transferDetails.transferAmount | currency }} </p> </div> </div> <div class="c-balance-grid__table__table-column-top--has-borders"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title" translate="emt.fulfillRequest.from"> </p> <p class="c-balance-grid__value c-emt-page__details-panel-name" ng-bind="$ctrl.model.transferDetails.senderFullName"> </p> </div> </div> </div> </div> </div> <div class="c-emt-page__form-container" ng-if="::($ctrl.isType($ctrl.RECEIVE_MONEY_TYPES.interac))"> <img ng-src="{{::\'assets/images/logo_interac_\' + $ctrl.shortHandLocale + \'.png\'}}" class="c-request-money__interac-logo" alt="Interac"> <span class="c-request-money__interac-trademark" translate="emt.fulfillRequest.interacTrademark"></span> </div> </div> <div class="c-emt-page__controls" ng-show="!$ctrl.model.shouldShowLoader"> <div class="c-emt-page__emt-footer flow-footer"> <div class="c-emt-page__controls-content"> <tng-page-flow-controls flow-service="$ctrl.flowService"> </tng-page-flow-controls> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(33)),a=c(n(8)),s=c(n(0)),r=c(n(2)),o=c(n(45));function c(t){return t&&t.__esModule?t:{default:t}}var l={interac:"INTERAC"},u={SUCCESS:"SUCCESS"},d={SUCCESS:"SUCCESS",VALIDATION_ERROR:"VALIDATION_ERROR",EMT_TERMS_AND_CONDITIONS_NOT_ACCEPTED:"EMT_TERMS_AND_CONDITIONS_NOT_ACCEPTED",NO_CHEQUING_ACCOUNT:"EMT_NO_CHEQUING_ACCOUNT"},h=function(){function t(e,n,i,a,r,o,c,d,h,f,p,g,m,_,v,S,T,y,E,A,b,C){(0,s.default)(this,t),this.$q=e,this.CredentialsTPWService=y,this.$log=n,this.$window=i,this.flowService=a,this.TRANSFER_TYPE=v.TRANSFER_TYPE,this.FulfillRequestService=r,this.tileListConstants=o,this.$stateParams=c,this.$state=h,this.$translate=f,this.shortHandLocale=p.SHORTHAND_LOCALE[d.locale],this.RECEIVE_MONEY_TYPES=l,this.INSTITUTION_VALIDATION_RESPONSES=u,this.SessionService=g,this.stateConstants=m,this.serviceConstants=_,this.CustomersService=S,this.EnvironmentService=T,this.DateService=E,this.emtService=A,this.accountHelpersService=b,this.accountConstants=C,this.CURRENCY_TYPES=C.CURRENCY_TYPES}return(0,r.default)(t,[{key:"$onInit",value:function(){this.warnings=[],this.isRedirecting=!1,this.flowService.activate(),this.flowService.onConfirmDecline=this._declineTransfer.bind(this),this.flowService.onAcceptTermsAndConditions=this._acceptTermsAndCondition.bind(this),this.flowService.onDoneButtonClick=this._redirectToAccountSummary.bind(this),this.flowService.onCancelButtonClick=this._onCancelButtonClick.bind(this),this.flowService.confirmFulfillRequest=this._confirmFulfillRequest.bind(this),this._initializeFormsAndModel(),this._initializeStateVariables(),this.isType(this.RECEIVE_MONEY_TYPES.interac)&&(this.flowService.moveToWithoutExitWarning(this.flowService.STATES.TRANSFER_DETAILS),this._getEmailTransferAccounts(),this.$log.debug("Call load get Money Fulfill Request"),this._validateFulfillRequestCode())}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}},{key:"isType",value:function(t){return this.type===t}},{key:"onAccountTileClick",value:function(t,e){this.model.errors&&this.model.errors.return_code||this.warnings&&this.warnings.length>0||this.model.transferDetails.transferAmount<=0||(this.model.transferDetails.selectedAccount=[e],this.model.transferDetails.selectedAccountToDisplay=[(0,a.default)({tileDescription:this.$translate.instant("emt.fulfillRequest.reviewSendFrom")},e)],this.model.transferDetails.payFromAccountNickName=this.accountHelpersService.getDisplayNameInstant(e),this.model.transferDetails.payFromAccountNickNameNum=this.getNickNameWithNum(this.model.transferDetails.payFromAccountNickName,e.display_name),this.flowService.gotoNextState())}},{key:"getNickNameWithNum",value:function(t,e){var n=e.length,i=n-4,a=n,s="***".concat(e.slice(i,a));return t.concat("  ").concat(s)}},{key:"_initializeFormsAndModel",value:function(){var t,e;this.forms={transferDetails:"transferDetails",summary:"summary"},this.model=(e={},(0,i.default)(e,this.forms.transferDetails,{transferAmount:"",senderEmail:"",senderFullName:"",currency:this.CURRENCY_TYPES.CAD,message:"",invoiceInfo:"",invoiceDueDate:"",expiryDate:"",selectedAccount:[],checkingValidity:!1,nonClientAccount:{},acceptedTandC:!1}),(0,i.default)(e,this.forms.summary,{newBalance:null,confirmationNumber:null,date:null}),(0,i.default)(e,"shouldShowLoader",!1),(0,i.default)(e,"forms",(t={},(0,i.default)(t,this.forms.transferDetails,{}),(0,i.default)(t,this.forms.summary,{}),(0,i.default)(t,"nonClientAccount",{$valid:!1}),t)),e)}},{key:"getSelectedAccount",value:function(){return this.model.transferDetails.selectedAccount.length>0?this.model.transferDetails.selectedAccount[0]:void 0}},{key:"_initializeStateVariables",value:function(){this.type=this.RECEIVE_MONEY_TYPES[this.$stateParams.type],this.emtId=this.$stateParams.emtId}},{key:"_createSession",value:function(){return this.CredentialsTPWService.metroGet("displayLogin",{locale:this.SessionService.locale},{bypassRedirect:!0},"InitialTangerine.html")}},{key:"_validateFulfillRequestCode",value:function(){var t=this,e=this.$q.defer(),n=function(){t.FulfillRequestService.emtGetRequestFulfill(t.emtId).then((function(n){t.model.shouldShowLoader=!1,n.response_status.return_code===d.EMT_TERMS_AND_CONDITIONS_NOT_ACCEPTED?(t.$log.debug("Load Terms and Condition State for user to accept or decline"),t.flowService.BUTTONS.BTN_GRY.disable=!1,t.flowService.BUTTONS.BTN_ORG.disable=!1,t.flowService.moveToWithoutExitWarning(t.flowService.STATES.ACCEPT_TERMS_AND_CONDITIONS)):n.response_status.status_code!==t.serviceConstants.STATUS_CODES.SUCCESS?(t.model.errors=n.response_status,t.flowService.BUTTONS.BTN_GRY.disable=!0,t.flowService.BUTTONS.BTN_ORG.disable=!0,t.flowService.moveTo(t.flowService.STATES.TRANSFER_DETAILS)):n.response_status.status_code===t.serviceConstants.STATUS_CODES.SUCCESS&&n.warnings&&n.warnings.length>0?(n.warnings.forEach((function(e){t.warnings.push(t.$translate.instant("global.errorCodes."+e))})),t._populateTransferDetails(n),t.flowService.BUTTONS.BTN_ORG.disable=!0,t.flowService.moveTo(t.flowService.STATES.TRANSFER_DETAILS)):(t._populateTransferDetails(n),t.flowService.BUTTONS.BTN_GRY.disable=!1,t.flowService.BUTTONS.BTN_ORG.disable=!1,t.flowService.moveTo(t.flowService.STATES.TRANSFER_DETAILS)),e.resolve()})).catch((function(n){t.model.shouldShowLoader=!1,t.model.errors="generic",t.$log.error("error getting emt details",n),e.reject()}))};return this.model.shouldShowLoader=!0,this.SessionService.isAuthenticated()?n():this._createSession().then((function(){n()})).catch((function(){e.reject()})),e.promise}},{key:"_populateTransferDetails",value:function(t){(0,a.default)(this.model.transferDetails,{transferAmount:t.amount,senderEmail:t.email_address,senderFullName:t.legal_name,currency:this.CURRENCY_TYPES.CAD,message:t.memo,invoiceInfo:t.invoice_number,invoiceDueDate:t.invoice_due_date,expiryDate:t.expiry_date,acceptedTandC:!0})}},{key:"_acceptTermsAndCondition",value:function(){this._acceptInteracTermsAndConditions()}},{key:"_acceptInteracTermsAndConditions",value:function(){var t=this;return this.model.shouldShowLoader=!0,this.CustomersService.putCustomerConsents({alias:this.EnvironmentService._platformInfo.platform||"Not Applicable",consent:{name:this.RECEIVE_MONEY_TYPES.interac,value:"Y"}}).then((function(){t._validateFulfillRequestCode()})).catch((function(e){t._transferErrorHandler(e),t.model.shouldShowLoader=!1}))}},{key:"_transferErrorHandler",value:function(t){this.model.errors=t,this.$log.error("EMT fulfill: service error",t)}},{key:"_resetError",value:function(){this.model.errors=void 0}},{key:"_transferAcceptHandler",value:function(t){var e=this,n=t.addBalanceToSummary,i=void 0!==n&&n;return function(t){if(t.response_status&&-1!==[d.VALIDATION_ERROR,e.serviceConstants.STATUS_CODES.SYSTEM_ERROR].indexOf(t.response_status.status_code))e.model.errors=t.response_status;else{e._resetError(),e.flowService.gotoNextState();var n=[{confirmationNumber:t.confirmation_number,date:(0,o.default)().toDate()}];i&&n.push({newBalance:e.getSelectedAccount().account_balance-e.model.transferDetails.transferAmount}),a.default.apply(Object,[e.model.summary].concat(n))}}}},{key:"_declineTransfer",value:function(){return this.model.shouldShowLoader=!0,this._declineRequestFulfill()}},{key:"_declineRequestFulfill",value:function(){var t=this;this.FulfillRequestService.declineRequestFulfill(this.emtId,{message:this.model.transferDetails.message}).then((function(e){if(e.response_status&&e.response_status.status_code&&e.response_status.status_code!==t.serviceConstants.STATUS_CODES.SUCCESS)return t.model.errors=e.response_status,t.flowService.BUTTONS.BTN_RED.disable=!0,void(t.flowService.BUTTONS.BTN_GRY.disable=!0);t._resetError(),t.flowService.gotoNextState()})).catch((function(e){t._transferErrorHandler(e)})).finally((function(){t.model.shouldShowLoader=!1}))}},{key:"_redirectToAccountSummary",value:function(){this.flowService.hideWarning(),this.isRedirecting=!0,this.$state.go(this.stateConstants.ACCOUNT_SUMMARY)}},{key:"updateAcceptButton",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=!this.interacAgreementConfirmation}},{key:"_onCancelButtonClick",value:function(){this.SessionService.isAuthenticated()?this.$state.go(this.stateConstants.ACCOUNT_SUMMARY):this.$window.location="/"}},{key:"formatDate",value:function(t){if(t){var e=(0,o.default)(t);return this.DateService.convertToFormattedDayMonthYear(e,"-")}return""}},{key:"formatDateForDisplay",value:function(t){return t?this.DateService.convertToFormattedNonUTCMonthDayYear(t):""}},{key:"formatTimeForDisplay",value:function(t){return t?this.DateService.formatMomentToTimeWithLocalizedTime(t):""}},{key:"_getEmailTransferAccounts",value:function(){var t=this;this.model.errors="",this.FulfillRequestService.getAccountsListForTransfer().then((function(e){t.fromAccounts=e.fromAccounts,null!==t.fromAccounts&&0!==t.fromAccounts.length||(t.model.errors={return_code:d.NO_CHEQUING_ACCOUNT})}),(function(e){t.$log.debug("error fetching accounts",e),t._showSubmitErrors(e)}))}},{key:"_confirmFulfillRequest",value:function(){this.model.transferDetails.acceptedTandC&&(this.model.shouldShowLoader=!0,this._confirmFulfillRequestTransfer())}},{key:"_confirmFulfillRequestTransfer",value:function(){var t=this;return this.FulfillRequestService.emtRequestFulfill(this._composeAcceptTransferParams(),this.emtId,this.getSelectedAccount().number).then((function(e){return t._transferAcceptHandler({addBalanceToSummary:!0})(e)})).catch((function(e){return t._transferErrorHandler(e)})).finally((function(){t.model.shouldShowLoader=!1}))}},{key:"_composeAcceptTransferParams",value:function(){return{validate_only:!0,amount:this.model.transferDetails.transferAmount}}},{key:"goToTransactionPage",value:function(){this.flowService.hideWarning(),this.isRedirecting=!0,this.$state.go(this.stateConstants.TRANSACTIONS)}},{key:"gotoPreviousState",value:function(){return this._resetError(),this.flowService.gotoPreviousState()}}]),t}();h.$inject=["$q","$log","$window","FulfillRequestFlowService","FulfillRequestService","tngTileListConstants","$stateParams","LocaleService","$state","$translate","localeConstants","SessionService","stateConstants","serviceConstants","emtConstants","CustomersService","EnvironmentService","CredentialsTPWService","DateService","EmtService","AccountHelpersService","accountConstants"],e.default=h,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(177)),a=u(n(0)),s=u(n(2)),r=u(n(264)),o=u(n(266)),c=u(n(265)),l=n(364);function u(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(t,n,s,o,c,l,u,d,h){(0,a.default)(this,e);var f=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,d,l,h));return f.$state=o,f.$window=c,f.$log=t,f.stateConstants=u,f.STATES={ACCEPT_TERMS_AND_CONDITIONS:{titleKey:"emt.fulfillRequest.states.termsandconditions"},TRANSFER_DETAILS:{titleKey:"emt.fulfillRequest.states.transferDetails"},REVIEW:{titleKey:"emt.fulfillRequest.states.review"},CONFIRMATION:{titleKey:"emt.fulfillRequest.states.confirmation"},DECLINE:{titleKey:"emt.fulfillRequest.states.declineTransfer"},DECLINED:{titleKey:"emt.fulfillRequest.states.transferDeclined"}},f._initialState=f.STATES.TRANSFER_DETAILS,f}return(0,c.default)(e,t),(0,s.default)(e,[{key:"_resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.BUTTONS={BTN_GRY:new l.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new l.ModalFooterButton(this.BUTTON_TYPES.NEXT,!0,!0),BTN_RED:new l.ModalFooterButton(this.BUTTON_TYPES.CONFIRM_DECLINE,!1,!1)}}},{key:"_updateUI",value:function(){var t=this.currentState,e=this.BUTTON_TYPES,n=this.BUTTONS,i=this.STATES;switch(n.BTN_GRY.show=!0,n.BTN_RED.show=!1,n.BTN_ORG.disable=!0,n.BTN_ORG.show=!0,t){case i.ACCEPT_TERMS_AND_CONDITIONS:n.BTN_ORG.type=e.ACCEPT,n.BTN_ORG.disable=!1,n.BTN_GRY.show=!1;break;case i.TRANSFER_DETAILS:n.BTN_GRY.type=e.DECLINE,n.BTN_ORG.type=e.NEXT,n.BTN_ORG.show=!1;break;case i.REVIEW:n.BTN_ORG.type=e.SUBMIT,n.BTN_ORG.disable=!1,n.BTN_GRY.show=!1;break;case i.CONFIRMATION:n.BTN_ORG.type=e.DONE,n.BTN_ORG.disable=!1,n.BTN_GRY.show=!1;break;case i.DECLINE:n.BTN_RED.type=e.YES_DECLINE,n.BTN_GRY.type=e.BACK,n.BTN_RED.show=!0,n.BTN_GRY.show=!0,n.BTN_ORG.show=!1;break;case i.DECLINED:n.BTN_ORG.type=e.DONE,n.BTN_ORG.disable=!1,n.BTN_GRY.show=!1,n.BTN_ORG.show=!0}}},{key:"moveToWithoutExitWarning",value:function(t){t&&(this._preMoveTo(),this.hideWarning(),this.currentState||this.$log.warn("No current state is detected. Did you initialize one in _resetState()?"),this._stateHistory.push(this.currentState),this.currentState=t,this._updateUI(),this._conditionalScrollToTop())}},{key:"gotoNextState",value:function(){var t=this.currentState,e=this.STATES;switch(t){case e.ACCEPT_TERMS_AND_CONDITIONS:this.moveTo(e.TRANSFER_DETAILS);break;case e.TRANSFER_DETAILS:this.moveTo(e.REVIEW);break;case e.REVIEW:this.moveTo(e.CONFIRMATION);break;case e.DECLINE:this.moveTo(e.DECLINED);break;default:this.$log.debug("Unknown or unrecognized state:",t)}}},{key:"onButtonClick",value:function(t){switch(t.type){case this.BUTTON_TYPES.YES_DECLINE:this.onConfirmDecline();break;case this.BUTTON_TYPES.DECLINE:this.moveTo(this.STATES.DECLINE);break;case this.BUTTON_TYPES.SUBMIT:this.confirmFulfillRequest();break;case this.BUTTON_TYPES.ACCEPT:this.onAcceptTermsAndConditions(),this.moveTo(this.STATES.TRANSFER_DETAILS);break;case this.BUTTON_TYPES.DONE:this.onDoneButtonClick();break;case this.BUTTON_TYPES.CANCEL:this.onCancelButtonClick();break;default:(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"onButtonClick",this).call(this,t)}}},{key:"_getAnalyticsID",value:function(){return"emt/fulfillRequest"}}]),e}(u(n(267)).default);d.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","stateConstants","$rootScope","AnalyticsService"],e.default=d,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s){(0,i.default)(this,t),this.RequesterService=e,this.serviceConstants=n,this.$httpParamSerializer=a,this.locale=s.locale}return(0,a.default)(t,[{key:"getAccountsListForTransfer",value:function(){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.ACCOUNTS_FOR_RECEIVE_EMAIL_MONEY)}},{key:"emtRequestFulfill",value:function(t,e,n){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.EMT_REQUEST_FULFILL,{data:t,urlVars:{transferId:e,accountHash:n}})}},{key:"declineRequestFulfill",value:function(t,e){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.EMT_DECLINE_REQUEST_FULFILL,{urlVars:{transferId:t},data:{decline_reason:e.message}})}},{key:"emtGetRequestFulfill",value:function(t){return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.EMT_GET_REQUEST_FULFILL,{urlVars:{transferId:t},data:{validateOnly:!0}})}}]),t}();r.$inject=["RequesterService","serviceConstants","$httpParamSerializer","LocaleService"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(5315),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("emt-terms-and-conditions",[]).component("emtTermsAndConditions",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5316)),a=s(n(5317));function s(t){return t&&t.__esModule?t:{default:t}}n(5318);var r={controller:a.default,template:i.default,bindings:{returnTo:"<",termState:"<",reviewState:"<",isTypeInterac:"<",acceptedTermsFlag:"<",parentController:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports=' <div class="c-emt-terms-and-conditions"> <div class="c-emt-terms-and-conditions__terms-table-section"> <div class="emt-main-content-title"> <div class="emt-main-row-fluid"> <p ng-if="$ctrl.termState && $ctrl.parentController.interacAutoDespositRegistration === true" class="emt-terms-conditions-sub" translate="userSettings.moneyTransfer.interac.autoDespoit.termsandconditions.header"></p> <p ng-if="$ctrl.termState && $ctrl.parentController.interacAutoDespositRegistration !== true" class="emt-terms-conditions-sub" translate="emt.termsAndConditions.termsDetails"></p> <span ng-if="$ctrl.reviewState" class="emt-terms">{{\'emt.termsAndConditions.title\' | translate}}</span> </div> </div> <emt-terms-and-conditions-accordion></emt-terms-and-conditions-accordion> </div> <div class="c-emt-terms-and-conditions__agreement" ng-if="$ctrl.termState && $ctrl.isTypeInterac && !$ctrl.acceptedTermsFlag"> <input type="checkbox" class="input c-emt-terms-and-conditions__agreement-checkbox CB_ReadOnly" id="EMTAGREEMENTCHECKBOX" ng-model="$ctrl.interacAgreementConfirmation" ng-init="$ctrl.updateAcceptButton()" ng-change="$ctrl.updateAcceptButton()"/> <label for="EMTAGREEMENTCHECKBOX"> <span translate="emt.termsAndConditions.iAgreeTerms"></span> </label> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f,p){(0,i.default)(this,t),this.$q=e,this.$log=n,this.$window=a,this.TRANSFER_TYPE=p.TRANSFER_TYPE,this.tileListConstants=s,this.$stateParams=r,this.$state=c,this.$translate=l,this.shortHandLocale=u.SHORTHAND_LOCALE[o.locale],this.SessionService=d,this.stateConstants=h,this.serviceConstants=f}return(0,a.default)(t,[{key:"$onInit",value:function(){}},{key:"updateAcceptButton",value:function(){this.parentController.flowService.BUTTONS.BTN_ORG.disable=!this.interacAgreementConfirmation}}]),t}();r.$inject=["$q","$log","$window","tngTileListConstants","$stateParams","LocaleService","$state","$translate","localeConstants","SessionService","stateConstants","serviceConstants","emtConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this._RequesterService=e,this._serviceConstants=n,this._emtConstants=a}return(0,a.default)(t,[{key:"getEmtRecipients",value:function(){return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.GET_EMT_RECIPIENTS)}},{key:"getEmtLimits",value:function(){return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.LIMITS)}},{key:"deleteContact",value:function(t){var e={urlVars:{id:t}};return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.DELETE_EMT_RECIPIENT,e)}},{key:"addContact",value:function(t,e){var n={urlVars:{},data:{recipient:{email_address:t.email_address,email_question:t.email_question,email_answer:t.email_answer,first_name:t.first_name,last_name:t.last_name,email_language:t.email_language}}};return e||(n.urlVars.queryString="without-question-and-answer=true"),this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.ADD_EMT_RECIPIENT,n)}},{key:"editContact",value:function(t,e){var n={urlVars:{id:t.sequence_number},data:{recipient:{email_address:t.email_address,first_name:t.first_name,last_name:t.last_name,email_language:t.email_language}}};return e&&(n.data.recipient.email_answer=t.email_answer,n.data.recipient.email_question=t.email_question),this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.EDIT_EMT_RECIPIENT,n)}},{key:"getEmailTransferAccounts",value:function(){return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.MOVE_MONEY_EMAIL_TRANSFER)}},{key:"sendMoneyEmailTransfer",value:function(t,e){var n={urlVars:{accountHash:t.payFromAccount.number},data:{validate_only:e,emt:{emt_type:t.TRANSFER_TYPE_STATE,amount:t.amount,recipient_sequence_number:t.recipient.sequence_number,message:t.optionalMessage,accepted_terms_and_conditions:!0,when:t.WHEN_STATE}}};return t.WHEN_STATE===this._emtConstants.WHEN_SEND.LATER&&(n.data.emt.scheduled_date=t.when.format("YYYY-MM-DD")),this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.SEND_MONEY_EMAIL_TRANSFER,n)}},{key:"getReclaimEmt",value:function(t){return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.GET_RECLAIM_EMT,{urlVars:{transferId:t,"transfer-id":t}})}}]),t}();r.$inject=["RequesterService","serviceConstants","emtConstants"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(0)),a=o(n(2)),s=o(n(45)),r=n(67);function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,a,s,r,o,c){(0,i.default)(this,t),this._RequesterService=e,this._serviceConstants=n,this.eTransferDialogConstants=a,this.$q=s,this.$timeout=r,this.$location=o,this.$anchorScroll=c,this.WHEN_SEND=this.eTransferDialogConstants.WHEN_SEND}return(0,a.default)(t,[{key:"getEmtRecipients",value:function(){return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.GET_EMT_RECIPIENTS)}},{key:"getEmtLimits",value:function(){return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.LIMITS)}},{key:"deleteContact",value:function(t){var e={urlVars:{id:t}};return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.DELETE_EMT_RECIPIENT,e)}},{key:"addContact",value:function(t){var e={urlVars:{queryString:"without-question-and-answer=true"},data:{recipient:{email_address:t.email_address,email_question:t.email_question,email_answer:t.email_answer,first_name:t.first_name,last_name:t.last_name,email_language:t.email_language}}};return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.ADD_EMT_RECIPIENT,e)}},{key:"editContact",value:function(t,e){var n=this,i=[this._serviceConstants.STATUS_CODES.SUCCESS],a=t.sequence_number,s=void 0,r=void 0;"*****"===t.email_answer?(s=void 0,r=void 0):(s=t.email_answer,r=t.email_question);var o={urlVars:{id:a},data:{validate_only:e,recipient:{email_address:t.email_address,email_question:r,email_answer:s,first_name:t.first_name,last_name:t.last_name,email_language:t.email_language},emt_transfer_message:t.message}};return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.EDIT_EMT_RECIPIENT,o).then((function(t){return-1!==i.indexOf(t.response_status.status_code)?t:n.$q.reject(t)})).catch((function(t){throw t}))}},{key:"getEmailTransferAccounts",value:function(){return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.MOVE_MONEY_EMAIL_TRANSFER)}},{key:"isSecurityQuestionAnswerUpdated",value:function(t){return t.isSecurityQandAUpdated&&t.securityAnswer&&t.securityAnswer.length>0&&t.securityAnswer!==this.eTransferDialogConstants.SECURITY_ANSWER_MASK}},{key:"prepareTransactionPayload",value:function(t){var e=this.isSecurityQuestionAnswerUpdated(t);return{TRANSFER_TYPE_STATE:t.eTransferType,WHEN_STATE:this.isFutureDate(t.selectedDate)?this.WHEN_SEND.LATER:this.WHEN_SEND.NOW,scheduledDate:t.selectedDate,payFromAccount:t.selectedAccount,recipient:t.selectedRecipient,amount:t.amount,securityQuestion:e?t.securityQuestion:void 0,securityAnswer:e?t.securityAnswer:void 0,optionalMessage:t.optionalMessage}}},{key:"sendMoneyEmailTransfer",value:function(t,e){var n={urlVars:{accountHash:t.payFromAccount.number},data:{validate_only:e,emt:{emt_type:t.TRANSFER_TYPE_STATE,amount:t.amount,recipient_sequence_number:t.recipient.sequence_number,message:t.optionalMessage,accepted_terms_and_conditions:!0,when:t.WHEN_STATE}}};return t.WHEN_STATE===this.eTransferDialogConstants.WHEN_SEND.LATER&&(n.data.emt.scheduled_date=t.scheduledDate.format("YYYY-MM-DD")),this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.SEND_MONEY_EMAIL_TRANSFER,n)}},{key:"getReclaimEmt",value:function(t){return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.GET_RECLAIM_EMT,{urlVars:{transferId:t,"transfer-id":t}})}},{key:"isFutureDate",value:function(t){var e=(0,s.default)().tz("America/Toronto").format("YYYY-MM-DD");return!(0,s.default)(t.format("YYYY-MM-DD")).isSameOrBefore(e)}},{key:"pageScroll",value:function(t,e){var n=this;this.$timeout((function(){n.$location.hash(t),e&&document.getElementById(e).focus(),n.$anchorScroll(),n.$location.hash("")}))}},{key:"profanityChecker",value:function(t){var e=this,n=[this._serviceConstants.STATUS_CODES.SUCCESS];return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES.GOAL_PROFANITY_CHECKER,{data:{text:t}}).then((function(t){return-1!==n.indexOf(t.response_status.status_code)?t:e.$q.reject(t)})).catch((function(t){throw t}))}},{key:"getAccountDetails",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={urlVars:{accountHash:t,queryString:"include-available-actions=true"}},i="ACCOUNT_DETAILS_CHEQUING";return this._RequesterService.request(this._serviceConstants.AVAILABLE_SERVICES[i],n,e)}},{key:"focusElement",value:function(t){t&&document.getElementById(t).focus()}},{key:"parseEmailOrFullname",value:function(t){var e={first_name:"",last_name:"",email_address:""};if(!t||!t.length)return e;if((0,r.contactEmailParseValidation)(t))e.email_address=r.contactEmailParsePattern.exec(t)[0];else if((0,r.contactNameParseValidation)(t)){var n=r.contactNameParsePattern.exec(t)[0];e.first_name=n.split(" ")[0],e.last_name=n.split(" ")[1]}return e}}]),t}();c.$inject=["RequesterService","serviceConstants","eTransferDialogConstants","$q","$timeout","$location","$anchorScroll"],e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5322)),a=s(n(5323));function s(t){return t&&t.__esModule?t:{default:t}}n(5324);var r={controller:a.default,template:i.default};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="emt-main-content-accordion"> <tng-accordion transclude-mode="true" name="e-transfer-tnc-accordion"> <tng-header> <div class="emt-main-content-header"> <div class="emt-main-row-fluid"> <p class="emt-terms-conditions-header" translate>{{::\'emt.termsAndConditions.header\'}}</p> </div> </div> </tng-header> <tng-content> <div class="emt-main-contents"> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <p translate>{{::\'emt.termsAndConditions.headingMessage\'}}</p> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.a\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.a\'}}</p> <p translate>{{::\'emt.termsAndConditions.details.a1\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.b\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.b\'}}</p> <section class="c-emt-terms-and-conditions__nested-section"> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.subItems.i\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.b1\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.subItems.ii\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.b2\'}}</p> </div> </div> </div> </section> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.c\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.c\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.d\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.d\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.e\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.e\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.f\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.f\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.g\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.g\'}}</p> <section class="c-emt-terms-and-conditions__nested-section"> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.subItems.i\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.g1\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.subItems.ii\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.g2\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.subItems.iii\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.g3\'}}</p> </div> </div> </div> </section> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.h\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.h\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.i\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.i\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.j\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.j\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.k\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.k\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.l\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.l\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.m\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.m\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.n\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.n\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.o\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.o\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.p\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.p\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.q\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.q\'}}</p> <section class="c-emt-terms-and-conditions__nested-section"> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.subItems.i\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.q1\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.subItems.ii\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.q2\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.subItems.iii\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.q3\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.subItems.iv\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.q4\'}}</p> </div> </div> </div> </section> <p translate>{{::\'emt.termsAndConditions.details.q5\'}}</p> </div> </div> </div> <div class="emt-main-content"> <div class="emt-main-row-fluid"> <div class="row-content-left"> <p translate>{{::\'emt.termsAndConditions.item.r\'}}</p> </div> <div class="row-content-right"> <p translate>{{::\'emt.termsAndConditions.details.r\'}}</p> </div> <div class="c-emt-page__form-container"> <span class="c-receive-money__interac-trademark" translate="emt.receiveMoneyClient.interacTrademark1"></span> </div> </div> </div> </div> </tng-content> </tng-accordion> </div>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.$log=t}return t.prototype.$OnInit=function(){},t}();i.$inject=["$log"],e.default=i},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={TYPES:{RSP:"RSP",TFSA:"TFSA",RIF:"RIF"},SALUTATIONS:[{name:"Mr",code:"Mr."},{name:"Ms",code:"Ms"},{name:"Mrs",code:"Mrs."},{name:"Miss",code:"Miss"},{name:"Dr",code:"Dr."}],MODE:{CREATE:"CREATE",EDIT:"EDIT",VIEW:"VIEW"},STATUS:{SUBMITTED:"SUBMITTED",NEW:"NEW",WAIT_FOR_CHEQUE:"WAIT_FOR_CHEQUE"},INSTITUTION:{OTHER:"other",OTHER_CODE:"XXX"},ACTION_CODES:{PDF_DOCUMENT:"PDF_DOCUMENT",COMPLETE:"COMPLETE",SAVE:"SAVE"},SIGNATURE_TYPES:{INK:"INK",ESIGN:"ESIGN"}};e.default=i,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5327)),a=s(n(5328));function s(t){return t&&t.__esModule?t:{default:t}}n(5329);var r={template:a.default,controller:i.default,bindings:{account:"<",accountHash:"<",basketCount:"<",goToLastStep:"=",isOnBoarding:"<",onBoardingUpdateFunction:"&?",submitMutualFundApplication:"&?",onClose:"&",registerFlow:"&?",application:"<",parentFlowPreviousStepNumber:"<?",parentFlowTotalSteps:"<?",saveApplication:"=",type:"<",sourceType:"<?",customer:"<?",mfDealId:"<?",showOnlyClose:"<?",minFundAmount:"<?"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=h(n(15)),a=h(n(177)),s=h(n(8)),r=h(n(528)),o=h(n(0)),c=h(n(2)),l=h(n(266)),u=h(n(1985)),d=h(n(268));function h(t){return t&&t.__esModule?t:{default:t}}var f=function(){function t(e,n,i,a,s,r,c,l,u,d,h,f,p,g,m,_,v,S,T,y,E,A,b,C,$,N,O,I,w,P,M,R,D,L,k){(0,o.default)(this,t),this.$log=e,this.$translate=n,this.$timeout=i,this.$window=a,this.$filter=s,this.$q=r,this.flowService=c,this.STATES=this.flowService.STATES,this.magicSwitchService=l,this.GlobalModalsService=u,this.$scope=d,this.pageFlowConstants=h,this.CustomerInfoService=f,this.dateSelectorConstants=p,this.tileListConstants=m,this.CURRENCY_TYPES=_.CURRENCY_TYPES,this.nativeService=v,this.LOCALES=g.LOCALES,this.accountConstants=_,this.ReferenceDataService=A,this.EnvironmentService=$,this.AccountDetailsService=T,this.AccountService=y,this.PendingApplicationsService=b,this.pendingApplicationsConstants=C,this.serviceConstants=N,this.ErrorService=O,this.ERROR_EVENTS=I.AVAILABLE_EVENTS,this.$sce=w,this.magicSwitchConstants=E,this.PDFRequestService=S,this.locale=P.locale,this.ACCOUNT_PPTS=_.ACCOUNT_PPTS,this.FlowFooterService=L,this.buildConstants=k,this.msmfUpgraded=this.flowService.magicSwitchFundsUpgraded,this.reviewData={},this.bankTile={},this.referenceDataConstants=M,this.UserSettingsConstants=R,this.customerConstants=D}return(0,c.default)(t,[{key:"$onInit",value:function(){var t=this,e=this.flowService;this.sourceType||(this.sourceType=this.type),e.isOnBoarding=this.isOnBoarding,e.activate(this.registerFlow),this.pageId="magicSwitchForm",this.momentTomorrow=moment().startOf("day").add(1,"day"),this.flowService.onButtonClickCancel=function(){t.flowService.flowIsDone?t.$log.error("magic-switch not currently handling cancel button within OB2"):t._close()},this.flowService.onButtonClickSkip=function(){t._skip()},this.flowService.onButtonClickDone=function(){t._done()},this.flowService.onButtonClickBack=function(){t.flowService.currentState===t.flowService.STATES.INTRO?t.isOnBoarding?t.returnToParentFlow():(t._goBackState(),t._close()):t._goBackState()},this.flowService.onButtonClickNext=function(){t._goNextState()},this.flowService.onButtonClickSubmit=function(){t._goNextState()},this.flowService.onButtonClickDefault=function(e){e===t.flowService.BUTTON_TYPES.CLOSE&&t._close()},this.getInstitutions(),this.flowService._updateUI=function(){t._updateUI()},this._resetModel(),this.mode=this.magicSwitchConstants.MODE.CREATE,this.$scope.$watch("$ctrl.data.forms.externalInfo.$valid",(function(){t.stepLandingLogic()})),this.application?this.handleApplicationSelectedFromPendingApplications(this.application):this.account&&this.isSavings&&!this.isOnBoarding?this.getPendingTransferApplications(this.data.account.display_name):this.account||this._getAccountFromHash(this.accountHash),this.goToLastStep&&(this.getAmountData(),this.resetSubmitErrors(),this.flowService.moveTo(this.flowService.STATES.AMOUNT)),this._updateUI(),this._getIndustryReferenceData(),this.flowService.AnchorService.scrollToTop()}},{key:"returnToParentFlow",value:function(){this.saveApplication.UIData=this.data,this.flowService.flowIsRetreating(!0),this.flowService.AnchorService.scrollToTop()}},{key:"_skip",value:function(){this.isOnBoarding&&this.flowService.flowIsDone&&this.flowService.flowIsDone({stopEnrollmentFlow:!!this.data.isPension})}},{key:"_done",value:function(){this.isOnBoarding?this._completeSubFlow():this._close()}},{key:"_updateUI",value:function(){var t=this.flowService,e=t.currentState,n=t.BUTTON_TYPES,i=t.BUTTONS,a=t.STATES;switch(i.BTN_GRY.show=!0,i.BTN_GRY.disable=!1,i.BTN_ORG.show=!0,i.BTN_ORG.disable=!1,i.BTN_ORG.type=n.NEXT,this.isOnBoarding&&(this.flowService.currentStepNumber=(this.parentFlowPreviousStepNumber||0)+e.obStep,this.flowService.totalStepsInSubFlow=this.parentFlowTotalSteps+(this.isMagicSwitchPaperSign?1:0)),this.clearESignAgreements(),e){case a.INTRO:i.BTN_GRY.show=this.isOnBoarding,i.BTN_ORG.show=!0;break;case a.EXTERNAL_INFO:i.BTN_ORG.disable=!0;break;case a.REVIEW:i.BTN_GRY.show=!1,i.BTN_ORG.show=!0;break;case a.AMOUNT:i.BTN_ORG.type=n.NEXT;break;case a.DONE:case a.DONE_SIGN_ELECTRONICALLY:case a.DONE_SAVED:this.flowService.hideWarning(),i.BTN_ORG.type=n.DONE,i.BTN_GRY.show=!1;break;case a.DONE_SIGN_MANUALLY:this.flowService.hideWarning(),i.BTN_ORG.type=this.isOnBoarding?n.NEXT:n.DONE,i.BTN_GRY.show=!1;break;case a.PENDING_TRANSFERS:this.flowService.hideWarning(),i.BTN_ORG.type=n.DONE,i.BTN_GRY.show=!1;break;case a.PENDING_TRANSFER_DETAILS:this.flowService.hideWarning(),i.BTN_ORG.type=n.DONE,i.BTN_GRY.show=!0;break;case a.SIGN_ELECTRONICALLY:this.hasEsignData()&&(this.FlowFooterService.account=this.account,this.account.signElectronicallyAccepted=!1,this.FlowFooterService.agreements=this.prepareESignAgreements(),this.FlowFooterService.agreementsChanged=this.handleSignatureAgreement.bind(this),this.handleSignatureAgreement()),i.BTN_GRY.show=!0,i.BTN_ORG.type=n.SUBMIT,i.BTN_ORG.show=this.hasEsignData()}this.showOnlyClose&&(i.BTN_ORG.type=n.CLOSE,i.BTN_GRY.show=!1)}},{key:"_goBackState",value:function(){if(this.resetSubmitErrors(),this.goToLastStep){var t=this.flowService.STATES;switch(this.flowService.currentState){case t.EXTERNAL_INFO:this.goToLastStep=!1,this.flowService.moveTo(t.INTRO);break;case t.AMOUNT:this.flowService.moveTo(t.EXTERNAL_INFO);break;default:this.$log.debug("unrecognized state")}}else this.flowService.currentState===this.flowService.STATES.PENDING_TRANSFER_DETAILS?(this.application=null,this._resetModel(),this.fromPendingApplications?this.onClose({isReloadPendingApplications:!0}):this.flowService.gotoPreviousState()):this.flowService.gotoPreviousState();this.stepLandingLogic()}},{key:"_goNextState",value:function(){this.resetSubmitErrors();var t=this.flowService.STATES,e=this.flowService.currentState;this._processNextStepResults(e,t)}},{key:"_processNextStepResults",value:function(t,e){switch(t){case e.INTRO:if(this.isOnBoarding?this.flowService.moveTo(e.EXTERNAL_INFO):this.flowService.gotoNextState(this.account.type),null!==this.data.customer.employment_status){this.data.showEmployed=-1!==this.UserSettingsConstants.EMPLOYED_STATUS_CODES.indexOf(this.data.customer.employment_status);var n=this._getEmploymentStatusText();this.data.showEmployed&&this.data.customer.occupation?this.data.employmentInfo={employmentStatus:n,industry:this._getIndustry().name,occupation:this._getOccupation().name,employerName:this.data.customer.employer?this.data.customer.employer.company_name:""}:this.data.employmentInfo={employmentStatus:n}}else this.data.employmentInfo={employmentStatus:""};break;case e.EXTERNAL_INFO:this.getAmountData(),this.flowService.gotoNextState(this.account.type);break;case e.AMOUNT:!this.msmfUpgraded&&this.isMF&&this.isOnBoarding?this._completeSubFlow():(this.resetSubmitErrors(),this.flowService.gotoNextState(this.account.type),this.isSavings&&this.setPersonalInfo());break;case e.REVIEW:this.submitData();break;case e.SIGN_ELECTRONICALLY:this.data.signature_type=this.magicSwitchConstants.SIGNATURE_TYPES.ESIGN,this.data.signatureAgreement=this.account.signElectronicallyAccepted,this.handleSignatureAgreement(),this.completeEsignature();break;case e.DONE_SIGN_MANUALLY:this.isOnBoarding&&this._completeSubFlow();break;default:this.flowService.gotoNextState(this.account.type)}this.stepLandingLogic()}},{key:"updatePrimaryPhone",value:function(){this.data.customer&&this.data.customer.phone_list&&(this.data.customer.selectedPhoneNumber=this.data.customer.phone_list.find((function(t){return!0===t.preferred}))?this.data.customer.phone_list.find((function(t){return!0===t.preferred})).type:{})}},{key:"stepLandingLogic",value:function(){this.flowService.currentState===this.flowService.STATES.EXTERNAL_INFO&&this.isSavings&&(this.data.institution=this.data.institutionDropdown===this.magicSwitchConstants.INSTITUTION.OTHER?"":this.data.institutionDropdown,this.data.institutionName=this.data.institutionDropdown===this.magicSwitchConstants.INSTITUTION.OTHER?this.data.institutionOther:this.institutionsMap.get(this.data.institutionDropdown),this.saveable=!!(this.data.institutionName&&this.data.institutionAddress.street_number&&this.data.institutionAddress.address_line1&&this.data.institutionAddress.city&&this.data.institutionAddress.postal_code)),this.flowService.currentState===this.flowService.STATES.AMOUNT&&(this.flowService.BUTTONS.BTN_ORG.disable=!this.isValidAmount(this.data.transaction.amount)||!1===this.data.confirmedBorrowedMoney,this.flowService.flowIsDone&&this.setParentAmountDetails(),this.flowService.BUTTONS.BTN_ORG.disable=!this.isValidAmount(this.data.transaction.amount)),this.flowService.currentState===this.flowService.STATES.EXTERNAL_INFO&&(this.flowService.BUTTONS.BTN_ORG.disable=this.data.forms.externalInfo&&!this.data.forms.externalInfo.$valid)}},{key:"handleApplicationSelectedFromTransfers",value:function(t){this.application=t,this.transfer={},this.mode=this.application.status===this.pendingApplicationsConstants.STATUS.INCOMPLETE?this.magicSwitchConstants.MODE.EDIT:this.magicSwitchConstants.MODE.VIEW,this.getTransferApplication(t.dealId,!1)}},{key:"handleApplicationSelectedFromPendingApplications",value:function(t){this.fromPendingApplications=!0,this.application=t,this.transfer={},this.mode=this.application.status===this.pendingApplicationsConstants.STATUS.INCOMPLETE?this.magicSwitchConstants.MODE.EDIT:this.magicSwitchConstants.MODE.VIEW,this.getTransferApplication(t.ms_deal_id||t.dealId,!0)}},{key:"printPage",value:function(){this.$window.print()}},{key:"signManually",value:function(){return this.resetSubmitErrors(),this.data.signature_type=this.magicSwitchConstants.SIGNATURE_TYPES.INK,this.account&&this.account.fromAccount&&(this.account.fromAccount.isMagicSwitchPaperSign=!0),this.completeEsignature()}},{key:"handleAgreement",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=!this.data.agreement}},{key:"handleSignatureAgreement",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=!this.account.signElectronicallyAccepted}},{key:"viewPendingApplications",value:function(){this.fromPendingApplications?this.onClose({isReloadPendingApplications:!0}):(this.GlobalModalsService.showPendingApplications(),this._close())}},{key:"_getAccountFromHash",value:function(t){var e=this;return this.AccountService.getGenericAccountDetails(t).then((function(t){e.account=t.account_summary,e._setMagicSwitchAccountType(e.account),e.isSavings&&e.getPendingTransferApplications(e.data.account.display_name)}))}},{key:"_setMagicSwitchAccountType",value:function(t){-1!==[this.ACCOUNT_PPTS.RSP,this.ACCOUNT_PPTS.TFSA,this.ACCOUNT_PPTS.RIF_ISA].indexOf(t.profile_product_type)?this.account.type=this.accountConstants.ACCOUNT_TYPES.SAVINGS:this.account.type=this.accountConstants.ACCOUNT_TYPES.MUTUAL_FUND,-1!==[this.ACCOUNT_PPTS.MUTUAL_FUND_TFSA,this.ACCOUNT_PPTS.TFSA].indexOf(t.profile_product_type)?this.sourceType=this.type=this.magicSwitchConstants.TYPES.TFSA:-1!==[this.ACCOUNT_PPTS.MUTUAL_FUND_RSP,this.ACCOUNT_PPTS.RSP].indexOf(t.profile_product_type)?this.sourceType=this.type=this.magicSwitchConstants.TYPES.RSP:-1!==[this.ACCOUNT_PPTS.RIF_ISA,this.ACCOUNT_PPTS.MUTUAL_FUND_RIF].indexOf(t.profile_product_type)&&(this.sourceType=this.type=this.magicSwitchConstants.TYPES.RIF)}},{key:"getInstitutions",value:function(){var t=this;this.institutions=[],this.institutionsMap=new r.default;var e={urlVars:{locale:this.locale}};return this.ReferenceDataService.getDataByType(this.ReferenceDataService.TYPES.FINANCIAL_INSTITUTIONS,e).then((function(e){var n=e[t.ReferenceDataService.TYPES.FINANCIAL_INSTITUTIONS];n&&n.forEach((function(e){e.code!==t.magicSwitchConstants.INSTITUTION.OTHER_CODE&&(t.institutions.push(e),t.institutionsMap.set(e.code,e.name))}))}))}},{key:"getPendingTransferApplications",value:function(t){var e=this;return this.pendingApplications=[],this.flowService.enterLoadingMode(),this.PendingApplicationsService.getPendingTransfers().then((function(n){e.$log.debug("response received"),n.service_requests.forEach((function(n){n.to_account===t&&e.pendingApplications.push(n)})),e.pendingApplications.length>0&&e.flowService.moveTo(e.flowService.STATES.PENDING_TRANSFERS),e.flowService.exitLoadingMode()}),(function(t){e.$log.debug("Unable to retrieve pending transfers",t),e.flowService.exitLoadingMode()}))}},{key:"getTransferApplication",value:function(t,e){var n=this;return this.flowService.enterLoadingMode(),this.magicSwitchService.getApplication(t).then((function(i){var a={accountDetailsCase:null};n.$log.debug("response received");var s=n.application.status,r=n.application.submit_date;return n.application=i.application,n.transfer=i.transfer,s!==n.magicSwitchConstants.STATUS.NEW&&s!==n.magicSwitchConstants.STATUS.SUBMITTED||n.application.signature_type!==n.magicSwitchConstants.SIGNATURE_TYPES.ESIGN?n.application.status=s:n.application.status=n.magicSwitchConstants.STATUS.WAIT_FOR_CHEQUE,n.application.dealId=t,n.application.submit_date=r,n.type||(n.sourceType=n.type=n.application.transfer_type),e&&n.application.to_account&&!n.account?a.accountDetailsCase=n.AccountDetailsService.getAccountByDisplayName(n.application.to_account).then((function(t){if(t)n.account=t,n.populateModel(n.application,n.account,n.type),n.mode===n.magicSwitchConstants.MODE.EDIT?n.flowService.returnToStart():n.flowService.moveTo(n.flowService.STATES.PENDING_TRANSFER_DETAILS);else{n.$log.debug("Cannot find account!"),n.showSubmitErrors({response_status:{details:[{technical_description:"Unable to get account details"}]}}),n.mode=n.magicSwitchConstants.MODE.VIEW,n.account={type:n.accountConstants.ACCOUNT_TYPES.SAVINGS},n.flowService.moveTo(n.flowService.STATES.PENDING_TRANSFER_DETAILS)}n.flowService.exitLoadingMode()})).catch((function(t){n.$log.debug("Unable to retrieve account",t),n.showSubmitErrors(t),n.mode=n.magicSwitchConstants.MODE.VIEW,n.account={type:n.accountConstants.ACCOUNT_TYPES.SAVINGS},n.flowService.moveTo(n.flowService.STATES.PENDING_TRANSFER_DETAILS),n.flowService.exitLoadingMode()})):(n.populateModel(n.application,n.account,n.type),n.mode===n.magicSwitchConstants.MODE.EDIT?n.flowService.returnToStart():n.flowService.moveTo(n.flowService.STATES.PENDING_TRANSFER_DETAILS),n.flowService.exitLoadingMode()),n.$q.all(a)}),(function(e){n.$log.error("Failed to get application: ",t),n.showSubmitErrors(e),n.mode=n.magicSwitchConstants.MODE.VIEW,n.account={type:n.accountConstants.ACCOUNT_TYPES.SAVINGS},n.flowService.moveTo(n.flowService.STATES.PENDING_TRANSFER_DETAILS),n.flowService.exitLoadingMode()}))}},{key:"parseAddress",value:function(t){if(t.address_line1){var e=t.address_line1,n=e.substr(0,e.indexOf(" "));if(n){var i=e.substr(e.indexOf(" ")+1);this.data.institutionAddress.street_number=n,this.data.institutionAddress.address_line1=i}else this.data.institutionAddress.street_number="",this.data.institutionAddress.address_line1=t.address_line1}this.data.institutionAddress.city=t.city,this.data.institutionAddress.province=t.province,this.data.institutionAddress.country=t.country,this.data.institutionAddress.address_line2="",this.data.institutionAddress.suite=t.suite,this.data.institutionAddress.postal_code=t.postal_code}},{key:"setPersonalInfo",value:function(){this.displayedInfo=[],this._displayedInfoPushUsername(),this._displayedInfoPushDateOfBirth(),this._displayedInfoPushHomeAddress(),this._displayedInfoPushPrimaryPhone(),this._displayedInfoPushEmail(),this._displayedInfoPushSin()}},{key:"_displayedInfoPushUsername",value:function(){this.displayedInfo.push({order:0,label:"magicSwitch.review.userName",text:this.data.customer.first_name+" "+this.data.customer.last_name})}},{key:"_displayedInfoPushDateOfBirth",value:function(){this.displayedInfo.push({order:1,label:"magicSwitch.review.dateOfBirth",text:this.data.customer.dateOfBirth._i})}},{key:"_displayedInfoPushHomeAddress",value:function(){if(this.data.customer.address_list&&this.data.customer.address_list.length>0){var t=d.default.getDisplayedAddress(this.data.customer,this.displayedInfo);this.displayedInfo=t.displayedInfo;for(var e=this.displayedInfo.length-3,n=0;n<e;n++)this.displayedInfo.pop()}}},{key:"_displayedInfoPushPrimaryPhone",value:function(){if(this.data.customer.phone_list&&this.data.customer.phone_list.length>0){var t=u.default.getDisplayedPhones(this.data.customer,this.displayedInfo,this.preferredPhoneKey);this.displayedInfo=t.displayedInfo;for(var e=this.displayedInfo.length-4,n=0;n<e;n++)this.displayedInfo.pop()}}},{key:"_displayedInfoPushEmail",value:function(){this.data.customer.email&&this.displayedInfo.push({label:"magicSwitch.review.email",text:this.data.customer.email})}},{key:"_displayedInfoPushSin",value:function(){this.data.customer.sin&&this.displayedInfo.push({label:"magicSwitch.review.sin",text:this.data.customer.sin,cbReadonly:!0})}},{key:"_getExternalNumberLabel",value:function(){var t=this.$translate.instant("magicSwitch.externalInfo.accountNumber"),e=this.$translate.instant("magicSwitch.amount.planNumberLabel"),n=this.data.nameOfPlan?" "+e+": "+this.data.nameOfPlan:"";return t+": "+this.data.accountNumber+n}},{key:"getAmountData",value:function(){this.data.institutionAddress.displayAddress=(this.data.institutionAddress.street_number?this.data.institutionAddress.street_number+" ":"")+(this.data.institutionAddress.address_line1?this.data.institutionAddress.address_line1+" ":"")+(this.data.institutionAddress.address_line2?this.data.institutionAddress.address_line2+" ":"")+(this.data.institutionAddress.suite?this.data.institutionAddress.suite+", ":"")+(this.data.institutionAddress.city?this.data.institutionAddress.city+", ":"")+(this.data.institutionAddress.province?this.data.institutionAddress.province+" ":"")+(this.data.institutionAddress.postal_code?this.data.institutionAddress.postal_code:""),this.bankTile={tileDescription:this.$translate.instant("magicSwitch.amount.institutionInfoLabel"),externalName:this.institutionName,externalNumber:this._getExternalNumberLabel(),externalAddress:this.data.institutionAddress.displayAddress}}},{key:"setParentAmountDetails",value:function(){this.account.investment_amount=this.data.transaction.amount,this.account.fullAmount=this.data.isFullAmount}},{key:"isValidAmount",value:function(t){return!!(t&&t>=1)}},{key:"_completeSubFlow",value:function(){this._saveDataForParentFlow(),this.isOnBoarding&&this.flowService.flowIsDone&&this.flowService.flowIsDone({stopEnrollmentFlow:!!this.data.isPension,confirmation:this.data.confirmation})}},{key:"_saveDataForParentFlow",value:function(){this.saveApplication&&!this.data.isPension&&(this.saveApplication.request=this.magicSwitchService.saveMagicSwitch(this.data,this.account.type).application,this.saveApplication.UIData=this.data)}},{key:"submitData",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.flowService.BUTTONS.BTN_ORG.disable=!0,this.resetSubmitErrors(),this.flowService.enterLoadingMode(),this.isUpgradedMutualFundEnrollment&&this._saveDataForParentFlow();var n=this.isUpgradedMutualFundEnrollment?this.onBoardingUpdateFunction():this.magicSwitchService.submitMagicSwitch(this.data,this.account.type);return n.then((function(n){t.$log.debug("response received"),t.data.dealId||(t.data.dealId=t.isUpgradedMutualFund?n.confirmation.ms_deal_id:n.confirmation.deal_id,t.isUpgradedMutualFund&&(t.data.mfDealId=n.confirmation.deal_id));var i=t.$q.when();return e||!t.msmfUpgraded&&t.data.account.type!==t.accountConstants.ACCOUNT_TYPES.SAVINGS||(t.$log.debug("getting esignature"),i=t.$timeout((function(){return t.getEsignature()}),1e3)),t.$log.debug("setting timeout"),i.then((function(){return t.flowService.showLoadingDoneIcon(),t.$timeout((function(){t.flowService.exitLoadingMode(),e&&t.data.account.type===t.accountConstants.ACCOUNT_TYPES.SAVINGS?(t.saved=!0,t.flowService.showConfirmExitUI=!1,t.flowService.moveTo(t.flowService.STATES.DONE_SAVED)):(t.getDoneData(),t.flowService.gotoNextState(t.account.type))}),t.pageFlowConstants.MODAL_VISIBILITY_TIMEOUT)}))})).catch((function(e){t.showSubmitErrors(e),t.$log.error("Submit failed validation:",e),t.flowService.exitLoadingMode(),t.flowService.BUTTONS.BTN_ORG.disable=!1}))}},{key:"hasEsignData",value:function(){return this.data&&this.data.esignSessionKey&&this.data.esignPackageId}},{key:"showSubmitErrors",value:function(t){var e=this;return this.submitErrors=[],this.ErrorService.processError(t,this.ERROR_EVENTS.REQUEST_ERROR).then((function(n){n.code===e.serviceConstants.STATUS_CODES.VALIDATION_ERROR||n.code===e.serviceConstants.STATUS_CODES.RESPONSE_STATUS_MATURITY_DATE?"details"in t.response_status&&Array.isArray(t.response_status.details)&&t.response_status.details.forEach((function(t){if(t.details_code)if(0===t.details_code.indexOf("MESSAGE_")){var n=t.details_code.replace("MESSAGE_","");e.submitErrors.push("global.errorCodes."+n)}else e.submitErrors.push("global.errorCodes."+t.details_code)})):0===n.code.indexOf("MISSING_ESIGNATURE_MESSAGE")?e.submitErrors.push("magicSwitch.esignature.MISSING_ESIGNATURE_MESSAGE"):e.submitErrors.push(n.message)}))}},{key:"showCustomError",value:function(t){this.resetSubmitErrors(),this.submitErrors.push(t)}},{key:"resetSubmitErrors",value:function(){this.$log.debug("resetting submit errors"),this.submitErrors=[]}},{key:"getDoneData",value:function(){this.doneStepsTile={accountName:this.$translate.instant("magicSwitch.done.beneficiaryTitle"),bottomText:this.$translate.instant("magicSwitch.done.beneficiaryText")}}},{key:"getEsignatureManualPrintTile",value:function(){this.esignatureManualPrintTile={header:this.$translate.instant("magicSwitch.esignature.manualSignTileData.header"),subHeader:this.$translate.instant("magicSwitch.esignature.manualSignTileData.subHeader")},this.esignatureManualPrintTiles=[{header:this.$translate.instant("magicSwitch.esignature.manualSignTileData.header"),subHeader:this.$translate.instant("magicSwitch.esignature.manualSignTileData.subHeader")}]}},{key:"viewForm",value:function(){this.PDFRequestService.viewMagicSwitchForm(this.data.dealId)}},{key:"getEsignature",value:function(){var t=this;return this.getEsignatureManualPrintTile(),this.magicSwitchService.getEsignature(this.data,this.isUpgradedMutualFund).then((function(e){switch(e.response_status.status_code){case t.magicSwitchService.STATUS_CODES.SUCCESS:t.data.esignSessionKey=e.confirmation.session_key,t.data.esignPackageId=e.confirmation.package_id,t.data.esignUrl=t.$sce.trustAsResourceUrl(""+t.EnvironmentService.getEsignLiveUrl()+t.data.esignSessionKey);break;default:t.showSubmitErrors(e)}})).catch((function(e){t.$log.debug("error getting esignature from silanis:",e),t.showSubmitErrors(e)}))}},{key:"completeEsignature",value:function(){var t=this;return this.flowService.enterLoadingMode(),this.magicSwitchService.completeEsignature(this.data,this.isUpgradedMutualFund).then((function(e){switch(t.data.confirmation=null,t.isOnBoarding&&t.isSavings&&(t.data.confirmation=e.confirmation),e.response_status.status_code){case t.magicSwitchService.STATUS_CODES.SUCCESS:if(t.isOnBoarding&&t.data.signature_type!==t.magicSwitchConstants.SIGNATURE_TYPES.INK)t._completeSubFlow();else if(t.data.signature_type===t.magicSwitchConstants.SIGNATURE_TYPES.INK){if(t.isOnBoarding&&t.isMF&&t.submitMutualFundApplication)return t.submitMutualFundApplication().then((function(){t.flowService.moveTo(t.flowService.STATES.DONE_SIGN_MANUALLY)})).catch((function(){t.flowService.flowIsDone({submissionFailed:!0})}));t.flowService.moveTo(t.flowService.STATES.DONE_SIGN_MANUALLY)}else t.flowService.moveTo(t.flowService.STATES.DONE_SIGN_ELECTRONICALLY);break;default:t.showSubmitErrors(e)}return t.$q.resolve()})).catch((function(e){t.$log.debug("error completing esignature for silanis:",e),t.showSubmitErrors(e)})).finally((function(){t.flowService.exitLoadingMode()}))}},{key:"populateModel",value:function(t,e,n){this.data.isPension=!1,this.data.isGIC=t.is_gic,this.data.accountNumber=t.account_number?t.account_number:null,this.data.gicMaturityDate=t.maturity_date?moment(t.maturity_date,"YYYY-MM-DD"):this.momentTomorrow,this.data.isGICEarly=t.redeem_early,this.data.nameOfPlan=t.plan_name?t.plan_name:null,this.data.institution=t.institution?t.institution:null,this.data.institution===this.magicSwitchConstants.INSTITUTION.OTHER_CODE?this.data.institutionDropdown=this.magicSwitchConstants.INSTITUTION.OTHER:this.data.institutionDropdown=this.data.institution,this.data.institutionOther=t.institution_other?t.institution_other:null,this.data.institutionName=this.data.institutionDropdown===this.magicSwitchConstants.INSTITUTION.OTHER?this.data.institutionOther:this.institutionsMap.get(this.data.institutionDropdown),t.institution_address?this.parseAddress(t.institution_address):this.data.institutionAddress={},this.data.gicDatePicker.visible=!1,this.data.transaction.amount=t.amount?t.amount:"",this.data.account=e,this.data.type=n,this.data.isFullAmount=t.transfer_all,this.data.dealId=t.dealId?t.dealId:null}},{key:"_resetModel",value:function(){var t=this,e=this.isOnBoarding&&this.type===this.magicSwitchConstants.TYPES.RIF,n=this.sourceType===this.magicSwitchConstants.TYPES.RSP;return this.data={isPension:!(!e||!n)&&null,timeStamp:moment(),isGIC:!1,accountNumber:null,gicMaturityDate:this.momentTomorrow,isGICEarly:!0,institution:null,institutionAddress:{},forms:{externalInfo:{}},gicDatePicker:{selectionMode:this.dateSelectorConstants.DATE_SELECTOR_MODES.SINGLE,visible:!1,minDate:this.momentTomorrow,maxDate:null},transaction:{amount:"",currency:""},account:this.account,type:this.type,sourceType:this.sourceType,isFullAmount:!0,dealId:null,confirmation:null},this.saveApplication&&this.saveApplication.UIData&&(0,s.default)(this.data,this.saveApplication.UIData),this.sourceType!==this.data.sourceType&&(this.data.sourceType=this.sourceType,this.data.isPension=!(!e||!n)&&null),this.data.account&&this.data.account.investment_amount&&(this.data.transaction.amount=this.data.account.investment_amount),this.CustomerInfoService.get().then((function(e){t.data.customer=e.customer,t.updatePrimaryPhone()}))}},{key:"_close",value:function(){var t=this;return this.flowService.showConfirmExitUI?(this.flowService.denyExit(),this.$q.resolve()):this.flowService.warn().then((function(){t._resetModel(),t.onClose&&t.onClose(),t.flowService.returnToStart()}))}},{key:"onModalClose",value:function(t){this.$log.debug("moveMoney onModalClose:",t),this.resetSubmitErrors(),this._close()}},{key:"$onDestroy",value:function(){this.clearESignAgreements(),this.flowService.deactivate()}},{key:"moveBackTo",value:function(e){(0,l.default)(t.prototype.__proto__||(0,a.default)(t.prototype),"moveBackTo",this).call(this,e),this.resetSubmitErrors()}},{key:"denyExit",value:function(){this.resetSubmitErrors(),this.flowService.denyExit()}},{key:"_getIndustryReferenceData",value:function(){var t=this;this.employmentIndustries=[],this.ReferenceDataService.getDataByType([this.referenceDataConstants.TYPES.TPI_INDIVIDUAL_INDUSTRIES]).then((function(e){t.employmentIndustries=e[t.referenceDataConstants.TYPES.TPI_INDIVIDUAL_INDUSTRIES]})).catch((function(e){t.$log.error(e),t.showSubmitErrors(e)}))}},{key:"_getEmploymentStatusText",value:function(){var t=this;if(this.data.customer.employment_status){var e=(0,i.default)(this.customerConstants.API.EMPLOYMENT_STATUS).find((function(e){return t.customerConstants.API.EMPLOYMENT_STATUS[e].KEY===t.data.customer.employment_status}));return this.customerConstants.API.EMPLOYMENT_STATUS[e].TRANSLATION?this.customerConstants.API.EMPLOYMENT_STATUS[e].TRANSLATION:null}return""}},{key:"_getIndustry",value:function(){var t=this;return this.data.customer.occupation.industry_code&&this.employmentIndustries?this.employmentIndustries.find((function(e){return e.code===t.data.customer.occupation.industry_code})):""}},{key:"_getOccupation",value:function(){var t=this;if(this.data.customer.occupation.occupation_code){var e=this._getIndustry(this.data.customer.occupation.industry_code);return e?e.data.find((function(e){return e.code===t.data.customer.occupation.occupation_code})):""}return""}},{key:"prepareESignAgreements",value:function(){return this.isOnBoarding&&(this.msmfUpgraded||this.account.type===this.accountConstants.ACCOUNT_TYPES.SAVINGS)?(this.account.signElectronicallyAccepted=!1,[{actionableId:"magicSwitch_signAgreeTerms",required:!0,modelVar:"signElectronicallyAccepted",labels:[this.$translate.instant("magicSwitch.esignature.agree")],links:[]}]):null}},{key:"clearESignAgreements",value:function(){this.FlowFooterService.clearAgreements()}},{key:"hasSubmitErrors",get:function(){return this.submitErrors&&this.submitErrors.length>0}},{key:"institutionName",get:function(){return this.isMF?this.data.institution:this.data.institutionName}},{key:"isSavings",get:function(){return this.account.type===this.accountConstants.ACCOUNT_TYPES.SAVINGS}},{key:"isMF",get:function(){return this.account.type===this.accountConstants.ACCOUNT_TYPES.MUTUAL_FUND}},{key:"isMagicSwitchPaperSign",get:function(){return this.data&&this.data.signature_type===this.magicSwitchConstants.SIGNATURE_TYPES.INK}},{key:"isUpgradedMutualFundEnrollment",get:function(){return this.isUpgradedMutualFund&&this.isOnBoarding}},{key:"isUpgradedMutualFund",get:function(){return this.msmfUpgraded&&this.isMF}}]),t}();f.$inject=["$log","$translate","$timeout","$window","$filter","$q","MagicSwitchFlowService","MagicSwitchService","GlobalModalsService","$scope","pageFlowConstants","CustomerInfoService","tngDateSelectorConstants","localeConstants","tngTileListConstants","accountConstants","NativeService","PDFRequestService","AccountDetailsService","AccountService","magicSwitchConstants","ReferenceDataService","PendingApplicationsService","pendingApplicationsConstants","EnvironmentService","serviceConstants","ErrorService","errorConstants","$sce","LocaleService","referenceDataConstants","UserSettingsConstants","customerConstants","FlowFooterService","buildConstants"],e.default=f,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog inline-mode="$ctrl.isOnBoarding" on-close="$ctrl.onModalClose(result)" class="c-magic-switch" ng-class="$ctrl.isOnBoarding ? \'c-magic-switch-on-boarding\' : \'\'" hide-close="$ctrl.flowService.isLoading || $ctrl.flowService.showConfirmExitUI"> <header id="magicswitchheader"> <div ng-if="$ctrl.isOnBoarding" ng-class="{\'dialog__header--OBfix\': $ctrl.isOnBoarding}"> {{$ctrl.flowService.currentState.titleKey+($ctrl.isOnBoarding ? \'OB\' : \'\') | translate:{ type: (\'magicSwitch.\'+$ctrl.sourceType | translate) } }} </div> <div ng-if="!$ctrl.isOnBoarding"> <div ng-if="$ctrl.account.type === $ctrl.accountConstants.ACCOUNT_TYPES.MUTUAL_FUND"> <div ng-if="!$ctrl.flowService.showConfirmExitUI"> {{$ctrl.flowService.currentState.titleKey+($ctrl.isOnBoarding ? \'OB\' : \'\') | translate:{ type: (\'magicSwitch.\'+$ctrl.sourceType | translate) } }} </div> </div> <div ng-if="$ctrl.account.type === $ctrl.accountConstants.ACCOUNT_TYPES.SAVINGS"> <div ng-if="$ctrl.flowService.showConfirmExitUI && $ctrl.saveable"> {{ ::\'magicSwitch.headings.exit\' | translate }} </div> <div ng-if="!$ctrl.flowService.showConfirmExitUI"> {{$ctrl.flowService.currentState.titleKey | translate:{ type: (\'magicSwitch.\'+$ctrl.sourceType | translate) } }} </div> </div> </div> </header> <div class="c-move-money__error" ng-show="$ctrl.hasSubmitErrors"> <tng-error-message ng-if="$ctrl.hasSubmitErrors"> <ul> <li ng-repeat="error in $ctrl.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> </div> <tng-confirm-exit confirm-title-key="global.warning.subTitle" ng-show="$ctrl.flowService.showConfirmExitUI && ($ctrl.account.type === $ctrl.accountConstants.ACCOUNT_TYPES.MUTUAL_FUND || (!$ctrl.saveable && $ctrl.account.type === $ctrl.accountConstants.ACCOUNT_TYPES.SAVINGS))"></tng-confirm-exit> <div ng-if="!$ctrl.flowService.inLoadingMode && $ctrl.flowService.showConfirmExitUI && $ctrl.account.type === $ctrl.accountConstants.ACCOUNT_TYPES.SAVINGS && $ctrl.saveable"> <div class="c-confirm-exit"> <p class="margin__b--fix1">{{ ::\'magicSwitch.exit.description1\' | translate }}</p> <p class="margin__b--fix1">{{ ::\'magicSwitch.exit.description2\' | translate }}</p> <div class="c-magic-switch__section--top-margin-small"> <button actionable-id="magic-switch-btn-submit" class="btn btn--tangerine c-magic-switch__btn--width" ng-click="$ctrl.submitData(true)"> {{ ::\'magicSwitch.exit.saveButton\' | translate }} </button> </div> </div> </div> <div ng-if="$ctrl.flowService.isLoading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div ng-if="$ctrl.flowService.isDoneLoading"> <tng-loading-done></tng-loading-done> </div> <div id="scroll-to-top"></div> <div ng-hide="$ctrl.flowService.showConfirmExitUI || $ctrl.flowService.inLoadingMode"> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.PENDING_TRANSFERS"> <tng-pending-transfers account="$ctrl.account" transfers="$ctrl.pendingApplications" flow-service="$ctrl.flowService" goto-transfer="$ctrl.handleApplicationSelectedFromTransfers(application)"> </tng-pending-transfers> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.PENDING_TRANSFER_DETAILS"> <tng-pending-transfer-details account="$ctrl.account" application="$ctrl.application" data="$ctrl.data" transfer="$ctrl.transfer" mf-deal-id="$ctrl.mfDealId"> </tng-pending-transfer-details> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.INTRO"> <tng-transfer-intro account="$ctrl.account" data="$ctrl.data" type="$ctrl.type" source-type="$ctrl.sourceType" basket-count="$ctrl.basketCount" is-on-boarding="$ctrl.isOnBoarding" flow-service="$ctrl.flowService"> </tng-transfer-intro> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.PERSONAL_INFO"> <tng-transfer-personal-info page-id="$ctrl.pageId" data="$ctrl.data"> </tng-transfer-personal-info> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.EXTERNAL_INFO"> <tng-transfer-external-info page-id="$ctrl.pageId" account="$ctrl.account" data="$ctrl.data" type="$ctrl.type" source-type="$ctrl.sourceType" institutions="$ctrl.institutions" goto-step-landing-logic="$ctrl.stepLandingLogic()"> </tng-transfer-external-info> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.AMOUNT"> <tng-transfer-amount data="$ctrl.data" account="$ctrl.account" bank-tile="$ctrl.bankTile" flow-service="$ctrl.flowService" goto-step-landing-logic="$ctrl.stepLandingLogic()" min-fund-amount="$ctrl.minFundAmount"> </tng-transfer-amount> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW"> <tng-transfer-review ng-if="!$ctrl.isUpgradedMutualFundEnrollment" account="$ctrl.account" data="$ctrl.data" type="$ctrl.type" source-type="$ctrl.sourceType" flow-service="$ctrl.flowService" is-on-boarding="$ctrl.isOnBoarding" displayed-info="$ctrl.displayedInfo" institution-name="$ctrl.institutionName"> </tng-transfer-review> <tng-investment-fund-review ng-if="$ctrl.isUpgradedMutualFundEnrollment" account="$ctrl.account" customer="$ctrl.customer" within-magic-switch="true" goto-funding-source-step="$ctrl.returnToParentFlow()" magic-switch-data="$ctrl.data"> </tng-investment-fund-review> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.SIGN_ELECTRONICALLY"> <tng-transfer-esign data="$ctrl.data" esignature-manual-print-tiles="$ctrl.esignatureManualPrintTiles" goto-sign-manually="$ctrl.signManually()"> </tng-transfer-esign> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DONE_SIGN_ELECTRONICALLY"> <tng-transfer-done-esign data="$ctrl.data" account="$ctrl.account" page-id="$ctrl.pageId" goto-pending-applications="$ctrl.viewPendingApplications()" institution-name="$ctrl.institutionName"> </tng-transfer-done-esign> </div> <div ng-if="!$ctrl.msmfUpgraded && $ctrl.flowService.currentState === $ctrl.flowService.STATES.DONE"> <tng-transfer-done data="$ctrl.data" type="$ctrl.type" is-on-boarding="$ctrl.isOnBoarding" done-steps-tile="$ctrl.doneStepsTile" is-mutual-funds-upgraded="$ctrl.msmfUpgraded"> </tng-transfer-done> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DONE_SIGN_MANUALLY"> <tng-transfer-done-ink ng-if="!$ctrl.isMF" data="$ctrl.data" account="$ctrl.account" page-id="$ctrl.pageId" goto-pending-applications="$ctrl.viewPendingApplications()" is-on-boarding="$ctrl.isOnBoarding"> </tng-transfer-done-ink> <tng-transfer-done ng-if="$ctrl.isMF" data="$ctrl.data" type="$ctrl.type" is-on-boarding="$ctrl.isOnBoarding" done-steps-tile="$ctrl.doneStepsTile" is-mutual-funds-upgraded="$ctrl.msmfUpgraded"> </tng-transfer-done> </div> <div ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DONE_SAVED"> <tng-transfer-done-saved data="$ctrl.data" page-id="$ctrl.pageId"> </tng-transfer-done-saved> </div> </div> <footer ng-hide="$ctrl.flowService.showConfirmExitUI || $ctrl.flowService.inLoadingMode"> <div class="c-magic-switch__footer-agreement" ng-if="$ctrl.account.type === $ctrl.accountConstants.ACCOUNT_TYPES.SAVINGS && $ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW"> <input id="agree" name="agree" type="checkbox" class="input c-magic-switch__agreement-checkbox CB_ReadOnly" value="agree" ng-model="$ctrl.data.agreement" ng-readonly="false" ng-change="$ctrl.handleAgreement()" ng-init="$ctrl.handleAgreement()" required/> <label for="agree" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.REVIEW"> {{ :: \'magicSwitch.review.agree1\' | translate }} <a actionable-id="magic-switch-account_terms" target="_blank" href="{{ :: \'magicSwitch.review.accountTermsLink\' | translate }}" class="c-magic-switch__done__refnum">{{ :: \'magicSwitch.review.agreeAccountTerms\' | translate }}</a> <a actionable-id="magic-switch-website_terms" target="_blank" href="{{ :: \'magicSwitch.review.websiteTermsLink\' | translate }}" class="c-magic-switch__done__refnum">{{ :: \'magicSwitch.review.agreeWebsiteTerms\' | translate }}</a> {{ :: \'magicSwitch.review.and\' | translate }} <a actionable-id="magic-switch-privacy_terms" target="_blank" href="{{ :: \'magicSwitch.review.privacyTermsLink\' | translate }}" class="c-magic-switch__done__refnum">{{ :: \'magicSwitch.review.agreePrivacyTerms\' | translate }}</a> </label> </div> <div class="c-magic-switch__footer-agreement" ng-if="$ctrl.hasEsignData() && $ctrl.flowService.currentState === $ctrl.flowService.STATES.SIGN_ELECTRONICALLY"> <input id="agree2" name="agree2" type="checkbox" class="input c-magic-switch__agreement-checkbox CB_ReadOnly" value="agree2" ng-model="$ctrl.account.signElectronicallyAccepted" ng-readonly="false" ng-change="$ctrl.handleSignatureAgreement()" ng-init="$ctrl.handleSignatureAgreement()" required/> <label for="agree2" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.SIGN_ELECTRONICALLY"> {{ :: \'magicSwitch.esignature.agree\' | translate }} </label> </div> <button actionable-id="{{$ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_GRY.type.label)}}" watch-actionable-id="true" class="btn btn--edit" ng-show="$ctrl.flowService.BUTTONS.BTN_GRY.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_GRY.disable" ng-click="$ctrl.flowService.onButtonClick($ctrl.flowService.BUTTONS.BTN_GRY)" ng-class="{\'btn--medium\': $ctrl.isMediumButton}"> {{ $ctrl.flowService.BUTTONS.BTN_GRY.type.label | translate }} </button> <button actionable-id="{{$ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_ORG.type.label)}}" watch-actionable-id="true" class="btn btn--orange" ng-class="{\'CB_ReadOnly\': $ctrl.flowService.CB_DISABLED_BUTTONS.includes($ctrl.flowService.BUTTONS.BTN_ORG.type)}" ng-show="$ctrl.flowService.BUTTONS.BTN_ORG.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_ORG.disable" ng-click="$ctrl.flowService.onButtonClick($ctrl.flowService.BUTTONS.BTN_ORG)"> {{ $ctrl.flowService.BUTTONS.BTN_ORG.type.label | translate }} </button> </footer> <footer ng-show="$ctrl.flowService.showConfirmExitUI && !$ctrl.flowService.inLoadingMode"> <button actionable-id="magic-switch-btn-deny" class="btn btn--edit" ng-click="$ctrl.denyExit()"> {{ \'global.pageFlow.buttons.noBack\' | translate }} </button> <button actionable-id="magic-switch-btn-allow" class="btn btn--tangerine c-magic-switch__btn--width" ng-click="$ctrl.flowService.allowExit()"> {{($ctrl.saveable ? \'magicSwitch.exit.exitButtonLEAVE\' : \'global.pageFlow.buttons.yesCancel\') | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(8)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s,r,o,c,l){(0,a.default)(this,t),this.$q=e,this.$log=n,this.RequesterService=s,this.AVAILABLE_SERVICES=r.AVAILABLE_SERVICES,this.STATUS_CODES=r.STATUS_CODES,this.accountConstants=c,this.magicSwitchConstants=l,this.ACTION_CODES=this.magicSwitchConstants.ACTION_CODES}return(0,s.default)(t,[{key:"saveMagicSwitch",value:function(t,e){return t.account.number=0,this._buildParams(t,e)}},{key:"submitMagicSwitch",value:function(t,e){this.$log.debug("post data object:",t);var n=this.$q.defer(),i=[this.STATUS_CODES.SUCCESS];if(t.dealId){var a={urlVars:{dealId:t.dealId},data:this._buildParams(t,e)};this.RequesterService.request(this.AVAILABLE_SERVICES.MAGIC_SWITCH_UPDATE,a).then((function(t){-1!==i.indexOf(t.response_status.status_code)?n.resolve(t):n.reject(t)})).catch((function(t){n.reject(t)}))}else{var s={data:this._buildParams(t,e)};this.RequesterService.request(this.AVAILABLE_SERVICES.MAGIC_SWITCH_SUBMIT,s).then((function(t){-1!==i.indexOf(t.response_status.status_code)?n.resolve(t):n.reject(t)})).catch((function(t){n.reject(t)}))}return n.promise}},{key:"getApplication",value:function(t){var e=this.$q.defer(),n=[this.STATUS_CODES.SUCCESS],i={urlVars:{dealId:t}};return this.RequesterService.request(this.AVAILABLE_SERVICES.MAGIC_SWITCH_GET_APPLICATION,i).then((function(t){-1!==n.indexOf(t.response_status.status_code)?e.resolve(t):e.reject(t)})).catch((function(t){e.reject(t)})),e.promise}},{key:"_buildParams",value:function(t,e){var n={application:{transfer_type:(e===this.accountConstants.ACCOUNT_TYPES.MUTUAL_FUND?"MF":"")+t.type,transfer_all:t.isFullAmount,amount:t.transaction.amount,institution:t.institution?t.institution:this.magicSwitchConstants.INSTITUTION.OTHER_CODE,account_number:t.accountNumber,plan_name:t.nameOfPlan,institution_address:{suite:t.institutionAddress.suite,city:t.institutionAddress.city,province:t.institutionAddress.province,country:t.institutionAddress.country,address_line1:this.concatenateAddressFields(t),postal_code:t.institutionAddress.postal_code.toUpperCase()},is_gic:t.isGIC,maturity_date:t.isGIC?t.gicMaturityDate.format("YYYY-MM-DD"):"",redeem_early:t.isGICEarly,institution_other:t.institution?null:t.institutionOther}};return n.application.to_account=t.account.number?t.account.number.toString():"",n}},{key:"concatenateAddressFields",value:function(t){return t.institutionAddress.street_number+(t.institutionAddress.address_line1?" "+t.institutionAddress.address_line1:"")+(t.institutionAddress.address_line2?" "+t.institutionAddress.address_line2:"")}},{key:"viewForm",value:function(t){return this.RequesterService.request(this.AVAILABLE_SERVICES.MAGIC_SWITCH_VIEW_FORM,{urlVars:{id:t}})}},{key:"getEsignature",value:function(t,e){var n={urlVars:{dealId:t.dealId},data:this._buildApplicationForEsignature(t,this.ACTION_CODES.PDF_DOCUMENT,e)};return this.RequesterService.request(this.AVAILABLE_SERVICES.MAGIC_SWITCH_ESIGNATURE,n)}},{key:"_buildApplicationForEsignature",value:function(t,e,n){var a={ACTION_CODE:e,application:{transfer_type:(n?"MF":"")+t.type,transfer_all:t.isFullAmount,amount:t.transaction.amount,institution:t.institution?t.institution:this.magicSwitchConstants.INSTITUTION.OTHER_CODE,account_number:t.accountNumber,plan_name:t.nameOfPlan,institution_address:{suite:t.institutionAddress.suite,city:t.institutionAddress.city,province:t.institutionAddress.province,country:t.institutionAddress.country,address_line1:this.concatenateAddressFields(t),postal_code:t.institutionAddress.postal_code.toUpperCase()},is_gic:t.isGIC,maturity_date:t.isGIC?t.gicMaturityDate.format("YYYY-MM-DD"):"",redeem_early:t.isGICEarly,institution_other:t.institution?null:t.institutionOther}};t.account.number&&(a.application.to_account=t.account.number.toString());var s={};switch(e){case this.ACTION_CODES.COMPLETE:s={esign_terms_and_conditions:t.signatureAgreement,signature_type:t.signature_type,session_key:t.esignSessionKey,package_id:t.esignPackageId}}return(0,i.default)(a.application,s),a}},{key:"completeEsignature",value:function(t,e){var n={urlVars:{dealId:t.dealId},data:this._buildApplicationForEsignature(t,this.ACTION_CODES.COMPLETE,e)};return this.RequesterService.request(this.AVAILABLE_SERVICES.MAGIC_SWITCH_ESIGNATURE,n)}}]),t}();o.$inject=["$q","$log","EnvironmentService","RequesterService","serviceConstants","tngDatePickerConstants","accountConstants","magicSwitchConstants"],e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=h(n(15)),a=h(n(177)),s=h(n(0)),r=h(n(2)),o=h(n(264)),c=h(n(266)),l=h(n(265)),u=h(n(267)),d=n(364);function h(t){return t&&t.__esModule?t:{default:t}}var f=function(t){function e(t,n,i,r,c,l,u,d,h,f,p,g,m,_){(0,s.default)(this,e);var v=(0,o.default)(this,(e.__proto__||(0,a.default)(e)).call(this,t,n,i,r,c,h,l,f,p));return v.$window=c,v.BUTTON_TYPES=l.BUTTON_TYPES,v.AMOUNT_INPUT_TYPES=u.AMOUNT_INPUT_TYPES,v.CURRENCY_TYPES=d.CURRENCY_TYPES,v.accountConstants=d,v.$log=t,v.AnchorService=g,v.buildConstants=m,v.EnvironmentService=_,v.STATES={PENDING_TRANSFERS:{titleKey:"magicSwitch.headings.pendingTransfers",gtmSubFlowKey:"magic_switch/pending_transfers"},PENDING_TRANSFER_DETAILS:{titleKey:"magicSwitch.headings.pendingTransferDetails",gtmSubFlowKey:"magic_switch/pending_transfer_details"},INTRO:{titleKey:"magicSwitch.headings.intro",showInInvestmentOB:!0,showInSavingsOB:!0,obStep:1,gtmSubFlowKey:"magic_switch/intro"},PERSONAL_INFO:{titleKey:"magicSwitch.headings.personalInfo",showInInvestmentOB:!1,showInSavingsOB:!1,gtmSubFlowKey:"magic_switch/personal_info"},EXTERNAL_INFO:{titleKey:"magicSwitch.headings.externalInfo",showInInvestmentOB:!0,showInSavingsOB:!0,obStep:2,gtmSubFlowKey:"magic_switch/external_info"},AMOUNT:{titleKey:"magicSwitch.headings.amount",showInInvestmentOB:!0,showInSavingsOB:!0,obStep:3,gtmSubFlowKey:"magic_switch/amount"},REVIEW:{titleKey:"magicSwitch.headings.review",showInInvestmentOB:v.magicSwitchFundsUpgraded,showInSavingsOB:!0,obStep:4,gtmSubFlowKey:"magic_switch/review"},SIGN_ELECTRONICALLY:{titleKey:"magicSwitch.headings.signElectronically",showInInvestmentOB:v.magicSwitchFundsUpgraded,showInSavingsOB:!0,obStep:5,gtmSubFlowKey:"magic_switch/sign_electronically"},DONE:{titleKey:"magicSwitch.headings.done",showInInvestmentOB:!1,showInSavingsOB:!1,gtmSubFlowKey:"magic_switch/done"},DONE_SIGN_ELECTRONICALLY:{titleKey:"magicSwitch.headings.doneSignElectronically",showInInvestmentOB:!1,showInSavingsOB:!1,gtmSubFlowKey:"magic_switch/done_sign_electronically"},DONE_SIGN_MANUALLY:{titleKey:"magicSwitch.headings.doneSignManually",obTitleKey:"magicSwitch.headings.doneSignManually",showInInvestmentOB:v.magicSwitchFundsUpgraded,showInSavingsOB:!0,obStep:6,gtmSubFlowKey:"magic_switch/done_sign_manually"},DONE_SAVED:{titleKey:"magicSwitch.headings.doneSaved",showInInvestmentOB:!1,showInSavingsOB:!1,gtmSubFlowKey:"magic_switch/done_saved"}},v}return(0,l.default)(e,t),(0,r.default)(e,[{key:"returnToStart",value:function(){this._resetState()}},{key:"_resetState",value:function(){(0,c.default)(e.prototype.__proto__||(0,a.default)(e.prototype),"_resetState",this).call(this),this.currentState=this.STATES.INTRO,this.setParentFlow(null),this.flowIsDone=null,this.flowIsRetreating=null,this.flowIsDone||(this.BUTTONS={BTN_GRY:new d.ModalFooterButton(this.BUTTON_TYPES.BACK,!1,!1),BTN_ORG:new d.ModalFooterButton(this.BUTTON_TYPES.NEXT,!0,!1)})}},{key:"_updateUI",value:function(){}},{key:"gotoNextState",value:function(t){var e=this.currentState,n=this.STATES;switch(e){case n.INTRO:this.moveTo(n.PERSONAL_INFO);break;case n.PERSONAL_INFO:this.moveTo(n.EXTERNAL_INFO);break;case n.EXTERNAL_INFO:this.moveTo(n.AMOUNT);break;case n.AMOUNT:this.moveTo(n.REVIEW);break;case n.REVIEW:this.magicSwitchFundsUpgraded||t===this.accountConstants.ACCOUNT_TYPES.SAVINGS?this.moveTo(n.SIGN_ELECTRONICALLY):this.moveTo(n.DONE);break;case n.SIGN_ELECTRONICALLY:this.moveTo(n.DONE_SIGN_ELECTRONICALLY);break;default:this.$log.error("bad state")}}},{key:"_getAnalyticsID",value:function(){return"magicswitch"}},{key:"isCurrentStatePersonalInfo",value:function(){switch(this.currentState){case this.STATES.PERSONAL_INFO:return!0;default:return!1}}},{key:"postMoveTo",value:function(){this.isOnBoarding&&this.hideWarning()}},{key:"postMoveBackTo",value:function(){this.isOnBoarding&&this.hideWarning()}},{key:"magicSwitchFundsUpgraded",get:function(){return this.EnvironmentService.get("magicSwitchFundsUpgraded")&&!this.EnvironmentService.isNative()}},{key:"stepCountInOnboardingMF",get:function(){var t=this;return(0,i.default)(this.STATES).map((function(e){return t.STATES[e]})).filter((function(t){return t.showInInvestmentOB})).length-(this.magicSwitchFundsUpgraded?2:1)}},{key:"stepCountInOnboardingInvF",get:function(){var t=this;return(0,i.default)(this.STATES).map((function(e){return t.STATES[e]})).filter((function(t){return t.showInInvestmentOB})).length-(this.magicSwitchFundsUpgraded?2:1)}},{key:"stepCountInOnboardingSavings",get:function(){var t=this;return(0,i.default)(this.STATES).map((function(e){return t.STATES[e]})).filter((function(t){return t.showInSavingsOB})).length}}]),e}(u.default);f.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","amountInputConstants","accountConstants","$rootScope","AnalyticsService","modalDialogConstants","AnchorService","buildConstants","EnvironmentService"],e.default=f,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5333));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(5334)).default,controller:i.default,bindings:{account:"<",transfers:"<",flowService:"<",gotoTransfer:"&"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.$log=e}return(0,a.default)(t,[{key:"handleStartNewTransfer",value:function(){this.flowService.returnToStart()}},{key:"handleApplicationSelectedFromTransfers",value:function(t){this.gotoTransfer({application:t})}}]),t}();r.$inject=["$log"],e.default=r,t.exports=e.default},function(t,e){t.exports='<p ng-bind-html="\'magicSwitch.pendingTransfers.description\' | translate:{\n  toAccount: $ctrl.account.description,\n  accountNum: ($ctrl.account.display_name | maskNumber) }"></p> <table class="table table--full c-magic-switch__table" ng-hide="$ctrl.flowService.isLoading"> <thead> <tr> <th>{{ \'magicSwitch.pendingTransfers.application\' | translate}}</th> <th class="c-magic-switch__hide-mobile">{{ \'magicSwitch.pendingTransfers.status\' | translate}}</th> <th class="c-magic-switch__hide-mobile">{{ \'magicSwitch.pendingTransfers.date\' | translate}}</th> <th class="c-magic-switch__hide-mobile">{{ \'magicSwitch.pendingTransfers.referenceNumber\' | translate}}</th> <th class="c-magic-switch__show-mobile">{{ \'magicSwitch.pendingTransfers.status\' | translate}}/{{ \'magicSwitch.pendingTransfers.referenceNumber\' | translate}}</th> </tr> </thead> <tbody> <tr class="c-magic-switch__cursor--pointer" ng-repeat="application in $ctrl.transfers | orderBy: \'-create_date\'" ng-click="$ctrl.handleApplicationSelectedFromTransfers(application)"> <td> {{::application.financialInstitution.bank_name}} <div ng-if="application.financialInstitution.amount" class="table__quiet">{{ ::\'magicSwitch.pendingTransfers.approx\' | translate }} {{ ::application.financialInstitution.amount | currency }}</div> <div class="c-magic-switch__show-mobile table__quiet">{{::application.create_date}}</div> </td> <td class="c-magic-switch__hide-mobile"> <div class="table__quiet">{{ \'magicSwitch.pendingTransfers.status_\' + application.status | translate }}</div> </td> <td class="c-magic-switch__hide-mobile"> <div class="table__quiet">{{::application.create_date}}</div> </td> <td> <div class="c-magic-switch__show-mobile">{{ \'magicSwitch.pendingTransfers.status_\' + application.status | translate }}<br/></div><div class="table__quiet">{{::application.dealId}}</div> </td> </tr> </tbody> </table> <div class="c-magic-switch__section--top-margin-small c-magic-switch__section--bottom-margin-small"> <button actionable-id="pending-transaction-start-transfer" class="btn btn--large btn--tangerine" ng-click="$ctrl.handleStartNewTransfer()"> {{ ::\'magicSwitch.pendingTransfers.startNewTransfer\' | translate }} </button> </div>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5336));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(5337)).default,controller:i.default,bindings:{account:"<",application:"<",data:"<",transfer:"<",mfDealId:"<?"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.$log=e,this.PDFRequestService=n,this.pendingApplicationsConstants=a,this.accountConstants=s,this.KYCPendingService=r}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.KYCPendingService.isKycPending().then((function(e){t._isKycPending=e})).catch((function(){t._isKycPending=!1}))}},{key:"viewForm",value:function(){var t=this.isMF&&this.mfDealId?this.mfDealId:this.data.dealId;this.PDFRequestService.viewMagicSwitchForm(t)}},{key:"showDepositFormLink",get:function(){var t=this.pendingApplicationsConstants.STATUS;return this.application&&-1!==[t.NEW,t.SUBMITTED,t.WAIT_FOR_SIGNED_FORM].indexOf(this.application.status)}},{key:"isMF",get:function(){return this.account&&this.account.type===this.accountConstants.ACCOUNT_TYPES.MUTUAL_FUND}},{key:"isMFpaperSignature",get:function(){return this.application&&"ESIGN"!==this.application.signature_type}},{key:"isKycPending",get:function(){return this._isKycPending}},{key:"isMFWaitingForPaperForm",get:function(){return!this.isKycPending&&this.isMF&&this.isMFpaperSignature&&this.showDepositFormLink}},{key:"isMFPaperFormRecieved",get:function(){return!this.isKycPending&&this.isMF&&this.isMFpaperSignature&&!this.showDepositFormLink}},{key:"isMFNonKycEsign",get:function(){return!this.isKycPending&&this.isMF&&!this.isMFpaperSignature}},{key:"subHeader",get:function(){var t=this.pendingApplicationsConstants.STATUS,e=this.application.status;if(this.isMFPaperFormRecieved||this.isMFNonKycEsign)e=t.SENT;else if(this.isMF&&this.isKycPending)return"magicSwitch.pendingTransferDetails.status_help_KYC";return"magicSwitch.pendingTransferDetails.status_help_"+e}}]),t}();r.$inject=["$log","PDFRequestService","pendingApplicationsConstants","accountConstants","KYCPendingService"],e.default=r,t.exports=e.default},function(t,e){t.exports='<p ng-bind-html="$ctrl.subHeader | translate"></p> <div class="c-contributions-modal__balance-grid c-balance-grid"> <div class="c-balance-grid__table"> <div class="c-balance-grid__table__table-column-top has-right-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> {{ :: \'magicSwitch.review.approxInitAmountLabel\' | translate }} </p> <p class="c-balance-grid__value"> <span class="c-magic-switch__done__refnum">{{ $ctrl.application.amount | currency }}</span> </p> </div> </div> <div ng-if="!$ctrl.isMF" class="c-balance-grid__table__table-column-top has-right-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> {{ :: \'magicSwitch.pendingTransferDetails.interestEarned\' | translate }} </p> <p class="c-balance-grid__value"> <span class="c-magic-switch__done__refnum">{{ $ctrl.transfer.estimated_interest_earned | currency }}</span> </p> </div> </div> <div ng-if="!$ctrl.isMF" class="c-balance-grid__table__table-column-top has-left-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> {{ :: \'magicSwitch.pendingTransferDetails.interestRate\' | translate }} </p> <p class="c-balance-grid__value"> <span class="c-magic-switch__done__refnum"> <span ng-bind-html="$ctrl.transfer.interest_rate | numberPercentage"></span> </span> </p> </div> </div> </div> </div> <div class="c-contributions-modal__balance-grid c-balance-grid"> <div class="c-balance-grid__table-column-top c-balance-grid__title confirmation-number"> {{ :: \'magicSwitch.done.confirmationNumber\' | translate }} <span class="c-magic-switch__done__refnum">{{ $ctrl.data.dealId }}</span> </div> <div class="c-balance-grid__table"> <div class="c-balance-grid__table__table-column-top has-right-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> {{ :: \'magicSwitch.pendingTransfers.status\' | translate }} </p> <div> <div ng-if="!$ctrl.isMF"> <p ng-if="!$ctrl.isKycPending" class="c-magic-switch__value"> <strong> {{ \'magicSwitch.pendingTransferDetails.status_\'+$ctrl.application.status | translate }} <a ng-if="$ctrl.showDepositFormLink" actionable-id="pending-transfer-view_form" href="" class="c-magic-switch__done__refnum" ng-click="$ctrl.viewForm()"> {{ :: \'magicSwitch.pendingTransferDetails.form\' | translate }} </a> </strong> </p><p ng-if="$ctrl.isKycPending" class="c-magic-switch__value"> <strong> {{ \'magicSwitch.pendingTransferDetails.status_KYC\' | translate }} </strong> </p> <p></p> </div> <div ng-if="$ctrl.isMF"> <p ng-if="$ctrl.isMFWaitingForPaperForm" class="c-magic-switch__value"> <strong> {{ \'magicSwitch.pendingTransferDetails.status_NEW\' | translate }} <a actionable-id="pending-transfer-view_form" href="" class="c-magic-switch__done__refnum" ng-click="$ctrl.viewForm()"> {{ :: \'magicSwitch.pendingTransferDetails.form\' | translate }} </a> </strong> </p> <p ng-if="$ctrl.isMFNonKycEsign || $ctrl.isMFPaperFormRecieved" class="c-magic-switch__value"> <strong> {{ \'magicSwitch.pendingTransferDetails.status_SENT\' | translate }} </strong> </p> <p ng-if="$ctrl.isKycPending" class="c-magic-switch__value"> <strong> {{ \'magicSwitch.pendingTransferDetails.status_KYC\' | translate }} </strong> </p> </div> </div> </div> </div> <div class="c-balance-grid__table__table-column-top has-right-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> {{ :: \'magicSwitch.review.fundFromLabel\' | translate }} </p> <p class="c-magic-switch__value"> <strong>{{ $ctrl.data.institutionName }} {{ $ctrl.data.accountNumber }}</strong> </p> </div> </div> <div class="c-balance-grid__table__table-column-top has-left-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> {{ :: \'magicSwitch.review.fundToLabel\' | translate }} </p> <p class="c-magic-switch__value"> <strong>{{ $ctrl.account.description }} {{ $ctrl.account.display_name | maskNumber}}</strong> </p> </div> </div> </div> <div class="c-balance-grid__table-column-top c-magic-switch__section--top-margin-tiny"> {{ :: \'magicSwitch.pendingTransferDetails.dateSubmitted\' | translate }} <strong>{{ $ctrl.application.submit_date }}</strong> </div> <div class="c-balance-grid__table-column-top"> {{ :: \'magicSwitch.pendingTransferDetails.dateChanged\' | translate }} <strong>{{ $ctrl.application.status_update_date }}</strong> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5339));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(5340)).default,controller:i.default,bindings:{account:"<",data:"<",type:"<",sourceType:"<",isOnBoarding:"<",basketCount:"<",flowService:"<"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c){(0,i.default)(this,t),this.$log=e,this.accountConstants=n,this.magicSwitchConstants=a,this.pageFlowConstants=s,this.$translate=r,this.PDFRequestService=o,this.buildConstants=c}return(0,a.default)(t,[{key:"$onInit",value:function(){this._configFlowButtons()}},{key:"handlePensionRadioToggle",value:function(t){this.data.isPension=t.isPension,this._configFlowButtons()}},{key:"_configFlowButtons",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=!1,null===this.data.isPension?(this.flowService.BUTTONS.BTN_ORG.disable=!0,this.flowService.BUTTONS.BTN_ORG.type=this.pageFlowConstants.BUTTON_TYPES.NEXT):this.data.isPension?(this.isOnBoarding&&(this.flowService.BUTTONS.BTN_GRY.show=!1),this.flowService.BUTTONS.BTN_ORG.type=this.isOnBoarding&&this.basketCount>1?this.pageFlowConstants.BUTTON_TYPES.SKIP:this.pageFlowConstants.BUTTON_TYPES.DONE):(this.flowService.BUTTONS.BTN_ORG.type=this.pageFlowConstants.BUTTON_TYPES.NEXT,this.isOnBoarding&&(this.flowService.BUTTONS.BTN_GRY.show=!0))}},{key:"downloadPDFForm",value:function(){var t=this.$translate.instant("magicSwitch.intro.pensionPanel.t2151FormLink");this.PDFRequestService.openPDFURL(t)}}]),t}();r.$inject=["$log","accountConstants","magicSwitchConstants","pageFlowConstants","$translate","PDFRequestService","buildConstants"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div> <p>{{ \'magicSwitch.intro.paragraph1_\'+$ctrl.account.type | translate:{ type: (\'magicSwitch.\'+$ctrl.sourceType | translate) } }}</p> <p ng-bind-html="\'magicSwitch.intro.paragraph2\' | translate:{ type: (\'magicSwitch.\'+$ctrl.sourceType | translate) }"> </p> </div> <div class="c-magic-switch__panel c-magic-switch__panel--margin-large"> <h3 class="margin__b--fix2">{{ ::\'magicSwitch.intro.panel.header\' | translate }}</h3> <p class="margin__b--fix1">{{ ::\'magicSwitch.intro.panel.needed1\' | translate }}</p> <p class="margin__b--fix1"> {{ ::\'magicSwitch.intro.panel.needed2\' | translate }} </p> <p class="c-magic-switch__panel__paragraph--no-margin" ng-if="$ctrl.type !== $ctrl.magicSwitchConstants.TYPES.TFSA"> {{ ::\'magicSwitch.intro.panel.needed3\' | translate }} </p> </div> <div ng-if="$ctrl.sourceType === $ctrl.magicSwitchConstants.TYPES.RSP"> <h3 class="margin__b--fix2"> {{ :: \'magicSwitch.intro.pensionLabel_\'+$ctrl.account.type | translate:{ type: (\'magicSwitch.\'+$ctrl.sourceType | translate) } }} <tng-help-bubble> {{ :: \'magicSwitch.intro.tooltip\' | translate}} </tng-help-bubble> </h3> <div> <div class="field__group--inline"> <div class="field"> <input id="CAD_radio" name="pills" class="input input--pill" type="radio" ng-checked="$ctrl.data.isPension" ng-click="$ctrl.handlePensionRadioToggle({isPension: true})" required/> <label for="CAD_radio">{{ :: \'global.yes\' | translate }}</label> </div> <div class="field margin__l--fix1"> <input id="USD_radio" name="pills" class="input input--pill" type="radio" ng-checked="$ctrl.data.isPension === false" ng-click="$ctrl.handlePensionRadioToggle({isPension: false})" required/> <label for="USD_radio">{{ :: \'global.no\' | translate }}</label> </div> </div> </div> </div> <div class="c-magic-switch__panel--margin-large" ng-show="$ctrl.data.isPension"> <div class="c-magic-switch__panel"> <h3 class="c-magic-switch__done__stepTitle"> {{ \'magicSwitch.intro.pensionPanel.text1_\'+$ctrl.account.type | translate:{ type: (\'magicSwitch.\'+$ctrl.sourceType | translate) } }} </h3> <div ng-if="$ctrl.account.type === $ctrl.accountConstants.ACCOUNT_TYPES.SAVINGS"> <div class="c-magic-switch__done__step"> <div class="c-magic-switch__done__step__num">1</div> <p class="c-magic-switch__done__no-padding-p step__text">{{ \'magicSwitch.intro.pensionPanel.text2_\'+$ctrl.account.type | translate }} <a href actionable-id="transfer-intro-form_link" ng-click="$ctrl.downloadPDFForm()" class="c-magic-switch__done__refnum"> {{ \'magicSwitch.intro.pensionPanel.transferform_\'+$ctrl.account.type | translate }} </a> {{ \'magicSwitch.intro.pensionPanel.text3_\'+$ctrl.account.type | translate }} </p> </div> <div class="c-magic-switch__done__step"> <div class="c-magic-switch__done__step__num">2</div> <p class="c-magic-switch__done__done__no-padding-p step__text" ng-bind-html="\'magicSwitch.intro.pensionPanel.text4_\'+$ctrl.account.type | translate"></p> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5342));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(5343)).default,controller:i.default,bindings:{pageId:"<",data:"<"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(0),s=(i=a)&&i.__esModule?i:{default:i};var r=function t(e){(0,s.default)(this,t),this.$log=e};r.$inject=["$log"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div> <p>{{ ::\'magicSwitch.personalInfo.header\' | translate }}</p> </div> <form class="c-basic-info__form narrow-width-section" actionable-id="{{ ::$ctrl.pageId }}"> <div class="field disable-selects"> <label>{{ \'magicSwitch.personalInfo.name\' | translate}}</label> <tng-salutation-select is-read-only="true" input-name="{{ ::$ctrl.pageId }}_salutation" init-value="$ctrl.data.customer.title" ng-if="$ctrl.data.customer.title"></tng-salutation-select> </div> <div class="grid__container"> <div class="field styleguide-grid-unit grid__column--1of2"> <input readonly="readonly" actionable-id="{{ ::$ctrl.pageId }}_firstName" class="input" type="text" ng-model="$ctrl.data.customer.first_name"/> </div> <div class="field styleguide-grid-unit grid__column--1of2"> <input readonly="readonly" actionable-id="{{ ::$ctrl.pageId }}_lastName" class="input" type="text" ng-model="$ctrl.data.customer.last_name"/> </div> </div> <div class="field disable-selects"> <label>{{ \'clientOnboarding.basicInfoForm.address\' | translate }}</label> <tng-address-form-fields page-id="{{ $ctrl.pageId }}" address-object="$ctrl.data.customer.addresses.HOME" is-read-only="true"> </tng-address-form-fields> </div> <div class="c-general__component-column__component first-phone"> <div class="c-basic-info__edit__field__label" translate-cloak>{{ \'userSettings.general.basicInfo.editModal.homePhone.label\' | translate }}</div> <tng-phone-input ng-model="$ctrl.data.customer.phoneNumbers.HOME.number" ng-readonly="true" input-name="user-settings__basic-info__edit-modal__home-phone"> </tng-phone-input> </div> <div class="c-general__component-column__component"> <div class="c-basic-info__edit__field__label" translate-cloak>{{ \'userSettings.general.basicInfo.editModal.mobilePhone.label\' | translate }}</div> <tng-phone-input ng-model="$ctrl.data.customer.phoneNumbers.CELL.number" ng-readonly="true" input-name="user-settings__basic-info__edit-modal__mobile-phone"> </tng-phone-input> </div> <div class="c-general__component-column__component clearfix"> <div class="c-basic-info__edit__field__label" translate-cloak>{{ \'userSettings.general.basicInfo.editModal.workPhone.label\' | translate }}</div> <tng-phone-input class="c-basic-info__edit__field__input--work-phone" ng-model="$ctrl.data.customer.phoneNumbers.BUSINESS.number" ng-readonly="true" input-name="user-settings__basic-info__edit-modal__work-phone"> </tng-phone-input> <div class="field c-basic-info__edit__field__input--work-phone-ext"> <input class="input" type="tel" ng-model="$ctrl.data.customer.phoneNumbers.BUSINESS.extension" placeholder="{{ ::\'userSettings.general.basicInfo.editModal.workPhone.extPlaceholder\' | translate }}" translate-cloak readonly="readonly" actionable-id="user-settings__basic-info__edit-modal__work-phone-ext"/> </div> </div> <div class="field"> <label class="phone-label"> {{ \'magicSwitch.personalInfo.primaryPhoneNumber\' | translate }} </label> <div class="c-basic-info__primary-phone-select-wrapper field__group--wrap"> <div class="field"> <input class="input input--tangerine-radio" actionable-id="{{ ::$ctrl.pageId }}_primary-phone-number-home" type="radio" ng-model="$ctrl.data.customer.selectedPhoneNumber" ng-disabled="true" readonly="readonly" value="HOME"/> <label for="{{ ::$ctrl.pageId }}_primary-phone-number-home" class="external-info__phone-radio">{{ \'clientOnboarding.basicInfoForm.phonenumberType.home\' | translate }}</label> </div> <div class="field"> <input class="input input--tangerine-radio" actionable-id="{{ ::$ctrl.pageId }}_primary-phone-number-mobile" type="radio" ng-model="$ctrl.data.customer.selectedPhoneNumber" ng-disabled="true" value="CELL"/> <label for="{{ ::$ctrl.pageId }}_primary-phone-number-mobile" class="external-info__phone-radio">{{ \'clientOnboarding.basicInfoForm.phonenumberType.mobile\' | translate }}</label> </div> </div> </div> <div class="field"> <label>{{ \'clientOnboarding.basicInfoForm.email\' | translate }}</label> <input type="email" readonly="readonly" class="input" actionable-id="{{ ::$ctrl.pageId }}_email" ng-model="$ctrl.data.customer.email" placeholder="{{ \'clientOnboarding.basicInfoForm.placeholders.email\' | translate }}"/> </div> <div class="field"> <label> {{ \'clientOnboarding.basicInfoForm.sin\' | translate }} <tng-help-bubble> {{ :: \'magicSwitch.personalInfo.incorrectWarning\' | translate}} </tng-help-bubble> </label> <input readonly="readonly" actionable-id="{{ ::$ctrl.pageId }}_sin" class="input CB_DataMask" type="tel" ng-model="$ctrl.data.customer.sin"/> </div> <div class="field"> <label> {{ \'clientOnboarding.basicInfoForm.dateOfBirth\' | translate }} <tng-help-bubble> {{ :: \'magicSwitch.personalInfo.incorrectWarning\' | translate}} </tng-help-bubble> </label> <input ng-disabled="true" readonly="readonly" date-format="DD/MM/YYYY" ng-model="$ctrl.data.customer.dateOfBirth" actionable-id="{{ ::$ctrl.pageId }}_dateOfBirth" type="text" class="input" placeholder="{{ ::\'global.datePicker.placeholder\' | translate }}"/> </div> <div class="field"> <label>{{ \'userSettings.general.basicInfo.occupationStatus\' | translate }}</label> <input ng-disabled="true" readonly="readonly" type="text" class="input" value="{{ $ctrl.data.employmentInfo.employmentStatus | translate }}"/> </div> <div class="field" ng-if="$ctrl.data.showEmployed"> <label>{{ \'userSettings.general.basicInfo.industry\' | translate }}</label> <input ng-disabled="true" readonly="readonly" type="text" class="input" ng-model="$ctrl.data.employmentInfo.industry"/> </div> <div class="field" ng-if="$ctrl.data.showEmployed"> <label>{{ \'userSettings.general.basicInfo.occupation\' | translate }}</label> <input ng-disabled="true" readonly="readonly" type="text" class="input" ng-model="$ctrl.data.employmentInfo.occupation"/> </div> <div class="field" ng-if="$ctrl.data.showEmployed"> <label>{{ \'userSettings.general.basicInfo.employerName\' | translate }}</label> <input ng-disabled="true" readonly="readonly" type="text" class="input" ng-model="$ctrl.data.employmentInfo.employerName"/> </div> </form> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5345));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(5346)).default,controller:i.default,require:{parentController:"^tngMagicSwitch"},bindings:{pageId:"<",account:"<",data:"<",type:"<",sourceType:"<",institutions:"<",gotoStepLandingLogic:"&"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.accountConstants=n,this.magicSwitchConstants=a,this.$filter=r,this.institutionOptions=[],this.institutionOther={code:"other",name:s.instant("magicSwitch.externalInfo.other")},this.buildConstants=o}return(0,a.default)(t,[{key:"$onInit",value:function(){document.getElementById("magicswitchheader").scrollIntoView(!0),this.institutionOptions=this.$filter("orderBy")(this.institutions,"name").concat([this.institutionOther])}},{key:"stepLandingLogic",value:function(){this.gotoStepLandingLogic()}},{key:"handleIsGICRadioToggle",value:function(t){this.data.isGIC=t.isGIC}},{key:"handleIsGICEarlyRadioToggle",value:function(t){this.data.isGICEarly=t.isGICEarly,this.data.isGICEarly?this.data.gicDatePicker.maxDate=null:this.data.gicDatePicker.maxDate=moment().startOf("day").add(2,"month")}}]),t}();r.$inject=["$log","accountConstants","magicSwitchConstants","$translate","$filter","buildConstants"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div> <p>{{ ::\'magicSwitch.externalInfo.paragraph1\' | translate:{ type: (\'magicSwitch.\'+$ctrl.sourceType | translate) } }}</p> </div> <div class="field"> <label> {{ :: \'magicSwitch.externalInfo.isGICheader\' | translate:{ type: (\'magicSwitch.\'+$ctrl.sourceType | translate) } }} </label> <div class="field__group--inline"> <div class="field c-magic-switch__text--no-margin"> <input id="externalIsGICYes" name="externalIsGICYes" class="input input--pill" type="radio" ng-checked="$ctrl.data.isGIC" ng-click="$ctrl.handleIsGICRadioToggle({isGIC: true})"/> <label for="externalIsGICYes">{{ :: \'global.yes\' | translate }}</label> </div> <div class="field c-magic-switch__text--no-vertical-margin margin__l--fix1"> <input id="externalIsGICNo" name="externalIsGICNo" class="input input--pill" type="radio" ng-checked="!$ctrl.data.isGIC" ng-click="$ctrl.handleIsGICRadioToggle({isGIC: false})"/> <label for="externalIsGICNo">{{ :: \'global.no\' | translate }}</label> </div> </div> </div> <form class="c-basic-info__form c-magic-switch__transfer-external-info__form narrow-width-section" id="externalInfoForm" name="$ctrl.data.forms.externalInfo" novalidate> <div ng-show="$ctrl.data.isGIC"> <div class="field c-magic-switch__field--label-fix2"> <input id="isGICEarlyYes" name="isGICEarlyYes" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.data.isGICEarly" ng-click="$ctrl.handleIsGICEarlyRadioToggle({isGICEarly: true})"/> <label for="isGICEarlyYes" class="label-fix2">{{ :: \'magicSwitch.externalInfo.gicEarlyYes\' | translate }}</label> </div> <div class="field c-magic-switch__field--label-fix2"> <input id="isGICEarlyNo" name="isGICEarlyNo" class="input input--tangerine-radio" type="radio" ng-checked="!$ctrl.data.isGICEarly" ng-click="$ctrl.handleIsGICEarlyRadioToggle({isGICEarly: false})"/> <label for="isGICEarlyNo" class="label-fix2">{{ :: \'magicSwitch.externalInfo.gicEarlyNo\' | translate }}</label> </div> <div class="field c-magic-switch top-margin-20" ng-if="!$ctrl.data.isGICEarly"> <p>{{ ::\'magicSwitch.externalInfo.maturityDateLimit\' | translate }}</p> </div> <div class="field"> <label> {{ \'magicSwitch.externalInfo.gicMaturityDate\' | translate }} </label> <tng-date-selector show-input-display="true" selection-mode="$ctrl.data.gicDatePicker.selectionMode" selected-date="$ctrl.data.gicMaturityDate" min-date="$ctrl.data.gicDatePicker.minDate" max-date="$ctrl.data.gicDatePicker.maxDate" hide-frequency-selector="true" hide-selection-mode-selector="true"> </tng-date-selector> <div class="field c-magic-switch top-margin-20" ng-if="!$ctrl.data.isGICEarly && $ctrl.parentController.isSavings"> <p><strong>{{ ::\'magicSwitch.externalInfo.startInterest\' | translate }}</strong></p> </div> </div> </div> <div class="field"> <label>{{ \'magicSwitch.externalInfo.accountNumber\' | translate }}</label> <input id="accountNumber" name="accountNumber" type="text" class="input CB_DataMask" ng-model="$ctrl.data.accountNumber" ng-readonly="false" required maxlength="40" autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="{{ \'magicSwitch.externalInfo.enterHere\' | translate }}" ng-class="{\'warning\': $ctrl.data.forms.externalInfo.accountNumber.$invalid\n              && $ctrl.data.forms.externalInfo.accountNumber.$dirty}"/> <div ng-messages="$ctrl.data.forms.externalInfo.accountNumber.$error" ng-show="$ctrl.data.forms.externalInfo.accountNumber.$dirty" class="field__error"> <p ng-message="required"> {{\'magicSwitch.validation.isRequired\' | translate}} </p> </div> </div> <div class="field" ng-if="$ctrl.account.type === $ctrl.accountConstants.ACCOUNT_TYPES.SAVINGS"> <label>{{ \'magicSwitch.externalInfo.nameOfPlan_\'+$ctrl.account.type | translate }}</label> <input id="nameOfPlan" name="nameOfPlan" type="text" class="input" maxlength="40" ng-model="$ctrl.data.nameOfPlan" ng-readonly="false" placeholder="{{ \'magicSwitch.externalInfo.enterHere\' | translate }}"/> </div> <div class="field"> <label>{{ \'magicSwitch.externalInfo.institution\' | translate }}</label> <div ng-if="$ctrl.account.type === $ctrl.accountConstants.ACCOUNT_TYPES.MUTUAL_FUND"> <input id="institution" name="institution" type="text" class="input" ng-model="$ctrl.data.institution" ng-readonly="false" required placeholder="{{ \'magicSwitch.externalInfo.enterHere\' | translate }}" ng-class="{\'warning\': $ctrl.data.forms.externalInfo.institution.$invalid\n              && $ctrl.data.forms.externalInfo.institution.$dirty}"/> <div ng-messages="$ctrl.data.forms.externalInfo.institution.$error" ng-show="$ctrl.data.forms.externalInfo.institution.$dirty" class="field__error"> <p ng-message="required"> {{\'magicSwitch.validation.isRequired\' | translate}} </p> </div> </div> <div ng-if="$ctrl.account.type === $ctrl.accountConstants.ACCOUNT_TYPES.SAVINGS"> <tng-select-autocomplete input-id="transferExternal_institution" is-static="true" ng-model="$ctrl.data.institutionDropdown" ng-required="true" on-select="$ctrl.stepLandingLogic()" options="$ctrl.institutionOptions" option-label-key="name" option-value-key="code" placeholder="{{::\'magicSwitch.externalInfo.select\' | translate }}"></tng-select-autocomplete> <div ng-if="$ctrl.data.institutionDropdown === $ctrl.magicSwitchConstants.INSTITUTION.OTHER"> <br/> <input id="institutionOther" name="institutionOther" type="text" class="input" required maxlength="40" ng-change="$ctrl.stepLandingLogic()" ng-model="$ctrl.data.institutionOther" ng-readonly="false" placeholder="{{ \'magicSwitch.externalInfo.enterHere\' | translate }}" ng-class="{\'warning\': $ctrl.data.forms.externalInfo.institutionOther.$invalid\n                  && $ctrl.data.forms.externalInfo.institutionOther.$dirty}"/> </div> <div ng-messages="$ctrl.data.forms.externalInfo.institutionOther.$error" ng-show="$ctrl.data.forms.externalInfo.institutionOther.$dirty" class="field__error"> <p ng-message="required"> {{\'magicSwitch.validation.isRequired\' | translate}} </p> </div> </div> </div> <h3 class="margin__b--fix1 c-magic-switch--margin-t-2 top-margin-40"> {{ :: \'magicSwitch.externalInfo.bankAddressTitle\' | translate }} </h3> <div> <p>{{ ::\'magicSwitch.externalInfo.bankAddressDescription\' | translate }}</p> </div> <div class="field c-magic-switch__section--bottom-margin-extra-large"> <tng-address-form-fields page-id="{{::$ctrl.pageId}}" address-object="$ctrl.data.institutionAddress" is-read-only="false" street-perfect="true" is-required="true"> </tng-address-form-fields> </div> </form> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5348));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(5349)).default,controller:i.default,require:{parentController:"^tngMagicSwitch"},bindings:{data:"<",account:"<",bankTile:"<",flowService:"<",gotoStepLandingLogic:"&",minFundAmount:"<?"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.$translate=n,this.$filter=a,this.tileListConstants=s,this.AMOUNT_INPUT_TYPES=r.AMOUNT_INPUT_TYPES,this.EnvironmentService=o,this.isToggled=!1}return(0,a.default)(t,[{key:"$onInit",value:function(){document.getElementById("magicswitchheader").scrollIntoView(!0)}},{key:"stepLandingLogic",value:function(t){t&&this._validateAmount(t),this.gotoStepLandingLogic()}},{key:"_validateAmount",value:function(t){this.parentController.isOnBoarding&&this.parentController.isMF&&t<this.minFundAmount?this.amountInvalidMsg=this.$translate.instant("investmentFund.amount.errors.belowMin",{minAmount:this.$filter("currency")(this.minFundAmount,void 0,0)}):void 0!==this.amountInvalidMsg&&delete this.amountInvalidMsg}},{key:"handleIsFullAmountRadioToggle",value:function(t){this.data.isFullAmount=t.isFullAmount,this.account.fullAmount=t.isFullAmount,this.isToggled=!0}},{key:"applyIEFix",get:function(){return this.EnvironmentService.isIE()}}]),t}();r.$inject=["$log","$translate","$filter","tngTileListConstants","amountInputConstants","EnvironmentService"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-magic-switch-transfer-amount" ng-class="{\'ie-ms-amount-margin-fix\': ($ctrl.applyIEFix && $ctrl.isToggled)}"> <p>{{ ::\'magicSwitch.amount.paragraph1\' | translate }}</p> <tng-amount-input on-amount-change="$ctrl.stepLandingLogic(amount)" input-type="$ctrl.AMOUNT_INPUT_TYPES.STANDARD" ng-model="$ctrl.data.transaction.amount" reset-on="$ctrl.data.isFullAmount"> </tng-amount-input> <div ng-if="$ctrl.amountInvalidMsg !== undefined" class="field__error"> <p>{{ $ctrl.amountInvalidMsg }}</p> </div> <div class="field"> <input id="isFullAmountNo" name="isFullAmountNo" class="input input--tangerine-radio" type="radio" ng-checked="!$ctrl.data.isFullAmount" ng-click="$ctrl.handleIsFullAmountRadioToggle({isFullAmount: false})"/> <label class="balance-option-label partial" for="isFullAmountNo">{{ :: \'magicSwitch.amount.partialTransfer\' | translate }}</label> </div> <div class="field top-marign-20"> <input id="isFullAmountYes" name="isFullAmountYes" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.data.isFullAmount" ng-click="$ctrl.handleIsFullAmountRadioToggle({isFullAmount: true})"/> <label class="balance-option-label full" for="isFullAmountYes">{{ :: \'magicSwitch.amount.fullTransfer\' | translate }}</label> </div> <tng-tile-list tile-data="$ctrl.bankTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.externalAccount" all-actionable="true" on-tile-click="$ctrl.flowService.moveBackTo($ctrl.flowService.STATES.EXTERNAL_INFO)" class="c-magic-switch__single-tile CB_DoNotShow top-margin-40"> </tng-tile-list> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5351));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(5352)).default,controller:i.default,bindings:{account:"<",data:"<",type:"<",sourceType:"<",flowService:"<",isOnBoarding:"<",displayedInfo:"<",institutionName:"<"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c){(0,i.default)(this,t),this.$log=e,this.tileListConstants=n,this.accountConstants=a,this.$translate=s,this.$filter=r,this.DateService=o,this.buildConstants=c}return(0,a.default)(t,[{key:"$onInit",value:function(){this.getReviewData()}},{key:"_getExternalNumberLabel",value:function(){var t=this.$translate.instant("magicSwitch.externalInfo.accountNumber"),e=this.$translate.instant("magicSwitch.amount.planNumberLabel"),n=this.data.nameOfPlan?" "+e+": "+this.data.nameOfPlan:"";return t+": "+this.data.accountNumber+n}},{key:"getReviewData",value:function(){this.data.isGIC&&(this.gicMaturityDate=this.DateService.convertToFormattedMonthDayYear(this.data.gicMaturityDate)),this.reviewBankTile={tileDescription:this.$translate.instant("magicSwitch.review.fundFromLabel"),externalName:this.institutionName,externalNumber:this._getExternalNumberLabel(),externalAddress:this.data.institutionAddress.displayAddress},this.reviewPortfolioTile={tileDescription:this.$translate.instant("magicSwitch.review.porfolioLabel"),accountName:this.account.nickname?this.account.nickname:this.account.product_description,bottomText:this.account.description},this.isOnBoarding?this.reviewFundToTile={tileDescription:this.$translate.instant("magicSwitch.review.fundToLabel"),accountName:this.$translate.instant("magicSwitch.review.enrollmentProductDescription",{productDescription:this.account.product_description})}:this.reviewFundToTile={tileDescription:this.$translate.instant("magicSwitch.review.fundToLabel"),accountName:this.account.description+" "+this.$filter("maskNumber")(this.account.display_name),amount:""+this.account.account_balance},this.reviewAmountTile={header:this.getAmountLabel(),amount:this.data.transaction.amount},this.reviewFundTile={tileDescription:this.$translate.instant("magicSwitch.review.fundFromOB"),accountName:this.$translate.instant("magicSwitch.review.external")+" "+this.type},this.reviewGICTile={tileDescription:this.$translate.instant("magicSwitch.review.GICTitle"),accountName:this.gicMaturityDate,bottomText:this.data.isGICEarly?this.$translate.instant("magicSwitch.review.GICEarly"):this.$translate.instant("magicSwitch.review.GICLater")}}},{key:"getAmountLabel",value:function(){return this.data.isFullAmount?this.$translate.instant("magicSwitch.review.approxInitAmountLabelOB"):this.$translate.instant("magicSwitch.review.transferAmountLabel")}}]),t}();r.$inject=["$log","tngTileListConstants","accountConstants","$translate","$filter","DateService","buildConstants"],e.default=r,t.exports=e.default},function(t,e){t.exports='<p ng-bind-html="\'magicSwitch.review.description_\'+ $ctrl.account.type | translate:{\n  amountType: ($ctrl.data.isFullAmount ? \'magicSwitch.review.fullTransfer\' : \'magicSwitch.review.partialTransfer\' | translate),\n  fromAccount: $ctrl.institutionName,\n  toAccount: (!$ctrl.account.isRifIsa ? $ctrl.account.description : \'magicSwitch.review.rifProductDescription\' | translate: { rifDescription : $ctrl.account.product_description }),\n  type: (\'magicSwitch.\'+$ctrl.sourceType | translate) }"> </p> <div ng-if="$ctrl.account.type === $ctrl.accountConstants.ACCOUNT_TYPES.MUTUAL_FUND"> <h3> {{ :: \'magicSwitch.review.investmentFundTitle\' | translate }} </h3> <tng-tile-list tile-data="$ctrl.reviewPortfolioTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" all-actionable="false" class="c-magic-switch__single-tile" short-tile="false"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.reviewAmountTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.amount" all-actionable="true" on-tile-click="$ctrl.flowService.moveBackTo($ctrl.flowService.STATES.AMOUNT)" class="c-magic-switch__single-tile"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.reviewFundTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.flowService.moveBackTo($ctrl.flowService.STATES.EXTERNAL_INFO)" all-actionable="true" ng-if="$ctrl.isOnBoarding" class="c-magic-switch__single-tile CB_DoNotShow"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.reviewBankTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.externalAccount" all-actionable="true" on-tile-click="$ctrl.flowService.moveBackTo($ctrl.flowService.STATES.EXTERNAL_INFO)" class="c-magic-switch__single-tile" ng-class="{\'c-magic-switch__single-tile--last-tile\': (!$ctrl.data.isGIC || !$ctrl.data.gicMaturityDate)}"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.reviewGICTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.flowService.moveBackTo($ctrl.flowService.STATES.EXTERNAL_INFO)" all-actionable="true" class="c-magic-switch__single-tile c-magic-switch__single-tile--last-tile" short-tile="false" ng-if="$ctrl.data.isGIC && $ctrl.data.gicMaturityDate"> </tng-tile-list> </div> <div ng-if="$ctrl.account.type === $ctrl.accountConstants.ACCOUNT_TYPES.SAVINGS"> <div class="c-magic-switch__component"> <div ng-if="$ctrl.isOnBoarding" class="margin__t--fix2 margin__b--fix1"> <b>{{ ::\'magicSwitch.review.externalInfoTitle\' | translate:{ type: (\'magicSwitch.\'+$ctrl.type | translate) } }}</b> </div> <tng-tile-list tile-data="$ctrl.reviewAmountTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.amount" all-actionable="true" on-tile-click="$ctrl.flowService.moveBackTo($ctrl.flowService.STATES.AMOUNT)" class="c-magic-switch__single-tile"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.reviewBankTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.externalAccount" all-actionable="true" on-tile-click="$ctrl.flowService.moveBackTo($ctrl.flowService.STATES.EXTERNAL_INFO)" class="c-magic-switch__single-tile CB_DoNotShow"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.reviewGICTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" on-tile-click="$ctrl.flowService.moveBackTo($ctrl.flowService.STATES.EXTERNAL_INFO)" all-actionable="true" class="c-magic-switch__single-tile" short-tile="false" ng-if="$ctrl.data.isGIC && $ctrl.data.gicMaturityDate"> </tng-tile-list> <tng-tile-list tile-data="$ctrl.reviewFundToTile" tile-type="$ctrl.tileListConstants.TILE_TYPE.account" all-actionable="false" class="c-magic-switch__single-tile c-magic-switch__single-tile--last-tile" short-tile="false"> </tng-tile-list> </div> <div class="c-magic-switch__component" ng-if="!$ctrl.isOnBoarding"> <div class="c-magic-switch__section--top-margin-mid"> <div class="c-basic-info"> <div class="heading--sub2"> {{ \'magicSwitch.review.personalInformation\' | translate }} </div> <div class="c-general__sub-component__settings-table-container"> <tng-settings-table settings="$ctrl.displayedInfo"></tng-settings-table> </div> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5354));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(5355)).default,controller:i.default,require:{parentController:"^tngMagicSwitch"},bindings:{data:"<",esignatureManualPrintTiles:"<",gotoSignManually:"&"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.tileListConstants=n,this.EnvironmentService=a,this.$window=s,this.$timeout=r,this.$document=o}return(0,a.default)(t,[{key:"$onInit",value:function(){this.clicked=!1,this.parentController.hasEsignData()||this.parentController.showCustomError("magicSwitch.esignature.noEsignError")}},{key:"signManually",value:function(){this.gotoSignManually()}},{key:"launchSigningCeremony",value:function(){var t=this;this.clicked=!0;var e=this.$window.open(""+this.EnvironmentService.getEsignLiveUrl().replace("/access?sessionToken=","/html/loading.html"),"MsgWindow","toolbar=no, status=no, menubar=no, scrollbars=no, resizable=no, left=0, top=0, width=10, height=10, visible=none","");this.$timeout((function(){e.close(),angular.element("#eSignFrame").attr("src",""+t.EnvironmentService.getEsignLiveUrl()+t.data.esignSessionKey)}),5e3)}},{key:"isSafari",value:function(){return this.EnvironmentService.isSafari()}},{key:"isClicked",value:function(){return this.clicked}}]),t}();r.$inject=["$log","tngTileListConstants","EnvironmentService","$window","$timeout","$document"],e.default=r,t.exports=e.default},function(t,e){t.exports='<p ng-if="$ctrl.parentController.hasEsignData()">{{ :: \'magicSwitch.esignature.description\' | translate }}</p> <div class="margin__t--fix1" ng-if="$ctrl.parentController.hasEsignData() && $ctrl.isSafari()"> <button ng-if="!$ctrl.isClicked()" class="btn btn--edit c-magic-switch__section--bottom-margin-small" ng-click="$ctrl.launchSigningCeremony()">{{ :: \'magicSwitch.esignature.showForm\' | translate }}</button> <iframe id="eSignFrame" src="" class="magic-switch-esign"></iframe> </div> <div class="margin__t--fix1" ng-if="$ctrl.parentController.hasEsignData() && !$ctrl.isSafari()"> <iframe id="eSignFrame" ng-src="{{$ctrl.data.esignUrl}}" class="magic-switch-esign"></iframe> </div> <h4 class="margin__t--fix2 margin__b--fix1">{{ :: \'magicSwitch.esignature.troubleViewingForm\' | translate }}</h4> <tng-tile-list class="c-magic-switch__single-tile c-magic-switch__single-tile--last-tile ng-isolate-scope" tile-data="$ctrl.esignatureManualPrintTiles" tile-type="$ctrl.tileListConstants.TILE_TYPE.text" is-actionable="true" on-tile-click="$ctrl.signManually()"> </tng-tile-list> <p> <br> <br> <br> <br> </p> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5357));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(5358)).default,controller:i.default,require:{parentController:"^tngMagicSwitch"},bindings:{data:"<",type:"<",isOnBoarding:"<",doneStepsTile:"<",isMutualFundsUpgraded:"<"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.$log=e,this.PDFRequestService=n}return(0,a.default)(t,[{key:"viewForm",value:function(){var t=this.parentController.isUpgradedMutualFund?this.data.mfDealId:this.data.dealId;this.PDFRequestService.viewMagicSwitchForm(t)}}]),t}();r.$inject=["$log","PDFRequestService"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div> <p ng-bind-html="\'magicSwitch.done.description\'+($ctrl.isOnBoarding ? \'OB\' : \'\') | translate"> </p> <h3 ng-if="!$ctrl.isMutualFundsUpgraded || !$ctrl.isOnBoarding" class="c-magic-switch__done__header-margin1"> {{ :: \'magicSwitch.done.fundTitle\' | translate:{ type: (\'magicSwitch.\'+$ctrl.type | translate) } }} </h3> </div> <div ng-if="!$ctrl.isMutualFundsUpgraded || !$ctrl.isOnBoarding" class="c-magic-switch__panel c-magic-switch__panel--margin-fix1"> <p class="c-magic-switch__done__no-padding-p">{{ :: \'magicSwitch.done.referenceNumber\' | translate }} <span class="c-magic-switch__done__refnum">{{ $ctrl.data.dealId }}</span></p> </div> <div ng-if="!$ctrl.isMutualFundsUpgraded || !$ctrl.isOnBoarding" class="c-magic-switch__panel"> <p class="done__no-padding-p"> {{ :: \'magicSwitch.done.approxInitAmountLabel\' | translate }} </p> <div class="body--2"> <p class="c-magic-switch__review__amount done__no-padding-p"> ${{ $ctrl.data.transaction.amount ? $ctrl.data.transaction.amount : \'0.00\' | number:2 }} </p> </div> </div> <div class="c-magic-switch__panel"> <h3 class="c-magic-switch__done__stepTitle"> {{ :: \'magicSwitch.done.completeTransfer\' | translate }} </h3> <div class="c-magic-switch__done__step"> <div class="c-magic-switch__done__step__num">1</div> <p class="c-magic-switch__done__no-padding-p c-magic-switch__done__step__text"> {{ :: \'magicSwitch.done.completeStep1\' | translate }} <a actionable-id="transfer-done-view_form" href="" class="c-magic-switch__done__refnum" ng-click="$ctrl.viewForm()">{{ :: \'magicSwitch.done.completeStep1Link\' | translate }}</a> <span ng-bind-html="\'magicSwitch.done.completeStep1_2\' | translate"/> </p> </div> <div class="c-magic-switch__done__step"> <div class="c-magic-switch__done__step__num">2</div> <p class="c-magic-switch__done__no-padding-p c-magic-switch__done__step__text">{{ :: \'magicSwitch.done.completeStep2\' | translate }}</p> </div> <div class="c-magic-switch__done__step"> <div class="c-magic-switch__done__step__num">3</div> <p class="c-magic-switch__done__no-padding-p c-magic-switch__done__step__text" ng-bind-html="\'magicSwitch.done.completeStep3\' | translate"></p> </div> </div> <h3 class="c-magic-switch__done__header-margin2" ng-if="$ctrl.isOnBoarding && !$ctrl.isMutualFundsUpgraded"> {{ :: \'magicSwitch.done.nextSteps\' | translate }} </h3> <button actionable-id="transferDone_printButton" class="btn btn--orange" ng-click="$ctrl.viewForm()"> {{ ::\'global.print\' | translate}} </button> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5360));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(5361)).default,controller:i.default,bindings:{data:"<",account:"<",pageId:"<",gotoPendingApplications:"&",institutionName:"<"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e){(0,i.default)(this,t),this.$log=e}return(0,a.default)(t,[{key:"viewPendingApplications",value:function(){this.gotoPendingApplications()}}]),t}();r.$inject=["$log"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div id="printMe"> <div> <p class="c-magic-switch__step__text" ng-bind-html="\'magicSwitch.done.instructions\' | translate: { fromAccount: $ctrl.institutionName }"></p> </div> <div class="c-contributions-modal__balance-grid c-balance-grid"> <div class="c-balance-grid__table-column-top c-balance-grid__title confirmation-number"> {{ :: \'magicSwitch.done.confirmationNumber\' | translate }} <span class="c-magic-switch__done__refnum">{{ $ctrl.data.dealId }}</span> </div> <div class="c-balance-grid__table"> <div class="c-balance-grid__table__table-column-top has-right-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> <strong>{{ :: \'magicSwitch.done.approxInitAmountLabel\' | translate }}</strong> </p> <p class="c-balance-grid__value"> {{ $ctrl.data.transaction.amount | currency }} </p> </div> </div> <div class="c-balance-grid__table__table-column-top has-left-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> {{ :: \'magicSwitch.done.currentBalanceLabel\' | translate }} <strong>{{ $ctrl.account.description }} {{ $ctrl.account.display_name | maskNumber }}</strong> </p> <p class="c-balance-grid__value"> {{ $ctrl.account.account_balance | currency }} </p> </div> </div> </div> </div> <div class="c-magic-switch__section--top-margin-small"> <p class="c-magic-switch__step__text">{{ :: \'magicSwitch.done.viewTransferStatus\' | translate }} <a actionable-id="transfer-done-esing-pending_application" href ng-click="$ctrl.viewPendingApplications()" class="c-magic-switch__done__refnum">{{ :: \'magicSwitch.done.pendingApplications\' | translate }}</a> {{ :: \'magicSwitch.done.viewTransferStatus2\' | translate }} </p> </div> <div class="c-magic-switch__section--top-margin-small"> <tng-print-button only-element="\'printMe\'" actionable-id="{{::$ctrl.pageId}}_printButtonSignElectronically" button-class="btn btn--orange"> {{ ::\'global.print\' | translate}} </tng-print-button> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5363));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(5364)).default,controller:i.default,require:{parentController:"^tngMagicSwitch"},bindings:{data:"<",account:"<",pageId:"<",gotoPendingApplications:"&",isOnBoarding:"<"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.$log=e,this.PDFRequestService=n}return(0,a.default)(t,[{key:"viewForm",value:function(){this.PDFRequestService.viewMagicSwitchForm(this.data.dealId)}},{key:"viewPendingApplications",value:function(){this.gotoPendingApplications()}}]),t}();r.$inject=["$log","PDFRequestService"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div id="printMe"> <p ng-bind-html="($ctrl.parentController.isMF ? \'magicSwitch.done.signManuallyDescriptionMF\':\n  \'magicSwitch.done.signManuallyDescription\') | translate"></p> <div ng-if="!$ctrl.isOnBoarding" class="c-contributions-modal__balance-grid c-balance-grid"> <div class="c-balance-grid__table-column-top c-balance-grid__title confirmation-number"> {{ :: \'magicSwitch.done.confirmationNumber\' | translate }} <span class="c-magic-switch__done__refnum">{{ $ctrl.data.dealId }}</span> </div> <div class="c-balance-grid__table"> <div class="c-balance-grid__table__table-column-top has-right-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> <strong>{{ :: \'magicSwitch.done.approxInitAmountLabel\' | translate }}</strong> </p> <p class="c-balance-grid__value"> {{ $ctrl.data.transaction.amount | currency }} </p> </div> </div> <div class="c-balance-grid__table__table-column-top has-left-border"> <div class="c-balance-grid__section"> <p class="c-balance-grid__title"> {{ :: \'magicSwitch.done.currentBalanceLabel\' | translate }} <strong>{{ $ctrl.account.description }} {{ $ctrl.account.display_name | maskNumber }}</strong> </p> <p class="c-balance-grid__value"> {{ $ctrl.account.account_balance | currency }} </p> </div> </div> </div> </div> <div class="c-magic-switch__panel"> <h3 class="c-magic-switch__done__stepTitle"> {{ :: \'magicSwitch.done.completeTransfer\' | translate }} </h3> <div class="c-magic-switch__done__step"> <div class="c-magic-switch__done__step__num">1</div> <p class="c-magic-switch__done__no-padding-p c-magic-switch__step__text">{{ :: \'magicSwitch.done.completeStep1\' | translate }} <a actionable-id="transfer-done-ink-view_form" href="" class="c-magic-switch__done__refnum" ng-click="$ctrl.viewForm()">{{ :: \'magicSwitch.done.completeStep1Link\' | translate }}</a> </p> </div> <div class="c-magic-switch__done__step"> <div class="c-magic-switch__done__step__num">2</div> <p class="c-magic-switch__done__done__no-padding-p step__text">{{ :: \'magicSwitch.done.completeStep2\' | translate }}</p> </div> <div class="c-magic-switch__done__step"> <div class="c-magic-switch__done__step__num">3</div> <p class="c-magic-switch__done__no-padding-p step__text" ng-bind-html="\'magicSwitch.done.completeStep3_SAVINGS\' | translate"></p> </div> </div> <div ng-if="!$ctrl.isOnBoarding" class="c-magic-switch__section--top-margin-small"> <p class="c-magic-switch__step__text">{{ :: \'magicSwitch.done.viewTransferStatus\' | translate }} <a actionable-id="transfer-done-ink-pending_application" href ng-click="$ctrl.viewPendingApplications()" class="c-magic-switch__done__refnum"> {{ :: \'magicSwitch.done.pendingApplications\' | translate }}</a> {{ :: \'magicSwitch.done.viewTransferStatus2\' | translate }} </p> </div> <div class="c-magic-switch__section--top-margin-small"> <button actionable-id="{{::$ctrl.pageId}}_printButtonSignManually" class="btn btn--orange" ng-click="$ctrl.viewForm()"> {{ ::\'global.print\' | translate}} </button> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n(5366));function a(t){return t&&t.__esModule?t:{default:t}}var s={template:a(n(5367)).default,controller:i.default,bindings:{data:"<",pageId:"<"}};e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(0),s=(i=a)&&i.__esModule?i:{default:i};var r=function t(e){(0,s.default)(this,t),this.$log=e};r.$inject=["$log"],e.default=r,t.exports=e.default},function(t,e){t.exports='<div id="printMe"> <div> <p>{{ ::\'magicSwitch.done.savedInfo\' | translate }}</p> </div> <div class="c-magic-switch__panel"> <p class="c-magic-switch__done__no-padding-p">{{ :: \'magicSwitch.done.referenceNumber\' | translate }}</p> <p><span class="c-magic-switch__done__refnum">{{ $ctrl.data.dealId }}</span></p> </div> <div class="c-magic-switch__section--top-margin-small"> <tng-print-button only-element="\'printMe\'" actionable-id="{{::$ctrl.pageId}}_printButtonSaved" button-class="btn btn--orange"> {{ ::\'global.print\' | translate}} </tng-print-button> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5369)),a=s(n(5370));function s(t){return t&&t.__esModule?t:{default:t}}n(5371);var r={template:i.default,controller:a.default,bindings:{onKycComplete:"&?",registerFlow:"&?",roadBlockTriggered:"<?",nextState:"<?",nextParams:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-kyc" ng-class="{\'c-kyc__kyc-select\' : $ctrl.flowService.currentState === $ctrl.flowService.STATES.KVA_ALT}"> <div class="c-kyc__spinner" ng-show="$ctrl.flowService.inLoadingMode"> <tng-loading-spinner>{{ ::\'userSettings.component.modal.loading\' | translate }}</tng-loading-spinner> </div> <div class="c-kyc__main" ng-show="!$ctrl.flowService.inLoadingMode"> <div class="c-kyc__components"> <kva-alt-confirm ng-if="$ctrl.kycInitialized" ng-show="$ctrl.flowService.currentState === $ctrl.flowService.STATES.KVA_ALT_CONFIRM" on-view-more-locations="$ctrl.showSelectionMap()" selected-location="$ctrl.selectedLocation" geo-center-type="$ctrl.geoCenterType"> </kva-alt-confirm> <kva-alt ng-if="$ctrl.kycInitialized && $ctrl.selectMapInitialized" ng-show="$ctrl.flowService.currentState === $ctrl.flowService.STATES.KVA_ALT" on-kyc-select="$ctrl.onKycSelect(selectedLocation)" kyc-start-point="$ctrl.geoCenterType" clear-active-selection="$ctrl.setClearSelection(clearSelection)"> </kva-alt> </div> </div> </div> <tng-modal-dialog ng-if="$ctrl.flowService.showConfirmExitUI" flow-service="$ctrl.flowService"> </tng-modal-dialog> <div class="c-kyc__footer" ng-if="$ctrl.isStandalone" ng-show="!$ctrl.flowService.inLoadingMode && !$ctrl.flowService.showConfirmExitUI"> <div class="c-kyc__footer__container"> <div class="c-kyc__footer__buttons"> <button class="btn btn--edit c-kyc__footer__grey-button" actionable-id="kyc_button_grey" ng-show="$ctrl.flowService.BUTTONS.BTN_GRY.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_GRY.disable" ng-click="$ctrl.flowService.currentFlow.onButtonClick($ctrl.flowService.BUTTONS.BTN_GRY)"> {{ $ctrl.flowService.BUTTONS.BTN_GRY.type.label | translate }} </button> <button class="btn btn--orange" actionable-id="kyc_button_orange" ng-show="$ctrl.flowService.BUTTONS.BTN_ORG.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_ORG.disable" ng-click="$ctrl.flowService.currentFlow.onButtonClick($ctrl.flowService.BUTTONS.BTN_ORG)"> {{ $ctrl.flowService.BUTTONS.BTN_ORG.type.label | translate }} </button> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f){(0,i.default)(this,t),this.$log=e,this.flowService=n,this.RequesterService=a,this.kycConstants=r,this.NativeService=o,this.EnvironmentService=c,this.AbmLocationService=l,this.stateConstants=u,this.$state=d,this.$q=h,this.locationObject=null,this.isNative=c.isNative(),this.serviceConstants=s,this.AVAILABLE_SERVICES=s.AVAILABLE_SERVICES,this.GlobalModalsService=f}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.kycInitialized=!1,this.selectMapInitialized=!1,this.isSelectMapVisible=!1,this.registerFlow?(this.isStandalone=!1,this.flowService.activate(this.registerFlow)):(this.isStandalone=!0,this.flowService.activate(),this.flowService.showWarningOnExit(),this.flowService.enableHijackWindowUnload()),this.flowService.nextState=this.nextState,this.flowService.nextParams=this.nextParams,this.flowService.enterLoadingMode(),this.onKycComplete&&"function"==typeof this.onKycComplete&&this.flowService.setOnCompleteCallback(this.onKycComplete),this._getCustomerInfo().then((function(e){if(t.flowService.customer=e.customer,e.customer.selectedPOILocation){if(t.flowService.clientIsReturning=!0,t.roadBlockTriggered){if(t.flowService.hideWarningOnExit(),!t.nextState)return t.$state.go(t.stateConstants.ACCOUNT_SUMMARY,{showKYCPendingModal:!0});t.GlobalModalsService.showKYCRoadblockModal({nextState:t.nextState,nextParams:t.nextParams}),t.$state.go(t.nextState,t.nextParams)}return t.getPreselectedLocation()}return t.determineClosestKYC()})).then((function(e){t.selectedLocation=e,t.flowService.clientIsReturning?t.flowService.originallySelectedKycOption=e:t.selectedLocation.original_object.preselected=!0,t.kycInitialized=!0})).finally((function(){t.flowService.exitLoadingMode()}))}},{key:"showSelectionMap",value:function(){this.selectMapInitialized=!0,this.flowService.moveTo(this.flowService.STATES.KVA_ALT)}},{key:"onKycSelect",value:function(t){this.selectedLocation=t}},{key:"setClearSelection",value:function(t){this.clearSelection=t}},{key:"getGeoLocation",value:function(){var t=this,e=this.$q.defer();return this.$q.resolve(!0).then((function(){return t.isNative?t.NativeService.turnOnLocationService():t.$q.resolve()})).then((function(){return t.NativeService.requestNativeLocationPermission()})).then((function(n){if(n.status.toUpperCase()!==t.serviceConstants.STATUS_CODES.SUCCESS)return e.resolve(!1);navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){return e.resolve(t)}),(function(t){return e.resolve(!1)}),{enableHighAccuracy:!0}):e.resolve(!1)})).catch((function(){e.resolve(!1)})),e.promise}},{key:"determineClosestKYC",value:function(){var t=this;return this.getGeoLocation().then((function(e){var n="";e&&e.coords?(t.geoCenterType=t.kycConstants.MAP_GEOCENTER_TYPE.CLIENT_LOCATION,n="search-type=COORDINATES&search-string="+e.coords.latitude+","+e.coords.longitude):(t.geoCenterType=t.kycConstants.MAP_GEOCENTER_TYPE.HOME_ADDRESS,n="postal-code="+t.flowService.customer.address_list.find((function(t){return"HOME"===t.address_type})).postal_code.replace(" ",""));var i={queryString:n};return t.AbmLocationService.getIdentificationLocations({urlVars:i})})).then((function(e){if(e.poiLocationList){var n=e.poiLocationList.map(t.AbmLocationService.mapPoiFormatToAbmFormat).sort((function(t,e){return t.distance-e.distance}));if(n.length)return n[0]}return t.AbmLocationService.getIdentificationLocations({urlVars:{queryString:"search-type=TEXT_QUERY&search-string=toronto"}}).then((function(e){return e.poiLocationList.map(t.AbmLocationService.mapPoiFormatToAbmFormat).find((function(t){return"IDV"===t.abm_type&&!!t.address.addressLine1.match(/.*3389.*steeles.*/gi)}))}))}))}},{key:"getPreselectedLocation",value:function(){var t=this,e=JSON.parse(this.flowService.customer.selectedPOILocation),n={queryString:"search-type=TEXT_QUERY&search-string="+(e.address1+" "+e.address2)};return this.AbmLocationService.getIdentificationLocations({urlVars:n}).then((function(n){var i=n.poiLocationList.find((function(t){return t.address1.toLowerCase()===e.address1.toLowerCase()}));return t.$log.debug("Matching POI: ",i),t.$q.resolve(t.AbmLocationService.mapPoiFormatToAbmFormat(i||e))}))}},{key:"_getCustomerInfo",value:function(){return this.RequesterService.request(this.AVAILABLE_SERVICES.GET_CUSTOMER_INFO)}},{key:"$onDestroy",value:function(){this.flowService.deactivate(),this.flowService.disableHijackWindowUnload()}}]),t}();r.$inject=["$log","KYCFlowService","RequesterService","serviceConstants","kycConstants","NativeService","EnvironmentService","AbmLocationService","stateConstants","$state","$q","GlobalModalsService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={KVA_ALT_IDENTITY:{CAFE:"IDV",POST:"CDAPOST"},KVA_LINK:{TANGERINE_LOCATION:"TANGERINE_LOCATION",VS:"VS"},MAP_GEOCENTER_TYPE:{CLIENT_LOCATION:"CLIENT_LOCATION",HOME_ADDRESS:"HOME_ADDRESS"}},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(177)),a=u(n(0)),s=u(n(2)),r=u(n(264)),o=u(n(266)),c=u(n(265)),l=n(267);function u(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(t,n,s,o,c,u,d,h,f,p,g){(0,a.default)(this,e);var m=(0,r.default)(this,(e.__proto__||(0,i.default)(e)).call(this,t,n,s,o,c,d,u,f,null,g));return m.$log=t,m.$state=o,m.BUTTON_TYPES=u.BUTTON_TYPES,m.stateConstants=h,m.$timeout=p,m.STATES={KVA_ALT_CONFIRM:{titleKey:"kyc.kvaAlt.verifyIdentityConfirm.header"},KVA_ALT:{titleKey:"kyc.kvaAlt.verifyIdentityConfirm.header"}},m.BUTTONS={BTN_GRY:new l.PageFlowButton(m.BUTTON_TYPES.BACK,!1,!0),BTN_ORG:new l.PageFlowButton(m.BUTTON_TYPES.NEXT,!0,!1)},m._initialState=m.STATES.KVA_ALT_CONFIRM,m._onKYCComplete=null,m.originallySelectedKycOption=null,m}return(0,c.default)(e,t),(0,s.default)(e,[{key:"_resetState",value:function(){(0,o.default)(e.prototype.__proto__||(0,i.default)(e.prototype),"_resetState",this).call(this),this.setOnCompleteCallback(null)}},{key:"setOnCompleteCallback",value:function(t){this._onKYCComplete=t}},{key:"gotoNextState",value:function(){switch(this.currentState){case this.STATES.KVA_ALT:this.moveTo(this.STATES.KVA_ALT_CONFIRM);break;case this.STATES.KVA_ALT_CONFIRM:this._onKYCComplete&&"function"==typeof this._onKYCComplete?this._onKYCComplete():this.nextState?this.$state.go(this.nextState,this.nextParams):this.$state.go(this.stateConstants.ACCOUNT_SUMMARY)}}},{key:"_updateUI",value:function(){var t=this;switch(this.hideWarning(),this.currentState){case this.STATES.KVA_ALT_CONFIRM:this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.NEXT,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!1,this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_GRY.show=!1,this.BUTTONS.BTN_GRY.disable=!1;break;case this.STATES.KVA_ALT:this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.SAVE,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!this.latestSelectedLocation,this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_GRY.disable=!1,this.onButtonClickBack=function(){t.hideWarning(),t.gotoPreviousState()}}}},{key:"selectVerificationOption",value:function(t){this.$log.debug("VERIFICATION CHOSEN: ",t)}},{key:"_getAnalyticsID",value:function(){return"kyc"}}]),e}(u(l).default);d.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","$rootScope","stateConstants","AnalyticsService","$timeout","ConfirmWindowUnloadService"],e.default=d,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5375)),a=s(n(5376));function s(t){return t&&t.__esModule?t:{default:t}}n(5377);var r={template:i.default,controller:a.default,bindings:{onKycSelect:"&",clearActiveSelection:"&?",kycStartPoint:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-kva-alt"> <div ng-class="{\'location-selected\' : $ctrl.flowService.selectedLocation}" class="c-kva-alt__map-container"> <abm-map map-id="kyc-selection" search-visible="true" info-popup-visible="true" info-window-legend-visible="false" show-zoom-control="true" show-current-location-control="true" cafe-locator-visible="false" default-zoom-level="12" on-kyc-select="$ctrl.onKycSelected(selectedLocation)" user-home-address="$ctrl.userHomeAddress" location-type="$ctrl.LOCATION_TYPE" map-mode="$ctrl.MAP_MODE" clear-active-selection="$ctrl.setClearSelection(clearSelection)" selection-cleared="$ctrl.selectionCleared()"> </abm-map> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.$log=e,this.$state=a.$state,this.flowService=a,this.EnvironmentService=s,this.kycConstants=n,this.stateConstants=a.stateConstants,this.AbmMapConstants=r,this.MAP_MODE=r.MAP_MODES.KYC_SELECT,this.LOCATION_TYPE=r.PLACE_TYPES.CONFIRM_IDENTITY,this.userHomeAddress=this.flowService.customer.address_list[0],this.onboardingStates=[this.stateConstants.EXISTING_CLIENT_ONBOARDING]}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.flowService.onButtonClickSave=function(){var e=t.latestSelectedLocation;t.onKycSelect({selectedLocation:e}),t.flowService.gotoPreviousState()},this.flowService.BUTTONS.BTN_ORG.disable=!0}},{key:"onKycSelected",value:function(t){this.latestSelectedLocation=t,this.flowService.latestSelectedLocation=t,this.flowService.BUTTONS.BTN_ORG.disable=!t}},{key:"selectionCleared",value:function(){this.flowService.latestSelectedLocation=void 0,this.flowService.BUTTONS.BTN_ORG.disable=!0}},{key:"setClearSelection",value:function(t){this.clearSelection=t,this.clearActiveSelection({clearSelection:this.clearSelection})}}]),t}();r.$inject=["$log","kycConstants","KYCFlowService","EnvironmentService","AbmMapConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5379)),a=s(n(5380));function s(t){return t&&t.__esModule?t:{default:t}}n(5381);var r={template:i.default,controller:a.default,bindings:{onViewMoreLocations:"&",selectedLocation:"<",geoCenterType:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports=' <div class="c-kva-alt-confirm fb2" id="printMe"> <div ng-if="$ctrl.selectedLocation" class="c-kva-alt-confirm__inner-container"> <div class="c-kva-alt-confirm__header margin-top-sm"> {{::\'kyc.kvaAlt.verifyIdentityConfirm.header\' | translate }} </div> <div ng-if="$ctrl.isLocationPreselected" class="c-kva-alt-confirm__subheader-font margin-top-sm"> {{::\'kyc.kvaAlt.verifyIdentityConfirm.subheaderPreselected\' | translate }} </div> <div ng-if="!$ctrl.isLocationPreselected" class="c-kva-alt-confirm__subheader-font margin-top-sm"> <div ng-if="$ctrl.isCafe"> {{::\'kyc.kvaAlt.verifyIdentityConfirm.subheaderCafe\' | translate }} </div> <div ng-if="$ctrl.isPost"> {{::\'kyc.kvaAlt.verifyIdentityConfirm.subheaderCanadaPost\' | translate }} </div> </div> </div> <div class="margin-top-lg"> <div class="c-kva-alt-confirm__map-container" ng-if="$ctrl.selectedLocation"> <abm-map map-id="kyc-confirm-map" class="margin-top-lg" default-zoom-level="15" show-zoom-control="false" search-visible="false" info-popup-visible="false" cafe-locator-visible="true" info-window-legend-visible="true" user-home-address="$ctrl.userHomeAddress" auto-zoom="false" location-type="$ctrl.locationType" map-mode="$ctrl.MAP_MODES.KYC_DISPLAY" read-only-mode="true" location-object="$ctrl.selectedLocation" show-cafe-phone-number="true" show-distance="$ctrl.shouldShowDistance" kyc-address-header="$ctrl.mapAddressHeader"> </abm-map> </div> <button class="btn btn--edit margin-top-sm c-kva-alt-confirm__view-more-btn" ng-click="$ctrl.viewMoreLocations()">{{::\'kyc.kvaAlt.verifyIdentityConfirm.seeMoreLocations\' | translate }}</button> </div> <div class="c-kva-alt-confirm__inner-container"> <div class="c-kva-alt-confirm__header margin-top-lg"> {{::\'kyc.kvaAlt.verifyIdentityConfirm.header2\' | translate }} </div> <div ng-if="$ctrl.isCafe"> <div class="c-kva-alt-confirm__section-container margin-top-lg"> <div class="c-kva-alt-confirm__number">1</div> <div class="c-kva-alt-confirm__section-item c-kva-alt-confirm__subheader-font"> <div class="c-kva-alt-confirm__section-item__header"> <span translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.mapHeaderPost\' }} </span> </div> <div class="margin-top-lg"> <div> <strong translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.mapCategoriesHeaderLeft\' }} </strong> </div> <div class="c-kva-alt-confirm__list-items"> <ul> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.canadianDriversLicence\' }} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.canadianPassport\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.provincialPhoto\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.canadianCertificate\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.canadianPermanentResidentCard\'}} </li> </ul> </div> </div> <div class="c-kva-alt-confirm__list-container margin-top-sm"> <div class=""> <strong translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.mapCategoriesHeaderRight\'}} </strong> </div> <div class="c-kva-alt-confirm__list-items"> <ul> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.bankStatement\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.schoolReport\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.leaseMortgage\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.insurancePolicy\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.vehicleOwnership\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.municipalTax\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.utilityBill\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.childTax\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.incomeTax\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.governmentCheque\'}} </li> </ul> <ul> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.statementOfEmployment\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.cppStatement\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.statementOfOldAgeSecurity\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.wsibBenefits\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.directDeposit\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.attestationOfResidence\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.creditCardStatement\'}} </li> </ul> </div> </div> </div> </div> <div class="c-kva-alt-confirm__section-container margin-top-lg"> <div class="c-kva-alt-confirm__section-item c-kva-alt-confirm__subheader-font" ng-if="$ctrl.dssNumber"> <div class="c-kva-alt-confirm__section-item__header"> <div class="c-kva-alt-confirm__number">2</div> <span ng-bind-html="::\'kyc.kvaAlt.verifyIdentityConfirm.barcodeHeader\' | translate: { date: $ctrl.dssNumberExpiryDate }"></span> </div> <div class="c-kva-alt-confirm__barcode"> <div class="c-kva-alt-confirm__tangerine-barcode"> <div class="c-kva-alt-confirm__tangerine-barcode-icon barcode128h" ng-bind-html="$ctrl.barcode"></div> <div class="c-kva-alt-confirm__tangerine-barcode-text">{{$ctrl.barcodeText}}</div> </div> </div> <div class="c-kva-alt-confirm__barcode__buttons"> <a ng-if="$ctrl.showAppleWalletBtn" ng-href="{{$ctrl.dssPassLinkApple}}" target="_blank"> <img ng-src="assets/images/Apple_wallet_{{$ctrl.locale}}.png"> </a> <a ng-if="$ctrl.showGooglePayBtn" ng-href="{{$ctrl.dssPassLinkGoogle}}" target="_blank"> <img ng-src="assets/images/Google_pay_{{$ctrl.locale}}.png"> </a> </div> </div> <div class="c-kva-alt-confirm__section-item c-kva-alt-confirm__subheader-font" ng-if="!$ctrl.dssNumber"> <div class="c-kva-alt-confirm__section-item__header"> <div class="c-kva-alt-confirm__number">2</div> <span translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.noDSSHeader\' }} </span> </div> </div> </div> </div> <div ng-if="$ctrl.isPost"> <div class="c-kva-alt-confirm__section-container margin-top-lg"> <div class="c-kva-alt-confirm__section-item c-kva-alt-confirm__subheader-font" ng-if="$ctrl.dssNumber"> <div class="c-kva-alt-confirm__section-item__header"> <div class="c-kva-alt-confirm__number">1</div> <span ng-bind-html="::\'kyc.kvaAlt.verifyIdentityConfirm.barcodeHeader\' | translate: { date: $ctrl.dssNumberExpiryDate }"></span> </div> <div class="c-kva-alt-confirm__barcode"> <div class="c-kva-alt-confirm__tangerine-barcode"> <div class="c-kva-alt-confirm__tangerine-barcode-icon barcode128h" ng-bind-html="$ctrl.barcode"></div> <div class="c-kva-alt-confirm__tangerine-barcode-text">{{$ctrl.barcodeText}}</div> </div> </div> <div class="c-kva-alt-confirm__barcode__buttons"> <a ng-if="$ctrl.showAppleWalletBtn" ng-href="{{$ctrl.dssPassLinkApple}}" target="_blank"> <img ng-src="assets/images/Apple_wallet_{{$ctrl.locale}}.png"> </a> <a ng-if="$ctrl.showGooglePayBtn && !$ctrl.isNativeIOS" ng-href="{{$ctrl.dssPassLinkGoogle}}" target="_blank"> <img ng-src="assets/images/Google_pay_{{$ctrl.locale}}.png"> </a> </div> </div> <div class="c-kva-alt-confirm__section-item c-kva-alt-confirm__subheader-font" ng-if="!$ctrl.dssNumber"> <div class="c-kva-alt-confirm__section-item__header"> <div class="c-kva-alt-confirm__number">1</div> <span translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.noDSSHeader\' }} </span> </div> </div> </div> <div class="c-kva-alt-confirm__section-container margin-top-lg"> <div class="c-kva-alt-confirm__section-item c-kva-alt-confirm__subheader-font"> <div class="c-kva-alt-confirm__section-item__header"> <div class="c-kva-alt-confirm__number">2</div> <span translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.mapHeaderPost\' }} </span> </div> <div class="margin-top-lg"> <div> <strong translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.mapCategoriesHeaderLeft\' }} </strong> </div> <div class="c-kva-alt-confirm__list-items"> <ul> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.canadianDriversLicence\' }} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.canadianPassport\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.provincialPhoto\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.canadianCertificate\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.canadianPermanentResidentCard\'}} </li> </ul> </div> </div> <div class="c-kva-alt-confirm__list-container margin-top-sm"> <div class=""> <strong translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.mapCategoriesHeaderRight\'}} </strong> </div> <div class="c-kva-alt-confirm__list-items"> <ul> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.bankStatement\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.schoolReport\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.leaseMortgage\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.insurancePolicy\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.vehicleOwnership\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.municipalTax\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.utilityBill\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.childTax\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.incomeTax\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.governmentCheque\'}} </li> </ul> <ul> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.statementOfEmployment\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.cppStatement\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.statementOfOldAgeSecurity\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.wsibBenefits\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.directDeposit\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.attestationOfResidence\'}} </li> <li translate> {{::\'kyc.kvaAlt.verifyIdentityConfirm.creditCardStatement\'}} </li> </ul> </div> </div> </div> </div> </div> </div> <div class="c-kva-alt-confirm__inner-container margin-top-lg"> <button actionable-id="kvaAlrConfirm_printButton" translate ng-click="$ctrl.onPrint()" class="btn btn--edit c-kva-alt-confirm__print-btn"> {{\'kyc.kvaAlt.verifyIdentityConfirm.printPage\'}} </button> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(8)),a=o(n(104)),s=o(n(0)),r=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(e,n,i,a,r,o,c,l,u,d,h){(0,s.default)(this,t),this.$log=e,this.$window=n,this.BarcodeService=r,this.kycConstants=i,this.flowService=a,this.KVA_ALT_IDENTITY=i.KVA_ALT_IDENTITY,this.KVAAltConfirmService=o,this.LocaleService=c,this.locale=c.localeDisplay.toLowerCase(),this.PLACE_TYPES=l.PLACE_TYPES,this.MAP_MODES=l.MAP_MODES,this.$q=u,this.$scope=d,this.EnvironmentService=h}return(0,r.default)(t,[{key:"$onInit",value:function(){var t=this;this.isNativeAndroid=this.EnvironmentService.isNative()&&this.EnvironmentService.isAndroid(),this.isNativeIOS=this.EnvironmentService.isNativeIOS(),this.firstName=this.flowService.customer.first_name,this.isPost?this.locationType=this.PLACE_TYPES.CANADAPOST:this.locationType=this.PLACE_TYPES.CAFE;var e=this.flowService.customer,n=e.address_list.filter((function(t){return"HOME"===t.address_type})),i=(0,a.default)(n,1);if(this.userHomeAddress=i[0],this.dssNumber=e["dss-number"],this.dssNumberExpiryDate=e.dssExpiryDate,this.dssPassToken=e.dssPassToken,this.dssNumber&&(this.barcodeText=this.dssNumber,this.barcode=this.BarcodeService.code128(this.barcodeText)),this.showGooglePayBtn=!1,this.showAppleWalletBtn=!this.EnvironmentService.isNative()||this.EnvironmentService.isNativeIOS(),this.dssPassToken){var s=this.EnvironmentService.get("kycDssCodeWalletPass"),r=s.googleUrl,o=s.appleUrl,c=s.appId;this.dssPassLinkApple=""+o+this.dssPassToken+"&appId="+c,this.dssPassLinkGoogle=""+r+this.dssPassToken+"&appId="+c}this.flowService.onButtonClickNext=function(){return t.flowService.hideWarning(),t.flowService.enterLoadingMode(),t.$q.resolve(!0).then((function(){return t.selectedLocation.address.addressLine1.toLowerCase()===(t.flowService.originallySelectedKycOption&&t.flowService.originallySelectedKycOption.address.addressLine1.toLowerCase())?t.$q.resolve():t.submitKYCInfo()})).finally((function(){return t.flowService.gotoNextState()}))}}},{key:"$onChanges",value:function(){this.prepareMapAddressHeader()}},{key:"submitKYCInfo",value:function(){return this.KVAAltConfirmService.submitKYCMethod(this.selectedLocation)}},{key:"viewMoreLocations",value:function(){this.onViewMoreLocations&&this.onViewMoreLocations()}},{key:"_showSelectNewLocationButton",value:function(){this.selectedLocation||(0,i.default)(this.flowService.BUTTONS.BTN_GRY,{show:!0,disable:!1,type:{label:"kyc.newLocationButton"}})}},{key:"onPrint",value:function(){this.$window.print()}},{key:"prepareMapAddressHeader",value:function(){this.isLocationPreselected&&this.geoCenterType?this.geoCenterType===this.kycConstants.MAP_GEOCENTER_TYPE.CLIENT_LOCATION?this.mapAddressHeader=this.isPost?"kyc.kvaAlt.verifyIdentityConfirm.mapAddressHeaders.cpClientLocation":"kyc.kvaAlt.verifyIdentityConfirm.mapAddressHeaders.cafeClientLocation":this.geoCenterType===this.kycConstants.MAP_GEOCENTER_TYPE.HOME_ADDRESS&&(this.mapAddressHeader=this.isPost?"kyc.kvaAlt.verifyIdentityConfirm.mapAddressHeaders.cpHomeAddress":"kyc.kvaAlt.verifyIdentityConfirm.mapAddressHeaders.cafeHomeAddress"):this.mapAddressHeader=this.isPost?"kyc.kvaAlt.verifyIdentityConfirm.mapAddressHeaders.cp":"kyc.kvaAlt.verifyIdentityConfirm.mapAddressHeaders.cafe"}},{key:"isPost",get:function(){return this.selectedLocation.abm_type===this.KVA_ALT_IDENTITY.POST}},{key:"isCafe",get:function(){return this.selectedLocation.abm_type===this.KVA_ALT_IDENTITY.CAFE}},{key:"isLocationPreselected",get:function(){return this.selectedLocation&&this.selectedLocation.original_object.preselected}},{key:"shouldShowDistance",get:function(){return this.isLocationPreselected&&this.geoCenterType}}]),t}();c.$inject=["$log","$window","kycConstants","KYCFlowService","BarcodeService","KVAAltConfirmService","LocaleService","AbmMapConstants","$q","$scope","EnvironmentService"],e.default=c,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=[212222,222122,222221,121223,121322,131222,122213,122312,132212,221213,221312,231212,112232,122132,122231,113222,123122,123221,223211,221132,221231,213212,223112,312131,311222,321122,321221,312212,322112,322211,212123,212321,232121,111323,131123,131321,112313,132113,132311,211313,231113,231311,112133,112331,132131,113123,113321,133121,313121,211331,231131,213113,213311,213131,311123,311321,331121,312113,312311,332111,314111,221411,431111,111224,111422,121124,121421,141122,141221,112214,112412,122114,122411,142112,142211,241211,221114,413111,241112,134111,111242,121142,121241,114212,124112,124211,411212,421112,421211,212141,214121,412121,111143,111341,131141,114113,114311,411113,411311,113141,114131,311141,411131,211412,211214,211232,23311120],o={A:function(t){return t>=0&&t<32?t+64:t>=32&&t<96?t-32:t},B:function(t){return t>=32&&t<128?t-32:t},C:function(t){return t}},c=function(){function t(){(0,i.default)(this,t)}return(0,a.default)(t,[{key:"code128",value:function(t,e){var n=t,i=e;arguments.length<2&&(i=this.code128Detect(n)),"C"===i&&n.length%2==1&&(n="0"+n);var a=this.parseBarcode128(n,i);return this.bar2html128(a.join(""))}},{key:"code128Detect",value:function(t){return/^[0-9]+$/.test(t)?"C":/[a-z]/.test(t)?"B":"A"}},{key:"parseBarcode128",value:function(t,e){var n=this,i=[];i.add=function(t){var e=r[t];n.check=0===n.length?t:n.check+t*n.length,i.push(e||n.format("UNDEFINED: %1->%2",t,e))},i.add(38+e.charCodeAt(0));for(var a=0;a<t.length;a++){var s=void 0;"C"===e?(s=t.substr(a,2),a+=1):s=t.charCodeAt(a);var c=o[e](s);if(isNaN(c)||c<0||c>106)throw new Error(this.format("Unrecognized character (%1) at position %2 in code '%3'.",s,a,t));i.add(c)}return i.push(r[i.check%103],r[106]),i}},{key:"format",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var a=n,s=new RegExp("%([1-"+(a.length-1)+"])","g");return(""+t).replace(s,(function(t,e){return a[e]}))}},{key:"bar2html128",value:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push('<div class="bar'+t.charAt(n)+" space"+t.charAt(n+1)+'"></div>');return e.join("")}}]),t}();c.$inject=[],e.default=c,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(49)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n){(0,a.default)(this,t),this.RequesterService=e,this.AVAILABLE_SERVICES=n.AVAILABLE_SERVICES}return(0,s.default)(t,[{key:"submitKYCMethod",value:function(t){var e=this,n=(0,i.default)(t.original_object),a={kyc_information:{kyc_method:t.abm_type,selectedPOILocation:n}};return this.RequesterService.request(this.AVAILABLE_SERVICES.PUT_KYC_METHOD,{data:a}).then((function(){return e._getCustomerInfo()}))}},{key:"_getCustomerInfo",value:function(){return this.RequesterService.request(this.AVAILABLE_SERVICES.GET_CUSTOMER_INFO)}}]),t}();o.$inject=["RequesterService","serviceConstants"],e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="ng-hide",a="ng-hide-animate";function s(t,e){return{restrict:"A",link:function(n,s){t.removeClass(s,i),e.isKycPending().then((function(e){t[e?"removeClass":"addClass"](s,i,{tempClasses:a})})).catch((function(){}))}}}function r(t,e){return{restrict:"A",link:function(n,s){t.addClass(s,i),e.isKycPending().then((function(e){t[e?"addClass":"removeClass"](s,i,{tempClasses:a})})).catch((function(){t.removeClass(s,i)}))}}}function o(t){return{restrict:"A",link:function(e,n){n.attr("disabled","disabled"),t.isKycPending().then((function(t){t?n.attr("disabled","disabled"):n.removeAttr("disabled")})).catch((function(){n.removeAttr("disabled")}))}}}function c(t,e){return{priority:1,restrict:"A",compile:function(n,i){var a=i.ngClick;return i.$set("ngClick",""),{post:function(n,i,s){t.isKycPending().then((function(t){t?i.bind("click",(function(t){n.$eval(s.tngWarnOnClickKycPending),e.showKYCRoadblockModal({mortgageDealId:s.tngMortgageDealId}),t.preventDefault()})):i.bind("click",(function(){a&&n.$eval(a)}))}))}}}}}s.$inject=["$animate","KYCPendingService"],r.$inject=["$animate","KYCPendingService"],o.$inject=["KYCPendingService"],c.$inject=["KYCPendingService","GlobalModalsService"],e.ShowIfKycPendingDirective=s,e.HideIfKycPendingDirective=r,e.DisableIfKycPendingDirective=o,e.WarnOnClickIfKycPendingDirective=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5386)),a=s(n(5387));function s(t){return t&&t.__esModule?t:{default:t}}n(5388);var r={template:i.default,controller:a.default,bindings:{onEnrollDone:"&",hideBackButton:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-kyc-enroll"> <div class="c-kyc-enroll__loader" ng-show="$ctrl.flowService.currentFlow.inLoadingMode"> <tng-loading-spinner></tng-loading-spinner> </div> <div ng-show="!$ctrl.flowService.currentFlow.inLoadingMode"> <div class="container" ng-show="$ctrl.flowService.showConfirmExitUI"> <tng-confirm-exit></tng-confirm-exit> </div> <div class="container"> <tng-error-message ng-if="$ctrl.flowService.errors.length"> <ul> <li ng-repeat="error in $ctrl.flowService.errors">{{ error | translate }}</li> </ul> </tng-error-message> </div> <div ng-show="!$ctrl.flowService.showConfirmExitUI"> <div class="container c-kyc-enroll__basic-info" ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.BASIC_INFO"> <h2>{{ ::\'clientOnboarding.basicInfoForm.heading\' | translate:{ firstName: $ctrl.flowService.customer.first_name } }}</h2> <p class="medium">{{ ::\'clientOnboarding.basicInfoForm.subheading\' | translate}}</p> <h4>{{ ::\'clientOnboarding.basicInfoForm.subheading2\' | translate}}</h4> <tng-basic-info-form disable-edit="true" customer="$ctrl.flowService.customer" on-input-change="$ctrl.onBasicInfoChange(data, isValid)" show-sin="true" show-email="true" sin-required="true" sin-data="$ctrl.sinData" show-validation-on-load="true" should-hide-use-legal-name-note="true" validate-po-box="true" show-po-box-validation-on-load="true"> </tng-basic-info-form> </div> <tng-kyc ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.KYC" on-kyc-complete="$ctrl.onKYCDone()" register-flow="$ctrl.flowService.setSubFlow(subFlow)"></tng-kyc> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.flowService=e,this.FlowFooterService=n,this.sinData={editable:!0}}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.FlowFooterService.setupHooks({visibility:function(){return!0},gotoPreviousState:function(){return t.flowService.currentFlow.onButtonClickBack()},gotoNextState:function(){return t.flowService.currentFlow.onButtonClickNext()},flowService:this.flowService}),this.FlowFooterService.enable(),this.flowService.loadCustomerInfo().then((function(){t.flowService.activate(),t.flowService.BUTTONS.BTN_GRY.show=!t.hideBackButton,t.flowService.customer&&t.flowService.customer.sin&&t.flowService.customer.sin.length>0&&(t.sinData.editable=!1)}))}},{key:"onBasicInfoChange",value:function(t,e){this.flowService.BUTTONS.BTN_ORG.disable=!e}},{key:"onKYCDone",value:function(){this.FlowFooterService.disable(),this.onEnrollDone()}},{key:"$onDestroy",value:function(){this.flowService.deactivate()}}]),t}();r.$inject=["KYCEnrollFlowService","FlowFooterService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=f(n(142)),a=f(n(269)),s=f(n(8)),r=f(n(177)),o=f(n(0)),c=f(n(2)),l=f(n(264)),u=f(n(266)),d=f(n(265)),h=n(267);function f(t){return t&&t.__esModule?t:{default:t}}var p=function(t){function e(t,n,i,a,s,c,u,d,f,p){(0,o.default)(this,e);var g=(0,l.default)(this,(e.__proto__||(0,r.default)(e)).call(this,t,n,i,a,s,u,c,d));return g.CustomerInfoService=f,g.stateConstants=p,g.STATES={BASIC_INFO:"basicInfo",KYC:"kyc"},g._initialState=g.STATES.BASIC_INFO,g.BUTTONS={BTN_GRY:new h.PageFlowButton(g.BUTTON_TYPES.BACK,!0,!1),BTN_ORG:new h.PageFlowButton(g.BUTTON_TYPES.NEXT,!0,!0)},g.customer=null,g}return(0,d.default)(e,t),(0,c.default)(e,[{key:"resetState",value:function(){(0,u.default)(e.prototype.__proto__||(0,r.default)(e.prototype),"resetState",this).call(this),this.customer=null}},{key:"gotoNextState",value:function(){switch(this.errors=[],this.currentState){case this.STATES.BASIC_INFO:this.moveTo(this.STATES.KYC);break;case this.STATES.KYC:}}},{key:"postGotoPreviousState",value:function(){this.errors=[]}},{key:"_updateUI",value:function(){switch(this.currentState){case this.STATES.BASIC_INFO:this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_GRY.disable=!0,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.SUBMIT,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!1;break;case this.STATES.KYC:}}},{key:"loadCustomerInfo",value:function(){var t=this;return this.enterLoadingMode(),this.CustomerInfoService.getCustomer().then((function(e){return t.customer=e.customer,e})).finally((function(){t.exitLoadingMode()}))}},{key:"onButtonClickNext",value:function(){var t=this;this.enterLoadingMode();var e=(0,s.default)({},this.customer);e.employment_status=e.employment_status.code,delete e.dateOfBirth,delete e.occupation.industryObject,delete e.occupation.occupationObject,e.occupation.industry_code&&e.occupation.occupation_code||delete e.occupation,this.CustomerInfoService.update(e).then((function(){t.gotoNextState()})).catch((function(e){t._prepareErrors(e)})).finally((function(){t.exitLoadingMode()}))}},{key:"onButtonClickBack",value:function(){this.$state.go(this.stateConstants.ACCOUNT_SUMMARY)}},{key:"_prepareErrors",value:function(t){if(this.errors=[],t&&t.response_status&&t.response_status.details){var e=new a.default;t.response_status.details.forEach((function(t){e.add("global.errorCodes."+t.details_code)})),this.errors=(0,i.default)(e)}else t&&t.response_status&&t.response_status.status_code?this.errors.push("global.errorCodes."+t.response_status.status_code):this.errors.push("global.errorCodes.generic")}}]),e}(f(h).default);p.$inject=["$log","$q","$transitions","$state","$window","pageFlowConstants","$rootScope","AnalyticsService","CustomerInfoService","stateConstants"],e.default=p,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5391)),a=s(n(5392));function s(t){return t&&t.__esModule?t:{default:t}}n(5393);var r={template:i.default,controller:a.default,bindings:{}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-kyc road-block-triggered="$ctrl.roadBlockTriggered" next-state="$ctrl.nextState" next-params="$ctrl.nextParams"></tng-kyc> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(8)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e){(0,a.default)(this,t),(0,i.default)(this,{$stateParams:e})}return(0,s.default)(t,[{key:"$onInit",value:function(){this.roadBlockTriggered=this.$stateParams.roadBlockTriggered?this.$stateParams.roadBlockTriggered:void 0,this.nextState=this.$stateParams.nextState?this.$stateParams.nextState:void 0,this.nextParams=this.$stateParams.nextParams?this.$stateParams.nextParams:void 0}}]),t}();o.$inject=["$stateParams"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5395)),a=s(n(5396));function s(t){return t&&t.__esModule?t:{default:t}}n(5397);var r={template:i.default,controller:a.default};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-mortgage-tracker"> <div ng-if="$ctrl.isLoading" class="c-mortgage-tracker__loading-spinner-container"> <div class="c-mortgage-tracker__loading-spinner"> <tng-loading-spinner></tng-loading-spinner> </div> </div> <div aria-hidden="true" class="c-mortgage-tracker__mortgagetracker-banner rfBanner" ng-if="$ctrl.application.isReadyToFund"> <div class="c-mortgage-tracker__mortgagetracker-banner__header"> {{::\'mortgageTracker.readyToFund.bannerTitle\' | translate}} </div> </div> <div aria-hidden="true" class="c-mortgage-tracker__mortgagetracker-banner paBanner" ng-if="$ctrl.application.isPreApproved"> <div class="c-mortgage-tracker__mortgagetracker-banner__header"> {{::\'mortgageTracker.preApproved.bannerTitle\' | translate}} </div> </div> <div ng-if="!$ctrl.isLoading"> <div class="c-mortgage-tracker__content top-margin-small" ng-if="!$ctrl.hasFatalError && $ctrl.application.showConditionChecklist"> <tng-condition-checklist header="::\'mortgageTracker.applicationConditions.title\' | translate" items="$ctrl.application.applicationConditions"></tng-condition-checklist> </div> <section class="c-mortgage-tracker__content"> <h1 class="font large"> {{$ctrl.headerDisplay}} </h1> <div class="top-margin-small descriptionContainer"> <p class="medium-width-section" ng-bind-html="$ctrl.descriptionDisplay"></p> <div> <button ng-if="$ctrl.application.isPreApproved" actionable-id="mortgage-tracker-pre-approved-view-certificate" class="btn btn--auto btn--orange btn--large" ng-click="$ctrl.viewCertificate()">{{ \'mortgageTracker.preApproved.viewCertificateBtn\' | translate }} </button> </div> </div> </section> <section class="c-mortgage-tracker__content no-top-margin" ng-if="($ctrl.application.isWaitingForJoint\n        && $ctrl.application.applicants.length === 1)\n        || $ctrl.application.hasJointDeclined"> <button class="btn btn--fluid" ng-click="$ctrl.resendInvitation()">{{::\'mortgageTracker.editResendInvite\' | translate}}</button> </section> <div class="c-move-money__error container" ng-if="$ctrl.displayError.hasSubmitErrors"> <tng-error-message> <ul> <li ng-repeat="error in $ctrl.displayError.submitErrors">{{error | translate}}</li> </ul> </tng-error-message> </div> <section class="c-mortgage-tracker__content" ng-if="!$ctrl.hasFatalError && $ctrl.application.showDeclinedAccordion"> <h2 class="font large">{{::\'mortgageTracker.applicationDeclined.accordion.title\' | translate}}</h2> <div class="top-margin-small"> <tng-accordion rows="$ctrl.applicationDeclinedAccordion" name="applicationDeclinedAccordion" id="printMe2"></tng-accordion> </div> <div class="top-margin-small"> <tng-print-button button-class="btn btn--orange" only-element="\'printMe2\'"> {{::\'global.print\' | translate}} </tng-print-button> </div> </section> <section class="c-mortgage-tracker__content" ng-if="!$ctrl.hasFatalError\n        && !$ctrl.application.isDeclined"> <tng-mortgage-application-info-tile disclaimer="{{ $ctrl.application.infoTileDisclaimer }}" reference-number="$ctrl.application.dealId" show-closing-date-progress="$ctrl.application.isConditionallyApproved" transaction-type="$ctrl.application.transactionType" property-address="$ctrl.application.propertyAddress" mortgage-amount="$ctrl.application.mortgageAmount" interest-rate="$ctrl.application.interestRate" closing-date="$ctrl.application.closingDate" submit-date="$ctrl.application.submitDate" term-display="$ctrl.application.termDisplay" hide-closing-date="$ctrl.hideClosingDate" payment-details="$ctrl.application.paymentDetails" amortization-period="$ctrl.application.amortizationPeriod" has-heloc="$ctrl.application.creditLimit" heloc-limit="$ctrl.application.creditLimit" heloc-interest-rate="$ctrl.application.helocInterestRate" is-joint="$ctrl.application.numOfApplicants !== 1"> </tng-mortgage-application-info-tile> </section> <section class="c-mortgage-tracker__content" ng-if="$ctrl.application.showNextSteps"> <h2> {{::\'mortgageTracker.readyToFund.nextSteps\' | translate}} </h2> <p class="medium-width-section" ng-if="$ctrl.application.isReadyToFund">{{::\'mortgageTracker.readyToFund.nextStepsDesc\' | translate}}</p> <p class="medium-width-section" ng-if="$ctrl.application.isPreApproved">{{::\'mortgageTracker.preApproved.nextStepsDesc\' | translate}}</p> <div class="c-mortgage-tracker__next-steps-tiles medium-width-section"> <tng-tile-list numbered="true" all-actionable="!$ctrl.application.isPreApproved" tile-data="$ctrl.application.nextStepsButtons" on-tile-click="$ctrl.nextButtonClick(tileData)" tile-type="$ctrl.tileListConstants.TILE_TYPE.text" is-actionable="$ctrl.isActionable(tileData)"> </tng-tile-list> <section ng-if="$ctrl.application.isPreApproved" class="small medium-width-section"> {{:: \'mortgageTracker.preApproved.nextStepsDisclaimer\' | translate }} </section> </div> </section> <section ng-if="$ctrl.hasTabsToShow"> <nav class="tabs-nav"> <ul class="list"> <li ng-repeat="tab in $ctrl.TABS_LIST" ng-if="tab.show" class="item" ng-class="{\'active\': $ctrl.isActiveTab(tab)}" actionable-id="mortgage-tracker-tab-condition_{{tab.code}}" ng-click="$ctrl.switchTab(tab)" translate-cloak> {{ tab.label | translate }} </li> </ul> </nav> </section> <section ng-if="$ctrl.isActiveTab($ctrl.TABS.CONDITIONS)" class="c-mortgage-tracker__content"> <tng-user-condition-checklist rows="$ctrl.application.userConditionChecklist" deal-id="$ctrl.application.dealId" show-uploaded-message="!$ctrl.mortgageTrackerUpgraded && $ctrl.mortgageTrackerService.docsUploadedInSession" on-docs-uploaded="$ctrl.docsUploaded()"> </tng-user-condition-checklist> </section> <section ng-if="$ctrl.isActiveTab($ctrl.TABS.DOCS)" class="c-mortgage-tracker__content"> <tng-user-document-list rows="$ctrl.application.userDocumentList"> </tng-user-document-list> </section> <div class="c-secondary-section" ng-if="!$ctrl.hasFatalError\n      && $ctrl.application.showMortgageSpecialistSection"> <div class="c-mortgage-tracker__content"> <tng-mortgage-application-mam-tile mortgage-specialist="$ctrl.application.mortgageSpecialist" show-mam-note="$ctrl.application.isConditionallyApproved" heloc-only="$ctrl.application.helocOnly"></tng-mortgage-application-mam-tile> </div> </div> <div class="c-secondary-section" ng-if="$ctrl.application.isDeclined"> <section class="c-mortgage-tracker__content"> <h2 class="font large">{{::\'mortgageTracker.quickAccess.title\' | translate}}</h2> <p>{{::\'mortgageTracker.quickAccess.description\' | translate}}</p> </section> <div class="c-mortgage-tracker__content grid__container"> <div class="grid__column--1of3"> <tng-quick-access-tile title="\'mortgageTracker.quickAccess.steps.0.title\' | translate" description="\'mortgageTracker.quickAccess.steps.0.description\' | translate"> <tng-quick-access-tile-buttons> <button actionable-id="quickAccess_shareKey" class="btn btn--orange btn--auto" tng-click="$ctrl.mortgageTrackerService.financialPlanOnClick()">{{ ::\'mortgageTracker.quickAccess.steps.0.link\' | translate }} </button> </tng-quick-access-tile-buttons> </tng-quick-access-tile> </div> <div class="grid__column--1of3"> <tng-quick-access-tile title="\'mortgageTracker.quickAccess.steps.1.title\' | translate" description="\'mortgageTracker.quickAccess.steps.1.description\' | translate"> <tng-quick-access-tile-buttons> <button actionable-id="quickAccess_shareKey" class="btn btn--orange btn--auto" tng-click="$ctrl.mortgageTrackerService.increaseDownPaymentOnClick()">{{ ::\'mortgageTracker.quickAccess.steps.1.link\' | translate }} </button> </tng-quick-access-tile-buttons> </tng-quick-access-tile> </div> <div class="grid__column--1of3"> <tng-quick-access-tile title="\'mortgageTracker.quickAccess.steps.2.title\' | translate" description="\'mortgageTracker.quickAccess.steps.2.description\' | translate"> <tng-quick-access-tile-buttons> <button actionable-id="quickAccess_shareKey" class="btn btn--orange btn--auto" tng-click="$ctrl.mortgageTrackerService.spendAndImproveCreditRatingOnClick()">{{ ::\'mortgageTracker.quickAccess.steps.2.link\' | translate }} </button> </tng-quick-access-tile-buttons> </tng-quick-access-tile> </div> </div> </div> <div class="c-secondary-section"> <div class="c-mortgage-tracker__content" ng-if="$ctrl.application.isPreApproval"> <h2>{{ :: \'mortgage.confirmation.preApproval.contactUs.header\' | translate }}</h2> <p class="medium-width-section" ng-bind-html="::\'mortgage.confirmation.preApproval.contactUs.content\' | translate"></p> </div> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d){(0,i.default)(this,t),this.$stateParams=e,this.$translate=n,this.displayError=a(),this.hasFatalError=!1,this.mortgageConstants=s,this.mortgageTrackerService=r,this.environmentService=o,this.$window=c,this.$state=l,this.stateConstants=u,this.AnalyticsService=d,this.AVAILABLE_EVENTS=d.availableEvents,this.TABS=s.TRACKER_TABS,this.TABS_LIST=s.TRACKER_TABS_LIST}return(0,a.default)(t,[{key:"$onInit",value:function(){this.activeTab=this.TABS.CONDITIONS,this.application={},this.dealId=this.$stateParams.dealId,this.isLoading=!0,this.visitorSiteUrl=this.environmentService.getBaseUrl(),this.applicationDeclinedAccordion=this.mortgageTrackerService.getApplicationDeclinedAccordionData(),this.AnalyticsService.sendAction(this.AVAILABLE_EVENTS.MORTGAGE_APP_TRACKER_OPENED),this.mortgageTrackerUpgraded=this.environmentService.get("mortgageTrackerUpgraded"),this.loadApplication()}},{key:"loadApplication",value:function(){var t=this;this.mortgageTrackerService.loadApplication(this.dealId).then((function(e){t.application=e,t.hideClosingDate=t.application.isReadyToFund||t.application.isPreApproved,t.TABS.CONDITIONS.show=t.showConditionsList,t.TABS.DOCS.show=t.showDocsList})).catch((function(e){t.displayError.showSubmitErrors(e),t.hasFatalError=!0})).finally((function(){t.isLoading=!1}))}},{key:"docsUploaded",value:function(){this.loadApplication()}},{key:"resendInvitation",value:function(){this.mortgageTrackerService.resendInvitation(this.dealId,this.application)}},{key:"viewCertificate",value:function(){this.$state.go(this.stateConstants.ACCOUNT_DOCUMENTS_OTHER)}},{key:"nextButtonClick",value:function(t){t.action&&this.$window.open(""+this.$translate.instant("mortgageTracker."+t.action),"_blank")}},{key:"isActionable",value:function(t){return!!t.action}},{key:"isActiveTab",value:function(t){return Boolean(!this.hasFatalError&&this.hasTabsToShow&&this.activeTab===t)}},{key:"switchTab",value:function(t){this.activeTab=t}},{key:"headerDisplay",get:function(){return this.application?this.mortgageTrackerService.getHeaderDisplay(this.application):""}},{key:"descriptionDisplay",get:function(){return this.application?this.mortgageTrackerService.getDescriptionDisplay(this.application):""}},{key:"showConditionsList",get:function(){return Boolean(!this.hasFatalError&&this.application.isConditionallyApproved&&this.application.userConditionChecklist&&this.application.userConditionChecklist.length)}},{key:"showDocsList",get:function(){return Boolean(!this.hasFatalError&&this.application.isConditionallyApproved&&this.application.userDocumentList&&this.application.userDocumentList.length>0)}},{key:"hasTabsToShow",get:function(){return this.TABS_LIST.some((function(t){return t.show}))}}]),t}();r.$inject=["$stateParams","$translate","displayErrorFactory","mortgageConstants","mortgageTrackerService","EnvironmentService","$window","$state","stateConstants","AnalyticsService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(5399),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("tangerine.mortgageTracker.UserConditionChecklist",[]).component("tngUserConditionChecklist",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5400)),a=s(n(5401));function s(t){return t&&t.__esModule?t:{default:t}}n(5402),e.default={controller:a.default,template:i.default,bindings:{rows:"<",dealId:"<",showUploadedMessage:"<",onDocsUploaded:"&"}},t.exports=e.default},function(t,e){t.exports='<div class="tng-user-condition-checklist"> <p class="medium-width-section" ng-bind-html="::\'mortgageTracker.conditions.title\' | translate"></p> <p class="medium-width-section upload-info" ng-if="!$ctrl.showUploadedMessage && !$ctrl.mortgageTrackerUpgraded" ng-bind-html="::\'mortgageTracker.conditions.title2\' | translate"></p> <p class="medium-width-section upload-info" ng-if="!$ctrl.showUploadedMessage && $ctrl.mortgageTrackerUpgraded" ng-bind-html="::\'mortgageTracker.conditions.title2UPGRADED\' | translate"></p> <tng-warning-message ng-if="$ctrl.showUploadedMessage" warning-title="::\'mortgageTracker.conditions.uploadMessage.header\' | translate"> {{::\'mortgageTracker.conditions.uploadMessage.details\' | translate }} </tng-warning-message> <table class="larger-than-phone-only table table--full top-margin-small"> <caption class="visually-hidden">{{\'mortgageTracker.tabs.conditions\' | translate}}</caption> <thead> <tr> <th>{{ :: \'mortgageTracker.conditions.nameHeader\' | translate }}</th> <th>{{ :: \'mortgageTracker.conditions.statusHeader\' | translate }}</th> <th>&nbsp;</th> </tr> </thead> <tbody ng-repeat="row in $ctrl.rows"> <tr> <td ng-click="row.expanded = !row.expanded" class="top-border condition-cell"> <span id="condition-title{{$index}}" aria-describedby="sr-condition-description{{$index}}"> <strong>{{ row.webtitle }}</strong> </span> <i class="chevron large" aria-hidden="true" ng-class="row.expanded ? \'icon-uparrow\' : \'icon-downarrow\'"> </i> <div class="visually-hidden" role="tooltip" id="sr-condition-description{{$index}}"> <div ng-if="row.clientFriendlyDescriptions.length > 0"> <b>{{ :: \'mortgageTracker.uploadModal.clientFriendlyDescriptions.title\' | translate }}</b> <ul> <li ng-repeat="item in row.clientFriendlyDescriptions"> {{item}} </li> </ul> </div> <div ng-if="!row.clientFriendlyDescriptions.length"> {{ row.description }} </div> </div> </td> <td class="top-border status-cell"> <div aria-describedby="condition-status-tooltip{{$index}}"> {{ row.statusKey | translate }} <tng-help-bubble ng-if="row.showStatusTooltip" screen-reader-tooltip-id="condition-status-tooltip{{$index}}"> <span ng-bind-html="row.statusTooltipKey | translate"></span> </tng-help-bubble> </div> </td> <td class="right-align top-border upload-cell"> <button ng-if="row.docUploadEnabled()" class="btn btn--edit" actionable-id="tng-user-condition-checklist-upload_{{$index}}" ng-click="$ctrl.uploadClicked(row)"> {{ ::\'global.components.buttons.upload\' | translate }} </button> </td> </tr> <tr ng-if="row.expanded" aria-hidden="true"> <td colspan="3" class="legal-cell"> <div ng-if="row.clientFriendlyDescriptions.length > 0"> <b>{{ :: \'mortgageTracker.uploadModal.clientFriendlyDescriptions.title\' | translate }}</b> <ul> <li ng-repeat="item in row.clientFriendlyDescriptions"> {{item}} </li> </ul> </div> <div ng-if="!row.clientFriendlyDescriptions.length"> {{ row.description }} </div> </td> </tr> <tr ng-if="$ctrl.mortgageTrackerUpgraded && row.uploadHistory && row.uploadHistory.length"> <td colspan="3"> <table class="table-uploaded-docs" aria-describedby="condition-title{{$index}}"> <caption class="visually-hidden">{{\'mortgageTracker.tabs.docs\' | translate}}</caption> <thead> <th>{{ ::\'mortgageTracker.conditions.dateReceived\' | translate }}</th> <th>{{ ::\'mortgageTracker.conditions.filesUploaded\' | translate }}</th> </thead> <tbody ng-repeat="doc in row.uploadHistory"> <tr> <td class="date">{{ doc.date | date: \'MMM d y, h:mm a\' }}</td> <td class="files">{{ doc.files }}</td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <div class="phone-only top-margin-small"> <div> <strong role="heading"> <span id="condition-status-header">{{ :: \'mortgageTracker.conditions.statusHeader\' | translate }}</span> / <span id="condition-name-header">{{ :: \'mortgageTracker.conditions.nameHeader\' | translate }}</span> </strong> </div> <div class="content-container"> <div class="content-item" role="group" ng-repeat="row in $ctrl.rows"> <div> <span aria-labelledby="condition-status-header" aria-describedby="condition-tooltip{{$index}}"> {{ row.statusKey | translate }} </span> <tng-help-bubble ng-if="row.showStatusTooltip" screen-reader-tooltip-id="condition-tooltip{{$index}}"> <span ng-bind-html="row.statusTooltipKey | translate"> </span> </tng-help-bubble> </div> <div ng-click="row.expanded = !row.expanded" class="condition-cell"> <i class="chevron large" aria-hidden="true" ng-class="row.expanded ? \'icon-uparrow\' : \'icon-downarrow\'"> </i> <div id="condition-title{{$index}}" class="title" aria-labelledby="condition-name-header" aria-describedby="sr-condition-description{{$index}}"> {{ row.webtitle }} </div> </div> <div class="visually-hidden" role="tooltip" id="sr-condition-description{{$index}}"> <div ng-if="row.clientFriendlyDescriptions.length > 0"> <b>{{ :: \'mortgageTracker.uploadModal.clientFriendlyDescriptions.title\' | translate }}</b> <ul> <li ng-repeat="item in row.clientFriendlyDescriptions"> {{item}} </li> </ul> </div> <div ng-if="!row.clientFriendlyDescriptions.length"> {{ row.description }} </div> </div> <div aria-hidden="true" ng-if="row.expanded" class="legal-cell"> <div ng-if="row.clientFriendlyDescriptions.length > 0"> <b>{{ :: \'mortgageTracker.uploadModal.clientFriendlyDescriptions.title\' | translate }}</b> <ul> <li ng-repeat="item in row.clientFriendlyDescriptions"> {{item}} </li> </ul> </div> <div ng-if="!row.clientFriendlyDescriptions.length"> {{ row.description }} </div> </div> <div ng-if="$ctrl.mortgageTrackerUpgraded && row.uploadHistory && row.uploadHistory.length"> <table class="table-uploaded-docs" aria-describedby="condition-title{{$index}}"> <caption class="visually-hidden">{{\'mortgageTracker.tabs.docs\' | translate}}</caption> <thead> <th>{{ ::\'mortgageTracker.conditions.dateReceived\' | translate }}</th> <th>{{ ::\'mortgageTracker.conditions.filesUploaded\' | translate }}</th> </thead> <tbody ng-repeat="doc in row.uploadHistory"> <tr> <td class="date">{{ doc.date | date: \'MMM d y, h:mm a\' }}</td> <td class="files">{{ doc.files }}</td> </tr> </tbody> </table> </div> <div class="button-cell"> <button aria-describedby="condition-title{{$index}}" ng-if="row.docUploadEnabled()" class="btn btn--edit" actionable-id="tng-user-condition-checklist-upload_{{$index}}" ng-click="$ctrl.uploadClicked(row)"> {{ ::\'global.components.buttons.upload\' | translate }} </button> </div> </div> </div> </div> </div> <tng-mortgage-tracker-document-upload ng-if="$ctrl.showDocUpload" on-close="$ctrl.closeDocUploadModal()" condition="$ctrl.selectedCondition" conditions="$ctrl.rows" deal-id="$ctrl.dealId" on-docs-uploaded="$ctrl.onDocsUploaded()"> </tng-mortgage-tracker-document-upload> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n){(0,i.default)(this,t),this.mortgageConstants=e,this.EnvironmentService=n}return(0,a.default)(t,[{key:"$onInit",value:function(){this.mortgageTrackerUpgraded=this.EnvironmentService.get("mortgageTrackerUpgraded")}},{key:"uploadClicked",value:function(t){this.selectedCondition=t,this.showDocUpload=!0}},{key:"closeDocUploadModal",value:function(){this.showDocUpload=!1}}]),t}();r.$inject=["mortgageConstants","EnvironmentService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(5404),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("tangerine.mortgageTracker.mortgageTrackerDocumentUpload",[]).component("tngMortgageTrackerDocumentUpload",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5405)),a=s(n(5406));function s(t){return t&&t.__esModule?t:{default:t}}n(5407);var r={template:a.default,controller:i.default,bindings:{condition:"<",conditions:"<",onClose:"&",dealId:"<",onDocsUploaded:"&"}};e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(68)),a=l(n(142)),s=l(n(0)),r=l(n(2)),o=l(n(116)),c=n(67);function l(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(e,n,i,a,r,o,l,u,d,h,f,p){(0,s.default)(this,t),this.$log=e,this.$state=n,this.$translate=i,this.$document=a,this.$scope=r,this.mortgageConstants=o,this.mortgageTrackerService=l,this.EnvironmentService=u,this.AnalyticsService=d,this.DocumentUploadService=h,this.serviceErrorHandler=f(),this.AnchorService=p,this.modalSessionFilenames=[],this.AVAILABLE_EVENTS=d.availableEvents,this.CONST=this.mortgageConstants.DOC_UPLOAD,this.URL=this.EnvironmentService.get("mortgageDocumentUploadUrl"),this.mortgageTrackerUpgraded=this.EnvironmentService.get("mortgageTrackerUpgraded"),this.documentUploadInvalidCharacterValidation=c.documentUploadInvalidCharacterValidation}return(0,r.default)(t,[{key:"$onInit",value:function(){this._resetState(),this.mobileDevice=this.EnvironmentService.isNative()||this.EnvironmentService.isIOS()||this.EnvironmentService.isAndroid(),this.mobileDevice||(this.dropBox=this.$document[0].body,this.fileDropHandler=this._fileDropHandler.bind(this),this.dragOverHandler=this._dragOverHandler.bind(this),this.dragLeaveHandler=this._dragLeaveHandler.bind(this),this.preventDefaultHandler=this._preventDefault.bind(this),this.dropBox.addEventListener("drop",this.fileDropHandler,!1),this.dropBox.addEventListener("dragover",this.dragOverHandler,!1),this.dropBox.addEventListener("dragenter",this.preventDefaultHandler,!1),this.dropBox.addEventListener("dragleave",this.dragLeaveHandler,!1))}},{key:"_resetState",value:function(){this.fileOverScreen=!1,this.confirmed=!1,this.loading=!1,this.errors=[],this.files=[],this.dropBox=null,this.uploadedDocs=null}},{key:"_dragOverHandler",value:function(t){var e=this;t.preventDefault(),this.$scope.$apply((function(){e.fileOverScreen=!0}))}},{key:"_dragLeaveHandler",value:function(){var t=this;this.$scope.$apply((function(){t.fileOverScreen=!1}))}},{key:"_fileDropHandler",value:function(t){var e=this,n=(0,o.default)(t,"dataTransfer.files");if(n&&n.length){var i=(0,a.default)(n);this.$scope.$apply((function(){e.onFilesSelected({files:i}),e.fileOverScreen=!1}))}t.preventDefault()}},{key:"_preventDefault",value:function(t){t.preventDefault()}},{key:"onFilesSelected",value:function(t){var e=this,n=t&&t.files;if(this.canSelect&&n&&n.length){if(this.errors=[],-1!==n.map((function(t){return e._getFileExt(t)})).indexOf("pdf")&&(n.length>1||this.files.length>0))this.errors.push("mortgageTracker.uploadModal.error.pdfFileLimitation"),this.AnalyticsService.sendAction(this.AVAILABLE_EVENTS.MORTGAGE_DOC_UPLOAD_PDF_FILE_COUNT_VIOLATION);else if(this.files.length+n.length>this.CONST.MAX_FILES)this.errors.push(this.$translate.instant("mortgageTracker.uploadModal.error.toManyFiles",{max:this.CONST.MAX_FILES})),this.AnalyticsService.sendAction(this.AVAILABLE_EVENTS.MORTGAGE_DOC_UPLOAD_TOO_MANY_FILES);else{var a;if((a=this.files).push.apply(a,(0,i.default)(n.filter((function(t){var n=e._getFileExt(t),i=-1!==e.CONST.SUPPORTED_TYPES.EXT_LIST.indexOf(e._getFileExt(t)),a=t.size<=("pdf"===n?e.CONST.MAX_PDF_FILE_SIZE_BYTES:e.CONST.MAX_IMG_FILE_SIZE_BYTES),s=!e.files.filter((function(e){return e.name===t.name&&e.size===t.size})).length,r=e.isFileNameInvalid(t),o=function(t){-1===e.errors.indexOf(t)&&e.errors.push(t)};return r&&(o("mortgageTracker.uploadModal.error.fileNameInvalid"),e.AnalyticsService.sendAction(e.AVAILABLE_EVENTS.MORTGAGE_DOC_UPLOAD_UNSUPPORTED_FILENAME)),i||(o("mortgageTracker.uploadModal.error.invalidType"),e.AnalyticsService.sendAction(e.AVAILABLE_EVENTS.MORTGAGE_DOC_UPLOAD_UNSUPPORTED_TYPE)),a||(o("mortgageTracker.uploadModal.error.filesToLarge"),e.AnalyticsService.sendAction(e.AVAILABLE_EVENTS.MORTGAGE_DOC_UPLOAD_FILE_TOO_LARGE)),i&&a&&s&&!r})))),this.mortgageTrackerUpgraded&&this.files&&this.files.length){var s=this.conditions.flatMap((function(t){return t.uploadHistory.map((function(t){return t.files.toLowerCase()}))}));this.files.forEach((function(t){t.duplicateDetected=s.some((function(e){return e.indexOf(t.name.toLowerCase())>=0}))||-1!==e.modalSessionFilenames.indexOf(t.name.toLowerCase())}))}}this.errors.length>0?this.AnchorService.scrollToModalTop():this.AnchorService.scroll("mgtDocUpload_selectedDocuments")}}},{key:"_getFileExt",value:function(t){return t.type.slice(t.type.lastIndexOf("/")+1)}},{key:"uploadFiles",value:function(){var t=this;return this.loading=!0,this.serviceErrorHandler.resetSubmitErrors(),this.errors=[],this.DocumentUploadService.upload({files:this.files,type:this.condition.documentType,reason:this.CONST.REASON,url:this.URL,timeout:this.CONST.TIMEOUT,transactionId:this.dealId,updateUploadHistory:!!this.mortgageTrackerUpgraded,conditionId:this.condition.id}).then((function(e){var n;t.confirmed=!0,t.uploadedDocs=e,t.AnalyticsService.sendAction(t.AVAILABLE_EVENTS.MORTGAGE_DOC_UPLOAD_SERVICE_SUCCESS),t.mortgageTrackerService.docsUploadedInSession=!0,(n=t.modalSessionFilenames).push.apply(n,(0,i.default)(t.uploadedDocs.map((function(t){return t.name.toLowerCase()})))),t.onDocsUploaded()})).catch((function(e){t.serviceErrorHandler.showSubmitErrors(e),t.AnalyticsService.sendAction(t.AVAILABLE_EVENTS.MORTGAGE_DOC_UPLOAD_SERVICE_FAILURE)})).finally((function(){t.loading=!1}))}},{key:"removeFile",value:function(t){this.errors=[],this.files&&this.files.length&&-1!==this.files.indexOf(t)&&this.files.splice(this.files.indexOf(t),1)}},{key:"convertFileSizeUnitToMB",value:function(t){return t/1024/1024}},{key:"uploadMore",value:function(){this._resetState()}},{key:"isFileNameInvalid",value:function(t){return this.documentUploadInvalidCharacterValidation(t.name)}},{key:"$onDestroy",value:function(){this.dropBox&&(this.dropBox.removeEventListener("drop",this.fileDropHandler,!1),this.dropBox.removeEventListener("dragover",this.dragOverHandler,!1),this.dropBox.removeEventListener("dragenter",this.preventDefaultHandler,!1),this.dropBox.removeEventListener("dragleave",this.dragLeaveHandler,!1))}},{key:"canSelect",get:function(){return(0===this.files.length||this.files.length<this.CONST.MAX_FILES)&&(0===this.files.length||"pdf"!==this._getFileExt(this.files[0]))}},{key:"header",get:function(){return this.confirmed?"mortgageTracker.uploadModal.confirmation.header":"mortgageTracker.uploadModal.header"}},{key:"isUploadButtonDisabled",get:function(){return!this.files||!this.files.length||this.files.some((function(t){return t.duplicateDetected&&!t.duplicateAcknowledged}))}}]),t}();u.$inject=["$log","$state","$translate","$document","$scope","mortgageConstants","mortgageTrackerService","EnvironmentService","AnalyticsService","DocumentUploadService","displayErrorFactory","AnchorService"],e.default=u,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog should-close-on-esc="false" should-close-on-click-outside="false" on-close="$ctrl.onClose()" hide-close="$ctrl.loading"> <tng-loading-in-progress ng-if="$ctrl.loading"></tng-loading-in-progress> <header> <span>{{ $ctrl.header | translate }} <span ng-if="!$ctrl.confirmed">{{ $ctrl.condition.webtitle }}</span></span> </header> <tng-error-message message-title="\'mortgageTracker.uploadModal.error.title\'" class="upload-error" ng-if="$ctrl.errors.length"> <ul class="error-list"> <li ng-class="{\'error-list-item\' : $ctrl.errors.length > 1}" ng-repeat="error in $ctrl.errors" ng-bind-html="error | translate"> </li> </ul> </tng-error-message> <tng-error-message message-title="\'mortgageTracker.uploadModal.error.title\'" class="upload-error" ng-if="$ctrl.serviceErrorHandler.hasSubmitErrors"> <ul class="error-list"> <li ng-class="{\'error-list-item\' : $ctrl.errors.length > 1}" ng-repeat="error in $ctrl.serviceErrorHandler.submitErrors"> {{ error | translate }} </li> </ul> </tng-error-message> <div ng-if="!$ctrl.confirmed && !$ctrl.loading"> <div class="margin__b--rel2 medium-width-section" ng-bind-html="::\'mortgageTracker.uploadModal.description\' | translate"> </div> <div class="margin__b--rel2 medium-width-section" ng-bind-html="::$ctrl.condition.description"> </div> <div ng-if="$ctrl.condition.clientFriendlyDescriptions.length > 0" class="white-background margin__b--rel2"> <h3>{{ :: \'mortgageTracker.uploadModal.clientFriendlyDescriptions.title\' | translate }}</h3> <ul> <li ng-repeat="item in $ctrl.condition.clientFriendlyDescriptions"> {{item}} </li> </ul> </div> <div ng-class="{\n        \'file-over-screen\' : $ctrl.fileOverScreen && !$ctrl.mobileDevice && $ctrl.canSelect,\n        \'file-drop-container\': !$ctrl.mobileDevice\n      }" class="medium-spacing margin__b--rel2"> <div ng-if="!$ctrl.mobileDevice" class="drag-here" aria-hidden="true"> {{ ::\'mortgageTracker.uploadModal.dragHere\' | translate }} </div> <label id="mgtDocUpload_selectDocument" class="btn btn--tangerine btn--select" ng-disabled="!$ctrl.canSelect"> {{ ::\'mortgageTracker.uploadModal.selectDocument\' | translate }} <input actionable-id="mgtDocUpload_selectDocuments" type="file" accept="{{ ::$ctrl.CONST.SUPPORTED_TYPES.ACCEPT_ATTRIBUTE }}" tng-file-data on-image-select="$ctrl.onFilesSelected({ files })" multiple="multiple" ng-disabled="!$ctrl.canSelect"/> </label> <p class="x-small margin__t--rel1 format-descriptor"> <span>{{ :: \'mortgageTracker.uploadModal.formatDescriptor1\' | translate }}</span> <br/> <span>{{ :: \'mortgageTracker.uploadModal.formatDescriptor2\' | translate }}</span> </p> <p ng-if="$ctrl.EnvironmentService.isIOS() && !$ctrl.EnvironmentService.isNative()" class="ios-mobile margin__t--rel1"> {{ :: \'mortgageTracker.uploadModal.iosHelp\' | translate }} </p> </div> <h3 id="mgtDocUpload_selectedDocuments" class="margin__b--rel1" ng-if="$ctrl.files.length">{{ ::\'mortgageTracker.uploadModal.documentsSelected\' | translate }}</h3> <div ng-if="$ctrl.files" class="file-list-container"> <div class="file-confirm-container" ng-repeat="file in $ctrl.files"> <div class="file-list"> <span id="mgt-doc-upload-file{{$index}}" class="file-name">{{ file.name }}</span> <span class="file-size"> - {{ $ctrl.convertFileSizeUnitToMB(file.size) | number:2 }} {{ ::\'mortgageTracker.uploadModal.MB\' | translate }}</span> <button class="unstyled" ng-click="$ctrl.removeFile(file)"> <span aria-hidden="true" class="icon-x large remove-icon-container"></span> <span class="visually-hidden" aria-describedby="mgt-doc-upload-file{{$index}}"> {{ \'global.components.buttons.remove\' | translate}} </span> </button> </div> <div ng-if="file.duplicateDetected"> <tng-checkbox-input aria-describedby="mgt-doc-upload-file{{$index}}" input-id="mgtDocUpload_confirm_duplicate_upload_{{$index}}" label="{{ ::\'mortgageTracker.uploadModal.duplicateWarning\' | translate }}" required-validation-message="This is required" tng-model="file.duplicateAcknowledged"> </tng-checkbox-input> </div> </div> </div> </div> <div ng-if="$ctrl.confirmed && !$ctrl.loading"> <p class="medium-width-section confirm-text" ng-bind-html="::\'mortgageTracker.uploadModal.confirmation.description\' | translate"></p> <h3>{{ ::\'mortgageTracker.uploadModal.confirmation.docListHeader\' | translate }}</h3> <div class="uploaded-list-container narrow-width-section"> <div class="uploaded-list" ng-repeat="doc in $ctrl.uploadedDocs"> {{ ::doc.name }} </div> </div> <button class="btn btn--edit margin__t--rel2 btn--select" actionable-id="mgtDocUpload_uploadMore" ng-click="$ctrl.uploadMore()"> {{::\'mortgageTracker.uploadModal.confirmation.uploadMore\' | translate}} </button> </div> <footer ng-if="!$ctrl.loading"> <button ng-if="!$ctrl.confirmed" class="btn btn--edit" actionable-id="mgtDocUpload_close" ng-click="$ctrl.onClose()"> {{::\'global.components.buttons.close\' | translate}} </button> <button ng-if="!$ctrl.confirmed" class="btn btn--tangerine" actionable-id="mgtDocUpload_upload" ng-disabled="$ctrl.isUploadButtonDisabled" ng-click="$ctrl.uploadFiles()"> {{::\'global.components.buttons.upload\' | translate}} </button> <button ng-if="$ctrl.confirmed" class="btn btn--tangerine" actionable-id="mgtDocUpload_close" ng-click="$ctrl.onClose()"> {{::\'global.components.buttons.close\' | translate}} </button> </footer> </tng-modal-dialog> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(5409),s=(i=a)&&i.__esModule?i:{default:i};var r=angular.module("tangerine.mortgageTracker.UserDocumentList",[]).component("tngUserDocumentList",s.default);e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5410)),a=s(n(5411));function s(t){return t&&t.__esModule?t:{default:t}}n(5412),e.default={controller:a.default,template:i.default,bindings:{rows:"<"}},t.exports=e.default},function(t,e){t.exports='<div class="tng-user-document-list"> <p class="medium-width-section upload-info" ng-bind-html="::\'mortgageTracker.documents.title\' | translate"></p> <table class="table table--full top-margin-small"> <thead> <tr> <th>{{ :: \'mortgageTracker.documents.typeHeader\' | translate }}</th> <th>{{ :: \'mortgageTracker.documents.receivedDate\' | translate }}</th> </tr> </thead> <tbody ng-repeat="row in $ctrl.rows"> <tr> <td class="type"> {{row.name}} </td> <td class="date"> {{row.receivedDate | date: \'medium\'}} </td> </tr> </tbody> </table> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(0),s=(i=a)&&i.__esModule?i:{default:i};var r=function t(e){(0,s.default)(this,t),this.mortgageConstants=e};r.$inject=["mortgageConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=u(n(8)),a=u(n(68)),s=u(n(104)),r=u(n(15)),o=u(n(58)),c=u(n(0)),l=u(n(2));function u(t){return t&&t.__esModule?t:{default:t}}var d=function(){function t(e,n,i,a,s,r,o,l,u,d,h,f,p,g,m,_,v,S,T,y,E,A){(0,c.default)(this,t),this.$q=e,this.$log=n,this.$state=i,this.$translate=a,this.$filter=s,this.accountConstants=r,this.AnchorService=o,this.customerConstants=l,this.globalModalsService=u,this.JointEnrollmentConstants=d,this.JointEnrollmentService=h,this.mortgageConstants=f,this.mortgageTrackerApplicationModelFactory=p,this.mortgageTrackerUserConditionModelFactory=g,this.pendingApplicationsConstants=m,this.PendingApplicationsService=_,this.RequesterService=v,this.serviceConstants=S,this.stateConstants=T,this.CustomersService=y,this.SessionService=E,this.environmentService=A,this.jointContact=null,this.docsUploadedInSession=!1}return(0,l.default)(t,[{key:"getApplication",value:function(t){var e=this,n=this.serviceConstants.AVAILABLE_SERVICES.GET_MORTGAGE_TRACKER,i={urlVars:{dealId:t}};return this.RequesterService.request(n,i).then((function(t){return e.RequesterService.decodeServerData(t)})).then((function(t){if(t.responseStatus.statusCode!==e.serviceConstants.STATUS_CODES.SUCCESS)throw e.$log.error("Get Mortgage tracker response error:",t),t;return e.$log.debug("Mortgage tracker was retrieved successfully",t),t}))}},{key:"_getApplicationConditions",value:function(t){var e=this.mortgageConstants.MORTGAGE_TRACKER.BREADCRUMB_STATES.HIDE,n=this.mortgageConstants.MORTGAGE_TRACKER.BREADCRUMB_STATES.COMPLETE,i=[],a=!0,s=!1,c=void 0;try{for(var l,u=(0,o.default)((0,r.default)(t.breadcrumbStatus));!(a=(l=u.next()).done);a=!0){var d=l.value,h=t.breadcrumbStatus[d];h!==e&&i.push({name:this.$translate.instant("mortgageTracker.applicationConditions.segments."+d+".name"),tooltip:this.$translate.instant("mortgageTracker.applicationConditions.segments."+d+".tooltip",{mamQualifier:t.helocOnly?"":this.$translate.instant("mortgageTracker.applicationConditions.segments.conditionalApproval.mortgage")}),status:h===n,key:d})}}catch(t){s=!0,c=t}finally{try{!a&&u.return&&u.return()}finally{if(s)throw c}}return i.sort((function(t,e){return t.key<e.key?-1:t.key>e.key?1:0})),i}},{key:"loadApplication",value:function(t){var e=this;return this.$q.all([this.getApplication(t),this.PendingApplicationsService.getMortgages({resetCache:!0}),this.JointEnrollmentService.getPendingInvitations({resetCache:!0}),this.CustomersService.getCustomerInfo()]).then((function(n){var i=(0,s.default)(n,3),a=i[0],r=i[1],o=i[2],c=a.mortgageApplicationSummary,l=e.mortgageTrackerApplicationModelFactory({applicationStage:a.applicationStage,applicationStatus:a.applicationStatus,applicants:c.applicants,closingDate:c.closingDate,creditLimit:c.creditLimit,breadcrumbStatus:a.breadcrumbStatus,dealId:t,userDocumentList:e.getUserDocumentList(a.fulfillmentDocuments),financialConditionDate:c.financialConditionDate,financialConditionFlag:c.financialConditionFlag,helocInterestRate:c.helocInterestRate,interestRate:c.interestRate,mortgageAmount:c.mortgageAmount,mortgageConstants:e.mortgageConstants,mortgageSpecialist:e._getMortgageSpecialist(a.mortgageAssociate),numOfApplicants:c.numOfApplicants,paymentFrequency:e.accountConstants.FREQUENCIES.map((function(t){return{label:t.label,code:t.enrollmentCode}})).find((function(t){return t.code===c.paymentFrequency})),pendingApplicationsConstants:e.pendingApplicationsConstants,rateTypeIsFixed:1===parseInt(c.productType,10),submitDate:c.submitDate,termYear:c.mortgageTermYear,totalPaymentByFrequency:c.totalPaymentByFrequency,transactionType:c.transactionType,amortizationPeriod:c.amortizationPeriod}),u=e.JointEnrollmentConstants.INVITATION_STATES,d=e.JointEnrollmentConstants.VALID_INVITATION_STATES,h=[],f=null;o&&o.invitations&&(h=o.invitations.filter((function(e){return e.invitation_details.deal_id===t&&e.status===u.DECLINED})),f=o.invitations.find((function(e){return e.invitation_details.deal_id===t&&-1!==d.indexOf(e.status)})),l.hasJointDeclined=Boolean(c.applicants&&1===c.applicants.length&&h.length&&!f),l.hasJointDeclined&&h.length&&(h.sort((function(t,e){return new Date(e.create_date)-new Date(t.create_date)})),void 0!==h[0].to_name&&(l.jointDeclinedFirstName=h[0].to_name.split(" ")[0])));var p=r.service_requests.find((function(e){return e.dealId===t}));return l.available_action=p.available_action,e.PendingApplicationsService.setMortgageStatus(l),l.isReadyToFund?(l.paymentFrequency&&(l.paymentDetails={type:l.paymentFrequency.label,amount:l.totalPaymentByFrequency}),l.nextStepsButtons.push({header:"enrollmentConfirmation.nextSteps.buttons.mortgageTrackingReadyToFund1.header",action:"readyToFund.RF1"},{header:"enrollmentConfirmation.nextSteps.buttons.mortgageTrackingReadyToFund2.header",action:"readyToFund.RF2"})):l.paymentDetails=null,l.isPreApproved&&l.nextStepsButtons.push({header:"enrollmentConfirmation.nextSteps.buttons.mortgageTrackingPreApproved1.header",subHeader:"enrollmentConfirmation.nextSteps.buttons.mortgageTrackingPreApproved1.subHeader",action:"preApproved.PA1"},{header:"enrollmentConfirmation.nextSteps.buttons.mortgageTrackingPreApproved2.header",subHeader:"enrollmentConfirmation.nextSteps.buttons.mortgageTrackingPreApproved2.subHeader",action:null}),l.applicationConditions=e._getApplicationConditions(l),c.propertyAddress&&(l.propertyAddress=e.RequesterService.encodeClientData(c.propertyAddress),l.propertyAddress.unit&&!l.propertyAddress.suite&&(l.propertyAddress.suite=l.propertyAddress.unit)),l.termDisplay=e.termDisplay(l.rateTypeIsFixed,l.termYear),l.userConditionChecklist=e.getUserConditionChecklist(a.conditions,l.propertyAddress),l}))}},{key:"getUserDocumentList",value:function(t){var e=this,n=t.map((function(t){return{name:e.$translate.instant("mortgageTracker.documents.types."+t.documentType),receivedDate:t.receivedDate}}));return this.environmentService.get("mortgageTrackerUpgraded")&&(n=n.filter((function(t){return e.isValidRecordForReceiveTabs(t.receivedDate)}))),n}},{key:"isValidRecordForReceiveTabs",value:function(t){var e=this.environmentService.get("mortgageTrackerUpgradedEffectiveDate"),n=moment(this.$filter("date")(t,"yyyy-MM-dd")),i=moment(this.$filter("date")(e,"yyyy-MM-dd"));return n.isBefore(i)}},{key:"getUserConditionChecklist",value:function(t,e){var n=this,s=[].concat((0,a.default)(this.mortgageConstants.EXCLUDED_USER_CONDITIONS)),r=t.filter((function(t){return!(-1!==s.indexOf(t.status))})).map((function(t){return n.mortgageTrackerUserConditionModelFactory((0,i.default)(t,{propertyAddress:e}))})),o=this.mortgageConstants.USER_CONDITION_STATUS_ORDER;return r.sort((function(t,e){return o[t.status]-o[e.status]}))}},{key:"getApplicationDeclinedAccordionData",value:function(){return[{header:"mortgageTracker.applicationDeclined.accordion.steps.0.header",body:"mortgageTracker.applicationDeclined.accordion.steps.0.body"},{header:"mortgageTracker.applicationDeclined.accordion.steps.1.header",body:"mortgageTracker.applicationDeclined.accordion.steps.1.body"}]}},{key:"termDisplay",value:function(t,e){var n=1===e?"single":"plural",i=t?"termValueFixed":"termValueVariable";return this.$translate.instant("mortgage.review.calculatePayment."+i+"."+n,{years:e})}},{key:"_getMortgageSpecialist",value:function(t){return t?{firstName:t.firstName,lastName:t.lastName,emailAddress:t.email,ext:t.phoneExtension}:{}}},{key:"getHeaderDisplay",value:function(t){return t.hasJointDeclined?this.$translate.instant("mortgageTracker.hasJointDeclined.title"):t.isWaitingForJoint?this.$translate.instant("mortgageTracker.isWaitingForJoint.title"):t.isDeclined?this.$translate.instant("mortgageTracker.applicationDeclined.title"):t.isReadyToFund?this.$translate.instant("mortgageTracker.readyToFund.title"):t.isPreApproved?this.$translate.instant("mortgageTracker.preApproved.title"):t.isUnderReview?this.$translate.instant("mortgageTracker.underReview.title"):t.requiresContact?this.$translate.instant("mortgageTracker.requiresContact.title"):t.isConditionallyApproved?this.$translate.instant("mortgageTracker.approved.title"):""}},{key:"getDescriptionDisplay",value:function(t){return t.hasJointDeclined?this.$translate.instant("mortgageTracker.hasJointDeclined.description",{inviteesFirstName:t.jointDeclinedFirstName,accountType:t.helocOnly?this.$translate.instant("mortgageTracker.accountSummaryTile.titles.HELOC"):this.$translate.instant("mortgageTracker.accountSummaryTile.titles.MTG")}):t.isWaitingForJoint?this.$translate.instant("mortgageTracker.isWaitingForJoint.description"):t.isDeclined?this.$translate.instant("mortgageTracker.applicationDeclined.description"):t.isReadyToFund?this.$translate.instant("mortgageTracker.readyToFund.description"):t.isPreApproved?this.$translate.instant("mortgageTracker.preApproved.description"):t.isUnderReview?this.$translate.instant("mortgageTracker.underReview.description"+(t.isPreApproval?"PA":"")):t.requiresContact?this.$translate.instant("mortgageTracker.requiresContact.description",{phoneExtension:t.mortgageSpecialist.phoneExtension}):(t.isConditionallyApproved,"")}},{key:"financialPlanOnClick",value:function(){this.$state.go(this.stateConstants.FINANCIAL_PLAN)}},{key:"increaseDownPaymentOnClick",value:function(){this.$state.go(this.stateConstants.GOAL_MODAL)}},{key:"spendAndImproveCreditRatingOnClick",value:function(){this.$state.go(this.stateConstants.BUDGET_LTS_OVERVIEW)}},{key:"resendInvitation",value:function(t,e){var n=this;this.globalModalsService.showJointInviteManager({isApplication:!0,dealOrAccountId:t,hasJointDeclined:e.hasJointDeclined,onInviteSentSuccess:function(){e.isWaitingForJoint=!0,e.hasJointDeclined=!1},jointContactUpdated:function(t){n.jointContact=t}})}},{key:"docsUploadedInSession",get:function(){return this.SessionService.mgtTrackerDocUploaded},set:function(t){this.SessionService.mgtTrackerDocUploaded=t}}]),t}();d.$inject=["$q","$log","$state","$translate","$filter","accountConstants","AnchorService","customerConstants","GlobalModalsService","JointEnrollmentConstants","JointEnrollmentService","mortgageConstants","mortgageTrackerApplicationModelFactory","mortgageTrackerUserConditionModelFactory","pendingApplicationsConstants","PendingApplicationsService","RequesterService","serviceConstants","stateConstants","CustomersService","SessionService","EnvironmentService"],e.default=d,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MortgageTrackerApplicationModel=void 0;var i=r(n(8)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}e.default=c;var o=e.MortgageTrackerApplicationModel=function(){function t(e,n,s){(0,a.default)(this,t),this.mortgageConstants=e,this.pendingApplicationsConstants=n,this.amortizationPeriod=null,this.applicants=[],this.applicantionConditions=[],this.applicationStage=null,this.applicationStatus=null,this.breadcrumbStatus={},this.closingDate=null,this.creditLimit=null,this.dealId=null,this.hasJointDeclined=null,this.financialConditionDate=null,this.financialConditionFlag=null,this.helocInterestRate=null,this.interestRate=null,this.isWaitingForJoint=!1,this.mortgageAmount=null,this.mortgageConstants=null,this.mortgageSpecialist=null,this.nextStepsButtons=[],this.numOfApplicants=null,this.paymentDetails=null,this.paymentFrequency=null,this.propertyAddress=null,this.rateTypeIsFixed=null,this.submitDate=null,this.termDisplay=null,this.termYear=null,this.transactionType=null,this.totalPaymentByFrequency=null,this.webstatus=null,s&&(0,i.default)(this,s)}return(0,s.default)(t,[{key:"isReadyToFund",get:function(){return this.webstatus===this.pendingApplicationsConstants.MORTGAGE_WEB_STATUS.READY_TO_FUND}},{key:"isDeclined",get:function(){return this.webstatus===this.pendingApplicationsConstants.MORTGAGE_WEB_STATUS.DECISIONED}},{key:"showDeclinedAccordion",get:function(){return Boolean(this.isDeclined&&!this.isDAWTonlyTransactionType)}},{key:"isDAWTonlyTransactionType",get:function(){var t=this.mortgageConstants.TRANSACTION_TYPE;return!(-1!==[t.PRE_APPROVAL,t.PURCHASE,t.INCREASE,t.ETO,t.ADD_HELOC,t.HELOC_INCREASE].indexOf(this.transactionType))}},{key:"isSimpleTransactionType",get:function(){var t=this.mortgageConstants.TRANSACTION_TYPE;return-1!==[t.ASSUMPTION,t.ADD_COVENANT,t.RELEASE_COVENANT].indexOf(this.transactionType)}},{key:"isPreApproval",get:function(){return this.transactionType===this.mortgageConstants.TRANSACTION_TYPE.PRE_APPROVAL}},{key:"showConditionChecklist",get:function(){return Boolean((this.isConditionallyApproved||this.isReadyToFund)&&!this.isSimpleTransactionType)}},{key:"showNextSteps",get:function(){return Boolean((this.isReadyToFund||this.isPreApproved)&&!this.isSimpleTransactionType)}},{key:"showMortgageSpecialistSection",get:function(){return!(!this.requiresContact||!this.mortgageSpecialist)||!(this.isWaitingForJoint||this.hasJointDeclined||this.requiresContact||this.isPreApproval||this.isReadyToFund)}},{key:"isConditionallyApproved",get:function(){var t=this.pendingApplicationsConstants.MORTGAGE_WEB_STATUS;return-1!==[t.APPROVED,t.NONFUND_APPROVED].indexOf(this.webstatus)}},{key:"isUnderReview",get:function(){return this.webstatus===this.pendingApplicationsConstants.MORTGAGE_WEB_STATUS.UNDER_REVIEW}},{key:"requiresContact",get:function(){return this.webstatus===this.pendingApplicationsConstants.MORTGAGE_WEB_STATUS.MISSING_INFO}},{key:"isPreApproved",get:function(){return this.webstatus===this.pendingApplicationsConstants.MORTGAGE_WEB_STATUS.PA_APPROVED}},{key:"helocOnly",get:function(){return!(this.mortgageAmount&&this.interestRate)&&this.creditLimit}},{key:"infoTileDisclaimer",get:function(){return this.isConditionallyApproved||this.isPreApproved?null:this.helocOnly?"mortgage.confirmation.heloc.disclosure":"mortgage.confirmation.disclosure"}}]),t}();function c(t,e){return function(n){return new o(t,e,n)}}c.$inject=["mortgageConstants","pendingApplicationsConstants"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MortgageTrackerUserConditionModel=void 0;var i=o(n(8)),a=o(n(0)),s=o(n(2));e.default=l;var r=o(n(268));function o(t){return t&&t.__esModule?t:{default:t}}var c=e.MortgageTrackerUserConditionModel=function(){function t(e,n,s,r,o){(0,a.default)(this,t),this.$translate=e,this.mortgageConstants=n,this.buildConstants=s,this.EnvironmentService=r,this.STATUS=this.mortgageConstants.USER_CONDITION.STATUS,this.id=null,this.name=null,this.webtitle=null,this.status=null,this.type=null,this.sequence=null,this.documentType=null,this.description=null,this.propertyAddress=null,this.clientFriendlyDescriptions=null,this.uploadHistory=null,o&&(0,i.default)(this,o),this.uploadHistory||(this.uploadHistory=[]),this.mortgageTrackerUpgraded=this.EnvironmentService.get("mortgageTrackerUpgraded"),this._setupClientFriendlyDescriptions(),this._massageLegalDescription(),this._massageStatus()}return(0,s.default)(t,[{key:"_massageStatus",value:function(){this.mortgageTrackerUpgraded&&this.status===this.STATUS.UNSTS&&this.uploadHistory&&this.uploadHistory.length&&(this.status=this.STATUS.UNSTS_DOCS_UPLOADED)}},{key:"_massageLegalDescription",value:function(){if(this.description){this.description=this.description.replace(/(_){2,}(\s)*((_){2,})*/g," ____ ")}}},{key:"_setupClientFriendlyDescriptions",value:function(){this.clientFriendlyDescriptions=[];var t=0,e=void 0,n=void 0,i={address:r.default.getHTMLAddress(this.propertyAddress,!0)};do{t+=1,(n="mortgageTracker.uploadModal.clientFriendlyDescriptions."+this.type+"."+this.sequence+"."+t)!==(e=this.$translate.instant(n,i))&&this.clientFriendlyDescriptions.push(e)}while(n!==e)}},{key:"docUploadEnabled",value:function(){return this.status!==this.STATUS.STSFD}},{key:"showStatusTooltip",get:function(){return-1!==[this.STATUS.UNSTS,this.STATUS.UNSTS_DOCS_UPLOADED,this.STATUS.REQAD].indexOf(this.status)}},{key:"statusTooltipKey",get:function(){return"mortgageTracker.conditions.tooltips"+(this.mortgageTrackerUpgraded?"UPGRADED":"")+"."+this.status}},{key:"statusKey",get:function(){return"mortgageTracker.conditions.status"+(this.mortgageTrackerUpgraded?"UPGRADED":"")+"."+this.status}}]),t}();function l(t,e,n,i){return function(a){return new c(t,e,n,i,a)}}l.$inject=["$translate","mortgageConstants","buildConstants","EnvironmentService"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5417)),a=s(n(5418));function s(t){return t&&t.__esModule?t:{default:t}}n(5419);var r={template:i.default,controller:a.default,bindings:{}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-personal-insights-toggle"> <span class="perso-toggle"> <table class="c-personal-insights-toggle table table--full"> <tbody> <tr> <td class="enh-insight-td"> <div class="perso-toggle-enhanced-insight"> <a actionable-id="perso-toggle-enhanced-insights" href="" id="navigation-nav-item_link1" name="navigation-nav-item_link11" ng-class="$ctrl.PersonalInsightsService.isEnhancedInsights ? \'is-active\' : \'is-not-active\'" ng-click="$ctrl.showEnhancedInsights()"> Enhanced Insights </a> </div> </td> <td class="insight-td"> <div class="perso-toggle-insight"> <a actionable-id="perso-toggle-insights" href="" name="navigation-nav-item_link22" ng-class="$ctrl.PersonalInsightsService.isEnhancedInsights ? \'is-not-active\' : \'is-active\'" ng-click="$ctrl.showInsights()"> Insights </a> </div> </td> </tr> </tbody> </table> </span> <div ng-if="$ctrl.PersonalInsightsService.isServiceError"> <span class="c-personal-insights widget-warning">{{ ::\'insights.serviceErrorShort\' | translate }}</span> </div> <div ng-if="$ctrl.PersonalInsightsService.isEnhancedInsights" class="enh-insights-accordeon"> <table class="c-personal-insights-toggle table table--full"> <tbody> <tr ng-if="$ctrl.noInsightOrError"> <td class="enh-insight-td-error-no-insight"> <div actionable-id="no_insight_error"> <span class="c-personal-insights__no-insight"> Check back for fresh insights soon. </span> </div> </td> </tr> <tr ng-if="!$ctrl.noInsightOrError"> <td class="enh-insight-td-title"> <div actionable-id="enh_accordeon_title" ng-click="$ctrl.toggleCarouselOpen()"> <span class="c-personal-insights__hint c-personal-insights__hint__text"> {{ \'insights.title\' | translate }} </span> <span ng-if="$ctrl.enhancedInsightsCount" class="insights-count">{{$ctrl.enhancedInsightsCount}}</span> </div> </td> <td class="enh-insight-td-arrow"> <div ng-if="$ctrl.enhancedInsightsCount"> <button class="arrow-toggle" ng-click="$ctrl.toggleCarouselOpen();" actionable-id="enh_accordeon_arrow"> <span ng-class="$ctrl.PersonalInsightsService.insightsPanelOpen ? \'icon-uparrow\' : \'icon-downarrow\'"></span> </button> </div> </td> </tr> </tbody> </table> </div> <section ng-if="$ctrl.PersonalInsightsService.insightsPanelOpen && $ctrl.PersonalInsightsService.isEnhancedInsights"> <tng-personal-insights-widget insights="$ctrl.insights" is-carousel="true" on-teaser-swipe="$ctrl.onTeaserSwipe()" on-teaser-dismiss="$ctrl.onTeaserDismiss()" on-insights-fetch="$ctrl.onInsightsFetch()"> </tng-personal-insights-widget> </section> <section ng-if="($ctrl.PersonalInsightsService.insightsPanelOpen || $ctrl.noInsightOrError) &&\n                   $ctrl.PersonalInsightsService.isEnhancedInsights && !$ctrl.PersonalInsightsService.isLoading"> <tng-carousel-progress-bar pagination-info="$ctrl.paginationInfo" active-page="$ctrl.pagination"> </tng-carousel-progress-bar> </section> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(68)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i,s){(0,a.default)(this,t),this.$log=e,this.$scope=n,this.PersonalInsightsService=i,this.PersonalInsightsConstants=s,this.PersonalInsightsService.isServiceError=!1,this.noInsightOrError=!1,this.enhancedInsightsCount=0,this.paginationInfo=[],this.pagination=0}return(0,s.default)(t,[{key:"$onInit",value:function(){this.noInsightOrError=!1,this.PersonalInsightsService.isServiceError=!1,this.PersonalInsightsService.isEnhancedInsights&&this.showEnhancedInsights()}},{key:"onTeaserSwipe",value:function(){this.pagination=this.PersonalInsightsService.pagination,this.$scope.$apply()}},{key:"onTeaserDismiss",value:function(){this.enhancedInsightsCount>0&&(this.enhancedInsightsCount=this.enhancedInsightsCount-1,this.paginationInfo.pop()),0===this.paginationInfo.length&&(this.noInsightOrError=!0,this.PersonalInsightsService.insightsPanelOpen=!1,this.$scope.$apply())}},{key:"onInsightsFetch",value:function(){var t;this.noInsightOrError=!1,this.PersonalInsightsService.isServiceError=!1,this.paginationInfo.length=0,(t=this.paginationInfo).push.apply(t,(0,i.default)(this.PersonalInsightsService.insights)),this.pagination=0,this.enhancedInsightsCount=this.paginationInfo.length,0===this.enhancedInsightsCount&&(this.noInsightOrError=!0,this.PersonalInsightsService.insightsPanelOpen=!1,this.PersonalInsightsService.isLoading=!1)}},{key:"showEnhancedInsights",value:function(){this.PersonalInsightsService.isEnhancedInsights||(this.PersonalInsightsService.isServiceError=!1,this.isCarousel=!0,this.PersonalInsightsService.isLoading=!0,this.PersonalInsightsService.storySource=this.PersonalInsightsConstants.WIDGET_STORY_SOURCE.CAROUSEL,this.PersonalInsightsService.isEnhancedInsights=!0,this.PersonalInsightsService.insightsPanelOpen=!0,this.enhancedInsightsCount>0&&(this.noInsightOrError=!1))}},{key:"showInsights",value:function(){this.PersonalInsightsService.isEnhancedInsights=!1,this.PersonalInsightsService.isServiceError=!1}},{key:"toggleCarouselOpen",value:function(){this.PersonalInsightsService.insightsPanelOpen?this.PersonalInsightsService.sendPersonalInsightsAnalytics(this.PersonalInsightsConstants.PERSONAL_INSIGHTS_ANALYTICS.CAROUSEL_COLLAPSE):(this.PersonalInsightsService.sendPersonalInsightsAnalytics(this.PersonalInsightsConstants.PERSONAL_INSIGHTS_ANALYTICS.CAROUSEL_OPEN),this.PersonalInsightsService.enhancedInsightsCount=null),this.PersonalInsightsService.insightsPanelOpen=!this.PersonalInsightsService.insightsPanelOpen}}]),t}();o.$inject=["$log","$scope","PersonalInsightsService","PersonalInsightsConstants"],e.default=o,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5421)),a=s(n(2349));function s(t){return t&&t.__esModule?t:{default:t}}n(5422);var r={template:i.default,controller:a.default,bindings:{insights:"<",storyParams:"<",isCarousel:"<",onTeaserSwipe:"&",onTeaserDismiss:"&",onInsightsFetch:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-personal-insights-carousel"> <section> <div ng-if="$ctrl.PersonalInsightsService.isLoading"> <div class="loading"> <tng-loading-in-progress></tng-loading-in-progress> </div> </div> <div id="persoSectionCarousel"> <div id="perso-widget-container" class="personal-insights-section-carousel"></div> </div> </section> <meta charset="UTF-8"> <meta name="viewport" content="height=device-height,width=device-width,initial-scale=1,maximum-scale=1"> <script src="assets/js/personetics-product/js/personetics-vendors.min.js"><\/script> <script src="assets/js/personetics-product/js/personetics-api.min.js"><\/script> <script src="assets/js/personetics-product/js/personetics-widget.min.js"><\/script> <link rel="stylesheet" type="text/css" href="assets/js/personetics-product/css/personetics.min.css"> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5424)),a=s(n(2349));function s(t){return t&&t.__esModule?t:{default:t}}n(5425);var r={template:i.default,controller:a.default,bindings:{storyParams:"<",allStories:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-enh-widget-story"> <div ng-if="$ctrl.PersonalInsightsService.isLoading"> <div class="loading"> <tng-loading-in-progress></tng-loading-in-progress> </div> </div> <section id="persoSectionStory"> <div id="perso-widget-container"></div> </section> <meta charset="UTF-8"> <meta name="viewport" content="height=device-height,width=device-width,initial-scale=1,maximum-scale=1"> <script src="assets/js/personetics-product/js/personetics-vendors.min.js"><\/script> <script src="assets/js/personetics-product/js/personetics-api.min.js"><\/script> <script src="assets/js/personetics-product/js/personetics-widget.min.js"><\/script> <link rel="stylesheet" type="text/css" href="assets/js/personetics-product/css/personetics.min.css"> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5427)),a=s(n(5428));function s(t){return t&&t.__esModule?t:{default:t}}n(5429);var r={controller:a.default,template:i.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports=' <section class="c-personal-insight-story"> <tng-modal-dialog class="c-insight-story" hide-close="false" show-header="false" disable-curtain="false" on-close="$ctrl.onBack()"> <div ng-if="$ctrl.isServiceError"> <span class="c-insight-story story-warning panel">{{ ::\'insights.serviceErrorShort\' | translate }}</span> </div> <div ng-if="!$ctrl.isServiceError"> <tng-enh-widget-story story-params="$ctrl.storyParams"> </tng-enh-widget-story> </div> </tng-modal-dialog> </section> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.$window=n,this.EnvironmentService=a,this.PersonalInsightsService=s,this.PersonalInsightsConstants=r,this.GlobalModalsService=o,this.storyParams=this.$window.storyParams,this.PERSONAL_INSIGHTS_NAV=this.PersonalInsightsConstants.PERSONAL_INSIGHTS_NAV,this.isServiceError=!1}return(0,a.default)(t,[{key:"$onInit",value:function(){this.storyParams&&(this.isServiceError=!1,"200"===this.storyParams.status&&"ok"===this.storyParams.statusMessage?(this.PersonalInsightsService.storySource===this.PersonalInsightsConstants.WIDGET_STORY_SOURCE.CAROUSEL&&(this.PersonalInsightsService.lastViewedInsightId=this.storyParams.insightId),this.PersonalInsightsService.storyShown=!0):this.isServiceError=!0,this.PersonalInsightsService.storyShown=!0)}},{key:"onBack",value:function(){this.$window.storyParams=null,this.PersonalInsightsService.isStory=!1,this._navigateBack()}},{key:"_navigateBack",value:function(){this.PersonalInsightsService.storySource===this.PersonalInsightsConstants.WIDGET_STORY_SOURCE.MBOX?(this.PersonalInsightsService.setMBox(),this.EnvironmentService.isNative()?(window.location.href=this.PERSONAL_INSIGHTS_NAV.MBOX_NAV,this.PersonalInsightsService.isStory=!1):window.open(this.PERSONAL_INSIGHTS_NAV.MBOX_NAV,"_self")):this.PersonalInsightsService.storySource===this.PersonalInsightsConstants.WIDGET_STORY_SOURCE.CAROUSEL&&(this.PersonalInsightsService.setCarousel(),this.EnvironmentService.isNative()?window.location.href=this.PERSONAL_INSIGHTS_NAV.CAROUSEL_NAV:window.open(this.PERSONAL_INSIGHTS_NAV.CAROUSEL_NAV,"_self"))}}]),t}();r.$inject=["$log","$window","EnvironmentService","PersonalInsightsService","PersonalInsightsConstants","GlobalModalsService"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5431)),a=s(n(5432));function s(t){return t&&t.__esModule?t:{default:t}}n(5433);var r={controller:a.default,template:i.default,bindings:{onClose:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<section class="c-insight-mbox"> <div class="loading" ng-if="$ctrl.loading"> <tng-loading-in-progress></tng-loading-in-progress> </div> <div ng-if="$ctrl.allStories && !$ctrl.isServiceError"> <tng-enh-widget-story all-stories="$ctrl.allStories"> </tng-enh-widget-story> </div> <div ng-if="$ctrl.isServiceError"> <span class="c-insight-mbox mbox-warning panel">{{ ::\'insights.serviceErrorShort\' | translate }}</span> </div> <div ng-if="$ctrl.emptyInbox"> <span class="c-insight-mbox mbox-warning panel">{{ ::\'insights.noInsights\' | translate }}</span> </div> </section> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o){(0,i.default)(this,t),this.$log=e,this.$window=n,this.$timeout=a,this.EnvironmentService=s,this.PersonalInsightsService=r,this.PersonalInsightsConstants=o,this.PERSONAL_INSIGHTS_NAV=this.PersonalInsightsConstants.PERSONAL_INSIGHTS_NAV,this.isServiceError=!1}return(0,a.default)(t,[{key:"$onInit",value:function(){var t=this;this.PersonalInsightsService.setMBox(),this.loading=!0,this.PersonalInsightsService.getInboxInsights().then((function(e){t.loading=!1,"200"===e.status&&"ok"===e.statusMessage?(t.allStories=e&&e.insights?e.insights:[],t.isServiceError=!1):(t.$log.error("service error"),t.isServiceError=!0,t.allStories=[]),0===t.allStories.length&&(t.emptyInbox=!0)})).catch((function(e){t.$log.error(e),t.loading=!1,t.isServiceError=!0,t.allStories=[]})),this.PersonalInsightsService.storySource=this.PersonalInsightsConstants.WIDGET_STORY_SOURCE.MBOX}},{key:"onStoryClick",value:function(){}},{key:"onBack",value:function(){this.EnvironmentService.isNative()?window.location.href=this.PERSONAL_INSIGHTS_NAV.CAROUSEL_NAV:window.open(this.PERSONAL_INSIGHTS_NAV.CAROUSEL_NAV,"_self")}}]),t}();r.$inject=["$log","$window","$timeout","EnvironmentService","PersonalInsightsService","PersonalInsightsConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5435)),a=s(n(5436));function s(t){return t&&t.__esModule?t:{default:t}}n(5437);var r={controller:a.default,template:i.default,bindings:{paginationInfo:"<",activePage:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-personal-insights-carousel"> <section> <table class="c-carousel-progress-bar table table--full"> <tbody> <tr> <td class="c-carousel-progress-bar view-all-td"> <div ng-if="!$ctrl.isLoading" class="view-all-container"> <a actionable-id="personal-view-all" ng-click="$ctrl.showInboxPage()" class="c-carousel-progress-bar personal-view-all"> View all </a> </div> </td> <td> <div class="c-carousel-progress-bar pagination-td"> <span ng-repeat="el in $ctrl.paginationInfo track by $index"> <span ng-class="$ctrl.activePage === $index ? \'dot-selected\' : \'dot-unselected\'"></span> </span> </div> </td> <td class="c-carousel-progress-bar view-all-td"></td> </tr> </tbody> </table> </section> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r){(0,i.default)(this,t),this.$log=e,this.$state=n,this.stateConstants=a,this.PersonalInsightsService=s,this.PersonalInsightsConstants=r}return(0,a.default)(t,[{key:"$onInit",value:function(){}},{key:"showInboxPage",value:function(){this.PersonalInsightsService.isStory=!1,this.PersonalInsightsService.isMBox=!0,this.PersonalInsightsService.sendPersonalInsightsAnalytics(this.PersonalInsightsConstants.PERSONAL_INSIGHTS_ANALYTICS.VIEW_ALL),this.$state.go(this.stateConstants.PERSONAL_INSIGHTS_MBOX)}}]),t}();r.$inject=["$log","$state","stateConstants","PersonalInsightsService","PersonalInsightsConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d,h,f){(0,i.default)(this,t),this.$q=e,this.$log=n,this.$rootScope=s,this.RequesterService=r,this.$timeout=a,this.serviceConstants=o,this.EnvironmentService=c,this.buildConstants=l,this.PersonalInsightsConstants=u,this.AnalyticsService=d,this.CAPABILITIES=this.PersonalInsightsConstants.CAPABILITIES,this.ANALYTICS_AVAILABLE_EVENTS=this.AnalyticsService.availableEvents,this.EventBusService=h,this.appStateConstants=f,this.personalInsightsConfig=c.get("personalInsights"),this.channel=this.personalInsightsConfig?this.personalInsightsConfig.channel:this.PersonalInsightsConstants.SERVER_TYPE.TANGERINE_LIVE,this._init(),this.paginationInfo=[]}return(0,a.default)(t,[{key:"_init",value:function(){var t=this;this._reset(),this.EventBusService.subscribe(this.$rootScope,this.appStateConstants.APPLICATION_LOGOUT,(function(){t._reset()}))}},{key:"_reset",value:function(){this.persoCapabilities=null,this.paginationInfo=[],this.isEnhancedInsights=!1,this.insightsPanelOpen=!0,this.storyShown=null,this.storySource=null,this.isMBox=null,this.isStory=null,this.isCarousel=null,this.isServiceError=!1}},{key:"setEnhancedInsightsDefault",value:function(){this.isEnhancedInsights=!0}},{key:"isPersonalInsightsEnabled",value:function(){return this.EnvironmentService.isPhone()}},{key:"getCustomerInsightsWithRetries",value:function(){var t=this;return this.$log.info("getCustomerInsightsWithRetries"),this.getCustomerInsights().then((function(e){if(e&&e.customer_insights&&e.customer_insights.insights)return e;if(t._isNotReadyStatus(e)){var n=e.readiness_check_retry_delay||t.PersonalInsightsConstants.DEFAULT_RETRY_DELAY_MSEC;return t._retry(2,n)}throw"Personal Insights response error"}))}},{key:"_retry",value:function(t,e){var n=this;return this.$timeout((function(){return n.$log.info("getCustomerInsights _retry"),n.getCustomerInsights().then((function(e){if(e&&e.customer_insights&&e.customer_insights.insights)return e;if(n._isNotReadyStatus(e)){var i=e.retries_readiness_check||n.PersonalInsightsConstants.DEFAULT_MAX_RETRIES,a=e.readiness_check_retry_delay||n.PersonalInsightsConstants.DEFAULT_RETRY_DELAY_MSEC;if(t<i)return t++,n._retry(t,a);throw"Personal insights GET exceeded the number of "+i+" retries"}throw"Personal Insights response error during number "+t+" retry."}))}),e)}},{key:"_isNotReadyStatus",value:function(t){return t&&t.response_status&&t.response_status.status_code&&t.response_status.status_code===this.PersonalInsightsConstants.NOT_READY}},{key:"getCustomerInsights",value:function(){this.$log.info("getCustomerInsights");var t={urlVars:{channel:this.channel}};return this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.GET_PERSONAL_INSIGHTS,t,{resetCache:!0})}},{key:"getStoryDetails",value:function(t){return this.setStory(),this.postGeneralEventPassThru(t)}},{key:"setCarousel",value:function(){this.isMBox=!1,this.isStory=!1,this.isCarousel=!0}},{key:"setStory",value:function(){this.isMBox=!1,this.isStory=!0,this.isCarousel=!1}},{key:"setMBox",value:function(){this.isMBox=!0,this.isStory=!1,this.isCarousel=!1}},{key:"getInboxInsights",value:function(){this.isMBox=!0,this.isStory=!1;return this.postGeneralEventPassThru({type:"getInboxInsights",protocolVersion:"2.6",ctxId:"inboxDefault",lang:"en"})}},{key:"sendRequestToPserverViaBackendService",value:function(t,e,n){return this.postGeneralEventPassThru(t,e)}},{key:"updateInsightRating",value:function(t,e){return this.$q.resolve({id:"b93ae5b8-4f98-40da-931a-c2d88b86c044",status:"200",statusMessage:"ok",ok:!0,protocolVersion:"2.6"})}},{key:"updateInsightFeedback",value:function(t,e){return this.$q.resolve({id:"b93ae5b8-4f98-40da-931a-c2d88b86c044",status:"200",statusMessage:"ok",ok:!0,protocolVersion:"2.6"})}},{key:"getInsightRating",value:function(t,e){return this.$q.resolve({id:"0eef7184-8ec8-4a48-abea-b1b6f40b4828",rating:4,status:"200",statusMessage:"ok",ok:!0,protocolVersion:"2.6"})}},{key:"postGeneralEventPassThru",value:function(t,e,n){var i=this,a={urlVars:{channel:this.channel},data:{}};return a.data=t.requestData?t.requestData:t,this.$log.debug("postRequestToPserverViaBackendService post data for reqId: "+n,t),this.RequesterService.request(this.serviceConstants.AVAILABLE_SERVICES.POST_PERSONAL_INSIGHT_EVENTS,a).then((function(t){return i.$log.debug("postRequestToPserverViaBackendService response for reqId: "+n,t),t}))}},{key:"sendPersonalInsightsAnalytics",value:function(t){this.AnalyticsService.sendAction(this.AnalyticsService.availableEvents.CUSTOM_EVENT,t,{label:"",category:"Enhanced Insights",value:""})}}]),t}();r.$inject=["$q","$log","$timeout","$rootScope","RequesterService","serviceConstants","EnvironmentService","buildConstants","PersonalInsightsConstants","AnalyticsService","EventBusService","appStateConstants"],e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={WIDGET_TYPE:{TEASER_WIDGET_CAROUSEL:"teaser-widget-carousel",TEASER_WIDGET:"teaser-widget"},PERSONAL_INSIGHTS_NAV:{MBOX_NAV:"#/personal-insights-mbox",CAROUSEL_NAV:"#/accounts"},WIDGET_STORY_SOURCE:{CAROUSEL:"CAROUSEL",MBOX:"MBOX"},CAPABILITIES:{INSIGHTS_CREATE:"INSIGHTS_CREATE",INSIGHTS_RETRIEVE:"INSIGHTS_RETRIEVE",INSIGHTS_DEFAULT_VIEW_PERSONETICS:"INSIGHTS_DEFAULT_VIEW"},DEFAULT_MAX_RETRIES:7,DEFAULT_RETRY_DELAY_MSEC:500,NOT_READY:"NOT_READY",PERSONAL_INSIGHTS_ANALYTICS:{VIEW_ALL:"View All",CAROUSEL_COLLAPSE:"Carousel Collapse",CAROUSEL_OPEN:"Carousel Open"},SERVER_TYPE:{TANGERINE_LIVE:"TANGERINE_LIVE",TANGERINE_QA:"TANGERINE_QA"}},t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5441)),a=s(n(5442));function s(t){return t&&t.__esModule?t:{default:t}}n(5443);var r={template:i.default,controller:a.default,bindings:{onClose:"&",modalType:"<",predefinedAccount:"<",pendingTransaction:"<",registerFlow:"&?",isOnBoarding:"<?",parentFlowPreviousStepNumber:"<?",parentFlowTotalSteps:"<?"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<tng-modal-dialog inline-mode="!!$ctrl.isOnBoarding" on-close="$ctrl.onModalClose(result)" class="c-move-money" scrolltopon="true" hide-close="$ctrl.flowService.inLoadingMode" flow-service="$ctrl.flowService"> <header> <span ng-show="$ctrl.flowService.showMainUI">{{ $ctrl.modalTitle | translate }}</span> </header> <div id="printMe" ng-if="$ctrl.flowService.showMainUI"> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.FROM"> <tng-account-select sub-title-key="moveMoney.topCopy.chooseFrom" accounts="$ctrl.FROM_ACCOUNTS" selected-accounts="$ctrl.flowService.transaction.fromAccount" on-select="$ctrl.onFromSelect(account)" is-disabled="$ctrl.isAccountFromSelectTileDisabled(index, tile)" is-not-visible="$ctrl.isAccountFromSelectTileNotVisible(index, tile)" hide-footer-copy="true" on-away="$ctrl.onAwayNavigation()"></tng-account-select> <div ng-if="$ctrl.FROM_WITHDRAWAL_ACCOUNTS.length && !$ctrl.isOnBoarding" class="c-move-money__from-withdrawal-accounts"> <tng-account-select sub-title-key="moveMoney.topCopy.chooseWithdrawalFrom" accounts="$ctrl.FROM_WITHDRAWAL_ACCOUNTS" selected-accounts="$ctrl.flowService.transaction.fromAccount" on-select="$ctrl.onFromSelect(account)" hide-footer-copy="$ctrl.isOnBoarding" is-disabled="$ctrl.isAccountFromSelectTileDisabled(index, tile)" on-away="$ctrl.onAwayNavigation()"></tng-account-select> </div> <div ng-if="$ctrl.isOnBoarding" class="c-move-money__from-withdrawal-accounts"> <div class="c-move-money__from-skip-funding-message-container"> <div class="c-move-money__from-skip-funding-message"> {{::\'moveMoney.ob2FundingSkip\' | translate}} <tng-help-bubble> {{ ::\'moveMoney.ob2FundingSkipToolTip\' | translate }} </tng-help-bubble> </div> </div> <tng-tile-list class="c-account-select__tile-list c-move-money__skip-account-tile" numbered="false" all-actionable="true" tile-data="$ctrl.ob2SkipButton" on-tile-click="$ctrl.ob2SkipFunding()" tile-type="$ctrl.tileListConstants.TILE_TYPE.text"> </tng-tile-list> </div> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.TO"> <tng-tile-list class="c-move-money__single-tile margin__b--fix2" tile-data="$ctrl.getSelectedFromAccountTileData()" all-disabled="true" tile-type="$ctrl.TILE_TYPE.account"> </tng-tile-list> <tng-account-select sub-title-key="moveMoney.topCopy.chooseTo" accounts="$ctrl.TO_ACCOUNTS" selected-accounts="$ctrl.flowService.transaction.toAccount" on-select="$ctrl.onToSelect(account)" is-disabled="$ctrl.isAccountToSelectTileDisabled(index, tile)" on-away="$ctrl.onAwayNavigation()"> </tng-account-select> </div> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.WHEN"> <when-state modal-type="$ctrl.flowService.modalType" from-account="$ctrl.flowService.transaction.fromAccount[0]" to-account="$ctrl.flowService.transaction.toAccount[0]" cc-account-summary="$ctrl.flowService.ACCOUNT_DETAILS" on-now-select="$ctrl.flowService.onWhenSelect($ctrl.flowService.TIME_STATES.WHEN.NOW)" on-later-select="$ctrl.flowService.onWhenSelect($ctrl.flowService.TIME_STATES.WHEN.LATER)" on-recurring-select="$ctrl.flowService.onWhenSelect($ctrl.flowService.TIME_STATES.WHEN.ONGOING)"> </when-state> </div> <tng-move-money-mf-ongoing-withdrawal-state ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.REGISTERED_MF_ONGOING_WITHDRAWAL"></tng-move-money-mf-ongoing-withdrawal-state> <tng-move-money-date-state ng-if="$ctrl.flowService.currentState === $ctrl.flowService.STATES.DATE"></tng-move-money-date-state> <div ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.AMOUNT"> <form ng-submit="$ctrl.amountInputFormSubmit()"> <div class="c-move-money__error" ng-if="!$ctrl.flowService.validationError && ($ctrl.flowService.submitErrors || $ctrl.sellingAllFunds() || $ctrl.sellingNinetyPercentFunds())"> <tng-error-message ng-if="$ctrl.flowService.submitErrors"> <span ng-bind-html="$ctrl.flowService.submitErrors | translate"></span> </tng-error-message> <tng-warning-message ng-if="$ctrl.sellingAllFunds()"> {{ ::\'moveMoney.amountState.warning.investmentsSellAll\' | translate }} </tng-warning-message> <tng-warning-message ng-if="$ctrl.sellingNinetyPercentFunds()"> {{ ::\'moveMoney.amountState.warning.investmentsSell90percent\' | translate }} </tng-warning-message> </div> <div ng-if="!$ctrl.flowService.isCCOngoingMonthly"> <div ng-if="$ctrl.shouldShowTaxChanges()" class="margin__b--fix2" ng-class="{\'margin__t--fix2\': $ctrl.sellingAllFunds()}"> <button type="button" actionable-id="moveMoneyModal_savingWithdrawalBeforeTax" class="c-move-money__button-small btn--view" ng-class="{\'is-active\': !$ctrl.flowService.withdrawalHelper.isAmountNetType()}" ng-click="$ctrl.flowService.withdrawalHelper.setAmountType($ctrl.RSP_AMOUNT_TYPES.GROSS)"> {{ ::\'moveMoney.amountState.beforeTax\' | translate }} </button> <button type="button" actionable-id="moveMoneyModal_savingWithdrawalAfterTax" class="c-move-money__button-small btn--view" ng-class="{\'is-active\': $ctrl.flowService.withdrawalHelper.isAmountNetType()}" ng-click="$ctrl.flowService.withdrawalHelper.setAmountType($ctrl.RSP_AMOUNT_TYPES.NET)" ng-disabled="$ctrl.flowService.isAfterTaxDisabled()"> {{ ::\'moveMoney.amountState.afterTax\' | translate }} </button> </div> <tng-error-message ng-show="$ctrl.showOverdraftError"> <p>{{::\'moveMoney.paymentOptions.insufficientBalance\' | translate }}</p> </tng-error-message> <tng-amount-input locale="$ctrl.locale" reset-on="$ctrl.flowService.transaction" on-amount-change="$ctrl.onAmountInputChange(amount, currency)" input-type="$ctrl.flowService.amountInputType" set-value="$ctrl.flowService.transaction.amount" selected-currency="$ctrl.flowService.transaction.currency" base-currency="$ctrl.flowService.transaction.fromAccount[0].currency_type" on-focus="$ctrl.amountInputHasFocus()" on-blur="$ctrl.validateAmount(amount)" focus="$ctrl.flowService.isAmountFocus" ng-model="$ctrl.flowService.transaction.amount"> </tng-amount-input> <div ng-show="$ctrl.flowService.showAmountGreaterThanAvail" class="field__error"> {{ ::$ctrl.flowService.availableBalanceWithHold }} <tng-help-bubble> {{\'moveMoney.amountState.moreThanAvailableToolTip\'| translate}} <a class="c-move-money__tooltip-link" ng-click="$ctrl.goToHoldsPage()"> {{::\'moveMoney.amountState.learnMore\'| translate}}</a> </tng-help-bubble> </div> <div ng-show="$ctrl.flowService.showAvailBalanceError" class="field__error"> <p>{{::\'moveMoney.amountState.moreThanAvailable\' | translate }}</p> </div> <div ng-show="$ctrl.isDirty" class="field__error" translate-cloak> {{ ::\'moveMoney.warning.missing\' | translate }} </div> <div ng-show="$ctrl.showMinimum && !$ctrl.flowService.isValidAmount($ctrl.flowService.transaction.amount)" class="field__error" ng-bind="$ctrl.flowService.minimumAmountMessage()" translate-cloak> </div> <div ng-if="$ctrl.flowService.validationError && $ctrl.flowService.submitErrors"> <div ng-show="$ctrl.flowService.submitErrors" class="field__error"> <span ng-bind-html="$ctrl.flowService.submitErrors | translate:{ cardName: $ctrl._getCCAccountName() } "></span> </div> </div> <div ng-if="$ctrl.shouldShowTaxChanges()" class="c-move-money__gross-net-amount"> {{ $ctrl.flowService.transaction.withdrawal.secondAmount | currency }} {{ ($ctrl.flowService.withdrawalHelper.isAmountNetType() ? \'moveMoney.amountState.beforeTax\' : \'moveMoney.amountState.afterTax\') | translate}} </div> <div class="c-move-money__payment-options" ng-if="$ctrl.showCCPaymentRadioButtons"> <div class="field"> <input id="paymentOption1" name="paymentOptions" class="input" type="radio" value="0" ng-model="$ctrl.creditPaymentOption" ng-change="$ctrl.radioSelectionChanged()"/> <label for="paymentOption1" id="paymentOption1_label"><strong>{{ ::\'moveMoney.paymentOptions.custom\' | translate }}</strong></label> </div> <div class="field"> <input id="paymentOption2" name="paymentOptions" class="input" type="radio" value="1" ng-model="$ctrl.creditPaymentOption" ng-disabled="$ctrl.isCCRadioDisabled($ctrl.flowService.CC_DETAILS.last_statement_balance)" ng-change="$ctrl.radioSelectionChanged($ctrl.flowService.CC_DETAILS.last_statement_balance)"/> <label for="paymentOption2" id="paymentOption2_label"> <span>{{ $ctrl.flowService.CC_DETAILS.last_statement_balance | currency }}</span> <strong>{{ ::\'moveMoney.paymentOptions.lastStatementBalance\' | translate }}</strong> <span ng-if="$ctrl.nextPaymentDueDate"> - {{ ::\'moveMoney.paymentOptions.due\' | translate }} {{ $ctrl.nextPaymentDueDate | date:\'fullDate\' }} </span> </label> </div> <div class="field"> <input id="paymentOption3" name="paymentOptions" class="input" type="radio" value="2" ng-model="$ctrl.creditPaymentOption" ng-disabled="$ctrl.isCCRadioDisabled($ctrl.flowService.CC_DETAILS.minimum_payment)" ng-change="$ctrl.radioSelectionChanged($ctrl.flowService.CC_DETAILS.minimum_payment)"/> <label for="paymentOption3" id="paymentOption3_label"> <span>{{ $ctrl.flowService.CC_DETAILS.minimum_payment | currency }}</span> <strong>{{ ::\'moveMoney.paymentOptions.minimumPayment\' | translate }}</strong> <span ng-if="$ctrl.nextPaymentDueDate"> - {{ ::\'moveMoney.paymentOptions.due\' | translate }} {{ $ctrl.nextPaymentDueDate | date:\'fullDate\' }} </span> </label> </div> <div class="field"> <input id="paymentOption4" name="paymentOptions" class="input" type="radio" value="3" ng-model="$ctrl.creditPaymentOption" ng-disabled="$ctrl.isCCRadioDisabled($ctrl.flowService.CC_DETAILS.current_balance)" ng-change="$ctrl.radioSelectionChanged($ctrl.flowService.CC_DETAILS.current_balance)"/> <label for="paymentOption4" id="paymentOption4_label"> <span>{{ $ctrl.flowService.CC_DETAILS.current_balance | currency }}</span> <strong>{{ ::\'moveMoney.paymentOptions.currentBalance\' | translate }}</strong> </label> </div> </div> <div class="c-move-money__payment-options" ng-if="$ctrl.showCreditPaymentRadioButtons"> <div class="field"> <input actionable-id="{{ ::$ctrl.pageId }}_loan_custom" class="input" type="radio" value="{{$ctrl.CREDIT_PAYMENT_OPTION.INITIAL}}" ng-model="$ctrl.creditPaymentOption" ng-change="$ctrl.radioSelectionChanged($ctrl.flowService.transaction.amount)"/> <label for="{{ ::$ctrl.pageId }}_loan_custom" id="{{ ::$ctrl.pageId }}_loan_custom_label"> <strong>{{ ::\'moveMoney.paymentOptions.custom\' | translate }}</strong> </label> </div> <div class="field" ng-hide="$ctrl.isMinimumRadioHidden()"> <input actionable-id="{{ ::$ctrl.pageId }}_loan_min" class="input" type="radio" value="2" ng-model="$ctrl.creditPaymentOption" ng-disabled="$ctrl.isCCRadioDisabled($ctrl.minPaymentAmount)" ng-change="$ctrl.radioSelectionChanged($ctrl.minPaymentAmount)"/> <label for="{{ ::$ctrl.pageId }}_loan_min" id="{{ ::$ctrl.pageId }}_loan_min_label"> <span> {{ $ctrl.minPaymentAmount | currency }}</span> <strong>{{ ::\'moveMoney.paymentOptions.minimumPayment\' | translate }}</strong> <span ng-if="$ctrl.minPaymentDueDate"> - {{ ::\'moveMoney.paymentOptions.due\' | translate }} {{ $ctrl.minPaymentDueDate | date:\'fullDate\' }} </span> </label> </div> <div class="field" ng-hide="$ctrl.isCCRadioHidden()"> <input actionable-id="{{ ::$ctrl.pageId }}_loan_pay-full" class="input" type="radio" value="{{$ctrl.CREDIT_PAYMENT_OPTION.FULL}}" ng-model="$ctrl.creditPaymentOption" ng-disabled="$ctrl.isCCRadioDisabled($ctrl.flowService.LOAN_DETAILS.fullPayBalance)" ng-change="$ctrl.radioSelectionChanged($ctrl.flowService.LOAN_DETAILS.fullPayBalance)"/> <label for="{{ ::$ctrl.pageId }}_loan_pay-full" id="{{ ::$ctrl.pageId }}_loan_pay-full_label"> <strong>{{ ::$ctrl.fullBalanceCreditPaymentLabel | translate }}</strong> </label> </div> </div> <div class="c-move-money__payment-options" ng-if="$ctrl.showInvestmentsRadioButtons"> <div class="field"> <input actionable-id="{{ ::$ctrl.pageId }}_sell-some-funds" class="input input--tangerine-radio" type="radio" value="0" ng-model="$ctrl.sellFundsOption" ng-change="$ctrl.radioSelectionChanged()"/> <label for="{{ ::$ctrl.pageId }}_sell-some-funds" id="{{ ::$ctrl.pageId }}_sell-some-funds_label"> <strong>{{ ::\'moveMoney.paymentOptions.investmentsSell.some\' | translate }}</strong> </label> </div> <div class="field"> <input actionable-id="{{ ::$ctrl.pageId }}_sell-all-funds" class="input input--tangerine-radio" type="radio" value="1" ng-model="$ctrl.sellFundsOption" ng-change="$ctrl.radioSelectionChanged($ctrl.flowService.transaction.fromAccount[0].available_balance || $ctrl.flowService.transaction.fromAccount[0].available_balance)"/> <label for="{{ ::$ctrl.pageId }}_sell-all-funds"> <span class="c-move-money__sell-all-funds-label-span">{{ ::$ctrl.flowService.transaction.fromAccount[0].available_balance | currency }}</span> <strong>{{ ::\'moveMoney.paymentOptions.investmentsSell.all\' | translate }}</strong> </label> </div> </div> <tng-tile-list class="c-move-money__single-tile" tile-data="$ctrl.flowService.whenStateAccountTileListData" tile-type="$ctrl.TILE_TYPE.account" display-currency-sign="$ctrl.flowService.isCrossCurrency"> </tng-tile-list> <tng-tile-list ng-if="!$ctrl.flowService.withdrawalHelper.isActive() && !$ctrl.isOnBoarding" class="c-move-money__single-tile" tile-data="$ctrl.flowService.whenStateDateTileListData" tile-type="$ctrl.TILE_TYPE.date"> </tng-tile-list> <p ng-if="!$ctrl.flowService.withdrawalHelper.isActive()" class="c-move-money__bottom-space"></p> <p class="c-move-money__post-script" ng-if="$ctrl.flowService.isCrossCurrency"> <span ng-bind-html="$ctrl.exchangeCopy | translate:{\n            rate: $ctrl.exchangeRate\n          }"> </span> <a actionable-id="move-money-lear_more_link_rates" href="{{ ::$ctrl.ratesURL }}" target="_blank"> {{ ::\'moveMoney.topCopy.learnMore\' | translate }} </a> </p> <p ng-if="$ctrl.flowService.isModalType($ctrl.flowService.MODAL_TYPES.INVESTMENTS_BUY)" class="c-move-money__post-script confirm-message"> <span ng-bind-html=" ::\'moveMoney.amountState.note.investmentsBuy\' | translate: { portfolioUrl: $ctrl.flowService.portfolioUrl } | absoluteHref"></span> </p> <p ng-if="$ctrl.flowService.withdrawalHelper.isActive() && !$ctrl.predefinedGoalAccoungFlow" class="c-move-money__post-script confirm-message"> <span class="all-inline" ng-bind-html="::$ctrl.flowService.withdrawalHelper.getAmountNoteTransKey() + \'1\' | translate"></span> <span class="all-inline" ng-if="$ctrl.sellingAllFunds()" ng-bind-html="::$ctrl.flowService.withdrawalHelper.getAmountNoteTransKey() + \'2\' | translate"></span> <span class="all-inline" ng-bind-html="::$ctrl.flowService.withdrawalHelper.getAmountNoteTransKey() + \'3\' | translate: { portfolioUrl: $ctrl.flowService.portfolioUrl } | absoluteHref"></span> <a actionable-id="move-money-go_to_forms_RIF_SUMMARY" class="all-inline" href="" ng-click="$ctrl.goToFormsOrRifSummary()" ng-bind-html="::$ctrl.flowService.withdrawalHelper.getAmountNoteTransKey() + \'4\' | translate"></a> <span class="all-inline" ng-bind-html="::$ctrl.flowService.withdrawalHelper.getAmountNoteTransKey() + \'5\' | translate"></span> </p> </div> <div class="c-payment-recurring__tile-list" ng-if="$ctrl.flowService.isCCOngoingMonthly"> <div class="c-move-money__error" ng-if="$ctrl.flowService.submitErrors"> <tng-error-message ng-if="$ctrl.flowService.submitErrors"> <span ng-bind-html="$ctrl.flowService.submitErrors | translate:{ cardName: $ctrl._getCCAccountName() } "></span> </tng-error-message> </div> <tng-tile-list tile-data="$ctrl.recurringCCButtonTiles" tile-type="this.TILE_TYPE.text" is-actionable="true" on-tile-click="$ctrl.flowService.handleRecurringCCTileClick(index)"> </tng-tile-list> <p>{{ ::\'moveMoney.recurringCCButtons.footer\' | translate }}</p> </div> <div ng-if="$ctrl.shouldShowInvestmentSellDisclaimer()" class="c-move-money__post-script confirm-message"> <p translate="moveMoney.disclaimerState.sellInfo1" ng-if="$ctrl.flowService.isOngoingTransaction"></p> <p ng-bind-html="\'moveMoney.disclaimerState.sellInfo3\' | translate | absoluteHref"></p> <p translate="moveMoney.disclaimerState.sellInfo4"></p> <p translate="moveMoney.amountState.note.investmentsSell" ng-if="$ctrl.sellingAllFunds() && $ctrl.flowService.showTaxCopy"></p> <p ng-bind-html="\'moveMoney.disclaimerState.sellInfo9\' | translate: { portfolioUrl: $ctrl.flowService.portfolioUrl } | absoluteHref"></p> <p ng-bind-html="\'moveMoney.disclaimerState.sellInfo5\' | translate | absoluteHref" ng-if="$ctrl.flowService.showNonRegCopy"></p> </div> </form> </div> <borrowed-money-state ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.AMOUNT.BORROWED_MONEY" class="margin__t--fix margin__b--fix2"> </borrowed-money-state> <div class="c-move-money__review-and-confirm-wrapper" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.REVIEW\n      && !$ctrl.flowService.inLoadingMode"> <div class="c-move-money__error" ng-if="$ctrl.flowService.submitErrors || $ctrl.flowService.isToTFSA || $ctrl.flowService.isToRSP ||$ctrl.flowService.isExternalPayment || $ctrl.flowService.isDuplicateTrans || $ctrl.flowService.isCashAdvance"> <tng-error-message ng-if="$ctrl.flowService.submitErrors"> <span ng-bind-html="$ctrl.flowService.submitErrors | translate:{ cardName: $ctrl._getCCAccountName() } "></span> </tng-error-message> <tng-warning-message ng-if="$ctrl.flowService.isToTFSA" warning-title="\'moveMoney.reviewState.warningToTFSATitle\'"> {{ ::\'moveMoney.reviewState.warningToTFSA\' | translate }} <span ng-if="$ctrl.flowService.isOngoingTransaction">{{ ::\'moveMoney.reviewState.warningToTFSAASP\' | translate }}</span> </tng-warning-message> <tng-warning-message ng-if="$ctrl.flowService.isToRSP" warning-title="\'moveMoney.reviewState.warningToRSPTitle\'"> {{ ::\'moveMoney.reviewState.warningToRSP\' | translate }} </tng-warning-message> <tng-warning-message ng-if="$ctrl.flowService.isExternalPayment" warning-title="\'moveMoney.reviewState.warningNote\'"> <span ng-bind-html="::\'moveMoney.reviewState.warningExternal\' | translate"></span> </tng-warning-message> <tng-warning-message ng-if="$ctrl.flowService.isDuplicateTrans"> {{ ::\'moveMoney.reviewState.isDuplicateLater\' | translate }} </tng-warning-message> <tng-warning-message ng-if="$ctrl.flowService.isCashAdvance"> <span ng-bind-html="::\'moveMoney.cashAdvanceWarning\' | translate:{ fee: $ctrl.flowService.cashAdvanceFee, cardName: $ctrl._getCCAccountName() }\n          "> </span> </tng-warning-message> </div> <p class="confirm-message" ng-if="!$ctrl.flowService.isCCOngoingMonthlyTransaction && $ctrl.flowService.isModalType($ctrl.MODAL_TYPES.DEFAULT)"> <span ng-if="$ctrl.flowService.isNowTransaction && !$ctrl.flowService.isExternalPayment" ng-bind-html="\n          \'moveMoney.reviewState.descNow\' | translate:{\n            amount: $ctrl.flowService.transaction.amount,\n            currencyType:$ctrl.flowService.transaction.currency,\n            displayCurrencySign:$ctrl.flowService.isDisplayCurrencySign,\n            toAccount: $ctrl.flowService.reviewData.toName,\n            fromAccount: $ctrl.flowService.reviewData.fromName,\n          }"> </span> <span ng-if="$ctrl.flowService.isNowTransaction && $ctrl.flowService.isExternalPayment" ng-bind-html="\n          \'moveMoney.reviewState.descNowExt\' | translate:{\n            amount: $ctrl.flowService.transaction.amount,\n            currencyType:$ctrl.flowService.transaction.currency,\n            displayCurrencySign:$ctrl.flowService.isDisplayCurrencySign,\n            toAccount: $ctrl.flowService.reviewData.toName,\n            fromAccount: $ctrl.flowService.reviewData.fromName,\n          }"> </span> <span ng-if="$ctrl.flowService.isLaterTransaction" ng-bind-html="\n          \'moveMoney.reviewState.descLater\' | translate:{\n            amount: $ctrl.flowService.transaction.amount,\n            currencyType:$ctrl.flowService.transaction.currency,\n            displayCurrencySign:$ctrl.flowService.isDisplayCurrencySign,\n            toAccount: $ctrl.flowService.reviewData.toName,\n            fromAccount: $ctrl.flowService.reviewData.fromName,\n            date: $ctrl.flowService.reviewData.date,\n          }"> </span> <span ng-if="$ctrl.flowService.isOngoingTransaction" ng-bind-html="\n          $ctrl.flowService.isIndefiniteOngoingTransaction ? \'moveMoney.reviewState.descOngoingIndefinite\' : \'moveMoney.reviewState.descOngoing\' | translate:{\n            amount: $ctrl.flowService.transaction.amount,\n            currencyType: $ctrl.flowService.transaction.currency,\n            displayCurrencySign:$ctrl.flowService.isDisplayCurrencySign,\n            toAccount: $ctrl.flowService.reviewData.toName,\n            fromAccount: $ctrl.flowService.reviewData.fromName,\n            frequency: $ctrl.flowService.reviewData.frequency.toLowerCase(),\n            startDate: $ctrl.flowService.reviewData.startDate,\n            endDate: $ctrl.flowService.reviewData.endDate,\n            totalNumTrans: $ctrl.flowService.reviewData.numTransactions,\n            total: $ctrl.flowService.reviewData.recurringTotalAmount,\n          }"> </span> </p> <p class="confirm-message" ng-if="!$ctrl.flowService.isCCOngoingMonthlyTransaction && $ctrl.flowService.isModalType($ctrl.MODAL_TYPES.CHEQUING_CC)"> <span ng-if="$ctrl.flowService.isNowTransaction" ng-bind-html="\n          \'moveMoney.reviewState.descCCNow\' | translate:{\n            amount: $ctrl.flowService.transaction.amount,\n            currencyType:$ctrl.flowService.transaction.currency,\n            displayCurrencySign:$ctrl.flowService.isDisplayCurrencySign,\n            toAccount: $ctrl.flowService.reviewData.toName,\n            fromAccount: $ctrl.flowService.reviewData.fromName,\n          }"> </span> <span ng-if="$ctrl.flowService.isLaterTransaction" ng-bind-html="\n          \'moveMoney.reviewState.descCCLater\' | translate:{\n            amount: $ctrl.flowService.transaction.amount,\n            currencyType:$ctrl.flowService.transaction.currency,\n            displayCurrencySign:$ctrl.flowService.isDisplayCurrencySign,\n            toAccount: $ctrl.flowService.reviewData.toName,\n            fromAccount: $ctrl.flowService.reviewData.fromName,\n            date: $ctrl.flowService.reviewData.date,\n          }"> </span> </p> <p class="confirm-message" ng-if="$ctrl.flowService.isModalType($ctrl.MODAL_TYPES.INVESTMENTS_SELL) || $ctrl.flowService.isModalType($ctrl.MODAL_TYPES.INVESTMENTS_BUY)"> <span ng-if="$ctrl.flowService.isNowTransaction" ng-bind-html="\'moveMoney.reviewState.\'+$ctrl.flowService.modalType+\'.now\' | translate:{\n            amount: $ctrl.flowService.transaction.amount,\n            portfolio: $ctrl.flowService.reviewData.portfolioName,\n            currencyType:$ctrl.flowService.transaction.currency,\n            toAccount: $ctrl.flowService.reviewData.toName,\n            fromAccount: $ctrl.flowService.reviewData.fromName,\n          }"></span> <span ng-if="$ctrl.flowService.isOngoingTransaction && $ctrl.flowService.isIndefiniteOngoingTransaction" ng-bind-html="\'moveMoney.reviewState.\'+$ctrl.flowService.modalType+\'.ongoing\' | translate:{\n            amount: $ctrl.flowService.transaction.amount,\n            portfolio: $ctrl.flowService.reviewData.portfolioName,\n            currencyType:$ctrl.flowService.transaction.currency,\n            toAccount: $ctrl.flowService.reviewData.toName,\n            fromAccount: $ctrl.flowService.reviewData.fromName,\n            frequency: $ctrl.flowService.reviewData.frequency.toLowerCase(),\n            startDate: $ctrl.flowService.reviewData.startDate,\n          }"></span> <span ng-if="$ctrl.flowService.isOngoingTransaction && !$ctrl.flowService.isIndefiniteOngoingTransaction" ng-bind-html="\'moveMoney.reviewState.\'+$ctrl.flowService.modalType+\'.ongoingDefinite\' | translate:{\n            amount: $ctrl.flowService.transaction.amount,\n            portfolio: $ctrl.flowService.reviewData.portfolioName,\n            currencyType: $ctrl.flowService.transaction.currency,\n            toAccount: $ctrl.flowService.reviewData.toName,\n            fromAccount: $ctrl.flowService.reviewData.fromName,\n            frequency: $ctrl.flowService.reviewData.frequency.toLowerCase(),\n            startDate: $ctrl.flowService.reviewData.startDate,\n            endDate:$ctrl.flowService.reviewData.endDate,\n          }"></span> <span class="padding__t--fix2" ng-if="$ctrl.flowService.isNowTransaction" ng-bind-html="\'moveMoney.reviewState.\'+$ctrl.flowService.modalType+\'.noteNow\' | translate:{\n          toAccount: $ctrl.flowService.reviewData.toName,\n          fromAccount: $ctrl.flowService.reviewData.fromName,\n        }"></span> <span class="padding__t--fix2" ng-if="$ctrl.flowService.isOngoingTransaction" ng-bind-html="\'moveMoney.reviewState.\'+$ctrl.flowService.modalType+\'.noteOngoing\' | translate:{\n            toAccount: $ctrl.flowService.reviewData.toName,\n            fromAccount: $ctrl.flowService.reviewData.fromName,\n          }"></span> </p> <p class="confirm-message" ng-if="$ctrl.flowService.withdrawalHelper.isActive()"> <span ng-if="$ctrl.flowService.withdrawalHelper.isSavingsWithdrawal() || !$ctrl.sellingAllFunds()" ng-bind-html="\'moveMoney.reviewState.\'+$ctrl.flowService.modalType+\'.now\' | translate:{\n            beforeTaxAmount: $ctrl.flowService.withdrawalHelper.getBeforeTaxAmount(),\n            afterTaxAmount: $ctrl.flowService.withdrawalHelper.getAfterTaxAmount(),\n            toAccount: $ctrl.flowService.reviewData.toName,\n            fromAccount: $ctrl.flowService.reviewData.fromName\n          }"></span> <span ng-if="$ctrl.flowService.withdrawalHelper.isInvestmentsWithdrawal() && $ctrl.sellingAllFunds()" ng-bind-html="\'moveMoney.reviewState.\'+$ctrl.flowService.modalType+\'.nowAll\' | translate:{\n          beforeTaxAmount: $ctrl.flowService.withdrawalHelper.getBeforeTaxAmount(),\n          afterTaxAmount: $ctrl.flowService.withdrawalHelper.getAfterTaxAmount(),\n          toAccount: $ctrl.flowService.reviewData.toName,\n          fromAccount: $ctrl.flowService.reviewData.fromName\n        }"></span> </p> <p class="confirm-message" ng-if="$ctrl.flowService.modalType === $ctrl.MODAL_TYPES.EDIT && $ctrl.flowService.isFromRSP"> <span ng-bind-html="\'moveMoney.reviewState.\'+$ctrl.MODAL_TYPES.RSP_RIF_SAVING_WITHDRAWAL+\'.now\' | translate:{\n            beforeTaxAmount: $ctrl.flowService.withdrawalHelper.getBeforeTaxAmount(),\n            afterTaxAmount: $ctrl.flowService.withdrawalHelper.getAfterTaxAmount(),\n            toAccount: $ctrl.flowService.reviewData.toName,\n            fromAccount: $ctrl.flowService.reviewData.fromName\n          }"></span> </p> <p class="confirm-message" ng-if="$ctrl.flowService.isCCOngoingMonthlyTransaction"> <span ng-bind-html="\n          $ctrl.flowService.reviewData.ccRecurringi18nDescString | translate:{\n            day: $ctrl.flowService.reviewData.ccRecurringPaymentDay,\n        }"> </span> </p> <p class="confirm-message" ng-if="$ctrl.flowService.transaction.buyFunds.hasBorrowedMoney"> {{ ::\'moveMoney.reviewState.investmentsBuy.borrowedMoneyMessage\' | translate }} </p> <tng-tile-list ng-if="!$ctrl.flowService.isCCOngoingMonthlyTransaction" class="c-move-money__single-tile" tile-data="$ctrl.flowService.reviewData.amountTileData" tile-type="$ctrl.TILE_TYPE.amount" is-actionable="$ctrl.modalType !== $ctrl.MODAL_TYPES.CCFULLPAY" on-tile-click="$ctrl.modalType !== $ctrl.MODAL_TYPES.CCFULLPAY ? $ctrl.flowService.moveBackToAmount() : \'\'"> </tng-tile-list> <tng-tile-list ng-if="$ctrl.flowService.isCCOngoingMonthlyTransaction" class="c-move-money__single-tile" tile-type="$ctrl.TILE_TYPE.text" tile-data="$ctrl.flowService.reviewData.amountTileData" on-tile-click="$ctrl.flowService.moveBackToAmount()" all-actionable="true"> </tng-tile-list> <tng-tile-list class="c-move-money__single-tile" tile-data="$ctrl.flowService.whenStateAccountTileListData" tile-type="$ctrl.TILE_TYPE.account" is-actionable="$ctrl.isReviewStateAccountTileActionable(index)" on-tile-click="$ctrl.moveBackToAccountSelect(index)" display-currency-sign="$ctrl.flowService.isCrossCurrency"> </tng-tile-list> <tng-tile-list ng-if="!$ctrl.flowService.withdrawalHelper.isActive() && !$ctrl.isOnBoarding" class="c-move-money__single-tile review__date-tile" ng-class="{ disabled: $ctrl.reviewWhenTileIsDisabled}" tile-data="$ctrl.flowService.whenStateDateTileListData" tile-type="$ctrl.TILE_TYPE.date" on-tile-click="$ctrl.moveBackToWhen()" is-actionable="!$ctrl.reviewWhenTileIsDisabled" hide-arrow="true"> </tng-tile-list> <p ng-if="!$ctrl.flowService.withdrawalHelper.isActive()" class="c-move-money__bottom-space"></p> <div ng-if="$ctrl.flowService.withdrawalHelper.isInvestmentsWithdrawal()" class="c-move-money__single-tile review__date-tile margin__t--fix2"> <div class="c-tile"> <div class="panel c-tile__content"> <div class="c-account-tile"> <div class="c-account-tile__description body--4"> {{ ::\'moveMoney.reviewState.investmentsWithdrawal.withHoldingPercentage\' | translate }} </div> <div class="body--2"> <span class="body"> {{ ::$ctrl.flowService.transaction.investmentWithdrawal.withHoldingPercentage }}% </span> </div> </div> </div> </div> <div class="c-tile"> <div class="panel c-tile__content"> <div class="c-account-tile"> <div class="c-account-tile__description body--4"> {{ ::\'moveMoney.reviewState.investmentsWithdrawal.withHoldingAmount\' | translate }} </div> <div class="body--2"> <span class="body"> {{ ::$ctrl.flowService.transaction.investmentWithdrawal.withHoldingAmount | currency }} </span> </div> </div> </div> </div> </div> <p class="c-move-money__post-script" ng-if="$ctrl.flowService.isCrossCurrency"> <span ng-bind-html="$ctrl.exchangeCopy | translate:{\n          rate: $ctrl.exchangeRate\n        }"> </span> <a actionable-id="move-money-lear_more_link_exchange" href="{{ ::$ctrl.ratesURL }}" target="_blank"> {{ ::\'moveMoney.topCopy.learnMore\' | translate }} </a> </p> <p ng-if="$ctrl.flowService.isModalType($ctrl.MODAL_TYPES.INVESTMENTS_SELL) || $ctrl.flowService.isModalType($ctrl.MODAL_TYPES.INVESTMENTS_WITHDRAWAL)" class="c-move-money__post-script confirm-message"> <span ng-bind-html="::\'moveMoney.reviewState.\'+$ctrl.flowService.modalType+\'.warning\' | translate"></span> <span class="padding__t--fix1" ng-if="$ctrl.sellingAllFunds() || $ctrl.flowService.isModalType($ctrl.MODAL_TYPES.INVESTMENTS_WITHDRAWAL)" ng-bind-html="::\'moveMoney.reviewState.\'+$ctrl.flowService.modalType+\'.warningAllFunds\' | translate"></span> <span class="padding__t--fix1" ng-bind-html=" ::\'moveMoney.confirmedState.investmentsSell.note\' | translate | absoluteHref"></span> </p> <p ng-if="($ctrl.flowService.withdrawalHelper.isActive() || $ctrl.flowService.isFromRSP) && !$ctrl.flowService.withdrawalHelper.isInvestmentsWithdrawal() && !$ctrl.predefinedGoalAccoungFlow" class="c-move-money__post-script confirm-message"> <span class="all-inline" ng-bind-html="::$ctrl.flowService.withdrawalHelper.getReviewNoteTransKey() + \'1\' | translate"></span> <a actionable-id="move-money-go_to_forms_1" class="all-inline" href="" ng-click="$ctrl.goToFormsOrRifSummary()" ng-bind-html="::$ctrl.flowService.withdrawalHelper.getReviewNoteTransKey() + \'2\' | translate"></a> <span class="all-inline" ng-bind-html="::$ctrl.flowService.withdrawalHelper.getReviewNoteTransKey() + \'3\' | translate"></span> </p> <p class="c-move-money__post-script confirm-message" ng-if="$ctrl.flowService.isFromTFSA"> <span class="all-inline" ng-bind-html="::\'moveMoney.reviewState.warningFromTFSA\' | translate"></span> <tng-help-bubble class="c-move-money__help-bubble">{{ ::\'moveMoney.reviewState.warningFromTFSATooltip\' | translate }} </tng-help-bubble> </p> <p class="c-move-money__post-script confirm-message last-confirm-message" ng-if="$ctrl.flowService.showFundWarning"> <span ng-bind-html="::\'moveMoney.reviewState.fundWarning\' | translate"></span> <span class="padding__t--fix1" ng-bind-html=" ::\'moveMoney.confirmedState.investmentsSell.note\' | translate | absoluteHref"></span> </p> </div> <confirmed-state ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.CONFIRMATION" data="$ctrl.confirmedData" original-trans="$ctrl.flowService.transaction" set-modal-title="$ctrl.setCustomModalTitle(modalTitle)" rates-url="$ctrl.ratesURL" modal-type="$ctrl.flowService.modalType"> </confirmed-state> </div> <div ng-if="$ctrl.flowService.inLoadingMode" class="c-move-money__loading-container"> <tng-loading-spinner>{{ :: \'global.pageFlow.loading.isLoading\' | translate }}</tng-loading-spinner> </div> <footer ng-if="$ctrl.flowService.showMainUI"> <div class="c-move-money__sub-footer" ng-if="$ctrl.flowService.currentState == $ctrl.flowService.STATES.REVIEW\n      && !$ctrl.flowService.inLoadingMode\n      && $ctrl.flowService.isToTFSA"> <input actionable-id="{{ ::$ctrl.pageId }}_confirmTFSA" type="checkbox" class="input CB_ReadOnly" ng-click="$ctrl.onClickConfirmTFSA($event)"/> <label for="{{ ::$ctrl.pageId }}_confirmTFSA" ng-bind-html="\'moveMoney.reviewState.confirmTFSA\' | translate | absoluteHref"></label> <div ng-if="$ctrl.flowService.hasTFSAKSCapability"> <span translate="moveMoney.reviewState.confirmTFSAText" translate-values="{nextyear:$ctrl.nextYear}"></span> <a class="all-inline" href="" ng-click="$ctrl.goToOpenTFSAAccount()"><span translate="moveMoney.reviewState.confirmTFSATextP2" translate-values="{nextyear:$ctrl.nextYear}"></span></a> </div> </div> <button class="btn btn--edit" ng-show="$ctrl.flowService.BUTTONS.BTN_GRY.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_GRY.disable" ng-click="$ctrl.flowService.onButtonClick($ctrl.flowService.BUTTONS.BTN_GRY)" ng-class="{\'btn--medium\': $ctrl.isMediumButton}" actionable-id="{{\n        $ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_GRY.type.label, $ctrl.getModalType())\n      }}" watch-actionable-id="true"> {{ $ctrl.flowService.BUTTONS.BTN_GRY.type.label | translate }} </button> <button class="btn btn--orange" ng-class="{\'CB_ReadOnly\': $ctrl.flowService.CB_DISABLED_BUTTONS.includes($ctrl.flowService.BUTTONS.BTN_ORG.type)}" ng-show="$ctrl.flowService.BUTTONS.BTN_ORG.show" ng-disabled="$ctrl.flowService.BUTTONS.BTN_ORG.disable" actionable-id="{{\n        $ctrl.flowService.currentFlow.getButtonId($ctrl.flowService.BUTTONS.BTN_ORG.type.label, $ctrl.getModalType())\n      }}" watch-actionable-id="true" ng-click="$ctrl.flowService.onButtonClick($ctrl.flowService.BUTTONS.BTN_ORG)"> {{ $ctrl.flowService.BUTTONS.BTN_ORG.type.label | translate }} </button> </footer> </tng-modal-dialog> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=h(n(92)),a=h(n(104)),s=h(n(8)),r=h(n(0)),o=h(n(2)),c=h(n(116)),l=h(n(1811)),u=h(n(1803)),d=h(n(45));function h(t){return t&&t.__esModule?t:{default:t}}var f=function(){function t(e,n,i,a,s,o,c,l,u,h,f,p,g,m,_,v,S,T,y,E,A,b,C,$,N,O,I,w,P,M,R,D,L,k,B,U,F){(0,r.default)(this,t),this.$rootScope=e,this.$log=n,this.$timeout=i,this.$filter=a,this.$window=s,this.$q=o,this.$translate=A,this.accountService=c,this.flowService=l,this.accountHelpersService=p,this.LocaleService=_,this.MoveMoneyAccountsService=v,this.AccountDetailsService=S,this.investmentConstants=T,this.UserService=y,this.GlobalModalsService=C,this.UrlService=$,this.eventConstants=N,this.TimerService=O,this.AccountSummaryService=M,this.EnvironmentService=E,this.BackButtonService=I,this.backButtonConstants=w,this.billPayConstants=P,this.$scope=D,this.serviceConstants=L,this.EventBusService=R,this.TILE_TYPE=u.TILE_TYPE,this.DATE_PICKER_FREQUENCY=f.DATE_PICKER_FREQUENCY,this.DATE_SELECTOR_MODES=f.DATE_SELECTOR_MODES,this.LOCALES=g.LOCALES,this.accountConstants=h,this.ACCOUNT_TYPES=h.ACCOUNT_TYPES,this.ACCOUNT_PPTS=h.ACCOUNT_PPTS,this.ACCOUNT_MAPS=h.ACCOUNT_MAPS,this.ACCOUNT_CATEGORIES=h.ACCOUNT_CATEGORIES,this.CURRENCY_TYPES=h.CURRENCY_TYPES,this.MODAL_TYPES=m.MODAL_TYPES,this.RECURRING_CC_BUTTONS=m.RECURRING_CC_BUTTONS,this.TIME_STATES=m.TIME_STATES,this.URLS=m.URLS,this.RSP_AMOUNT_TYPES=m.RSP_AMOUNT_TYPES,this.STATUS_CODES=m.STATUS_CODES,this.TRANSACTION_CODE=m.TRANSACTION_CODE,this.CREDIT_PAYMENT_OPTION=m.CREDIT_PAYMENT_OPTION,this.SELL_FUNDS_OPTION=m.SELL_FUNDS_OPTION,this.ACCOUNT_DESCRIPTIONS=m.ACCOUNT_DESCRIPTIONS,this.ACTION_CODES=m.ACTION_CODES,this.locale=this.LOCALES.EN_CA,this.FROM_ACCOUNTS=[],this.FROM_WITHDRAWAL_ACCOUNTS=[],this.TO_ACCOUNTS=[],this.storageConstants=k,this.StorageService=B,this.FeedbackSurveyConstants=U,this.FeedbackSurveyService=F,this.recurringCCButtonTiles=[this.RECURRING_CC_BUTTONS.FULL,this.RECURRING_CC_BUTTONS.MINIMUM],this.pageId="moveMoney",this._setInitialData(),this.baseUrl=E.getAPIUrl(),this.showMinimum=!1,this.showOverdraftError=!1,this.nextYear=(0,d.default)().year()+1,this.ob2SkipButton=[{header:"moveMoney.ob2SkipTile",subHeader:""}]}return(0,o.default)(t,[{key:"$onInit",value:function(){var t=this;this.flowService.isOnBoarding=this.isOnBoarding,this.flowService.activate(this.registerFlow),this.isOnBoarding&&(this.flowService._parentFlow.incompleteFundingWarning=!0,this.flowService.baseStepNumber=this.parentFlowPreviousStepNumber,this.flowService.currentStepNumber=this.parentFlowPreviousStepNumber,this.flowService.totalStepsInSubFlow=this.parentFlowTotalSteps),this.userCapabilities=[],this.predefinedAccountFlow=!!this.predefinedAccount,this.predefinedGoalAccoungFlow=!!this.predefinedAccount&&!!this.predefinedAccount.goalSummaryData,(this.pendingTransaction||this.predefinedAccount)&&(this.flowService.hasPreselectedModalType=!0,this.flowService.modalType=this.modalType,this.flowService.enterLoadingMode()),this.flowService.hasPredefinedGoalModalType=this.predefinedGoalAccoungFlow,this._getUserCapabilities().finally((function(){t.MoveMoneyAccountsService.setUserCapabilities(t.userCapabilities),t._requestAccounts()})),this._getUserInfo(),this.flowService.onButtonClickCancel=function(){t._close()},this.flowService.onButtonClickDone=function(){t._close(void 0,{payload:{isDone:!0}}),t.$rootScope.$broadcast(t.eventConstants.UPDATE_ACCOUNT_SUMMARY),t.$rootScope.$broadcast(t.eventConstants.UPDATE_LTS_SUMMARY),t.$rootScope.$broadcast(t.eventConstants.UPDATE_FINPLAN_SUMMARY),t.$rootScope.$broadcast(t.billPayConstants.EVENTS.REFRESH_PAYEES)},this.flowService.onButtonClickSubmit=function(){t._submitData()},this.flowService.onButtonClickRestart=function(){t._setInitialData(),t._requestAccounts(),t.flowService.returnToStart()},this._currentLocale=this.LocaleService.localeDisplay.toLowerCase(),this.flowService.currencyExchangeService.getExchangeRates(),this.flowService.setAmountFocus(!0),this.isDirty=!1,this._setupNativeBackButton(),this.toolTipDescription=this.$translate.instant("moveMoney.amountState.moreThanAvailableToolTip"),this.showAmountGreaterThanAvail=!1,this.isTimeoutForAmount=!1,this.EventBusService.subscribe(this.$scope,this.ACTION_CODES.EXTERNAL_ACCOUNTS,(function(){t.flowService.hideWarning()})),this.isOnBoarding||this.EnvironmentService.isIOS()||this.intializeFeedbackSurvey()}},{key:"_setupNativeBackButton",value:function(){var t=this;this.BackButtonService.addBackButtonListener(this.$scope,this.backButtonConstants.PRIORITY.HIGH,(function(){return t.flowService.handleNativeBackClick()}))}},{key:"$onDestroy",value:function(){this.flowService.deactivate(),this.flowService.originalModalType=null,this.originalStartingAccount=null}},{key:"$onChanges",value:function(t){"pendingTransaction"in t&&t.pendingTransaction.currentValue&&(this.flowService.pendingTransaction=t.pendingTransaction.currentValue),"modalType"in t&&(this.modalType=t.modalType.currentValue,-1!==[this.MODAL_TYPES.DEFAULT,this.MODAL_TYPES.CHEQUING_CC].indexOf(t.modalType.currentValue)&&this.flowService.returnToStart())}},{key:"_setInitialData",value:function(){this.creditPaymentOption=this.CREDIT_PAYMENT_OPTION.INITIAL,this.flowService.creditPaymentOption=this.CREDIT_PAYMENT_OPTION.INITIAL,this.flowService.sellFundsOption=this.SELL_FUNDS_OPTION.CUSTOM,this.isAmountFocus=!1}},{key:"_close",value:function(t,e){var n=this,i=this.isOnBoarding?this.flowService._parentFlow:this.flowService;i.showConfirmExitUI?i.denyExit():i.warn().then((function(){n.isOnBoarding||n.onClose(e),n._resetValues(),t&&(n.$window.location=t)}))}},{key:"onAwayNavigation",value:function(){return this._warn()}},{key:"_warn",value:function(){var t=this;return this.isOnBoarding?this.flowService._parentFlow.warn():this.flowService.warn().then((function(){t.onClose(),t._resetValues()})).catch((function(e){throw t.$log.error(e),e}))}},{key:"_resetValues",value:function(){this.flowService.returnToStart(),this.flowService.originalModalType=null,this.originalStartingAccount=null,this.flowService.pendingTransaction=null,this.predefinedAccount=null}},{key:"onModalClose",value:function(t){this.$log.debug("moveMoney onModalClose:",t),this._close()}},{key:"ob2SkipFunding",value:function(){this.flowService.flowIsDone({fundedAccount:!0,skipped:!0}),this.flowService.deactivate()}},{key:"_getUserCapabilities",value:function(){var t=this;return this.flowService.enterLoadingMode(),this.UserService.getCapabilities().then((function(e){t.userCapabilities=e.capabilities}))}},{key:"_getUserInfo",value:function(){var t=this;this.UserService.getUserInfo().then((function(e){e.customer.address_list&&e.customer.address_list.length>0&&(t.flowService.userProvince=e.customer.address_list[0].province)})).catch((function(e){t.$log.error("GET USER INFO ERROR: ",e)}))}},{key:"_requestAccounts",value:function(){var t=this;this.flowService.enterLoadingMode(),this.$q.resolve().then((function(){return t.isOnBoarding&&!t.originalStartingAccount?t.AccountSummaryService.getAccounts().then((function(e){var n=e.accounts.find((function(e){return e.display_name===t.predefinedAccount.confirmation.new_account_number}));t.predefinedAccount=n})):t.$q.resolve()})).then((function(){return t.MoveMoneyAccountsService.getAccounts(t.modalType,t.predefinedAccount)})).then((function(e){t.processAccounts(e)})).catch((function(e){t.$log.error(e)})).finally((function(){t.modalType!==t.MODAL_TYPES.EDIT&&t.flowService.exitLoadingMode()}))}},{key:"_requestAccountDetails",value:function(t,e){var n=this;if(e===this.ACCOUNT_TYPES.EXT||e===this.ACCOUNT_TYPES.OTHER){var i=this.$q.defer();return i.resolve(),i.promise}return this.AccountDetailsService.getAccountDetails(t,e).then((function(t){n.processAccountDetails(t)})).catch((function(t){n.$log.error(t)}))}},{key:"_requestFullLoanBalance",value:function(t){var e=this;return this.accountService.getFullLoanBalance(t).then((function(t){e.$log.debug("loan net balance:",t),e.flowService.LOAN_DETAILS={fullPayBalance:t.netAmount}})).catch((function(t){e.$log.error(t)}))}},{key:"_generateCustomAccountTile",value:function(t,e){var n=t;return n.data=t,n.data.amount=e,n}},{key:"processAccounts",value:function(t){var e=this;this.FROM_ACCOUNTS=t.fromAccounts,this.FROM_WITHDRAWAL_ACCOUNTS=t.fromWithdrawalAccounts,this.TO_ACCOUNTS=t.toAccounts,this.$log.debug("From Accounts: ",this.FROM_ACCOUNTS),this.$log.debug("From withdrawal Accounts: ",this.FROM_WITHDRAWAL_ACCOUNTS),0===this.TO_ACCOUNTS.length&&this.predefinedAccount&&this.TO_ACCOUNTS.push(this.predefinedAccount),this.$log.debug("To Accounts: ",this.TO_ACCOUNTS),this.FROM_ACCOUNTS.forEach((function(t,n){t.type===e.ACCOUNT_TYPES.CREDIT_CARD?e.FROM_ACCOUNTS[n]=e._generateCustomAccountTile(t,t.cash_advance_available):t.type===e.ACCOUNT_TYPES.LOAN&&(e.FROM_ACCOUNTS[n]=e._generateCustomAccountTile(t,t.available_balance))})),this.TO_ACCOUNTS.forEach((function(t,n){t.type===e.ACCOUNT_TYPES.LOAN&&(e.TO_ACCOUNTS[n]=e._generateCustomAccountTile(t,t.account_balance))})),this.predefinedAccount&&(this.$log.debug("predefinedAccount detected. Modal Type: "+this.modalType),this.modalType===this.MODAL_TYPES.EDIT?this._handleEditTransaction():this._handleTransactionWithPredefinedAccount())}},{key:"_handleEditTransaction",value:function(){var t=this,e={};if(this.pendingTransaction){var n=this.pendingTransaction.from_account.number||this.pendingTransaction.from_account.display_name,i=this.pendingTransaction.to_account.number||this.pendingTransaction.to_account.display_name,a=this.pendingTransaction.from_account.currency,s=this.pendingTransaction.to_account.currency;this.modalType=this.MODAL_TYPES.EDIT,e.pending=this._getToAccountsWithPredefinedFromAccount(this.pendingTransaction.from_account).then((function(){var e=t.FROM_ACCOUNTS.filter((function(t){return t.number===n}));0===e.length&&e.push({display_name:n,currency_type:a});var r=t.TO_ACCOUNTS.filter((function(t){return t.number===i}));0===r.length&&r.push({display_name:i,currency_type:s}),r.length>0&&e.length>0?(t._requestAccountDetails(n,t.pendingTransaction.from_account.type),t.flowService.initializeEditTransactionFlow(e[0],r[0]),t.flowService.originalModalType=t.modalType,t.onFromSelect(e,!1),t.onToSelect(r,!1),t.flowService.transaction.when===t.TIME_STATES.WHEN.LATER?(t.flowService.transaction.hideModeSelector=!0,t.flowService.isFromRSP?(t.flowService.withdrawalHelper.setAmountType(t.RSP_AMOUNT_TYPES.NET),t.flowService.moveTo(t.flowService.STATES.AMOUNT)):t.flowService.startStandardEditFlow()):t.flowService.transaction.when===t.TIME_STATES.WHEN.ONGOING?t.pendingTransaction.to_account.type===t.ACCOUNT_TYPES.CREDIT_CARD?t.flowService.moveTo(t.flowService.STATES.AMOUNT):t.flowService.isEditMFASP?t.flowService.startEditMFASPFlow():t.flowService.startStandardEditFlow():t.flowService.startStandardEditFlow(),delete t.pendingTransaction,delete t.modalType):t.flowService.exitLoadingMode()}))}return e}},{key:"_areDefinedAndMatch",value:function(t,e){return Boolean(t)&&Boolean(e)&&t===e}},{key:"_handleTransactionWithPredefinedAccount",value:function(){var t=this;if(this.predefinedAccount){var e=[];if(this.modalType===this.flowService.MODAL_TYPES.INVESTMENTS_BUY||this.modalType===this.flowService.MODAL_TYPES.LOAN_MAKE_PAYMENT||this.isOnBoarding)e=[this.predefinedAccount];else e=this.FROM_ACCOUNTS.concat(this.FROM_WITHDRAWAL_ACCOUNTS).filter((function(e){var n=t._areDefinedAndMatch(e.number,t.predefinedAccount.number),i=t._areDefinedAndMatch(e.card_number,t.predefinedAccount.card_number),a=t._areDefinedAndMatch(e.number,t.predefinedAccount.card_number),s=t._areDefinedAndMatch(e.display_name,t.predefinedAccount.display_name);return n||i||a||s}));if(e.length>0){var n=e[0];this.$log.debug("found a match for predefinedAccount, starting CC flow:",n);var i=n.number||n.card_number||n.display_name;this._requestAccountDetails(i,n.type),this.modalType===this.MODAL_TYPES.CCFULLPAY?this.flowService.startCCFullPayFlow(n):this.flowService.startSelectAccountFlow(n,this.modalType),this.flowService.originalModalType=this.modalType,this.originalStartingAccount=this.predefinedAccount,delete this.predefinedAccount,delete this.modalType,this.flowService.exitLoadingMode()}else this.$log.error("Could not find a match for predefinedAccount. Modal type: "+this.modalType+", predefined account: "+this.predefinedAccount),this.onModalClose("Could not find a match for predefinedAccount.")}}},{key:"processAccountDetails",value:function(t){this.flowService.ACCOUNT_DETAILS=t.account_summary,this.flowService.ACCOUNT_DETAILS.credit_card&&this.flowService.ACCOUNT_DETAILS.credit_card&&(this.flowService.CC_DETAILS=this.flowService.ACCOUNT_DETAILS.credit_card.cc_account_details.card_details)}},{key:"_getTaxRatesForRSP",value:function(){var t=this;return this.AccountDetailsService.getWithholdingTaxRates(this.flowService.transaction.fromAccount[0].number,this.flowService.transaction.toAccount[0].number).then((function(e){if((0,s.default)(t.flowService.transaction.withdrawal,{taxRates:e.withholding_tax_rates,roomWithNoTaxWithholding:e.room_with_no_tax_withholding}),t.flowService.isFromRSPMutualFund&&t.flowService.isToRSPSavings)t.$log.debug("transfer is from RSP MF to RSP SAV, changing modal type to",t.MODAL_TYPES.INVESTMENTS_SELL),t.flowService.modalType=t.MODAL_TYPES.INVESTMENTS_SELL;else if(t.flowService.isFromRSPSavings&&t.flowService.isToRSPMutualFund)return t.$log.debug("transfer is from RSP SAV to RSP MF, changing modal type to",t.MODAL_TYPES.INVESTMENTS_BUY),t.flowService.modalType=t.MODAL_TYPES.INVESTMENTS_BUY,t._requestAccountDetails(t.flowService.transaction.toAccount[0].number,t.flowService.transaction.toAccount[0].type).then((function(){return e}));return e}))}},{key:"onFromSelect",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.flowService.transaction.fromAccount,s=(0,a.default)(e,1),r=s[0];this.$log.debug("resetting modal type to:",this.flowService.originalModalType||this.MODAL_TYPES.DEFAULT),this.modalType=this.flowService.originalModalType||this.MODAL_TYPES.DEFAULT,this.flowService.modalType=this.modalType,i.length>0&&i[0]!==r&&(delete i[0].tileDescription,this.$log.debug("Different FROM account selected, resetting TO account")),this.flowService.transaction.fromAccount=e,this.flowService.transaction.fromAccount[0].tileDescription=this.$translate.instant("moveMoney.accountTile.from.title.default");var o={urlVars:{accountHash:this.flowService.transaction.fromAccount[0].number}};return this.flowService.enterLoadingMode(),this.MoveMoneyAccountsService.getAccountDetails(o).then((function(e){t.STATUS_CODES.TSYS_GENERIC_ERROR===e.response_status.status_code?t.flowService.submitErrors="global.errorCodes."+e.response_status.status_code:t.flowService.transaction.fromAccountDetails=e.account_summary})).finally((function(){if(t.flowService.isModalType(t.MODAL_TYPES.DEFAULT)){var e=t._getModalTypeBasedOnFromAccount(r);return t.$q.resolve().then((function(){return e?(t.$log.debug("Move Money: set modal type to ",e),t.modalType=e,t.predefinedAccount=r,t.flowService.modalType=t.modalType,t._requestAccountDetails(r.number,r.type)):t.$q.resolve()})).then((function(){return t._getToAccountsWithPredefinedFromAccount(r)})).finally((function(){var e=["number","description"],n=(0,u.default)(r,e),i=t.ACCOUNT_TYPES,a=i.CREDIT_CARD,s=i.EXT,o=i.SAVINGS;return t.TO_ACCOUNTS=t.TO_ACCOUNTS.filter((function(i){var c=(0,l.default)(n,(0,u.default)(i,e)),d=r.type===a&&i.type===s,h=r.type===o&&r.currency_type===t.CURRENCY_TYPES.USD&&i.type===a;return!c&&!d&&!h})),t.flowService.exitLoadingMode()}))}if(t.modalType===t.MODAL_TYPES.LOAN_MAKE_PAYMENT){var i=t.flowService.ACCOUNT_DETAILS.profile_product_type;i!==t.ACCOUNT_PPTS.TLOC_INTEREST&&i!==t.ACCOUNT_PPTS.TLOC_INTEREST_BAL||(t.minPaymentAmount=t.flowService.ACCOUNT_DETAILS.loan.min_payment_due,t.minPaymentDueDate=t.flowService.ACCOUNT_DETAILS.loan.payment_due_date)}var a=void 0;if((t.flowService.withdrawalHelper.isActive()||t.flowService.isFromRSP)&&t.flowService.hasPredefinedToAccount()&&(a=t._getTaxRatesForRSP()),n&&(!t.flowService.isEditMode||!t.flowService.isCCOngoingMonthly)){if(a)return a.then((function(){return t.flowService.gotoNextState(),t.flowService.exitLoadingMode()}));t.flowService.gotoNextState()}return t.flowService.exitLoadingMode()}))}},{key:"_getToAccountsWithPredefinedFromAccount",value:function(t){var e=this;return this.flowService.enterLoadingMode(),this.MoveMoneyAccountsService.getToAccounts(this.flowService.modalType,t).then((function(t){e.$log.debug("Available TO accounts based on selected FROM account",t),e.TO_ACCOUNTS=t,e.modalType===e.MODAL_TYPES.EDIT||e.flowService.isEditMode||e.flowService.gotoNextState()}))}},{key:"_getModalTypeBasedOnFromAccount",value:function(t){return this.accountService.isInvesting(t)?t.registered&&!t.tax_free?this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL:this.MODAL_TYPES.INVESTMENTS_SELL:this.accountService.isSaving(t)&&t.registered&&!t.tax_free?this.MODAL_TYPES.RSP_RIF_SAVING_WITHDRAWAL:-1!==this.FROM_WITHDRAWAL_ACCOUNTS.indexOf(t)?this.MODAL_TYPES.RSP_RIF_SAVING_WITHDRAWAL:null}},{key:"onToSelect",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=void 0;this.flowService.transaction.toAccount=e;var a=0;if(this.flowService.transaction.fromAccount[0]){var s={urlVars:{accountHash:this.flowService.transaction.fromAccount[0].number}};if(this.MoveMoneyAccountsService.getAccountDetails(s).then((function(e){e.account_summary.overdraft&&e.account_summary.overdraft.overdraft_limit&&(a=e.account_summary.overdraft.overdraft_limit),t.flowService.transaction.overdraft=a})),this.flowService.cc_available_credit=null,this.flowService.transaction.toAccount[0]&&this.flowService.transaction.toAccount[0].type===this.ACCOUNT_TYPES.CREDIT_CARD){var r=this.flowService.transaction.toAccount[0];this.AccountDetailsService.getAccountDetails(r.number,this.ACCOUNT_TYPES.CREDIT_CARD).then((function(e){if(e.account_summary&&e.account_summary.credit_card){var n=e.account_summary.credit_card;n.cc_account_details&&n.cc_account_details.card_details&&(t.flowService.cc_available_credit=n.cc_account_details.card_details.available_credit)}})).catch((function(e){t.$log.error("Error while fetching CC acct details:",e)}))}if(this.isToAccountTloc=!1,this.flowService.transaction.toAccount[0]&&this.flowService.transaction.toAccount[0].TLOC){var o=this.flowService.transaction.toAccount[0];this.AccountDetailsService.getAccountDetails(o.number,this.ACCOUNT_TYPES.LOAN).then((function(e){if(e.account_summary&&e.account_summary.loan){var n=e.account_summary.loan;t.isToAccountTloc=!0,t.minPaymentAmount=n.min_payment_due,t.minPaymentDueDate=n.payment_due_date}})).catch((function(e){t.$log.error("Error while fetching CC acct details:",e)}))}}return e.length>0&&e[0].type===this.ACCOUNT_TYPES.SAVINGS&&this.AccountDetailsService.getAccountDetails(this.flowService.transaction.toAccount[0].number,this.flowService.transaction.toAccount[0].type).then((function(e){e.account_summary&&(t.flowService.profile_product_type=e.account_summary.profile_product_type)})),this.flowService.isFromRSPMutualFund&&!this.flowService.isToRSPSavings&&(this.flowService.modalType=this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL),this.flowService.withdrawalHelper.isActive()||this.flowService.isFromRSP?i=this._getTaxRatesForRSP():e.length>0&&e[0].type===this.ACCOUNT_TYPES.CREDIT_CARD?(i=this._requestAccountDetails(this.flowService.transaction.toAccount[0].number,this.flowService.transaction.toAccount[0].type),this.flowService.transaction.fromAccount&&this.flowService.transaction.fromAccount[0].type===this.ACCOUNT_TYPES.CHEQUING&&(this.modalType=this.MODAL_TYPES.CHEQUING_CC,this.flowService.modalType=this.modalType)):e.length>0&&e[0].type===this.ACCOUNT_TYPES.LOAN?i=this._requestFullLoanBalance(this.flowService.transaction):e.length>0&&this.flowService.isModalType(this.MODAL_TYPES.DEFAULT)&&this.accountService.isInvesting(e[0])&&(this.modalType=this.MODAL_TYPES.INVESTMENTS_BUY,this.flowService.modalType=this.modalType,this.predefinedAccount=e[0],i=this._requestAccountDetails(this.flowService.transaction.toAccount[0].number,this.flowService.transaction.toAccount[0].type)),i&&this.modalType!==this.MODAL_TYPES.EDIT?(this.flowService.enterLoadingMode(),i.then((function(){n&&t.flowService.gotoNextState()})).finally((function(){return t.flowService.exitLoadingMode()}))):n?this.flowService.gotoNextState():this.flowService.currentState}},{key:"shouldShowInvestmentSellDisclaimer",value:function(){return this.flowService.isModalType(this.flowService.MODAL_TYPES.INVESTMENTS_SELL)}},{key:"goToHoldsPage",value:function(){this.holdLink=!0}},{key:"_validateAndSubmit",value:function(){var t=this;return this.flowService.transaction.validate_only=!0,this.flowService.simpleSubmit().then((function(e){if(t._isProfileDupTrans(e)){var n=(0,i.default)({},e);throw n.response_status.status_code=t.STATUS_CODES.DUPLICATE_TRANSACTION,t.$log.error("Profile service returned DUPTRANS, throwing error"),n}return!e.confirmation||e.confirmation&&!e.confirmation.confirmation_code?(t.flowService.transaction.validate_only=!1,t.flowService.simpleSubmit().then((function(e){if(t._isDataPowerDupTrans(e))throw t.$log.error("DataPower service returned DUPLICATE_TRANSACTION, throwing error"),e;return e}))):e}))}},{key:"_submitData",value:function(){var t=this;this.TimerService.startTimerForAction(this.TimerService.EVENTS.SUBMIT_MOVE_MONEY),this.flowService.BUTTONS.BTN_ORG.disable=!0,this.flowService.isDuplicateTrans?this._handleDuplicateTrans():(this.flowService.enterLoadingMode(),this._validateAndSubmit().then((function(e){if(t.$log.debug("response received:",e),e.response_status&&"VALIDATION_ERROR"===e.response_status.status_code)return t.$log.error("Transaction failed validation:",e),t.flowService.showSubmitErrors(e),void t.flowService.exitLoadingMode();t._handleSuccessfulSubmission(e)})).catch((function(e){t.$log.error("Transaction was rejected:",e),t.isOnBoarding&&e&&e.response_status&&e.response_status.return_code===t.STATUS_CODES.RESTRICTION?(t.flowService.flowIsDone({success:!1,skipped:!1,data:e,fundedAccount:!0}),t.flowService.deactivate()):t.flowService.showSubmitErrors(e)})))}},{key:"_handleSuccessfulSubmission",value:function(t){var e=this;this.$log.debug("Transaction was accepted:",t),this.EventBusService.publish(this.eventConstants.PROGRESS_TAB_DATA_CHANGE,this.accountConstants.PROGRESS_TABS.ASP),this._getAccountBalances().then((function(n){e.flowService.showLoadingDoneIcon(),e.$log.debug("retrieved updated account balances:",n),e.confirmedData=e.flowService.getFormattedConfirmationData(e.flowService.transaction,t,n),e.$log.debug("formatted confirm data:",e.confirmedData),e.$log.debug("setting timeout"),e.$timeout((function(){e.flowService.exitLoadingMode(),e.TimerService.endTimerForAction(e.TimerService.EVENTS.SUBMIT_MOVE_MONEY),e.isOnBoarding?(e.flowService.flowIsDone({success:!0,skipped:!1,data:e.confirmedData,fundedAccount:!0}),e.flowService.deactivate()):e.flowService.gotoNextState()}),1500)})).catch((function(t){e.$log.error("error fetching new account balances:",t),e.isOnBoarding?(e.flowService.flowIsDone({success:!1,skipped:!1,data:t,fundedAccount:!0}),e.flowService.deactivate()):e.flowService.showSubmitErrors(t)}))}},{key:"_getAccountBalances",value:function(){var t=this,e=this.flowService.transaction.fromAccount[0];return this.accountService.getAccountBalances().then((function(n){return e.type===t.ACCOUNT_TYPES.LOAN?t.accountService.getAccountDetails(e.number,e.type).then((function(t){var i=n.accounts.find((function(t){return t.number===e.number}));if(i&&t.account_summary&&t.account_summary.loan){var a=n.accounts.indexOf(i);n.accounts[a].available_balance=t.account_summary.loan.available_credit}return n})):n}))}},{key:"_handleDuplicateTrans",value:function(){var t=this;this.flowService.enterLoadingMode(),this.flowService.isDuplicateTrans=!1,this.flowService.transaction.validate_only=!1,this.flowService.simpleSubmit().then((function(e){if(t._isDataPowerDupTrans(e))throw t.$log.error("resubmission received DataPower DUPLICATE_TRANSACTION, throwing"),e;t.$log.debug("successfully submitted duplicate LATER transaction"),t._handleSuccessfulSubmission(e)})).catch((function(e){t.$log.error("error submitting duplicate LATER transaction:",e),t.flowService.showSubmitErrors(e)}))}},{key:"_isProfileDupTrans",value:function(t){var e=this;if(t.confirmation&&t.confirmation.warnings){var n=t.confirmation.warnings;if(n.length>0)return n.filter((function(t){return t.code===e.STATUS_CODES.DUPTRAN})).length>0}return!1}},{key:"_isDataPowerDupTrans",value:function(t){return t.response_status.status_code===this.STATUS_CODES.DUPLICATE_TRANSACTION}},{key:"moveBackToAccountSelect",value:function(t){if(!(this.isOnBoarding&&1===t||this.flowService.originalModalType===this.MODAL_TYPES.EDIT||this.flowService.isEditMode))switch(this.$log.debug("Account INDEX: :",t),t){case 0:if(this.flowService.isModalType(this.flowService.MODAL_TYPES.INVESTMENTS_SELL)||this.flowService.isModalType(this.flowService.MODAL_TYPES.INVESTMENTS_WITHDRAWAL))return this.flowService.modalType=this.flowService.MODAL_TYPES.DEFAULT,this.flowService.originalModalType=this.flowService.MODAL_TYPES.DEFAULT,this.flowService.returnToStart(),this.predefinedAccount=null,this.isOnBoarding&&(this.flowService.transaction.toAccount[0]=this.predefinedAccount,this.predefinedAccount=this.originalStartingAccount,this.modalType=this.flowService.MODAL_TYPES.DEFAULT),void this._requestAccounts();this.$log.debug("moving back to FROM state"),this.flowService.transaction&&!this.predefinedAccountFlow&&(this.flowService.transaction.toAccount=[]),this.flowService.moveBackTo(this.flowService.STATES.FROM);break;case 1:if(this.flowService.isModalType(this.flowService.MODAL_TYPES.INVESTMENTS_BUY)||this.flowService.isModalType(this.flowService.MODAL_TYPES.CC_MAKE_PAYMENT)){var e=this.flowService.transaction.fromAccount;return this.flowService.modalType=this.flowService.MODAL_TYPES.DEFAULT,this.flowService.originalModalType=this.flowService.MODAL_TYPES.DEFAULT,this.predefinedAccount=null,this.flowService.moveTo(this.flowService.STATES.FROM),this.flowService.returnToStart(),this.modalType=this.flowService.MODAL_TYPES.DEFAULT,this._requestAccounts(),void this.onFromSelect(e)}this.$log.debug("moving back to TO state"),this.flowService.moveBackTo(this.flowService.STATES.TO)}}},{key:"moveBackToWhen",value:function(){this.flowService.modalType!==this.MODAL_TYPES.CCFULLPAY&&(this.$log.debug("moving back to WHEN state"),this.flowService.moveBackToWhen())}},{key:"isReviewStateAccountTileActionable",value:function(t){return this.isOnBoarding?0===t:!(this.flowService.originalModalType===this.MODAL_TYPES.EDIT)}},{key:"isCCRadioDisabled",value:function(t){if(t<=0||!this.flowService.transaction.fromAccount[0])return!0;var e=this.flowService.transaction.fromAccountDetails,n=this.flowService.transaction.fromAccount[0].available_balance,i=0;return e&&e.overdraft&&e.overdraft.overdraft_limit&&(i=e.overdraft.overdraft_limit),n+i<t&&this.flowService.transaction.when===this.TIME_STATES.WHEN.NOW}},{key:"isCCRadioHidden",value:function(){var t=this.flowService.transaction.fromAccount[0],e=this.flowService.transaction.toAccount[0];if(this.flowService.isModalType(this.MODAL_TYPES.DEFAULT)&&this.isToAccountTloc)return t.type===this.ACCOUNT_TYPES.EXT||this.flowService.transaction.when===this.TIME_STATES.WHEN.LATER||this.flowService.transaction.when===this.TIME_STATES.WHEN.ONGOING;var n=this.flowService.ACCOUNT_DETAILS?this.flowService.ACCOUNT_DETAILS.profile_product_type:"";return n===this.ACCOUNT_PPTS.TLOC_INTEREST||n===this.ACCOUNT_PPTS.TLOC_INTEREST_BAL?t.type===this.ACCOUNT_TYPES.EXT&&this.flowService.isModalType(this.MODAL_TYPES.LOAN_MAKE_PAYMENT):e.type===this.ACCOUNT_TYPES.LOAN&&t.type===this.ACCOUNT_TYPES.EXT&&this.flowService.isModalType(this.MODAL_TYPES.DEFAULT)}},{key:"isMinimumRadioHidden",value:function(){var t=this.flowService.transaction.fromAccount[0];if(this.flowService.isModalType(this.MODAL_TYPES.DEFAULT)&&this.isToAccountTloc)return t.type===this.ACCOUNT_TYPES.EXT||this.flowService.transaction.when===this.TIME_STATES.WHEN.LATER||this.flowService.transaction.when===this.TIME_STATES.WHEN.ONGOING;var e=this.flowService.ACCOUNT_DETAILS?this.flowService.ACCOUNT_DETAILS.profile_product_type:"";return!(this.flowService.isModalType(this.MODAL_TYPES.LOAN_MAKE_PAYMENT)&&(e===this.ACCOUNT_PPTS.TLOC_INTEREST||e===this.ACCOUNT_PPTS.TLOC_INTEREST_BAL))}},{key:"amountInputHasFocus",value:function(){this.creditPaymentOption=this.CREDIT_PAYMENT_OPTION.INITIAL,this.flowService.creditPaymentOption=this.CREDIT_PAYMENT_OPTION.INITIAL}},{key:"radioSelectionChanged",value:function(t){var e=this;this.showOverdraftError=!1,this.flowService.creditPaymentOption=this.creditPaymentOption,this.flowService.isModalType(this.flowService.MODAL_TYPES.INVESTMENTS_WITHDRAWAL)&&(this.flowService.transaction.investmentWithdrawal.paymentOption=this.flowService.sellFundsOption,this.creditPaymentOption=this.flowService.sellFundsOption,this.flowService.sellFundsOption===this.SELL_FUNDS_OPTION.FULL_BALANCE&&this.flowService.withdrawalHelper.setAmountType(this.RSP_AMOUNT_TYPES.NET)),this.creditPaymentOption===this.CREDIT_PAYMENT_OPTION.FULL&&this.accountService.getFullLoanBalance(this.flowService.transaction).then((function(t){t.netAmount?(e.flowService.LOAN_DETAILS={fullPayBalance:t.netAmount},e.flowService.amountChanged(t.netAmount)):t.response_status.return_code===e.STATUS_CODES.AVLBAL&&(e.showOverdraftError=!0)})),this.creditPaymentOption===this.CREDIT_PAYMENT_OPTION.INITIAL&&this.flowService.sellFundsOption===this.SELL_FUNDS_OPTION.CUSTOM?(t=" ",this.flowService.setAmountFocus(!0),this.flowService.amountReset(t),this.isCustomAmountChecked=!0):(this.flowService.setAmountFocus(!1),this.isCustomAmountChecked=!1,this.flowService.amountChanged(t),this.isDirty=!1)}},{key:"isAccountFromSelectTileDisabled",value:function(t,e){var n=this.flowService.transaction.toAccount[0];return!(this.flowService.originalModalType!==this.MODAL_TYPES.CC_MAKE_PAYMENT||!(e.currency_type===this.CURRENCY_TYPES.USD||e.type!==this.ACCOUNT_TYPES.CHEQUING&&e.type!==this.ACCOUNT_TYPES.SAVINGS||e.type===this.ACCOUNT_TYPES.SAVINGS&&e.registered||e.description===this.ACCOUNT_DESCRIPTIONS.CSA))||(!(this.flowService.originalModalType!==this.MODAL_TYPES.LOAN_MAKE_PAYMENT||!(e.type!==this.ACCOUNT_TYPES.CHEQUING&&e.type!==this.ACCOUNT_TYPES.SAVINGS&&e.type!==this.ACCOUNT_TYPES.EXT||e.type===this.ACCOUNT_TYPES.OTHER&&e.registered))||(!(!this.isOnBoarding||e.type!==this.ACCOUNT_TYPES.EXT||e.currency_type!==this.CURRENCY_TYPES.USD)||!!n&&e.display_name===n.display_name))}},{key:"isAccountFromSelectTileNotVisible",value:function(t,e){var n=this.flowService.transaction.toAccount[0];return!!n&&e.display_name===n.display_name}},{key:"isAccountToSelectTileDisabled",value:function(t,e){return!e.isEnabledAsToAccount}},{key:"validateAmount",value:function(){var t=this;this.$timeout((function(){switch(0===Math.abs(t.flowService.transaction.amount)){case!0:t.isDirty=!0;break;default:t.isDirty=!1}t.isTimeoutForAmount=!0,t.flowService.transaction.amount&&!t.flowService.isValidAmount(t.flowService.transaction.amount)?(t.flowService.resetSubmitErrors(),t.showMinimum=!0):t.showMinimum=!1}),100)}},{key:"validateAmountForErrorMessage",value:function(){var t=this;return this.showAmountGreaterThanAvail=!1,this.flowService.validateWithoutSubmit().then((function(e){if(e.response_status.return_code===t.STATUS_CODES.AVLBAL){t.showAmountGreaterThanAvail=!0,t.showMinimum=!1;var n=t.$filter("tngCurrency")(t.flowService.transaction.fromAccount[0].external_available_balance||0);t.availableBalanceWithHold=t.$translate.instant("moveMoney.amountState.moreThanAvailable",{availableAmount:n})}})).catch((function(e){t.$log.error("Transaction was rejected:",e)})),!this.showAmountGreaterThanAvail}},{key:"onAmountInputChange",value:function(t,e){this.flowService.amountChanged(t,e),this._radioButtonsAreVisible&&this.setRadioButton(t)}},{key:"getModalType",value:function(){return this.modalType||this.flowService.MODAL_TYPES.DEFAULT}},{key:"setRadioButton",value:function(t){if(this.flowService.transaction.amount){var e=0;this.flowService.transaction.fromAccountDetails&&this.flowService.transaction.fromAccountDetails.hasOwnProperty("overdraft")&&(e=this.flowService.transaction.fromAccountDetails.overdraft.overdraft_limit);var n=e+this.flowService.transaction.fromAccount[0].available_balance;t<n||this.flowService.transaction.when===this.TIME_STATES.WHEN.LATER||this.flowService.transaction.when===this.TIME_STATES.WHEN.ONGOING?this.flowService.sellFundsOption=this.SELL_FUNDS_OPTION.CUSTOM:(this.flowService.sellFundsOption=this.SELL_FUNDS_OPTION.FULL_BALANCE,this.flowService.transaction.fromAccountDetails&&this.flowService.transaction.fromAccountDetails.hasOwnProperty("overdraft")?t>=n&&(this.flowService.amountChanged(n),this.flowService.setAmountFocus(!1),this.isCustomAmountChecked=!1,this.isDirty=!1):(this.flowService.amountChanged(this.flowService.transaction.fromAccount[0].available_balance),this.flowService.setAmountFocus(!1),this.isCustomAmountChecked=!1,this.isDirty=!1))}}},{key:"setCustomModalTitle",value:function(t){this.$log.debug("setting modal title to:",t),this.flowService.customCurrentStateTitle=t}},{key:"_getFromAndToCurrencies",value:function(){return[this.flowService.transaction.fromAccount[0].currency_type,this.flowService.transaction.toAccount[0].currency_type]}},{key:"onClickConfirmTFSA",value:function(t){var e=this;this.$timeout((function(){e.flowService.BUTTONS.BTN_ORG.disable=!t.target.checked}),0)}},{key:"sellingAllFunds",value:function(){return(this.flowService.isModalType(this.MODAL_TYPES.INVESTMENTS_SELL)||this.flowService.isModalType(this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL))&&this.flowService.sellFundsOption===this.SELL_FUNDS_OPTION.FULL_BALANCE}},{key:"sellingNinetyPercentFunds",value:function(){return(this.flowService.isModalType(this.MODAL_TYPES.INVESTMENTS_SELL)||this.flowService.isModalType(this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL))&&this.flowService.sellFundsOption===this.SELL_FUNDS_OPTION.CUSTOM&&this.flowService.getWithdrawnPercentage()>90}},{key:"getSelectedFromAccountTileData",value:function(){return this.flowService.transaction.fromAccount}},{key:"goToForms",value:function(){if(this.isOnBoarding&&!this.EnvironmentService.isNative())try{var t=this.$window.location.href.match(/^[^#]+/i)[0];this.$window.open(""+t+this.URLS.FORMS,"_blank")}catch(t){this.flowService.hideWarning(),this._close(this.URLS.FORMS)}else this.flowService.hideWarning(),this._close(this.URLS.FORMS)}},{key:"goToFormsOrRifSummary",value:function(){this.flowService.isFromRIF&&!this.flowService.isFromRSPMutualFund?this.showRifSummaryModal():this.flowService.isFromRSP&&this.goToForms()}},{key:"goToOpenTFSAAccount",value:function(){this.flowService.hideWarning(),this._close(this.URLS.BASKET)}},{key:"showRifSummaryModal",value:function(){var t=this,e=this.flowService&&this.flowService.transaction&&this.flowService.transaction.fromAccount&&this.flowService.transaction.fromAccount[0]&&this.flowService.transaction.fromAccount[0].number;e&&(this.isOnBoarding?this.GlobalModalsService.showRifSummaryModal(e):this._warn().then((function(){t.GlobalModalsService.showRifSummaryModal(e)})))}},{key:"shouldShowTaxChanges",value:function(){return(this.flowService.isFromRSP||this.flowService.withdrawalHelper.isActive()&&1!==this.flowService.sellFundsOption&&1!==this.creditPaymentOption)&&!this.predefinedGoalAccoungFlow}},{key:"_getCCAccountName",value:function(){var t=(0,c.default)(this.flowService.transaction.fromAccountDetails,"credit_card.cc_account_details.product_info.product_type");return this.AccountDetailsService.getCCAccountNameByProductType(t)}},{key:"amountInputFormSubmit",value:function(){this.generalFormSubmit(),this.flowService.submit()}},{key:"generalFormSubmit",value:function(){this.hideMobileKeyboard()}},{key:"hideMobileKeyboard",value:function(){this.removePageFocus()}},{key:"removePageFocus",value:function(){document.activeElement.blur()}},{key:"intializeFeedbackSurvey",value:function(){var t=this;return this.StorageService.getItem(this.storageConstants.KEYS.SURVEY_MOVEMONEY).then((function(e){e||(t.flowService.setStorageConstant(t.storageConstants.KEYS.SURVEY_MOVEMONEY),t.flowService.setStorageService(t.StorageService),t.flowService.setFeedbackSurveyIDs(t.FeedbackSurveyConstants.MEDALLIA_FORM_IDS.MOVE_MONEY_ABANDON_FEEDBACK),t.flowService.setSurveyService(t.FeedbackSurveyService))}))}},{key:"isMediumButton",get:function(){return this.flowService.BUTTONS.BTN_GRY.type===this.flowService.BUTTON_TYPES.RESTART}},{key:"nextPaymentDueDate",get:function(){return this.flowService.CC_DETAILS.next_payment_due_date}},{key:"selectedAccounts",get:function(){return this.flowService.transaction.fromAccount}},{key:"modalTitle",get:function(){return this.flowService.customCurrentStateTitle?this.flowService.customCurrentStateTitle:this.flowService.getPageTitleTransKey()}},{key:"showCCPaymentRadioButtons",get:function(){return this.flowService.isCreditCardPayment}},{key:"showCreditPaymentRadioButtons",get:function(){var t=this.flowService.transaction.fromAccount[0];return this.flowService.isModalType(this.MODAL_TYPES.DEFAULT)&&this.isToAccountTloc?!(t.type===this.ACCOUNT_TYPES.EXT||this.flowService.transaction.when===this.TIME_STATES.WHEN.LATER||this.flowService.transaction.when===this.TIME_STATES.WHEN.ONGOING):this.flowService.isCreditPayment&&this.flowService.isFullBalanceAvailable}},{key:"showInvestmentsRadioButtons",get:function(){return(this.flowService.isModalType(this.flowService.MODAL_TYPES.INVESTMENTS_SELL)||this.flowService.isModalType(this.flowService.MODAL_TYPES.INVESTMENTS_WITHDRAWAL))&&!this.flowService.isOngoingTransaction}},{key:"_radioButtonsAreVisible",get:function(){return this.showCCPaymentRadioButtons||this.showCreditPaymentRadioButtons||this.showInvestmentsRadioButtons}},{key:"ratesURL",get:function(){var t=this.URLS.RATES;return t=t.replace("{{langCode}}",this._currentLocale),t=this.UrlService.fixRelativeLink(t)}},{key:"exchangeCopy",get:function(){var t=this._getFromAndToCurrencies(),e=(0,a.default)(t,2);return"moveMoney.topCopy.amountInputFXRate"+e[0]+"to"+e[1]}},{key:"exchangeRate",get:function(){var t=this._getFromAndToCurrencies(),e=(0,a.default)(t,2),n=e[0],i=e[1];return this.flowService.currencyExchangeService.getDisplayRate(n,i)}},{key:"fullBalanceCreditPaymentLabel",get:function(){if(this.isToAccountTloc)return"moveMoney.paymentOptions.fullBalancePlusFeesInterest";if(this.flowService.transaction.toAccount[0]){var t=this.flowService.transaction.toAccount[0].product_code;if(t===this.ACCOUNT_PPTS.TLOC_INTEREST||t===this.ACCOUNT_PPTS.TLOC_INTEREST_BAL)return"moveMoney.paymentOptions.fullBalancePlusFeesInterest"}return"moveMoney.paymentOptions.fullBalancePlusTax"}},{key:"reviewWhenTileIsDisabled",get:function(){return this.modalType===this.MODAL_TYPES.CCFULLPAY}}]),t}();f.$inject=["$rootScope","$log","$timeout","$filter","$window","$q","AccountService","MoveMoneyFlowService","tngTileListConstants","accountConstants","tngDateSelectorConstants","AccountHelpersService","localeConstants","moveMoneyConstants","LocaleService","MoveMoneyAccountsService","AccountDetailsService","investmentConstants","UserService","EnvironmentService","$translate","toolTipConstants","GlobalModalsService","UrlService","eventConstants","TimerService","BackButtonService","backButtonConstants","billPayConstants","AccountSummaryService","EventBusService","$scope","serviceConstants","storageConstants","StorageService","FeedbackSurveyConstants","FeedbackSurveyService"],e.default=f,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=_(n(39)),a=_(n(104)),s=_(n(8)),r=_(n(33)),o=_(n(177)),c=_(n(0)),l=_(n(2)),u=_(n(264)),d=_(n(266)),h=_(n(265)),f=_(n(45)),p=_(n(116)),g=_(n(267)),m=n(364);function _(t){return t&&t.__esModule?t:{default:t}}var v=function(t){function e(t,n,i,a,s,l,d,h,f,p,g,m,_,v,S,T,y,E,A,b,C,$,N,O,I,w,P,M,R,D,L,k){var B,U,F,x;(0,c.default)(this,e);var Y=(0,u.default)(this,(e.__proto__||(0,o.default)(e)).call(this,t,n,i,a,s,S,d,$));return Y.$log=t,Y.$translate=l,Y.$filter=L,Y.accountHelpersService=h,Y.currencyExchangeService=_,Y.BusinessDaysService=T,Y.CurrencyService=v,Y.DateService=y,Y.AccountService=A,Y.investmentConstants=b,Y.MultiLineDateTile=C,Y.UserService=O,Y.userConstants=I,Y.accountConstants=p,Y.AnchorService=w,Y.LocaleService=P,Y.EnvironmentService=M,Y.stateConstants=R,Y.serviceConstants=D,Y.InvestmentFundConstants=k,Y.withdrawalHelper=E,Y.withdrawalHelper.setFlowService(Y),Y.AMOUNT_INPUT_TYPES=f.AMOUNT_INPUT_TYPES,Y.ACCOUNT_TYPES=p.ACCOUNT_TYPES,Y.CURRENCY_TYPES=p.CURRENCY_TYPES,Y.TIME_STATES=g.TIME_STATES,Y.ERROR_MESSAGES=g.ERROR_MESSAGES,Y.TECHNICAL_DESCRIPTIONS=g.TECHNICAL_DESCRIPTIONS,Y.PAYMENT_INDICATOR=g.PAYMENT_INDICATOR,Y.MODAL_TYPES=g.MODAL_TYPES,Y.RECURRING_CC_BUTTONS=g.RECURRING_CC_BUTTONS,Y.RSP_AMOUNT_TYPES=g.RSP_AMOUNT_TYPES,Y.STATUS_CODES=g.STATUS_CODES,Y.TRANSACTION_CODE=g.TRANSACTION_CODE,Y.DETAIL_CODES=g.DETAIL_CODES,Y.BUY_FUNDS_DATE_RESTRICTIONS=g.BUY_FUNDS_DATE_RESTRICTIONS,Y.CREDIT_PAYMENT_OPTION=g.CREDIT_PAYMENT_OPTION,Y.SELL_FUNDS_OPTION=g.SELL_FUNDS_OPTION,Y.DATE_SELECTOR_MODES=m.DATE_SELECTOR_MODES,Y.FREQUENCY_MODE_CONSTANTS=m.FREQUENCY_MODE_CONSTANTS,Y.BUTTON_TYPES=d.BUTTON_TYPES,Y.TODAY_IN_EST=m.TODAY_IN_EST,Y.$timeout=N,Y.capabilitiesArray=null,Y.excludeDailyFrequency=!0,Y.STATES={FROM:{titleKey:"moveMoney.headings.fromHeading",customTitleKey:{}},TO:{titleKey:"moveMoney.headings.to.default",customTitleKey:(B={},(0,r.default)(B,Y.MODAL_TYPES.INVESTMENTS_SELL,"moveMoney.headings.to.investmentsSell"),(0,r.default)(B,Y.MODAL_TYPES.INVESTMENTS_WITHDRAWAL,"moveMoney.headings.to.investmentsWithdrawal"),B)},WHEN:{titleKey:"moveMoney.headings.when.default",customTitleKey:(U={},(0,r.default)(U,Y.MODAL_TYPES.INVESTMENTS_BUY,"moveMoney.headings.when.investmentsBuy"),(0,r.default)(U,Y.MODAL_TYPES.INVESTMENTS_SELL,"moveMoney.headings.when.investmentsSell"),U)},REGISTERED_MF_ONGOING_WITHDRAWAL:{titleKey:"moveMoney.headings.registeredMfOngoingWithdrawal"},DATE:{titleKey:Y.getDateHeadingString()},AMOUNT:{titleKey:"moveMoney.headings.amount.default",customTitleKey:(F={},(0,r.default)(F,Y.MODAL_TYPES.INVESTMENTS_BUY,"moveMoney.headings.amount.investmentsBuy"),(0,r.default)(F,Y.MODAL_TYPES.INVESTMENTS_SELL,"moveMoney.headings.amount.investmentsSell"),(0,r.default)(F,Y.MODAL_TYPES.RSP_RIF_SAVING_WITHDRAWAL,"moveMoney.headings.amount.rspRifSavingWithdrawal"),(0,r.default)(F,Y.MODAL_TYPES.INVESTMENTS_WITHDRAWAL,"moveMoney.headings.amount.investmentsWithdrawal"),(0,r.default)(F,Y.MODAL_TYPES.CC_ONGOING,"moveMoney.headings.amount.creditCardOngoing"),(0,r.default)(F,Y.MODAL_TYPES.CHEQUING_CC,"moveMoney.headings.amount.chequingCreditCard"),F),BORROWED_MONEY:{titleKey:"moveMoney.headings.amount.default",customTitleKey:(0,r.default)({},Y.MODAL_TYPES.INVESTMENTS_BUY,"moveMoney.borrowedMoneyState.borrowedMoneyModalWindowTitle")}},REVIEW:{titleKey:"moveMoney.headings.review.default",customTitleKey:(x={},(0,r.default)(x,Y.MODAL_TYPES.INVESTMENTS_SELL,"moveMoney.headings.review.investmentsSell"),(0,r.default)(x,Y.MODAL_TYPES.INVESTMENTS_BUY,"moveMoney.headings.review.investmentsBuy"),(0,r.default)(x,Y.MODAL_TYPES.RSP_RIF_SAVING_WITHDRAWAL,"moveMoney.headings.review.rspRifSavingWithdrawal"),(0,r.default)(x,Y.MODAL_TYPES.INVESTMENTS_WITHDRAWAL,"moveMoney.headings.review.investmentsWithdrawal"),(0,r.default)(x,Y.MODAL_TYPES.CHEQUING_CC,"moveMoney.headings.review.chequingCreditCard"),x)},CONFIRMATION:{titleKey:"moveMoney.headings.confirmHeadingNow"}},Y.modalType=Y.MODAL_TYPES.DEFAULT,Y.ACCOUNT_DETAILS={},Y.CC_DETAILS={},Y.hasPreselectedModalType=!1,Y.customCurrentStateTitle="",Y.TYPES_WITH_PREDEFINED_TO_ACCOUNT=[Y.MODAL_TYPES.INVESTMENTS_BUY,Y.MODAL_TYPES.CC_MAKE_PAYMENT,Y.MODAL_TYPES.CCFULLPAY,Y.MODAL_TYPES.LOAN_MAKE_PAYMENT],Y.TYPES_WITH_PREDEFINED_FROM_ACCOUNT=[Y.MODAL_TYPES.INVESTMENTS_SELL,Y.MODAL_TYPES.RSP_RIF_SAVING_WITHDRAWAL,Y.MODAL_TYPES.INVESTMENTS_WITHDRAWAL],Y._initialState=Y.STATES.FROM,Y.isDuplicateTrans=!1,Y.isAmountFocus=!0,Y._initialTransactionObj=null,Y.showAmountGreaterThanAvail=!1,Y.showAvailBalanceError=!1,Y.holdLink=!1,Y.validationError=!1,Y}return(0,h.default)(e,t),(0,l.default)(e,[{key:"_conditionalScrollToTop",value:function(){this.AnchorService&&this.AnchorService.scrollToModalTop()}},{key:"returnToStart",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._skipNextAnalytics=t,this._resetState()}},{key:"getDateHeadingString",value:function(t){return t===this.TIME_STATES.WHEN.LATER?"moveMoney.headings.futureDateHeading":"moveMoney.headings.recurringDateHeading"}},{key:"startCCFullPayFlow",value:function(t){this.CC_DETAILS=t,this.modalType=this.MODAL_TYPES.CCFULLPAY,this.transaction.toAccount[0]=t,this.amountChanged(t.account_balance),this._setTransactionStartDate((0,f.default)()),this.transaction.when=this.TIME_STATES.WHEN.NOW}},{key:"startSelectAccountFlow",value:function(t,e){this.modalType=e,this.hasPredefinedToAccount()?this.transaction.toAccount[0]=t:(this.transaction.fromAccount[0]=t,this.moveTo(this.STATES.TO))}},{key:"initializeEditTransactionFlow",value:function(t,e){this.excludeDailyFrequency=!1;var n=this.pendingTransaction.frequency!==this.TIME_STATES.FREQUENCY.ONCE;this.modalType=this.MODAL_TYPES.EDIT,this.isEditMode=!0,this.pendingTransaction.mutual_fund&&(this.excludeDailyFrequency=!0,this.modalType=this.pendingTransaction.trade_type===this.investmentConstants.TRANSACTION_TYPE.BUY?this.MODAL_TYPES.INVESTMENTS_BUY:this.MODAL_TYPES.INVESTMENTS_SELL,this.pendingTransaction.expiry_date=this.pendingTransaction.end_date,this.pendingTransaction.sequenceNumber=this.pendingTransaction.id);var i=this.pendingTransaction.frequency===this.TIME_STATES.FREQUENCY.ONCE?this.TIME_STATES.WHEN.LATER:this.TIME_STATES.WHEN.ONGOING;(0,s.default)(this.transaction,{fromAccount:[t],toAccount:[e],scheduledEndDate:f.default.utc(this.pendingTransaction.expiry_date),scheduledStartDate:f.default.utc(this.pendingTransaction.effective_date),frequency:this.pendingTransaction.frequency,amount:this.pendingTransaction.amount,originalAmount:this.pendingTransaction.amount,sequenceNumber:this.pendingTransaction.sequenceNumber,when:i,isRecurring:i===this.TIME_STATES.WHEN.ONGOING,shouldPrePopulateAmount:!0}),n?(this.transaction.datePickerSelectionMode=this.pendingTransaction.expiry_date?this.DATE_SELECTOR_MODES.RANGE:this.DATE_SELECTOR_MODES.INDEFINITE,this.isEditMode&&(this.transaction.hideModeSelector=!1)):(this.transaction.datePickerSelectionMode=this.DATE_SELECTOR_MODES.SINGLE,this.transaction.hideModeSelector=!0),this.pendingTransaction.paymentIndicator&&(this.modalType=this.MODAL_TYPES.CC_ONGOING,this.transaction.payment_indicator=this.pendingTransaction.paymentIndicator,this.excludeDailyFrequency=!0)}},{key:"_resetState",value:function(){var t=this;(0,d.default)(e.prototype.__proto__||(0,o.default)(e.prototype),"_resetState",this).call(this),this._resetCustomModalTitle(),this.resetSubmitErrors(),this.transaction={fromAccount:[],toAccount:[],amount:"",currency:"",when:{},frequency:this.FREQUENCY_MODE_CONSTANTS.MONTHLY,isRecurring:!1,hideModeSelector:!1,scheduledStartDate:null,scheduledEndDate:null,datePickerSelectionMode:this.DATE_SELECTOR_MODES.SINGLE,buyFunds:{hasBorrowedMoney:!1},withdrawal:{amountType:this.RSP_AMOUNT_TYPES.GROSS,taxRates:[],secondAmount:0},investmentWithdrawal:{paymentOption:0,withHoldingPercentage:0,withHoldingAmount:0},datePickerMinDate:this.TODAY_IN_EST.clone().add(1,"day"),datePickerMaxDate:this.TODAY_IN_EST.clone().add(5,"years")},this._initialTransactionObj=angular.copy(this.transaction),this.whenStateAccountTileListData=[],this.whenStateDateTileListData=[],this.reviewData={},this.isOnBoarding?(this._parentFlow&&this._updateUI(),this.setStepNumber(this.currentState)):this.BUTTONS={BTN_GRY:new m.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!0,!1),BTN_ORG:new m.ModalFooterButton(this.BUTTON_TYPES.CANCEL,!1,!1)},this.hasPreselectedModalType=!1,this.modalType=this.MODAL_TYPES.DEFAULT,this.isDuplicateTrans=!1,this.isEditMode=!1,this.capabilitiesArray||this.UserService.getCapabilities().then((function(e){t.capabilitiesArray=e.capabilities})).catch((function(e){t.$log.error("Could not retrieve capabilities:",e)})),this.setBuyFundsHasBorrowedMoney(void 0)}},{key:"startEditMFASPFlow",value:function(){this.isEditMFASP&&(this.$log.debug("editing an MF ASP, starting over at FROM state"),this.moveTo(this.STATES.FROM),this._stateHistory=[])}},{key:"startStandardEditFlow",value:function(){this.$log.debug("editing a transaction, starting over at DATE state"),this.moveTo(this.STATES.DATE),this._stateHistory=[]}},{key:"_updateUI",value:function(){var t=this;switch(this.BUTTONS.BTN_GRY.show=!0,this.BUTTONS.BTN_GRY.disable=!1,this.BUTTONS.BTN_ORG.show=!0,this.BUTTONS.BTN_ORG.disable=!1,this.currentState){case this.STATES.FROM:angular.equals(this._initialTransactionObj,this.transaction)?this.hideWarning():this.showWarning(),this.BUTTONS.BTN_GRY.type=this.isSubFlow?this.BUTTON_TYPES.BACK:this.BUTTON_TYPES.CANCEL,this.isOnBoarding&&(this.BUTTONS.BTN_GRY.show=!1),this.BUTTONS.BTN_ORG.show=!1;break;case this.STATES.TO:this.BUTTONS.BTN_GRY.type=this.hasPreselectedModalType&&this.hasPredefinedFromAccount()?this.BUTTON_TYPES.CANCEL:this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_ORG.show=!1;break;case this.STATES.WHEN:this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_ORG.show=!1;break;case this.STATES.REGISTERED_MF_ONGOING_WITHDRAWAL:this.hideWarning(),this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.DONE;break;case this.STATES.AMOUNT:0===this.transaction.amount?this.transaction.withdrawal.secondAmount=0:this.withdrawalHelper.calculateSecondAmount(),this._getWhenStateData().then((function(e){var n=(0,a.default)(e,2);t.whenStateAccountTileListData=n[0],t.whenStateDateTileListData=n[1]})),this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.isCCOngoingMonthly?(this.modalType=this.MODAL_TYPES.CC_ONGOING,this.BUTTONS.BTN_ORG.show=!1):(this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.NEXT,this.BUTTONS.BTN_ORG.disable=!this.isValidAmount(this.transaction.amount)),this.transaction.currency||(this.transaction.currency=this.transaction.fromAccount[0].currency_type),this.setAmountFocus(!0);break;case this.STATES.AMOUNT.BORROWED_MONEY:this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.NEXT,this.BUTTONS.BTN_ORG.disable=!0;break;case this.STATES.DATE:this.STATES.DATE.titleKey=this.getDateHeadingString(this.transaction.when),this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.BACK,this.isEditMode&&this.pendingTransaction&&(this.isEditMFASP||(this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.CANCEL)),this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.NEXT,this.BUTTONS.BTN_ORG.disable=!this.hasFrequency;break;case this.STATES.REVIEW:this.resetSubmitErrors(),this.isModalType(this.MODAL_TYPES.INVESTMENTS_SELL)||this.isModalType(this.MODAL_TYPES.INVESTMENTS_BUY)?(this.BUTTONS.BTN_GRY.show=!1,this.isToTFSA&&(this.BUTTONS.BTN_ORG.disable=!0)):this.withdrawalHelper.isActive()||this.isFromRSP?this.isToTFSA&&(this.BUTTONS.BTN_ORG.disable=!0):this.BUTTONS.BTN_ORG.disable=this.isToTFSA,this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.SUBMIT,this.currencyExchangeService.getExchangeRates().then((function(){t.reviewData=t.getReviewData()}));break;case this.STATES.CONFIRMATION:this.holdLink=!1,this.hideWarning(),this.BUTTONS.BTN_GRY.type=this.BUTTON_TYPES.RESTART,this.BUTTONS.BTN_GRY.show=this.isModalType(this.MODAL_TYPES.DEFAULT)||this.isModalType(this.MODAL_TYPES.CHEQUING_CC)||this.isModalType(this.MODAL_TYPES.CC_ONGOING),this.BUTTONS.BTN_ORG.type=this.BUTTON_TYPES.DONE}}},{key:"activate",value:function(t){return this.isSubFlow=angular.isDefined(t),this.isOnBoarding&&(this.STATES.FROM.titleKey="moveMoney.headings.fromHeadingOb2"),(0,d.default)(e.prototype.__proto__||(0,o.default)(e.prototype),"activate",this).call(this,t)}},{key:"gotoNextState",value:function(){var t=this;switch(this.currentState){case this.STATES.FROM:this.transaction.currency=this.transaction.fromAccount[0].currency_type,!this.isEditMode&&this.transaction.fromAccount[0].available_balance<this.transaction.amount&&(this.transaction.amount=0),this.modalType===this.MODAL_TYPES.CCFULLPAY?this._getWhenStateData().then((function(e){var n=(0,a.default)(e,2);t.whenStateAccountTileListData=n[0],t.whenStateDateTileListData=n[1],t.moveTo(t.STATES.REVIEW)})):this.isOnBoarding?(this.onWhenSelect(this.TIME_STATES.WHEN.NOW),this.moveTo(this.STATES.AMOUNT)):this.hasPredefinedToAccount()?this.moveTo(this.STATES.WHEN):this.isEditMFASP?this.moveTo(this.STATES.DATE):this.moveTo(this.STATES.TO);break;case this.STATES.TO:this.withdrawalHelper.isSavingsWithdrawal()&&(this.transaction.amount=0,this.onWhenSelect(this.TIME_STATES.WHEN.NOW)),this.isModalType(this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL)||this.isModalType(this.MODAL_TYPES.RSP_RIF_SAVING_WITHDRAWAL)?this.onWhenSelect(this.TIME_STATES.WHEN.NOW):this.moveTo(this.STATES.WHEN);break;case this.STATES.WHEN:(this.isModalType(this.MODAL_TYPES.INVESTMENTS_SELL)||this.isModalType(this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL))&&this.isOngoingTransaction&&(this.transaction.fromAccount[0].tax_free||this.transaction.fromAccount[0].type===this.ACCOUNT_TYPES.MUTUAL_FUND&&this.transaction.fromAccount[0].registered)?this.moveTo(this.STATES.REGISTERED_MF_ONGOING_WITHDRAWAL):this.moveTo(this.STATES.DATE);break;case this.STATES.DATE:this.isIndefiniteOngoingTransaction&&(this.transaction.scheduledEndDate=null),this.moveTo(this.STATES.AMOUNT);break;case this.STATES.AMOUNT:this.resetSubmitErrors(),this.isModalType(this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL)?(this.enterLoadingMode(),this._validateInvestmentsWithdrawal().then((function(e){(0,s.default)(t.transaction.investmentWithdrawal,{withHoldingPercentage:e.withHoldingPercentage,withHoldingAmount:e.withHoldingAmount}),t.resetSubmitErrors(),t.moveTo(t.STATES.REVIEW)})).catch(this.showSubmitErrors.bind(this)).finally(this.exitLoadingMode.bind(this))):this.isModalType(this.MODAL_TYPES.INVESTMENTS_BUY)?this.moveTo(this.STATES.AMOUNT.BORROWED_MONEY):(this.enterLoadingMode(),this._validateWithoutSubmit().then((function(e){e.response_status.status_code===t.serviceConstants.STATUS_CODES.SUCCESS&&(t.resetSubmitErrors(),t.moveTo(t.STATES.REVIEW))})).catch((function(e){if(e.response_status.return_code===t.serviceConstants.STATUS_CODES.AVLBAL){t.showAvailBalanceError=!0;t.availableBalanceWithHold=t.$translate.instant("moveMoney.amountState.moreThanAvailable")}else if(e.response_status.return_code===t.serviceConstants.STATUS_CODES.AVLBALHLD){t.showAmountGreaterThanAvail=!0,t.holdLink=!0;var n=t.$filter("tngCurrency")(t.transaction.fromAccount[0].external_available_balance||0);t.availableBalanceWithHold=t.$translate.instant("moveMoney.amountState.moreThanAvailableHold",{availableAmount:n})}else t.$log.error("Transaction was rejected:",e),t.validationError=!0,t.isOnBoarding&&void 0!==e&&void 0!==e.response_status&&e.response_status.return_code===t.STATUS_CODES.RESTRICTION?(t.flowIsDone({success:!1,skipped:!1,data:e,fundedAccount:!0}),t.deactivate()):t.showSubmitErrors(e);t.$log.error("Transaction was rejected:",e)})).finally(this.exitLoadingMode.bind(this)));break;case this.STATES.AMOUNT.BORROWED_MONEY:this.moveTo(this.STATES.REVIEW);break;case this.STATES.REVIEW:this.moveTo(this.STATES.CONFIRMATION)}}},{key:"_validateWithoutSubmit",value:function(){return this.transaction.validate_only=!0,this.simpleSubmit().then((function(t){return t}))}},{key:"simpleSubmit",value:function(){var t=this.prepareData(this.transaction,this.modalType),e=this.originalModalType===this.MODAL_TYPES.EDIT||this.isEditMode,n=this.modalType;return this.isEditMFASP&&(n=this.AccountService.aspConstants.MODAL_TYPES.INVESTMENT),this.AccountService.moveMoney(t,e,n)}},{key:"prepareData",value:function(t,e){var n={urlVars:{accountHash:this.isModalType(this.MODAL_TYPES.INVESTMENTS_BUY)?t.toAccount[0].number:t.fromAccount[0].number},header:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:this._buildParams(t,e)};switch(this.isEditMFASP&&(n.urlVars.accountHash=t.toAccount[0].number),(e===this.MODAL_TYPES.EDIT||this.isEditMode)&&(n.urlVars.id=t.sequenceNumber,n.urlVars.seqNum=t.sequenceNumber,(this.isModalType(this.MODAL_TYPES.INVESTMENTS_BUY)||this.isModalType(this.MODAL_TYPES.INVESTMENTS_SELL))&&(n.urlVars.seqNum=this.pendingTransaction.id)),e){case this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL:n.mockResponse="investmentWithdrawal"}return n}},{key:"_getFullLoanPaymentTransactionCode",value:function(t){return t.product_code===this.accountConstants.ACCOUNT_PPTS.TERM_LOAN?this.TRANSACTION_CODE.FULL_TERM_LOAN_PAYMENT:this.TRANSACTION_CODE.LINE_OF_CREDIT_REQUEST}},{key:"_buildParams",value:function(t,e){var n=t.toAccount[0],i=t.fromAccount[0],a={transfers:{when:t.when,amount:t.amount},validate_only:!!angular.isDefined(t.validate_only)&&t.validate_only};switch(e){case this.MODAL_TYPES.INVESTMENTS_BUY:(0,s.default)(a.transfers,{cash_target_account:i.display_name,leverage_disclosure:t.buyFunds.hasBorrowedMoney,transaction_type:this.investmentConstants.TRANSACTION_TYPE.BUY});break;case this.MODAL_TYPES.INVESTMENTS_SELL:(0,s.default)(a.transfers,{cash_target_account:n.display_name,sell_all:this.sellingAllFunds(),transaction_type:this.investmentConstants.TRANSACTION_TYPE.SELL});break;case this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL:(0,s.default)(a.transfers,{amount:this.withdrawalHelper.getBeforeTaxAmount(),cash_target_account:n.display_name,sell_all:this.sellingAllFunds(),transaction_type:this.investmentConstants.TRANSACTION_TYPE.RSPWITHDRAWAL,province:this.userProvince});break;case this.MODAL_TYPES.RSP_RIF_SAVING_WITHDRAWAL:(0,s.default)(a.transfers,{to_account:n.display_name,amount:this.transaction.amount,currency:t.currency,amount_type:t.withdrawal.amountType,frequency:this.TIME_STATES.FREQUENCY.ONCE});break;default:this.isFromRSP?(0,s.default)(a.transfers,{to_account:n.display_name,amount:this.transaction.amount,currency:t.currency,amount_type:t.withdrawal.amountType,frequency:this.TIME_STATES.FREQUENCY.ONCE}):(0,s.default)(a.transfers,{to_account:"",from_account:"",when:t.when,currency:t.currency,amount:t.amount}),t.toAccount[0].type===this.ACCOUNT_TYPES.CREDIT_CARD?a.transfers.to_account=n.number:(a.transfers.to_account=n.display_name,a.transfers.from_account=i.display_name)}return t.when!==this.TIME_STATES.WHEN.NOW&&(a.transfers.scheduled_start_date=(0,f.default)(t.scheduledStartDate).format("YYYY-MM-DD"),t.when===this.TIME_STATES.WHEN.ONGOING&&(a.transfers.frequency=t.frequency,t.datePickerSelectionMode===this.DATE_SELECTOR_MODES.INDEFINITE?t.toAccount[0].type===this.ACCOUNT_TYPES.CREDIT_CARD&&(a.transfers.payment_indicator=t.payment_indicator):a.transfers.scheduled_end_date=(0,f.default)(t.scheduledEndDate).format("YYYY-MM-DD"))),this.modalType===this.MODAL_TYPES.LOAN_MAKE_PAYMENT?((0,s.default)(a,{validate_only:t.validate_only}),this.creditPaymentOption===this.CREDIT_PAYMENT_OPTION.FULL&&t.when===this.TIME_STATES.WHEN.NOW&&((0,s.default)(a.transfers,{to_account:n.number,to_account_transaction_code:this._getFullLoanPaymentTransactionCode(n),currency:n.currency_type,when:this.TIME_STATES.WHEN.NOW}),delete a.transfers.from_account,delete a.transfers.amount)):(n.TLOC||n.LOC||n.TERM_LOAN)&&this.creditPaymentOption===this.CREDIT_PAYMENT_OPTION.FULL&&((0,s.default)(a,{validate_only:t.validate_only}),(0,s.default)(a.transfers,{to_account:n.number,to_account_transaction_code:this._getFullLoanPaymentTransactionCode(n),currency:n.currency_type}),t.when===this.TIME_STATES.WHEN.NOW&&(a.transfers.when=this.TIME_STATES.WHEN.NOW),delete a.transfers.amount),this.$log.debug("outgoing payload:",a),e===this.MODAL_TYPES.EDIT||this.isEditMode?this._buildParamsForEditRequest(a):a}},{key:"sellingAllFunds",value:function(){return(this.isModalType(this.MODAL_TYPES.INVESTMENTS_SELL)||this.isModalType(this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL))&&this.sellFundsOption===this.SELL_FUNDS_OPTION.FULL_BALANCE}},{key:"_buildParamsForEditRequest",value:function(t){var e={transfers:{amount:t.transfers.amount,frequency:t.transfers.frequency?t.transfers.frequency.toUpperCase():null,scheduled_start_date:t.transfers.scheduled_start_date,scheduled_end_date:t.transfers.scheduled_end_date},validate_only:t.validate_only};return t.transfers.payment_indicator&&(e.transfers.payment_indicator=t.transfers.payment_indicator),t.transfers.cash_target_account&&(e.transfers.cash_target_account=t.transfers.cash_target_account),this.isEditMFASP&&(e.transfers.cash_target_account=this.transaction.fromAccount[0].number),this.isFromRSP&&(e.transfers.amount_type=t.transfers.amount_type),e}},{key:"_validateInvestmentsWithdrawal",value:function(){var t={urlVars:{accountHash:this.transaction.fromAccount[0].display_name},mockResponse:"investmentWithdrawalValidation",data:{validate_only:!0,transfers:{amount:this.withdrawalHelper.getBeforeTaxAmount(),cash_target_account:this.transaction.toAccount[0].number,sell_all:"1"===this.transaction.investmentWithdrawal.paymentOption,transaction_type:this.investmentConstants.TRANSACTION_TYPE.RSPWITHDRAWAL,province:this.userProvince}}};return this.AccountService.moveMoney(t,!1,this.modalType)}},{key:"onWhenSelect",value:function(t){switch(this.transaction.when=t,this.transaction.datePickerSelectionMode=this.DATE_SELECTOR_MODES.SINGLE,this.transaction.frequency=this.FREQUENCY_MODE_CONSTANTS.DAILY,this.transaction.isRecurring=!1,this.transaction.datePickerMinDate=this.TODAY_IN_EST.clone(),this.transaction.datePickerMaxDate=this.TODAY_IN_EST.clone().add(1,"years"),this.modalType){case this.MODAL_TYPES.INVESTMENTS_BUY:case this.MODAL_TYPES.INVESTMENTS_SELL:this._setTransactionStartDate(this.BusinessDaysService.add(this.TODAY_IN_EST.clone(),5));break;default:this.transaction.scheduledStartDate||this._setTransactionStartDate(this.TODAY_IN_EST.clone().add(1,"days")),this.transaction.scheduledEndDate=null}switch(this.excludeDailyFrequency=!0,t){case this.TIME_STATES.WHEN.NOW:this._setTransactionStartDate((0,f.default)()),this.moveTo(this.STATES.AMOUNT);break;case this.TIME_STATES.WHEN.LATER:this.transaction.hideModeSelector=!0,this.gotoNextState();break;case this.TIME_STATES.WHEN.ONGOING:if(this.transaction.isRecurring=!0,this.transaction.hideModeSelector=!1,this.transaction.frequency=this.FREQUENCY_MODE_CONSTANTS.NONE,this.transaction.datePickerSelectionMode=this.DATE_SELECTOR_MODES.INDEFINITE,this.transaction.datePickerMaxDate=this.TODAY_IN_EST.clone().add(1e5,"years"),this._setTransactionEndDate(this.TODAY_IN_EST.clone().add(1,"months")),this.isCreditCardPayment)this.transaction.frequency=this.FREQUENCY_MODE_CONSTANTS.MONTHLY,this.transaction.datePickerSelectionMode=this.DATE_SELECTOR_MODES.INDEFINITE,this.CC_DETAILS.next_payment_due_date&&this._setTransactionStartDate((0,f.default)(this.CC_DETAILS.next_payment_due_date)),this.moveTo(this.STATES.AMOUNT);else if(this.MODAL_TYPES.INVESTMENTS_BUY===this.modalType){var e=this.BUY_FUNDS_DATE_RESTRICTIONS.MIN,n={datePickerMinDate:f.default.utc().add(e,"d"),datePickerMaxDate:f.default.utc().add(1e5,"years")};(0,s.default)(this.transaction,{frequency:this.FREQUENCY_MODE_CONSTANTS.NONE,datePickerSelectionMode:this.DATE_SELECTOR_MODES.RANGE,scheduledStartDate:n.datePickerMinDate},n),this.gotoNextState()}else this._isDefaultModal()?(this.excludeDailyFrequency=!1,this.gotoNextState()):this.gotoNextState()}}},{key:"onButtonClick",value:function(t){switch(t.type){case this.BUTTON_TYPES.RESTART:this.onButtonClickRestart();break;case this.BUTTON_TYPES.BUY:case this.BUTTON_TYPES.SELL:case this.BUTTON_TYPES.CONFIRM:case this.BUTTON_TYPES.SUBMIT:this.onButtonClickSubmit();break;case this.BUTTON_TYPES.CONTINUE:this.gotoNextState();break;case this.BUTTON_TYPES.BACK:this.onButtonClickBack();break;default:(0,d.default)(e.prototype.__proto__||(0,o.default)(e.prototype),"onButtonClick",this).call(this,t)}}},{key:"onButtonClickRestart",value:function(){}},{key:"onButtonClickBack",value:function(){if(this.currentState===this.STATES.TO&&(this.transaction.toAccount=[]),this.holdLink=!1,((this.modalType===this.MODAL_TYPES.EDIT||this.isEditMode)&&this.currentState===this.STATES.DATE&&!this.isEditASP||this.isEditMode&&this.currentState===this.STATES.AMOUNT&&this.isCCOngoingMonthly)&&(this.hideWarning(),this.onButtonClickCancel()),this.isOnBoarding)switch(this.currentState){case this.STATES.AMOUNT:this.moveBackTo(this.STATES.FROM);break;case this.STATES.REVIEW:this.moveBackTo(this.STATES.AMOUNT);break;default:(0,d.default)(e.prototype.__proto__||(0,o.default)(e.prototype),"onButtonClickBack",this).call(this)}else(0,d.default)(e.prototype.__proto__||(0,o.default)(e.prototype),"onButtonClickBack",this).call(this)}},{key:"amountReset",value:function(t){this.transaction.amount=t,this.BUTTONS.BTN_ORG.disable=!1}},{key:"amountChanged",value:function(t,e){var n=t;this.transaction.shouldPrePopulateAmount&&!n&&(n=this.transaction.originalAmount,this.transaction.shouldPrePopulateAmount=!1),n&&(this.transaction.amount=Math.abs(n),this.BUTTONS.BTN_ORG.disable=!this.isValidAmount(this.transaction.amount),(this.withdrawalHelper.isActive()||this.isFromRSP)&&this.withdrawalHelper.calculateSecondAmount(),e&&(this.$log.debug("received",e,"as currency type"),this.transaction.currency=e))}},{key:"onDateChanged",value:function(t){this.transaction.numTransactions=t||0,this.transaction.when===this.TIME_STATES.WHEN.ONGOING&&(this.BUTTONS.BTN_ORG.disable=!this.hasFrequency)}},{key:"isValidAmount",value:function(t){var e=1;return this.transaction.when===this.TIME_STATES.WHEN.ONGOING&&(e=10),this.isCreditCardPayment&&(e=.01),this.transaction.when===this.TIME_STATES.WHEN.ONGOING&&this.modalType===this.MODAL_TYPES.INVESTMENTS_BUY?e=25:this.transaction.when===this.TIME_STATES.WHEN.NOW&&this.modalType===this.MODAL_TYPES.INVESTMENTS_BUY?e=25:this.modalType===this.MODAL_TYPES.INVESTMENTS_SELL?e=10:this.modalType===this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL&&(e=10),t&&t>=e}},{key:"minimumAmountMessage",value:function(){return this.transaction.when===this.TIME_STATES.WHEN.ONGOING&&this.modalType===this.MODAL_TYPES.INVESTMENTS_BUY?this.$translate.instant("moveMoney.warning.minimumInvestmentBuyOngoingAmount"):this.transaction.when===this.TIME_STATES.WHEN.NOW&&this.modalType===this.MODAL_TYPES.INVESTMENTS_BUY?this.$translate.instant("moveMoney.warning.minimumInvestmentBuyNowAmount"):this.modalType===this.MODAL_TYPES.INVESTMENTS_SELL||this.modalType===this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL?this.$translate.instant("moveMoney.warning.minimumInvestmentSellAmount"):this.transaction.when===this.TIME_STATES.WHEN.ONGOING?this.$translate.instant("moveMoney.warning.minimumOngoingAmount"):this.isCreditCardPayment?this.$translate.instant("moveMoney.warning.minimumCreditCardAmount"):this.$translate.instant("moveMoney.warning.minimumAmount")}},{key:"setAmountFocus",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isAmountFocus=t}},{key:"_getWhenStateData",value:function(){var t=this.$q.defer(),e=(0,s.default)({},this.transaction.fromAccount[0]),n=(0,s.default)({},this.transaction.toAccount[0]),i=[{data:e},{data:n}];switch(this.modalType){case this.MODAL_TYPES.INVESTMENTS_BUY:i[0].tileDescription=this.$translate.instant("moveMoney.accountTile.from.title.investmentsBuy"),(0,s.default)(i[1],{tileDescription:this.$translate.instant("moveMoney.accountTile.to.title.investmentsBuy"),extraTitle:this.$translate.instant("moveMoney.accountTile.portfolio"),extraDescription:this.getMfPortfolioName()}),this.setPortfolioPageUrl(i[1].extraDescription);break;case this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL:case this.MODAL_TYPES.INVESTMENTS_SELL:(0,s.default)(i[0],{tileDescription:this.$translate.instant("moveMoney.accountTile.from.title.investmentsSell"),extraTitle:this.$translate.instant("moveMoney.accountTile.portfolio"),extraDescription:this.getMfPortfolioName()}),i[1].tileDescription=this.$translate.instant("moveMoney.accountTile.to.title.investmentsSell"),this.setPortfolioPageUrl(i[0].extraDescription);break;default:i[0].tileDescription=this.$translate.instant("moveMoney.accountTile.from.title.default"),i[1].tileDescription=this.$translate.instant("moveMoney.accountTile.to.title.default")}e.type!==this.ACCOUNT_TYPES.CREDIT_CARD&&e.type!==this.ACCOUNT_TYPES.LOAN||(i[0].amount=e.amount),n.type===this.ACCOUNT_TYPES.LOAN&&(i[1].amount=n.amount);var a=[];if(this.transaction.when===this.TIME_STATES.WHEN.NOW)a.push(this.$translate.instant("global.commonWords.now")),t.resolve([i,a]);else if(this.isCCOngoingMonthly){var r=new this.MultiLineDateTile;r.top=this._getWhenStateFrequencyTileTop(),r.middle=this.$translate.instant("moveMoney.whentiles.recurring"),a.push(r.toAccountTileObject()),t.resolve([i,a])}else if(this.transaction.when===this.TIME_STATES.WHEN.LATER)a.push((0,f.default)(this.transaction.scheduledStartDate)),t.resolve([i,a]);else if(this.transaction.when===this.TIME_STATES.WHEN.ONGOING){var o=new this.MultiLineDateTile;o.top=this._getWhenStateFrequencyTileTop(),o.middle=this._getWhenStateFrequencyTileMiddle(),o.bottom=this._getWhenStateFrequencyTileBottom(),a.push(o.toAccountTileObject()),t.resolve([i,a])}else t.reject("unrecognized this.transaction.when:",this.transaction.when);return t.promise}},{key:"_getFormattedFrequency",value:function(){return this.$translate.instant("moveMoney.dateTileFrequencies."+this.transaction.frequency)}},{key:"_getWhenStateFrequencyTileTop",value:function(){var t=this._getFormattedFrequency();return this.$translate.instant("moveMoney.dateTile.ongoing.top",{frequency:t})}},{key:"_getWhenStateFrequencyTileMiddle",value:function(){return this.$translate.instant("moveMoney.dateTile.ongoing.middle",{startDate:this.DateService.momentToServerFormat(this.transaction.scheduledStartDate)})}},{key:"_getWhenStateFrequencyTileBottom",value:function(){return this.transaction.scheduledEndDate?this.$translate.instant("moveMoney.dateTile.ongoing.bottom",{endDate:this.DateService.momentToServerFormat(this.transaction.scheduledEndDate)}):""}},{key:"getReviewData",value:function(){var t={date:"",fromName:"",portfolioName:"",toName:"",amountTileData:[{amount1:null,currency1:"",amount2:null,currency2:""}],totalNumTrans:0,recurringTotalAmount:0,ccRecurringi18nDescString:"",ccRecurringPaymentDay:""};if(this._setReviewAccountName("fromName",this.transaction.fromAccount[0]),this._setReviewAccountName("toName",this.transaction.toAccount[0]),this.isCrossCurrency){t.amountTileData[0].currency1=this.CURRENCY_TYPES.CAD,t.amountTileData[0].currency2=this.CURRENCY_TYPES.USD;var e=this.transaction.amount,n=this.transaction.fromAccount[0].currency_type,i=this.CurrencyService.isCanadian(n)?this.CURRENCY_TYPES.USD:this.CURRENCY_TYPES.CAD,a=void 0,s=void 0;this._conversionRate=this.currencyExchangeService.getDisplayRate(n,i),this.CurrencyService.isCanadian(n)?n===this.transaction.currency?(a=e,s=e/this._conversionRate):(a=e*this._conversionRate,s=e):n===this.transaction.currency?(a=e*this._conversionRate,s=e):(a=e,s=e/this._conversionRate),t.amountTileData[0].amount1=a,t.amountTileData[0].amount2=s}else t.amountTileData[0].amount1=this.transaction.amount,!this.withdrawalHelper.isActive()&&!this.isFromRSP||this.hasPredefinedGoalModalType?this.hasUsdCurrency&&(t.amountTileData[0].currency1=this.CURRENCY_TYPES.USD):(t.amountTileData[0].amount1=this.withdrawalHelper.getBeforeTaxAmount(),t.amountTileData[0].amount2=this.withdrawalHelper.getAfterTaxAmount(),t.amountTileData[0].currency2=this.$translate.instant("moveMoney.amountState.afterTax").toLowerCase());switch(this.transaction.when===this.TIME_STATES.WHEN.LATER?t.date=this._getReviewDate():this.transaction.when===this.TIME_STATES.WHEN.ONGOING&&(t.startDate=this.DateService.convertToFormattedMonthDayYear((0,f.default)(this.transaction.scheduledStartDate)),t.endDate=this.DateService.convertToFormattedMonthDayYear((0,f.default)(this.transaction.scheduledEndDate)),this.isCCOngoingMonthly?(t.ccRecurringPaymentDay=this.DateService.convertToOrdinalDay((0,f.default)(this.transaction.scheduledStartDate)),this.transaction.payment_indicator===this.PAYMENT_INDICATOR.MINIMUM_PAYMENT?(t.ccRecurringi18nDescString="moveMoney.reviewState.descCCPayMinimum",t.amountTileData=[this.RECURRING_CC_BUTTONS.MINIMUM]):this.transaction.payment_indicator===this.PAYMENT_INDICATOR.FULL_BALANCE&&(t.ccRecurringi18nDescString="moveMoney.reviewState.descCCPayFull",t.amountTileData=[this.RECURRING_CC_BUTTONS.FULL])):(t.numTransactions=this.transaction.numTransactions,t.recurringTotalAmount=this.transaction.amount*this.transaction.numTransactions)),null!==t.amountTileData[0].amount1&&void 0!==t.amountTileData[0].amount1&&(t.amountTileData[0].amount1=t.amountTileData[0].amount1.toString()),null!==t.amountTileData[0].amount2&&void 0!==t.amountTileData[0].amount2&&(t.amountTileData[0].amount2=t.amountTileData[0].amount2.toString()),this.modalType){case this.MODAL_TYPES.INVESTMENTS_BUY:case this.MODAL_TYPES.INVESTMENTS_SELL:case this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL:t.portfolioName=this.getMfPortfolioName()}return t.frequency=this._getFormattedFrequency(),this.$log.debug("reviewData:",t),t}},{key:"getFormattedConfirmationData",value:function(t,e,n){var i=this,a=t.fromAccount[0],r=t.toAccount[0],o=((this.isFromExternal()||this.isToExternal())&&this.isNowTransaction?e.txnDate:e.actualEffectiveDate)||t.scheduledStartDate.format("YYYY-MM-DD"),c={confirmationNumber:e.confirmation.confirmation_code,date:o,time:e.txnTime,amount:t.amount,currency:t.currency,frequency:t.frequency,fromNewBalance:0,toNewBalance:0,fromAccount:a,toAccount:r,isCrossCurrency:this.isCrossCurrency,exchangeRate:e.exchangeRate,toAcctCCAvailableCredit:null};switch(c.isCrossCurrency&&(c.amountConverted=e.exchangedAmount,t.currency===a.currency_type?c.currencyConverted=r.currency_type:c.currencyConverted=a.currency_type),t.payment_indicator&&(c.payment_indicator=t.payment_indicator),n.accounts.forEach((function(e){e.display_name===a.display_name?(c.fromNewBalance=e.account_balance,e.type===i.ACCOUNT_TYPES.LOAN&&(c.fromAvailableCredit=e.available_balance),e.type===i.ACCOUNT_TYPES.CREDIT_CARD&&i.AccountService.getAccountDetails(a.number,e.type).then((function(t){return c.fromAvailableCashAdvance=t.account_summary.credit_card.cc_account_details.card_details.cash_advance_available})).catch((function(t){i.$log.error("Could not retrieve account details:",t)}))):e.display_name===r.display_name&&(c.toNewBalance=e.account_balance,e.type===i.ACCOUNT_TYPES.CREDIT_CARD&&i._isNow(t)&&i.AccountService.getAccountDetails(r.number,e.type).then((function(t){t.account_summary&&t.account_summary.credit_card&&t.account_summary.credit_card.cc_account_details&&t.account_summary.credit_card.cc_account_details.card_details&&(c.toAcctCCAvailableCredit=t.account_summary.credit_card.cc_account_details.card_details.available_credit)})).catch((function(t){i.$log.error("Could not retrieve CC account details:",t)})))})),this.modalType){case this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL:(0,s.default)(c,{date:e.transaction_date,withHoldingPercentage:e.withHoldingPercentage,withHoldingAmount:e.withHoldingAmount})}return this.$log.debug("formattedData:",c),c}},{key:"_getReviewDate",value:function(){if(this.transaction.when&&this.transaction.scheduledStartDate&&this.transaction.when===this.TIME_STATES.WHEN.LATER)return this.DateService.convertToFormattedMonthDayYear(this.transaction.scheduledStartDate);return""}},{key:"_setReviewAccountName",value:function(t,e){var n=this;e&&this.accountHelpersService.getDisplayName(e).then((function(e){n.reviewData[t]=e}))}},{key:"showSubmitErrors",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$log.debug("formatting errors:",e);var n="";if(angular.isDefined(e.response_status))if("details"in e.response_status&&Array.isArray(e.response_status.details))e.response_status.details.forEach((function(e,i){if(i>0&&(n+="<br>"),e.details_code===t.DETAIL_CODES.START_DATE_IN_THE_PAST){var a=t.$translate.instant("moveMoney.warning.pastDate");n=n+" "+a}else if("AMOUNT_EXCEEDS_HOLDING_BALANCE"===e.details_code)n=t.$translate.instant("global.errorCodes.AMOUNT_EXCEEDS_HOLDING_BALANCE");else if("INSUFFICIENT_ACCOUNT_BALANCE"===e.details_code)n=t.$translate.instant("global.errorCodes.INSUFFICIENT_ACCOUNT_BALANCE");else if(e.details_code===t.DETAIL_CODES.MESSAGE_33944){var s=t.$translate.instant("moveMoney.warning.maxAmount");n=n+" "+s}else n=e.details_code===t.DETAIL_CODES.INVALID&&e.technical_description===t.TECHNICAL_DESCRIPTIONS.MISSING_OWNERSHIP?t.ERROR_MESSAGES.MISSING_OWNERSHIP:e.details_code?"global.errorCodes."+e.details_code:""+n+e.technical_description})),this.$log.debug("formatted submission errors:",n),this.submitErrors=n.trim();else{switch(e.response_status.status_code){case this.STATUS_CODES.ACC_TRANSACTION_MINAMT:this.submitErrors=this.ERROR_MESSAGES.MINAMT;break;case this.STATUS_CODES.DUPLICATE_TRANSACTION:this.submitErrors="",this.isDuplicateTrans=!0,this.BUTTONS.BTN_ORG.disable=!1;break;case this.STATUS_CODES.NON_BUSINESS_START_DATE:this.submitErrors=this.ERROR_MESSAGES.NON_BUSINESS_START_DATE;break;case this.STATUS_CODES.CARD_PAUSED:this.submitErrors="global.errorCodes."+e.response_status.status_code;break;default:this.submitErrors=this.AnalyticsService.getMsgForErrCode(e.response_status.return_code)}this.$log.debug("showing errors:",this.submitErrors)}else this.submitErrors=e.error_message||e.errorMessage,this.$log.debug("unexpected response structure, showing raw error message:",this.submitErrors);this.exitLoadingMode()}},{key:"setStepNumber",value:function(t){if(this.isOnBoarding){var e=void 0;switch(t){case this.STATES.FROM:e=0;break;case this.STATES.AMOUNT:e=1;break;case this.STATES.REVIEW:e=2}this.currentStepNumber=this.baseStepNumber+e}}},{key:"resetSubmitErrors",value:function(){this.$log.debug("resetting submit errors"),this.submitErrors="",this.showAvailBalanceError=!1,this.showAmountGreaterThanAvail=!1,this.validationError=!1}},{key:"_preMoveTo",value:function(){this.$log.debug("_preMoveTo"),this._resetCustomModalTitle()}},{key:"_preMoveBackTo",value:function(){this.$log.debug("_preMoveBackTo"),this.resetSubmitErrors(),this._resetCustomModalTitle()}},{key:"postMoveTo",value:function(){this.$log.debug("postMoveTo"),this.isOnBoarding&&(this.hideWarning(),this.setStepNumber(this.currentState)),this.$timeout((function(){var t=document.querySelector('input[name="amount-input"]');t&&t.focus()}),100)}},{key:"postMoveBackTo",value:function(){this.isOnBoarding&&(this.resetSubmitErrors(),this.hideWarning(),this.setStepNumber(this.currentState))}},{key:"_preGotoPreviousState",value:function(){this.resetSubmitErrors(),this.$log.debug("_preGotoPreviousState"),this._resetCustomModalTitle()}},{key:"moveBackToWhen",value:function(){this.transaction.when===this.TIME_STATES.WHEN.NOW?this.moveBackTo(this.STATES.WHEN):this.moveBackTo(this.STATES.DATE)}},{key:"moveBackToAmount",value:function(){this.resetSubmitErrors(),this.moveBackTo(this.STATES.AMOUNT)}},{key:"_isTimeState",value:function(t){return this.transaction.when===t}},{key:"handleRecurringCCTileClick",value:function(t){t<1?(this.transaction.payment_indicator=this.PAYMENT_INDICATOR.FULL_BALANCE,this.amountChanged(this.CC_DETAILS.current_balance)):(this.transaction.payment_indicator=this.PAYMENT_INDICATOR.MINIMUM_PAYMENT,this.amountChanged(this.CC_DETAILS.minimum_payment)),this.gotoNextState()}},{key:"_setTransactionStartDate",value:function(t){this.transaction.scheduledStartDate=t,this.transaction.datePickerMinDate=(0,f.default)(t)}},{key:"_setTransactionEndDate",value:function(t){this.transaction.scheduledEndDate=t}},{key:"_resetCustomModalTitle",value:function(){this.$log.debug("resetting custom modal title"),this.customCurrentStateTitle=""}},{key:"_isAccountType",value:function(t,e){return"object"===(void 0===t?"undefined":(0,i.default)(t))&&null!==t&&"type"in t&&t.type===e}},{key:"_isDefaultModal",value:function(){return this.isModalType(this.MODAL_TYPES.DEFAULT)}},{key:"_isTFSAAccount",value:function(t){var e=this._isAccountType(t,this.ACCOUNT_TYPES.SAVINGS),n=this._isAccountType(t,this.ACCOUNT_TYPES.MUTUAL_FUND);return(e||n)&&t.tax_free}},{key:"_isRSPAccount",value:function(t){var e=this._isAccountType(t,this.ACCOUNT_TYPES.SAVINGS),n=this._isAccountType(t,this.ACCOUNT_TYPES.MUTUAL_FUND);return(e||n)&&!t.tax_free&&t.registered}},{key:"_isRIFAccount",value:function(t){var e=this._isAccountType(t,this.ACCOUNT_TYPES.OTHER),n=this._isAccountType(t,this.ACCOUNT_TYPES.MUTUAL_FUND);return(e||n)&&!t.tax_free&&t.registered}},{key:"_isToAccountKickStartTFSA",value:function(){return this.profile_product_type===this.accountConstants.ACCOUNT_PPTS.TFSAKS}},{key:"hasPredefinedToAccount",value:function(){return-1!==this.TYPES_WITH_PREDEFINED_TO_ACCOUNT.indexOf(this.modalType)||this.isOnBoarding}},{key:"hasPredefinedFromAccount",value:function(){return-1!==this.TYPES_WITH_PREDEFINED_FROM_ACCOUNT.indexOf(this.modalType)}},{key:"getPageTitleTransKey",value:function(){return this.currentState.customTitleKey&&this.currentState.customTitleKey[this.modalType]?this.currentState.customTitleKey[this.modalType]:this.currentState.titleKey}},{key:"isModalType",value:function(t){return this.modalType===t}},{key:"getWithdrawnPercentage",value:function(){switch(this.modalType){case this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL:return this.withdrawalHelper.getBeforeTaxAmount()/this.transaction.fromAccount[0].available_balance*100;case this.MODAL_TYPES.INVESTMENTS_SELL:var t=this.transaction.fromAccount[0].available_balance||this.transaction.fromAccount[0].account_balance;return this.transaction.amount/t*100;default:return 0}}},{key:"getMfPortfolioName",value:function(){switch(this.modalType){case this.MODAL_TYPES.INVESTMENTS_BUY:case this.MODAL_TYPES.INVESTMENTS_SELL:case this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL:var t=(0,p.default)(this.pendingTransaction,"mutual_fund.portfolio_name","");if(!t){var e=this.ACCOUNT_DETAILS.mutual_fund.holdings.find((function(t){return t.units>0}));if(e)t=e.portfolio_name;else{var n=this.ACCOUNT_DETAILS.mutual_fund.holdings.find((function(t){return/Tangerine/.test(t.portfolio_name)}));n&&(t=n.portfolio_name)}}return t;default:return""}}},{key:"isFromExternal",value:function(){return this.transaction.fromAccount[0].type===this.ACCOUNT_TYPES.EXT}},{key:"isToExternal",value:function(){return this.transaction.toAccount[0].type===this.ACCOUNT_TYPES.EXT}},{key:"_getAnalyticsID",value:function(){return"movemoney"}},{key:"isAfterTaxDisabled",value:function(){return!this.withdrawalHelper.isAmountNetType()&&this.transaction.fromAccount[0].available_balance<this.transaction.amount}},{key:"_isNow",value:function(t){return!!t&&("when"in t&&t.when===this.TIME_STATES.WHEN.NOW)}},{key:"setBuyFundsHasBorrowedMoney",value:function(t){this._buyFundsHasBorrowedMoney=t}},{key:"setBorrowedMoneyFrom",value:function(t){this._borrowedMoneyFrom=t}},{key:"setBorrowedMoneyAgreement",value:function(t){this._borrowedMoneyAgreementAccepted=!!t}},{key:"handleNativeBackClick",value:function(){return this.isDoneButtonVisible?this.onButtonClickDone():this.isCancelButtonVisible?this.onButtonClickCancel():this.onButtonClickBack(),!0}},{key:"deactivate",value:function(){(0,d.default)(e.prototype.__proto__||(0,o.default)(e.prototype),"deactivate",this).call(this)}},{key:"setPortfolioPageUrl",value:function(t){switch(this.PORTFOLIO_NAMES_ENGLISH=this.InvestmentFundConstants.PORTFOLIO_NAMES_ENGLISH,this.PORTFOLIO_NAMES_FRENCH=this.InvestmentFundConstants.PORTFOLIO_NAMES_FRENCH,this.PORTFOLIO_TYPE_PARAMS=this.InvestmentFundConstants.PORTFOLIO_TYPE_PARAMS,this.marketingUrl=this.EnvironmentService.getBaseUrl(),t){case this.PORTFOLIO_NAMES_ENGLISH.BALANCED_INCOME_PORTFOLIO:case this.PORTFOLIO_NAMES_FRENCH.BALANCED_INCOME_PORTFOLIO:this.portfolioUrl=this.marketingUrl+this.$translate.instant("moveMoney.defaultInvestmentUrl")+this.PORTFOLIO_TYPE_PARAMS.BALANCED_INCOME;break;case this.PORTFOLIO_NAMES_ENGLISH.BALANCED_PORTFOLIO:case this.PORTFOLIO_NAMES_FRENCH.BALANCED_PORTFOLIO:this.portfolioUrl=this.marketingUrl+this.$translate.instant("moveMoney.defaultInvestmentUrl")+this.PORTFOLIO_TYPE_PARAMS.BALANCED;break;case this.PORTFOLIO_NAMES_ENGLISH.BALANCED_GROWTH_PORTFOLIO:case this.PORTFOLIO_NAMES_FRENCH.BALANCED_GROWTH_PORTFOLIO:this.portfolioUrl=this.marketingUrl+this.$translate.instant("moveMoney.defaultInvestmentUrl")+this.PORTFOLIO_TYPE_PARAMS.BALANCED_GROWTH;break;case this.PORTFOLIO_NAMES_ENGLISH.DIVIDEND_PORTFOLIO:case this.PORTFOLIO_NAMES_FRENCH.DIVIDEND_PORTFOLIO:this.portfolioUrl=this.marketingUrl+this.$translate.instant("moveMoney.defaultInvestmentUrl")+this.PORTFOLIO_TYPE_PARAMS.DIVIDEND;break;case this.PORTFOLIO_NAMES_ENGLISH.EQUITY_GROWTH_PORTFOLIO:case this.PORTFOLIO_NAMES_FRENCH.EQUITY_GROWTH_PORTFOLIO:this.portfolioUrl=this.marketingUrl+this.$translate.instant("moveMoney.defaultInvestmentUrl")+this.PORTFOLIO_TYPE_PARAMS.EQUITY_GROWTH;break;default:this.LocaleService.localeDisplay,this.portfolioUrl=this.marketingUrl+this.$translate.instant("moveMoney.defaultInvestmentUrl")}}},{key:"isCancelButtonVisible",get:function(){return this.BUTTONS.BTN_GRY.type===this.BUTTON_TYPES.CANCEL&&this.BUTTONS.BTN_GRY.show}},{key:"isDoneButtonVisible",get:function(){return this.BUTTONS.BTN_ORG.type===this.BUTTON_TYPES.DONE&&this.BUTTONS.BTN_ORG.show}},{key:"isCrossCurrency",get:function(){if(this.transaction.fromAccount[0]&&this.transaction.toAccount[0]&&this.modalType!==this.MODAL_TYPES.RSP_RIF_SAVING_WITHDRAWAL){var t=this.transaction.fromAccount[0],e=this.transaction.toAccount[0];if(t.currency_type!==e.currency_type)return!0}return!1}},{key:"hasUsdCurrency",get:function(){return!(!this.transaction.fromAccount[0]||this.CurrencyService.isCanadian(this.transaction.fromAccount[0].currency_type))||!(!this.transaction.toAccount[0]||this.CurrencyService.isCanadian(this.transaction.toAccount[0].currency_type))}},{key:"isDisplayCurrencySign",get:function(){if(this.isCrossCurrency)return!0;if(this.transaction.fromAccount[0]&&this.transaction.toAccount[0]){var t=this.transaction.fromAccount[0];return!this.CurrencyService.isCanadian(t.currency_type)}return!1}},{key:"isCreditCardPayment",get:function(){return!!this.transaction.toAccount[0]&&this.transaction.toAccount[0].type===this.ACCOUNT_TYPES.CREDIT_CARD}},{key:"isCreditPayment",get:function(){return this.transaction.toAccount.length>0&&this.transaction.toAccount[0].type===this.ACCOUNT_TYPES.LOAN}},{key:"isFullBalanceAvailable",get:function(){return this.transaction.when===this.TIME_STATES.WHEN.NOW}},{key:"isCashAdvance",get:function(){return!!this.transaction.fromAccount[0]&&this.transaction.fromAccount[0].type===this.ACCOUNT_TYPES.CREDIT_CARD}},{key:"cashAdvanceFee",get:function(){return this.transaction.fromAccount[0].cash_advance_fee_CA}},{key:"isCCOngoingMonthly",get:function(){return!!this.isCreditCardPayment&&(this.transaction.isRecurring&&this.transaction.frequency===this.FREQUENCY_MODE_CONSTANTS.MONTHLY)}},{key:"amountInputType",get:function(){return this.isCrossCurrency?this.AMOUNT_INPUT_TYPES.STANDARD_EXCHANGE:this.AMOUNT_INPUT_TYPES.STANDARD}},{key:"isNowTransaction",get:function(){return this._isTimeState(this.TIME_STATES.WHEN.NOW)}},{key:"isLaterTransaction",get:function(){return this._isTimeState(this.TIME_STATES.WHEN.LATER)}},{key:"isOngoingTransaction",get:function(){return this._isTimeState(this.TIME_STATES.WHEN.ONGOING)}},{key:"isIndefiniteOngoingTransaction",get:function(){return this.isOngoingTransaction&&this.transaction.datePickerSelectionMode===this.DATE_SELECTOR_MODES.INDEFINITE}},{key:"isCCOngoingMonthlyTransaction",get:function(){return this.isCCOngoingMonthly}},{key:"hasFrequency",get:function(){return!!this.transaction.frequency&&this.transaction.frequency!==this.FREQUENCY_MODE_CONSTANTS.NONE}},{key:"isToTFSA",get:function(){var t=this.transaction.toAccount.length>0&&this._isTFSAAccount(this.transaction.toAccount[0]);return(!t||!this._isToAccountKickStartTFSA())&&t}},{key:"isToTFSAMF",get:function(){return this.capabilitiesArray.indexOf(this.userConstants.USER.CAPABILITIES.PRE_TFS_ENROLL)>=0&&this._isTFSAAccount(this.transaction.toAccount[0])}},{key:"hasTFSAKSCapability",get:function(){return this.isToTFSAMF}},{key:"showFundWarning",get:function(){return this.isModalType(this.MODAL_TYPES.INVESTMENTS_BUY)}},{key:"isToRSP",get:function(){return this.transaction.toAccount.length>0&&this._isRSPAccount(this.transaction.toAccount[0])}},{key:"isFromRSP",get:function(){return!!(this.transaction&&this.transaction.fromAccount&&this.transaction.fromAccount.length>0)&&this._isRSPAccount(this.transaction.fromAccount[0])}},{key:"isFromRIF",get:function(){return this.transaction.fromAccount.length>0&&this._isRIFAccount(this.transaction.fromAccount[0])}},{key:"isFromTFSA",get:function(){return this.transaction.fromAccount.length>0&&this._isTFSAAccount(this.transaction.fromAccount[0])}},{key:"isFromRSPMutualFund",get:function(){return this.transaction.fromAccount.length>0&&(this.isFromRSP&&this._isAccountType(this.transaction.fromAccount[0],this.ACCOUNT_TYPES.MUTUAL_FUND))}},{key:"isToRSPMutualFund",get:function(){return this.transaction.toAccount.length>0&&(this.isToRSP&&this._isAccountType(this.transaction.toAccount[0],this.ACCOUNT_TYPES.MUTUAL_FUND))}},{key:"isToRSPSavings",get:function(){return this.transaction.toAccount.length>0&&(this.isToRSP&&this._isAccountType(this.transaction.toAccount[0],this.ACCOUNT_TYPES.SAVINGS))}},{key:"isFromRSPSavings",get:function(){return this.transaction.fromAccount.length>0&&(this.isFromRSP&&this._isAccountType(this.transaction.fromAccount[0],this.ACCOUNT_TYPES.SAVINGS))}},{key:"isExternalPayment",get:function(){return this.isFromExternal()||this.isToExternal()}},{key:"isEditASP",get:function(){return Boolean(this.isEditMode&&this.pendingTransaction&&(this.pendingTransaction.asp||this.pendingTransaction.type===this.ACCOUNT_TYPES.ASP))}},{key:"isEditMFASP",get:function(){return Boolean(this.isEditASP&&this.pendingTransaction.mutual_fund)}},{key:"showNonRegCopy",get:function(){return!this.transaction.fromAccount[0].registered}},{key:"showTaxCopy",get:function(){return this.transaction.fromAccount[0].registered}},{key:"buyFundsHasBorrowedMoney",get:function(){return this._buyFundsHasBorrowedMoney}},{key:"borrowedMoneyFrom",get:function(){return this._borrowedMoneyFrom}},{key:"borrowedMoneyAgreement",get:function(){return this._borrowedMoneyAgreementAccepted}}]),e}(g.default);v.$inject=["$log","$q","$transitions","$state","$window","$translate","pageFlowConstants","AccountHelpersService","amountInputConstants","accountConstants","moveMoneyConstants","tngDateSelectorConstants","CurrencyExchangeService","CurrencyService","$rootScope","BusinessDaysService","DateService","MoveMoneyWithdrawalHelperService","AccountService","investmentConstants","MultiLineDateTile","AnalyticsService","$timeout","UserService","userConstants","AnchorService","LocaleService","EnvironmentService","stateConstants","serviceConstants","$filter","InvestmentFundConstants"],e.default=v,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(1884)),a=r(n(0)),s=r(n(2));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(e,n,i){(0,a.default)(this,t),this.moveMoneyConstants=e,this.accountConstants=n,this.AccountDetailsService=i,this.flowService=null}return(0,s.default)(t,[{key:"setFlowService",value:function(t){this.flowService=t}},{key:"isActive",value:function(){return this.isInvestmentsWithdrawal()||this.isSavingsWithdrawal()}},{key:"isSavingsWithdrawal",value:function(){return this.flowService.isModalType(this.moveMoneyConstants.MODAL_TYPES.RSP_RIF_SAVING_WITHDRAWAL)}},{key:"isInvestmentsWithdrawal",value:function(){return this.flowService.isModalType(this.moveMoneyConstants.MODAL_TYPES.INVESTMENTS_WITHDRAWAL)}},{key:"calculateSecondAmount",value:function(){var t=this.flowService.transaction.amount,e=0;if(this.flowService.transaction.withdrawal.taxRates.length){var n=this.getTaxRate(this.isAmountNetType()&&this.flowService.transaction.withdrawal.secondAmount?this.flowService.transaction.withdrawal.secondAmount:t);e=this.isAmountNetType()?this._calculatePreTaxAmount(t,n):this._calculatePostTaxAmount(t,n);var i=this.flowService.transaction.fromAccount[0].available_balance;e&&e>i&&(e=i,this.flowService.transaction.amount=this.setAmountTruncate(this._calculatePostTaxAmount(i,n),!0))}this.flowService.transaction.withdrawal.secondAmount=this.setAmountTruncate(e,!1)}},{key:"getTaxRate",value:function(t){return this.flowService.transaction.withdrawal.taxRates.find((function(e){return e.lower_bound<=t&&(!e.upper_bound||e.upper_bound>=t)})).rate}},{key:"_calculatePreTaxAmount",value:function(t,e){t<0&&(t*=-1);var n=this._calculateUntaxedAmount(t);return(t-n)/(1-e)+n}},{key:"_calculatePostTaxAmount",value:function(t,e){t<0&&(t*=-1);var n=this._calculateUntaxedAmount(t);return(t-n)*(1-e)+n}},{key:"_calculateUntaxedAmount",value:function(t){t<0&&(t*=-1);var e=this.flowService.transaction.withdrawal.roomWithNoTaxWithholding;return t<e?t:e}},{key:"setAmountTruncate",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=e?(0,i.default)(t+"e+"+n):Math.round(t+"e+"+n);return+(a+"e-"+n)}},{key:"getAmountNoteTransKey",value:function(){return this.isInvestmentsWithdrawal()?"moveMoney.amountState.note.investmentsWithdrawal":this.flowService.transaction.fromAccount[0].type===this.accountConstants.ACCOUNT_TYPES.SAVINGS?"moveMoney.amountState.note.rspRifSavingWithdrawalRSP":"moveMoney.amountState.note.rspRifSavingWithdrawalRIF"}},{key:"setAmountType",value:function(t){this.flowService.transaction.withdrawal.amountType!==t&&(this.flowService.transaction.withdrawal.amountType=t,this.flowService.transaction.amount="",this.flowService.BUTTONS.BTN_ORG.disable=!0,this.calculateSecondAmount())}},{key:"isAmountNetType",value:function(){return this.flowService.transaction.withdrawal.amountType===this.moveMoneyConstants.RSP_AMOUNT_TYPES.NET}},{key:"getBeforeTaxAmount",value:function(){return this.isAmountNetType()?this.flowService.transaction.withdrawal.secondAmount:this.flowService.transaction.amount}},{key:"getAfterTaxAmount",value:function(){return this.isAmountNetType()?this.flowService.transaction.amount:this.flowService.transaction.withdrawal.secondAmount}},{key:"getReviewNoteTransKey",value:function(){return this.isInvestmentsWithdrawal()?"":this.flowService.transaction.fromAccount[0].type===this.accountConstants.ACCOUNT_TYPES.SAVINGS?"moveMoney.reviewState.rspRifSavingWithdrawal.noteRSP":"moveMoney.reviewState.rspRifSavingWithdrawal.noteRIF"}}]),t}();o.$inject=["moveMoneyConstants","accountConstants","AccountDetailsService"],e.default=o,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5447)),a=s(n(5448));function s(t){return t&&t.__esModule?t:{default:t}}n(5449);var r={template:i.default,controller:a.default,bindings:{}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-date-state"> <tng-date-selector selected-date="$ctrl.flowService.transaction.scheduledStartDate" start-date="$ctrl.flowService.transaction.scheduledStartDate" end-date="$ctrl.flowService.transaction.scheduledEndDate" min-date="$ctrl.flowService.transaction.datePickerMinDate" max-date="$ctrl.flowService.transaction.datePickerMaxDate" hide-selection-mode-selector="$ctrl.flowService.transaction.hideModeSelector" hide-frequency-selector="!$ctrl.flowService.transaction.isRecurring" selection-mode-exclude-single="true" selection-mode="$ctrl.flowService.transaction.datePickerSelectionMode" frequency="$ctrl.flowService.transaction.frequency" frequency-exclude="$ctrl.excludedFrequencies" frequency-exclude-daily="$ctrl.flowService.excludeDailyFrequency" show-next-mont-indefinitely="$ctrl.flowService.transaction.datePickerSelectionMode === \'INDEFINITE\'" on-date-change="$ctrl.flowService.onDateChanged(selectedDaysCount)"></tng-date-selector> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s){(0,i.default)(this,t),this.$log=e,this.flowService=n,this.MODAL_TYPES=a.MODAL_TYPES,this.tngDateSelectorConstants=s}return(0,a.default)(t,[{key:"$onInit",value:function(){this.excludedFrequencies=[];var t=this.tngDateSelectorConstants.FREQUENCY_MODE_CONSTANTS;switch(this.flowService.modalType){case this.MODAL_TYPES.INVESTMENTS_SELL:this.excludedFrequencies.push(t.DAILY,t.WEEKLY);break;case this.MODAL_TYPES.INVESTMENTS_BUY:default:this.excludedFrequencies.push(t.QUARTERLY,t.YEARLY)}}}]),t}();r.$inject=["$log","MoveMoneyFlowService","moveMoneyConstants","tngDateSelectorConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5451)),a=s(n(5452));function s(t){return t&&t.__esModule?t:{default:t}}n(5453);var r={template:i.default,controller:a.default,bindings:{modalType:"<",fromAccount:"<",toAccount:"<",ccAccountSummary:"<?",onNowSelect:"&",onLaterSelect:"&",onRecurringSelect:"&"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-when-state"> <div class="c-when-state__tile-list" ng-class="$ctrl.tileListCssClasses"> <tng-tile-list tile-data="$ctrl.buttonTiles" tile-type="this.TILE_TYPE.text" is-actionable="!$ctrl.isDisabled(tile, tileData)" is-disabled="$ctrl.isDisabled(tile, tileData)" on-tile-click="$ctrl.handleTileClick(index, tileData)"> </tng-tile-list> </div> <div class="c-when-state__note" ng-if="$ctrl.note"> {{ ::$ctrl.note | translate }} </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s){(0,i.default)(this,t),this.$log=e,this.TILE_TYPE=n.TILE_TYPE,this.ACCOUNT_TYPES=a.ACCOUNT_TYPES,this.MODAL_TYPES=s.MODAL_TYPES}return(0,a.default)(t,[{key:"$onInit",value:function(){switch(this.BUTTONS={NOW:{header:"moveMoney.whentiles.now",subHeader:""},LATER:{header:"moveMoney.whentiles.later",subHeader:"moveMoney.whentiles.laterDescription"},RECURRING:{header:"moveMoney.whentiles.recurring",subHeader:"moveMoney.whentiles.recurringDescription.default"}},this.note=null,this.tileListCssClasses={},this.modalType){case this.MODAL_TYPES.INVESTMENTS_BUY:this.BUTTONS.RECURRING.subHeader="moveMoney.whentiles.recurringDescription.investmentsBuy",this.buttonTiles=[this.BUTTONS.NOW,this.BUTTONS.RECURRING];break;case this.MODAL_TYPES.INVESTMENTS_SELL:this.note="moveMoney.whenState.note.investmentsSell",this.BUTTONS.RECURRING.subHeader="moveMoney.whentiles.recurringDescription.investmentsSell",this.tileListCssClasses["c-when-state__tile-list--sellFunds"]=!0,this.buttonTiles=[this.BUTTONS.NOW,this.BUTTONS.RECURRING];break;case this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL:this.buttonTiles=[this.BUTTONS.NOW,this.BUTTONS.RECURRING];break;default:this.buttonTiles=[this.BUTTONS.NOW,this.BUTTONS.LATER,this.BUTTONS.RECURRING]}this.tilesActionable=!0}},{key:"handleTileClick",value:function(t,e){switch(e){case this.BUTTONS.NOW:this.onNowSelect();break;case this.BUTTONS.LATER:this.onLaterSelect();break;case this.BUTTONS.RECURRING:this.onRecurringSelect()}}},{key:"isDisabled",value:function(t,e){var n=!1;return this.ccAccountSummary&&"credit_card"in this.ccAccountSummary&&"cc_account_details"in this.ccAccountSummary.credit_card&&"is_primary_account"in this.ccAccountSummary.credit_card.cc_account_details&&(n=this.ccAccountSummary.credit_card.cc_account_details.is_primary_account),!(!this.toAccount||!this.fromAccount)&&(!(e!==this.BUTTONS.RECURRING||(this.toAccount.type!==this.ACCOUNT_TYPES.CREDIT_CARD||n)&&!this.toAccount.HELOC)||!(e!==this.BUTTONS.LATER&&e!==this.BUTTONS.RECURRING||this.fromAccount.type!==this.ACCOUNT_TYPES.CREDIT_CARD&&this.fromAccount.currency_type===this.toAccount.currency_type))}}]),t}();r.$inject=["$log","tngTileListConstants","accountConstants","moveMoneyConstants"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,a=n(5455),s=(i=a)&&i.__esModule?i:{default:i};n(5456);var r={template:s.default,controller:function(){},bindings:{}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="c-mf-ongoing-withdrawal-state"> <div class="c-mf-ongoing-withdrawal-state__note" translate="moveMoney.registeredMfOngoingWithdrawalState.note"></div> <div class="c-communication-wrapper"> <div class="c-communication-box"> <div class="c-communication-box__icon"> <tng-category-icon icon="icon-mobile"></tng-category-icon> </div> <div class="c-communication-box__title"> {{ ::\'moveMoney.registeredMfOngoingWithdrawalState.phoneUs.title\' | translate }} </div> <div class="c-communication-box__description" translate="moveMoney.registeredMfOngoingWithdrawalState.phoneUs.content"></div> </div> <div class="c-communication-box"> <div class="c-communication-box__icon"> <tng-category-icon icon="icon-messaging"></tng-category-icon> </div> <div class="c-communication-box__title"> {{ ::\'moveMoney.registeredMfOngoingWithdrawalState.chatUs.title\' | translate }} </div> <div class="c-communication-box__description" translate="moveMoney.registeredMfOngoingWithdrawalState.chatUs.content"></div> <div class="c-communication-box__description" translate="moveMoney.registeredMfOngoingWithdrawalState.chatUs.unavailable"></div> </div> </div> </div> '},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5458)),a=s(n(5459));function s(t){return t&&t.__esModule?t:{default:t}}n(5460);var r={template:i.default,controller:a.default,bindings:{data:"<",originalTrans:"<",setModalTitle:"&",ratesUrl:"<",modalType:"<",isPayment:"<"}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div class="print-sub-header">{{ ::\'moveMoney.confirmedState.confirmationNumber\' | translate }}  {{ $ctrl.data.confirmationNumber }}</div> <div class="c-confirmed-state" id="printMe"> <p class="confirmed--title-medium" ng-if="$ctrl.isDefaultLayout()"> <span ng-if="$ctrl.isNow"> {{ $ctrl.getTypeOfConfirmationTransKey() | translate }} <strong> {{ $ctrl.data.date | date:\'longDate\' }} {{ ::\'moveMoney.confirmedState.at\' | translate }} {{ $ctrl.formattedTransactionTime }} </strong>. </span> <span ng-if="$ctrl.isLater"> {{ ::\'moveMoney.confirmedState.scheduledFor\' | translate }} <strong>{{ $ctrl.data.date | date:\'longDate\' }}</strong>. </span> <span ng-if="$ctrl.isOngoing && $ctrl.flowService.reviewData.ccRecurringi18nDescString" ng-bind-html="\n      $ctrl.flowService.reviewData.ccRecurringi18nDescString | translate:{\n        day: $ctrl.flowService.reviewData.ccRecurringPaymentDay\n    }"></span> <span ng-if="$ctrl.isOngoing && !$ctrl.flowService.reviewData.ccRecurringi18nDescString"> {{ ::\'moveMoney.confirmedState.scheduledFor\' | translate }} <strong>{{ $ctrl.flowService.reviewData.startDate | date:\'longDate\' }}</strong>. </span> </p> <p class="confirmed--title-medium" ng-if="!$ctrl.isDefaultLayout()" ng-bind-html="$ctrl.getCustomDescription()"></p> <div class="confirm__table"> <div class="confirm__table__row"> <div class="confirm__table__header cell__code" ng-show="$ctrl.data.confirmationNumber"> <span class="confirmed--title"> {{ ::\'moveMoney.confirmedState.confirmationNumber\' | translate }} <span class="body--callout2">{{ $ctrl.data.confirmationNumber }}</span> </span> </div> </div> <div class="confirm__table__row" ng-if="$ctrl.isDefaultLayout()"> <div ng-if="!$ctrl.flowService.withdrawalHelper.isActive()" class="confirm__table__cell cell__amount"> <span class="confirmed--title">{{ ::$ctrl.getAmountHeaderTransKey() | translate }}</span> <br/> <div class="amount--orange" ng-if="$ctrl.data.payment_indicator === \'F\'" ng-bind-html="\'moveMoney.confirmedState.fullBalance\' | translate"> </div> <div class="amount--orange" ng-if="$ctrl.data.payment_indicator === \'M\'" ng-bind-html="\'moveMoney.confirmedState.minimumPayment\' | translate"> </div> <div class="amount--orange" ng-if="$ctrl.data.amount && !$ctrl.data.payment_indicator" id="transfer-amount"> {{ $ctrl.data.amount | tngCurrency:$ctrl.data.currency:$ctrl.isDisplayCurrencySign }} </div> <div ng-if="$ctrl.data.isCrossCurrency" class="amount--grey"> {{ $ctrl.data.amountConverted | tngCurrency:$ctrl.data.currencyConverted:$ctrl.isDisplayCurrencySign }} </div> </div> <div ng-if="$ctrl.flowService.withdrawalHelper.isActive() || $ctrl.flowService.isFromRSP" class="confirm__table__cell cell__amount"> <span ng-if="!$ctrl.isFromGoalAccount" class="confirmed--title" ng-bind-html="::\'moveMoney.confirmedState.rspRifSavingWithdrawal.withdrawalAmount\' | translate"></span> <span ng-if="$ctrl.isFromGoalAccount" class="confirmed--title" ng-bind-html="::\'moveMoney.confirmedState.rspRifSavingWithdrawal.transferAmount\' | translate"></span> <br/> <div ng-if="!$ctrl.isFromGoalAccount" class="amount--orange"> {{ $ctrl.flowService.withdrawalHelper.getBeforeTaxAmount() | tngCurrency:$ctrl.data.currency:$ctrl.isDisplayCurrencySign }} </div> <div ng-if="$ctrl.isFromGoalAccount" class="amount--orange"> {{ $ctrl.flowService.withdrawalHelper.getBeforeTaxAmount() | tngCurrency:$ctrl.data.currency:$ctrl.isDisplayCurrencySign }} </div> <div ng-if="!$ctrl.isFromGoalAccount" class="amount--grey"> {{ $ctrl.flowService.withdrawalHelper.getAfterTaxAmount() | tngCurrency:$ctrl.data.currency:$ctrl.isDisplayCurrencySign}} {{ ::\'moveMoney.amountState.afterTax\' | translate | lowercase }} </div> </div> <div class="confirm__table__cell cell__new-balance-from"> <span class="confirmed--title"> {{ ::$ctrl.getFromAccountHeaderTransKey() | translate }} <span ng-if="$ctrl.isFromExternal()" class="c-account-tile__description c-confirmed-state__ext-account-label"> {{ ::\'moveMoney.confirmedState.transferFrom\' | translate }} </span> <strong> <tng-account-name account="$ctrl.data.fromAccount"></tng-account-name> {{ $ctrl.data.fromAccount.display_name | maskNumber }} </strong> </span> <br> <span class="amount--orange" ng-if="!$ctrl.isFromExternal() &&\n          $ctrl.data.fromAccount.type !== $ctrl.ACCOUNT_TYPES.CREDIT_CARD &&\n          $ctrl.data.fromAccount.type !== $ctrl.ACCOUNT_TYPES.LOAN"> {{ $ctrl.data.fromNewBalance | tngCurrency:$ctrl.data.fromAccount.currency_type:$ctrl.isDisplayCurrencySign }} </span> <span class="amount--orange" ng-if="$ctrl.data.fromAccount.type === $ctrl.ACCOUNT_TYPES.CREDIT_CARD"> {{ $ctrl.data.fromAvailableCashAdvance |tngCurrency:$ctrl.data.fromAccount.currency_type:$ctrl.isDisplayCurrencySign }} </span> <span class="amount--orange" ng-if="$ctrl.data.fromAccount.type === $ctrl.ACCOUNT_TYPES.LOAN"> {{ $ctrl.data.fromAvailableCredit | tngCurrency:$ctrl.data.fromAccount.currency_type:$ctrl.isDisplayCurrencySign }} </span> </div> <div class="confirm__table__cell cell__new-balance-to"> <span class="confirmed--title"> {{ ::$ctrl.getToAccountHeaderTransKey() | translate }} <span ng-if="$ctrl.isToExternal()" class="c-account-tile__description c-confirmed-state__ext-account-label"> {{ ::\'moveMoney.confirmedState.transferTo\' | translate }} </span> <strong> <tng-account-name account="$ctrl.data.toAccount"></tng-account-name> {{ $ctrl.data.toAccount.display_name | maskNumber }} </strong> </span> <br> <span ng-if="!$ctrl.isToExternal() && !($ctrl.data.toAccount.type == $ctrl.ACCOUNT_TYPES.CREDIT_CARD && $ctrl.isNow)" class="amount--orange"> {{ $ctrl.data.toNewBalance | tngCurrency:$ctrl.data.toAccount.currency_type:$ctrl.isDisplayCurrencySign }} </span> <span class="amount--orange" ng-if="$ctrl.data.toAccount.type === $ctrl.ACCOUNT_TYPES.CREDIT_CARD && $ctrl.isNow && ($ctrl.data.toAcctCCAvailableCredit >= 0)"> {{ $ctrl.data.toAcctCCAvailableCredit | tngCurrency:$ctrl.data.toAccount.currency_type:$ctrl.isDisplayCurrencySign }} </span> </div> </div> <div class="confirm__table__row" ng-if="$ctrl.flowService.isModalType($ctrl.MODAL_TYPES.INVESTMENTS_SELL)"> <div class="confirm__table__cell cell__amount"> <span class="confirmed--title"> {{ ::\'moveMoney.confirmedState.investmentsSell.saleAmount\' | translate }} </span> <br/> <div class="amount--orange">{{ $ctrl.data.amount | tngCurrency:$ctrl.data.currency:$ctrl.isDisplayCurrencySign }}</div> <div ng-if="$ctrl.data.isCrossCurrency" class="amount--grey"> {{ $ctrl.data.amountConverted | tngCurrency:$ctrl.data.currencyConverted:$ctrl.isDisplayCurrencySign }} </div> </div> <div class="confirm__table__cell cell__new-balance-from"> <span class="confirmed--title"> {{ $ctrl.balanceTitle | translate }} <strong> <tng-account-name account="$ctrl.data.toAccount"></tng-account-name> {{ $ctrl.data.toAccount.display_name | maskNumber }} </strong> </span> <br/> <span class="amount--orange">{{ $ctrl.data.toAccount.available_balance |tngCurrency:$ctrl.data.toAccount.currency_type:$ctrl.isDisplayCurrencySign }}</span> </div> <div class="confirm__table__cell cell__new-balance-to"> <span class="confirmed--title"> {{ ::\'moveMoney.confirmedState.investmentsSell.fromPortfolio\' | translate }} </span> <br/> <span class="c-confirmed-state__portfolio-name"> {{ ::$ctrl.flowService.getMfPortfolioName() }} </span> </div> </div> <div class="confirm__table__row" ng-if="$ctrl.flowService.isModalType($ctrl.MODAL_TYPES.INVESTMENTS_BUY)"> <div class="confirm__table__cell cell__amount"> <span class="confirmed--title"> {{ ::\'moveMoney.confirmedState.investmentsBuy.purchaseAmount\' | translate }} </span> <br/> <div class="amount--orange">{{ $ctrl.data.amount | tngCurrency:$ctrl.data.currency:$ctrl.isDisplayCurrencySign }}</div> <div ng-if="$ctrl.data.isCrossCurrency" class="amount--grey"> {{ $ctrl.data.amountConverted | tngCurrency:$ctrl.data.currencyConverted }} </div> </div> <div class="confirm__table__cell cell__new-balance-from"> <span class="confirmed--title"> {{ $ctrl.balanceTitle | translate }} <span ng-if="$ctrl.data.fromAccount.type === $ctrl.ACCOUNT_TYPES.EXT"><br/></span> <strong> <tng-account-name account="$ctrl.data.fromAccount"></tng-account-name> {{ $ctrl.data.fromAccount.display_name | maskNumber }} </strong> </span> <br/> <span class="amount--orange" ng-if="$ctrl.data.fromAccount.type !== $ctrl.ACCOUNT_TYPES.EXT"> {{ $ctrl.data.fromNewBalance | tngCurrency:$ctrl.data.fromAccount.currency_type:$ctrl.isDisplayCurrencySign }} </span> </div> <div class="confirm__table__cell cell__new-balance-to"> <span class="confirmed--title"> {{ ::\'moveMoney.confirmedState.investmentsBuy.toPortfolio\' | translate }} </span> <br/> <span class="c-confirmed-state__portfolio-name"> {{ ::$ctrl.flowService.getMfPortfolioName() }} </span> </div> </div> <div class="confirm__table__row" ng-if="$ctrl.flowService.isModalType($ctrl.MODAL_TYPES.INVESTMENTS_WITHDRAWAL)"> <div class="confirm__table__cell cell__amount"> <span class="confirmed--title" ng-bind-html="::\'moveMoney.confirmedState.investmentsWithdrawal.withdrawalAmount\' | translate"></span> <br/> <div class="amount--orange"> {{ ::$ctrl.flowService.withdrawalHelper.getBeforeTaxAmount() | tngCurrency:$ctrl.data.currency:$ctrl.isDisplayCurrencySign }} </div> <div class="amount--grey"> {{ ::$ctrl.flowService.withdrawalHelper.getAfterTaxAmount() | tngCurrency:$ctrl.data.currency }} {{ ::\'moveMoney.amountState.afterTax\' | translate | lowercase }} </div> </div> <div class="confirm__table__cell cell__new-balance-from"> <span class="confirmed--title"> {{ ::\'moveMoney.confirmedState.investmentsWithdrawal.taxAmount\' | translate }} <strong> {{ ::$ctrl.data.withHoldingAmount | currency }} </strong> </span> </div> <div class="confirm__table__cell cell__new-balance-to"> <span class="confirmed--title"> {{ ::\'moveMoney.confirmedState.investmentsWithdrawal.fromPortfolio\' | translate }} </span> <br/> <span class="c-confirmed-state__portfolio-name"> {{ ::$ctrl.flowService.getMfPortfolioName() }} </span> </div> </div> </div> <p class="c-confirmed-state__messages"> </p><p ng-if="$ctrl.data.isCrossCurrency"> <span ng-bind-html="\'moveMoney.confirmedState.fxRate\' | translate:{ fromCurrency: $ctrl.data.fromAccount.currency_type, toCurrency: $ctrl.data.toAccount.currency_type, rate: $ctrl.data.exchangeRate }"></span> <a actionable-id="confirmed-state-link" ng-href="{{ ::$ctrl.ratesUrl }}" target="_blank">{{ ::\'moveMoney.topCopy.learnMore\' | translate }}</a> </p> <p ng-if="$ctrl.isNow && $ctrl.isCCPayment"> {{ ::\'moveMoney.confirmedState.ccBalanceMessage\' | translate }} </p> <p class="print-hide" ng-if="!$ctrl.hideTransactionsLink()"> <span translate="{{ $ctrl.viewTransLink }}"> </span> </p> <p ng-if="$ctrl.isInvestmentBuyFromExternal" ng-bind-html="::\'moveMoney.confirmedState.externalPaymentMessage\' | translate | absoluteHref"></p> <p> <tngx-print-button ng-if="$ctrl.isHybridBuild" button-class="btn btn--orange" only-element="\'printMe\'"> {{ ::\'moveMoney.confirmedState.print\' | translate }} </tngx-print-button> <tng-print-button ng-if="!$ctrl.isHybridBuild" button-class="btn btn--orange" only-element="\'printMe\'"> {{ ::\'moveMoney.confirmedState.print\' | translate }} </tng-print-button> </p> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a,s,r,o,c,l,u,d,h){(0,i.default)(this,t),this.isHybridBuild=!1,this.$log=e,this.stateConstants=n,this.moveMoneyConstants=a,this.WHEN=a.TIME_STATES.WHEN,this.MODAL_TYPES=a.MODAL_TYPES,this.$window=s,this.ACCOUNT_TYPES=r.ACCOUNT_TYPES,this.$translate=o,this.flowService=c,this.localeConstants=l,this.LocaleService=u,this.CurrencyService=d,this.$filter=h}return(0,a.default)(t,[{key:"$onInit",value:function(){this.setFormatedTransactionTime(),this.DEFAULT_LAYOUT_TYPES=[this.MODAL_TYPES.INVESTMENTS_BUY,this.MODAL_TYPES.INVESTMENTS_SELL,this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL]}},{key:"$onChanges",value:function(){this.setModalTitle&&this.originalTrans&&(this.isNow?this.setModalTitle({modalTitle:""}):this.modalType===this.MODAL_TYPES.INVESTMENTS_BUY?this.setModalTitle({modalTitle:"moveMoney.headings.confirmHeadingNow"}):(this.setModalTitle({modalTitle:"moveMoney.headings.confirmHeadingScheduled"}),this.setFormatedTransactionTime()))}},{key:"goToTransactionPage",value:function(){this.flowService.onButtonClickDone(),this.flowService.$state.go(this.stateConstants.TRANSACTIONS,{},{reload:!0})}},{key:"setFormatedTransactionTime",value:function(){this.LocaleService.locale!==this.localeConstants.LOCALES.EN_CA?this.formattedTransactionTime=moment(this.data.time,"HH:mm A").format("HH:mm").replace(":"," h "):this.formattedTransactionTime=this.data.time}},{key:"isFromExternal",value:function(){return this.originalTrans.fromAccount[0].type===this.ACCOUNT_TYPES.EXT}},{key:"isToExternal",value:function(){return this.originalTrans.toAccount[0].type===this.ACCOUNT_TYPES.EXT}},{key:"getFromAccountHeaderTransKey",value:function(){switch(this.originalTrans.fromAccount[0].type){case this.ACCOUNT_TYPES.CREDIT_CARD:return"moveMoney.confirmedState.cashAdvance";case this.ACCOUNT_TYPES.LOAN:return"moveMoney.confirmedState.availableCredit";case this.ACCOUNT_TYPES.EXT:return"";default:return this.balanceTitle}}},{key:"getToAccountHeaderTransKey",value:function(){switch(this.originalTrans.toAccount[0].type){case this.ACCOUNT_TYPES.CREDIT_CARD:return this.isNow?"moveMoney.confirmedState.availableCredit":"moveMoney.confirmedState.currentBalance";case this.ACCOUNT_TYPES.EXT:return"";default:return this.balanceTitle}}},{key:"getAmountHeaderTransKey",value:function(){return this.isCCPayment||this.isPayment?"moveMoney.confirmedState.paymentAmount":"moveMoney.confirmedState.transferAmount"}},{key:"getTypeOfConfirmationTransKey",value:function(){return this.isToExternal()&&!this.isNow?"moveMoney.confirmedState.confirmedToExternalTransfer":(this.isToExternal()||this.isFromExternal())&&this.isNow?"moveMoney.confirmedState.confirmedTransfer":this.isCCPayment||this.isPayment?"moveMoney.confirmedState.confirmedPayment":"moveMoney.confirmedState.confirmedTransfer"}},{key:"getCustomDescription",value:function(){var t=this.$filter("maskNumber")(this.data.fromAccount.display_name),e=this.$filter("maskNumber")(this.data.toAccount.display_name),n=this.flowService.reviewData.fromName+" "+t,i=this.flowService.reviewData.toName+" "+e,a=this.modalType,s="",r={};switch(this.modalType){case this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL:a="investmentsWithdrawal",s="now",r={date:this.data.date};break;case this.MODAL_TYPES.INVESTMENTS_BUY:this.isNow?(s="now",r={date:this.data.date,portfolio:this.flowService.getMfPortfolioName(),toAccount:i}):(s=this.getIsIndefinite?"ongoing":"ongoingDefinite",r={amount:this.flowService.transaction.amount,portfolio:this.flowService.getMfPortfolioName(),currencyType:this.flowService.isCrossCurrency?this.flowService.transaction.currency:"",toAccount:i,fromAccount:n,frequency:this.flowService.reviewData.frequency.toLowerCase(),startDate:this.flowService.reviewData.startDate,endDate:this.flowService.reviewData.endDate});break;case this.MODAL_TYPES.INVESTMENTS_SELL:this.isNow?(s="now",r={date:this.data.date,portfolio:this.flowService.getMfPortfolioName()}):(s=this.getIsIndefinite?"ongoing":"ongoingDefinite",r={amount:this.flowService.transaction.amount,portfolio:this.flowService.getMfPortfolioName(),currencyType:this.flowService.isCrossCurrency?this.flowService.transaction.currency:"",toAccount:i,fromAccount:n,frequency:this.flowService.reviewData.frequency.toLowerCase(),startDate:this.flowService.reviewData.startDate,endDate:this.flowService.reviewData.endDate});break;default:return""}var o="moveMoney.confirmedState."+a+"."+s;return this.$translate.instant(o,r)}},{key:"isDefaultLayout",value:function(){return-1===this.DEFAULT_LAYOUT_TYPES.indexOf(this.flowService.modalType)}},{key:"shouldDisplayNowCopy",value:function(){return this.flowService.modalType===this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL||this.flowService.modalType===this.MODAL_TYPES.INVESTMENTS_BUY}},{key:"hideTransactionsLink",value:function(){return this.flowService.modalType===this.MODAL_TYPES.INVESTMENTS_BUY||this.flowService.modalType===this.MODAL_TYPES.INVESTMENTS_SELL}},{key:"isNow",get:function(){return!!this.originalTrans&&("when"in this.originalTrans&&this.originalTrans.when===this.WHEN.NOW)}},{key:"getIsIndefinite",get:function(){return null===this.flowService.transaction.scheduledEndDate&&!0===this.flowService.transaction.isRecurring}},{key:"isLater",get:function(){return!!this.originalTrans&&("when"in this.originalTrans&&this.originalTrans.when===this.WHEN.LATER)}},{key:"isOngoing",get:function(){return!!this.originalTrans&&("when"in this.originalTrans&&this.originalTrans.when===this.WHEN.ONGOING)}},{key:"balanceTitle",get:function(){return this.modalType===this.MODAL_TYPES.INVESTMENTS_BUY||this.modalType===this.MODAL_TYPES.INVESTMENTS_SELL?this.data.fromAccount.type===this.ACCOUNT_TYPES.EXT?"moveMoney.confirmedState.from":"moveMoney.confirmedState.currentBalance":this.isNow?"moveMoney.confirmedState.newBalance":"moveMoney.confirmedState.currentBalance"}},{key:"viewTransLink",get:function(){switch(this.modalType){case this.MODAL_TYPES.INVESTMENTS_BUY:case this.MODAL_TYPES.INVESTMENTS_SELL:return"moveMoney.confirmedState."+this.modalType+".viewTransfers";case this.MODAL_TYPES.INVESTMENTS_WITHDRAWAL:return"moveMoney.confirmedState."+this.MODAL_TYPES.INVESTMENTS_SELL+".viewTransfers";default:return this.isNow?this.isPayment?"moveMoney.confirmedState.viewPending":"moveMoney.confirmedState.viewTransfers":this.isLater?"moveMoney.confirmedState.viewPending":"moveMoney.confirmedState.viewOngoing"}}},{key:"isCCPayment",get:function(){return this.originalTrans.toAccount[0].type===this.ACCOUNT_TYPES.CREDIT_CARD}},{key:"isExternalPayment",get:function(){return this.isFromExternal()||this.isToExternal()}},{key:"isInvestmentBuyFromExternal",get:function(){return this.isExternalPayment&&!this.flowService.isModalType(this.MODAL_TYPES.INVESTMENTS_BUY)}},{key:"isPrintButton",get:function(){var t=this.flowService,e=this.MODAL_TYPES;return!t.isModalType(e.INVESTMENTS_WITHDRAWAL)&&!t.isModalType(e.RSP_RIF_SAVING_WITHDRAWAL)&&!t.isModalType(e.INVESTMENTS_BUY)}},{key:"isFromGoalAccount",get:function(){return this.data&&this.data.fromAccount&&this.data.fromAccount.goal_account}},{key:"isDisplayCurrencySign",get:function(){return this.data.currency&&!this.CurrencyService.isCanadian(this.data.currency)||this.data.fromAccount&&this.data.fromAccount.currency_type&&!this.CurrencyService.isCanadian(this.data.fromAccount.currency_type)||this.data.toAccount&&this.data.toAccount.currency_type&&!this.CurrencyService.isCanadian(this.data.toAccount.currency_type)}}]),t}();r.$inject=["$log","stateConstants","moveMoneyConstants","$window","accountConstants","$translate","MoveMoneyFlowService","localeConstants","LocaleService","CurrencyService","$filter"],e.default=r,t.exports=e.default},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(5462)),a=s(n(5463));function s(t){return t&&t.__esModule?t:{default:t}}n(5464);var r={template:i.default,controller:a.default,bindings:{}};e.default=r,t.exports=e.default},function(t,e){t.exports='<div> <button type="button" actionable-id="moveMoneyModal_buyFundsBorrowedMoneyNo" class="c-move-money-borrowedMoney__button-large btn--view" ng-class="{\'is-active\': !$ctrl.flowService.buyFundsHasBorrowedMoney && $ctrl.flowService.buyFundsHasBorrowedMoney !== undefined}" ng-click="$ctrl.setBorrowedMoney(false)"> {{ ::\'moveMoney.borrowedMoneyState.borrowedMoneyNo\' | translate }} </button> <button type="button" actionable-id="moveMoneyModal_buyFundsBorrowedMoneyYes" class="c-move-money-borrowedMoney__button-large btn--view" ng-class="{\'is-active\': $ctrl.flowService.buyFundsHasBorrowedMoney}" ng-click="$ctrl.setBorrowedMoney(true)"> {{ ::\'moveMoney.borrowedMoneyState.borrowedMoneyYes\' | translate }} </button> <div ng-if="$ctrl.flowService.transaction.buyFunds.hasBorrowedMoney === true" class="margin__t--fix2"> <div class="field c-move-money-borrowedMoney__tbGap"> <h2 class="heading--sub3 top-margin-medium"> {{ ::\'moveMoney.borrowedMoneyState.borrowedMoneyLoanType.title\' | translate }} </h2> <input id="{{ ::$ctrl.pageId }}_loc" actionable-id="{{ ::$ctrl.pageId }}_loc" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.borrowedMoneyFromConst.LINE_OF_CREDIT" ng-click="$ctrl.radioSelectionChanged($ctrl.borrowedMoneyFromConst.LINE_OF_CREDIT)"/> <label for="{{ ::$ctrl.pageId }}_loc"> {{ ::\'moveMoney.borrowedMoneyState.borrowedMoneyLoanType.loc\' | translate }} </label> <input id="{{ ::$ctrl.pageId }}_cc" actionable-id="{{ ::$ctrl.pageId }}_cc" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.borrowedMoneyFromConst.CREDIT_CARD" ng-click="$ctrl.radioSelectionChanged($ctrl.borrowedMoneyFromConst.CREDIT_CARD)"/> <label for="{{ ::$ctrl.pageId }}_cc"> {{ ::\'moveMoney.borrowedMoneyState.borrowedMoneyLoanType.cc\' | translate }} </label> <input id="{{ ::$ctrl.pageId }}_mortgageLoan" actionable-id="{{ ::$ctrl.pageId }}_mortgageLoan" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.borrowedMoneyFromConst.MORTGAGE_TERM_LOAN" ng-click="$ctrl.radioSelectionChanged($ctrl.borrowedMoneyFromConst.MORTGAGE_TERM_LOAN)"/> <label for="{{ ::$ctrl.pageId }}_mortgageLoan"> {{ ::\'moveMoney.borrowedMoneyState.borrowedMoneyLoanType.mortgageTermLoan\' | translate }} </label> <input id="{{ ::$ctrl.pageId }}_rrspLoan" actionable-id="{{ ::$ctrl.pageId }}_rrspLoan" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.borrowedMoneyFromConst.RRSP_LOAN" ng-click="$ctrl.radioSelectionChanged($ctrl.borrowedMoneyFromConst.RRSP_LOAN)"/> <label for="{{ ::$ctrl.pageId }}_rrspLoan"> {{ ::\'moveMoney.borrowedMoneyState.borrowedMoneyLoanType.rrsp\' | translate }} </label> <input id="{{ ::$ctrl.pageId }}_borrowedFromFF" actionable-id="{{ ::$ctrl.pageId }}_borrowedFromFF" name="radio" class="input input--tangerine-radio" type="radio" ng-checked="$ctrl.radioSelectionMode === $ctrl.borrowedMoneyFromConst.BORROWED_FROM_FAMILY_FRIENDS" ng-click="$ctrl.radioSelectionChanged($ctrl.borrowedMoneyFromConst.BORROWED_FROM_FAMILY_FRIENDS)"/> <label for="{{ ::$ctrl.pageId }}_borrowedFromFF"> {{ ::\'moveMoney.borrowedMoneyState.borrowedMoneyLoanType.borrowedFromFamilyFriend\' | translate }} </label> </div> <div class="field c-move-money-borrowedMoney__tbGap"> <h2 class="heading--sub3 top-margin-medium"> {{ ::\'moveMoney.borrowedMoneyState.borrowedMoneyAgreementTitle\' | translate }} </h2> <input id="{{ ::$ctrl.pageId }}_agreement" actionable-id="{{ ::$ctrl.pageId }}_agreement" name="checkbox" class="input input--tangerine-checkbox" type="checkbox" ng-checked="$ctrl.flowService.borrowedMoneyAgreement" ng-click="$ctrl.isAgreementSelected()" ng-model="$ctrl.agreementSelectionMode" ng-change="$ctrl.flowService.setBorrowedMoneyAgreement($ctrl.agreementSelectionMode)"/> <label for="{{ ::$ctrl.pageId }}_agreement"> {{ ::\'moveMoney.borrowedMoneyState.borrowedMoneyAgreement\' | translate }} <a actionable-id="{{ ::$ctrl.pageId }}_agreementPDFLink" ng-href="{{ ::\'moveMoney.borrowedMoneyState.borrowedMoneyAgreementPDFhref\' | translate | absoluteHref:\'url\' }}" target="_blank"> {{ ::\'moveMoney.borrowedMoneyState.borrowedMoneyAgreementPDFlink\' | translate }} </a> </label> </div> </div> </div> '},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(e,n,a){(0,i.default)(this,t),this.$log=e,this.flowService=n,this.borrowedMoneyFromConst=a.BORROWED_MONEY_FROM,this.pageId="borrowedMoney"}return(0,a.default)(t,[{key:"$onInit",value:function(){this.flowService.buyFundsHasBorrowedMoney?(this.radioSelectionMode=this.flowService.borrowedMoneyFrom,this.agreementSelectionMode=!0,this.flowService.BUTTONS.BTN_ORG.disable=!1):void 0!==this.flowService.buyFundsHasBorrowedMoney?this.flowService.BUTTONS.BTN_ORG.disable=!1:(this.flowService.transaction.buyFunds.hasBorrowedMoney=void 0,this.flowService.setBuyFundsHasBorrowedMoney(void 0))}},{key:"setBorrowedMoney",value:function(t){this.flowService.transaction.buyFunds.hasBorrowedMoney=!!t,this.flowService.BUTTONS.BTN_ORG.disable=!0===t,this.radioSelectionMode=void 0,this.agreementSelectionMode=!1,this.flowService.setBuyFundsHasBorrowedMoney(t),this.flowService.setBorrowedMoneyFrom(void 0),this.flowService.setBorrowedMoneyAgreement(!1),this.isAllBorrowedMoneyFormsSelected&&(this.flowService.BUTTONS.BTN_ORG.disable=!1)}},{key:"radioSelectionChanged",value:function(t){this.flowService.setBorrowedMoneyFrom(t),this.radioSelectionMode=t,this.isAllBorrowedMoneyFormsSelected&&(this.flowService.BUTTONS.BTN_ORG.disable=!1)}},{key:"isAgreementSelected",value:function(){this.flowService.BUTTONS.BTN_ORG.disable=!this.isAllBorrowedMoneyFormsSelected}},{key:"isAllBorrowedMoneyFormsSelected",get:function(){return Boolean(this.flowService.borrowedMoneyFrom&&this.flowService.borrowedMoneyAgreement)}}]),t}();r.$inject=["$log","MoveMoneyFlowService","moveMoneyConstants"],e.default=r,t.exports=e.default},function(t,e,n){}])]);